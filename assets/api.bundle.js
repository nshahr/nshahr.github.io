!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var i={};r.r(i),r.d(i,"WebGLMultisampleRenderTarget",function(){return hn}),r.d(i,"WebGLRenderTargetCube",function(){return dn}),r.d(i,"WebGLRenderTarget",function(){return cn}),r.d(i,"WebGLRenderer",function(){return ks}),r.d(i,"ShaderLib",function(){return In}),r.d(i,"UniformsLib",function(){return On}),r.d(i,"UniformsUtils",function(){return wn}),r.d(i,"ShaderChunk",function(){return yn}),r.d(i,"FogExp2",function(){return xs}),r.d(i,"Fog",function(){return Ms}),r.d(i,"Scene",function(){return Os}),r.d(i,"Sprite",function(){return Ps}),r.d(i,"LOD",function(){return Rs}),r.d(i,"SkinnedMesh",function(){return Fs}),r.d(i,"Skeleton",function(){return Ds}),r.d(i,"Bone",function(){return Ns}),r.d(i,"Mesh",function(){return Ia}),r.d(i,"LineSegments",function(){return Us}),r.d(i,"LineLoop",function(){return Hs}),r.d(i,"Line",function(){return Gs}),r.d(i,"Points",function(){return Ws}),r.d(i,"Group",function(){return hs}),r.d(i,"VideoTexture",function(){return Vs}),r.d(i,"DataTexture",function(){return pn}),r.d(i,"DataTexture2DArray",function(){return Wa}),r.d(i,"DataTexture3D",function(){return Va}),r.d(i,"CompressedTexture",function(){return Ys}),r.d(i,"CubeTexture",function(){return za}),r.d(i,"CanvasTexture",function(){return js}),r.d(i,"DepthTexture",function(){return Xs}),r.d(i,"Texture",function(){return ln}),r.d(i,"AnimationLoader",function(){return Bu}),r.d(i,"CompressedTextureLoader",function(){return Gu}),r.d(i,"DataTextureLoader",function(){return Uu}),r.d(i,"CubeTextureLoader",function(){return zu}),r.d(i,"TextureLoader",function(){return Wu}),r.d(i,"ObjectLoader",function(){return Mc}),r.d(i,"MaterialLoader",function(){return Ec}),r.d(i,"BufferGeometryLoader",function(){return kc}),r.d(i,"DefaultLoadingManager",function(){return Fu}),r.d(i,"LoadingManager",function(){return Ru}),r.d(i,"ImageLoader",function(){return Hu}),r.d(i,"ImageBitmapLoader",function(){return Nc}),r.d(i,"FontLoader",function(){return Hc}),r.d(i,"FileLoader",function(){return Nu}),r.d(i,"Loader",function(){return zc}),r.d(i,"LoaderUtils",function(){return wc}),r.d(i,"Cache",function(){return Pu}),r.d(i,"AudioLoader",function(){return Vc}),r.d(i,"SpotLightShadow",function(){return gc}),r.d(i,"SpotLight",function(){return bc}),r.d(i,"PointLight",function(){return vc}),r.d(i,"RectAreaLight",function(){return Sc}),r.d(i,"HemisphereLight",function(){return fc}),r.d(i,"HemisphereLightProbe",function(){return Xc}),r.d(i,"DirectionalLightShadow",function(){return Ac}),r.d(i,"DirectionalLight",function(){return Tc}),r.d(i,"AmbientLight",function(){return Cc}),r.d(i,"AmbientLightProbe",function(){return qc}),r.d(i,"LightShadow",function(){return mc}),r.d(i,"Light",function(){return pc}),r.d(i,"LightProbe",function(){return jc}),r.d(i,"StereoCamera",function(){return Zc}),r.d(i,"PerspectiveCamera",function(){return ps}),r.d(i,"OrthographicCamera",function(){return yc}),r.d(i,"CubeCamera",function(){return Jc}),r.d(i,"ArrayCamera",function(){return fs}),r.d(i,"Camera",function(){return ds}),r.d(i,"AudioListener",function(){return th}),r.d(i,"PositionalAudio",function(){return rh}),r.d(i,"AudioContext",function(){return Wc}),r.d(i,"AudioAnalyser",function(){return ih}),r.d(i,"Audio",function(){return eh}),r.d(i,"VectorKeyframeTrack",function(){return Iu}),r.d(i,"StringKeyframeTrack",function(){return Ou}),r.d(i,"QuaternionKeyframeTrack",function(){return Mu}),r.d(i,"NumberKeyframeTrack",function(){return ku}),r.d(i,"ColorKeyframeTrack",function(){return wu}),r.d(i,"BooleanKeyframeTrack",function(){return Eu}),r.d(i,"PropertyMixer",function(){return nh}),r.d(i,"PropertyBinding",function(){return Th}),r.d(i,"KeyframeTrack",function(){return Su}),r.d(i,"AnimationUtils",function(){return vu}),r.d(i,"AnimationObjectGroup",function(){return Ch}),r.d(i,"AnimationMixer",function(){return Eh}),r.d(i,"AnimationClip",function(){return _u}),r.d(i,"Uniform",function(){return wh}),r.d(i,"InstancedBufferGeometry",function(){return kh}),r.d(i,"BufferGeometry",function(){return aa}),r.d(i,"Geometry",function(){return Yn}),r.d(i,"InterleavedBufferAttribute",function(){return _s}),r.d(i,"InstancedInterleavedBuffer",function(){return xh}),r.d(i,"InterleavedBuffer",function(){return Is}),r.d(i,"InstancedBufferAttribute",function(){return Mh}),r.d(i,"Face3",function(){return Pn}),r.d(i,"Object3D",function(){return Hn}),r.d(i,"Raycaster",function(){return Oh}),r.d(i,"Layers",function(){return Fn}),r.d(i,"EventDispatcher",function(){return ee}),r.d(i,"Clock",function(){return $c}),r.d(i,"QuaternionLinearInterpolant",function(){return xu}),r.d(i,"LinearInterpolant",function(){return Tu}),r.d(i,"DiscreteInterpolant",function(){return Cu}),r.d(i,"CubicInterpolant",function(){return Au}),r.d(i,"Interpolant",function(){return yu}),r.d(i,"Triangle",function(){return Ma}),r.d(i,"Math",function(){return Ui}),r.d(i,"Spherical",function(){return Lh}),r.d(i,"Cylindrical",function(){return Ph}),r.d(i,"Plane",function(){return gn}),r.d(i,"Frustum",function(){return bn}),r.d(i,"Sphere",function(){return mn}),r.d(i,"Ray",function(){return xa}),r.d(i,"Matrix4",function(){return vn}),r.d(i,"Matrix3",function(){return Vi}),r.d(i,"Box3",function(){return fn}),r.d(i,"Box2",function(){return Rh}),r.d(i,"Line3",function(){return Fh}),r.d(i,"Euler",function(){return Rn}),r.d(i,"Vector4",function(){return un}),r.d(i,"Vector3",function(){return Wi}),r.d(i,"Vector2",function(){return Hi}),r.d(i,"Quaternion",function(){return zi}),r.d(i,"Color",function(){return xn}),r.d(i,"SphericalHarmonics3",function(){return Yc}),r.d(i,"ImmediateRenderObject",function(){return Dh}),r.d(i,"VertexNormalsHelper",function(){return Nh}),r.d(i,"SpotLightHelper",function(){return Bh}),r.d(i,"SkeletonHelper",function(){return Gh}),r.d(i,"PointLightHelper",function(){return Uh}),r.d(i,"RectAreaLightHelper",function(){return Hh}),r.d(i,"HemisphereLightHelper",function(){return zh}),r.d(i,"LightProbeHelper",function(){return Wh}),r.d(i,"GridHelper",function(){return Vh}),r.d(i,"PolarGridHelper",function(){return Yh}),r.d(i,"PositionalAudioHelper",function(){return jh}),r.d(i,"FaceNormalsHelper",function(){return Xh}),r.d(i,"DirectionalLightHelper",function(){return qh}),r.d(i,"CameraHelper",function(){return Zh}),r.d(i,"BoxHelper",function(){return Kh}),r.d(i,"Box3Helper",function(){return Qh}),r.d(i,"PlaneHelper",function(){return Jh}),r.d(i,"ArrowHelper",function(){return $h}),r.d(i,"AxesHelper",function(){return td}),r.d(i,"Shape",function(){return dc}),r.d(i,"Path",function(){return hc}),r.d(i,"ShapePath",function(){return Bc}),r.d(i,"Font",function(){return Gc}),r.d(i,"CurvePath",function(){return cc}),r.d(i,"Curve",function(){return Vu}),r.d(i,"ImageUtils",function(){return on}),r.d(i,"ShapeUtils",function(){return Fl}),r.d(i,"WebGLUtils",function(){return cs}),r.d(i,"WireframeGeometry",function(){return qs}),r.d(i,"ParametricGeometry",function(){return Zs}),r.d(i,"ParametricBufferGeometry",function(){return Ks}),r.d(i,"TetrahedronGeometry",function(){return $s}),r.d(i,"TetrahedronBufferGeometry",function(){return tl}),r.d(i,"OctahedronGeometry",function(){return el}),r.d(i,"OctahedronBufferGeometry",function(){return rl}),r.d(i,"IcosahedronGeometry",function(){return il}),r.d(i,"IcosahedronBufferGeometry",function(){return nl}),r.d(i,"DodecahedronGeometry",function(){return al}),r.d(i,"DodecahedronBufferGeometry",function(){return ol}),r.d(i,"PolyhedronGeometry",function(){return Qs}),r.d(i,"PolyhedronBufferGeometry",function(){return Js}),r.d(i,"TubeGeometry",function(){return sl}),r.d(i,"TubeBufferGeometry",function(){return ll}),r.d(i,"TorusKnotGeometry",function(){return ul}),r.d(i,"TorusKnotBufferGeometry",function(){return cl}),r.d(i,"TorusGeometry",function(){return hl}),r.d(i,"TorusBufferGeometry",function(){return dl}),r.d(i,"TextGeometry",function(){return zl}),r.d(i,"TextBufferGeometry",function(){return Wl}),r.d(i,"SphereGeometry",function(){return Vl}),r.d(i,"SphereBufferGeometry",function(){return Yl}),r.d(i,"RingGeometry",function(){return jl}),r.d(i,"RingBufferGeometry",function(){return Xl}),r.d(i,"PlaneGeometry",function(){return la}),r.d(i,"PlaneBufferGeometry",function(){return ua}),r.d(i,"LatheGeometry",function(){return ql}),r.d(i,"LatheBufferGeometry",function(){return Zl}),r.d(i,"ShapeGeometry",function(){return Kl}),r.d(i,"ShapeBufferGeometry",function(){return Ql}),r.d(i,"ExtrudeGeometry",function(){return Bl}),r.d(i,"ExtrudeBufferGeometry",function(){return Gl}),r.d(i,"EdgesGeometry",function(){return $l}),r.d(i,"ConeGeometry",function(){return ru}),r.d(i,"ConeBufferGeometry",function(){return iu}),r.d(i,"CylinderGeometry",function(){return tu}),r.d(i,"CylinderBufferGeometry",function(){return eu}),r.d(i,"CircleGeometry",function(){return nu}),r.d(i,"CircleBufferGeometry",function(){return au}),r.d(i,"BoxGeometry",function(){return oa}),r.d(i,"CubeGeometry",function(){return oa}),r.d(i,"BoxBufferGeometry",function(){return sa}),r.d(i,"ShadowMaterial",function(){return su}),r.d(i,"SpriteMaterial",function(){return Ls}),r.d(i,"RawShaderMaterial",function(){return lu}),r.d(i,"ShaderMaterial",function(){return ka}),r.d(i,"PointsMaterial",function(){return zs}),r.d(i,"MeshPhysicalMaterial",function(){return cu}),r.d(i,"MeshStandardMaterial",function(){return uu}),r.d(i,"MeshPhongMaterial",function(){return hu}),r.d(i,"MeshToonMaterial",function(){return du}),r.d(i,"MeshNormalMaterial",function(){return pu}),r.d(i,"MeshLambertMaterial",function(){return fu}),r.d(i,"MeshDepthMaterial",function(){return as}),r.d(i,"MeshDistanceMaterial",function(){return os}),r.d(i,"MeshBasicMaterial",function(){return Oa}),r.d(i,"MeshMatcapMaterial",function(){return mu}),r.d(i,"LineDashedMaterial",function(){return gu}),r.d(i,"LineBasicMaterial",function(){return Bs}),r.d(i,"Material",function(){return ha}),r.d(i,"Float64BufferAttribute",function(){return ea}),r.d(i,"Float32BufferAttribute",function(){return ta}),r.d(i,"Uint32BufferAttribute",function(){return $n}),r.d(i,"Int32BufferAttribute",function(){return Jn}),r.d(i,"Uint16BufferAttribute",function(){return Qn}),r.d(i,"Int16BufferAttribute",function(){return Kn}),r.d(i,"Uint8ClampedBufferAttribute",function(){return Zn}),r.d(i,"Uint8BufferAttribute",function(){return qn}),r.d(i,"Int8BufferAttribute",function(){return Xn}),r.d(i,"BufferAttribute",function(){return jn}),r.d(i,"ArcCurve",function(){return ju}),r.d(i,"CatmullRomCurve3",function(){return Ju}),r.d(i,"CubicBezierCurve",function(){return rc}),r.d(i,"CubicBezierCurve3",function(){return ic}),r.d(i,"EllipseCurve",function(){return Yu}),r.d(i,"LineCurve",function(){return nc}),r.d(i,"LineCurve3",function(){return ac}),r.d(i,"QuadraticBezierCurve",function(){return oc}),r.d(i,"QuadraticBezierCurve3",function(){return sc}),r.d(i,"SplineCurve",function(){return lc}),r.d(i,"REVISION",function(){return ae}),r.d(i,"MOUSE",function(){return oe}),r.d(i,"CullFaceNone",function(){return se}),r.d(i,"CullFaceBack",function(){return le}),r.d(i,"CullFaceFront",function(){return ue}),r.d(i,"CullFaceFrontBack",function(){return ce}),r.d(i,"FrontFaceDirectionCW",function(){return he}),r.d(i,"FrontFaceDirectionCCW",function(){return de}),r.d(i,"BasicShadowMap",function(){return pe}),r.d(i,"PCFShadowMap",function(){return fe}),r.d(i,"PCFSoftShadowMap",function(){return me}),r.d(i,"FrontSide",function(){return ge}),r.d(i,"BackSide",function(){return be}),r.d(i,"DoubleSide",function(){return ve}),r.d(i,"FlatShading",function(){return ye}),r.d(i,"SmoothShading",function(){return Ae}),r.d(i,"NoColors",function(){return Te}),r.d(i,"FaceColors",function(){return Ce}),r.d(i,"VertexColors",function(){return Se}),r.d(i,"NoBlending",function(){return Ee}),r.d(i,"NormalBlending",function(){return we}),r.d(i,"AdditiveBlending",function(){return ke}),r.d(i,"SubtractiveBlending",function(){return xe}),r.d(i,"MultiplyBlending",function(){return Me}),r.d(i,"CustomBlending",function(){return Oe}),r.d(i,"AddEquation",function(){return Ie}),r.d(i,"SubtractEquation",function(){return _e}),r.d(i,"ReverseSubtractEquation",function(){return Le}),r.d(i,"MinEquation",function(){return Pe}),r.d(i,"MaxEquation",function(){return Re}),r.d(i,"ZeroFactor",function(){return Fe}),r.d(i,"OneFactor",function(){return De}),r.d(i,"SrcColorFactor",function(){return Ne}),r.d(i,"OneMinusSrcColorFactor",function(){return Be}),r.d(i,"SrcAlphaFactor",function(){return Ge}),r.d(i,"OneMinusSrcAlphaFactor",function(){return Ue}),r.d(i,"DstAlphaFactor",function(){return He}),r.d(i,"OneMinusDstAlphaFactor",function(){return ze}),r.d(i,"DstColorFactor",function(){return We}),r.d(i,"OneMinusDstColorFactor",function(){return Ve}),r.d(i,"SrcAlphaSaturateFactor",function(){return Ye}),r.d(i,"NeverDepth",function(){return je}),r.d(i,"AlwaysDepth",function(){return Xe}),r.d(i,"LessDepth",function(){return qe}),r.d(i,"LessEqualDepth",function(){return Ze}),r.d(i,"EqualDepth",function(){return Ke}),r.d(i,"GreaterEqualDepth",function(){return Qe}),r.d(i,"GreaterDepth",function(){return Je}),r.d(i,"NotEqualDepth",function(){return $e}),r.d(i,"MultiplyOperation",function(){return tr}),r.d(i,"MixOperation",function(){return er}),r.d(i,"AddOperation",function(){return rr}),r.d(i,"NoToneMapping",function(){return ir}),r.d(i,"LinearToneMapping",function(){return nr}),r.d(i,"ReinhardToneMapping",function(){return ar}),r.d(i,"Uncharted2ToneMapping",function(){return or}),r.d(i,"CineonToneMapping",function(){return sr}),r.d(i,"ACESFilmicToneMapping",function(){return lr}),r.d(i,"UVMapping",function(){return ur}),r.d(i,"CubeReflectionMapping",function(){return cr}),r.d(i,"CubeRefractionMapping",function(){return hr}),r.d(i,"EquirectangularReflectionMapping",function(){return dr}),r.d(i,"EquirectangularRefractionMapping",function(){return pr}),r.d(i,"SphericalReflectionMapping",function(){return fr}),r.d(i,"CubeUVReflectionMapping",function(){return mr}),r.d(i,"CubeUVRefractionMapping",function(){return gr}),r.d(i,"RepeatWrapping",function(){return br}),r.d(i,"ClampToEdgeWrapping",function(){return vr}),r.d(i,"MirroredRepeatWrapping",function(){return yr}),r.d(i,"NearestFilter",function(){return Ar}),r.d(i,"NearestMipMapNearestFilter",function(){return Tr}),r.d(i,"NearestMipMapLinearFilter",function(){return Cr}),r.d(i,"LinearFilter",function(){return Sr}),r.d(i,"LinearMipMapNearestFilter",function(){return Er}),r.d(i,"LinearMipMapLinearFilter",function(){return wr}),r.d(i,"UnsignedByteType",function(){return kr}),r.d(i,"ByteType",function(){return xr}),r.d(i,"ShortType",function(){return Mr}),r.d(i,"UnsignedShortType",function(){return Or}),r.d(i,"IntType",function(){return Ir}),r.d(i,"UnsignedIntType",function(){return _r}),r.d(i,"FloatType",function(){return Lr}),r.d(i,"HalfFloatType",function(){return Pr}),r.d(i,"UnsignedShort4444Type",function(){return Rr}),r.d(i,"UnsignedShort5551Type",function(){return Fr}),r.d(i,"UnsignedShort565Type",function(){return Dr}),r.d(i,"UnsignedInt248Type",function(){return Nr}),r.d(i,"AlphaFormat",function(){return Br}),r.d(i,"RGBFormat",function(){return Gr}),r.d(i,"RGBAFormat",function(){return Ur}),r.d(i,"LuminanceFormat",function(){return Hr}),r.d(i,"LuminanceAlphaFormat",function(){return zr}),r.d(i,"RGBEFormat",function(){return Wr}),r.d(i,"DepthFormat",function(){return Vr}),r.d(i,"DepthStencilFormat",function(){return Yr}),r.d(i,"RedFormat",function(){return jr}),r.d(i,"RGB_S3TC_DXT1_Format",function(){return Xr}),r.d(i,"RGBA_S3TC_DXT1_Format",function(){return qr}),r.d(i,"RGBA_S3TC_DXT3_Format",function(){return Zr}),r.d(i,"RGBA_S3TC_DXT5_Format",function(){return Kr}),r.d(i,"RGB_PVRTC_4BPPV1_Format",function(){return Qr}),r.d(i,"RGB_PVRTC_2BPPV1_Format",function(){return Jr}),r.d(i,"RGBA_PVRTC_4BPPV1_Format",function(){return $r}),r.d(i,"RGBA_PVRTC_2BPPV1_Format",function(){return ti}),r.d(i,"RGB_ETC1_Format",function(){return ei}),r.d(i,"RGBA_ASTC_4x4_Format",function(){return ri}),r.d(i,"RGBA_ASTC_5x4_Format",function(){return ii}),r.d(i,"RGBA_ASTC_5x5_Format",function(){return ni}),r.d(i,"RGBA_ASTC_6x5_Format",function(){return ai}),r.d(i,"RGBA_ASTC_6x6_Format",function(){return oi}),r.d(i,"RGBA_ASTC_8x5_Format",function(){return si}),r.d(i,"RGBA_ASTC_8x6_Format",function(){return li}),r.d(i,"RGBA_ASTC_8x8_Format",function(){return ui}),r.d(i,"RGBA_ASTC_10x5_Format",function(){return ci}),r.d(i,"RGBA_ASTC_10x6_Format",function(){return hi}),r.d(i,"RGBA_ASTC_10x8_Format",function(){return di}),r.d(i,"RGBA_ASTC_10x10_Format",function(){return pi}),r.d(i,"RGBA_ASTC_12x10_Format",function(){return fi}),r.d(i,"RGBA_ASTC_12x12_Format",function(){return mi}),r.d(i,"LoopOnce",function(){return gi}),r.d(i,"LoopRepeat",function(){return bi}),r.d(i,"LoopPingPong",function(){return vi}),r.d(i,"InterpolateDiscrete",function(){return yi}),r.d(i,"InterpolateLinear",function(){return Ai}),r.d(i,"InterpolateSmooth",function(){return Ti}),r.d(i,"ZeroCurvatureEnding",function(){return Ci}),r.d(i,"ZeroSlopeEnding",function(){return Si}),r.d(i,"WrapAroundEnding",function(){return Ei}),r.d(i,"TrianglesDrawMode",function(){return wi}),r.d(i,"TriangleStripDrawMode",function(){return ki}),r.d(i,"TriangleFanDrawMode",function(){return xi}),r.d(i,"LinearEncoding",function(){return Mi}),r.d(i,"sRGBEncoding",function(){return Oi}),r.d(i,"GammaEncoding",function(){return Ii}),r.d(i,"RGBEEncoding",function(){return _i}),r.d(i,"LogLuvEncoding",function(){return Li}),r.d(i,"RGBM7Encoding",function(){return Pi}),r.d(i,"RGBM16Encoding",function(){return Ri}),r.d(i,"RGBDEncoding",function(){return Fi}),r.d(i,"BasicDepthPacking",function(){return Di}),r.d(i,"RGBADepthPacking",function(){return Ni}),r.d(i,"TangentSpaceNormalMap",function(){return Bi}),r.d(i,"ObjectSpaceNormalMap",function(){return Gi}),r.d(i,"Face4",function(){return ed}),r.d(i,"LineStrip",function(){return rd}),r.d(i,"LinePieces",function(){return id}),r.d(i,"MeshFaceMaterial",function(){return nd}),r.d(i,"MultiMaterial",function(){return ad}),r.d(i,"PointCloud",function(){return od}),r.d(i,"Particle",function(){return sd}),r.d(i,"ParticleSystem",function(){return ld}),r.d(i,"PointCloudMaterial",function(){return ud}),r.d(i,"ParticleBasicMaterial",function(){return cd}),r.d(i,"ParticleSystemMaterial",function(){return hd}),r.d(i,"Vertex",function(){return dd}),r.d(i,"DynamicBufferAttribute",function(){return pd}),r.d(i,"Int8Attribute",function(){return fd}),r.d(i,"Uint8Attribute",function(){return md}),r.d(i,"Uint8ClampedAttribute",function(){return gd}),r.d(i,"Int16Attribute",function(){return bd}),r.d(i,"Uint16Attribute",function(){return vd}),r.d(i,"Int32Attribute",function(){return yd}),r.d(i,"Uint32Attribute",function(){return Ad}),r.d(i,"Float32Attribute",function(){return Td}),r.d(i,"Float64Attribute",function(){return Cd}),r.d(i,"ClosedSplineCurve3",function(){return Sd}),r.d(i,"SplineCurve3",function(){return Ed}),r.d(i,"Spline",function(){return wd}),r.d(i,"AxisHelper",function(){return kd}),r.d(i,"BoundingBoxHelper",function(){return xd}),r.d(i,"EdgesHelper",function(){return Md}),r.d(i,"WireframeHelper",function(){return Od}),r.d(i,"XHRLoader",function(){return Id}),r.d(i,"BinaryTextureLoader",function(){return _d}),r.d(i,"GeometryUtils",function(){return Ld}),r.d(i,"Projector",function(){return Pd}),r.d(i,"CanvasRenderer",function(){return Rd}),r.d(i,"JSONLoader",function(){return Fd}),r.d(i,"SceneUtils",function(){return Dd}),r.d(i,"LensFlare",function(){return Nd});var n=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(e){var r=this;U.DEBUG_MODE=!0,U.DEBUG_SPARK_LOCAL=e,this.client.debugger=this,this.serverQueueInfo=document.getElementById("dev-panel-info-server-queue"),this.browserQueueInfo=document.getElementById("dev-panel-info-browser-queue"),this.parseTimeInfo=document.getElementById("dev-panel-info-parse-time"),this.shapeCountInfo=document.getElementById("dev-panel-info-shape-count"),this.cudCountInfo=document.getElementById("dev-panel-info-cud-count"),this.drawTimeInfo=document.getElementById("dev-panel-info-draw-time"),this.fpsInfo=document.getElementById("dev-panel-info-fps"),this.timeInfo=document.getElementById("dev-panel-info-time"),e&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return r.onNewModelSelected()}),t.elementcount=0},t.prototype.stop=function(){this.serverQueueInfo=void 0,this.browserQueueInfo=void 0,this.parseTimeInfo=void 0,this.shapeCountInfo=void 0,this.cudCountInfo=void 0,this.drawTimeInfo=void 0,this.fpsInfo=void 0,this.timeInfo=void 0,this.modelSelector&&(this.modelSelector.onchange=void 0,this.modelSelector=void 0),t.elementcount=0},t.prototype.onNewModelSelected=function(){var e=this;if(null!=this.client.svg&&this.client.stop("TERMINATED"),this.shapeCountInfo.innerHTML=t.elementcount,"NO MODEL SELECTED"!=this.modelSelector.value){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&e.client.start({})},r.open("GET","/http/start?path="+this.modelSelector.value,!0),r.send()}},t}(),a=function(){function t(){}return t.createSvgElement=function(e){return U.DEBUG_MODE&&n.elementcount++,document.createElementNS(t.svgns,e)},t.createXhtmlElement=function(e){return U.DEBUG_MODE&&n.elementcount++,document.createElementNS(t.xhtmlns,e)},t.createTextNode=function(t){return U.DEBUG_MODE&&n.elementcount++,document.createTextNode(t)},t.createUseElement=function(e){var r=t.createSvgElement("use"),i="#"+e;return r.setAttributeNS(t.xlinkns,"href",i),r},t.cloneElementWithId=function(e){var r=document.getElementById(e);return t.cloneElement(r)},t.cloneElement=function(e){var r=e.cloneNode(!0);return r.removeAttribute("id"),U.DEBUG_MODE&&(n.elementcount+=1+t.childNodeDeepCount(r)),r},t.removeElement=function(e,r){var i=document.getElementById("canvas-group");if(i)for(var a=i.children,o=a.length-1;o>=0;o--){var s=parseInt(a[o].id),l=document.getElementById(s.toString());(r==l||r.contains(l))&&i.removeChild(a[o])}U.DEBUG_MODE&&(n.elementcount-=1+t.childNodeDeepCount(r)),e.removeChild(r)},t.removeAllChildren=function(e){for(;e.lastChild;)t.removeElement(e,e.lastChild)},t.bringElementToFront=function(t){t.parentNode.appendChild(t)},t.childElements=function(t){var e=t.children;if(!e){for(var r=t.childNodes,i=[],n=0;n<r.length;n++){var a=r[n];1==a.nodeType&&i.push(a)}return i}return e},t.isPrimitiveSVGElement=function(t){return!(t.startsWith("Shape")||t.startsWith("Markup")||t.startsWith("Control")||t.startsWith("Chart")||t.startsWith("Window3D"))},t.isContainedInElementOfType=function(t,e){for(;t&&1==t.nodeType&&e.indexOf(t.getAttribute("type"))<0;)t=t.parentNode;return t&&1==t.nodeType},t.findChildOfType=function(e,r){for(var i=t.childElements(e),n=0;n<i.length;n++)if(i[n].getAttribute("type")==r)return i[n];return console.log("Child of type "+r+" not found in",e),null},t.findParentOfType=function(t,e){for(var r=t.parentNode;;){if(!r||1!=r.nodeType)return null;var i=r;if(i.getAttribute("type")==e)return i;r=i.parentNode}},t.childNodeDeepCount=function(e){var r=e.childNodes;if(!r)return 0;for(var i=r.length,n=0;n<r.length;n++)i+=t.childNodeDeepCount(r[n]);return i},t.createCanvas=function(){var e=t.createXhtmlElement("canvas");return document.getElementById("canvas-group").appendChild(e),e},t.xhtmlns="http://www.w3.org/1999/xhtml",t.xlinkns="http://www.w3.org/1999/xlink",t.svgns="http://www.w3.org/2000/svg",t}(),o=function(){function t(){}return t.offsetPage=function(t){var e=t.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+i,left:e.left+r}},t.indexInParent=function(t){var e;for(e=0;t=t.previousElementSibling;e++);return e},t.radiansToDegrees=function(t){return 360*t/(2*Math.PI)},t.modulo=function(t,e){var r=t%e;return Math.floor(r>=0?r:r+e)},t.remainderPositive=function(t,e){var r=t%e;return r>=0?r:r+e},t.formatNumber=function(t,e){if(t==-1/0)return"-Infinity";if(t==1/0)return"+Infinity";if(isNaN(t))return"NaN";var r=Math.abs(t);return r<1e-12?String(0):r>9999999999||r<.001&&0!=t?String(+t.toExponential(2)):String(+t.toFixed(2))},t.formatPercent=function(t){return+Math.round(100*t)+"%"},t.reducePrecision=function(t){return+t.toPrecision(4)},t.dateComponent=function(t,e){var r,i=t.getFullYear();switch(e){case"YYYY":return String(i);case"MMM":switch(t.getMonth()+1){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return null}case"MM":r=t.getMonth()+1;break;case"DD":r=t.getDate();break;case"HH":r=t.getHours();break;case"mm":r=t.getMinutes();break;case"ss":r=t.getSeconds()}return r<10?"0"+r:String(r)},t.formatDate=function(e,r){switch(r){case"YYYY":return t.dateComponent(e,"YYYY");case"MMMYYYY":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"YYYY");case"DDMMM":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"DD");case"DDMMHH":return t.dateComponent(e,"MM")+"/"+t.dateComponent(e,"DD")+" "+t.dateComponent(e,"HH")+":00";case"HHmm":return t.dateComponent(e,"HH")+":"+t.dateComponent(e,"mm");case"mmss":default:return t.dateComponent(e,"mm")+"'"+t.dateComponent(e,"ss")+"''"}},t.toMilliseconds=function(e,r){switch(e.settings.timeUnit){case"MILLISECOND":return r*t.MILLISECOND;case"SECOND":return r*t.SECOND;case"MINUTE":return r*t.MINUTE;case"HOUR":return r*t.HOUR;case"DAY":return r*t.DAY;case"WEEK":return r*t.WEEK;case"MONTH":return r*t.MONTH;case"YEAR":return r*t.YEAR}},t.toDate=function(e,r){var i=e.settings,n=r-i.startTime;return new Date(i.startDate+t.toMilliseconds(e,n))},t.date=function(e){return t.toDate(e,e.time)},t.setMultipleAttributes=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i].toString())},t.getSubAttribute=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].split(":");if(2==i.length&&i[0]==e)return i[1]}return null},t.getIntAttribute=function(t,e){return parseInt(t.getAttribute(e))},t.getFloatAttribute=function(t,e){return parseFloat(t.getAttribute(e))},t.splitSkipEmpty=function(e,r){return e.split(r).filter(t.isEmpty)},t.isEmpty=function(t){return t.length>0},t.splitToFloats=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseFloat(i[n]);return i},t.splitToInts=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseInt(i[n]);return i},t.hyphenToCameLCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.parseTranslateTransform=function(e){var r=t.translateRegExp2.exec(e);return null!=r?[parseFloat(r[1]),parseFloat(r[2])]:(r=t.translateRegExp1.exec(e),[parseFloat(r[1]),0])},t.increaseTransparency=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=i[4]?i[4]:1;return"rgba("+i[1]+","+i[2]+","+i[3]+","+r*n+")"},t.addPathArrows=function(e,r,i,n,o,s){for(var l=e.getTotalLength(),u=o;u<l;u+=s){var c=e.getPointAtLength(u),h=e.getPointAtLength(u-3),d=t.radiansToDegrees(Math.PI/2-Math.atan2(c.x-h.x,c.y-h.y)),p=a.createUseElement(r);p.setAttribute("stroke-width",i.toString()),p.setAttribute("transform","translate("+c.x+" "+c.y+") rotate( "+d+")"),n.appendChild(p)}},t.sectorData=function(t,e,r,i,n,a){var o=Math.abs(a)>2*Math.PI?a%(2*Math.PI):a;a==2*Math.PI&&(a-=1e-4);var s=n+a,l=t+r*Math.cos(n),u=e+i*Math.sin(n),c=t+r*Math.cos(s),h=e+i*Math.sin(s);return"M "+t+" "+e+" L "+l+" "+u+" A "+r+" "+i+" 0 "+(Math.abs(o)>Math.PI?"1 ":"0 ")+(o>0?"1 ":"0 ")+c+" "+h+" Z"},t.roundPathCorners=function(t,e,r){function i(t,e,r){var i=e.x-t.x,a=e.y-t.y,o=Math.sqrt(i*i+a*a);return n(t,e,Math.min(1,r/o))}function n(t,e,r){return{x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}}function a(t,e){t.length>2&&(t[t.length-2]=e.x,t[t.length-1]=e.y)}function o(t){return{x:parseFloat(t[t.length-2]),y:parseFloat(t[t.length-1])}}var s=t.split(/[,\s]/).reduce(function(t,e){var r=e.match("([a-zA-Z])(.+)");return r?(t.push(r[1]),t.push(r[2])):t.push(e),t},[]).reduce(function(t,e){return parseFloat(e)==e&&t.length?t[t.length-1].push(e):t.push([e]),t},[]),l=[];if(s.length>1){var u=o(s[0]),c=null;"Z"==s[s.length-1][0]&&s[0].length>2&&(c=["L",u.x,u.y],s[s.length-1]=c),l.push(s[0]);for(var h=1;h<s.length;h++){var d=l[l.length-1],p=s[h],f=p==c?s[1]:s[h+1];if(f&&d&&d.length>2&&"L"==p[0]&&f.length>2&&"L"==f[0]){var m,g,b=o(d),v=o(p),y=o(f);r?(m=n(v,d.origPoint||b,e),g=n(v,f.origPoint||y,e)):(m=i(v,b,e),g=i(v,y,e)),a(p,m),p.origPoint=v,l.push(p);var A=n(m,v,.5),T=n(v,g,.5),C=["C",A.x,A.y,T.x,T.y,g.x,g.y];C.origPoint=v,l.push(C)}else l.push(p)}if(c){var S=o(l[l.length-1]);l.push(["Z"]),a(l[0],S)}}else l=s;return l.reduce(function(t,e){return t+e.join(" ")+" "},"")},t.stringToByteArray=function(t){for(var e=[],r=0,i=0;i<t.length;i++){for(var n=t.charCodeAt(i);n>255;)e[r++]=255&n,n>>=8;e[r++]=n}return e},t.byteArrayToString=function(t){if(t.length<=8192)return String.fromCharCode.apply(null,t);for(var e="",r=0;r<t.length;r+=8192){var i=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,i)}return e},t.translateRegExp1=/^translate\s*\(\s*(-?\d*.?\d*)\s*\)\s*$/i,t.translateRegExp2=/^translate\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)\s*$/i,t.rgbRegExp=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,t.rgbaRegExp=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*.?\d*)\s*\)\s*$/i,t.MILLISECOND=1,t.SECOND=1e3*t.MILLISECOND,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.MONTH=30*t.DAY,t.YEAR=365*t.DAY,t}(),s=function(){function t(t){this.frameDrawing=t}return t.createShapeArc=function(){return a.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createShapeText=function(){return a.createSvgElement("text")},t.updateShapeText=function(t,e,r){for(var i=0;i<e.length;i++)if("text-content"==e[i]){null==r[i]&&(r[i]="");var n=r[i].split("\n"),s=t.childElementCount;if(1==n.length&&1==s)t.firstChild.firstChild.textContent=n[0];else{for(var l=o.getFloatAttribute(t,"first-line-offset"),u=o.getFloatAttribute(t,"line-height"),c=0;c<n.length;c++){var h=a.childElements(t),d=n[c];if(d.endsWith("\r")&&(d=d.substring(0,d.length-1)),h[c])h[c].firstChild.textContent=d;else{var p=a.createSvgElement("tspan");p.setAttribute("x","0"),p.setAttribute("y",(l+c*u).toString());var f=a.createTextNode(d);p.appendChild(f),t.appendChild(p)}}for(;t.childElementCount>n.length;)a.removeElement(t,t.lastChild)}}else t.setAttribute(e[i],r[i])},t.createShapeImage=function(){return a.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":a.removeAllChildren(t);break;case"add":var n=a.createSvgElement("image");n.setAttributeNS(a.xlinkns,"href",this.frameDrawing.client.network.getJarResourceURL(r[i])),n.setAttribute("visibility","hidden"),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var o=parseInt(r[i]),s=t.childNodes,l=0;l<s.length;l++)(n=s[l]).setAttribute("visibility",l==o?"inherit":"hidden");break;case"width":case"height":s=t.childNodes;for(l=0;l<s.length;l++)(n=s[l]).setAttribute(e[i],r[i]);default:t.setAttribute(e[i],r[i])}},t.createShapeCanvas=function(t){var e=a.createSvgElement("image");return a.createCanvas().id=t+"canvas",e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),s=n.getContext("2d"),l=0;l<e.length;l++)switch(e[l]){case"width":case"height":i.setAttribute(e[l],r[l]),n.setAttribute(e[l],r[l]);break;case"fill-rect":case"clear-rect":var u=o.splitToFloats(r[l]," "),c=u[0],h=u[1],d=u[2],p=u[3];if("clear-rect"==e[l])s.clearRect(c,h,d,p);else{var f=u[4];s.fillStyle=f,s.fillRect(c,h,d,p)}break;case"fill-circle":u=r[l].split(" ");var m=parseFloat(u[0]),g=parseFloat(u[1]),b=parseFloat(u[2]),v=u[3];s.fillStyle=v,s.beginPath(),s.arc(m,g,b,0,2*Math.PI),s.fill();break;case"clear":s.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(a.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;default:t.setAttribute(e[l],r[l])}},t.createUnsupportedObject=function(t){var e=a.cloneElementWithId("unsupported-object");return a.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=a.findChildOfType(t,"background"),n=a.findChildOfType(t,"text"),o=0;o<e.length;o++)switch(e[o]){case"width":var s=parseFloat(r[o]);i.setAttribute("width",s.toString());var l=n.getBBox();s<l.width&&(n.firstChild.textContent="Not supported",l=n.getBBox()),s<l.width&&(n.firstChild.textContent="N/A",l=n.getBBox()),s<l.width&&(n.firstChild.textContent=""),n.setAttribute("x",(s/2).toString());break;case"height":var u=parseFloat(r[o]);i.setAttribute("height",u.toString()),n.setAttribute("y",(u/2+3).toString());break;default:t.setAttribute(e[o],r[o])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeGISMap"],t}(),l=function(){function t(){}return t.create=function(){return s.createUnsupportedObject("Vector 3D is under development. To view 3D use Play(video)")},t.update=function(t,e,r){s.updateUnsupportedObject(t,e,r)},t}(),u=function(){function t(){}return t.prototype.LANGUAGE=function(){return"English"},t.prototype.BOX_TITLE_MESSAGE=function(){return"Message"},t.prototype.BOX_TITLE_ERROR=function(){return"Error"},t.prototype.BOX_TITLE_FATAL_ERROR=function(){return"Fatal error"},t.prototype.BOX_TITLE_NOT_SUPPORTED=function(){return"Not supported"},t.prototype.BOX_TITLE_WAIT_OR_KILL=function(){return"The model is taking long time to start"},t.prototype.BOX_TEXT_WAIT_OR_KILL_OPTIONS=function(){return"You can continue waiting or you can kill the model by pressing the link below."},t.prototype.BOX_TEXT_WAIT_OR_KILL_IF_DOES_NOT_START=function(){return"If the model does not start within"},t.prototype.BOX_TEXT_WAIT_OR_KILL_WILL_BE_KILLED=function(){return"minutes, it will be killed automatically."},t.prototype.BOX_TEXT_WAIT_OR_KILL_KILL=function(){return"Kill the model"},t.prototype.BOX_TITLE_ANIMATED_RUN_TIME_LIMIT=function(){return"Animated run time limit"},t.prototype.BOX_TEXT_ANIMATED_RUN_TIME_LIMIT=function(){return"The model has run for the maximum time allowed.\nFor unlimited run time please choose a "},t.prototype.BOX_TITLE_CONNECTION_LOST=function(){return"Connection lost"},t.prototype.BOX_TEXT_CONNECTION_LOST=function(){return"The model is not responding.\nNetwork connection has probably been lost."},t.prototype.BOX_TITLE_OPEN_URL=function(){return"Open URL"},t.prototype.BOX_TITLE_UNKNOWN_COMMAND=function(){return"INTERNAL ERROR: Unknown command"},t.prototype.BOX_TITLE_UNKNOWN_SHAPE_TYPE=function(){return"INTERNAL ERROR: Unknown shape type"},t.prototype.BOX_TITLE_LOAD_SNAPSHOT=function(){return"Load snapshot"},t.prototype.BOX_TITLE_SAVE_SNAPSHOT=function(){return"Save snapshot"},t.prototype.BOX_TEXT_SNAPSHOT_LOAD_NOT_SUPPORTED=function(){return"Snapshot loading\nIs currently not supported in the Cloud."},t.prototype.BOX_TITLE_CLIPBOARD_ACCESS=function(){return"Clipboard access"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD=function(){return"The model wants to copy data to the clipboard."},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_ALLOW=function(){return"Allow"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_REJECT=function(){return"or close this dialog to reject."},t.prototype.SEE_CONSOLE=function(){return"Console"},t.prototype.PERCENT_OF=function(){return"of"},t.prototype.TIME=function(){return"time"},t.prototype.DATE=function(){return"date"},t.prototype.BYTES=function(){return"bytes"},t.prototype.KILOBYTES=function(){return"K"},t.prototype.MEGABYTES=function(){return"M"},t.prototype.MILLISECOND=function(){return"ms"},t.prototype.SECOND=function(){return"sec"},t.prototype.MINUTE=function(){return"min"},t.prototype.HOUR=function(){return"hours"},t.prototype.DAY=function(){return"days"},t.prototype.WEEK=function(){return"weeks"},t.prototype.MONTH=function(){return"months"},t.prototype.YEAR=function(){return"years"},t.prototype.JAN=function(){return"Jan"},t.prototype.FEB=function(){return"Feb"},t.prototype.MAR=function(){return"Mar"},t.prototype.APR=function(){return"Apr"},t.prototype.MAY=function(){return"May"},t.prototype.JUN=function(){return"Jun"},t.prototype.JUL=function(){return"Jul"},t.prototype.AUG=function(){return"Aug"},t.prototype.SEP=function(){return"Sep"},t.prototype.OCT=function(){return"Oct"},t.prototype.NOV=function(){return"Nov"},t.prototype.DEC=function(){return"Dec"},t.prototype.MILLIMETER=function(){return"mm"},t.prototype.CENTIMETER=function(){return"cm"},t.prototype.METER=function(){return"m"},t.prototype.KILOMETER=function(){return"km"},t.prototype.INCH=function(){return"in"},t.prototype.FOOT=function(){return"ft"},t.prototype.YARD=function(){return"yd"},t.prototype.MILE=function(){return"mi"},t.prototype.NAUTICAL_MILE=function(){return"nm"},t.prototype.PIXEL=function(){return"px"},t.prototype.RUN_UNTIL=function(){return"Run until"},t.prototype.RUN_FOR=function(){return"Run for"},t.prototype.PAUSE_AT=function(){return"Pause at"},t.prototype.CONSOLE=function(){return"Console"},t.prototype.EVENTS=function(){return"Events"},t.prototype.EVENTS_EVENTS_SCHEDULED_BY=function(){return"events scheduled by"},t.prototype.EVENTS_TIME_LEFT=function(){return"T left"},t.prototype.EVENTS_CONDITIONS_MONITORED_BY=function(){return"conditions monitored by"},t.prototype.EVENTS_PAUSE_THE_MODEL_TO_FOLLOW_EVENT_LINK=function(){return"Pause the model to follow event links"},t.prototype.EVENTS_PAUSE_THE_MODEL_RUN_TO_EVENT=function(){return"You can only run to the event in the Paused state"},t.prototype.EVENTS_MORE=function(){return"more"},t.prototype.EPS=function(){return"EPS"},t.prototype.FPS=function(){return"FPS"},t.prototype.STEP=function(){return"Step"},t.prototype.REAL_TIME=function(){return"Running"},t.prototype.COPY_CAMERA_LOCATION=function(){return"Copy camera location"},t.prototype.FOR_MORE_DETAILS_SEE=function(){return"For more details see"},t.prototype.ANYLOGIC_WEBSITE=function(){return"AnyLogic website"},t.prototype.TERMS_OF_USE=function(){return"Terms of use"},t.prototype.ABOUT_ANYLOGIC=function(){return"About AnyLogic"},t.prototype.SYSTEM_INFORMATION=function(){return"System information"},t.prototype.RUNNING_FROM_IDE=function(){return"from AnyLogic development environment"},t.prototype.RUNNING_AS_STANDALONE=function(){return"as exported standalone application"},t.prototype.RUNNING_IN_CLOUD=function(){return"in AnyLogic Cloud"},t.prototype.ABOUT_CREATED_WITH=function(){return"This model was created with simulation modeling software"},t.prototype.ABOUT_AND_CONTAINS=function(){return"and contains components of AnyLogic. For terms of use see"},t.prototype.ABOUT_THE_MODEL_IS_RUNNING=function(){return"The model is running"},t.prototype.ABOUT_ANYLOGIC_VERSION=function(){return"AnyLogic version"},t.prototype.ABOUT_JAVA_VERSION=function(){return"Java version"},t.prototype.ABOUT_PLATFORM=function(){return"Platform"},t.prototype.ABOUT_LICENSING_INFORMATION=function(){return"Licensing information"},t.prototype.ABOUT_THE_PRODUCT_INCLUDES=function(){return"This product includes the following software"},t.prototype.ABOUT_USES_SOFTWARE=function(){return"uses the following software"},t.prototype.ABOUT_SEE_ALSO=function(){return"See also"},t.prototype.ABOUT_FILE_IN_EXPORTED_MODEL=function(){return"file located in the exported model folder, or"},t.prototype.ABOUT_FILE_IN_INSTALLATION=function(){return"file in the AnyLogic installation folder"},t.prototype.EVALUATION_USE_ONLY=function(){return"EVALUATION USE ONLY"},t.prototype.DISTRIBUTOR_DEMO_USE_ONLY=function(){return"DISTRIBUTOR DEMO USE ONLY"},t.prototype.SUBSCRIPTION_OPTION=function(){return"subscription option"},t.prototype.ASK_OPEN_URL=function(){return"The model asks you to open an external URL"},t.prototype.URL_OPENS_IN_NEW_WINDOW=function(){return"The URL will open in a new window."},t.prototype.UPLOADING=function(){return"Uploading"},t.prototype.UPLOAD_FAILED=function(){return"Upload failed"},t.prototype.FORBIDDEN=function(){return"Forbidden"},t.prototype.ITEMS_DELETED=function(){return"item(s) deleted"},t.prototype.ITEMS_SKIPPED=function(){return"item(s) skipped"},t.prototype.WINDOW_REFRESH_DISABLED=function(){return"Window refresh is disabled"},t.prototype.ERROR_DRAWING_FRAME=function(){return"Error while drawing animation frame.\nPossibly caused by dynamic properties of animation shapes.\nThe picture will be restored when (and if) the error goes away."},t.prototype.ANIMATION_COMMAND_NOT_SUPPORTED=function(){return"The animation command is not supported"},t.prototype.SHAPE_TYPE_NOT_SUPPORTED=function(){return"The shape type is not supported"},t.prototype.ENGINE_AND_FRONTEND_DONT_MATCH=function(){return"Probably, the simulation engine and the frontend versions don't match."},t.prototype.ENTER_NUMBER_GREATER_THAN=function(){return"enter a number >"},t.prototype.ENTER_DATE_LATER_THAN=function(){return"enter a date later than"},t.prototype.NON_NEGATIVE_INTEGER_REQUIRED=function(){return"a non-negative integer required"},t.prototype.VALID_DATE_REQUIRED=function(){return"a valid date required"},t.prototype.OPERATION_CANNOT_BE_INTERRUPTED=function(){return"This operation cannot be interrupted. Please wait..."},t.prototype.UPLOADING_SNAPSHOT_FILE=function(){return"Uploading snapshot file"},t.prototype.RESTORING_SNAPSHOT=function(){return"Restoring snapshot"},t.prototype.SNAPSHOT_FAILED_TO_UPLOAD=function(){return"Snapshot file failed to upload"},t.prototype.SNAPSHOT_FAILED_TO_RESTORE=function(){return"Snapshot failed to restore"},t.prototype.WRITING_SNAPSHOT_FILE=function(){return"Writing snapshot file"},t.prototype.SNAPSHOT_FAILED_TO_SAVE=function(){return"Snapshot could not be saved"},t.prototype.DOWNLOADING_SNAPSHOT=function(){return"Snapshot file is being downloaded"},t.prototype.STATE_IDLE=function(){return"Idle"},t.prototype.STATE_RUNNING=function(){return"Running"},t.prototype.STATE_PAUSED=function(){return"Paused"},t.prototype.STATE_FINISHED=function(){return"Finished"},t.prototype.STATE_ERROR=function(){return"Error"},t.prototype.STATE_PLEASE_WAIT=function(){return"Please wait..."},t.prototype.STATE_INITIALIZE=function(){return"Initializing..."},t.prototype.STATE_STOPPED=function(){return"Stopped"},t.prototype.STATE_TIME_LIMIT=function(){return"Time limit"},t.prototype.STATE_TERMINATED=function(){return"Terminated"},t.prototype.TOOLTIP_MODEL_TIME_IN_MODEL_TIME_UNITS=function(){return"Model time in model time units"},t.prototype.TOOLTIP_MODEL_TIME_UNIT=function(){return"Model time unit"},t.prototype.TOOLTIP_PAUSE_TIME_IN_MODEL_TIME_UNITS=function(){return"Pause time in model time units"},t.prototype.TOOLTIP_MODEL_DATE=function(){return"Model date"},t.prototype.TOOLTIP_SHOW_HIDE_SNAPSHOT_OPTIONS=function(){return"Show/hide snapshot options"},t.prototype.TOOLTIP_LOAD_SNAPSHOT=function(){return"Load snapshot"},t.prototype.TOOLTIP_SAVE_SNAPSHOT=function(){return"Save snapshot"},t.prototype.TOOLTIP_SNAPSHOT_NOT_SUPPORTED=function(){return"Snapshot is not supported for this experiment type"},t.prototype.TOOLTIP_SNAPSHOT_NOT_WHILE_RUNNING=function(){return"Pause the model to enable snapshot"},t.prototype.TOOLTIP_RUN=function(){return"Run"},t.prototype.TOOLTIP_PAUSE=function(){return"Pause"},t.prototype.TOOLTIP_STEP=function(){return"Step"},t.prototype.TOOLTIP_STOP=function(){return"Stop"},t.prototype.TOOLTIP_DISABLED_BY_MODEL_DESIGNER=function(){return"Disabled by model designer"},t.prototype.TOOLTIP_SHOW_HIDE_RUN_OPTIONS=function(){return"Show/hide run options"},t.prototype.TOOLTIP_RUN_UNTIL_A_GIVEN_TIME_OR_DATE_THEN_PAUSE=function(){return"Run until a given time or date, then pause"},t.prototype.TOOLTIP_TOGGLE_DATE_TIME_UNITS=function(){return"Toggle date/time units"},t.prototype.TOOLTIP_RUN_FOR_A_GIVEN_TIME_INTERVAL_THEN_PAUSE=function(){return"Run for a given time interval, then pause"},t.prototype.TOOLTIP_PAUSE_AT_A_GIVEN_TIME_OR_DATE=function(){return"Pause at a given time or date"},t.prototype.TOOLTIP_SELECT_AGENT_TO_DIVE_IN=function(){return"Select agent to dive in"},t.prototype.TOOLTIP_UP_ONE_LEVEL=function(){return"Up one level"},t.prototype.TOOLTIP_TO_EXPERIMENT_START_PAGE=function(){return"To experiment (start page)"},t.prototype.TOOLTIP_TO_TOP_LEVEL_ROOT_AGENT=function(){return"To top level (root) agent"},t.prototype.TOOLTIP_GO_BACK=function(){return"Go back"},t.prototype.TOOLTIP_TO_0_0_ZOOM_1_SAME_PAGE_ORIGIN=function(){return"To (0,0), zoom 1, same page [origin]"},t.prototype.TOOLTIP_ZOOM_OUT=function(){return"Zoom out"},t.prototype.TOOLTIP_CURRENT_ZOOM=function(){return"Current zoom"},t.prototype.TOOLTIP_ZOOM_IN=function(){return"Zoom in"},t.prototype.TOOLTIP_SELECT_VIEW_AREA_TO_NAVIGATE=function(){return"Select view area to navigate"},t.prototype.TOOLTIP_CONSOLE=function(){return"Show console"},t.prototype.TOOLTIP_CLEAR_CONSOLE=function(){return"Clear console"},t.prototype.TOOLTIP_STAY_AT_THE_LATEST_ITEM=function(){return"Stay at the latest item"},t.prototype.TOOLTIP_TOGGLE_LINE_WRAP=function(){return"Toggle line wrap"},t.prototype.TOOLTIP_EVENTS=function(){return"Show events"},t.prototype.TOOLTIP_EVENTS_QUEUE=function(){return"Show event queue"},t.prototype.TOOLTIP_EVENTS_MONITOR=function(){return"Show monitored conditions"},t.prototype.TOOLTIP_EVENTS_SHOW_AGENT=function(){return"Show agent"},t.prototype.TOOLTIP_EVENTS_RUN_TO=function(){return"Run to"},t.prototype.TOOLTIP_EVENTS_IN_PAUSED_STATE_ONLY=function(){return"in Paused state only"},t.prototype.TOOLTIP_REAL_SPEED=function(){return"Simulated time per second"},t.prototype.TOOLTIP_EVENTS_PER_SECOND=function(){return"Events per second"},t.prototype.TOOLTIP_FRAMES_PER_SECOND=function(){return"Frames per second"},t.prototype.TOOLTIP_CURRENT_MODEL_STEP_DISCRETE_EVENT=function(){return"Current model step (discrete event)"},t.prototype.TOOLTIP_REAL_RUNNING_TIME_OF_SIMULATION=function(){return"Real running time of simulation"},t.prototype.TOOLTIP_MEMORY_CONSUMPTION=function(){return"Memory consumption"},t.prototype.TOOLTIP_SET_REAL_TIME_SCALE_X1=function(){return"Set real time scale x1"},t.prototype.TOOLTIP_SLOW_DOWN=function(){return"Slow down"},t.prototype.TOOLTIP_MODEL_TIME_UNITS_PER_REAL_SECOND=function(){return"Model time units per real second"},t.prototype.TOOLTIP_SPEED_UP=function(){return"Speed up"},t.prototype.TOOLTIP_RUN_AS_FAST_AS_POSSIBLE_VIRTUAL_TIME_MODE=function(){return"Run as fast as possible (virtual time mode)"},t.prototype.TOOLTIP_MULTI_RUN_PROGRESS=function(){return"Progress of parallel runs"},t.prototype.TOOLTIP_RESPONSIVENESS=function(){return"Responsiveness and network access"},t.prototype.TOOLTIP_EXPERIMENT_STATE=function(){return"Experiment state"},t.prototype.TOOLTIP_TOGGLE_FULL_SCREEN_MODE=function(){return"Toggle full screen mode"},t.prototype.TOOLTIP_DEVELOPER_PANEL=function(){return"Toggle Developer panel"},t}(),c=function(){function t(){}return t.prototype.LANGUAGE=function(){return"Русский"},t.prototype.BOX_TITLE_MESSAGE=function(){return"Сообщение"},t.prototype.BOX_TITLE_ERROR=function(){return"Ошибка"},t.prototype.BOX_TITLE_FATAL_ERROR=function(){return"Фатальная ошибка"},t.prototype.BOX_TITLE_NOT_SUPPORTED=function(){return"Не поддерживается"},t.prototype.BOX_TITLE_WAIT_OR_KILL=function(){return"Модель долго стартует"},t.prototype.BOX_TEXT_WAIT_OR_KILL_OPTIONS=function(){return"Вы можете продолжать ждать или убить модель, нажав на линк внизу."},t.prototype.BOX_TEXT_WAIT_OR_KILL_IF_DOES_NOT_START=function(){return"Если модель не запустится в течение"},t.prototype.BOX_TEXT_WAIT_OR_KILL_WILL_BE_KILLED=function(){return"минут, она будет завершена принудительно."},t.prototype.BOX_TEXT_WAIT_OR_KILL_KILL=function(){return"Убить модель"},t.prototype.BOX_TITLE_ANIMATED_RUN_TIME_LIMIT=function(){return"Ограничено время анимации"},t.prototype.BOX_TEXT_ANIMATED_RUN_TIME_LIMIT=function(){return"Исчерпан лимит времени анимационного запуска.\nДля снятия ограничения выберите "},t.prototype.BOX_TITLE_CONNECTION_LOST=function(){return"Соединение прервано"},t.prototype.BOX_TEXT_CONNECTION_LOST=function(){return"Модель не отвечает.\nВозможно, разорвано сетевое соединение."},t.prototype.BOX_TITLE_OPEN_URL=function(){return"Открыть внешнюю ссылку"},t.prototype.BOX_TITLE_UNKNOWN_COMMAND=function(){return"ОШИБКА СИСТЕМЫ: Неизвестная команда"},t.prototype.BOX_TITLE_UNKNOWN_SHAPE_TYPE=function(){return"ОШИБКА СИСТЕМЫ: Неизвестный тип фигуры"},t.prototype.BOX_TITLE_LOAD_SNAPSHOT=function(){return"Загрузка снэпшота"},t.prototype.BOX_TITLE_SAVE_SNAPSHOT=function(){return"Сохранение снэпшота"},t.prototype.BOX_TEXT_SNAPSHOT_LOAD_NOT_SUPPORTED=function(){return"Загрузка снэпшота в Облаке\nв настоящее время не поддерживается."},t.prototype.BOX_TITLE_CLIPBOARD_ACCESS=function(){return"Доступ к буферу обмена"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD=function(){return"Модель пытается скопировать данные в буфер обмена."},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_ALLOW=function(){return"Разрешите"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_REJECT=function(){return"или закройте этот диалог, чтобы отклонить."},t.prototype.SEE_CONSOLE=function(){return"Консоли"},t.prototype.PERCENT_OF=function(){return"из"},t.prototype.TIME=function(){return"время"},t.prototype.DATE=function(){return"дата"},t.prototype.BYTES=function(){return"байт"},t.prototype.KILOBYTES=function(){return"Кб"},t.prototype.MEGABYTES=function(){return"Мб"},t.prototype.MILLISECOND=function(){return"мс"},t.prototype.SECOND=function(){return"сек"},t.prototype.MINUTE=function(){return"мин"},t.prototype.HOUR=function(){return"ч"},t.prototype.DAY=function(){return"дней"},t.prototype.WEEK=function(){return"недель"},t.prototype.MONTH=function(){return"мес"},t.prototype.YEAR=function(){return"лет"},t.prototype.JAN=function(){return"янв"},t.prototype.FEB=function(){return"фев"},t.prototype.MAR=function(){return"мар"},t.prototype.APR=function(){return"апр"},t.prototype.MAY=function(){return"май"},t.prototype.JUN=function(){return"июн"},t.prototype.JUL=function(){return"июл"},t.prototype.AUG=function(){return"авг"},t.prototype.SEP=function(){return"сен"},t.prototype.OCT=function(){return"окт"},t.prototype.NOV=function(){return"ноя"},t.prototype.DEC=function(){return"дек"},t.prototype.MILLIMETER=function(){return"мм"},t.prototype.CENTIMETER=function(){return"см"},t.prototype.METER=function(){return"м"},t.prototype.KILOMETER=function(){return"км"},t.prototype.INCH=function(){return"дюйм"},t.prototype.FOOT=function(){return"фут"},t.prototype.YARD=function(){return"ярд"},t.prototype.MILE=function(){return"миля"},t.prototype.NAUTICAL_MILE=function(){return"морская миля"},t.prototype.PIXEL=function(){return"пиксель"},t.prototype.RUN_UNTIL=function(){return"Запустить до"},t.prototype.RUN_FOR=function(){return"Запустить на"},t.prototype.PAUSE_AT=function(){return"Приостановить в"},t.prototype.CONSOLE=function(){return"Консоль"},t.prototype.EVENTS=function(){return"События"},t.prototype.EVENTS_EVENTS_SCHEDULED_BY=function(){return"событий, созданных"},t.prototype.EVENTS_TIME_LEFT=function(){return"Время до"},t.prototype.EVENTS_CONDITIONS_MONITORED_BY=function(){return"условий, отслеживаемых"},t.prototype.EVENTS_PAUSE_THE_MODEL_TO_FOLLOW_EVENT_LINK=function(){return"Для перехода по ссылке приостановите модель"},t.prototype.EVENTS_PAUSE_THE_MODEL_RUN_TO_EVENT=function(){return"Выбор события для приостановки модели возможен только в режиме Пауза"},t.prototype.EVENTS_MORE=function(){return"еще"},t.prototype.EPS=function(){return"Соб/сек"},t.prototype.FPS=function(){return"Кадр/сек"},t.prototype.STEP=function(){return"Шаг"},t.prototype.REAL_TIME=function(){return"Длит"},t.prototype.COPY_CAMERA_LOCATION=function(){return"Скопировать положение камеры"},t.prototype.FOR_MORE_DETAILS_SEE=function(){return"Подробности смотрите в"},t.prototype.ANYLOGIC_WEBSITE=function(){return"Сайт AnyLogic"},t.prototype.TERMS_OF_USE=function(){return"Условия использования"},t.prototype.ABOUT_ANYLOGIC=function(){return"Информация об AnyLogic"},t.prototype.SYSTEM_INFORMATION=function(){return"Информация о системе"},t.prototype.RUNNING_FROM_IDE=function(){return"из среды разработки моделей AnyLogic"},t.prototype.RUNNING_AS_STANDALONE=function(){return"как экспортированное независимое приложение"},t.prototype.RUNNING_IN_CLOUD=function(){return"в облаке AnyLogic"},t.prototype.ABOUT_CREATED_WITH=function(){return"Эта модель была создана с помощью программного продукта"},t.prototype.ABOUT_AND_CONTAINS=function(){return"и содержит компоненты AnyLogic. Условия использования описаны в "},t.prototype.ABOUT_THE_MODEL_IS_RUNNING=function(){return"Модель выполняется"},t.prototype.ABOUT_ANYLOGIC_VERSION=function(){return"Версия AnyLogic"},t.prototype.ABOUT_JAVA_VERSION=function(){return"Версия Java"},t.prototype.ABOUT_PLATFORM=function(){return"Платформа"},t.prototype.ABOUT_LICENSING_INFORMATION=function(){return"Лицензионная информация"},t.prototype.ABOUT_THE_PRODUCT_INCLUDES=function(){return"Данный продукт содержит следующие компоненты"},t.prototype.ABOUT_USES_SOFTWARE=function(){return"использует следующие компоненты"},t.prototype.ABOUT_SEE_ALSO=function(){return"Смотрите также файл"},t.prototype.ABOUT_FILE_IN_EXPORTED_MODEL=function(){return"в папке экспортированной модели, или файл"},t.prototype.ABOUT_FILE_IN_INSTALLATION=function(){return"в папке установочного пакета"},t.prototype.EVALUATION_USE_ONLY=function(){return"ТОЛЬКО В ЦЕЛЯХ ОЗНАКОМЛЕНИЯ"},t.prototype.DISTRIBUTOR_DEMO_USE_ONLY=function(){return"ТОЛЬКО ДЛЯ ДЕМОНСТРАЦИИ ПАРТНЁРОМ AnyLogic"},t.prototype.SUBSCRIPTION_OPTION=function(){return"вариант подписки"},t.prototype.ASK_OPEN_URL=function(){return"Модель предлагает открыть внешнюю ссылку"},t.prototype.URL_OPENS_IN_NEW_WINDOW=function(){return"Ссылка откроется в новом окне."},t.prototype.UPLOADING=function(){return"Загружается"},t.prototype.UPLOAD_FAILED=function(){return"Файл не загружен"},t.prototype.FORBIDDEN=function(){return"Отказано в доступе"},t.prototype.ITEMS_DELETED=function(){return"элементов удалено"},t.prototype.ITEMS_SKIPPED=function(){return"элементов пропущено"},t.prototype.WINDOW_REFRESH_DISABLED=function(){return"Обновление окна отключено"},t.prototype.ERROR_DRAWING_FRAME=function(){return"Ошибка при отрисовке кадра.\nВозможно, причина в динамических свойствах фигур.\nАнимация будет восствновлена, когда (и если) ошибка уйдёт."},t.prototype.ANIMATION_COMMAND_NOT_SUPPORTED=function(){return"Эта команда не поддерживается"},t.prototype.SHAPE_TYPE_NOT_SUPPORTED=function(){return"Этот тип фигуры не поддерживается"},t.prototype.ENGINE_AND_FRONTEND_DONT_MATCH=function(){return"Возможно, версии модели и интерфейса несовместимы."},t.prototype.ENTER_NUMBER_GREATER_THAN=function(){return"введите число >"},t.prototype.ENTER_DATE_LATER_THAN=function(){return"введите дату позднее, чем"},t.prototype.NON_NEGATIVE_INTEGER_REQUIRED=function(){return"введите неотрицательное целое"},t.prototype.VALID_DATE_REQUIRED=function(){return"введите корректную дату"},t.prototype.OPERATION_CANNOT_BE_INTERRUPTED=function(){return"Эта операция не может быть прервана. Ждите..."},t.prototype.UPLOADING_SNAPSHOT_FILE=function(){return"Загружается файл снэпшота"},t.prototype.RESTORING_SNAPSHOT=function(){return"Восстанавливается снэпшот"},t.prototype.SNAPSHOT_FAILED_TO_UPLOAD=function(){return"Ошибка загрузки файла снэпшота"},t.prototype.SNAPSHOT_FAILED_TO_RESTORE=function(){return"Ошибка восстановления снэпшота"},t.prototype.WRITING_SNAPSHOT_FILE=function(){return"Запись снэпшота в файл"},t.prototype.SNAPSHOT_FAILED_TO_SAVE=function(){return"Ошибка сохранения снэпшота"},t.prototype.DOWNLOADING_SNAPSHOT=function(){return"Файл снэпшота скачивается"},t.prototype.STATE_IDLE=function(){return"Готов"},t.prototype.STATE_RUNNING=function(){return"Выполняется"},t.prototype.STATE_PAUSED=function(){return"Пауза"},t.prototype.STATE_FINISHED=function(){return"Завершено"},t.prototype.STATE_ERROR=function(){return"Ошибка"},t.prototype.STATE_PLEASE_WAIT=function(){return"Ожидание..."},t.prototype.STATE_INITIALIZE=function(){return"Инициализация..."},t.prototype.STATE_STOPPED=function(){return"Остановлено"},t.prototype.STATE_TIME_LIMIT=function(){return"Лимит времени"},t.prototype.STATE_TERMINATED=function(){return"Прекращено"},t.prototype.TOOLTIP_MODEL_TIME_IN_MODEL_TIME_UNITS=function(){return"Модельное (виртуальное) время"},t.prototype.TOOLTIP_MODEL_TIME_UNIT=function(){return"Единица модельного времени"},t.prototype.TOOLTIP_PAUSE_TIME_IN_MODEL_TIME_UNITS=function(){return"Время остановки"},t.prototype.TOOLTIP_MODEL_DATE=function(){return"Модельная дата"},t.prototype.TOOLTIP_SHOW_HIDE_SNAPSHOT_OPTIONS=function(){return"Показать/скрыть действия со снэпшотом"},t.prototype.TOOLTIP_LOAD_SNAPSHOT=function(){return"Загрузить снэпшот"},t.prototype.TOOLTIP_SAVE_SNAPSHOT=function(){return"Сохранить снэпшот"},t.prototype.TOOLTIP_SNAPSHOT_NOT_SUPPORTED=function(){return"Снэпшот не поддерживается для этого типа эксперимента"},t.prototype.TOOLTIP_SNAPSHOT_NOT_WHILE_RUNNING=function(){return"Поставьте модель на паузу для применения снэпшота"},t.prototype.TOOLTIP_RUN=function(){return"Запустить"},t.prototype.TOOLTIP_PAUSE=function(){return"Пауза"},t.prototype.TOOLTIP_STEP=function(){return"Шаг"},t.prototype.TOOLTIP_STOP=function(){return"Прекратить выполнение эксперимента"},t.prototype.TOOLTIP_DISABLED_BY_MODEL_DESIGNER=function(){return"Отключено разработчиком модели"},t.prototype.TOOLTIP_SHOW_HIDE_RUN_OPTIONS=function(){return"Показать/скрыть опции запуска"},t.prototype.TOOLTIP_RUN_UNTIL_A_GIVEN_TIME_OR_DATE_THEN_PAUSE=function(){return"Выполнить до заданного времени/даты, затем приостановить"},t.prototype.TOOLTIP_TOGGLE_DATE_TIME_UNITS=function(){return"Задать дату или время"},t.prototype.TOOLTIP_RUN_FOR_A_GIVEN_TIME_INTERVAL_THEN_PAUSE=function(){return"Выполнить в течение заданного интервала, затем приостановить"},t.prototype.TOOLTIP_PAUSE_AT_A_GIVEN_TIME_OR_DATE=function(){return"Приостановить в заданное время/дату"},t.prototype.TOOLTIP_SELECT_AGENT_TO_DIVE_IN=function(){return"Выбрать агента уровнем ниже и перейти"},t.prototype.TOOLTIP_UP_ONE_LEVEL=function(){return"Перейти в агента уровнем выше"},t.prototype.TOOLTIP_TO_EXPERIMENT_START_PAGE=function(){return"На страницу эксперимента (начальную страницу)"},t.prototype.TOOLTIP_TO_TOP_LEVEL_ROOT_AGENT=function(){return"К основному агенту (root)"},t.prototype.TOOLTIP_GO_BACK=function(){return"Назад"},t.prototype.TOOLTIP_TO_0_0_ZOOM_1_SAME_PAGE_ORIGIN=function(){return"В (0,0) этой же страницы с масштабом 100%"},t.prototype.TOOLTIP_ZOOM_OUT=function(){return"Отдалить"},t.prototype.TOOLTIP_CURRENT_ZOOM=function(){return"Текущий масштаб"},t.prototype.TOOLTIP_ZOOM_IN=function(){return"Приблизить"},t.prototype.TOOLTIP_SELECT_VIEW_AREA_TO_NAVIGATE=function(){return"Выбрать область и показать"},t.prototype.TOOLTIP_CONSOLE=function(){return"Показать консоль"},t.prototype.TOOLTIP_CLEAR_CONSOLE=function(){return"Очистить консоль"},t.prototype.TOOLTIP_STAY_AT_THE_LATEST_ITEM=function(){return"Показывать свежие элементы"},t.prototype.TOOLTIP_TOGGLE_LINE_WRAP=function(){return"Вкл/выкл перенос строки"},t.prototype.TOOLTIP_EVENTS=function(){return"Показать события"},t.prototype.TOOLTIP_EVENTS_QUEUE=function(){return"Очередь событий"},t.prototype.TOOLTIP_EVENTS_MONITOR=function(){return"Отслеживаемые условия"},t.prototype.TOOLTIP_EVENTS_SHOW_AGENT=function(){return"Показать агент"},t.prototype.TOOLTIP_EVENTS_RUN_TO=function(){return"Выполнить до"},t.prototype.TOOLTIP_EVENTS_IN_PAUSED_STATE_ONLY=function(){return"только в приостановленной модели"},t.prototype.TOOLTIP_REAL_SPEED=function(){return"Модельное время в секунду"},t.prototype.TOOLTIP_EVENTS_PER_SECOND=function(){return"Событий в секунду"},t.prototype.TOOLTIP_FRAMES_PER_SECOND=function(){return"Кадров в секунду"},t.prototype.TOOLTIP_CURRENT_MODEL_STEP_DISCRETE_EVENT=function(){return"Текущий шаг модели (дискретное событие)"},t.prototype.TOOLTIP_REAL_RUNNING_TIME_OF_SIMULATION=function(){return"Реальная длительность выполнения эксперимента"},t.prototype.TOOLTIP_MEMORY_CONSUMPTION=function(){return"Используемая память"},t.prototype.TOOLTIP_SET_REAL_TIME_SCALE_X1=function(){return"Включить режим реального времени (масштаб x1)"},t.prototype.TOOLTIP_SLOW_DOWN=function(){return"Замедлить"},t.prototype.TOOLTIP_MODEL_TIME_UNITS_PER_REAL_SECOND=function(){return"Масштаб к реальному времени (единиц модельного времени в секунду)"},t.prototype.TOOLTIP_SPEED_UP=function(){return"Ускорить"},t.prototype.TOOLTIP_RUN_AS_FAST_AS_POSSIBLE_VIRTUAL_TIME_MODE=function(){return"Вкл/выкл режим виртуального времени"},t.prototype.TOOLTIP_MULTI_RUN_PROGRESS=function(){return"Прогресс параллельно выполняемых прогонов"},t.prototype.TOOLTIP_RESPONSIVENESS=function(){return"Время отклика и доступ к сети"},t.prototype.TOOLTIP_EXPERIMENT_STATE=function(){return"Состояние эксперимента"},t.prototype.TOOLTIP_TOGGLE_FULL_SCREEN_MODE=function(){return"Вкл/выкл полноэкранный режим"},t.prototype.TOOLTIP_DEVELOPER_PANEL=function(){return"Показать/скрыть панель разработчика"},t}(),h=function(){function t(){}return t.prototype.LANGUAGE=function(){return"中文"},t.prototype.BOX_TITLE_MESSAGE=function(){return"消息"},t.prototype.BOX_TITLE_ERROR=function(){return"错误"},t.prototype.BOX_TITLE_FATAL_ERROR=function(){return"致命错误"},t.prototype.BOX_TITLE_NOT_SUPPORTED=function(){return"不支持"},t.prototype.BOX_TITLE_WAIT_OR_KILL=function(){return"The model is taking long time to start"},t.prototype.BOX_TEXT_WAIT_OR_KILL_OPTIONS=function(){return"You can continue waiting or kill the model by pressing the link below."},t.prototype.BOX_TEXT_WAIT_OR_KILL_IF_DOES_NOT_START=function(){return"If the model does not start within"},t.prototype.BOX_TEXT_WAIT_OR_KILL_WILL_BE_KILLED=function(){return"minutes, it will be killed automatically."},t.prototype.BOX_TEXT_WAIT_OR_KILL_KILL=function(){return"Kill the model"},t.prototype.BOX_TITLE_ANIMATED_RUN_TIME_LIMIT=function(){return"动画运行时间限制"},t.prototype.BOX_TEXT_ANIMATED_RUN_TIME_LIMIT=function(){return"模型已经运行允许的最长时间。\n如需无限运行时间，请选择"},t.prototype.BOX_TITLE_CONNECTION_LOST=function(){return"连接丢失"},t.prototype.BOX_TEXT_CONNECTION_LOST=function(){return"模型没有响应\n网络连接可能已经丢失。"},t.prototype.BOX_TITLE_OPEN_URL=function(){return"打开网址"},t.prototype.BOX_TITLE_UNKNOWN_COMMAND=function(){return"内部错误：未知命令"},t.prototype.BOX_TITLE_UNKNOWN_SHAPE_TYPE=function(){return"内部错误：未知图形类型"},t.prototype.BOX_TITLE_LOAD_SNAPSHOT=function(){return"加载快照"},t.prototype.BOX_TITLE_SAVE_SNAPSHOT=function(){return"保存快照"},t.prototype.BOX_TEXT_SNAPSHOT_LOAD_NOT_SUPPORTED=function(){return"在云中快照加载\n当前不支持。"},t.prototype.BOX_TITLE_CLIPBOARD_ACCESS=function(){return"剪贴板访问"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD=function(){return"模型想要复制数据到剪贴板。"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_ALLOW=function(){return"允许"},t.prototype.BOX_TEXT_COPY_TO_CLIPBOARD_REJECT=function(){return"或关闭这个对话框以拒绝。"},t.prototype.SEE_CONSOLE=function(){return"控制台"},t.prototype.PERCENT_OF=function(){return"共"},t.prototype.TIME=function(){return"时间"},t.prototype.DATE=function(){return"日期"},t.prototype.BYTES=function(){return"字节"},t.prototype.KILOBYTES=function(){return"千"},t.prototype.MEGABYTES=function(){return"百万"},t.prototype.MILLISECOND=function(){return"毫秒"},t.prototype.SECOND=function(){return"秒"},t.prototype.MINUTE=function(){return"分钟"},t.prototype.HOUR=function(){return"小时"},t.prototype.DAY=function(){return"天"},t.prototype.WEEK=function(){return"星期"},t.prototype.MONTH=function(){return"月"},t.prototype.YEAR=function(){return"年"},t.prototype.JAN=function(){return"一月"},t.prototype.FEB=function(){return"二月"},t.prototype.MAR=function(){return"三月"},t.prototype.APR=function(){return"四月"},t.prototype.MAY=function(){return"五月"},t.prototype.JUN=function(){return"六月"},t.prototype.JUL=function(){return"七月"},t.prototype.AUG=function(){return"八月"},t.prototype.SEP=function(){return"九月"},t.prototype.OCT=function(){return"十月"},t.prototype.NOV=function(){return"十一月"},t.prototype.DEC=function(){return"十二月"},t.prototype.MILLIMETER=function(){return"毫米"},t.prototype.CENTIMETER=function(){return"厘米"},t.prototype.METER=function(){return"米"},t.prototype.KILOMETER=function(){return"千米"},t.prototype.INCH=function(){return"英寸"},t.prototype.FOOT=function(){return"英尺"},t.prototype.YARD=function(){return"码"},t.prototype.MILE=function(){return"英里"},t.prototype.NAUTICAL_MILE=function(){return"海里"},t.prototype.PIXEL=function(){return"像素"},t.prototype.RUN_UNTIL=function(){return"运行直至"},t.prototype.RUN_FOR=function(){return"运行时长"},t.prototype.PAUSE_AT=function(){return"暂停在"},t.prototype.CONSOLE=function(){return"控制台"},t.prototype.EVENTS=function(){return"事件"},t.prototype.EVENTS_EVENTS_SCHEDULED_BY=function(){return"事件预定通过"},t.prototype.EVENTS_TIME_LEFT=function(){return"剩余时间"},t.prototype.EVENTS_CONDITIONS_MONITORED_BY=function(){return"条件监测通过"},t.prototype.EVENTS_PAUSE_THE_MODEL_TO_FOLLOW_EVENT_LINK=function(){return"暂停模型以跟踪事件链接"},t.prototype.EVENTS_PAUSE_THE_MODEL_RUN_TO_EVENT=function(){return"您只能在暂停状态运行事件"},t.prototype.EVENTS_MORE=function(){return"更多"},t.prototype.EPS=function(){return"事件每秒"},t.prototype.FPS=function(){return"帧每秒"},t.prototype.STEP=function(){return"步数"},t.prototype.REAL_TIME=function(){return"运行"},t.prototype.COPY_CAMERA_LOCATION=function(){return"复制摄像机位置"},t.prototype.FOR_MORE_DETAILS_SEE=function(){return"详情请见"},t.prototype.ANYLOGIC_WEBSITE=function(){return"AnyLogic网站"},t.prototype.TERMS_OF_USE=function(){return"使用条款"},t.prototype.ABOUT_ANYLOGIC=function(){return"关于AnyLogic"},t.prototype.SYSTEM_INFORMATION=function(){return"系统信息"},t.prototype.RUNNING_FROM_IDE=function(){return"从AnyLogic开发环境"},t.prototype.RUNNING_AS_STANDALONE=function(){return"作为导出的独立应用程序"},t.prototype.RUNNING_IN_CLOUD=function(){return"在AnyLogic云中"},t.prototype.ABOUT_CREATED_WITH=function(){return"这个模型是用仿真建模软件创建的"},t.prototype.ABOUT_AND_CONTAINS=function(){return"并包含AnyLogic组件。使用条款请见"},t.prototype.ABOUT_THE_MODEL_IS_RUNNING=function(){return"模型在运行"},t.prototype.ABOUT_ANYLOGIC_VERSION=function(){return"AnyLogic版本"},t.prototype.ABOUT_JAVA_VERSION=function(){return"Java版本"},t.prototype.ABOUT_PLATFORM=function(){return"平台"},t.prototype.ABOUT_LICENSING_INFORMATION=function(){return"许可信息"},t.prototype.ABOUT_THE_PRODUCT_INCLUDES=function(){return"这个产品包括下列软件"},t.prototype.ABOUT_USES_SOFTWARE=function(){return"使用下列软件"},t.prototype.ABOUT_SEE_ALSO=function(){return"另见"},t.prototype.ABOUT_FILE_IN_EXPORTED_MODEL=function(){return"位于导出的模型文件夹中的文件，或"},t.prototype.ABOUT_FILE_IN_INSTALLATION=function(){return"AnyLogic安装文件夹中的文件"},t.prototype.EVALUATION_USE_ONLY=function(){return"评估专用"},t.prototype.DISTRIBUTOR_DEMO_USE_ONLY=function(){return"经销商演示专用"},t.prototype.SUBSCRIPTION_OPTION=function(){return"订阅选项"},t.prototype.ASK_OPEN_URL=function(){return"模型要求您打开外部网址"},t.prototype.URL_OPENS_IN_NEW_WINDOW=function(){return"网址会在新窗口中打开。"},t.prototype.UPLOADING=function(){return"正在上传"},t.prototype.UPLOAD_FAILED=function(){return"上传失败"},t.prototype.FORBIDDEN=function(){return"禁止"},t.prototype.ITEMS_DELETED=function(){return"项目删除"},t.prototype.ITEMS_SKIPPED=function(){return"项目跳过"},t.prototype.WINDOW_REFRESH_DISABLED=function(){return"窗口刷新已禁用"},t.prototype.ERROR_DRAWING_FRAME=function(){return"绘制动画帧时发生错误\n可能是由动画图形的动态属性引起的。\n当（且如果）错误消失，图片将恢复。"},t.prototype.ANIMATION_COMMAND_NOT_SUPPORTED=function(){return"不支持动画命令"},t.prototype.SHAPE_TYPE_NOT_SUPPORTED=function(){return"不支持图形类型"},t.prototype.ENGINE_AND_FRONTEND_DONT_MATCH=function(){return"可能，仿真引擎和前端版本不匹配。"},t.prototype.ENTER_NUMBER_GREATER_THAN=function(){return"输入数字>"},t.prototype.ENTER_DATE_LATER_THAN=function(){return"输入日期晚于"},t.prototype.NON_NEGATIVE_INTEGER_REQUIRED=function(){return"要求非负整数"},t.prototype.VALID_DATE_REQUIRED=function(){return"要求有效日期"},t.prototype.OPERATION_CANNOT_BE_INTERRUPTED=function(){return"这个操作无法中断。请稍候……"},t.prototype.UPLOADING_SNAPSHOT_FILE=function(){return"正在上传快照文件"},t.prototype.RESTORING_SNAPSHOT=function(){return"正在还原快照"},t.prototype.SNAPSHOT_FAILED_TO_UPLOAD=function(){return"快照文件上传失败"},t.prototype.SNAPSHOT_FAILED_TO_RESTORE=function(){return"快照还原失败"},t.prototype.WRITING_SNAPSHOT_FILE=function(){return"正在写入快照文件"},t.prototype.SNAPSHOT_FAILED_TO_SAVE=function(){return"快照无法保存"},t.prototype.DOWNLOADING_SNAPSHOT=function(){return"快照文件正在下载"},t.prototype.STATE_IDLE=function(){return"空闲"},t.prototype.STATE_RUNNING=function(){return"运行"},t.prototype.STATE_PAUSED=function(){return"暂停"},t.prototype.STATE_FINISHED=function(){return"完成"},t.prototype.STATE_ERROR=function(){return"错误"},t.prototype.STATE_PLEASE_WAIT=function(){return"请稍候……"},t.prototype.STATE_INITIALIZE=function(){return"正在初始化……"},t.prototype.STATE_STOPPED=function(){return"停止"},t.prototype.STATE_TIME_LIMIT=function(){return"时间限制"},t.prototype.STATE_TERMINATED=function(){return"终止"},t.prototype.TOOLTIP_MODEL_TIME_IN_MODEL_TIME_UNITS=function(){return"模型时间以模型时间单位"},t.prototype.TOOLTIP_MODEL_TIME_UNIT=function(){return"模型时间单位"},t.prototype.TOOLTIP_PAUSE_TIME_IN_MODEL_TIME_UNITS=function(){return"暂停时间以模型时间单位"},t.prototype.TOOLTIP_MODEL_DATE=function(){return"模型日期"},t.prototype.TOOLTIP_SHOW_HIDE_SNAPSHOT_OPTIONS=function(){return"显示/隐藏快照选项"},t.prototype.TOOLTIP_LOAD_SNAPSHOT=function(){return"加载快照"},t.prototype.TOOLTIP_SAVE_SNAPSHOT=function(){return"保存快照"},t.prototype.TOOLTIP_SNAPSHOT_NOT_SUPPORTED=function(){return"这个实验类型不支持快照"},t.prototype.TOOLTIP_SNAPSHOT_NOT_WHILE_RUNNING=function(){return"暂停模型以启用快照"},t.prototype.TOOLTIP_RUN=function(){return"运行"},t.prototype.TOOLTIP_PAUSE=function(){return"暂停"},t.prototype.TOOLTIP_STEP=function(){return"单步"},t.prototype.TOOLTIP_STOP=function(){return"停止"},t.prototype.TOOLTIP_DISABLED_BY_MODEL_DESIGNER=function(){return"被模型设计者禁用"},t.prototype.TOOLTIP_SHOW_HIDE_RUN_OPTIONS=function(){return"显示/隐藏运行选项"},t.prototype.TOOLTIP_RUN_UNTIL_A_GIVEN_TIME_OR_DATE_THEN_PAUSE=function(){return"运行直至给定的时间或日期，然后暂停"},t.prototype.TOOLTIP_TOGGLE_DATE_TIME_UNITS=function(){return"切换日期/时间单位"},t.prototype.TOOLTIP_RUN_FOR_A_GIVEN_TIME_INTERVAL_THEN_PAUSE=function(){return"运行给定的时间间隔，然后暂停"},t.prototype.TOOLTIP_PAUSE_AT_A_GIVEN_TIME_OR_DATE=function(){return"在给定的时间或日期暂停"},t.prototype.TOOLTIP_SELECT_AGENT_TO_DIVE_IN=function(){return"选择智能体以进入"},t.prototype.TOOLTIP_UP_ONE_LEVEL=function(){return"向上一级"},t.prototype.TOOLTIP_TO_EXPERIMENT_START_PAGE=function(){return"到实验（开始页面）"},t.prototype.TOOLTIP_TO_TOP_LEVEL_ROOT_AGENT=function(){return"到最高层（根）智能体"},t.prototype.TOOLTIP_GO_BACK=function(){return"返回"},t.prototype.TOOLTIP_TO_0_0_ZOOM_1_SAME_PAGE_ORIGIN=function(){return"到（0,0），缩放1, 同一页面[原点]"},t.prototype.TOOLTIP_ZOOM_OUT=function(){return"缩小"},t.prototype.TOOLTIP_CURRENT_ZOOM=function(){return"当前缩放"},t.prototype.TOOLTIP_ZOOM_IN=function(){return"放大"},t.prototype.TOOLTIP_SELECT_VIEW_AREA_TO_NAVIGATE=function(){return"选择要导航的视图区域"},t.prototype.TOOLTIP_CONSOLE=function(){return"展示控制台"},t.prototype.TOOLTIP_CLEAR_CONSOLE=function(){return"清除控制台"},t.prototype.TOOLTIP_STAY_AT_THE_LATEST_ITEM=function(){return"停留在最新的项目"},t.prototype.TOOLTIP_TOGGLE_LINE_WRAP=function(){return"切换换行"},t.prototype.TOOLTIP_EVENTS=function(){return"展示事件"},t.prototype.TOOLTIP_EVENTS_QUEUE=function(){return"展示事件队列"},t.prototype.TOOLTIP_EVENTS_MONITOR=function(){return"展示监测的条件"},t.prototype.TOOLTIP_EVENTS_SHOW_AGENT=function(){return"展示智能体"},t.prototype.TOOLTIP_EVENTS_RUN_TO=function(){return"运行到"},t.prototype.TOOLTIP_EVENTS_IN_PAUSED_STATE_ONLY=function(){return"仅在暂停状态"},t.prototype.TOOLTIP_REAL_SPEED=function(){return"每秒仿真的时间"},t.prototype.TOOLTIP_EVENTS_PER_SECOND=function(){return"事件每秒"},t.prototype.TOOLTIP_FRAMES_PER_SECOND=function(){return"帧每秒"},t.prototype.TOOLTIP_CURRENT_MODEL_STEP_DISCRETE_EVENT=function(){return"当前模型步数（离散事件）"},t.prototype.TOOLTIP_REAL_RUNNING_TIME_OF_SIMULATION=function(){return"仿真真实运行时间"},t.prototype.TOOLTIP_MEMORY_CONSUMPTION=function(){return"内存消耗"},t.prototype.TOOLTIP_SET_REAL_TIME_SCALE_X1=function(){return"设置真实时间比例x1"},t.prototype.TOOLTIP_SLOW_DOWN=function(){return"减速"},t.prototype.TOOLTIP_MODEL_TIME_UNITS_PER_REAL_SECOND=function(){return"模型时间单位每真实秒"},t.prototype.TOOLTIP_SPEED_UP=function(){return"加速"},t.prototype.TOOLTIP_RUN_AS_FAST_AS_POSSIBLE_VIRTUAL_TIME_MODE=function(){return"尽可能快地运行（虚拟时间模式）"},t.prototype.TOOLTIP_MULTI_RUN_PROGRESS=function(){return"并行运行进度"},t.prototype.TOOLTIP_RESPONSIVENESS=function(){return"响应能力和网络访问"},t.prototype.TOOLTIP_EXPERIMENT_STATE=function(){return"实验状态"},t.prototype.TOOLTIP_TOGGLE_FULL_SCREEN_MODE=function(){return"切换全屏模式"},t.prototype.TOOLTIP_DEVELOPER_PANEL=function(){return"切换开发面板"},t}(),d=function(){function t(){}return t.setLanguage=function(e){e.startsWith("en")||e.startsWith("EN")?t.msg=new u:e.startsWith("ru")||e.startsWith("RU")?t.msg=new c:(e.startsWith("zh")||e.startsWith("ZH")||e.startsWith("cn")||e.startsWith("CN"))&&(t.msg=new h)},t.msg=new u,t}(),p=function(){function t(){}return t.setDebugMode=function(){t.debugmode=!0},t.isDebugMode=function(){return t.debugmode},t.getElementCount=function(){return t.elementcount},t.createSvgElement=function(e){return t.debugmode&&t.elementcount++,document.createElementNS(t.svgns,e)},t.createXhtmlElement=function(e){return t.debugmode&&t.elementcount++,document.createElementNS(t.xhtmlns,e)},t.createTextNode=function(e){return t.debugmode&&t.elementcount++,document.createTextNode(e)},t.createUseElement=function(e){var r=t.createSvgElement("use"),i="#"+e;return r.setAttributeNS(t.xlinkns,"href",i),r},t.changeUseHref=function(e,r){e.setAttributeNS(t.xlinkns,"href","#"+r)},t.cloneElementWithId=function(e){var r=document.getElementById(e);return t.cloneElement(r)},t.cloneElement=function(e){var r=e.cloneNode(!0);return r.removeAttribute("id"),t.debugmode&&(t.elementcount+=1+t.childNodeDeepCount(r)),r},t.cloneHTMLElement=function(t){var e=document.getElementById(t).cloneNode(!0);return e.removeAttribute("id"),e.style.removeProperty("display"),e},t.removeElement=function(e){for(var r=0,i=["canvas-group","canvas-group-3d"];r<i.length;r++){var n=i[r],a=document.getElementById(n);if(a)for(var o=a.children,s=o.length-1;s>=0;s--){var l=parseInt(o[s].id),u=document.getElementById(l.toString());(e==u||e.contains(u))&&(a.removeChild(o[s]),t.debugmode&&t.elementcount--)}}t.debugmode&&(t.elementcount-=1+t.childNodeDeepCount(e)),e.remove()},t.removeAllChildren=function(e){for(;e.lastChild;)t.removeElement(e.lastChild)},t.bringElementToFront=function(t){t.parentNode.appendChild(t)},t.childElements=function(t){var e=t.children;if(!e){for(var r=t.childNodes,i=[],n=0;n<r.length;n++){var a=r[n];1==a.nodeType&&i.push(a)}return i}return e},t.indexOfChildElement=function(t,e){for(var r=0,i=t.firstElementChild;null!=i;){if(i==e)return r;r++,i=i.nextElementSibling}return-1},t.isPrimitiveSVGElement=function(t){return!(t.startsWith("Shape")||t.startsWith("Markup")||t.startsWith("Control")||t.startsWith("Chart")||t.startsWith("Window3D"))},t.isContainedInElementOfType=function(t,e){for(;t&&1==t.nodeType&&e.indexOf(t.getAttribute("type"))<0;)t=t.parentNode;return t&&1==t.nodeType},t.findChildOfType=function(e,r){for(var i=t.childElements(e),n=0;n<i.length;n++)if(i[n].getAttribute("type")==r)return i[n];return null},t.findChildWithId=function(t,e){for(var r=t.childNodes,i=0;i<r.length;i++){var n=r[i];if(n.id==e)return n}return console.log("Child with id "+e+" not found in",t),null},t.findParentOfType=function(t,e){for(var r=t.parentNode;;){if(!r||1!=r.nodeType)return null;var i=r;if(i.getAttribute("type")==e)return i;r=i.parentNode}},t.childNodeDeepCount=function(e){if(e instanceof SVGElement&&t.excludeFromNodeCount.indexOf(e.getAttribute("type"))>=0)return 0;var r=e.childNodes;if(!r)return 0;for(var i=r.length,n=0;n<r.length;n++)i+=t.childNodeDeepCount(r[n]);return i},t.createCanvas=function(e,r){var i=t.createXhtmlElement("canvas");return document.getElementById(r).appendChild(i),i.id=e+"canvas",i},t.debugmode=!1,t.elementcount=0,t.xhtmlns="http://www.w3.org/1999/xhtml",t.xlinkns="http://www.w3.org/1999/xlink",t.svgns="http://www.w3.org/2000/svg",t.excludeFromNodeCount=["ShapeSVG","shapefile"],t}(),f=function(){function t(){}return t.offsetPage=function(t){var e=t.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+i,left:e.left+r}},t.indexInParent=function(t){var e;for(e=0;t=t.previousElementSibling;e++);return e},t.touchEventExists=function(){return window.TouchEvent},t.radiansToDegrees=function(t){return 360*t/(2*Math.PI)},t.degreesToRadians=function(t){return 2*Math.PI*(t/360)},t.modulo=function(t,e){var r=t%e;return Math.floor(r>=0?r:r+e)},t.remainderPositive=function(t,e){var r=t%e;return r>=0?r:r+e},t.findNearestArrayIndex=function(t,e,r,i){void 0===i&&(i=0);var n,a=t.length,o=!1;if(r){for(var s=0;s<a;s++)if(e<t[s]-i){o=!0,n=s;break}}else for(s=a-1;s>=0;s--)if(t[s]+i<e){o=!0,n=s;break}return o?n:r?1/0:-1/0},t.snapToArrayValue=function(e,r,i,n){void 0===n&&(n=0);var a=t.findNearestArrayIndex(e,r,i,n);return a<0?e[0]:a>=e.length?e[e.length-1]:e[a]},t.formatNumber=function(t,e,r){if(void 0===r&&(r=!0),t==-1/0)return"-Infinity";if(t==1/0)return"+Infinity";if(isNaN(t))return"NaN";var i=Math.abs(t);if(i<1e-12)return r?String(0):(0).toFixed(e);if(i>9999999999||i<.001&&0!=t)return r?String(+t.toExponential(e)):t.toExponential(e);var n=r?String(+t.toFixed(e)):t.toFixed(e),a=n.indexOf(".");if(a>=0){var o=n.substring(0,a),s=n.substring(a);return o.replace(this.threeDigitGroupsRegExp,",")+s}return n.replace(this.threeDigitGroupsRegExp,",")},t.formatPercent=function(t){return+Math.round(100*t)+"%"},t.reducePrecision=function(t){return+t.toPrecision(4)},t.fixedPrecision=function(t,e){return+t.toFixed(e)},t.goodGridStep=function(t,e,r){var i=t/Math.floor(e/r),n=Math.pow(10,Math.ceil(Math.log(t)/Math.log(10))-1),a=n/5;return a<i&&(a=n/2)<i&&(a=n)<i&&(a=2*n)<i&&(a=5*n),a},t.dateComponent=function(e,r){switch(r){case"yyyy":case"YYYY":case"y":return e.getFullYear().toString();case"yy":case"YY":return e.getFullYear().toString().substring(2);case"w":return t.getWeek(e).toString();case"MMM":switch(e.getMonth()+1){case 1:return d.msg.JAN();case 2:return d.msg.FEB();case 3:return d.msg.MAR();case 4:return d.msg.APR();case 5:return d.msg.MAY();case 6:return d.msg.JUN();case 7:return d.msg.JUL();case 8:return d.msg.AUG();case 9:return d.msg.SEP();case 10:return d.msg.OCT();case 11:return d.msg.NOV();case 12:return d.msg.DEC();default:return""}case"a":return""}var i;switch(r){case"MM":case"M":i=e.getMonth()+1;break;case"dd":case"DD":case"d":i=e.getDate();break;case"hh":case"HH":case"h":i=e.getHours();break;case"mm":case"m":i=e.getMinutes();break;case"ss":case"s":i=e.getSeconds()}return null!=i?i<10?"0"+i:i.toString():""},t.getWeek=function(t){var e=new Date(t.getFullYear(),0,1);return Math.ceil(((t.valueOf()-e.valueOf())/864e5+e.getDay()+1)/7)},t.formatDate=function(e,r){if(isNaN(e.getTime()))return"[invalid date]";r||(r=t.getLocalDateFormat());for(var i=r,n=0,a=t.dateFormatPatternLists;n<a.length;n++)for(var o=0,s=a[n];o<s.length;o++){var l=s[o];if(i.indexOf(l)>=0){i=i.replace(l,t.dateComponent(e,l));break}}return i},t.getLocalDateFormat=function(){if(!this.localDateFormat){var t=new Date(1917,10,7).toLocaleDateString();this.localDateFormat=t.replace(/\d+/g,function(t){switch(parseInt(t)%100){case 17:return t.replace(/.{1}/g,"Y");case 11:return"MM";case 7:return"DD"}}),this.localDateFormat+=" HH:mm"}return this.localDateFormat},t.replaceTabsWithSpaces=function(t,e){for(var r;!((r=t.indexOf("\t"))<0);){var i=" ".repeat(e-r%e);t=t.substring(0,r).concat(i,t.substring(r+1))}return t},t.timeUnitToString=function(t){switch(t){case"MILLISECOND":return d.msg.MILLISECOND();case"SECOND":return d.msg.SECOND();case"MINUTE":return d.msg.MINUTE();case"HOUR":return d.msg.HOUR();case"DAY":return d.msg.DAY();case"WEEK":return d.msg.WEEK();case"MONTH":return d.msg.MONTH();case"YEAR":return d.msg.YEAR()}return t},t.toMilliseconds=function(e,r){switch(r){case"MILLISECOND":return e;case"SECOND":return e*t.SECOND;case"MINUTE":return e*t.MINUTE;case"HOUR":return e*t.HOUR;case"DAY":return e*t.DAY;case"WEEK":return e*t.WEEK;case"MONTH":return e*t.MONTH;case"YEAR":return e*t.YEAR}},t.formatTimeInterval=function(e,r){if(e<=0)return"0 "+t.timeUnitToString(r);for(var i=t.toMilliseconds(e,r),n=0,a=t.niceTimeUnits;n<a.length;n++){var o=a[n],s=t.toMilliseconds(1,o);if(i>.5*s)return t.formatNumber(i/s,2,!1)+" "+t.timeUnitToString(o)}return t.formatNumber(i,2,!1)+" "+t.timeUnitToString("MILLISECOND")},t.setMultipleAttributes=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],null==r[i]?"":r[i].toString())},t.getAttributeValue=function(t,e,r){var i=t.indexOf(r);return i<0?null:e[i]},t.removeAttribute=function(t,e,r){for(var i=0;i<t.length;i++)if(t[i]==r)return t.splice(i,1),void e.splice(i,1)},t.getSubAttribute=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].split(":");if(2==i.length&&i[0]==e)return i[1]}return null},t.getFloatSubAttribute=function(e,r){var i=t.getSubAttribute(e,r);if(null==i)return null;var n=parseFloat(i);return isNaN(n)?null:n},t.getIntAttribute=function(t,e){var r=parseInt(t.getAttribute(e));return isNaN(r)?null:r},t.getFloatAttribute=function(t,e){var r=parseFloat(t.getAttribute(e));return isNaN(r)?null:r},t.splitSkipEmpty=function(e,r){return e.split(r).filter(t.isEmpty)},t.isEmpty=function(t){return t.length>0},t.splitToFloats=function(e,r){return t.splitSkipEmpty(e,r).map(function(t){return parseFloat(t)})},t.splitToInts=function(e,r){return t.splitSkipEmpty(e,r).map(function(t){return parseInt(t)})},t.hyphenToCameLCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.parseFloatIgnoreCommas=function(t){return parseFloat(t.replace(/,/g,""))},t.increaseTransparency=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=i[4]?i[4]:1;return"rgba("+i[1]+","+i[2]+","+i[3]+","+r*n+")"},t.removeTransparency=function(e){var r=t.rgbRegExp.exec(e);return r||(r=t.rgbaRegExp.exec(e)),r?"rgb("+r[1]+","+r[2]+","+r[3]+")":e},t.changeBrightness=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=parseInt(i[1]),a=parseInt(i[2]),o=parseInt(i[3]);if(r<=1)n*=r,a*=r,o*=r;else{var s=1-1/r;n+=(255-n)*s,a+=(255-a)*s,o+=(255-o)*s}return n=Math.round(n),a=Math.round(a),o=Math.round(o),i[4]?"rgba("+n+","+a+","+o+","+i[4]+")":"rgb("+n+","+a+","+o+")"},t.applyTransformAttribute=function(t,e){null==e||""==e?t.removeAttribute("transform"):t.setAttribute("transform",e)},t.posOrScaleToTransform=function(e,r,i){var n="",a="",o=e.getAttribute("transform"),s=null==o?-1:o.indexOf("scale");if("pos"==r){var l=t.splitToFloats(i,":"),u=l[0],c=l[1],h=t.radiansToDegrees(l[2]);0==u&&0==c||(n="translate("+u+" "+c+") "),0!=h&&(n+="rotate("+h+") "),a=s>=0?o.substring(s):""}else{var d=t.splitToFloats(i,":"),p=d[0],f=d[1];1==p&&1==f||(a="scale("+p+" "+f+")"),n=null==o||0==s?"":s<0?o:o.substring(0,s)}return""==(o=n+a)?null:o},t.parseTransform=function(e){var r=0,i=0,n=0,a=1,o=1;if(null!=e&&null!=e){var s=t.translateXYRegExp.exec(e);null!=s?i=parseFloat(s[2]):s=t.translateXRegExp.exec(e),null!=s&&(r=parseFloat(s[1])),null!=(s=t.rotateRegExp.exec(e))&&(n=t.degreesToRadians(parseFloat(s[1]))),null!=(s=t.scaleXYRegExp.exec(e))?(a=parseFloat(s[1]),o=parseFloat(s[2])):null!=(s=t.scaleRegExp.exec(e))&&(o=a=parseFloat(s[1]))}return[r,i,n,a,o]},t.constructTransform=function(e,r,i,n,a){if(0==e&&0==r&&0==i&&1==n&&1==a)return null;var o="";return 0==e&&0==r||(o+="translate("+e+","+r+") "),0!=i&&(o+="rotate("+t.radiansToDegrees(i)+") "),1==n&&1==a||(o+=a==n?"scale("+n+") ":"scale("+n+","+a+") "),o},t.setTransformScale=function(e,r){var i=t.parseTransform(e);return t.constructTransform(i[0],i[1],i[2],r,r)},t.adjustTransformScale=function(e,r,i){var n=t.parseTransform(e);return t.constructTransform(n[0],n[1],n[2],n[3]*r,n[4]*i)},t.pathAngleAt=function(t,e){var r=t.getTotalLength();e=Math.max(3,e),e=Math.min(e,r);var i=Math.max(0,e-3),n=t.getPointAtLength(e),a=t.getPointAtLength(i);return Math.atan2(n.y-a.y,n.x-a.x)},t.addPathArrows=function(e,r,i,n,a,o){for(var s=e.getTotalLength(),l=a;l<s;l+=o){var u=e.getPointAtLength(l),c=e.getPointAtLength(l-3),h=t.radiansToDegrees(Math.PI/2-Math.atan2(u.x-c.x,u.y-c.y)),d=p.createUseElement(r);d.setAttribute("stroke-width",i.toString()),d.setAttribute("transform","translate("+u.x+" "+u.y+") rotate( "+h+")"),n.appendChild(d)}},t.sectorData=function(t,e,r,i,n,a){var o=Math.abs(a)>2*Math.PI?a%(2*Math.PI):a;a==2*Math.PI&&(a-=1e-4);var s=n+a,l=t+r*Math.cos(n),u=e+i*Math.sin(n),c=t+r*Math.cos(s),h=e+i*Math.sin(s);return"M "+t+" "+e+" L "+l+" "+u+" A "+r+" "+i+" 0 "+(Math.abs(o)>Math.PI?"1 ":"0 ")+(o>0?"1 ":"0 ")+c+" "+h+" Z"},t.roundPathCorners=function(t,e,r){function i(t,e,r){var i=e.x-t.x,a=e.y-t.y,o=Math.sqrt(i*i+a*a);return n(t,e,Math.min(1,r/o))}function n(t,e,r){return{x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}}function a(t,e){t.length>2&&(t[t.length-2]=e.x,t[t.length-1]=e.y)}function o(t){return{x:parseFloat(t[t.length-2]),y:parseFloat(t[t.length-1])}}var s=t.split(/[,\s]/).reduce(function(t,e){var r=e.match("([a-zA-Z])(.+)");return r?(t.push(r[1]),t.push(r[2])):t.push(e),t},[]).reduce(function(t,e){return parseFloat(e)==e&&t.length?t[t.length-1].push(e):t.push([e]),t},[]),l=[];if(s.length>1){var u=o(s[0]),c=null;"Z"==s[s.length-1][0]&&s[0].length>2&&(c=["L",u.x,u.y],s[s.length-1]=c),l.push(s[0]);for(var h=1;h<s.length;h++){var d=l[l.length-1],p=s[h],f=p==c?s[1]:s[h+1];if(f&&d&&d.length>2&&"L"==p[0]&&f.length>2&&"L"==f[0]){var m,g,b=o(d),v=o(p),y=o(f);r?(m=n(v,d.origPoint||b,e),g=n(v,f.origPoint||y,e)):(m=i(v,b,e),g=i(v,y,e)),a(p,m),p.origPoint=v,l.push(p);var A=n(m,v,.5),T=n(v,g,.5),C=["C",A.x,A.y,T.x,T.y,g.x,g.y];C.origPoint=v,l.push(C)}else l.push(p)}if(c){var S=o(l[l.length-1]);l.push(["Z"]),a(l[0],S)}}else l=s;return l.reduce(function(t,e){return t+e.join(" ")+" "},"")},t.stringToByteArray=function(t){for(var e=[],r=0,i=0;i<t.length;i++){for(var n=t.charCodeAt(i);n>255;)e[r++]=255&n,n>>=8;e[r++]=n}return e},t.byteArrayToString=function(t){if(t.length<=8192)return String.fromCharCode.apply(null,t);for(var e="",r=0;r<t.length;r+=8192){var i=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,i)}return e},t.copyToClipboard=function(t){var e=document.createElement("textarea");document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy",!1),e.remove()},t.isIOS=function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},t.showErrorMessageBox=function(t,e,r){var i=document.getElementById("svg-message-background"),n=document.getElementById("svg-message-box"),a=document.getElementById("svg-message-box-header"),o=document.getElementById("svg-message-box-title"),s=document.getElementById("svg-message-box-text"),l=document.getElementById("svg-message-box-icon-use"),u=document.getElementById("svg-message-box-close"),c=document.getElementById("svg-message-box-progress"),h=function(){i.style.display="none",r&&r()};u.classList.contains("dev-panel-control")||u.classList.add("dev-panel-control"),u.classList.remove("dev-panel-control-disabled"),u.onclick=h,i.onclick=function(t){t.target==i&&h()},i.onkeydown=function(t){"Escape"==t.code&&h()},a.className="svg-message-box-colors-error";l.setAttribute("href","#dev-panel-icon-error"),l.setAttribute("xlink:href","#dev-panel-icon-error"),o.innerText=t&&""!=t?t:d.msg.BOX_TITLE_ERROR(),e=e.replace(/\n/g,"<br>"),s.innerHTML=e,c.style.display="none";var p=document.getElementById("svg-and-dev-panel-container").parentElement.getBoundingClientRect();n.style.maxWidth=Math.round(.8*p.width)+"px",n.style.maxHeight=Math.round(.8*p.height)+"px",i.style.removeProperty("display"),i.focus()},t.threeDigitGroupsRegExp=/\B(?=(\d{3})+(?!\d))/g,t.yearPatterns=["yyyy","YYYY","yy","YY","y"],t.weekPatterns=["w"],t.datePatterns=["dd","DD","d"],t.hourPatterns=["hh","HH","h"],t.ampmPatterns=["a"],t.minutePatterns=["mm","m"],t.secondPatterns=["ss","s"],t.monthPatterns=["MMM","MM","M"],t.dateFormatPatternLists=[t.yearPatterns,t.weekPatterns,t.datePatterns,t.hourPatterns,t.ampmPatterns,t.minutePatterns,t.secondPatterns,t.monthPatterns],t.MILLISECOND=1,t.SECOND=1e3*t.MILLISECOND,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.MONTH=30*t.DAY,t.YEAR=365*t.DAY,t.niceTimeUnits=["YEAR","DAY","HOUR","MINUTE","SECOND"],t.rgbRegExp=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,t.rgbaRegExp=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*.?\d*)\s*\)\s*$/i,t.translateXRegExp=/translate\s*\(\s*(-?\d*.?\d*)\s*\)/i,t.translateXYRegExp=/translate\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)/i,t.rotateRegExp=/rotate\s*\(\s*(-?\d*.?\d*)\s*\)/i,t.scaleRegExp=/scale\s*\(\s*(-?\d*.?\d*)\s*\)/i,t.scaleXYRegExp=/scale\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)/i,t}(),m=function(){function t(t,e,r,i,n,a,o){var s=this;void 0===o&&(o=null),this.over=!1,this.inClick=!1,this.xydown=[0,0],this.shape=t,this.onover=e,this.onout=r,this.ondown=i,this.onclick=n,this.ondblclick=o,this.ignorecondition=a;var l=function(t){return s.onEvent(t)};this.shape.addEventListener("mouseover",l),this.shape.addEventListener("mouseout",l),this.shape.addEventListener("mousedown",l),this.shape.addEventListener("mouseup",l),null!=this.ondblclick&&this.shape.addEventListener("dblclick",l),this.shape.addEventListener("touchstart",l),this.shape.addEventListener("touchmove",l),this.shape.addEventListener("touchend",l),this.shape.style.pointerEvents="auto"}return t.prototype.onEvent=function(e){var r=this;if(null==this.ignorecondition||!this.ignorecondition(e))if(e instanceof MouseEvent){var i=e;switch(i.type){case"mouseover":this.over||null==this.onover||this.onover(i),this.over=!0;break;case"mouseout":this.shape.contains(i.relatedTarget)||(this.over=!1,this.inClick=!1,null!=this.onout&&this.onout(i));break;case"mousedown":1==i.which&&(i.preventDefault(),this.inClick=!0,this.xydown=[i.pageX,i.pageY],null!=this.ondown&&this.ondown(i));break;case"mouseup":if(this.inClick&&1==i.which){i.preventDefault(),this.inClick=!1;var n=i.pageX-this.xydown[0],a=i.pageY-this.xydown[1];Math.sqrt(n*n+a*a)<=t.clickTolerance&&null!=this.onclick&&(null!=this.ondblclick?(clearTimeout(this.onclickTimeoutId),this.onclickTimeoutId=setTimeout(function(){return r.onclick(i)},t.DBLCLICK_TIMEOUT)):this.onclick(i)),null!=this.onover&&this.onover(i)}break;case"dblclick":null!=this.ondblclick&&(clearTimeout(this.onclickTimeoutId),this.ondblclick(i))}}else if(f.touchEventExists()&&e instanceof TouchEvent){var o=e;switch(o.type){case"touchstart":1==o.touches.length?(o.preventDefault(),this.inClick=!0,this.xydown=[o.touches[0].pageX,o.touches[0].pageY],null!=this.onover&&this.onover(o)):this.inClick=!1;break;case"touchmove":this.inClick=!1,null!=this.onout&&this.onout(o);break;case"touchend":n=o.changedTouches[0].pageX-this.xydown[0],a=o.changedTouches[0].pageY-this.xydown[1];Math.sqrt(n*n+a*a)<=t.clickTolerance&&null!=this.onclick&&this.inClick&&0==o.touches.length&&(o.preventDefault(),this.onclick(o)),this.inClick=!1,null!=this.onout&&this.onout(o)}}},t.eventPageXY=function(t){var e,r;if(t instanceof MouseEvent){var i=t;e=i.pageX,r=i.pageY}else{var n=t;n.touches.length>0?(e=n.touches[0].pageX,r=n.touches[0].pageY):(e=n.changedTouches[0].pageX,r=n.changedTouches[0].pageY)}return[e,r]},t.clickTolerance=2,t.DBLCLICK_TIMEOUT=300,t}(),g=function(){function t(t,e){this.frameDrawing=t,this.control=e}return t.createControlList=function(){var e=a.cloneElementWithId("control-list"),r=function(e){return t.onControlListMouseEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("wheel",r);var i=a.findChildOfType(e,"svg"),n=a.findChildOfType(i,"scrollbargroup"),o=function(e){return t.onControlListScrollbarMouseEvent(e)};return n.addEventListener("mouseout",o),n.addEventListener("mousedown",o),n.addEventListener("mouseup",o),n.addEventListener("mousemove",o),n.addEventListener("click",o),e},t.prototype.updateControlList=function(e,r,i){for(var n=a.findChildOfType(e,"svg"),s=a.findChildOfType(e,"border"),l=a.findChildOfType(n,"background"),u=a.findChildOfType(n,"itemgroup"),c=(a.findChildOfType(n,"scrollbargroup"),0);c<r.length;c++)switch(r[c]){case"enabled":e.setAttribute(r[c],i[c]);for(var h="true"==i[c],d=a.childElements(u),p=0;p<d.length;p++)t.updateControlListItemLook(d[p],!1,!1);s.setAttribute("class",h?"control-border":"control-border-disabled");break;case"text-array":a.removeAllChildren(u),u.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var f=o.splitSkipEmpty(i[c],"\n"),m=0,g=0;for(p=0;p<f.length;p++){var b=a.cloneElementWithId("list-item");a.findChildOfType(b,"background").setAttribute("fill",l.getAttribute("fill")),(C=a.findChildOfType(b,"text")).firstChild.textContent=f[p],e.hasAttribute("text-color")&&C.setAttribute("fill",e.getAttribute("text-color")),u.appendChild(b);var v=C.getBBox();m<v.width&&(m=v.width),g<v.height&&(g=v.height)}d=a.childElements(u);var y=Math.max(m+4,o.getFloatAttribute(n,"width")),A=Math.max(20,1.35*g);e.setAttribute("item-height",A.toString());for(p=0;p<d.length;p++)this.setupControlListItem(d[p],A*p,y,A,g);t.updateControlListScrollbar(e);break;case"background-color":l.setAttribute("fill",i[c]);break;case"text-color":e.setAttribute(r[c],i[c]);break;case"font-style":e.style.font=i[c];break;case"width":case"height":n.setAttribute(r[c],i[c]),l.setAttribute(r[c],i[c]),s.setAttribute(r[c],i[c]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[c],i[c]);break;case"value":var T=o.splitSkipEmpty(i[c],"\n");d=a.childElements(u),e.setAttribute("last-clicked","0");for(p=0;p<d.length;p++){b=d[p];var C=a.findChildOfType(b,"text"),S=T.indexOf(C.firstChild.textContent)>=0;b.setAttribute("selected",S),t.updateControlListItemLook(b,!1,!1),S&&e.setAttribute("last-clicked",p.toString())}break;default:e.setAttribute(r[c],i[c])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=a.findChildOfType(t,"svg"),i=a.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*o.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=a.findChildOfType(r,"border"),n=a.findChildOfType(r,"svg"),o=a.findChildOfType(n,"itemgroup"),s=a.findChildOfType(n,"scrollbargroup"),l=a.childElements(o);switch(e.type){case"mouseover":if("control-border-hover"!=i.getAttribute("class")){i.setAttribute("class","control-border-hover"),s.setAttribute("class","control-opaque1");for(var u=0;u<l.length;u++)t.updateControlListItemLook(l[u],!0,!1)}break;case"mouseout":if(r.contains(e.relatedTarget))return;i.setAttribute("class","control-border"),s.setAttribute("class","control-opaque0");for(u=0;u<l.length;u++)t.updateControlListItemLook(l[u],!1,!1);break;case"wheel":e.altKey||e.ctrlKey||(e.stopPropagation(),e.preventDefault(),t.scrollControlList(r,e.deltaY<0?1:-1))}}},t.scrollControlList=function(t,e){var r=a.findChildOfType(t,"svg"),i=a.findChildOfType(r,"itemgroup"),n=i.childElementCount;if(0!=n){var s=o.getFloatAttribute(r,"height"),l=o.getFloatAttribute(t,"item-height"),u=n*l,c=i.getAttribute("transform"),h=o.parseTranslateTransform(c)[1];h+=e*l,h=Math.max(-u+s,h),h=Math.min(h,0),h=Math.round(h),i.setAttribute("transform","translate(0,"+h+")");var d=a.findChildOfType(r,"scrollbargroup"),p=a.findChildOfType(d,"handle"),f=o.getFloatAttribute(p,"height"),m=(s/2-h)/u,g=Math.max(2,s*m-f/2);g=Math.min(s-f-2,g),p.setAttribute("y",g.toString())}},t.prototype.setupControlListItem=function(t,e,r,i,n){var s=this,l=a.findChildOfType(t,"background"),u=a.findChildOfType(t,"text");t.setAttribute("transform","translate(0,"+e+")"),o.setMultipleAttributes(l,["width","height"],[r,i]),o.setMultipleAttributes(u,["x","y"],[2,i/2+.3*n]);var c=function(t){return s.onControlListItemMouseEvent(t)};t.addEventListener("mouseover",c),t.addEventListener("mouseout",c),t.addEventListener("click",c)},t.prototype.onControlListItemMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))switch(e.type){case"mouseover":t.updateControlListItemLook(r,!0,!0);break;case"mouseout":t.updateControlListItemLook(r,!0,!1);break;case"click":e.stopPropagation(),e.preventDefault();var s="true"==n.getAttribute("multiple"),l=a.childElements(i),u=o.indexInParent(r),c="true"==r.getAttribute("selected");if(s)if(e.ctrlKey)r.setAttribute("selected",String(!c)),t.updateControlListItemLook(r,!0,!0);else if(e.shiftKey){var h=o.getIntAttribute(n,"last-clicked");for(d=0;d<l.length;d++)c=h<=u?h<=d&&d<=u:u<=d&&d<=h,l[d].setAttribute("selected",c),t.updateControlListItemLook(l[d],!0,d==u)}else for(d=0;d<l.length;d++)l[d].setAttribute("selected",d==u),t.updateControlListItemLook(l[d],!0,d==u);else{c=!e.ctrlKey||!c;for(var d=0;d<l.length;d++)l[d].setAttribute("selected",d==u&&c),t.updateControlListItemLook(l[d],!0,d==u)}n.setAttribute("last-clicked",u.toString());var p="";for(d=0;d<l.length;d++){if("true"==l[d].getAttribute("selected"))p+=a.findChildOfType(l[d],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,p)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=a.findChildOfType(t,"background"),o=a.findChildOfType(t,"text"),s="true"==i.getAttribute("enabled"),l="true"==t.getAttribute("selected");if(!s)return n.setAttribute("class",l?"control-background-selected-disabled":""),void o.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",l?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",l?"control-list-background-selected-hover":""),o.setAttribute("class",l?"control-text-selected-hover":"")):(n.setAttribute("class",l?"control-list-background-selected":""),o.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=a.findChildOfType(e,"svg"),i=a.findChildOfType(r,"scrollbargroup"),n=a.findChildOfType(i,"scrollbar"),s=a.findChildOfType(i,"handle"),l=o.getFloatAttribute(r,"width"),u=o.getFloatAttribute(r,"height"),c=l-o.getFloatAttribute(n,"width");n.setAttribute("x",c.toString()),n.setAttribute("height",u.toString()),s.setAttribute("x",(c+2).toString()),s.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=a.findChildOfType(t,"svg"),i=a.findChildOfType(r,"scrollbargroup"),n=(a.findChildOfType(i,"scrollbar"),a.findChildOfType(i,"handle")),s=o.getFloatAttribute(r,"height"),l=a.findChildOfType(r,"itemgroup").childElementCount,u=0;e=l>0&&s<(u=l*o.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e&&n.setAttribute("height",Math.max(s*(s/u)-4,7).toString())},t.onControlListScrollbarMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode.parentNode;if("false"!=i.getAttribute("enabled")){var n=a.findChildOfType(r,"scrollbar"),s=o.getFloatAttribute(n,"height"),l=n.getBoundingClientRect().height/s,u=o.offsetPage(n),c=(e.pageY-u.top)/l,h=a.findChildOfType(r,"handle"),d=o.getFloatAttribute(h,"y");switch(e.type){case"mouseout":case"mouseup":t.controlListScrollbarButtonDown=0;break;case"mousedown":1==e.which&&e.target==h&&(e.stopPropagation(),t.controlListScrollbarButtonDown=1,t.controlListScrollbarMousePos=c);break;case"mousemove":if(1==t.controlListScrollbarButtonDown){e.stopPropagation();var p=c-t.controlListScrollbarMousePos,f=a.findChildOfType(i,"svg"),m=a.findChildOfType(f,"itemgroup").childElementCount,g=o.getFloatAttribute(i,"item-height"),b=p*(m*g/s)/g;t.scrollControlList(i,-b),t.controlListScrollbarMousePos=c}break;case"click":if(e.stopPropagation(),e.preventDefault(),e.target==n){b=Math.floor(s/o.getFloatAttribute(i,"item-height"));t.scrollControlList(i,c<d?b:-b)}}}},t.controlListScrollbarButtonDown=0,t}(),b=function(){function t(t){this.frameDrawing=t,this.controlList=new g(t,this)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return s.createUnsupportedObject("File chooser is not supported in the Cloud mode");case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":t.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":s.updateUnsupportedObject(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=a.cloneElementWithId("control-button");return new m(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=a.findChildOfType(e,"background"),o=a.findChildOfType(e,"text"),s=0;s<r.length;s++)switch(r[s]){case"enabled":e.setAttribute(r[s],i[s]);var l="true"==i[s];n.setAttribute("class",l?"control-background":"control-background-disabled"),o.setAttribute("class",l?"control-button-text":"control-text-disabled");break;case"text":o.firstChild.textContent=i[s];break;case"background-color":break;case"text-color":o.setAttribute("fill",i[s]);break;case"font-style":o.style.font=i[s],t.centerControlText(o,n,!0,!0);break;case"width":case"height":var u=parseFloat(i[s])-2;n.setAttribute(r[s],u.toString()),t.centerControlText(o,n,!0,!0);break;default:e.setAttribute(r[s],i[s])}},t.onButtonOver=function(t){var e=a.findChildOfType(t,"background"),r=a.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=a.findChildOfType(t,"background"),r=a.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=a.findChildOfType(t,"background"),r=a.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.onControlAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=a.cloneElementWithId("control-checkbox");return new m(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=a.findChildOfType(e,"background"),o=a.findChildOfType(e,"box"),s=a.findChildOfType(e,"check"),l=a.findChildOfType(e,"text"),u=0;u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];o.setAttribute("class",c?"control-checkbox-box":"control-checkbox-box-disabled"),s.setAttribute("class",c?"control-checkbox-check":"control-checkbox-check-disabled"),l.setAttribute("class",c?"":"control-text-disabled");break;case"text":l.firstChild.textContent=i[u];break;case"background-color":n.setAttribute("fill",i[u]);break;case"text-color":l.setAttribute("fill",i[u]);break;case"font-style":l.style.font=i[u],t.centerControlText(l,n,!1,!0);break;case"width":n.setAttribute(r[u],i[u]);break;case"height":n.setAttribute(r[u],i[u]);var h=parseFloat(i[u]);o.setAttribute("y",(h/2-8).toString()),s.setAttribute("transform","translate(0,"+(h/2-8)+")"),t.centerControlText(l,n,!1,!0);break;case"value":s.setAttribute("visibility","true"==i[u]?"inherit":"hidden");break;default:e.setAttribute(r[u],i[u])}},t.onCheckboxOver=function(t){var e=a.findChildOfType(t,"box"),r=a.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=a.findChildOfType(t,"box"),r=a.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=a.findChildOfType(t,"box"),r=a.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=a.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.onControlAction(t.id,r)},t.prototype.createSlider=function(){var t=this,e=a.cloneElementWithId("control-slider"),r=function(e){return t.onSliderEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r),e},t.updateSlider=function(e,r,i){for(var n=a.findChildOfType(e,"sensor"),s=a.findChildOfType(e,"background"),l=a.findChildOfType(e,"line"),u=a.findChildOfType(e,"progress"),c=a.findChildOfType(e,"handle"),h=(a.findChildOfType(e,"value"),0);h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var d="true"==i[h];l.setAttribute("class",d?"control-background":"control-background-disabled"),u.setAttribute("class",d?"control-slider-progress":"control-background-selected-disabled"),c.setAttribute("class",d?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":s.setAttribute("fill",i[h]);break;case"width":case"height":s.setAttribute(r[h],i[h]);break;case"vertical":e.setAttribute(r[h],i[h]);var p=o.getFloatAttribute(s,"width"),f=o.getFloatAttribute(s,"height");o.setMultipleAttributes(n,["x","y","width","height"],[String(-1e3),String(-1e3),String(p+2e3),String(f+2e3)]);var m=void 0,g=void 0,b=void 0,v=void 0,y=void 0,A=void 0,T=void 0,C=void 0,S=void 0,E=void 0;"false"==i[h]?(y=m=0,A=g=f/2-2,b=p,T=0,C=v=4,S=0,E=f/2):(y=m=p/2-2,g=0,A=f,T=b=4,v=f,C=0,S=p/2,E=f),o.setMultipleAttributes(l,["x","y","width","height"],[m,g,b,v]),o.setMultipleAttributes(u,["x","y","width","height"],[y,A,T,C]),o.setMultipleAttributes(c,["cx","cy"],[S,E]);break;case"value":var w=o.getFloatAttribute(e,"min"),k=o.getFloatAttribute(e,"max");p=o.getFloatAttribute(s,"width"),f=o.getFloatAttribute(s,"height");var x="true"==e.getAttribute("vertical")?f:p,M=(parseFloat(i[h])-w)/(k-w)*x;t.setSliderHandlePosition(e,M);break;default:e.setAttribute(r[h],i[h])}},t.prototype.onSliderEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=a.findChildOfType(r,"background"),n=a.findChildOfType(r,"progress"),s=o.getFloatAttribute(i,"width"),l=o.getFloatAttribute(i,"height"),u=i.getBoundingClientRect(),c=u.width/s,h=u.height/l,d=o.offsetPage(i),p="true"==r.getAttribute("vertical");if(e.type.startsWith("mouse")||"wheel"==e.type){var f=e,m=(f.pageX-d.left)/c,g=(f.pageY-d.top)/h,b=p?l-g:m;switch(e.type){case"mouseover":e.stopPropagation(),t.onSliderOver(r);break;case"mouseout":if(r.contains(f.relatedTarget))return;1==t.sliderButtonDown&&(t.setSliderHandlePosition(r,b),this.confirmSliderValue(r)),t.sliderButtonDown=0,t.onSliderOut(r);break;case"mousedown":t.sliderButtonDown=f.which,1==t.sliderButtonDown&&(e.stopPropagation(),t.onSliderHandleGrabbed(r,b));break;case"mousemove":1==t.sliderButtonDown&&(e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,b));break;case"mouseup":1==t.sliderButtonDown&&(e.stopPropagation(),this.onSliderHandleReleased(r)),t.sliderButtonDown=0;break;case"wheel":if(!f.altKey&&!f.ctrlKey){var v=e;e.stopPropagation(),e.preventDefault();var y=o.getFloatAttribute(n,p?"height":"width");t.setSliderHandlePosition(r,y+(v.deltaY<0?1:-1)),this.confirmSliderValue(r)}}}else if(e.type.startsWith("touch")){var A=e;if(A.touches.length>1)return void this.onSliderHandleReleased(r);var T="touchend"==e.type?A.changedTouches[0]:A.touches[0];m=void 0,g=void 0;m=(T.pageX-d.left)/c,g=(T.pageY-d.top)/h;b=p?l-g:m;switch(e.type){case"touchstart":e.stopPropagation(),t.onSliderOver(r),t.onSliderHandleGrabbed(r,b);break;case"touchmove":e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,b);break;case"touchend":e.stopPropagation(),this.onSliderHandleReleased(r),t.onSliderOut(r)}}}},t.onSliderOver=function(e){var r=a.findChildOfType(e,"line"),i=a.findChildOfType(e,"progress"),n=a.findChildOfType(e,"handle"),o=a.findChildOfType(e,"value");r.setAttribute("class","control-slider-line-hover"),i.setAttribute("class","control-fill-color-transition"),n.setAttribute("class",1==t.sliderButtonDown?"control-slider-handle-pressed":"control-slider-handle-hover"),o.setAttribute("class","control-opaque1")},t.onSliderOut=function(t){var e=a.findChildOfType(t,"sensor"),r=a.findChildOfType(t,"line"),i=a.findChildOfType(t,"progress"),n=a.findChildOfType(t,"handle"),o=a.findChildOfType(t,"value");e.setAttribute("visibility","hidden"),r.setAttribute("class","control-background"),i.setAttribute("class","control-slider-progress"),n.setAttribute("r","8"),n.setAttribute("class","control-slider-handle"),o.setAttribute("class","control-opaque0")},t.onSliderHandleGrabbed=function(e,r){var i=a.findChildOfType(e,"sensor"),n=a.findChildOfType(e,"handle");a.bringElementToFront(e),n.setAttribute("r","7"),n.setAttribute("class","control-slider-handle-pressed"),i.setAttribute("visibility","inherit"),t.setSliderHandlePosition(e,r)},t.prototype.onSliderHandleReleased=function(t){var e=a.findChildOfType(t,"sensor"),r=a.findChildOfType(t,"handle");r.setAttribute("r","8"),r.setAttribute("class","control-slider-handle-hover"),e.setAttribute("visibility","hidden"),this.confirmSliderValue(t)},t.setSliderHandlePosition=function(t,e){var r=a.findChildOfType(t,"background"),i=a.findChildOfType(t,"progress"),n=a.findChildOfType(t,"handle"),s=a.findChildOfType(t,"value"),l=o.getFloatAttribute(r,"width"),u=o.getFloatAttribute(r,"height"),c="true"==t.getAttribute("vertical"),h=c?u:l;e=Math.min(h,Math.max(e,0));var d,p=o.getFloatAttribute(t,"min"),f=o.getFloatAttribute(t,"max"),m=o.getFloatAttribute(t,"step");d=m>0?p+Math.round(e/h*(f-p)/m)*m:p+e/h*(f-p),e=((d=Math.min(d,f))-p)/(f-p)*h,c?(i.setAttribute("y",(h-e).toString()),i.setAttribute("height",e.toString()),n.setAttribute("cy",(h-e).toString())):(i.setAttribute("width",e.toString()),n.setAttribute("cx",e.toString()));var g=s.firstElementChild,b=s.lastElementChild;b.firstChild.textContent=o.formatNumber(d,void 0);var v=b.getComputedTextLength()+10;g.setAttribute("width",v.toString()),g.setAttribute("x",(5-v).toString());var y=c?l/2-9:e-14,A=c?u-e-15-10:u/2-15-4;s.setAttribute("transform","translate("+y+","+A+")"),t.setAttribute("current-value",d)},t.prototype.confirmSliderValue=function(t){var e=o.getFloatAttribute(t,"current-value");e!=o.getFloatAttribute(t,"last-value")&&(this.frameDrawing.onControlAction(t.id,e),t.setAttribute("last-value",e.toString()))},t.createRadioButtonGroup=function(){return a.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,s=0;s<r.length;s++)switch(r[s]){case"enabled":e.setAttribute(r[s],i[s]);for(var l="true"==i[s],u=a.childElements(e),c=0;c<u.length;c++){var h=u[c],d=a.findChildOfType(h,"circle"),p=a.findChildOfType(h,"check"),f=a.findChildOfType(h,"text");d.setAttribute("class",l?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),p.setAttribute("class",l?"control-radiobutton-check":"control-text-disabled"),f.setAttribute("class",l?"":"control-text-disabled")}break;case"text-array":var g=i[s].split("\n"),b=function(r){var i=a.cloneElementWithId("radio-button"),o=a.findChildOfType(i,"background");e.hasAttribute("background-color")&&o.setAttribute("fill",e.getAttribute("background-color"));var s=a.findChildOfType(i,"text");s.firstChild.textContent=g[r],e.hasAttribute("text-color")&&s.setAttribute("fill",e.getAttribute("text-color")),new m(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(c=0;c<g.length;c++)b(c);break;case"background-color":case"text-color":e.setAttribute(r[s],i[s]);break;case"font-style":e.style.font=i[s];break;case"width":case"height":e.setAttribute(r[s],i[s]);break;case"vertical":var v=o.getFloatAttribute(e,"width"),y=o.getFloatAttribute(e,"height"),A=0;u=a.childElements(e);for(c=0;c<u.length;c++){h=u[c];var T=a.findChildOfType(h,"background"),C=(f=a.findChildOfType(h,"text")).getBBox();if("true"==i[s]){var S=Math.max(25,1.5*C.height);h.setAttribute("transform","translate(0,"+S*c+")"),o.setMultipleAttributes(T,["width","height"],[v,S])}else{var E=20+C.width+10;h.setAttribute("transform","translate("+A+",0)"),o.setMultipleAttributes(T,["width","height"],[E,y]),A+=E}t.centerRadioButton(h)}break;case"value":var w=parseInt(i[s]);u=a.childElements(e);for(c=0;c<u.length;c++){h=u[c];(p=a.findChildOfType(h,"check")).setAttribute("visibility",w==c?"inherit":"hidden")}break;default:e.setAttribute(r[s],i[s])}},t.onRadioButtonOver=function(t){var e=a.findChildOfType(t,"circle"),r=a.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=a.findChildOfType(t,"circle"),r=a.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=a.findChildOfType(t,"circle"),r=a.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=a.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=a.childElements(r),n=0;n<i.length;n++){var o=i[n];a.findChildOfType(o,"check").setAttribute("visibility",o==t?"inherit":"hidden"),o==t&&(e=n)}this.frameDrawing.onControlAction(r.id,e)}},t.centerRadioButton=function(e){var r=a.findChildOfType(e,"background"),i=a.findChildOfType(e,"circle"),n=a.findChildOfType(e,"check"),s=a.findChildOfType(e,"text"),l=o.getFloatAttribute(r,"height");i.setAttribute("cy",(l/2).toString()),n.setAttribute("cy",(l/2).toString()),t.centerControlText(s,r,!1,!0)},t.createListBox=function(){return g.createControlList()},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var t=this,e=a.cloneElementWithId("control-combobox"),r=function(e){return t.onComboBoxEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("click",r);var i=g.createControlList();return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),e.appendChild(i),e},t.prototype.updateComboBox=function(e,r,i){for(var n=a.findChildOfType(e,"svg"),s=a.findChildOfType(e,"border"),l=a.findChildOfType(e,"dropdown"),u=a.findChildOfType(n,"background"),c=a.findChildOfType(n,"text"),h=a.findChildOfType(n,"arrowback"),d=a.findChildOfType(n,"arrow"),p=0;p<r.length;p++)switch(r[p]){case"enabled":e.setAttribute(r[p],i[p]);var f="true"==i[p];c.setAttribute("class",f?"":"control-text-disabled"),s.setAttribute("class",f?"control-border":"control-border-disabled"),f||l.setAttribute("visibility","hidden"),this.controlList.updateControlList(l,[r[p]],[i[p]]);break;case"text-array":var m=o.splitSkipEmpty(i[p],"\n"),g=m.length>0?m[0]:"";c.firstChild.textContent=g,this.controlList.updateControlList(l,[r[p]],[i[p]]),this.controlList.adjustControlListHeightToItems(l,5),this.controlList.updateControlList(l,["value"],[g]);break;case"background-color":u.setAttribute("fill",i[p]),this.controlList.updateControlList(l,[r[p]],[i[p]]);break;case"text-color":c.setAttribute("fill",i[p]),this.controlList.updateControlList(l,[r[p]],[i[p]]);break;case"font-style":e.style.font=i[p],t.centerControlText(c,u,!1,!0),this.controlList.updateControlList(l,[r[p]],[i[p]]);break;case"width":case"height":var b=parseFloat(i[p]);if(n.setAttribute(r[p],i[p]),u.setAttribute(r[p],i[p]),s.setAttribute(r[p],i[p]),"width"==r[p])h.setAttribute("x",(b-20).toString()),this.controlList.updateControlList(l,[r[p]],[i[p]]);else{t.centerControlText(c,u,!1,!0),h.setAttribute("height",b.toString()),l.setAttribute("transform","translate(0,"+i[p]+")");var v=5*parseFloat(i[p]);this.controlList.updateControlList(l,["height"],[v.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var y=o.getFloatAttribute(n,"width")-10,A=o.getFloatAttribute(n,"height")/2;d.setAttribute("transform","translate("+y+","+A+")")}break;case"editable":e.setAttribute(r[p],i[p]);break;case"value":c.firstChild.textContent=i[p],this.controlList.updateControlList(l,[r[p]],[i[p]]);break;default:e.setAttribute(r[p],i[p])}},t.prototype.onComboBoxEvent=function(t){var e=t.currentTarget;if("false"!=e.getAttribute("enabled")){var r=a.findChildOfType(e,"svg"),i=a.findChildOfType(e,"border"),n=a.findChildOfType(e,"dropdown"),o=a.findChildOfType(r,"background"),s=a.findChildOfType(r,"text"),l=a.findChildOfType(r,"arrowback"),u=a.findChildOfType(r,"arrow"),c="true"==e.getAttribute("editable");switch(t.type){case"mouseover":i.setAttribute("class","control-border-hover"),l.setAttribute("class","control-combobox-arrow-background-hover"),u.setAttribute("class","control-fill-color-transition");break;case"mouseout":if(e.contains(t.relatedTarget))return;i.setAttribute("class","control-border"),l.setAttribute("class","control-fill-transparent-transition"),u.setAttribute("class","control-fill-transparent-transition"),n.setAttribute("visibility","hidden");break;case"mousedown":1!=t.which||!c||t.target!=o&&t.target!=s||(t.stopPropagation(),this.displayTextInputForSVG(e,"left"));break;case"click":if(!c||t.target==l||t.target==u){t.stopPropagation(),t.preventDefault(),a.bringElementToFront(e);var h="inherit"==n.getAttribute("visibility");n.setAttribute("visibility",h?"hidden":"inherit")}}}},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=a.findChildOfType(t,"svg"),i=a.findChildOfType(t,"dropdown"),n=a.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var o=e.split("\n")[0];n.firstChild.textContent=o,this.frameDrawing.onControlAction(t.id,o)},t.prototype.createTextField=function(){var e=this,r=a.cloneElementWithId("control-textfield");return new m(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r)},function(t){return e.onTextFieldDown(r)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=a.findChildOfType(e,"svg"),o=a.findChildOfType(e,"border"),s=a.findChildOfType(n,"background"),l=a.findChildOfType(n,"text"),u=0;u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];l.setAttribute("class",c?"":"control-text-disabled"),o.setAttribute("class",c?"control-border":"control-border-disabled");break;case"background-color":s.setAttribute("fill",i[u]);break;case"text-color":l.setAttribute("fill",i[u]);break;case"font-style":e.style.font=i[u],t.centerControlText(l,s,!1,!0);break;case"width":case"height":n.setAttribute(r[u],i[u]),s.setAttribute(r[u],i[u]),o.setAttribute(r[u],i[u]),"width"==r[u]&&l.setAttribute("x",(parseFloat(i[u])-2).toString()),t.centerControlText(l,s,!1,!0);break;case"value":l.firstChild.textContent=i[u];break;default:e.setAttribute(r[u],i[u])}},t.onTextFieldOver=function(t){a.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){a.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t){this.displayTextInputForSVG(t,"right")},t.createProgressBar=function(){return a.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,s=a.findChildOfType(n,"background"),l=a.findChildOfType(n,"progress"),u=a.findChildOfType(n,"text"),c=a.findChildOfType(n,"border"),h=0;h<r.length;h++)switch(r[h]){case"background-color":s.setAttribute("fill",i[h]);break;case"text-color":u.setAttribute("fill",i[h]);break;case"font-style":e.style.font=i[h],t.centerControlText(u,s,!1,!0);break;case"width":case"height":e.setAttribute(r[h],i[h]);break;case"vertical":var d="true"==i[h],p=e.getAttribute(d?"height":"width"),f=e.getAttribute(d?"width":"height");s.setAttribute("width",p),s.setAttribute("height",f),l.setAttribute("height",f),t.centerControlText(u,s,!0,!0),c.setAttribute("width",p),c.setAttribute("height",f),d&&n.setAttribute("transform","translate(0,"+p+") rotate(-90)");break;case"text":u.firstChild.textContent="null"==i[h]?"":i[h];break;case"value":var m=o.getFloatAttribute(s,"width");"null"==i[h]?(l.setAttribute("class","control-progressbar-indeterminate"),l.setAttribute("width",m.toString())):(l.setAttribute("class","control-slider-progress"),l.setAttribute("width",(parseFloat(i[h])*m).toString()));break;default:e.setAttribute(r[h],i[h])}},t.prototype.displayTextInputForSVG=function(t,e){var r=this,i=a.findChildOfType(t,"svg"),n=a.findChildOfType(i,"text"),s=document.getElementById("text-input-for-svg-container");s.style.display="block";var l=i.getBoundingClientRect(),u=o.getFloatAttribute(i,"width"),c=o.getFloatAttribute(i,"height"),h=l.width/u,d=s.firstElementChild;d.style.left=l.left+"px",d.style.top=l.top+"px",d.style.width=u+"px",d.style.height=c+"px",d.style.transform="scale("+h+")",d.style.font=t.style.font,d.style.textAlign=e,d.value=n.firstChild.textContent,s.setAttribute("control-id",t.id);var p=function(t){return r.onTextInputForSVGEvent(t)};s.onmousedown=p,s.onwheel=p,s.onkeypress=p,s.ontouchstart=p,window.setTimeout(function(){d.focus(),d.select()},0)},t.prototype.onTextInputForSVGEvent=function(t){var e=t.currentTarget,r=e.firstElementChild,i=e.getAttribute("control-id"),n=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=r&&(n=!0);break;case"wheel":n=!0;break;case"keypress":"Enter"==t.code&&(n=!0)}n&&(e.style.display="none",this.onTextInputForSVGChanged(i,r.value))},t.prototype.onTextInputForSVGChanged=function(t,e){var r=document.getElementById(t),i=a.findChildOfType(r,"svg");if(a.findChildOfType(i,"text").firstChild.textContent=e,this.frameDrawing.onControlAction(t,e),"ControlComboBox"==r.getAttribute("type")){var n=a.findChildOfType(r,"dropdown");this.controlList.updateControlList(n,["value"],[e])}},t.centerControlText=function(t,e,r,i){var n=o.getFloatAttribute(e,"width"),a=o.getFloatAttribute(e,"height"),s=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*s.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.onControlAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t.sliderButtonDown=0,t}(),v=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){for(var e=a.findChildOfType(t,"picture"),r=a.findChildOfType(t,"pictureback"),i=a.childElements(a.findChildOfType(t,"legend")),n=i.length,s="true"==t.getAttribute("show-pdf"),l="true"==t.getAttribute("show-cdf"),u="true"==t.getAttribute("show-mean"),c=(o.getFloatAttribute(r,"x"),o.getFloatAttribute(r,"y")),h=(o.getFloatAttribute(r,"width"),o.getFloatAttribute(r,"height")),d=0;d<n;d++){var p=a.createSvgElement("g");if(s){var f=a.createSvgElement("g");p.appendChild(f)}if(l){var m=a.createSvgElement("polyline");o.setMultipleAttributes(m,["fill","stroke-width","stroke"],["none",i[d].getAttribute("cdf-line-width"),i[d].getAttribute("cdf-color")]),p.appendChild(m)}if(u){var g=a.createSvgElement("line");o.setMultipleAttributes(g,["stroke-width","stroke","y1","y2"],[i[d].getAttribute("cdf-line-width"),i[d].getAttribute("mean-color"),c.toString(),(c+h).toString()]),p.appendChild(g)}e.appendChild(p),E.addClickTapHandlerToChartItem(p)}},t.prototype.draw=function(t,e){for(var r=a.findChildOfType(t,"pictureback"),i=a.findChildOfType(t,"picture"),n=a.findChildOfType(t,"grid"),s=a.childElements(a.findChildOfType(t,"legend")),l="true"==t.getAttribute("show-pdf"),u="true"==t.getAttribute("show-cdf"),c="true"==t.getAttribute("show-mean"),h=o.getFloatAttribute(t,"bar-width"),d=o.getFloatAttribute(r,"x"),p=o.getFloatAttribute(r,"y"),f=o.getFloatAttribute(r,"width"),m=o.getFloatAttribute(r,"height"),g=o.splitSkipEmpty(e," "),b=g.length,v=1/0,y=-1/0,A=1/0,T=-1/0,C=[],S=[],w=[],k=[],x=[],M=[],O=[],I=[],_=[],L=0;L<b;L++)if("empty"!=g[L]){g[L]=o.splitSkipEmpty(g[L],":"),C[L]="true"==g[L][0],S[L]="true"==g[L][1],w[L]=parseFloat(g[L][2]),k[L]=parseFloat(g[L][3]),x[L]=parseFloat(g[L][4]),M[L]=parseInt(g[L][5]),O[L]=parseInt(g[L][6]),I[L]=o.splitToFloats(g[L][7],"|");for(var P=0;P<I[L].length;P++)I[L][P]<A&&(A=I[L][P]),T<I[L][P]&&(T=I[L][P]);C[L]&&(_[L]=o.splitToFloats(g[L][8],"|")),w[L]<v&&(v=w[L]),y<k[L]&&(y=k[L])}v==1/0&&(v=0,y=0),A==1/0&&(A=0,T=1),this.chartScaleAndGrid.recalcChartScale(t,v,y,!1,!1),this.chartScaleAndGrid.recalcChartScale(t,0,T,!0,!1);var R=o.getFloatAttribute(n,"min-x"),F=o.getFloatAttribute(n,"max-x"),D=o.getFloatAttribute(n,"min-y"),N=o.getFloatAttribute(n,"max-y"),B=f/(F-R),G=m/(N-D),U=a.childElements(i);for(L=0;L<b;L++)if("empty"!=g[L]){"hidden"==U[L].getAttribute("visibility")&&U[L].setAttribute("visibility","inherit");var H=I[L].length,z=(k[L]-w[L])/H,W=s[L].getAttribute("original-color"),V=void 0,Y=void 0;if(S[L]&&(V=s[L].getAttribute("low-color"),Y=s[L].getAttribute("high-color")),l){var j=U[L].firstElementChild,X=h*z*B,q=z*(1-h)/2;for(P=0;P<H;P++){var Z=d+(w[L]+P*z+q-R)*B,K=p+(N-I[L][P])*G,Q=I[L][P]*G,J=a.childElements(j)[P];J?J.setAttribute("visibility","inherit"):(J=a.createSvgElement("rect"),j.appendChild(J)),o.setMultipleAttributes(J,["x","y","width","height"],[o.reducePrecision(Z),o.reducePrecision(K),o.reducePrecision(X),o.reducePrecision(Q)]),C[L]&&S[L]&&P<M[L]?J.setAttribute("fill",V):C[L]&&S[L]&&O[L]<P?J.setAttribute("fill",Y):J.setAttribute("fill",W)}var $=a.childElements(j);for(P=H;P<$.length;P++)$[P].setAttribute("visibility","hidden")}if(u){var tt=l?U[L].firstElementChild.nextElementSibling:U[L].firstElementChild,et="";if(et+=d+(w[L]-R)*B+" "+(p+m)+" ",C[L])for(P=0;P<H;P++){et+=o.reducePrecision(d+(w[L]+(P+1)*z-R)*B)+","+o.reducePrecision(p+(1-_[L][P])*m)+" "}tt.setAttribute("points",et)}if(c){var rt=U[L].lastElementChild,it=d+(x[L]-R)*B;rt.setAttribute("x1",it),rt.setAttribute("x2",it)}if("NONE"!=t.getAttribute("leg-pos")){var nt=a.findChildOfType(s[L],"value");nt.firstChild.textContent=o.formatNumber(x[L],void 0),nt.setAttribute("fill",s[L].getAttribute("mean-color"))}}else U[L].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&E.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=a.findChildOfType(t,"picture"),o=a.childElements(n),s=a.childElements(o[e]),l=0;l<s.length;l++)s[l].setAttribute("visibility",r?"hidden":"inherit")},t}(),y=function(){function t(t){this.frameDrawing=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),s=a.findChildOfType(t,"grid"),l=a.findChildOfType(t,"pictureback"),u=a.findChildOfType(t,e?"pictureborderh":"pictureborderw"),c=s.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=c){var h=o.getFloatAttribute(l,"x"),d=o.getFloatAttribute(l,"y"),p=o.getFloatAttribute(l,"width"),f=o.getFloatAttribute(l,"height"),m="GRID_DEFAULT"==c,g="ChartBar"==r||"ChartStack"==r,b=t.getAttribute("bar-dir");e?g&&(!g||"NORTH"!=b&&"SOUTH"!=b)||o.setMultipleAttributes(u,["x1","y1","x2","y2"],m?[h,d,h,d+f]:[h+p,d,h+p,d+f]):g&&(!g||"EAST"!=b&&"WEST"!=b)||o.setMultipleAttributes(u,["x1","y1","x2","y2"],m?[h,d+f,h+p,d+f]:[h,d,h+p,d])}var v=s.getAttribute("grid-line-color");switch(s.setAttribute("grid-line-color",o.increaseTransparency(v,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var y=o.getFloatAttribute(t,"scale-min-"+i),A=o.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(y="ChartStack"==r?0:Math.min(0,y),A=Math.max(0,A)),this.recalcChartScale(t,y,A,e,!0);break;case"SCALE_TIME_WINDOW":A=Math.max(0,o.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,A,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var s=a.findChildOfType(t,"grid"),l=i?"min-y":"min-x",u=i?"max-y":"max-x";if(e!=o.getFloatAttribute(s,l)||r!=o.getFloatAttribute(s,u)){var c=e,h=r;if(c==h){if(n)return;c-=1,h+=1}var d=a.findChildOfType(t,"pictureback"),p=o.getFloatAttribute(d,i?"height":"width"),f=i?25:45,m=(h-c)/Math.floor(p/f),g=Math.pow(10,Math.ceil(Math.log(h-c)/Math.log(10))-1),b=g/5;b<m&&(b=g/2)<m&&(b=g)<m&&(b=2*g)<m&&(b=5*g),n?(c=Math.ceil(c/b)*b,h=Math.floor(h/b)*b):(c=Math.floor(c/b)*b,h=Math.ceil(h/b)*b);var v=n?e:c,y=n?r:h;o.setMultipleAttributes(s,[l,u],[v,y]),this.drawChartGrid(t,c,h,b,v,y,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,s,l){var u=t.getAttribute("type"),c=a.findChildOfType(t,"grid"),h=c.getAttribute(l?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=h){var d=l?c.lastElementChild:c.firstElementChild,p=a.findChildOfType(t,"pictureback"),f=c.getAttribute("grid-text-color"),m=c.getAttribute("grid-line-color"),g=l?"scale-type-y":"scale-type-x",b="SCALE_100_PERCENT"==t.getAttribute(g),v="SCALE_TIME_WINDOW"==t.getAttribute(g)?t.getAttribute("date-format-pattern"):"null",y=Math.round((r-e)/i)+1,A="GRID_DEFAULT"==h,T=!0;if("ChartBar"==u||"ChartStack"==u){var C=t.getAttribute("bar-dir");"SOUTH"!=C&&"WEST"!=C||(T=!1)}for(var S=o.getFloatAttribute(p,"x"),E=o.getFloatAttribute(p,"y"),w=o.getFloatAttribute(p,"width"),k=o.getFloatAttribute(p,"height"),x=s-n,M=(l?k:w)/x,O=i*M;d.childElementCount<y;){var I=a.cloneElementWithId("grid-item");d.appendChild(I)}for(var _=a.childElements(d),L=e,P=l?T?E+(s-e)*M:E+(e-n)*M:T?S+(e-n)*M:S+(s-e)*M,R=0;R<y;R++){var F=l?A?S-4:S:P,D=l?P:A?E+k+4:E+k,N=l?A?S+w:S+w+4:P,B=l?P:A?E:E-4,G=l?A?F-3:N+3:F,U=l?D+3:A?D+11:B-3,H=l?A?"end":"start":"middle";(I=_[R]).setAttribute("visibility","inherit");var z=I.lastElementChild;o.setMultipleAttributes(z,["x1","x2","y1","y2","stroke"],[F,N,D,B,m]);var W=I.firstElementChild;o.setMultipleAttributes(W,["x","y","text-anchor","fill"],[G,U,H,f]);var V=void 0;V=b?o.formatPercent(L):"null"!=v?this.gridFormattedDate(L,x,v):o.formatNumber(L,void 0),W.firstChild.textContent=V,L+=i,P+=l?T?-O:+O:T?+O:-O}for(R=y;R<_.length;R++)_[R].setAttribute("visibility","hidden")}},t.prototype.gridFormattedDate=function(t,e,r){var i=o.toDate(this.frameDrawing,t),n=o.toMilliseconds(this.frameDrawing,e);return n>5*o.YEAR?o.formatDate(i,"YYYY"):n>5*o.MONTH?o.formatDate(i,"MMMYYYY"):n>5*o.DAY?o.formatDate(i,"DDMMM"):n>5*o.HOUR?o.formatDate(i,"DDMMHH"):n>5*o.MINUTE?o.formatDate(i,"HHmm"):o.formatDate(i,"mmss")},t}(),A=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e,r,i=t.getAttribute("type"),n=a.findChildOfType(t,"pictureback"),s=a.findChildOfType(t,"picture"),l=a.childElements(a.findChildOfType(t,"legend")),u=l.length,c=o.getFloatAttribute(n,"x"),h=o.getFloatAttribute(n,"y"),d=o.getFloatAttribute(n,"width"),p=o.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var f=t.getAttribute("bar-dir");e="NORTH"==f||"SOUTH"==f;var m=o.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?d/u:p/u)*m:(e?d:p)*m}for(var g=0;g<u;g++){var b=void 0,v=l[g].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(b=a.createSvgElement("rect")).setAttribute("stroke","none"),b.setAttribute("fill",v);var y=void 0;e?(y=d/u,b.setAttribute("x","ChartBar"==i?c+y*g+(y-r)/2:c+(d-r)/2),b.setAttribute("width",r)):(y=p/u,b.setAttribute("y","ChartBar"==i?h+y*g+(y-r)/2:h+(p-r)/2),b.setAttribute("height",r)),s.appendChild(b);break;case"ChartPie":(b=a.createSvgElement("path")).setAttribute("stroke","none"),b.setAttribute("fill",v),s.appendChild(b)}E.addClickTapHandlerToChartItem(b)}},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=a.findChildOfType(t,"pictureback"),n=a.findChildOfType(t,"picture"),s=a.childElements(n),l=a.findChildOfType(t,"grid"),u=o.getFloatAttribute(i,"x"),c=o.getFloatAttribute(i,"y"),h=o.getFloatAttribute(i,"width"),d=o.getFloatAttribute(i,"height"),p=o.splitSkipEmpty(e," "),f=p.length,m=1/0,g=-1/0,b=!1,v=0,y=0;y<f;y++)p[y]=parseFloat(p[y]),p[y]<m&&(m=p[y]),g<p[y]&&(g=p[y]),p[y]<0&&(b=!0),v+=p[y];var A=!1;if("ChartBar"==r||"ChartStack"==r){var T=t.getAttribute("bar-dir"),C="NORTH"==T||"SOUTH"==T;"ChartBar"==r?(m=Math.min(0,m),g=Math.max(0,g)):(m=0,g=Math.max(0,v));var S=t.getAttribute(C?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=S&&"SCALE_AUTO_FROM_0"!=S||this.chartScaleAndGrid.recalcChartScale(t,m,g,C,!1),A="SCALE_100_PERCENT"==S;var w=o.getFloatAttribute(l,C?"min-y":"min-x"),k=o.getFloatAttribute(l,C?"max-y":"max-x"),x=(C?d:h)/(k-w),M=0;for(y=0;y<f;y++)if("ChartStack"==r&&(b||0==v)||"ChartBar"==r&&A&&(b||0==v))s[y].setAttribute(C?"height":"width",0);else{var O=A?p[y]/v:p[y],I=Math.abs(O),_=void 0;if("ChartBar"==r)switch(T){case"NORTH":case"WEST":_=O>0?k-O:k;break;case"SOUTH":case"EAST":_=O<0?O-w:-w}else{switch(T){case"NORTH":case"WEST":_=k-(O+M);break;case"SOUTH":case"EAST":_=-w+M}M+=O}I*=x;var L=C?d:h;(_*=x)<0?(I-=-_,_=0):_+I>L&&(I-=_+I-L),I<0&&(I=0),C?(s[y].setAttribute("y",c+_),s[y].setAttribute("height",I)):(s[y].setAttribute("x",u+_),s[y].setAttribute("width",I))}}else{var P=-Math.PI/2;for(y=0;y<f;y++){var R=v<=0||b?0:2*Math.PI*(p[y]/v),F=h/2,D=d/2,N=o.sectorData(u+F,c+D,F,D,P,R);s[y].setAttribute("d",N),P+=R}}if(("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&A)&&b?E.showChartWarning(t,"Neg!"):E.hideChartWarning(t),"NONE"!=t.getAttribute("leg-pos")){var B=a.childElements(a.findChildOfType(t,"legend"));for(y=0;y<f;y++){var G=a.findChildOfType(B[y],"value"),U=o.formatNumber(p[y],void 0);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&A)&&v>0&&!b&&(U+=" ("+o.formatPercent(p[y]/v)+")"),G.firstChild.textContent=U,G.setAttribute("fill",p[y]>=0?"royalBlue":"fireBrick")}E.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){a.childElements(a.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t}(),T=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(e){for(var r=e.getAttribute("type"),i=a.findChildOfType(e,"picture"),n=a.childElements(a.findChildOfType(e,"legend")),s=n.length,l=0;l<s;l++){var u=n[l].getAttribute("original-color"),c=a.createSvgElement("g");switch(r){case"ChartPlot":case"ChartTimePlot":if("true"==n[l].getAttribute("draw-line")){var h=a.createSvgElement("polyline");if(h.setAttribute("fill","none"),h.setAttribute("stroke",u),h.setAttribute("stroke-width",n[l].getAttribute("line-width")),c.appendChild(h),"ChartTimePlot"==r){var d=a.createSvgElement("polyline");d.setAttribute("stroke","none"),d.setAttribute("fill",o.increaseTransparency(u,t.timePlotAlpha)),c.appendChild(d)}}if("POINT_NONE"!=n[l].getAttribute("point-style")){var p=a.createSvgElement("g");p.setAttribute("fill",u),c.appendChild(p)}break;case"ChartTimeStack":var f=a.createSvgElement("polyline");f.setAttribute("stroke-width","1"),f.setAttribute("stroke",u),f.setAttribute("fill","none"),c.appendChild(f);var m=a.createSvgElement("polyline");m.setAttribute("stroke","none"),m.setAttribute("fill",o.increaseTransparency(u,t.stackChartAlpha)),c.appendChild(m)}i.appendChild(c),E.addClickTapHandlerToChartItem(c)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=a.findChildOfType(e,"pictureback"),s=a.findChildOfType(e,"picture"),l=a.findChildOfType(e,"grid"),u=a.childElements(a.findChildOfType(e,"legend")),c=o.getFloatAttribute(n,"x"),h=o.getFloatAttribute(n,"y"),d=o.getFloatAttribute(n,"width"),p=o.getFloatAttribute(n,"height"),f=h+p,m=t.parseDataAndFindMinMax(r),g=m.datasets,b=g.length,v=m.minx,y=m.maxx,A=m.miny,T=m.maxy;if("ChartTimeStack"==i&&A<0)E.showChartWarning(e,"Neg!");else{E.hideChartWarning(e),"ChartTimeStack"==i&&(A=0,T=t.prepareChartTimeStackData(g));var C,S=e.getAttribute("scale-type-x"),w=e.getAttribute("scale-type-y"),k="SCALE_100_PERCENT"==w;if("SCALE_AUTO"==S)this.chartScaleAndGrid.recalcChartScale(e,v,y,!1,!1);else if("SCALE_TIME_WINDOW"==S){C=o.getFloatAttribute(e,"scale-max-x");var x=void 0;x="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(y,C):Math.max(y,C,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,x-C,x,!1,!0)}"SCALE_AUTO"==w&&this.chartScaleAndGrid.recalcChartScale(e,A,T,!0,!1);for(var M=o.getFloatAttribute(l,"min-x"),O=o.getFloatAttribute(l,"max-x"),I=o.getFloatAttribute(l,"min-y"),_=o.getFloatAttribute(l,"max-y"),L=d/(O-M),P=p/(_-I),R=a.childElements(s),F="",D=0;D<b;D++){var N=void 0,B=void 0,G=void 0,U=void 0,H=void 0,z=void 0,W=void 0,V=void 0,Y=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(N="true"==u[D].getAttribute("draw-line"),B=u[D].getAttribute("point-style"),G="INTERPOLATION_STEP"==u[D].getAttribute("interpolation")),(N||"ChartTimeStack"==i)&&(H=(U=R[D].firstElementChild).nextElementSibling),B&&"POINT_NONE"!=B)switch(z=R[D].lastElementChild,B){case"POINT_CIRCLE":W="plot-point-circle",V=0,Y=0;break;case"POINT_SQUARE":W="plot-point-square",V=-1.5,Y=-1.5;break;case"POINT_TRIANGLE":W="plot-point-triangle",V=0,Y=0}for(var j=void 0,X=void 0,q="",Z="",K=void 0,Q=void 0,J=0,$=0;$<g[D].length;$++){var tt=c+(g[D][$][0]-M)*L,et=h+(-(k?g[D][$][1]/g[b-1][$][1]:g[D][$][1])+_)*P;if(tt<c&&(tt=c),c+d<tt&&(tt=c+d),et<h&&(et=h),h+p<et&&(et=h+p),!(null!=j&&Math.abs(tt-j)<E.chartTolerance&&Math.abs(et-X)<E.chartTolerance)){if(tt=o.reducePrecision(tt),et=o.reducePrecision(et),0==$&&(K=tt),Q=tt,U&&(G&&null!=j&&(q+=tt+","+X+" "),q+=tt+","+et+" ",H&&(0==D&&(F=tt+","+f+" "+F),Z=tt+","+et+" "+Z)),z){var rt=a.childElements(z)[J];rt?rt.setAttribute("visibility","inherit"):(rt=a.createUseElement(W),z.appendChild(rt)),rt.setAttribute("x",V+tt),rt.setAttribute("y",Y+et)}J++,j=tt,X=et}}if(U&&(U.setAttribute("points",q),H))if("ChartTimePlot"==i){var it="";if(""!=q){var nt=h+_*P;nt<h&&(nt=h),h+p<nt&&(nt=h+p),it=Q+","+nt+" "+K+","+nt}H.setAttribute("points",q+it)}else H.setAttribute("points",q+F),F=Z;if(z){var at=a.childElements(z);for($=J;$<at.length;$++)at[$].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var s=e.getAttribute("type"),l=a.childElements(a.findChildOfType(e,"legend")),u=a.childElements(a.findChildOfType(e,"picture"));if("ChartTimeStack"==s)u[r].firstElementChild.setAttribute("stroke",n),u[r].lastElementChild.setAttribute("fill",o.increaseTransparency(n,t.stackChartAlpha));else{if("true"==l[r].getAttribute("draw-line")){var c=u[r].firstElementChild;c.setAttribute("stroke",n),"ChartTimePlot"==s&&c.nextElementSibling.setAttribute("fill",o.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=l[r].getAttribute("point-style")&&u[r].lastElementChild.setAttribute("fill",n)}},t.parseDataAndFindMinMax=function(t){for(var e=o.splitSkipEmpty(t," "),r=e.length,i=1/0,n=-1/0,a=1/0,s=-1/0,l=0;l<r;l++)if("empty"==e[l])e[l]=[];else{e[l]=o.splitSkipEmpty(e[l],"|");for(var u=0;u<e[l].length;u++){e[l][u]=e[l][u].split(":");var c=e[l][u][0]=parseFloat(e[l][u][0]),h=e[l][u][1]=parseFloat(e[l][u][1]);c<i&&(i=c),n<c&&(n=c),h<a&&(a=h),s<h&&(s=h)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,s=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:s}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),C=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=a.findChildOfType(t,"picture"),r=a.findChildOfType(t,"pictureback"),i=o.getFloatAttribute(r,"x"),n=o.getFloatAttribute(r,"y"),s=o.getFloatAttribute(r,"width"),l=o.getFloatAttribute(r,"height"),u=a.cloneElementWithId("normal-text");u.setAttribute("fill","grey"),u.setAttribute("text-anchor","middle"),u.setAttribute("x",(i+s/2).toString()),u.setAttribute("y",(n+l/2+3).toString()),u.firstChild.textContent="Not supported at the moment",e.appendChild(u)},t.draw=function(t,e){},t.setItemLook=function(t,e,r,i){},t}(),S=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=a.findChildOfType(t,"picture"),r=a.findChildOfType(t,"pictureback"),i=o.getFloatAttribute(r,"x"),n=o.getFloatAttribute(r,"y"),s=o.getFloatAttribute(r,"height"),l=a.childElements(a.findChildOfType(t,"legend")).length,u=s/l,c=u*o.getFloatAttribute(t,"bar-width"),h=(u-c)/2;t.setAttribute("rect-height",o.reducePrecision(c).toString());for(var d=0;d<l;d++){var p=a.createSvgElement("g");p.setAttribute("transform","translate("+i+","+(n+d*u+h)+")"),e.appendChild(p),E.addClickTapHandlerToChartItem(p)}},t.prototype.draw=function(e,r){for(var i=a.findChildOfType(e,"pictureback"),n=a.findChildOfType(e,"picture"),s=a.findChildOfType(e,"grid"),l=(o.getFloatAttribute(i,"x"),o.getFloatAttribute(i,"width")),u=o.splitSkipEmpty(r," "),c=u.length,h=-1/0,d=0;d<c;d++)if("empty"==u[d])u[d]=[];else{u[d]=o.splitSkipEmpty(u[d],"|");for(var p=0;p<u[d].length;p++)u[d][p]=u[d][p].split(":"),u[d][p][0]=parseFloat(u[d][p][0]),u[d][p][1]=parseFloat(u[d][p][1]);var f=u[d][u[d].length-1][0];h<f&&(h=f)}h==1/0&&(h=0);for(d=0;d<c;d++)0!=u[d].length&&u[d][u[d].length-1][0]<h&&u[d].push([h,u[d][u[d].length-1][1]]);var m,g=o.getFloatAttribute(e,"scale-max-x");m="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(h,g):Math.max(h,g,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,m-g,m,!1,!0);var b=o.getFloatAttribute(s,"min-x"),v=l/(o.getFloatAttribute(s,"max-x")-b),y=a.childElements(n),A=o.getFloatAttribute(e,"rect-height"),T=t.colorMapping(e);for(d=0;d<c;d++){var C=y[d],S=a.childElements(C),E=S.length,w=0,k="",x=null;for(p=0;p<u[d].length;p++){var M=u[d][p][0],O=u[d][p][1];if(M<b)x=0,k=T(O);else if(null==x)x=(M-b)*v,k=T(O);else{var I=T(O);if(I!=k||p==u[d].length-1){var _=(M-b)*v,L=void 0;w<E?(L=S[w],w++,L.setAttribute("visibility","inherit")):(L=a.createSvgElement("rect"),C.appendChild(L)),o.setMultipleAttributes(L,["x","width","height","fill"],[o.reducePrecision(x),o.reducePrecision(_-x),A,k]),x=_,k=I}}}for(var P=w;P<E;P++)S[P].setAttribute("visibility","hidden")}},t.colorMapping=function(t){var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color");e=o.splitSkipEmpty(e," ");for(var i=[],n=[],a=function(t){var r=e[t].split(":"),a=void 0,o=parseFloat(r[1]);switch(r[0]){case"GREATER":a=function(t){return t>o};break;case"GREATER_OR_EQUALS":a=function(t){return t>=o};break;case"LESS":a=function(t){return t<o};break;case"LESS_OR_EQUALS":a=function(t){return t<=o};break;case"EQUALS":a=function(t){return t==o};break;case"NOT_EQUALS":a=function(t){return t!=o}}i[t]=a,n[t]=r[2]},s=0;s<e.length;s++)a(s);return function(t){for(var e=0;e<i.length;e++)if(i[e](t))return n[e];return r}},t.setItemLook=function(t,e,r,i){var n=a.findChildOfType(t,"picture");a.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),E=function(){function t(t){this.frameDrawing=t,this.chartScaleAndGrid=new y(t),this.chart1D=new A(t,this.chartScaleAndGrid),this.chart2D=new T(t,this.chartScaleAndGrid),this.chartHistogram=new v(t,this.chartScaleAndGrid),this.chartHistogram2D=new C(t,this.chartScaleAndGrid),this.chartTimeColor=new S(t,this.chartScaleAndGrid)}return t.create=function(){return a.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),o=a.findChildOfType(e,"background"),s=a.findChildOfType(e,"pictureback"),l=a.findChildOfType(e,"pictureselect"),u=a.findChildOfType(e,"pictureborderh"),c=a.findChildOfType(e,"pictureborderw"),h=a.findChildOfType(e,"grid"),d=0;d<r.length;d++)switch(r[d]){case"width":case"height":case"fill":case"stroke":o.setAttribute(r[d],i[d]);break;case"pic-width":case"pic-height":s.setAttribute(r[d].substring(4),i[d]),l.setAttribute(r[d].substring(4),i[d]);break;case"pic-fill":s.setAttribute(r[d].substring(4),i[d]);break;case"pic-stroke":u.setAttribute(r[d].substring(4),i[d]),c.setAttribute(r[d].substring(4),i[d]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":h.setAttribute(r[d],i[d]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":t.addItem(e,i[d]);break;case"items-completed":t.setupLegendItemsLayout(e),t.setupPicture(e);break;case"data":this.drawPicture(e,i[d]);break;default:e.setAttribute(r[d],i[d])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=a.findChildOfType(e,"background"),n=a.findChildOfType(e,"pictureback"),s=a.findChildOfType(e,"pictureselect"),l=a.findChildOfType(e,"pictureborderh"),u=a.findChildOfType(e,"pictureborderw"),c=a.findChildOfType(e,"warning"),h=a.findChildOfType(e,"legend"),d=e.getAttribute("leg-pos"),p=o.getFloatAttribute(i,"width"),f=o.getFloatAttribute(i,"height"),m=o.getFloatAttribute(e,"pic-offset-x"),g=o.getFloatAttribute(e,"pic-offset-y"),b=o.getFloatAttribute(n,"width"),v=o.getFloatAttribute(n,"height"),y=o.getFloatAttribute(e,"leg-size"),A=0,T=0,C=0,S=0;switch(d){case"SOUTH":A=m,T=f-y,C=p-m,S=y;break;case"WEST":m+=y,A=0,T=g,C=y,S=f-g;break;case"EAST":A=p-y,T=g,C=y,S=f-g;break;case"NORTH":g+=y,A=m,T=0,C=p-m,S=y}if(o.setMultipleAttributes(n,["x","y"],[m,g]),o.setMultipleAttributes(s,["x","y"],[m,g]),o.setMultipleAttributes(c,["x","y"],[m+b/2,g+v/2+3]),"NONE"==d?h.setAttribute("visibility","hidden"):(h.setAttribute("transform","translate("+A+","+T+")"),o.setMultipleAttributes(h,["width","height"],[C,S])),"ChartPie"==r){var E=b/2,w=v/2,k=a.createSvgElement("ellipse");o.setMultipleAttributes(k,["cx","cy","rx","ry","stroke","fill","visibility"],[m+E,g+w,E,w,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(k,n);var x=a.createSvgElement("ellipse");o.setMultipleAttributes(x,["cx","cy","rx","ry","stroke","fill"],[m+E,g+w,E,w,l.getAttribute("stroke"),"none"]),e.insertBefore(x,l),a.removeElement(e,l),a.removeElement(e,u)}e.onmouseover=function(e){return t.selectChart(e,!0)},e.onmouseout=function(e){return t.selectChart(e,!1)}},t.setupLegendItemsLayout=function(t){for(var e=a.findChildOfType(t,"legend"),r=a.childElements(e),i=o.getFloatAttribute(e,"width"),n=0,s=0,l=0;l<r.length;l++){var u=r[l],c=a.findChildOfType(u,"back"),h=o.getFloatAttribute(c,"width"),d=a.findChildOfType(u,"value"),p=d.getComputedTextLength(),f=Math.max(h,o.getFloatAttribute(d,"x")+p);c.setAttribute("width",f.toString()),0<n&&i<n+f&&(n=0,s+=20),u.setAttribute("transform","translate("+n+","+s+")"),n+=f+5}},t.showChartWarning=function(t,e){var r=a.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=a.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=a.findChildOfType(t,"picture"),r=a.findChildOfType(t,"legend");a.removeAllChildren(r),a.removeAllChildren(e)},t.addItem=function(e,r){var i=e.getAttribute("type"),n=a.findChildOfType(e,"legend"),s=r.split("\n"),l=s[0],u=s[1],c=a.cloneElementWithId("legend-item"),h=a.findChildOfType(c,"color"),d=a.findChildOfType(c,"name"),p=a.findChildOfType(c,"value");h.setAttribute("fill",l),c.setAttribute("original-color",l),d.setAttribute("fill",e.getAttribute("leg-text-color")),d.appendChild(a.createTextNode(u)),p.appendChild(a.createTextNode("")),n.appendChild(c);var f=d.getComputedTextLength();p.setAttribute("x",(o.getFloatAttribute(d,"x")+f+4).toString()),"ChartPlot"==i||"ChartTimePlot"==i?o.setMultipleAttributes(c,["draw-line","line-width","interpolation","point-style"],[s[2],s[3],s[4],s[5]]):"ChartHistogram"==i&&o.setMultipleAttributes(c,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[s[2],s[3],s[4],s[5],s[6]]),t.addClickTapHandlerToChartItem(c)},t.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":A.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":T.setup(t);break;case"ChartTimeColor":S.setup(t);break;case"ChartHistogram":v.setup(t);break;case"ChartHistogram2D":C.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":C.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.selectChart=function(t,e){var r=t.currentTarget;a.findChildOfType(r,"pictureselect").setAttribute("visibility",e?"inherit":"hidden")},t.addClickTapHandlerToChartItem=function(e){new m(e,function(r){return t.selectChartItem(e,!0,!1)},function(r){return t.selectChartItem(e,!1,!1)},null,function(r){return t.selectChartItem(e,!0,!0)},function(t){return!1})},t.selectChartItem=function(e,r,i){for(var n=t.getChartShape(e),s=o.indexInParent(e),l=a.childElements(a.findChildOfType(n,"legend")),u=l[s],c="true"==u.getAttribute("selected"),h=!1,d=0;d<l.length;d++)if(d!=s&&"true"==l[d].getAttribute("selected")){h=!0;break}if(i)return c=!c,u.setAttribute("selected",c?"true":"false"),void t.setChartItemLook(n,s,!1,c);if(c||h){if(c)return;t.setChartItemLook(n,s,!r,r)}else{t.setChartItemLook(n,s,!1,r);for(d=0;d<l.length;d++)d!=s&&t.setChartItemLook(n,d,r,!1)}},t.setChartItemLook=function(e,r,i,n){var o=a.childElements(a.findChildOfType(e,"legend")),s=a.findChildOfType(o[r],"back"),l=a.findChildOfType(o[r],"color");s.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var u=i?t.colorItemGrayed:o[r].getAttribute("original-color");switch(l.setAttribute("fill",u),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":A.setItemLook(e,r,i,u);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":T.setItemLook(e,r,i,u);break;case"ChartTimeColor":S.setItemLook(e,r,i,u);break;case"ChartHistogram":v.setItemLook(e,r,i,u);break;case"ChartHistogram2D":C.setItemLook(e,r,i,u)}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),w=function(){function t(){}return t.isFullScreenEnabled=function(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled},t.isFullScreen=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},t.requestFullScreen=function(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},t.cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},t.toggleFullScreen=function(e){t.isFullScreen()?t.cancelFullScreen():t.requestFullScreen(e)},t.addFullScreenListener=function(t){document.addEventListener("fullscreenchange",t,!1),document.addEventListener("webkitfullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),document.addEventListener("msfullscreenchange",t,!1)},t.removeFullScreenListener=function(t){document.removeEventListener("fullscreenchange",t,!1),document.removeEventListener("webkitfullscreenchange",t,!1),document.removeEventListener("mozfullscreenchange",t,!1),document.removeEventListener("msfullscreenchange",t,!1)},t.setBrowserWindowInnerSize=function(t,e){window.outerWidth?window.resizeTo(t+(window.outerWidth-window.innerWidth),e+(window.outerHeight-window.innerHeight)):(window.resizeTo(500,500),window.resizeTo(t+(500-document.body.offsetWidth),e+(500-document.body.offsetHeight)))},t}(),k=function(){function t(t){var e=this;this.client=t,this.onWindowResizeEventClosure=function(t){return e.updateSVGSize()},this.onSVGPointingEventClosure=function(t){return e.onSVGPointingEvent(t)}}return t.prototype.initSVGNavigation=function(){window.addEventListener("resize",this.onWindowResizeEventClosure,!1),w.addFullScreenListener(this.onWindowResizeEventClosure),this.client.svg.oncontextmenu=function(){return!1},this.client.svg.addEventListener("mousedown",this.onSVGPointingEventClosure),this.client.svg.addEventListener("mousemove",this.onSVGPointingEventClosure),this.client.svg.addEventListener("mouseup",this.onSVGPointingEventClosure),this.client.svg.addEventListener("mouseout",this.onSVGPointingEventClosure),this.client.svg.addEventListener("wheel",this.onSVGPointingEventClosure),this.client.svg.addEventListener("touchstart",this.onSVGPointingEventClosure),this.client.svg.addEventListener("touchmove",this.onSVGPointingEventClosure),this.client.svg.addEventListener("touchend",this.onSVGPointingEventClosure),this.buttonDown=0,this.prevPtrCoords=[],this.presentationCoords=[0,0],this.zoom=1},t.prototype.clearSVGNavigation=function(){this.client.svg&&(window.removeEventListener("resize",this.onWindowResizeEventClosure),w.removeFullScreenListener(this.onWindowResizeEventClosure),this.client.svg.removeEventListener("mousedown",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("mousemove",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("mouseup",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("mouseout",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("wheel",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("touchstart",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("touchmove",this.onSVGPointingEventClosure),this.client.svg.removeEventListener("touchend",this.onSVGPointingEventClosure))},t.prototype.onSVGPointingEvent=function(e){e.stopPropagation();var r=o.offsetPage(this.client.svg);if(e.type.startsWith("mouse")||"wheel"==e.type){var i=e,n=i.pageX-r.left,a=i.pageY-r.top;switch(i.type){case"mousedown":this.buttonDown=i.which,this.prevPtrCoords=[n,a],1==this.buttonDown||this.buttonDown;break;case"mousemove":if(1==this.buttonDown)i.preventDefault();else if(3==this.buttonDown&&this.client.frameDrawing.settings.enablePanning){var s=n-this.prevPtrCoords[0],l=a-this.prevPtrCoords[1];this.onPanning(s,l),this.prevPtrCoords=[n,a]}break;case"mouseup":case"mouseout":if(this.client.svg.contains(i.relatedTarget))return;var u=this.buttonDown;if(this.buttonDown=0,1==u){s=n-this.prevPtrCoords[0],l=a-this.prevPtrCoords[1];Math.abs(s)<=t.clickTolerance&&Math.abs(l)<=t.clickTolerance&&this.onPresentationClick(i,n,a)}this.prevPtrCoords=[];break;case"wheel":var c=e;c.altKey&&this.client.frameDrawing.settings.enableZoom?this.onWheelZooming(0<c.deltaY,n,a):this.client.frameDrawing.settings.enablePanning&&(e.preventDefault(),0<c.deltaY?this.onPanning(0,-50):this.onPanning(0,50))}}else if(e.type.startsWith("touch")){var h=e,d=void 0,p=void 0,f=void 0,m=void 0;switch(h.touches.length>0&&(d=h.touches[0].pageX-r.left,p=h.touches[0].pageY-r.top),h.touches.length>1&&(f=h.touches[1].pageX-r.left,m=h.touches[1].pageY-r.top),h.type){case"touchstart":this.prevPtrCoords=h.touches.length>1?[d,p,f,m]:[d,p];break;case"touchmove":if(h.preventDefault(),h.touches.length>1&&4==this.prevPtrCoords.length){var g=(d+f)/2,b=(p+m)/2,v=Math.hypot(this.prevPtrCoords[2]-this.prevPtrCoords[0],this.prevPtrCoords[3]-this.prevPtrCoords[1]),y=Math.hypot(f-d,m-p)/v*this.zoom;y=Math.max(y,t.zooms[0]),y=Math.min(y,t.zooms[t.zooms.length-1]),this.applyZoom(y,g,b)}else if(this.prevPtrCoords.length>=2){s=d-this.prevPtrCoords[0],l=p-this.prevPtrCoords[1];if(4==this.prevPtrCoords.length){var A=Math.hypot(s,l),T=d-this.prevPtrCoords[2],C=p-this.prevPtrCoords[3];Math.hypot(T,C)<A&&(s=T,l=C)}this.onPanning(s,l)}this.prevPtrCoords=h.touches.length>1?[d,p,f,m]:[d,p];break;case"touchend":this.prevPtrCoords=[]}}},t.prototype.applyPresentationTransform=function(){var t="translate("+this.presentationCoords[0]+","+this.presentationCoords[1]+")",e="scale("+this.zoom+")";this.client.presentation.setAttribute("transform",t+" "+e)},t.prototype.applyZoom=function(t,e,r){var i=t/this.zoom,n=e-(e-this.presentationCoords[0])*i,a=r-(r-this.presentationCoords[1])*i;this.presentationCoords=[n,a],this.zoom=t,this.applyPresentationTransform()},t.prototype.onPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform()},t.prototype.onWheelZooming=function(e,r,i){var n=this.zoom;if(e){for(var a=t.zooms.length-1;a>=0;a--)if(t.zooms[a]<this.zoom){n=t.zooms[a];break}}else for(a=0;a<t.zooms.length;a++)if(this.zoom<t.zooms[a]){n=t.zooms[a];break}this.applyZoom(n,r,i)},t.prototype.onPresentationClick=function(t,e,r){var i=e-this.presentationCoords[0],n=r-this.presentationCoords[1];i/=this.zoom,n/=this.zoom,this.client.frameDrawing.onUserClick(t.target,i,n)},t.prototype.navigateTo=function(t,e,r){this.zoom=r,this.presentationCoords=[-t*this.zoom,-e*this.zoom],this.applyPresentationTransform()},t.prototype.updateSVGSize=function(){var t=this.client.svg,e=t.parentNode.getBoundingClientRect(),r=e.width,i=e.height;o.setMultipleAttributes(t,["width","height"],[r,i])},t.clickTolerance=1,t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t}(),x=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return a.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return a.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return a.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)r[n],e.setAttribute(r[n],i[n]);t.updateGISMarkupPosition(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=a.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=o.getFloatAttribute(t,"lon"),n=o.getFloatAttribute(t,"lat"),s=M.lonLatToXY(r,i,n);o.setMultipleAttributes(t,["cx","cy"],[s[0],s[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var l=t.getAttribute("lonlatpoints"),u=M.lonLatPointsToXYPoints(r,l);t.setAttribute("points",u)}},t}(),M=function(){function t(t){this.frameDrawing=t}return t.prototype.createShapeGISMap=function(){var t=this,e=a.cloneElementWithId("shape-gis-map"),r=function(e){return t.onGISEvent(e)};e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r);var i=a.findChildOfType(e,"map").firstElementChild;return a.findChildOfType(i,"agents").addEventListener("click",function(e){return t.onGISAgentLayerClick(e)}),e},t.prototype.updateShapeGISMap=function(t,e,r){for(var i=a.findChildOfType(t,"background"),n=a.findChildOfType(t,"map"),o=a.findChildOfType(t,"shadow"),s=a.findChildOfType(t,"border"),l=0;l<e.length;l++)switch(e[l]){case"width":case"height":i.setAttribute(e[l],r[l]),n.setAttribute(e[l],r[l]),o.setAttribute(e[l],r[l]),s.setAttribute(e[l],r[l]);break;case"size-completed":t.getAttribute("zoom")&&this.redrawGISMap(t);break;case"background-color":i.setAttribute("fill",r[l]);break;case"border-color":s.setAttribute("stroke",r[l]);break;case"map-completed":this.redrawGISMap(t);break;default:t.setAttribute(e[l],r[l])}},t.prototype.redrawGISMap=function(e){this.redrawGISTiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.prototype.redrawGISTiles=function(e){var r=a.findChildOfType(e,"background"),i=o.getFloatAttribute(r,"width"),n=o.getFloatAttribute(r,"height"),s=t.minGISZoom(i,n),l=a.findChildOfType(e,"map").firstElementChild;l.setAttribute("transform","translate(0,0)");var u=o.getIntAttribute(e,"zoom"),c=o.getFloatAttribute(e,"center-lon"),h=o.getFloatAttribute(e,"center-lat");u<s&&(u=s,e.setAttribute("zoom",u.toString()));var d,p=Math.pow(2,u),f=t.latToTileYFloat(h,u),m=n/2/t.tileImageSize;f-m<0?d=m:p<f+m&&(d=p-m),d&&(h=t.tileYToLat(d,u),e.setAttribute("center-lat",h.toString()));var g=a.findChildOfType(l,"tiles");a.removeAllChildren(g),this.updateGISTiles(g,u,h,c,0,0,i,n,p)},t.prototype.updateGISTiles=function(e,r,i,n,s,l,u,c,h){for(var d=t.lonToTileXInt(n,r),p=t.latToTileYInt(i,r),f=s+u/2-t.lonToXOffsetWithinTile(n,r),m=l+c/2-t.latToYOffsetWithinTile(i,r);f>0;)f-=t.tileImageSize,d--;for(;m>0;)m-=t.tileImageSize,p--;d=o.modulo(d,h),p=o.modulo(p,h);for(var g=[],b=a.childElements(e),v=0;v<b.length;v++)g.push(b[v]);for(var y=d,A=f;A<u;A+=t.tileImageSize){for(var T=p,C=m;C<c;C+=t.tileImageSize){var S=r+"/"+y+"/"+T,E=null;for(v=0;v<g.length;v++)if(g[v].getAttribute("tileid")==S){E=g[v];break}null==E&&(E=this.addGISTile(e,r,y,T)),E.setAttribute("x",(A-s).toString()),E.setAttribute("y",(C-l).toString()),T=o.modulo(T+1,h)}y=o.modulo(y+1,h)}},t.prototype.addGISTile=function(e,r,i,n){var o=a.findParentOfType(e,"ShapeGISMap"),s=this.tileURL(o,r,i,n),l=a.createSvgElement("image");return l.setAttribute("width",t.tileImageSize.toString()),l.setAttribute("height",t.tileImageSize.toString()),l.setAttributeNS(a.xlinkns,"href",s),l.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(l),l},t.redrawGISMarkup=function(t){for(var e=a.findChildOfType(t,"map").firstElementChild,r=a.findChildOfType(e,"markup"),i=a.childElements(r),n=0;n<i.length;n++)x.updateGISMarkupPosition(i[n])},t.redrawGISAgents=function(e){for(var r=a.findChildOfType(e,"map").firstElementChild,i=a.findChildOfType(r,"agents"),n=a.childElements(i),o=0;o<n.length;o++)t.updateGISObjectScale(n[o]),"hidden"!=n[o].getAttribute("visibility")&&t.updateGISObjectPosition(n[o])},t.updateGISObjectPosition=function(e){var r=a.findParentOfType(e,"ShapeGISMap"),i=o.getFloatAttribute(e,"lon"),n=o.getFloatAttribute(e,"lat"),s=o.getFloatAttribute(e,"heading"),l=t.lonLatToXY(r,i,n),u="translate("+l[0]+","+l[1]+") rotate("+s+")",c=e.getAttribute("scale");c&&(u+=" scale("+c+")"),e.setAttribute("transform",u)},t.updateGISObjectScale=function(e){var r=a.findParentOfType(e,"ShapeGISMap"),i=o.getIntAttribute(e,"fixed-scale-zoom");if(i){var n=o.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var s=1;if(o.getIntAttribute(e,"real-scale-zoom")<=n){var l=o.getFloatAttribute(e,"pixels-per-meter"),u=o.getFloatAttribute(e,"lat");s=t.pixelsPerGISMeter(n,u)/l}e.setAttribute("scale",s.toString())}},t.prototype.panGIS=function(e,r,i){var n=a.findChildOfType(e,"map").firstElementChild,s=o.parseTranslateTransform(n.getAttribute("transform")),l=s[0]+r,u=s[1]+i,c=o.getIntAttribute(e,"zoom"),h=Math.pow(2,c),d=o.getFloatAttribute(e,"center-lon"),p=o.getFloatAttribute(e,"center-lat"),f=t.latToTileYFloat(p,c),m=a.findChildOfType(e,"background"),g=o.getFloatAttribute(m,"width"),b=o.getFloatAttribute(m,"height"),v=b/2/t.tileImageSize;f-v-u/t.tileImageSize<0?u=(f-v)*t.tileImageSize:h<f+v-u/t.tileImageSize&&(u=(f+v-h)*t.tileImageSize),l=t.normalizedGISX(l,c),l=Math.round(l),u=Math.round(u),n.setAttribute("transform","translate("+l+","+u+")");var y=a.findChildOfType(n,"tiles");this.updateGISTiles(y,c,p,d,l,u,g,b,h)},t.prototype.zoomOutGIS=function(e,r,i){var n=a.findChildOfType(e,"background"),s=o.getFloatAttribute(n,"width"),l=o.getFloatAttribute(n,"height"),u=o.getIntAttribute(e,"zoom");t.minGISZoom(s,l)<u&&this.setGISZoom(e,r,i,u-1)},t.prototype.zoomInGIS=function(t,e,r){var i=o.getIntAttribute(t,"zoom");i<19&&this.setGISZoom(t,e,r,i+1)},t.prototype.setGISZoom=function(e,r,i,n){var s=a.findChildOfType(e,"background"),l=o.getFloatAttribute(s,"width"),u=o.getFloatAttribute(s,"height"),c=a.findChildOfType(e,"map").firstElementChild,h=o.parseTranslateTransform(c.getAttribute("transform")),d=t.xyToLonLat(e,r-h[0],i-h[1]),p=t.lonToTileXFloat(d[0],n),f=t.latToTileYFloat(d[1],n),m=Math.pow(2,n);p=o.remainderPositive(p-(r-l/2)/t.tileImageSize,m),f=o.remainderPositive(f-(i-u/2)/t.tileImageSize,m);var g=t.tileXToLon(p,n),b=t.tileYToLat(f,n);o.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,g,b]),this.redrawGISMap(e)},t.prototype.onGISClick=function(e,r,i){var n=a.findChildOfType(e,"map").firstElementChild,s=o.parseTranslateTransform(n.getAttribute("transform")),l=t.xyToLonLat(e,r-s[0],i-s[1]);this.frameDrawing.client.network.postUserAction(e.id,l[0]+" "+l[1])},t.prototype.onGISEvent=function(e){var r=e.currentTarget;if("true"==r.getAttribute("navigation-enabled")){var i=a.findChildOfType(r,"background"),n=o.getFloatAttribute(i,"width"),s=o.getFloatAttribute(i,"height"),l=i.getBoundingClientRect(),u=l.width/n,c=l.height/s,h=o.offsetPage(i);if(e.type.startsWith("mouse")||"wheel"==e.type){var d=e,p=(d.pageX-h.left)/u,f=(d.pageY-h.top)/c;switch(e.type){case"mousedown":t.buttonDown=d.which,1==t.buttonDown&&(e.stopPropagation(),t.prevPtrCoords=[p,f]);break;case"mousemove":if(1==t.buttonDown){e.stopPropagation(),e.preventDefault();var m=p-t.prevPtrCoords[0],g=f-t.prevPtrCoords[1];t.prevPtrCoords=[p,f],this.panGIS(r,m,g)}break;case"mouseup":case"mouseout":if(r.contains(d.relatedTarget))return;if(1==t.buttonDown){e.stopPropagation();m=p-t.prevPtrCoords[0],g=f-t.prevPtrCoords[1];Math.abs(m)<=k.clickTolerance&&Math.abs(g)<=k.clickTolerance&&this.onGISClick(r,p,f)}t.buttonDown=0;break;case"wheel":if(!d.altKey&&!d.ctrlKey){var b=e;e.stopPropagation(),e.preventDefault(),0<b.deltaY?this.zoomOutGIS(r,p,f):this.zoomInGIS(r,p,f)}}}else if(e.type.startsWith("touch")){var v=e;if(v.touches.length>2)return;var y=void 0,A=void 0,T=void 0,C=void 0;switch(v.touches.length>0&&(y=(v.touches[0].pageX-h.left)/u,A=(v.touches[0].pageY-h.top)/c),v.touches.length>1&&(T=(v.touches[1].pageX-h.left)/u,C=(v.touches[1].pageY-h.top)/c),e.type){case"touchstart":e.stopPropagation(),t.prevPtrCoords=v.touches.length>1?[y,A,T,C]:[y,A];break;case"touchmove":if(e.stopPropagation(),e.preventDefault(),v.touches.length>1&&4==t.prevPtrCoords.length){var S=(y+T)/2,E=(A+C)/2,w=Math.hypot(t.prevPtrCoords[2]-t.prevPtrCoords[0],t.prevPtrCoords[3]-t.prevPtrCoords[1]),x=Math.hypot(T-y,C-A);(x<.8*w||1.2*w<x)&&(x<w?this.zoomOutGIS(r,S,E):this.zoomInGIS(r,S,E),t.prevPtrCoords=[y,A,T,C])}else if(t.prevPtrCoords.length>=2){m=y-t.prevPtrCoords[0],g=A-t.prevPtrCoords[1];if(4==t.prevPtrCoords.length){var M=Math.hypot(m,g),O=y-t.prevPtrCoords[2],I=A-t.prevPtrCoords[3];Math.hypot(O,I)<M&&(m=O,g=I)}this.panGIS(r,m,g),t.prevPtrCoords=v.touches.length>1?[y,A,T,C]:[y,A]}else t.prevPtrCoords=v.touches.length>1?[y,A,T,C]:[y,A];break;case"touchend":e.stopPropagation(),t.prevPtrCoords=[]}}}},t.prototype.onGISAgentLayerClick=function(t){t.stopPropagation(),t.preventDefault();for(var e=t.currentTarget,r=t.target;r.parentNode!=e;)r=r.parentNode;this.frameDrawing.client.network.postUserAction(r.id,"0 0")},t.xyToLonLat=function(e,r,i){var n=a.findChildOfType(e,"background"),s=o.getFloatAttribute(n,"width"),l=o.getFloatAttribute(n,"height"),u=o.getIntAttribute(e,"zoom"),c=Math.pow(2,u),h=t.lonToTileXFloat(o.getFloatAttribute(e,"center-lon"),u),d=t.latToTileYFloat(o.getFloatAttribute(e,"center-lat"),u),p=(r-s/2)/t.tileImageSize,f=(i-l/2)/t.tileImageSize,m=o.remainderPositive(h+p,c),g=o.remainderPositive(d+f,c);return[t.tileXToLon(m,u),t.tileYToLat(g,u)]},t.lonLatToXY=function(e,r,i){var n=a.findChildOfType(e,"background"),s=o.getFloatAttribute(n,"width"),l=o.getFloatAttribute(n,"height"),u=o.getIntAttribute(e,"zoom"),c=t.lonToTileXFloat(o.getFloatAttribute(e,"center-lon"),u),h=t.latToTileYFloat(o.getFloatAttribute(e,"center-lat"),u),d=t.lonToTileXFloat(r,u),p=t.latToTileYFloat(i,u);return[s/2+(d-c)*t.tileImageSize,l/2+(p-h)*t.tileImageSize]},t.lonLatPointsToXYPoints=function(e,r){var i=a.findChildOfType(e,"background"),n=o.getFloatAttribute(i,"width"),s=o.getFloatAttribute(i,"height"),l=o.getIntAttribute(e,"zoom"),u=t.lonToTileXFloat(o.getFloatAttribute(e,"center-lon"),l),c=t.latToTileYFloat(o.getFloatAttribute(e,"center-lat"),l),h=void 0,d=void 0,p="";r=o.splitSkipEmpty(r," ");for(var f=0;f<r.length;f++){var m=r[f].split(","),g=t.lonToTileXFloat(parseFloat(m[0]),l),b=t.latToTileYFloat(parseFloat(m[1]),l),v=n/2+(g-u)*t.tileImageSize,y=s/2+(b-c)*t.tileImageSize;null!=h&&Math.abs(v-h)<t.gisTolerance&&Math.abs(y-d)<t.gisTolerance||(p+=(v=o.reducePrecision(v))+","+(y=o.reducePrecision(y))+" ",h=v,d=y)}return p},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.prototype.tileURL=function(e,r,i,n){var a;switch(e.getAttribute("tile-url-provider-type")){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":a=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":a=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":a=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":a=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":a=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":a=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":a=o.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}return a[Math.floor(Math.random()*a.length)].replace("[zoom]",r.toString()).replace("[x]",i.toString()).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=o.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=o.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(o.byteArrayToString(n))},t.buttonDown=0,t.prevPtrCoords=[0,0],t.gisTolerance=2,t.tileImageSize=256,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),O=function(){function t(){}return t.createMarkupPipe=function(t){var e=a.cloneElementWithId("markup-pipe"),r=t+"basepath";a.findChildOfType(e,"basepath").firstElementChild.id=r;var i=a.findChildOfType(e,"pipe"),n=a.findChildOfType(e,"inner-pipe"),o=a.findChildOfType(e,"bubbles"),s="#"+r;return i.setAttributeNS(a.xlinkns,"href",s),n.setAttributeNS(a.xlinkns,"href",s),o.setAttributeNS(a.xlinkns,"href",s),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=a.findChildOfType(t,"basepath").firstElementChild,s=n.id,l=a.findChildOfType(t,"batches"),u=a.findChildOfType(t,"bubbles"),c=0;c<e.length;c++)switch(e[c]){case"phase":u.setAttribute("stroke-dashoffset",(12-parseFloat(r[c])).toString());break;case"batch":var h=r[c].split(" ");i||(i=n.getTotalLength());var d=parseFloat(h[1])*i,p=parseFloat(h[2])*i,f=a.childElements(l)[parseInt(h[0])];f.setAttribute("stroke",h[3]),f.setAttribute("stroke-dasharray","0.1,"+d+","+p+","+i);break;case"newbatches":for(var m=parseInt(r[c]),g=l.childElementCount,b=m;b<g;b++)a.removeElement(l,l.lastElementChild);for(b=g;b<m;b++)f=a.createUseElement(s),l.appendChild(f);break;case"d":var v=parseFloat(a.findChildOfType(t,"pipe").getAttribute("stroke-width")),y=o.roundPathCorners(r[c],2*v,!1);n.setAttribute("d",y);break;case"width":var A=parseFloat(r[c]);a.findChildOfType(t,"pipe").setAttribute("stroke-width",A.toString()),a.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*A).toString()),l.setAttribute("stroke-width",(.6*A).toString());var T=Math.min(5,.2*A);u.setAttribute("stroke-width",T.toString()),u.setAttribute("stroke-dasharray",T+","+(12-T));break;case"color":a.findChildOfType(t,"pipe").setAttribute("stroke",r[c]);break;case"inner-color":a.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[c]);break;default:t.setAttribute(e[c],r[c])}},t.createMarkupStorageTank=function(){return a.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=a.findChildOfType(t,"square"),n=a.findChildOfType(t,"batches"),s=parseFloat(i.getAttribute("width")),l=0;l<e.length;l++)switch(e[l]){case"batch":var u=r[l].split(" "),c=parseFloat(u[1])*s,h=parseFloat(u[2])*s,d=a.childElements(n)[parseInt(u[0])];o.setMultipleAttributes(d,["y","height","fill"],[s/2-c-h,h,u[3]]);break;case"newbatches":for(var p=parseInt(r[l]),f=n.childElementCount,m=p;m<f;m++)a.removeElement(n,n.lastElementChild);for(m=f;m<p;m++)d=a.createSvgElement("rect"),o.setMultipleAttributes(d,["stroke","width","x"],["none",s,-s/2]),n.appendChild(d);break;case"progress":var g=parseFloat(r[l])*Math.PI*2,b=parseFloat(a.findChildOfType(t,"circle").getAttribute("r"))-2,v=b*Math.sin(g),y=-b*Math.cos(g),A="M 0 "+-b+" ";A+="A "+b+" "+b+" 0 "+(g>Math.PI?"1":"0")+" 1 "+v+" "+y,a.findChildOfType(t,"arc").setAttribute("d",A);break;case"radius":a.findChildOfType(t,"circle").setAttribute("r",r[l]),s=Math.max(10,2*parseFloat(r[l])/Math.sqrt(2)-8),o.setMultipleAttributes(i,["width","height","x","y"],[s,s,-s/2,-s/2]);break;case"color":a.findChildOfType(t,"circle").setAttribute("fill",r[l]);break;case"stroke-color":a.findChildOfType(t,"circle").setAttribute("stroke",r[l]),a.findChildOfType(t,"square").setAttribute("stroke",r[l]);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupBulkConveyorBelt=function(t){var e=a.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";a.findChildOfType(e,"basepath").firstElementChild.id=r;var i=a.findChildOfType(e,"belt"),n=a.findChildOfType(e,"belt-sections"),o="#"+r;return i.setAttributeNS(a.xlinkns,"href",o),n.setAttributeNS(a.xlinkns,"href",o),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=a.findChildOfType(t,"basepath").firstElementChild,o=n.id,s=a.findChildOfType(t,"belt-sections"),l=a.findChildOfType(t,"batches"),u=0;u<e.length;u++)switch(e[u]){case"phase":s.setAttribute("stroke-dashoffset",r[u]);break;case"batch":var c=r[u].split(" ");i||(i=n.getTotalLength());var h=parseFloat(c[1])*i,d=parseFloat(c[2])*i,p=a.childElements(l)[parseInt(c[0])];p.setAttribute("stroke",c[3]),p.setAttribute("stroke-dasharray","0.1,"+h+","+d+","+i);break;case"newbatches":for(var f=parseInt(r[u]),m=l.childElementCount,g=f;g<m;g++)a.removeElement(l,l.lastElementChild);for(g=m;g<f;g++)p=a.createUseElement(o),l.appendChild(p);break;case"d":n.setAttribute("d",r[u]);break;case"width":var b=r[u];a.findChildOfType(t,"belt").setAttribute("stroke-width",b),s.setAttribute("stroke-width",b),s.setAttribute("stroke-dasharray","2, 10"),l.setAttribute("stroke-width",(.4*parseFloat(b)).toString());break;case"color":a.findChildOfType(t,"belt").setAttribute("stroke",r[u]);break;case"sections-color":s.setAttribute("stroke",r[u]);break;default:t.setAttribute(e[u],r[u])}},t}(),I=function(){function t(){}return t.createMarkupPath=function(t,e){var r=a.cloneElementWithId("markup-path"),i=e+"basepath";a.findChildOfType(r,"basepath").firstElementChild.id=i;var n=a.findChildOfType(r,"paths"),o=1;"MarkupPathRoad"==t&&(o=2),"MarkupPathRailroad"==t&&(o=4);for(var s=0;s<o;s++){var l=a.createUseElement(i);n.appendChild(l)}var u=a.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),u.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),u.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),a.childElements(n)[1].setAttribute("stroke","black"),a.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),u.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=a.findChildOfType(t,"basepath").firstElementChild,s=a.findChildOfType(t,"paths"),l=s.firstElementChild,u=a.findChildOfType(t,"arrows"),c=0;c<e.length;c++)switch(e[c]){case"d":n.setAttribute("d",r[c]);break;case"bidirectional":a.removeAllChildren(u),"false"==r[c]&&o.addPathArrows(n,"arrowhead",1.7,u,50,100);break;case"stroke-width":var h=parseFloat(r[c]);switch(i){case"MarkupPathLine":l.setAttribute("stroke-width",h.toString());break;case"MarkupPathDashline":l.setAttribute("stroke-width",h.toString()),l.setAttribute("stroke-dasharray",4*h+" "+h);break;case"MarkupPathConveyor":l.setAttribute("stroke-width",h.toString()),l.setAttribute("stroke-dasharray",h/2+" "+h/10);break;case"MarkupPathRoad":l.setAttribute("stroke-width",h.toString());var d=s.lastElementChild;d.setAttribute("stroke-width",(h/12).toString()),d.setAttribute("stroke-dasharray",h/2+" "+h/5);break;case"MarkupPathRailroad":var p=h/10+" "+h/2.5;l.setAttribute("stroke-width",h.toString()),l.setAttribute("stroke-dasharray",p),a.childElements(s)[1].setAttribute("stroke-width",(h/2+h/12).toString()),a.childElements(s)[2].setAttribute("stroke-width",(h/2).toString());var f=s.lastElementChild;f.setAttribute("stroke-width",(h/2).toString()),f.setAttribute("stroke-dasharray",p)}break;case"stroke":l.setAttribute("stroke",r[c]),h=parseFloat(l.getAttribute("stroke-width")),u.setAttribute("stroke",h>4?"white":r[c]);break;default:t.setAttribute(e[c],r[c])}},t.createMarkupAreaNode=function(t){var e,r=a.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=a.createSvgElement("rect");break;case"MarkupPolygonalNode":e=a.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:i.setAttribute(e[n],r[n])}},t.createMarkupPalletRack=function(){return a.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,s=0;s<e.length;s++)switch(e[s]){case"stroke":n.setAttribute(e[s],r[s]);break;case"fill":i.setAttribute(e[s],r[s]);break;case"rack-data":a.removeAllChildren(i),a.removeAllChildren(n);var l=r[s].split(" "),u=parseInt(l[0]),c=parseInt(l[1]),h=parseFloat(l[2]),d=parseFloat(l[3]),p=parseFloat(l[4]),f=void 0,m=void 0,g=void 0;u>1&&(f=parseFloat(l[5]),m=parseFloat(l[6]),g=d+f);var b=a.createSvgElement("rect");if(b.setAttribute("width",h.toString()),b.setAttribute("height",d.toString()),i.appendChild(b),u>1){var v=a.createSvgElement("rect");v.setAttribute("width",h.toString()),v.setAttribute("height",m.toString()),v.setAttribute("transform","translate( 0 "+g+")"),i.appendChild(v)}for(var y=p,A=0;A<c-1;A++){var T=a.createSvgElement("line");o.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,"0",d]),n.appendChild(T),y+=p}if(u>1){var C=g+m;y=p;for(A=0;A<c-1;A++){T=a.createSvgElement("line");o.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,g,C]),n.appendChild(T),y+=p}}break;default:t.setAttribute(e[s],r[s])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),_=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=a.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=a.createSvgElement("path");break;case"MarkupCircularWall":r=a.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=a.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupTargetLine=function(){return a.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=a.findChildOfType(e,"polyline"),o=a.findChildOfType(e,"serif-start"),s=a.findChildOfType(e,"serif-end"),l=0;l<r.length;l++)switch(r[l]){case"color":e.setAttribute("stroke",i[l]);break;case"points":n.setAttribute(r[l],i[l]);var u=i[l].split(" "),c=u.length;u[c-1].includes(",")||c--,t.setSerif(u[0],u[1],o),t.setSerif(u[c-1],u[c-2],s);break;default:e.setAttribute(r[l],i[l])}},t.createMarkupPathway=function(){return a.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=a.findChildOfType(t,"polygon"),n=a.findChildOfType(t,"polyline"),s=a.findChildOfType(t,"ties"),l=0;l<e.length;l++)switch(e[l]){case"color":s.setAttribute("stroke",r[l]);break;case"points":var u=r[l].split(" "),c="",h="",d="";a.removeAllChildren(s);for(var p=0;p<u.length;p++){var f=o.splitToFloats(u[p],",");if(4==f.length){c+=f[0]+","+f[1]+" ",h=f[2]+","+f[3]+" "+h,d+=(f[0]+f[2])/2+","+(f[1]+f[3])/2+" ";var m=a.createSvgElement("line");o.setMultipleAttributes(m,["x1","y1","x2","y2"],[f[0],f[1],f[2],f[3]]),s.appendChild(m)}}i.setAttribute("points",c+h),n.setAttribute("points",d);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupPedFlowStatistics=function(){return a.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=a.findChildOfType(t,"line"),n=a.findChildOfType(t,"serif-end"),o=a.findChildOfType(t,"direction"),s=a.findChildOfType(t,"arrow-right"),l=a.findChildOfType(t,"arrow-left"),u=0;u<e.length;u++)switch(e[u]){case"color":t.setAttribute("stroke",r[u]);break;case"length":i.setAttribute("x2",r[u]),n.setAttribute("x1",r[u]),n.setAttribute("x2",r[u]);var c=parseInt(r[u])/2;o.setAttribute("x1",c.toString()),o.setAttribute("x2",c.toString()),s.setAttribute("transform","translate("+c+" 13) rotate(90)"),l.setAttribute("transform","translate("+c+" -13) rotate(-90)");break;case"direction":switch(s.setAttribute("visibility","inherit"),l.setAttribute("visibility","inherit"),r[u]){case"right":l.setAttribute("visibility","hidden");break;case"left":s.setAttribute("visibility","hidden")}break;default:t.setAttribute(e[u],r[u])}},t.createMarkupServiceWithLines=function(){return a.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=a.findChildOfType(e,"queues"),o=a.findChildOfType(e,"services"),s=a.findChildOfType(e,"reverse-queues"),l=a.findChildOfType(e,"area"),u=0;u<r.length;u++)switch(r[u]){case"queue-color":n.setAttribute("stroke",i[u]);break;case"reverse-queue-color":s.setAttribute("stroke",i[u]);break;case"service-color":o.setAttribute("stroke",i[u]);break;case"clear-all-queues":a.removeAllChildren(n),a.removeAllChildren(s);break;case"queue":t.addQueue(n,i[u]);break;case"reverse-queue":t.addQueue(s,i[u]);break;case"clear-services":a.removeAllChildren(o);break;case"service":t.addService(o,i[u]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":l.setAttribute(r[u],i[u]);break;default:e.setAttribute(r[u],i[u])}},t.createMarkupServiceWithArea=function(){return a.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=a.findChildOfType(e,"services"),o=0;o<r.length;o++)switch(r[o]){case"service-color":n.setAttribute("stroke",i[o]);break;case"clear-services":a.removeAllChildren(n);break;case"service":t.addService(n,i[o]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":break;default:e.setAttribute(r[o],i[o])}},t.createMarkupEscalatorGroup=function(){return a.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=a.findChildOfType(t,"background"),n=a.findChildOfType(t,"escalators"),s=0;s<e.length;s++)switch(e[s]){case"balustrade-color":i.setAttribute("fill",r[s]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[s]?"inherit":"hidden");break;case"dimensions-completed":var l=o.getIntAttribute(t,"number-of-escalators"),u=o.getFloatAttribute(t,"width"),c=o.getFloatAttribute(t,"length"),h=o.getFloatAttribute(t,"left-balustrade-width"),d=o.getFloatAttribute(t,"right-balustrade-width"),p=o.getFloatAttribute(t,"internal-balustrade-width"),f=o.getFloatAttribute(t,"lower-landing-length"),m=h+d+l*u+(l-1)*p,g=f+c+o.getFloatAttribute(t,"upper-landing-length");o.setMultipleAttributes(i,["y","width","height"],[-h,g,m]);for(var b=0;b<l;b++){var v=b*(u+p),y=a.cloneElementWithId("escalator"),A=a.findChildOfType(y,"background");o.setMultipleAttributes(A,["y","width","height"],[v,g,u]);var T=a.findChildOfType(y,"handrail-left"),C=a.findChildOfType(y,"handrail-right");o.setMultipleAttributes(T,["x2","y1","y2"],[g,v,v]),o.setMultipleAttributes(C,["x2","y1","y2"],[g,v+u,v+u]);var S=a.findChildOfType(y,"lower-landing-end"),E=a.findChildOfType(y,"upper-landing-end");o.setMultipleAttributes(S,["x1","x2","y1","y2"],[f,f,v,v+u]),o.setMultipleAttributes(E,["x1","x2","y1","y2"],[f+c,f+c,v,v+u]);var w=a.findChildOfType(y,"stairs");o.setMultipleAttributes(w,["x1","x2","y1","y2","stroke-width"],[f,f+c,v+u/2,v+u/2,u]),n.appendChild(y)}break;case"offsets":var k=o.splitToFloats(r[s]," "),x=a.childElements(n);for(b=0;b<x.length;b++)a.findChildOfType(x[b],"stairs").setAttribute("stroke-dashoffset",(-k[b]).toString());break;default:t.setAttribute(e[s],r[s])}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),s=parseFloat(i[1]),l=parseFloat(n[0])-a,u=parseFloat(n[1])-s,c=Math.hypot(l,u),h=3*u/c,d=3*l/c;o.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+h,a-h,s-d,s+d])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(o.getSubAttribute(i,"x")),s=parseFloat(o.getSubAttribute(i,"y")),l=o.radiansToDegrees(parseFloat(o.getSubAttribute(i,"orientation")));if("point"==o.getSubAttribute(i,"type")){(r=a.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+s+")");var u=a.createUseElement("arrowhead-small");u.setAttribute("transform","translate("+(n-11)+" "+s+") rotate("+l+" 11 0)"),t.appendChild(u)}else{(r=a.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+s+") rotate("+l+")");var c=r.firstElementChild.nextElementSibling,h=parseFloat(o.getSubAttribute(i,"length"));if(c.setAttribute("x2",h),"true"==o.getSubAttribute(i,"bidirectional")){var d=r.lastElementChild;d.setAttribute("visibility","inherit"),d.setAttribute("transform","translate("+(h+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=o.splitSkipEmpty(e,"|"),i=o.getSubAttribute(r,"queue-path"),n=a.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),o.addPathArrows(n,"arrowhead-small",.7,t,50,100);var s=o.getSubAttribute(r,"fence-color");if(s)for(var l=[o.getSubAttribute(r,"fence-path-left"),o.getSubAttribute(r,"fence-path-right")],u=0;u<l.length;u++){var c=a.createSvgElement("path");o.setMultipleAttributes(c,["d","stroke","stroke-width","stroke-dasharray"],[l[u],s,"2","none"]),t.appendChild(c)}},t}(),L=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return a.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return a.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i])},t}(),P=function(){function t(){}return t.createMarkupIntersection=function(){return a.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=a.findChildOfType(t,"lane-connectors"),s=0;s<e.length;s++)switch(e[s]){case"fill":case"d":i.setAttribute(e[s],r[s]);break;case"lane-connector":var l=a.createSvgElement("g"),u=a.createSvgElement("path");u.setAttribute("d",r[s]),l.appendChild(u),o.addPathArrows(u,"arrowhead-tiny",.5,l,20,40),n.appendChild(l);break;case"lane-connector-colors":for(var c=o.splitSkipEmpty(r[s]," "),h=a.childElements(n),d=0;d<h.length;d++)h[d].setAttribute("stroke",c[d]);break;default:t.setAttribute(e[s],r[s])}},t.createMarkupRoad=function(){return a.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=a.findChildOfType(e,"lanes"),s=a.findChildOfType(e,"delimiters"),l=a.findChildOfType(e,"median"),u=0;u<r.length;u++)switch(r[u]){case"lane-width":n.setAttribute("stroke-width",i[u]);break;case"lane-color":n.setAttribute("stroke",i[u]);break;case"forward-lane":case"backward-lane":var c=a.createSvgElement("path");c.setAttribute("d",i[u]),n.appendChild(c);break;case"lane-delimiter-color":s.setAttribute("stroke",i[u]);break;case"lane-delimiter-width":case"lane-delimiter-style":s.setAttribute(r[u],i[u]);break;case"lane-delimiter":var h=o.getFloatAttribute(s,"lane-delimiter-width"),d=s.getAttribute("lane-delimiter-style");t.addDelimiter(s,h,d,i[u],n.getAttribute("stroke"));break;case"median-color":l.setAttribute("stroke",i[u]);break;case"median-width":case"median-style":l.setAttribute(r[u],i[u]);break;case"median":h=o.getFloatAttribute(l,"median-width"),d=l.getAttribute("median-style"),t.addDelimiter(l,h,d,i[u],n.getAttribute("stroke"));break;default:e.setAttribute(r[u],i[u])}},t.addDelimiter=function(t,e,r,i,n){var s=r.includes("DASHED"),l=r.includes("DOUBLE"),u=a.createSvgElement("path");if(u.setAttribute("d",i),u.setAttribute("stroke-width",(l?3*e:e).toString()),s&&u.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(u),l){var c=a.createSvgElement("path");o.setMultipleAttributes(c,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(c)}},t.createMarkupStopLine=function(){return a.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:t.setAttribute(e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return a.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t}(),R=function(){function t(e){this.serverFPS=t.MAX_FPS,this.client=e,this.chart=new E(this),this.control=new b(this),this.shapeComposite=new s(this),this.shapeGISMap=new M(this)}return t.prototype.start=function(){this.frameDrawStartTime=Date.now(),this.catchingUp=!1,this.frameCount=0,this.fpsMeasureStartTime=null,this.actualFPS=0,this.settings={},this.packetBuffer=[],this.fullFrame=!1,this.packetFPS=t.MAX_FPS,this.desiredFPS=t.MAX_FPS,this.frameBuffer=[],this.sleepTimeStatistics=new Array(t.SLEEP_TIME_STATISTICS_SIZE),this.sleepTimeStatistics.fill(1e3/t.MAX_FPS),this.startMeasureInterval(),this.startFrameDrawingTimeout(this.desiredFPS)},t.prototype.stop=function(){this.settings={},this.packetBuffer=[],this.frameBuffer=[],this.stopMeasureInterval(),this.stopFrameDrawingTimeout()},t.prototype.startMeasureInterval=function(){var t=this;this.fpsMeasureIntervalId=setInterval(function(){return t.measureFPS()},1e3)},t.prototype.stopMeasureInterval=function(){this.fpsMeasureIntervalId&&(clearInterval(this.fpsMeasureIntervalId),this.fpsMeasureIntervalId=void 0)},t.prototype.startFrameDrawingTimeout=function(t){var e=this;this.frameDrawingTimeoutId=setTimeout(function(){var t=Date.now();e.drawFrame();var r=1e3/e.desiredFPS-(Date.now()-t);r<0&&(r=0),e.sleepTimeStatistics.push(r),e.sleepTimeStatistics.shift(),e.startFrameDrawingTimeout(r)},t)},t.prototype.stopFrameDrawingTimeout=function(){this.frameDrawingTimeoutId&&(clearTimeout(this.frameDrawingTimeoutId),this.frameDrawingTimeoutId=void 0)},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.totalFrameCount=function(){var t=this.frameBuffer.length;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.findOrRequestFullFrame=function(){if(this.fullFrame)console.log("Found a full frame in the local buffer, starting from there");else{for(var t=0;t<this.packetBuffer.length;t++){if(this.packetBuffer[t].fullFrame)return console.log("Found a full frame in the local buffer, starting from there"),void this.packetBuffer.splice(0,t)}this.packetBuffer=[],console.log("Cleared local frame buffer, requesting full frame from the server"),this.client.network.requestAndWaitFullFrame()}},t.prototype.switchToNextFrame=function(){if(0==this.frameBuffer.length){if(0==this.packetBuffer.length)return this.fullFrame=!1,this.packetFPS=t.MAX_FPS,void(this.desiredFPS=t.MAX_FPS);var e=this.packetBuffer.shift();this.frameBuffer=e.frames,this.fullFrame=e.fullFrame,this.packetFPS=e.fps,this.desiredFPS=e.fps,this.updateServerFpsIfNeeded()}return this.frameBuffer.shift()},t.prototype.updateServerFpsIfNeeded=function(){var e=this.actualFPS/this.packetFPS,r=this.measureSleepTime();if(e>=.9&&r>50&&this.serverFPS<t.MAX_FPS)return this.serverFPS++,void this.client.network.postMaxFPS(this.serverFPS);e<.9&&r<50&&this.serverFPS>1&&(this.serverFPS--,e<.7&&this.serverFPS>1&&this.serverFPS--,e<.6&&this.serverFPS>1&&this.serverFPS--,this.client.network.postMaxFPS(this.serverFPS))},t.prototype.measureSleepTime=function(){for(var t=0,e=0;e<this.sleepTimeStatistics.length;e++)t+=this.sleepTimeStatistics[e];return t/=this.sleepTimeStatistics.length},t.prototype.drawFrame=function(){var t=this.switchToNextFrame();if(t){this.client.updateExperimentState(t),this.fullFrame&&(this.fullFrame=!1,a.removeAllChildren(this.client.presentation)),this.frameDrawStartTime=Date.now(),this.client.svg.suspendRedraw(5e3),this.time=t.time;var e,r,i,s=t.commands;if(s.length>0&&"white"!=this.client.svg.style.backgroundColor&&(this.client.svg.style.backgroundColor="white"),U.DEBUG_MODE){var l=this.totalFrameCount();this.client.debugger.timeInfo.innerHTML=o.formatNumber(this.time,2),this.client.debugger.serverQueueInfo.innerHTML=this.client.network.serverQueue,this.client.debugger.browserQueueInfo.innerHTML=l+":"+this.client.network.packetManager.totalFrameCount(),e=0,r=0,i=0}for(var u=0;u<s.length;u++){var c=s[u],h=void 0,d=c.groupId,p=c.att,f=c.val,m=void 0;switch(c.cmd){case"C":if(m=this.createShape(c.type,c.id),null==d)this.client.presentation.appendChild(m);else{if(null==(h=document.getElementById(d)))return console.log("Can't find container to add a shape to, container id = "+d,c),void this.findOrRequestFullFrame();if("ShapeGISMap"==h.getAttribute("type")){var g=a.findChildOfType(h,"map").firstElementChild;h=c.type.startsWith("MarkupGIS")?a.findChildOfType(g,"markup"):a.findChildOfType(g,"agents")}h.appendChild(m)}this.updateShape(m,p,f),e++;break;case"U":if(null==(m=document.getElementById(c.id)))return console.log("Can't find shape to be updated, shape id = "+c.id,c),void this.findOrRequestFullFrame();this.updateShape(m,p,f),r++;break;case"D":if(null==(m=document.getElementById(c.id)))return console.log("Can't find shape to be deleted, shape id = "+c.id,c),void this.findOrRequestFullFrame();a.removeElement(m.parentNode,m),i++;break;case"N":this.applyNavigation(p,f);break;case"S":this.applySettings(p,f);break;default:return void this.client.stopAndAlert("Unknown command: "+c.cmd,null)}}this.client.svg.unsuspendRedrawAll(),this.frameCount++,U.DEBUG_MODE&&(this.client.debugger.cudCountInfo.innerHTML=e+"/"+r+"/"+i,this.client.debugger.drawTimeInfo.innerHTML=Date.now()-this.frameDrawStartTime,this.client.debugger.shapeCountInfo.innerHTML=n.elementcount),!this.catchingUp&&this.packetBuffer.length>1?(this.catchingUp=!0,this.desiredFPS=1e3/this.packetFPS*.8):this.catchingUp&&(this.catchingUp=!1,this.desiredFPS=1e3/this.packetFPS)}},t.prototype.createShape=function(t,e){var r;if(a.isPrimitiveSVGElement(t))r=a.createSvgElement(t);else switch(t){case"ShapeArc":r=s.createShapeArc();break;case"ShapeText":r=s.createShapeText();break;case"ShapeImage":r=s.createShapeImage();break;case"ShapeCanvas":r=s.createShapeCanvas(e);break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=I.createMarkupPath(t,e);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=I.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=I.createMarkupPalletRack();break;case"MarkupRailwaySwitch":r=L.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=L.createMarkupPositionOnTrack();break;case"MarkupPipe":r=O.createMarkupPipe(e);break;case"MarkupStorageTank":r=O.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=O.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=_.createMarkupWall(t,e);break;case"MarkupTargetLine":r=_.createMarkupTargetLine();break;case"MarkupPathway":r=_.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=_.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=_.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=_.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=_.createMarkupEscalatorGroup();break;case"MarkupIntersection":r=P.createMarkupIntersection();break;case"MarkupRoad":r=P.createMarkupRoad();break;case"MarkupStopLine":r=P.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=P.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=x.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=E.create();break;case"Window3D":r=l.create();break;default:return this.client.stopAndAlert("Can't create: unknown object type: "+t,void 0),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(t,e,r){var i=t.getAttribute("type");if(a.isPrimitiveSVGElement(i))for(var n=0;n<e.length;n++)if("href"==e[n])t.setAttributeNS(a.xlinkns,"href",r[n]);else if("href-path"==e[n])t.setAttributeNS(a.xlinkns,"href",this.client.network.getJarResourceURL(r[n]));else if("geo"==e[n]){var o=r[n].split("|");t.setAttribute("lon",o[0]),t.setAttribute("lat",o[1]),t.setAttribute("heading",o[2]),M.updateGISObjectPosition(t)}else t.setAttribute(e[n],r[n]);else switch(i){case"ShapeArc":s.updateShapeArc(t,e,r);break;case"ShapeText":s.updateShapeText(t,e,r);break;case"ShapeImage":this.shapeComposite.updateShapeImage(t,e,r);break;case"ShapeCanvas":s.updateShapeCanvas(t,e,r);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(t,e,r);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(t,e,r);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":I.updateMarkupPath(t,e,r);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":I.updateMarkupAreaNode(t,e,r);break;case"MarkupPalletRack":I.updateMarkupPalletRack(t,e,r);break;case"MarkupRailwaySwitch":L.updateMarkupRailwaySwitch(t,e,r);break;case"MarkupPositionOnTrack":L.updateMarkupPositionOnTrack(t,e,r);break;case"MarkupPipe":O.updateMarkupPipe(t,e,r);break;case"MarkupStorageTank":O.updateMarkupStorageTank(t,e,r);break;case"MarkupBulkConveyorBelt":O.updateMarkupBulkConveyorBelt(t,e,r);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":_.updateMarkupWall(t,e,r);break;case"MarkupTargetLine":_.updateMarkupTargetLine(t,e,r);break;case"MarkupPathway":_.updateMarkupPathway(t,e,r);break;case"MarkupPedFlowStatistics":_.updateMarkupPedFlowStatistics(t,e,r);break;case"MarkupServiceWithLines":_.updateMarkupServiceWithLines(t,e,r);break;case"MarkupServiceWithArea":_.updateMarkupServiceWithArea(t,e,r);break;case"MarkupEscalatorGroup":_.updateMarkupEscalatorGroup(t,e,r);break;case"MarkupIntersection":P.updateMarkupIntersection(t,e,r);break;case"MarkupRoad":P.updateMarkupRoad(t,e,r);break;case"MarkupStopLine":P.updateMarkupStopLine(t,e,r);break;case"MarkupBusStop":case"MarkupParkingLot":P.updateMarkupBusStopOrParkingLot(t,e,r);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":x.updateGISMarkup(t,e,r);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(t,e,r);break;case"Window3D":l.update(t,e,r)}},t.prototype.measureFPS=function(){var t=Date.now();null!=this.fpsMeasureStartTime&&(this.actualFPS=Math.round(1e3*this.frameCount/(t-this.fpsMeasureStartTime))),U.DEBUG_MODE&&(this.client.debugger.fpsInfo.innerHTML=this.actualFPS+":"+this.packetFPS),this.fpsMeasureStartTime=t,this.frameCount=0},t.prototype.onControlAction=function(t,e){this.client.network.postUserAction(t,e)},t.prototype.onUserClick=function(t,e,r){a.isContainedInElementOfType(t,b.controlTypes)||a.isContainedInElementOfType(t,E.chartTypes)||a.isContainedInElementOfType(t,["Window3D"])||a.isContainedInElementOfType(t,["ShapeGISMap"])||this.client.network.postUserAction(0,e+" "+r)},t.prototype.applySettings=function(t,e){for(var r=0;r<t.length;r++)this.settings[o.hyphenToCameLCase(t[r])]=e[r];this.settings.startTime=parseInt(this.settings.startTime),this.settings.startDate=parseInt(this.settings.startDate),this.settings.stopTime&&(this.settings.stopTime=parseInt(this.settings.startTime),this.settings.stopDate=parseInt(this.settings.startDate)),U.DEBUG_SPARK_LOCAL&&(this.client.svg.style.width=this.settings.width+"px",this.client.svg.style.height=this.settings.height+"px")},t.prototype.applyNavigation=function(t,e){for(var r,i,n,a=0;a<t.length;a++)switch(t[a]){case"x":r=parseFloat(e[a]);break;case"y":i=parseFloat(e[a]);break;case"zoom":n=parseFloat(e[a])}this.client.navigation.navigateTo(r,i,n)},t.SLEEP_TIME_STATISTICS_SIZE=20,t.MAX_FPS=20,t}(),F=function(){function t(t,e,r){var i=this;this.networkManager=t,this.startTime=Date.now(),this.xhttp=this.networkManager.getAnimationPacket(e,function(){i.stopTime=Date.now(),r(i)})}return t.prototype.requestTime=function(){return this.stopTime?this.stopTime-this.startTime:Date.now()-this.startTime},t.prototype.abort=function(){this.xhttp.abort()},t}(),D=function(){function t(t){this.paused=!1,this.networkManager=t}return t.prototype.start=function(){this.fullFrame=!0,this.activeRequests=[],this.responseTimeStatistics=new Array(t.REQUEST_STATISTICS_SIZE),this.responseTimeStatistics.fill(B.MIN_REQUEST_INTERVAL),this.requestInterval=B.MIN_REQUEST_INTERVAL,this.lastRequestTime=0,this.createRequest(),this.startRequestTimeout()},t.prototype.stop=function(){this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.pause=function(){this.paused=!0,this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.requestFullFrame=function(){console.debug(">> SVG: Request full frame."),this.fullFrame=!0},t.prototype.startRequestTimeout=function(){var t=this;this.requestTimeoutId=setTimeout(function(){t.processRequestTimeout()},this.requestInterval)},t.prototype.processRequestTimeout=function(){this.requestTimeoutId=void 0,this.activeRequests.length<B.MAX_REQUEST_COUNT&&(this.createRequest(),this.startRequestTimeout())},t.prototype.createRequest=function(){var t=this,e=new F(this.networkManager,this.fullFrame,function(e){return t.processResponse(e)});this.fullFrame=!1,this.activeRequests.push(e),this.lastRequestTime=Date.now()},t.prototype.processResponse=function(t){var e=this.activeRequests.indexOf(t);if(this.activeRequests.splice(e,1),this.addToResponseTimeStatistics(t.requestTime()),void 0!==this.requestTimeoutId||this.paused||(this.createRequest(),this.startRequestTimeout()),4==t.xhttp.readyState&&200==t.xhttp.status){var r=JSON.parse(t.xhttp.responseText);this.networkManager.packetManager.addPacket(r)}},t.prototype.addToResponseTimeStatistics=function(t){this.responseTimeStatistics.push(t),this.responseTimeStatistics.shift(),this.requestInterval=this.calculateRequestInterval(),this.networkManager.RPS=1e3/this.requestInterval},t.prototype.calculateRequestInterval=function(){if(0===this.responseTimeStatistics.length)return B.MIN_REQUEST_INTERVAL;for(var t=0,e=0;e<this.responseTimeStatistics.length;e++)t+=this.responseTimeStatistics[e];var r=t/this.responseTimeStatistics.length*.5;return r<B.MIN_REQUEST_INTERVAL?B.MIN_REQUEST_INTERVAL:r>B.MAX_REQUEST_INTERVAL?B.MAX_REQUEST_INTERVAL:r},t.REQUEST_STATISTICS_SIZE=10,t}(),N=function(){function t(t){this.client=t,this.reset()}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.waitingFullFrame=!1,this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.pause=function(){this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.addPacket=function(t){if(t){var e=t.frames;if(e&&0!==e.length){var r=e[0];if(!(r.number<this.expectedFrameNumber)){if(r.number===this.expectedFrameNumber||t.fullFrame){this.client.network.serverQueue=t.serverQueue;var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),this.cancelWaitExpectedFrameTimeoutIfNeeded(),void(t.fullFrame&&(this.waitingFullFrame=!1))}this.insertToPacketBuffer(t),console.debug(">> SVG: Reordering  or packet loss expectedFrame=",this.expectedFrameNumber),this.startWaitExpectedFrameTimeoutIfNeeded()}}}},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length&&!(this.packetBuffer[0].frames[0].number>=this.expectedFrameNumber)){var t=this.packetBuffer[this.packetBuffer.length-1];if(t.frames[t.frames.length-1].number>=this.expectedFrameNumber)this.packetBuffer=[];else{for(var e=0;e<this.packetBuffer.length&&!(this.packetBuffer[e].frames[0].number>=this.expectedFrameNumber);e++);this.packetBuffer.splice(0,e)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length&&this.packetBuffer[0].frames[0].number===this.expectedFrameNumber){for(var t=this.expectedFrameNumber,e=0;e<this.packetBuffer.length;e++){var r=this.packetBuffer[e].frames;if(r[0].number!==t)break;t=r[r.length-1].number+1}var i=this.packetBuffer.splice(0,e);this.client.frameDrawing.addAllPackets(i),this.expectedFrameNumber=t}},t.prototype.cancelWaitExpectedFrameTimeoutIfNeeded=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startWaitExpectedFrameTimeoutIfNeeded=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,t.client.network.requestFullFrame()},4*this.client.network.RPS*1e3))},t.prototype.waitFullFrame=function(){console.debug(">> SVG: Wait full frame."),this.waitingFullFrame=!0,this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t}(),B=function(){function t(t){this.client=t,this.packetRequester=new D(this),this.packetManager=new N(t)}return t.prototype.start=function(){this.packetManager.reset(),this.packetRequester.start()},t.prototype.stop=function(){this.packetRequester.stop(),this.packetManager.reset()},t.prototype.pause=function(){this.paused=!0,this.packetRequester.pause()},t.prototype.getAnimationPacket=function(t,e){if(!this.paused){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},U.DEBUG_SPARK_LOCAL?r.open("GET","/http/update?fullFrame="+t+"&time="+Date.now(),!0):r.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+Date.now(),!0),r.send(),r}},t.prototype.postUserAction=function(t,e){if(!this.paused){var r=new XMLHttpRequest;U.DEBUG_SPARK_LOCAL?r.open("GET","/http/useraction?id="+t+"&value="+encodeURIComponent(e)):r.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),r.send()}},t.prototype.postUserCommand=function(t,e){if(!this.paused){var r=new XMLHttpRequest;r.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),r.send()}},t.prototype.getJarResourceURL=function(t){return this.getResourceURLWithSubpath("internal-resources",t)},t.prototype.getResourceURL=function(t){return this.getResourceURLWithSubpath("resources",t)},t.prototype.getResourceURLWithSubpath=function(t,e){if(!this.paused)return U.DEBUG_SPARK_LOCAL?"/http/image?path="+e:this.getRestRoot()+t+"?path="+e},t.prototype.getRestRoot=function(){return this.client.svgAnimationInfo.host+"/nodes/"+this.client.svgAnimationInfo.restUrl+"sessions/"+this.client.svgAnimationInfo.sessionUuid+"/"},t.prototype.postMaxFPS=function(t){if(!this.paused){var e=new XMLHttpRequest;U.DEBUG_SPARK_LOCAL?e.open("POST","http/max-fps"):e.open("POST",this.getRestRoot()+"max-fps"),e.send(t.toString())}},t.prototype.requestFullFrame=function(){this.packetRequester.requestFullFrame()},t.prototype.requestAndWaitFullFrame=function(){this.packetRequester.requestFullFrame(),this.packetManager.waitFullFrame()},t.MIN_REQUEST_INTERVAL=500,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_REQUEST_COUNT=2,t}(),G=function(){function t(e){var r=this;this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDebugContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDebugContainer.parentElement,this.controlPanel=document.getElementById("control-panel"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDebugTools=document.getElementById("control-panel-button-dev-panel"),this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpInfoState=document.getElementById("control-panel-info-state"),t.assignActionOnClick(this.cpButtonRun,function(){return r.client.network.postUserCommand("run","")}),t.assignActionOnClick(this.cpButtonPause,function(){return r.client.network.postUserCommand("pause","")}),t.assignActionOnClick(this.cpButtonX1,function(){return r.setSpeed(1)}),t.assignActionOnClick(this.cpButtonSlower,function(){return r.speedUpOrDown(!1)}),t.assignActionOnClick(this.cpButtonFaster,function(){return r.speedUpOrDown(!0)}),t.assignActionOnClick(this.cpButtonVirtual,function(){return r.setSpeed(1/0)}),this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},t.assignActionOnClick(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),w.addFullScreenListener(function(){return r.onFullScreenChange()}),this.cpButtonDebugTools.style.display="none"}return t.prototype.updateExperimentState=function(){this.updateInfoState(),this.updateModelTimeScale(),this.updateRunGroup(),this.updateSpeedGroup()},t.prototype.updateModelTimeScale=function(){this.cpInfoScale.innerText=t.timeScaleToString(this.client.getModelTimeScale())},t.prototype.updateExperimentProgress=function(){var t=this.client.getModelProgress(),e=this.progressBar.firstElementChild,r=100*t;this.progressBar.style.width=t<=0?"0":r+"%",e.innerText=t<0?"progress n/a":Math.round(r)+"%"},t.prototype.updateInfoState=function(){var e=this.client.getModelState(),r=t.modelStateToString(e);this.cpInfoState.innerText=t.modelStateToString(r),this.indicateCpErrorState("ERROR"==e)},t.prototype.indicateCpErrorState=function(t){t?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getModelState()&&this.indicateCpErrorState(!1)},t.prototype.updateRunGroup=function(){var e=this.client.getModelState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e;t.setVisible(this.cpButtonRun,!r),this.setEnabled(this.cpButtonRun,!r&&i),t.setVisible(this.cpButtonPause,r),this.setEnabled(this.cpButtonPause,r)},t.prototype.updateSpeedGroup=function(){var e=this.client.getModelState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e,i=t.stringToTimeScale(this.cpInfoScale.innerText);this.setEnabled(this.cpButtonX1,r&&1!=i),this.setEnabled(this.cpButtonSlower,r&&i>t.speeds[0]),this.setEnabled(this.cpButtonFaster,r&&i!=1/0),this.setEnabled(this.cpButtonVirtual,r&&i!=1/0)},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=f.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r)},t.prototype.setSpeed=function(e){this.cpInfoScale.innerText=t.timeScaleToString(e),this.client.network.postUserCommand("setspeed",e.toString()),this.updateSpeedGroup()},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=w.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed"))},t.prototype.toggleFullScreen=function(){w.toggleFullScreen(this.presentationContainer)},t.modelStateToString=function(t){switch(t){case"INITIALIZE":return"Initializing...";case"IDLE":return"Idle";case"RUNNING":return"Running";case"PAUSED":return"Paused";case"FINISHED":return"Finished.";case"ERROR":return"Error!";case"PLEASE_WAIT":return"Please Wait..."}return t},t.timeScaleToString=function(t){return t<0||t==1/0?"Virtual":t>=1?"x"+t:"x1/"+1/t},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.setVisible=function(t,e){e?t.style.removeProperty("display"):t.style.display="none"},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.assignActionOnClick=function(e,r){e.onclick=function(){t.isEnabled(e)&&r()}},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t}(),U=function(){function t(){this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new R(this),this.navigation=new k(this),this.network=new B(this),this.controlPanel=new G(this)}return t.prototype.start=function(t){this.svgAnimationInfo=t,this.svg.style.pointerEvents="auto",this.navigation.initSVGNavigation(),this.network.start(),this.frameDrawing.start(),this.navigation.updateSVGSize()},t.prototype.stop=function(t){t?(this.modelState=t.type,this.controlPanel.updateExperimentState()):this.modelState=void 0,this.frameDrawing.stop(),this.navigation.clearSVGNavigation(),this.network.stop(),a.removeAllChildren(this.presentation)},t.prototype.setCallback=function(t,e){},t.prototype.pause=function(){this.network.pause()},t.prototype.stopAndAlert=function(t,e){this.frameDrawing.stop(),console.log(t),e&&console.log(e)},t.prototype.updateExperimentState=function(t){t.state!=this.modelState&&(this.modelState=t.state,this.controlPanel.updateExperimentState()),t.progress!=this.modelProgress&&(this.modelProgress=t.progress,this.controlPanel.updateExperimentProgress()),t.time!=this.modelTime&&(this.modelTime=t.time),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.controlPanel.updateModelTimeScale())},t.prototype.getModelTime=function(){},t.prototype.getModelState=function(){},t.prototype.getModelTimeScale=function(){},t.prototype.getModelProgress=function(){},t.DEBUG_MODE=!1,t.DEBUG_SPARK_LOCAL=!1,t}(),H=function(){function t(){}return t.createClient=function(){return new U},t.createDebugger=function(){return new n(new U)},t}(),z=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(e){var r=this;gt.DEBUG_MODE=!0,gt.DEBUG_SPARK_LOCAL=e,this.client.debugger=this,this.serverQueueInfo=document.getElementById("dev-panel-info-server-queue"),this.browserQueueInfo=document.getElementById("dev-panel-info-browser-queue"),this.parseTimeInfo=document.getElementById("dev-panel-info-parse-time"),this.shapeCountInfo=document.getElementById("dev-panel-info-shape-count"),this.cudCountInfo=document.getElementById("dev-panel-info-cud-count"),this.drawTimeInfo=document.getElementById("dev-panel-info-draw-time"),this.fpsInfo=document.getElementById("dev-panel-info-fps"),this.timeInfo=document.getElementById("dev-panel-info-time"),e&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return r.onNewModelSelected()}),t.elementcount=0},t.prototype.stop=function(){this.serverQueueInfo=void 0,this.browserQueueInfo=void 0,this.parseTimeInfo=void 0,this.shapeCountInfo=void 0,this.cudCountInfo=void 0,this.drawTimeInfo=void 0,this.fpsInfo=void 0,this.timeInfo=void 0,this.modelSelector&&(this.modelSelector.onchange=void 0,this.modelSelector=void 0),t.elementcount=0},t.prototype.onNewModelSelected=function(){var e=this;if(null!=this.client.svg&&this.client.stop("TERMINATED"),this.shapeCountInfo.innerHTML=t.elementcount,"NO MODEL SELECTED"!=this.modelSelector.value){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&e.client.start({})},r.open("GET","/http/start?path="+this.modelSelector.value,!0),r.send()}},t}(),W=function(){function t(){}return t.createSvgElement=function(e){return gt.DEBUG_MODE&&z.elementcount++,document.createElementNS(t.svgns,e)},t.createXhtmlElement=function(e){return gt.DEBUG_MODE&&z.elementcount++,document.createElementNS(t.xhtmlns,e)},t.createTextNode=function(t){return gt.DEBUG_MODE&&z.elementcount++,document.createTextNode(t)},t.createUseElement=function(e){var r=t.createSvgElement("use"),i="#"+e;return r.setAttributeNS(t.xlinkns,"href",i),r},t.cloneElementWithId=function(e){var r=document.getElementById(e);return t.cloneElement(r)},t.cloneElement=function(e){var r=e.cloneNode(!0);return r.removeAttribute("id"),gt.DEBUG_MODE&&(z.elementcount+=1+t.childNodeDeepCount(r)),r},t.removeElement=function(e,r){var i=document.getElementById("canvas-group");if(i)for(var n=i.children,a=n.length-1;a>=0;a--){var o=parseInt(n[a].id),s=document.getElementById(o.toString());(r==s||r.contains(s))&&i.removeChild(n[a])}gt.DEBUG_MODE&&(z.elementcount-=1+t.childNodeDeepCount(r)),e.removeChild(r)},t.removeAllChildren=function(e){for(;e.lastChild;)t.removeElement(e,e.lastChild)},t.bringElementToFront=function(t){t.parentNode.appendChild(t)},t.childElements=function(t){var e=t.children;if(!e){for(var r=t.childNodes,i=[],n=0;n<r.length;n++){var a=r[n];1==a.nodeType&&i.push(a)}return i}return e},t.isPrimitiveSVGElement=function(t){return!(t.startsWith("Shape")||t.startsWith("Markup")||t.startsWith("Control")||t.startsWith("Chart")||t.startsWith("Window3D"))},t.isContainedInElementOfType=function(t,e){for(;t&&1==t.nodeType&&e.indexOf(t.getAttribute("type"))<0;)t=t.parentNode;return t&&1==t.nodeType},t.findChildOfType=function(e,r){for(var i=t.childElements(e),n=0;n<i.length;n++)if(i[n].getAttribute("type")==r)return i[n];return console.log("Child of type "+r+" not found in",e),null},t.findParentOfType=function(t,e){for(var r=t.parentNode;;){if(!r||1!=r.nodeType)return null;var i=r;if(i.getAttribute("type")==e)return i;r=i.parentNode}},t.childNodeDeepCount=function(e){var r=e.childNodes;if(!r)return 0;for(var i=r.length,n=0;n<r.length;n++)i+=t.childNodeDeepCount(r[n]);return i},t.createCanvas=function(){var e=t.createXhtmlElement("canvas");return document.getElementById("canvas-group").appendChild(e),e},t.xhtmlns="http://www.w3.org/1999/xhtml",t.xlinkns="http://www.w3.org/1999/xlink",t.svgns="http://www.w3.org/2000/svg",t}(),V=function(){function t(){}return t.offsetPage=function(t){var e=t.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+i,left:e.left+r}},t.indexInParent=function(t){var e;for(e=0;t=t.previousElementSibling;e++);return e},t.radiansToDegrees=function(t){return 360*t/(2*Math.PI)},t.modulo=function(t,e){var r=t%e;return Math.floor(r>=0?r:r+e)},t.remainderPositive=function(t,e){var r=t%e;return r>=0?r:r+e},t.formatNumber=function(t,e){if(t==-1/0)return"-Infinity";if(t==1/0)return"+Infinity";if(isNaN(t))return"NaN";var r=Math.abs(t);return r<1e-12?String(0):r>9999999999||r<.001&&0!=t?String(+t.toExponential(2)):String(+t.toFixed(2))},t.formatPercent=function(t){return+Math.round(100*t)+"%"},t.reducePrecision=function(t){return+t.toPrecision(4)},t.dateComponent=function(t,e){var r,i=t.getFullYear();switch(e){case"YYYY":return String(i);case"MMM":switch(t.getMonth()+1){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return null}case"MM":r=t.getMonth()+1;break;case"DD":r=t.getDate();break;case"HH":r=t.getHours();break;case"mm":r=t.getMinutes();break;case"ss":r=t.getSeconds()}return r<10?"0"+r:String(r)},t.formatDate=function(e,r){switch(r){case"YYYY":return t.dateComponent(e,"YYYY");case"MMMYYYY":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"YYYY");case"DDMMM":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"DD");case"DDMMHH":return t.dateComponent(e,"MM")+"/"+t.dateComponent(e,"DD")+" "+t.dateComponent(e,"HH")+":00";case"HHmm":return t.dateComponent(e,"HH")+":"+t.dateComponent(e,"mm");case"mmss":default:return t.dateComponent(e,"mm")+"'"+t.dateComponent(e,"ss")+"''"}},t.toMilliseconds=function(e,r){switch(e.modelSettings.timeUnit){case"MILLISECOND":return r*t.MILLISECOND;case"SECOND":return r*t.SECOND;case"MINUTE":return r*t.MINUTE;case"HOUR":return r*t.HOUR;case"DAY":return r*t.DAY;case"WEEK":return r*t.WEEK;case"MONTH":return r*t.MONTH;case"YEAR":return r*t.YEAR}},t.toDate=function(e,r){var i=e.modelSettings,n=r-i.startTime;return new Date(i.startDate+t.toMilliseconds(e,n))},t.date=function(e){return t.toDate(e,e.time)},t.setMultipleAttributes=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i].toString())},t.getSubAttribute=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].split(":");if(2==i.length&&i[0]==e)return i[1]}return null},t.getIntAttribute=function(t,e){return parseInt(t.getAttribute(e))},t.getFloatAttribute=function(t,e){return parseFloat(t.getAttribute(e))},t.splitSkipEmpty=function(e,r){return e.split(r).filter(t.isEmpty)},t.isEmpty=function(t){return t.length>0},t.splitToFloats=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseFloat(i[n]);return i},t.splitToInts=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseInt(i[n]);return i},t.hyphenToCameLCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.parseTranslateTransform=function(e){var r=t.translateRegExp2.exec(e);return null!=r?[parseFloat(r[1]),parseFloat(r[2])]:(r=t.translateRegExp1.exec(e),[parseFloat(r[1]),0])},t.increaseTransparency=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=i[4]?i[4]:1;return"rgba("+i[1]+","+i[2]+","+i[3]+","+r*n+")"},t.addPathArrows=function(e,r,i,n,a,o){for(var s=e.getTotalLength(),l=a;l<s;l+=o){var u=e.getPointAtLength(l),c=e.getPointAtLength(l-3),h=t.radiansToDegrees(Math.PI/2-Math.atan2(u.x-c.x,u.y-c.y)),d=W.createUseElement(r);d.setAttribute("stroke-width",i.toString()),d.setAttribute("transform","translate("+u.x+" "+u.y+") rotate( "+h+")"),n.appendChild(d)}},t.sectorData=function(t,e,r,i,n,a){var o=Math.abs(a)>2*Math.PI?a%(2*Math.PI):a;a==2*Math.PI&&(a-=1e-4);var s=n+a,l=t+r*Math.cos(n),u=e+i*Math.sin(n),c=t+r*Math.cos(s),h=e+i*Math.sin(s);return"M "+t+" "+e+" L "+l+" "+u+" A "+r+" "+i+" 0 "+(Math.abs(o)>Math.PI?"1 ":"0 ")+(o>0?"1 ":"0 ")+c+" "+h+" Z"},t.roundPathCorners=function(t,e,r){function i(t,e,r){var i=e.x-t.x,a=e.y-t.y,o=Math.sqrt(i*i+a*a);return n(t,e,Math.min(1,r/o))}function n(t,e,r){return{x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}}function a(t,e){t.length>2&&(t[t.length-2]=e.x,t[t.length-1]=e.y)}function o(t){return{x:parseFloat(t[t.length-2]),y:parseFloat(t[t.length-1])}}var s=t.split(/[,\s]/).reduce(function(t,e){var r=e.match("([a-zA-Z])(.+)");return r?(t.push(r[1]),t.push(r[2])):t.push(e),t},[]).reduce(function(t,e){return parseFloat(e)==e&&t.length?t[t.length-1].push(e):t.push([e]),t},[]),l=[];if(s.length>1){var u=o(s[0]),c=null;"Z"==s[s.length-1][0]&&s[0].length>2&&(c=["L",u.x,u.y],s[s.length-1]=c),l.push(s[0]);for(var h=1;h<s.length;h++){var d=l[l.length-1],p=s[h],f=p==c?s[1]:s[h+1];if(f&&d&&d.length>2&&"L"==p[0]&&f.length>2&&"L"==f[0]){var m,g,b=o(d),v=o(p),y=o(f);r?(m=n(v,d.origPoint||b,e),g=n(v,f.origPoint||y,e)):(m=i(v,b,e),g=i(v,y,e)),a(p,m),p.origPoint=v,l.push(p);var A=n(m,v,.5),T=n(v,g,.5),C=["C",A.x,A.y,T.x,T.y,g.x,g.y];C.origPoint=v,l.push(C)}else l.push(p)}if(c){var S=o(l[l.length-1]);l.push(["Z"]),a(l[0],S)}}else l=s;return l.reduce(function(t,e){return t+e.join(" ")+" "},"")},t.stringToByteArray=function(t){for(var e=[],r=0,i=0;i<t.length;i++){for(var n=t.charCodeAt(i);n>255;)e[r++]=255&n,n>>=8;e[r++]=n}return e},t.byteArrayToString=function(t){if(t.length<=8192)return String.fromCharCode.apply(null,t);for(var e="",r=0;r<t.length;r+=8192){var i=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,i)}return e},t.translateRegExp1=/^translate\s*\(\s*(-?\d*.?\d*)\s*\)\s*$/i,t.translateRegExp2=/^translate\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)\s*$/i,t.rgbRegExp=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,t.rgbaRegExp=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*.?\d*)\s*\)\s*$/i,t.MILLISECOND=1,t.SECOND=1e3*t.MILLISECOND,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.MONTH=30*t.DAY,t.YEAR=365*t.DAY,t}(),Y=function(){function t(t){this.frameDrawing=t}return t.createShapeArc=function(){return W.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createShapeText=function(){return W.createSvgElement("text")},t.updateShapeText=function(t,e,r){for(var i=0;i<e.length;i++)if("text-content"==e[i]){null==r[i]&&(r[i]="");var n=r[i].split("\n"),a=t.childElementCount;if(1==n.length&&1==a)t.firstChild.firstChild.textContent=n[0];else{for(var o=V.getFloatAttribute(t,"first-line-offset"),s=V.getFloatAttribute(t,"line-height"),l=0;l<n.length;l++){var u=W.childElements(t),c=n[l];if(c.endsWith("\r")&&(c=c.substring(0,c.length-1)),u[l])u[l].firstChild.textContent=c;else{var h=W.createSvgElement("tspan");h.setAttribute("x","0"),h.setAttribute("y",(o+l*s).toString());var d=W.createTextNode(c);h.appendChild(d),t.appendChild(h)}}for(;t.childElementCount>n.length;)W.removeElement(t,t.lastChild)}}else t.setAttribute(e[i],r[i])},t.createShapeImage=function(){return W.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":W.removeAllChildren(t);break;case"add":var n=W.createSvgElement("image");n.setAttributeNS(W.xlinkns,"href",this.frameDrawing.client.network.getJarResourceURL(r[i])),n.setAttribute("visibility","hidden"),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var a=parseInt(r[i]),o=t.childNodes,s=0;s<o.length;s++)(n=o[s]).setAttribute("visibility",s==a?"inherit":"hidden");break;case"width":case"height":o=t.childNodes;for(s=0;s<o.length;s++)(n=o[s]).setAttribute(e[i],r[i]);default:t.setAttribute(e[i],r[i])}},t.createShapeCanvas=function(t){var e=W.createSvgElement("image");return W.createCanvas().id=t+"canvas",e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),a=n.getContext("2d"),o=0;o<e.length;o++)switch(e[o]){case"width":case"height":i.setAttribute(e[o],r[o]),n.setAttribute(e[o],r[o]);break;case"fill-rect":case"clear-rect":var s=V.splitToFloats(r[o]," "),l=s[0],u=s[1],c=s[2],h=s[3];if("clear-rect"==e[o])a.clearRect(l,u,c,h);else{var d=s[4];a.fillStyle=d,a.fillRect(l,u,c,h)}break;case"fill-circle":s=r[o].split(" ");var p=parseFloat(s[0]),f=parseFloat(s[1]),m=parseFloat(s[2]),g=s[3];a.fillStyle=g,a.beginPath(),a.arc(p,f,m,0,2*Math.PI),a.fill();break;case"clear":a.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(W.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;default:t.setAttribute(e[o],r[o])}},t.createUnsupportedObject=function(t){var e=W.cloneElementWithId("unsupported-object");return W.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=W.findChildOfType(t,"background"),n=W.findChildOfType(t,"text"),a=0;a<e.length;a++)switch(e[a]){case"width":var o=parseFloat(r[a]);i.setAttribute("width",o.toString());var s=n.getBBox();o<s.width&&(n.firstChild.textContent="Not supported",s=n.getBBox()),o<s.width&&(n.firstChild.textContent="N/A",s=n.getBBox()),o<s.width&&(n.firstChild.textContent=""),n.setAttribute("x",(o/2).toString());break;case"height":var l=parseFloat(r[a]);i.setAttribute("height",l.toString()),n.setAttribute("y",(l/2+3).toString());break;default:t.setAttribute(e[a],r[a])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeGISMap"],t}(),j=function(){function t(){}return t.create=function(){return Y.createUnsupportedObject("Vector 3D is under development. To view 3D use Play(video)")},t.update=function(t,e,r){Y.updateUnsupportedObject(t,e,r)},t}(),X=function(){function t(t,e){this.frameDrawing=t,this.control=e}return t.createControlList=function(){var e=W.cloneElementWithId("control-list"),r=function(e){return t.onControlListMouseEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("wheel",r);var i=W.findChildOfType(e,"svg"),n=W.findChildOfType(i,"scrollbargroup"),a=function(e){return t.onControlListScrollbarMouseEvent(e)};return n.addEventListener("mouseout",a),n.addEventListener("mousedown",a),n.addEventListener("mouseup",a),n.addEventListener("mousemove",a),n.addEventListener("click",a),e},t.prototype.updateControlList=function(e,r,i){for(var n=W.findChildOfType(e,"svg"),a=W.findChildOfType(e,"border"),o=W.findChildOfType(n,"background"),s=W.findChildOfType(n,"itemgroup"),l=(W.findChildOfType(n,"scrollbargroup"),0);l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);for(var u="true"==i[l],c=W.childElements(s),h=0;h<c.length;h++)t.updateControlListItemLook(c[h],!1,!1);a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"text-array":W.removeAllChildren(s),s.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var d=V.splitSkipEmpty(i[l],"\n"),p=0,f=0;for(h=0;h<d.length;h++){var m=W.cloneElementWithId("list-item");W.findChildOfType(m,"background").setAttribute("fill",o.getAttribute("fill")),(A=W.findChildOfType(m,"text")).firstChild.textContent=d[h],e.hasAttribute("text-color")&&A.setAttribute("fill",e.getAttribute("text-color")),s.appendChild(m);var g=A.getBBox();p<g.width&&(p=g.width),f<g.height&&(f=g.height)}c=W.childElements(s);var b=Math.max(p+4,V.getFloatAttribute(n,"width")),v=Math.max(20,1.35*f);e.setAttribute("item-height",v.toString());for(h=0;h<c.length;h++)this.setupControlListItem(c[h],v*h,b,v,f);t.updateControlListScrollbar(e);break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":e.setAttribute(r[l],i[l]);break;case"font-style":e.style.font=i[l];break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[l],i[l]);break;case"value":var y=V.splitSkipEmpty(i[l],"\n");c=W.childElements(s),e.setAttribute("last-clicked","0");for(h=0;h<c.length;h++){m=c[h];var A=W.findChildOfType(m,"text"),T=y.indexOf(A.firstChild.textContent)>=0;m.setAttribute("selected",T),t.updateControlListItemLook(m,!1,!1),T&&e.setAttribute("last-clicked",h.toString())}break;default:e.setAttribute(r[l],i[l])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=W.findChildOfType(t,"svg"),i=W.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*V.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=W.findChildOfType(r,"border"),n=W.findChildOfType(r,"svg"),a=W.findChildOfType(n,"itemgroup"),o=W.findChildOfType(n,"scrollbargroup"),s=W.childElements(a);switch(e.type){case"mouseover":if("control-border-hover"!=i.getAttribute("class")){i.setAttribute("class","control-border-hover"),o.setAttribute("class","control-opaque1");for(var l=0;l<s.length;l++)t.updateControlListItemLook(s[l],!0,!1)}break;case"mouseout":if(r.contains(e.relatedTarget))return;i.setAttribute("class","control-border"),o.setAttribute("class","control-opaque0");for(l=0;l<s.length;l++)t.updateControlListItemLook(s[l],!1,!1);break;case"wheel":e.altKey||e.ctrlKey||(e.stopPropagation(),e.preventDefault(),t.scrollControlList(r,e.deltaY<0?1:-1))}}},t.scrollControlList=function(t,e){var r=W.findChildOfType(t,"svg"),i=W.findChildOfType(r,"itemgroup"),n=i.childElementCount;if(0!=n){var a=V.getFloatAttribute(r,"height"),o=V.getFloatAttribute(t,"item-height"),s=n*o,l=i.getAttribute("transform"),u=V.parseTranslateTransform(l)[1];u+=e*o,u=Math.max(-s+a,u),u=Math.min(u,0),u=Math.round(u),i.setAttribute("transform","translate(0,"+u+")");var c=W.findChildOfType(r,"scrollbargroup"),h=W.findChildOfType(c,"handle"),d=V.getFloatAttribute(h,"height"),p=(a/2-u)/s,f=Math.max(2,a*p-d/2);f=Math.min(a-d-2,f),h.setAttribute("y",f.toString())}},t.prototype.setupControlListItem=function(t,e,r,i,n){var a=this,o=W.findChildOfType(t,"background"),s=W.findChildOfType(t,"text");t.setAttribute("transform","translate(0,"+e+")"),V.setMultipleAttributes(o,["width","height"],[r,i]),V.setMultipleAttributes(s,["x","y"],[2,i/2+.3*n]);var l=function(t){return a.onControlListItemMouseEvent(t)};t.addEventListener("mouseover",l),t.addEventListener("mouseout",l),t.addEventListener("click",l)},t.prototype.onControlListItemMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))switch(e.type){case"mouseover":t.updateControlListItemLook(r,!0,!0);break;case"mouseout":t.updateControlListItemLook(r,!0,!1);break;case"click":e.stopPropagation(),e.preventDefault();var a="true"==n.getAttribute("multiple"),o=W.childElements(i),s=V.indexInParent(r),l="true"==r.getAttribute("selected");if(a)if(e.ctrlKey)r.setAttribute("selected",String(!l)),t.updateControlListItemLook(r,!0,!0);else if(e.shiftKey){var u=V.getIntAttribute(n,"last-clicked");for(c=0;c<o.length;c++)l=u<=s?u<=c&&c<=s:s<=c&&c<=u,o[c].setAttribute("selected",l),t.updateControlListItemLook(o[c],!0,c==s)}else for(c=0;c<o.length;c++)o[c].setAttribute("selected",c==s),t.updateControlListItemLook(o[c],!0,c==s);else{l=!e.ctrlKey||!l;for(var c=0;c<o.length;c++)o[c].setAttribute("selected",c==s&&l),t.updateControlListItemLook(o[c],!0,c==s)}n.setAttribute("last-clicked",s.toString());var h="";for(c=0;c<o.length;c++){if("true"==o[c].getAttribute("selected"))h+=W.findChildOfType(o[c],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,h)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=W.findChildOfType(t,"background"),a=W.findChildOfType(t,"text"),o="true"==i.getAttribute("enabled"),s="true"==t.getAttribute("selected");if(!o)return n.setAttribute("class",s?"control-background-selected-disabled":""),void a.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",s?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",s?"control-list-background-selected-hover":""),a.setAttribute("class",s?"control-text-selected-hover":"")):(n.setAttribute("class",s?"control-list-background-selected":""),a.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=W.findChildOfType(e,"svg"),i=W.findChildOfType(r,"scrollbargroup"),n=W.findChildOfType(i,"scrollbar"),a=W.findChildOfType(i,"handle"),o=V.getFloatAttribute(r,"width"),s=V.getFloatAttribute(r,"height"),l=o-V.getFloatAttribute(n,"width");n.setAttribute("x",l.toString()),n.setAttribute("height",s.toString()),a.setAttribute("x",(l+2).toString()),a.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=W.findChildOfType(t,"svg"),i=W.findChildOfType(r,"scrollbargroup"),n=(W.findChildOfType(i,"scrollbar"),W.findChildOfType(i,"handle")),a=V.getFloatAttribute(r,"height"),o=W.findChildOfType(r,"itemgroup").childElementCount,s=0;e=o>0&&a<(s=o*V.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e&&n.setAttribute("height",Math.max(a*(a/s)-4,7).toString())},t.onControlListScrollbarMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode.parentNode;if("false"!=i.getAttribute("enabled")){var n=W.findChildOfType(r,"scrollbar"),a=V.getFloatAttribute(n,"height"),o=n.getBoundingClientRect().height/a,s=V.offsetPage(n),l=(e.pageY-s.top)/o,u=W.findChildOfType(r,"handle"),c=V.getFloatAttribute(u,"y");switch(e.type){case"mouseout":case"mouseup":t.controlListScrollbarButtonDown=0;break;case"mousedown":1==e.which&&e.target==u&&(e.stopPropagation(),t.controlListScrollbarButtonDown=1,t.controlListScrollbarMousePos=l);break;case"mousemove":if(1==t.controlListScrollbarButtonDown){e.stopPropagation();var h=l-t.controlListScrollbarMousePos,d=W.findChildOfType(i,"svg"),p=W.findChildOfType(d,"itemgroup").childElementCount,f=V.getFloatAttribute(i,"item-height"),m=h*(p*f/a)/f;t.scrollControlList(i,-m),t.controlListScrollbarMousePos=l}break;case"click":if(e.stopPropagation(),e.preventDefault(),e.target==n){m=Math.floor(a/V.getFloatAttribute(i,"item-height"));t.scrollControlList(i,l<c?m:-m)}}}},t.controlListScrollbarButtonDown=0,t}(),q=function(){function t(t){this.frameDrawing=t,this.controlList=new X(t,this)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return Y.createUnsupportedObject("File chooser is not supported in the Cloud mode");case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":t.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":Y.updateUnsupportedObject(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=W.cloneElementWithId("control-button");return new m(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=W.findChildOfType(e,"background"),a=W.findChildOfType(e,"text"),o=0;o<r.length;o++)switch(r[o]){case"enabled":e.setAttribute(r[o],i[o]);var s="true"==i[o];n.setAttribute("class",s?"control-background":"control-background-disabled"),a.setAttribute("class",s?"control-button-text":"control-text-disabled");break;case"text":a.firstChild.textContent=i[o];break;case"background-color":break;case"text-color":a.setAttribute("fill",i[o]);break;case"font-style":a.style.font=i[o],t.centerControlText(a,n,!0,!0);break;case"width":case"height":var l=parseFloat(i[o])-2;n.setAttribute(r[o],l.toString()),t.centerControlText(a,n,!0,!0);break;default:e.setAttribute(r[o],i[o])}},t.onButtonOver=function(t){var e=W.findChildOfType(t,"background"),r=W.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=W.findChildOfType(t,"background"),r=W.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=W.findChildOfType(t,"background"),r=W.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.onControlAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=W.cloneElementWithId("control-checkbox");return new m(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=W.findChildOfType(e,"background"),a=W.findChildOfType(e,"box"),o=W.findChildOfType(e,"check"),s=W.findChildOfType(e,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-checkbox-box":"control-checkbox-box-disabled"),o.setAttribute("class",u?"control-checkbox-check":"control-checkbox-check-disabled"),s.setAttribute("class",u?"":"control-text-disabled");break;case"text":s.firstChild.textContent=i[l];break;case"background-color":n.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":s.style.font=i[l],t.centerControlText(s,n,!1,!0);break;case"width":n.setAttribute(r[l],i[l]);break;case"height":n.setAttribute(r[l],i[l]);var c=parseFloat(i[l]);a.setAttribute("y",(c/2-8).toString()),o.setAttribute("transform","translate(0,"+(c/2-8)+")"),t.centerControlText(s,n,!1,!0);break;case"value":o.setAttribute("visibility","true"==i[l]?"inherit":"hidden");break;default:e.setAttribute(r[l],i[l])}},t.onCheckboxOver=function(t){var e=W.findChildOfType(t,"box"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=W.findChildOfType(t,"box"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=W.findChildOfType(t,"box"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=W.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.onControlAction(t.id,r)},t.prototype.createSlider=function(){var t=this,e=W.cloneElementWithId("control-slider"),r=function(e){return t.onSliderEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r),e},t.updateSlider=function(e,r,i){for(var n=W.findChildOfType(e,"sensor"),a=W.findChildOfType(e,"background"),o=W.findChildOfType(e,"line"),s=W.findChildOfType(e,"progress"),l=W.findChildOfType(e,"handle"),u=(W.findChildOfType(e,"value"),0);u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];o.setAttribute("class",c?"control-background":"control-background-disabled"),s.setAttribute("class",c?"control-slider-progress":"control-background-selected-disabled"),l.setAttribute("class",c?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":a.setAttribute("fill",i[u]);break;case"width":case"height":a.setAttribute(r[u],i[u]);break;case"vertical":e.setAttribute(r[u],i[u]);var h=V.getFloatAttribute(a,"width"),d=V.getFloatAttribute(a,"height");V.setMultipleAttributes(n,["x","y","width","height"],[String(-1e3),String(-1e3),String(h+2e3),String(d+2e3)]);var p=void 0,f=void 0,m=void 0,g=void 0,b=void 0,v=void 0,y=void 0,A=void 0,T=void 0,C=void 0;"false"==i[u]?(b=p=0,v=f=d/2-2,m=h,y=0,A=g=4,T=0,C=d/2):(b=p=h/2-2,f=0,v=d,y=m=4,g=d,A=0,T=h/2,C=d),V.setMultipleAttributes(o,["x","y","width","height"],[p,f,m,g]),V.setMultipleAttributes(s,["x","y","width","height"],[b,v,y,A]),V.setMultipleAttributes(l,["cx","cy"],[T,C]);break;case"value":var S=V.getFloatAttribute(e,"min"),E=V.getFloatAttribute(e,"max");h=V.getFloatAttribute(a,"width"),d=V.getFloatAttribute(a,"height");var w="true"==e.getAttribute("vertical")?d:h,k=(parseFloat(i[u])-S)/(E-S)*w;t.setSliderHandlePosition(e,k);break;default:e.setAttribute(r[u],i[u])}},t.prototype.onSliderEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=W.findChildOfType(r,"background"),n=W.findChildOfType(r,"progress"),a=V.getFloatAttribute(i,"width"),o=V.getFloatAttribute(i,"height"),s=i.getBoundingClientRect(),l=s.width/a,u=s.height/o,c=V.offsetPage(i),h="true"==r.getAttribute("vertical");if(e.type.startsWith("mouse")||"wheel"==e.type){var d=e,p=(d.pageX-c.left)/l,f=(d.pageY-c.top)/u,m=h?o-f:p;switch(e.type){case"mouseover":e.stopPropagation(),t.onSliderOver(r);break;case"mouseout":if(r.contains(d.relatedTarget))return;1==t.sliderButtonDown&&(t.setSliderHandlePosition(r,m),this.confirmSliderValue(r)),t.sliderButtonDown=0,t.onSliderOut(r);break;case"mousedown":t.sliderButtonDown=d.which,1==t.sliderButtonDown&&(e.stopPropagation(),t.onSliderHandleGrabbed(r,m));break;case"mousemove":1==t.sliderButtonDown&&(e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m));break;case"mouseup":1==t.sliderButtonDown&&(e.stopPropagation(),this.onSliderHandleReleased(r)),t.sliderButtonDown=0;break;case"wheel":if(!d.altKey&&!d.ctrlKey){var g=e;e.stopPropagation(),e.preventDefault();var b=V.getFloatAttribute(n,h?"height":"width");t.setSliderHandlePosition(r,b+(g.deltaY<0?1:-1)),this.confirmSliderValue(r)}}}else if(e.type.startsWith("touch")){var v=e;if(v.touches.length>1)return void this.onSliderHandleReleased(r);var y="touchend"==e.type?v.changedTouches[0]:v.touches[0];p=void 0,f=void 0;p=(y.pageX-c.left)/l,f=(y.pageY-c.top)/u;m=h?o-f:p;switch(e.type){case"touchstart":e.stopPropagation(),t.onSliderOver(r),t.onSliderHandleGrabbed(r,m);break;case"touchmove":e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m);break;case"touchend":e.stopPropagation(),this.onSliderHandleReleased(r),t.onSliderOut(r)}}}},t.onSliderOver=function(e){var r=W.findChildOfType(e,"line"),i=W.findChildOfType(e,"progress"),n=W.findChildOfType(e,"handle"),a=W.findChildOfType(e,"value");r.setAttribute("class","control-slider-line-hover"),i.setAttribute("class","control-fill-color-transition"),n.setAttribute("class",1==t.sliderButtonDown?"control-slider-handle-pressed":"control-slider-handle-hover"),a.setAttribute("class","control-opaque1")},t.onSliderOut=function(t){var e=W.findChildOfType(t,"sensor"),r=W.findChildOfType(t,"line"),i=W.findChildOfType(t,"progress"),n=W.findChildOfType(t,"handle"),a=W.findChildOfType(t,"value");e.setAttribute("visibility","hidden"),r.setAttribute("class","control-background"),i.setAttribute("class","control-slider-progress"),n.setAttribute("r","8"),n.setAttribute("class","control-slider-handle"),a.setAttribute("class","control-opaque0")},t.onSliderHandleGrabbed=function(e,r){var i=W.findChildOfType(e,"sensor"),n=W.findChildOfType(e,"handle");W.bringElementToFront(e),n.setAttribute("r","7"),n.setAttribute("class","control-slider-handle-pressed"),i.setAttribute("visibility","inherit"),t.setSliderHandlePosition(e,r)},t.prototype.onSliderHandleReleased=function(t){var e=W.findChildOfType(t,"sensor"),r=W.findChildOfType(t,"handle");r.setAttribute("r","8"),r.setAttribute("class","control-slider-handle-hover"),e.setAttribute("visibility","hidden"),this.confirmSliderValue(t)},t.setSliderHandlePosition=function(t,e){var r=W.findChildOfType(t,"background"),i=W.findChildOfType(t,"progress"),n=W.findChildOfType(t,"handle"),a=W.findChildOfType(t,"value"),o=V.getFloatAttribute(r,"width"),s=V.getFloatAttribute(r,"height"),l="true"==t.getAttribute("vertical"),u=l?s:o;e=Math.min(u,Math.max(e,0));var c,h=V.getFloatAttribute(t,"min"),d=V.getFloatAttribute(t,"max"),p=V.getFloatAttribute(t,"step");c=p>0?h+Math.round(e/u*(d-h)/p)*p:h+e/u*(d-h),e=((c=Math.min(c,d))-h)/(d-h)*u,l?(i.setAttribute("y",(u-e).toString()),i.setAttribute("height",e.toString()),n.setAttribute("cy",(u-e).toString())):(i.setAttribute("width",e.toString()),n.setAttribute("cx",e.toString()));var f=a.firstElementChild,m=a.lastElementChild;m.firstChild.textContent=V.formatNumber(c,void 0);var g=m.getComputedTextLength()+10;f.setAttribute("width",g.toString()),f.setAttribute("x",(5-g).toString());var b=l?o/2-9:e-14,v=l?s-e-15-10:s/2-15-4;a.setAttribute("transform","translate("+b+","+v+")"),t.setAttribute("current-value",c)},t.prototype.confirmSliderValue=function(t){var e=V.getFloatAttribute(t,"current-value");e!=V.getFloatAttribute(t,"last-value")&&(this.frameDrawing.onControlAction(t.id,e),t.setAttribute("last-value",e.toString()))},t.createRadioButtonGroup=function(){return W.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"enabled":e.setAttribute(r[a],i[a]);for(var o="true"==i[a],s=W.childElements(e),l=0;l<s.length;l++){var u=s[l],c=W.findChildOfType(u,"circle"),h=W.findChildOfType(u,"check"),d=W.findChildOfType(u,"text");c.setAttribute("class",o?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),h.setAttribute("class",o?"control-radiobutton-check":"control-text-disabled"),d.setAttribute("class",o?"":"control-text-disabled")}break;case"text-array":var p=i[a].split("\n"),f=function(r){var i=W.cloneElementWithId("radio-button"),a=W.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var o=W.findChildOfType(i,"text");o.firstChild.textContent=p[r],e.hasAttribute("text-color")&&o.setAttribute("fill",e.getAttribute("text-color")),new m(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(l=0;l<p.length;l++)f(l);break;case"background-color":case"text-color":e.setAttribute(r[a],i[a]);break;case"font-style":e.style.font=i[a];break;case"width":case"height":e.setAttribute(r[a],i[a]);break;case"vertical":var g=V.getFloatAttribute(e,"width"),b=V.getFloatAttribute(e,"height"),v=0;s=W.childElements(e);for(l=0;l<s.length;l++){u=s[l];var y=W.findChildOfType(u,"background"),A=(d=W.findChildOfType(u,"text")).getBBox();if("true"==i[a]){var T=Math.max(25,1.5*A.height);u.setAttribute("transform","translate(0,"+T*l+")"),V.setMultipleAttributes(y,["width","height"],[g,T])}else{var C=20+A.width+10;u.setAttribute("transform","translate("+v+",0)"),V.setMultipleAttributes(y,["width","height"],[C,b]),v+=C}t.centerRadioButton(u)}break;case"value":var S=parseInt(i[a]);s=W.childElements(e);for(l=0;l<s.length;l++){u=s[l];(h=W.findChildOfType(u,"check")).setAttribute("visibility",S==l?"inherit":"hidden")}break;default:e.setAttribute(r[a],i[a])}},t.onRadioButtonOver=function(t){var e=W.findChildOfType(t,"circle"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=W.findChildOfType(t,"circle"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=W.findChildOfType(t,"circle"),r=W.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=W.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=W.childElements(r),n=0;n<i.length;n++){var a=i[n];W.findChildOfType(a,"check").setAttribute("visibility",a==t?"inherit":"hidden"),a==t&&(e=n)}this.frameDrawing.onControlAction(r.id,e)}},t.centerRadioButton=function(e){var r=W.findChildOfType(e,"background"),i=W.findChildOfType(e,"circle"),n=W.findChildOfType(e,"check"),a=W.findChildOfType(e,"text"),o=V.getFloatAttribute(r,"height");i.setAttribute("cy",(o/2).toString()),n.setAttribute("cy",(o/2).toString()),t.centerControlText(a,r,!1,!0)},t.createListBox=function(){return X.createControlList()},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var t=this,e=W.cloneElementWithId("control-combobox"),r=function(e){return t.onComboBoxEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("click",r);var i=X.createControlList();return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),e.appendChild(i),e},t.prototype.updateComboBox=function(e,r,i){for(var n=W.findChildOfType(e,"svg"),a=W.findChildOfType(e,"border"),o=W.findChildOfType(e,"dropdown"),s=W.findChildOfType(n,"background"),l=W.findChildOfType(n,"text"),u=W.findChildOfType(n,"arrowback"),c=W.findChildOfType(n,"arrow"),h=0;h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var d="true"==i[h];l.setAttribute("class",d?"":"control-text-disabled"),a.setAttribute("class",d?"control-border":"control-border-disabled"),d||o.setAttribute("visibility","hidden"),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-array":var p=V.splitSkipEmpty(i[h],"\n"),f=p.length>0?p[0]:"";l.firstChild.textContent=f,this.controlList.updateControlList(o,[r[h]],[i[h]]),this.controlList.adjustControlListHeightToItems(o,5),this.controlList.updateControlList(o,["value"],[f]);break;case"background-color":s.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-color":l.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"font-style":e.style.font=i[h],t.centerControlText(l,s,!1,!0),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"width":case"height":var m=parseFloat(i[h]);if(n.setAttribute(r[h],i[h]),s.setAttribute(r[h],i[h]),a.setAttribute(r[h],i[h]),"width"==r[h])u.setAttribute("x",(m-20).toString()),this.controlList.updateControlList(o,[r[h]],[i[h]]);else{t.centerControlText(l,s,!1,!0),u.setAttribute("height",m.toString()),o.setAttribute("transform","translate(0,"+i[h]+")");var g=5*parseFloat(i[h]);this.controlList.updateControlList(o,["height"],[g.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var b=V.getFloatAttribute(n,"width")-10,v=V.getFloatAttribute(n,"height")/2;c.setAttribute("transform","translate("+b+","+v+")")}break;case"editable":e.setAttribute(r[h],i[h]);break;case"value":l.firstChild.textContent=i[h],this.controlList.updateControlList(o,[r[h]],[i[h]]);break;default:e.setAttribute(r[h],i[h])}},t.prototype.onComboBoxEvent=function(t){var e=t.currentTarget;if("false"!=e.getAttribute("enabled")){var r=W.findChildOfType(e,"svg"),i=W.findChildOfType(e,"border"),n=W.findChildOfType(e,"dropdown"),a=W.findChildOfType(r,"background"),o=W.findChildOfType(r,"text"),s=W.findChildOfType(r,"arrowback"),l=W.findChildOfType(r,"arrow"),u="true"==e.getAttribute("editable");switch(t.type){case"mouseover":i.setAttribute("class","control-border-hover"),s.setAttribute("class","control-combobox-arrow-background-hover"),l.setAttribute("class","control-fill-color-transition");break;case"mouseout":if(e.contains(t.relatedTarget))return;i.setAttribute("class","control-border"),s.setAttribute("class","control-fill-transparent-transition"),l.setAttribute("class","control-fill-transparent-transition"),n.setAttribute("visibility","hidden");break;case"mousedown":1!=t.which||!u||t.target!=a&&t.target!=o||(t.stopPropagation(),this.displayTextInputForSVG(e,"left"));break;case"click":if(!u||t.target==s||t.target==l){t.stopPropagation(),t.preventDefault(),W.bringElementToFront(e);var c="inherit"==n.getAttribute("visibility");n.setAttribute("visibility",c?"hidden":"inherit")}}}},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=W.findChildOfType(t,"svg"),i=W.findChildOfType(t,"dropdown"),n=W.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var a=e.split("\n")[0];n.firstChild.textContent=a,this.frameDrawing.onControlAction(t.id,a)},t.prototype.createTextField=function(){var e=this,r=W.cloneElementWithId("control-textfield");return new m(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r)},function(t){return e.onTextFieldDown(r)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=W.findChildOfType(e,"svg"),a=W.findChildOfType(e,"border"),o=W.findChildOfType(n,"background"),s=W.findChildOfType(n,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];s.setAttribute("class",u?"":"control-text-disabled"),a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":e.style.font=i[l],t.centerControlText(s,o,!1,!0);break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),"width"==r[l]&&s.setAttribute("x",(parseFloat(i[l])-2).toString()),t.centerControlText(s,o,!1,!0);break;case"value":s.firstChild.textContent=i[l];break;default:e.setAttribute(r[l],i[l])}},t.onTextFieldOver=function(t){W.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){W.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t){this.displayTextInputForSVG(t,"right")},t.createProgressBar=function(){return W.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,a=W.findChildOfType(n,"background"),o=W.findChildOfType(n,"progress"),s=W.findChildOfType(n,"text"),l=W.findChildOfType(n,"border"),u=0;u<r.length;u++)switch(r[u]){case"background-color":a.setAttribute("fill",i[u]);break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":e.style.font=i[u],t.centerControlText(s,a,!1,!0);break;case"width":case"height":e.setAttribute(r[u],i[u]);break;case"vertical":var c="true"==i[u],h=e.getAttribute(c?"height":"width"),d=e.getAttribute(c?"width":"height");a.setAttribute("width",h),a.setAttribute("height",d),o.setAttribute("height",d),t.centerControlText(s,a,!0,!0),l.setAttribute("width",h),l.setAttribute("height",d),c&&n.setAttribute("transform","translate(0,"+h+") rotate(-90)");break;case"text":s.firstChild.textContent="null"==i[u]?"":i[u];break;case"value":var p=V.getFloatAttribute(a,"width");"null"==i[u]?(o.setAttribute("class","control-progressbar-indeterminate"),o.setAttribute("width",p.toString())):(o.setAttribute("class","control-slider-progress"),o.setAttribute("width",(parseFloat(i[u])*p).toString()));break;default:e.setAttribute(r[u],i[u])}},t.prototype.displayTextInputForSVG=function(t,e){var r=this,i=W.findChildOfType(t,"svg"),n=W.findChildOfType(i,"text"),a=document.getElementById("text-input-for-svg-container");a.style.display="block";var o=i.getBoundingClientRect(),s=V.getFloatAttribute(i,"width"),l=V.getFloatAttribute(i,"height"),u=o.width/s,c=a.firstElementChild;c.style.left=o.left+"px",c.style.top=o.top+"px",c.style.width=s+"px",c.style.height=l+"px",c.style.transform="scale("+u+")",c.style.font=t.style.font,c.style.textAlign=e,c.value=n.firstChild.textContent,a.setAttribute("control-id",t.id);var h=function(t){return r.onTextInputForSVGEvent(t)};a.onmousedown=h,a.onwheel=h,a.onkeypress=h,a.ontouchstart=h,window.setTimeout(function(){c.focus(),c.select()},0)},t.prototype.onTextInputForSVGEvent=function(t){var e=t.currentTarget,r=e.firstElementChild,i=e.getAttribute("control-id"),n=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=r&&(n=!0);break;case"wheel":n=!0;break;case"keypress":"Enter"==t.code&&(n=!0)}n&&(e.style.display="none",this.onTextInputForSVGChanged(i,r.value))},t.prototype.onTextInputForSVGChanged=function(t,e){var r=document.getElementById(t),i=W.findChildOfType(r,"svg");if(W.findChildOfType(i,"text").firstChild.textContent=e,this.frameDrawing.onControlAction(t,e),"ControlComboBox"==r.getAttribute("type")){var n=W.findChildOfType(r,"dropdown");this.controlList.updateControlList(n,["value"],[e])}},t.centerControlText=function(t,e,r,i){var n=V.getFloatAttribute(e,"width"),a=V.getFloatAttribute(e,"height"),o=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*o.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.onControlAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t.sliderButtonDown=0,t}(),Z=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){for(var e=W.findChildOfType(t,"picture"),r=W.findChildOfType(t,"pictureback"),i=W.childElements(W.findChildOfType(t,"legend")),n=i.length,a="true"==t.getAttribute("show-pdf"),o="true"==t.getAttribute("show-cdf"),s="true"==t.getAttribute("show-mean"),l=(V.getFloatAttribute(r,"x"),V.getFloatAttribute(r,"y")),u=(V.getFloatAttribute(r,"width"),V.getFloatAttribute(r,"height")),c=0;c<n;c++){var h=W.createSvgElement("g");if(a){var d=W.createSvgElement("g");h.appendChild(d)}if(o){var p=W.createSvgElement("polyline");V.setMultipleAttributes(p,["fill","stroke-width","stroke"],["none",i[c].getAttribute("cdf-line-width"),i[c].getAttribute("cdf-color")]),h.appendChild(p)}if(s){var f=W.createSvgElement("line");V.setMultipleAttributes(f,["stroke-width","stroke","y1","y2"],[i[c].getAttribute("cdf-line-width"),i[c].getAttribute("mean-color"),l.toString(),(l+u).toString()]),h.appendChild(f)}e.appendChild(h),et.addClickTapHandlerToChartItem(h)}},t.prototype.draw=function(t,e){for(var r=W.findChildOfType(t,"pictureback"),i=W.findChildOfType(t,"picture"),n=W.findChildOfType(t,"grid"),a=W.childElements(W.findChildOfType(t,"legend")),o="true"==t.getAttribute("show-pdf"),s="true"==t.getAttribute("show-cdf"),l="true"==t.getAttribute("show-mean"),u=V.getFloatAttribute(t,"bar-width"),c=V.getFloatAttribute(r,"x"),h=V.getFloatAttribute(r,"y"),d=V.getFloatAttribute(r,"width"),p=V.getFloatAttribute(r,"height"),f=V.splitSkipEmpty(e," "),m=f.length,g=1/0,b=-1/0,v=1/0,y=-1/0,A=[],T=[],C=[],S=[],E=[],w=[],k=[],x=[],M=[],O=0;O<m;O++)if("empty"!=f[O]){f[O]=V.splitSkipEmpty(f[O],":"),A[O]="true"==f[O][0],T[O]="true"==f[O][1],C[O]=parseFloat(f[O][2]),S[O]=parseFloat(f[O][3]),E[O]=parseFloat(f[O][4]),w[O]=parseInt(f[O][5]),k[O]=parseInt(f[O][6]),x[O]=V.splitToFloats(f[O][7],"|");for(var I=0;I<x[O].length;I++)x[O][I]<v&&(v=x[O][I]),y<x[O][I]&&(y=x[O][I]);A[O]&&(M[O]=V.splitToFloats(f[O][8],"|")),C[O]<g&&(g=C[O]),b<S[O]&&(b=S[O])}g==1/0&&(g=0,b=0),v==1/0&&(v=0,y=1),this.chartScaleAndGrid.recalcChartScale(t,g,b,!1,!1),this.chartScaleAndGrid.recalcChartScale(t,0,y,!0,!1);var _=V.getFloatAttribute(n,"min-x"),L=V.getFloatAttribute(n,"max-x"),P=V.getFloatAttribute(n,"min-y"),R=V.getFloatAttribute(n,"max-y"),F=d/(L-_),D=p/(R-P),N=W.childElements(i);for(O=0;O<m;O++)if("empty"!=f[O]){"hidden"==N[O].getAttribute("visibility")&&N[O].setAttribute("visibility","inherit");var B=x[O].length,G=(S[O]-C[O])/B,U=a[O].getAttribute("original-color"),H=void 0,z=void 0;if(T[O]&&(H=a[O].getAttribute("low-color"),z=a[O].getAttribute("high-color")),o){var Y=N[O].firstElementChild,j=u*G*F,X=G*(1-u)/2;for(I=0;I<B;I++){var q=c+(C[O]+I*G+X-_)*F,Z=h+(R-x[O][I])*D,K=x[O][I]*D,Q=W.childElements(Y)[I];Q?Q.setAttribute("visibility","inherit"):(Q=W.createSvgElement("rect"),Y.appendChild(Q)),V.setMultipleAttributes(Q,["x","y","width","height"],[V.reducePrecision(q),V.reducePrecision(Z),V.reducePrecision(j),V.reducePrecision(K)]),A[O]&&T[O]&&I<w[O]?Q.setAttribute("fill",H):A[O]&&T[O]&&k[O]<I?Q.setAttribute("fill",z):Q.setAttribute("fill",U)}var J=W.childElements(Y);for(I=B;I<J.length;I++)J[I].setAttribute("visibility","hidden")}if(s){var $=o?N[O].firstElementChild.nextElementSibling:N[O].firstElementChild,tt="";if(tt+=c+(C[O]-_)*F+" "+(h+p)+" ",A[O])for(I=0;I<B;I++){tt+=V.reducePrecision(c+(C[O]+(I+1)*G-_)*F)+","+V.reducePrecision(h+(1-M[O][I])*p)+" "}$.setAttribute("points",tt)}if(l){var rt=N[O].lastElementChild,it=c+(E[O]-_)*F;rt.setAttribute("x1",it),rt.setAttribute("x2",it)}if("NONE"!=t.getAttribute("leg-pos")){var nt=W.findChildOfType(a[O],"value");nt.firstChild.textContent=V.formatNumber(E[O],void 0),nt.setAttribute("fill",a[O].getAttribute("mean-color"))}}else N[O].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&et.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=W.findChildOfType(t,"picture"),a=W.childElements(n),o=W.childElements(a[e]),s=0;s<o.length;s++)o[s].setAttribute("visibility",r?"hidden":"inherit")},t}(),K=function(){function t(t){this.frameDrawing=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),a=W.findChildOfType(t,"grid"),o=W.findChildOfType(t,"pictureback"),s=W.findChildOfType(t,e?"pictureborderh":"pictureborderw"),l=a.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=l){var u=V.getFloatAttribute(o,"x"),c=V.getFloatAttribute(o,"y"),h=V.getFloatAttribute(o,"width"),d=V.getFloatAttribute(o,"height"),p="GRID_DEFAULT"==l,f="ChartBar"==r||"ChartStack"==r,m=t.getAttribute("bar-dir");e?f&&(!f||"NORTH"!=m&&"SOUTH"!=m)||V.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c,u,c+d]:[u+h,c,u+h,c+d]):f&&(!f||"EAST"!=m&&"WEST"!=m)||V.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c+d,u+h,c+d]:[u,c,u+h,c])}var g=a.getAttribute("grid-line-color");switch(a.setAttribute("grid-line-color",V.increaseTransparency(g,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var b=V.getFloatAttribute(t,"scale-min-"+i),v=V.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(b="ChartStack"==r?0:Math.min(0,b),v=Math.max(0,v)),this.recalcChartScale(t,b,v,e,!0);break;case"SCALE_TIME_WINDOW":v=Math.max(0,V.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,v,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var a=W.findChildOfType(t,"grid"),o=i?"min-y":"min-x",s=i?"max-y":"max-x";if(e!=V.getFloatAttribute(a,o)||r!=V.getFloatAttribute(a,s)){var l=e,u=r;if(l==u){if(n)return;l-=1,u+=1}var c=W.findChildOfType(t,"pictureback"),h=V.getFloatAttribute(c,i?"height":"width"),d=i?25:45,p=(u-l)/Math.floor(h/d),f=Math.pow(10,Math.ceil(Math.log(u-l)/Math.log(10))-1),m=f/5;m<p&&(m=f/2)<p&&(m=f)<p&&(m=2*f)<p&&(m=5*f),n?(l=Math.ceil(l/m)*m,u=Math.floor(u/m)*m):(l=Math.floor(l/m)*m,u=Math.ceil(u/m)*m);var g=n?e:l,b=n?r:u;V.setMultipleAttributes(a,[o,s],[g,b]),this.drawChartGrid(t,l,u,m,g,b,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,a,o){var s=t.getAttribute("type"),l=W.findChildOfType(t,"grid"),u=l.getAttribute(o?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=u){var c=o?l.lastElementChild:l.firstElementChild,h=W.findChildOfType(t,"pictureback"),d=l.getAttribute("grid-text-color"),p=l.getAttribute("grid-line-color"),f=o?"scale-type-y":"scale-type-x",m="SCALE_100_PERCENT"==t.getAttribute(f),g="SCALE_TIME_WINDOW"==t.getAttribute(f)?t.getAttribute("date-format-pattern"):"null",b=Math.round((r-e)/i)+1,v="GRID_DEFAULT"==u,y=!0;if("ChartBar"==s||"ChartStack"==s){var A=t.getAttribute("bar-dir");"SOUTH"!=A&&"WEST"!=A||(y=!1)}for(var T=V.getFloatAttribute(h,"x"),C=V.getFloatAttribute(h,"y"),S=V.getFloatAttribute(h,"width"),E=V.getFloatAttribute(h,"height"),w=a-n,k=(o?E:S)/w,x=i*k;c.childElementCount<b;){var M=W.cloneElementWithId("grid-item");c.appendChild(M)}for(var O=W.childElements(c),I=e,_=o?y?C+(a-e)*k:C+(e-n)*k:y?T+(e-n)*k:T+(a-e)*k,L=0;L<b;L++){var P=o?v?T-4:T:_,R=o?_:v?C+E+4:C+E,F=o?v?T+S:T+S+4:_,D=o?_:v?C:C-4,N=o?v?P-3:F+3:P,B=o?R+3:v?R+11:D-3,G=o?v?"end":"start":"middle";(M=O[L]).setAttribute("visibility","inherit");var U=M.lastElementChild;V.setMultipleAttributes(U,["x1","x2","y1","y2","stroke"],[P,F,R,D,p]);var H=M.firstElementChild;V.setMultipleAttributes(H,["x","y","text-anchor","fill"],[N,B,G,d]);var z=void 0;z=m?V.formatPercent(I):"null"!=g?this.gridFormattedDate(I,w,g):V.formatNumber(I,void 0),H.firstChild.textContent=z,I+=i,_+=o?y?-x:+x:y?+x:-x}for(L=b;L<O.length;L++)O[L].setAttribute("visibility","hidden")}},t.prototype.gridFormattedDate=function(t,e,r){var i=V.toDate(this.frameDrawing,t),n=V.toMilliseconds(this.frameDrawing,e);return n>5*V.YEAR?V.formatDate(i,"YYYY"):n>5*V.MONTH?V.formatDate(i,"MMMYYYY"):n>5*V.DAY?V.formatDate(i,"DDMMM"):n>5*V.HOUR?V.formatDate(i,"DDMMHH"):n>5*V.MINUTE?V.formatDate(i,"HHmm"):V.formatDate(i,"mmss")},t}(),Q=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e,r,i=t.getAttribute("type"),n=W.findChildOfType(t,"pictureback"),a=W.findChildOfType(t,"picture"),o=W.childElements(W.findChildOfType(t,"legend")),s=o.length,l=V.getFloatAttribute(n,"x"),u=V.getFloatAttribute(n,"y"),c=V.getFloatAttribute(n,"width"),h=V.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var d=t.getAttribute("bar-dir");e="NORTH"==d||"SOUTH"==d;var p=V.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?c/s:h/s)*p:(e?c:h)*p}for(var f=0;f<s;f++){var m=void 0,g=o[f].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(m=W.createSvgElement("rect")).setAttribute("stroke","none"),m.setAttribute("fill",g);var b=void 0;e?(b=c/s,m.setAttribute("x","ChartBar"==i?l+b*f+(b-r)/2:l+(c-r)/2),m.setAttribute("width",r)):(b=h/s,m.setAttribute("y","ChartBar"==i?u+b*f+(b-r)/2:u+(h-r)/2),m.setAttribute("height",r)),a.appendChild(m);break;case"ChartPie":(m=W.createSvgElement("path")).setAttribute("stroke","none"),m.setAttribute("fill",g),a.appendChild(m)}et.addClickTapHandlerToChartItem(m)}},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=W.findChildOfType(t,"pictureback"),n=W.findChildOfType(t,"picture"),a=W.childElements(n),o=W.findChildOfType(t,"grid"),s=V.getFloatAttribute(i,"x"),l=V.getFloatAttribute(i,"y"),u=V.getFloatAttribute(i,"width"),c=V.getFloatAttribute(i,"height"),h=V.splitSkipEmpty(e," "),d=h.length,p=1/0,f=-1/0,m=!1,g=0,b=0;b<d;b++)h[b]=parseFloat(h[b]),h[b]<p&&(p=h[b]),f<h[b]&&(f=h[b]),h[b]<0&&(m=!0),g+=h[b];var v=!1;if("ChartBar"==r||"ChartStack"==r){var y=t.getAttribute("bar-dir"),A="NORTH"==y||"SOUTH"==y;"ChartBar"==r?(p=Math.min(0,p),f=Math.max(0,f)):(p=0,f=Math.max(0,g));var T=t.getAttribute(A?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=T&&"SCALE_AUTO_FROM_0"!=T||this.chartScaleAndGrid.recalcChartScale(t,p,f,A,!1),v="SCALE_100_PERCENT"==T;var C=V.getFloatAttribute(o,A?"min-y":"min-x"),S=V.getFloatAttribute(o,A?"max-y":"max-x"),E=(A?c:u)/(S-C),w=0;for(b=0;b<d;b++)if("ChartStack"==r&&(m||0==g)||"ChartBar"==r&&v&&(m||0==g))a[b].setAttribute(A?"height":"width",0);else{var k=v?h[b]/g:h[b],x=Math.abs(k),M=void 0;if("ChartBar"==r)switch(y){case"NORTH":case"WEST":M=k>0?S-k:S;break;case"SOUTH":case"EAST":M=k<0?k-C:-C}else{switch(y){case"NORTH":case"WEST":M=S-(k+w);break;case"SOUTH":case"EAST":M=-C+w}w+=k}x*=E;var O=A?c:u;(M*=E)<0?(x-=-M,M=0):M+x>O&&(x-=M+x-O),x<0&&(x=0),A?(a[b].setAttribute("y",l+M),a[b].setAttribute("height",x)):(a[b].setAttribute("x",s+M),a[b].setAttribute("width",x))}}else{var I=-Math.PI/2;for(b=0;b<d;b++){var _=g<=0||m?0:2*Math.PI*(h[b]/g),L=u/2,P=c/2,R=V.sectorData(s+L,l+P,L,P,I,_);a[b].setAttribute("d",R),I+=_}}if(("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&v)&&m?et.showChartWarning(t,"Neg!"):et.hideChartWarning(t),"NONE"!=t.getAttribute("leg-pos")){var F=W.childElements(W.findChildOfType(t,"legend"));for(b=0;b<d;b++){var D=W.findChildOfType(F[b],"value"),N=V.formatNumber(h[b],void 0);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&v)&&g>0&&!m&&(N+=" ("+V.formatPercent(h[b]/g)+")"),D.firstChild.textContent=N,D.setAttribute("fill",h[b]>=0?"royalBlue":"fireBrick")}et.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){W.childElements(W.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t}(),J=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(e){for(var r=e.getAttribute("type"),i=W.findChildOfType(e,"picture"),n=W.childElements(W.findChildOfType(e,"legend")),a=n.length,o=0;o<a;o++){var s=n[o].getAttribute("original-color"),l=W.createSvgElement("g");switch(r){case"ChartPlot":case"ChartTimePlot":if("true"==n[o].getAttribute("draw-line")){var u=W.createSvgElement("polyline");if(u.setAttribute("fill","none"),u.setAttribute("stroke",s),u.setAttribute("stroke-width",n[o].getAttribute("line-width")),l.appendChild(u),"ChartTimePlot"==r){var c=W.createSvgElement("polyline");c.setAttribute("stroke","none"),c.setAttribute("fill",V.increaseTransparency(s,t.timePlotAlpha)),l.appendChild(c)}}if("POINT_NONE"!=n[o].getAttribute("point-style")){var h=W.createSvgElement("g");h.setAttribute("fill",s),l.appendChild(h)}break;case"ChartTimeStack":var d=W.createSvgElement("polyline");d.setAttribute("stroke-width","1"),d.setAttribute("stroke",s),d.setAttribute("fill","none"),l.appendChild(d);var p=W.createSvgElement("polyline");p.setAttribute("stroke","none"),p.setAttribute("fill",V.increaseTransparency(s,t.stackChartAlpha)),l.appendChild(p)}i.appendChild(l),et.addClickTapHandlerToChartItem(l)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=W.findChildOfType(e,"pictureback"),a=W.findChildOfType(e,"picture"),o=W.findChildOfType(e,"grid"),s=W.childElements(W.findChildOfType(e,"legend")),l=V.getFloatAttribute(n,"x"),u=V.getFloatAttribute(n,"y"),c=V.getFloatAttribute(n,"width"),h=V.getFloatAttribute(n,"height"),d=u+h,p=t.parseDataAndFindMinMax(r),f=p.datasets,m=f.length,g=p.minx,b=p.maxx,v=p.miny,y=p.maxy;if("ChartTimeStack"==i&&v<0)et.showChartWarning(e,"Neg!");else{et.hideChartWarning(e),"ChartTimeStack"==i&&(v=0,y=t.prepareChartTimeStackData(f));var A,T=e.getAttribute("scale-type-x"),C=e.getAttribute("scale-type-y"),S="SCALE_100_PERCENT"==C;if("SCALE_AUTO"==T)this.chartScaleAndGrid.recalcChartScale(e,g,b,!1,!1);else if("SCALE_TIME_WINDOW"==T){A=V.getFloatAttribute(e,"scale-max-x");var E=void 0;E="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(b,A):Math.max(b,A,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,E-A,E,!1,!0)}"SCALE_AUTO"==C&&this.chartScaleAndGrid.recalcChartScale(e,v,y,!0,!1);for(var w=V.getFloatAttribute(o,"min-x"),k=V.getFloatAttribute(o,"max-x"),x=V.getFloatAttribute(o,"min-y"),M=V.getFloatAttribute(o,"max-y"),O=c/(k-w),I=h/(M-x),_=W.childElements(a),L="",P=0;P<m;P++){var R=void 0,F=void 0,D=void 0,N=void 0,B=void 0,G=void 0,U=void 0,H=void 0,z=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(R="true"==s[P].getAttribute("draw-line"),F=s[P].getAttribute("point-style"),D="INTERPOLATION_STEP"==s[P].getAttribute("interpolation")),(R||"ChartTimeStack"==i)&&(B=(N=_[P].firstElementChild).nextElementSibling),F&&"POINT_NONE"!=F)switch(G=_[P].lastElementChild,F){case"POINT_CIRCLE":U="plot-point-circle",H=0,z=0;break;case"POINT_SQUARE":U="plot-point-square",H=-1.5,z=-1.5;break;case"POINT_TRIANGLE":U="plot-point-triangle",H=0,z=0}for(var Y=void 0,j=void 0,X="",q="",Z=void 0,K=void 0,Q=0,J=0;J<f[P].length;J++){var $=l+(f[P][J][0]-w)*O,tt=void 0;if(S){var rt=f[m-1][J][1];tt=rt<=0?0:f[P][J][1]/rt}else tt=f[P][J][1];var it=u+(-tt+M)*I;if($<l&&($=l),l+c<$&&($=l+c),it<u&&(it=u),u+h<it&&(it=u+h),!(null!=Y&&Math.abs($-Y)<et.chartTolerance&&Math.abs(it-j)<et.chartTolerance)){if($=V.reducePrecision($),it=V.reducePrecision(it),0==J&&(Z=$),K=$,N&&(D&&null!=Y&&(X+=$+","+j+" "),X+=$+","+it+" ",B&&(0==P&&(L=$+","+d+" "+L),q=$+","+it+" "+q)),G){var nt=W.childElements(G)[Q];nt?nt.setAttribute("visibility","inherit"):(nt=W.createUseElement(U),G.appendChild(nt)),nt.setAttribute("x",H+$),nt.setAttribute("y",z+it)}Q++,Y=$,j=it}}if(N&&(N.setAttribute("points",X),B))if("ChartTimePlot"==i){var at="";if(""!=X){var ot=u+M*I;ot<u&&(ot=u),u+h<ot&&(ot=u+h),at=K+","+ot+" "+Z+","+ot}B.setAttribute("points",X+at)}else B.setAttribute("points",X+L),L=q;if(G){var st=W.childElements(G);for(J=Q;J<st.length;J++)st[J].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var a=e.getAttribute("type"),o=W.childElements(W.findChildOfType(e,"legend")),s=W.childElements(W.findChildOfType(e,"picture"));if("ChartTimeStack"==a)s[r].firstElementChild.setAttribute("stroke",n),s[r].lastElementChild.setAttribute("fill",V.increaseTransparency(n,t.stackChartAlpha));else{if("true"==o[r].getAttribute("draw-line")){var l=s[r].firstElementChild;l.setAttribute("stroke",n),"ChartTimePlot"==a&&l.nextElementSibling.setAttribute("fill",V.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=o[r].getAttribute("point-style")&&s[r].lastElementChild.setAttribute("fill",n)}},t.parseDataAndFindMinMax=function(t){for(var e=V.splitSkipEmpty(t," "),r=e.length,i=1/0,n=-1/0,a=1/0,o=-1/0,s=0;s<r;s++)if("empty"==e[s])e[s]=[];else{e[s]=V.splitSkipEmpty(e[s],"|");for(var l=0;l<e[s].length;l++){e[s][l]=e[s][l].split(":");var u=e[s][l][0]=parseFloat(e[s][l][0]),c=e[s][l][1]=parseFloat(e[s][l][1]);u<i&&(i=u),n<u&&(n=u),c<a&&(a=c),o<c&&(o=c)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,o=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:o}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),$=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=W.findChildOfType(t,"picture"),r=W.findChildOfType(t,"pictureback"),i=V.getFloatAttribute(r,"x"),n=V.getFloatAttribute(r,"y"),a=V.getFloatAttribute(r,"width"),o=V.getFloatAttribute(r,"height"),s=W.cloneElementWithId("normal-text");s.setAttribute("fill","grey"),s.setAttribute("text-anchor","middle"),s.setAttribute("x",(i+a/2).toString()),s.setAttribute("y",(n+o/2+3).toString()),s.firstChild.textContent="Not supported at the moment",e.appendChild(s)},t.draw=function(t,e){},t.setItemLook=function(t,e,r,i){},t}(),tt=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=W.findChildOfType(t,"picture"),r=W.findChildOfType(t,"pictureback"),i=V.getFloatAttribute(r,"x"),n=V.getFloatAttribute(r,"y"),a=V.getFloatAttribute(r,"height"),o=W.childElements(W.findChildOfType(t,"legend")).length,s=a/o,l=s*V.getFloatAttribute(t,"bar-width"),u=(s-l)/2;t.setAttribute("rect-height",V.reducePrecision(l).toString());for(var c=0;c<o;c++){var h=W.createSvgElement("g");h.setAttribute("transform","translate("+i+","+(n+c*s+u)+")"),e.appendChild(h),et.addClickTapHandlerToChartItem(h)}},t.prototype.draw=function(e,r){for(var i=W.findChildOfType(e,"pictureback"),n=W.findChildOfType(e,"picture"),a=W.findChildOfType(e,"grid"),o=(V.getFloatAttribute(i,"x"),V.getFloatAttribute(i,"width")),s=V.splitSkipEmpty(r," "),l=s.length,u=-1/0,c=0;c<l;c++)if("empty"==s[c])s[c]=[];else{s[c]=V.splitSkipEmpty(s[c],"|");for(var h=0;h<s[c].length;h++)s[c][h]=s[c][h].split(":"),s[c][h][0]=parseFloat(s[c][h][0]),s[c][h][1]=parseFloat(s[c][h][1]);var d=s[c][s[c].length-1][0];u<d&&(u=d)}u==1/0&&(u=0);for(c=0;c<l;c++)0!=s[c].length&&s[c][s[c].length-1][0]<u&&s[c].push([u,s[c][s[c].length-1][1]]);var p,f=V.getFloatAttribute(e,"scale-max-x");p="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(u,f):Math.max(u,f,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,p-f,p,!1,!0);var m=V.getFloatAttribute(a,"min-x"),g=o/(V.getFloatAttribute(a,"max-x")-m),b=W.childElements(n),v=V.getFloatAttribute(e,"rect-height"),y=t.colorMapping(e);for(c=0;c<l;c++){var A=b[c],T=W.childElements(A),C=T.length,S=0,E="",w=null;for(h=0;h<s[c].length;h++){var k=s[c][h][0],x=s[c][h][1];if(k<m)w=0,E=y(x);else if(null==w)w=(k-m)*g,E=y(x);else{var M=y(x);if(M!=E||h==s[c].length-1){var O=(k-m)*g,I=void 0;S<C?(I=T[S],S++,I.setAttribute("visibility","inherit")):(I=W.createSvgElement("rect"),A.appendChild(I)),V.setMultipleAttributes(I,["x","width","height","fill"],[V.reducePrecision(w),V.reducePrecision(O-w),v,E]),w=O,E=M}}}for(var _=S;_<C;_++)T[_].setAttribute("visibility","hidden")}},t.colorMapping=function(t){var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color");e=V.splitSkipEmpty(e," ");for(var i=[],n=[],a=function(t){var r=e[t].split(":"),a=void 0,o=parseFloat(r[1]);switch(r[0]){case"GREATER":a=function(t){return t>o};break;case"GREATER_OR_EQUALS":a=function(t){return t>=o};break;case"LESS":a=function(t){return t<o};break;case"LESS_OR_EQUALS":a=function(t){return t<=o};break;case"EQUALS":a=function(t){return t==o};break;case"NOT_EQUALS":a=function(t){return t!=o}}i[t]=a,n[t]=r[2]},o=0;o<e.length;o++)a(o);return function(t){for(var e=0;e<i.length;e++)if(i[e](t))return n[e];return r}},t.setItemLook=function(t,e,r,i){var n=W.findChildOfType(t,"picture");W.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),et=function(){function t(t){this.frameDrawing=t,this.chartScaleAndGrid=new K(t),this.chart1D=new Q(t,this.chartScaleAndGrid),this.chart2D=new J(t,this.chartScaleAndGrid),this.chartHistogram=new Z(t,this.chartScaleAndGrid),this.chartHistogram2D=new $(t,this.chartScaleAndGrid),this.chartTimeColor=new tt(t,this.chartScaleAndGrid)}return t.create=function(){return W.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),a=W.findChildOfType(e,"background"),o=W.findChildOfType(e,"pictureback"),s=W.findChildOfType(e,"pictureselect"),l=W.findChildOfType(e,"pictureborderh"),u=W.findChildOfType(e,"pictureborderw"),c=W.findChildOfType(e,"grid"),h=0;h<r.length;h++)switch(r[h]){case"width":case"height":case"fill":case"stroke":a.setAttribute(r[h],i[h]);break;case"pic-width":case"pic-height":o.setAttribute(r[h].substring(4),i[h]),s.setAttribute(r[h].substring(4),i[h]);break;case"pic-fill":o.setAttribute(r[h].substring(4),i[h]);break;case"pic-stroke":l.setAttribute(r[h].substring(4),i[h]),u.setAttribute(r[h].substring(4),i[h]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":c.setAttribute(r[h],i[h]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":t.addItem(e,i[h]);break;case"items-completed":t.setupLegendItemsLayout(e),t.setupPicture(e);break;case"data":this.drawPicture(e,i[h]);break;default:e.setAttribute(r[h],i[h])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=W.findChildOfType(e,"background"),n=W.findChildOfType(e,"pictureback"),a=W.findChildOfType(e,"pictureselect"),o=W.findChildOfType(e,"pictureborderh"),s=W.findChildOfType(e,"pictureborderw"),l=W.findChildOfType(e,"warning"),u=W.findChildOfType(e,"legend"),c=e.getAttribute("leg-pos"),h=V.getFloatAttribute(i,"width"),d=V.getFloatAttribute(i,"height"),p=V.getFloatAttribute(e,"pic-offset-x"),f=V.getFloatAttribute(e,"pic-offset-y"),m=V.getFloatAttribute(n,"width"),g=V.getFloatAttribute(n,"height"),b=V.getFloatAttribute(e,"leg-size"),v=0,y=0,A=0,T=0;switch(c){case"SOUTH":v=p,y=d-b,A=h-p,T=b;break;case"WEST":p+=b,v=0,y=f,A=b,T=d-f;break;case"EAST":v=h-b,y=f,A=b,T=d-f;break;case"NORTH":f+=b,v=p,y=0,A=h-p,T=b}if(V.setMultipleAttributes(n,["x","y"],[p,f]),V.setMultipleAttributes(a,["x","y"],[p,f]),V.setMultipleAttributes(l,["x","y"],[p+m/2,f+g/2+3]),"NONE"==c?u.setAttribute("visibility","hidden"):(u.setAttribute("transform","translate("+v+","+y+")"),V.setMultipleAttributes(u,["width","height"],[A,T])),"ChartPie"==r){var C=m/2,S=g/2,E=W.createSvgElement("ellipse");V.setMultipleAttributes(E,["cx","cy","rx","ry","stroke","fill","visibility"],[p+C,f+S,C,S,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(E,n);var w=W.createSvgElement("ellipse");V.setMultipleAttributes(w,["cx","cy","rx","ry","stroke","fill"],[p+C,f+S,C,S,o.getAttribute("stroke"),"none"]),e.insertBefore(w,o),W.removeElement(e,o),W.removeElement(e,s)}e.onmouseover=function(e){return t.selectChart(e,!0)},e.onmouseout=function(e){return t.selectChart(e,!1)}},t.setupLegendItemsLayout=function(t){for(var e=W.findChildOfType(t,"legend"),r=W.childElements(e),i=V.getFloatAttribute(e,"width"),n=0,a=0,o=0;o<r.length;o++){var s=r[o],l=W.findChildOfType(s,"back"),u=V.getFloatAttribute(l,"width"),c=W.findChildOfType(s,"value"),h=c.getComputedTextLength(),d=Math.max(u,V.getFloatAttribute(c,"x")+h);l.setAttribute("width",d.toString()),0<n&&i<n+d&&(n=0,a+=20),s.setAttribute("transform","translate("+n+","+a+")"),n+=d+5}},t.showChartWarning=function(t,e){var r=W.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=W.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=W.findChildOfType(t,"picture"),r=W.findChildOfType(t,"legend");W.removeAllChildren(r),W.removeAllChildren(e)},t.addItem=function(e,r){var i=e.getAttribute("type"),n=W.findChildOfType(e,"legend"),a=r.split("\n"),o=a[0],s=a[1],l=W.cloneElementWithId("legend-item"),u=W.findChildOfType(l,"color"),c=W.findChildOfType(l,"name"),h=W.findChildOfType(l,"value");u.setAttribute("fill",o),l.setAttribute("original-color",o),c.setAttribute("fill",e.getAttribute("leg-text-color")),c.appendChild(W.createTextNode(s)),h.appendChild(W.createTextNode("")),n.appendChild(l);var d=c.getComputedTextLength();h.setAttribute("x",(V.getFloatAttribute(c,"x")+d+4).toString()),"ChartPlot"==i||"ChartTimePlot"==i?V.setMultipleAttributes(l,["draw-line","line-width","interpolation","point-style"],[a[2],a[3],a[4],a[5]]):"ChartHistogram"==i&&V.setMultipleAttributes(l,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[a[2],a[3],a[4],a[5],a[6]]),t.addClickTapHandlerToChartItem(l)},t.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":Q.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":J.setup(t);break;case"ChartTimeColor":tt.setup(t);break;case"ChartHistogram":Z.setup(t);break;case"ChartHistogram2D":$.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":$.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.selectChart=function(t,e){var r=t.currentTarget;W.findChildOfType(r,"pictureselect").setAttribute("visibility",e?"inherit":"hidden")},t.addClickTapHandlerToChartItem=function(e){new m(e,function(r){return t.selectChartItem(e,!0,!1)},function(r){return t.selectChartItem(e,!1,!1)},null,function(r){return t.selectChartItem(e,!0,!0)},function(t){return!1})},t.selectChartItem=function(e,r,i){for(var n=t.getChartShape(e),a=V.indexInParent(e),o=W.childElements(W.findChildOfType(n,"legend")),s=o[a],l="true"==s.getAttribute("selected"),u=!1,c=0;c<o.length;c++)if(c!=a&&"true"==o[c].getAttribute("selected")){u=!0;break}if(i)return l=!l,s.setAttribute("selected",l?"true":"false"),void t.setChartItemLook(n,a,!1,l);if(l||u){if(l)return;t.setChartItemLook(n,a,!r,r)}else{t.setChartItemLook(n,a,!1,r);for(c=0;c<o.length;c++)c!=a&&t.setChartItemLook(n,c,r,!1)}},t.setChartItemLook=function(e,r,i,n){var a=W.childElements(W.findChildOfType(e,"legend")),o=W.findChildOfType(a[r],"back"),s=W.findChildOfType(a[r],"color");o.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var l=i?t.colorItemGrayed:a[r].getAttribute("original-color");switch(s.setAttribute("fill",l),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":Q.setItemLook(e,r,i,l);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":J.setItemLook(e,r,i,l);break;case"ChartTimeColor":tt.setItemLook(e,r,i,l);break;case"ChartHistogram":Z.setItemLook(e,r,i,l);break;case"ChartHistogram2D":$.setItemLook(e,r,i,l)}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),rt=function(){function t(t){var e=this;this.client=t,this.onWindowResizeEventClosure=function(t){return e.applyNavigationSettings()},this.onSVGPointingEventClosure=function(t){return e.onSVGPointingEvent(t)}}return t.prototype.initSVGNavigation=function(){window.addEventListener("resize",this.onWindowResizeEventClosure,!1),w.addFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.oncontextmenu=function(){return!1},t.addEventListener("mousedown",this.onSVGPointingEventClosure),t.addEventListener("mousemove",this.onSVGPointingEventClosure),t.addEventListener("mouseup",this.onSVGPointingEventClosure),t.addEventListener("mouseout",this.onSVGPointingEventClosure),t.addEventListener("wheel",this.onSVGPointingEventClosure),t.addEventListener("touchstart",this.onSVGPointingEventClosure),t.addEventListener("touchmove",this.onSVGPointingEventClosure),t.addEventListener("touchend",this.onSVGPointingEventClosure),this.buttonDown=0,this.prevPtrCoords=[],this.presentationCoords=[0,0],this.zoom=1},t.prototype.clearSVGNavigation=function(){if(this.client.svg){window.removeEventListener("resize",this.onWindowResizeEventClosure),w.removeFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.removeEventListener("mousedown",this.onSVGPointingEventClosure),t.removeEventListener("mousemove",this.onSVGPointingEventClosure),t.removeEventListener("mouseup",this.onSVGPointingEventClosure),t.removeEventListener("mouseout",this.onSVGPointingEventClosure),t.removeEventListener("wheel",this.onSVGPointingEventClosure),t.removeEventListener("touchstart",this.onSVGPointingEventClosure),t.removeEventListener("touchmove",this.onSVGPointingEventClosure),t.removeEventListener("touchend",this.onSVGPointingEventClosure)}},t.prototype.onSVGPointingEvent=function(e){e.stopPropagation();var r=V.offsetPage(this.client.svg);if(e.type.startsWith("mouse")||"wheel"==e.type){var i=e,n=i.pageX-r.left,a=i.pageY-r.top;switch(i.type){case"mousedown":this.buttonDown=i.which,this.prevPtrCoords=[n,a],1==this.buttonDown||this.buttonDown;break;case"mousemove":if(1==this.buttonDown)i.preventDefault();else if(3==this.buttonDown){var o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];this.applyPanning(o,s),this.prevPtrCoords=[n,a]}break;case"mouseup":case"mouseout":if(this.client.svg.parentNode.contains(i.relatedTarget))return;var l=this.buttonDown;if(this.buttonDown=0,1==l){o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];Math.abs(o)<=t.clickTolerance&&Math.abs(s)<=t.clickTolerance&&this.onPresentationClick(i,n,a)}this.prevPtrCoords=[];break;case"wheel":var u=e;u.altKey?this.onWheelZooming(0<u.deltaY,n,a):(e.preventDefault(),0<u.deltaY?this.applyPanning(0,-50):this.applyPanning(0,50))}}else if(e.type.startsWith("touch")){var c=e,h=void 0,d=void 0,p=void 0,f=void 0;switch(c.touches.length>0&&(h=c.touches[0].pageX-r.left,d=c.touches[0].pageY-r.top),c.touches.length>1&&(p=c.touches[1].pageX-r.left,f=c.touches[1].pageY-r.top),c.type){case"touchstart":this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchmove":if(c.preventDefault(),c.touches.length>1&&4==this.prevPtrCoords.length){var m=(h+p)/2,g=(d+f)/2,b=Math.hypot(this.prevPtrCoords[2]-this.prevPtrCoords[0],this.prevPtrCoords[3]-this.prevPtrCoords[1]),v=Math.hypot(p-h,f-d)/b*this.zoom;v=Math.max(v,t.zooms[0]),v=Math.min(v,t.zooms[t.zooms.length-1]),this.applyZoom(v,m,g)}else if(this.prevPtrCoords.length>=2){o=h-this.prevPtrCoords[0],s=d-this.prevPtrCoords[1];if(4==this.prevPtrCoords.length){var y=Math.hypot(o,s),A=h-this.prevPtrCoords[2],T=d-this.prevPtrCoords[3];Math.hypot(A,T)<y&&(o=A,s=T)}this.applyPanning(o,s)}this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchend":this.prevPtrCoords=[]}}},t.prototype.applyPresentationTransform=function(){var t=this.client.frameDrawing.navigationSettings;if(!t.zoomAndPanningEnabled){var e=this.zoom,r=this.presentationCoords[0],i=this.presentationCoords[1],n=this.client.svg.getBoundingClientRect(),a=n.width,o=n.height;e=Math.max(e,a/t.width),e=Math.max(e,o/t.height),r=Math.min(r,-t.x*e),r=Math.max(r,a-(t.x+t.width)*e),i=Math.min(i,-t.y*e),i=Math.max(i,o-(t.y+t.height)*e),this.presentationCoords=[r,i],this.zoom=e}var s="translate("+this.presentationCoords[0]+","+this.presentationCoords[1]+")",l="scale("+this.zoom+")";this.client.presentation.setAttribute("transform",s+" "+l)},t.prototype.applyZoom=function(t,e,r){if(t!=this.zoom){var i=this.client.frameDrawing.navigationSettings;if(!i.zoomAndPanningEnabled){var n=this.client.svg,a=this.client.svg.getBoundingClientRect(),o=a.width,s=a.height,l=i.width,u=i.height,c=n.parentNode.getBoundingClientRect(),h=c.width,d=c.height;if((t=l/u>h/d?Math.max(t,h/l):Math.max(t,d/u))==this.zoom)return;var p=Math.min(l*t,h),f=Math.min(u*t,d);p!=o&&n.setAttribute("width",p.toString()),f!=s&&n.setAttribute("height",f.toString())}var m=t/this.zoom,g=e-(e-this.presentationCoords[0])*m,b=r-(r-this.presentationCoords[1])*m;this.presentationCoords=[g,b],this.zoom=t,this.applyPresentationTransform()}},t.prototype.applyPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform()},t.prototype.navigateTo=function(t,e,r){this.zoom=r,this.presentationCoords=[-t*this.zoom,-e*this.zoom],this.applyPresentationTransform()},t.prototype.onWheelZooming=function(e,r,i){var n=this.zoom;if(e){for(var a=t.zooms.length-1;a>=0;a--)if(t.zooms[a]<this.zoom){n=t.zooms[a];break}}else for(a=0;a<t.zooms.length;a++)if(this.zoom<t.zooms[a]){n=t.zooms[a];break}this.applyZoom(n,r,i)},t.prototype.onPresentationClick=function(t,e,r){var i=e-this.presentationCoords[0],n=r-this.presentationCoords[1];i/=this.zoom,n/=this.zoom,this.client.frameDrawing.onUserClick(t.target,i,n)},t.prototype.applyNavigationSettings=function(){var t,e,r,i=this.client.svg,n=this.client.frameDrawing.navigationSettings,a=n.width,o=n.height,s=n.zoomAndPanningEnabled,l=n.width/n.height,u=i.parentNode.getBoundingClientRect(),c=u.width,h=u.height,d=c/h,p=n.x,f=n.y;l>d?(r=c/a,t=c,s?f-=((e=h)/r-o)/2:e=c/l):(r=h/o,s?p-=((t=c)/r-a)/2:t=h*l,e=h),V.setMultipleAttributes(i,["width","height"],[t,e]),this.navigateTo(p,f,r)},t.clickTolerance=1,t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t}(),it=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return W.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return W.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return W.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)r[n],e.setAttribute(r[n],i[n]);t.updateGISMarkupPosition(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=W.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=V.getFloatAttribute(t,"lon"),n=V.getFloatAttribute(t,"lat"),a=nt.lonLatToXY(r,i,n);V.setMultipleAttributes(t,["cx","cy"],[a[0],a[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var o=t.getAttribute("lonlatpoints"),s=nt.lonLatPointsToXYPoints(r,o);t.setAttribute("points",s)}},t}(),nt=function(){function t(t){this.frameDrawing=t}return t.prototype.createShapeGISMap=function(){var t=this,e=W.cloneElementWithId("shape-gis-map"),r=function(e){return t.onGISEvent(e)};e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r);var i=W.findChildOfType(e,"map").firstElementChild;return W.findChildOfType(i,"agents").addEventListener("click",function(e){return t.onGISAgentLayerClick(e)}),e},t.prototype.updateShapeGISMap=function(t,e,r){for(var i=W.findChildOfType(t,"background"),n=W.findChildOfType(t,"map"),a=W.findChildOfType(t,"shadow"),o=W.findChildOfType(t,"border"),s=0;s<e.length;s++)switch(e[s]){case"width":case"height":i.setAttribute(e[s],r[s]),n.setAttribute(e[s],r[s]),a.setAttribute(e[s],r[s]),o.setAttribute(e[s],r[s]);break;case"size-completed":t.getAttribute("zoom")&&this.redrawGISMap(t);break;case"background-color":i.setAttribute("fill",r[s]);break;case"border-color":o.setAttribute("stroke",r[s]);break;case"map-completed":this.redrawGISMap(t);break;default:t.setAttribute(e[s],r[s])}},t.prototype.redrawGISMap=function(e){this.redrawGISTiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.prototype.redrawGISTiles=function(e){var r=W.findChildOfType(e,"background"),i=V.getFloatAttribute(r,"width"),n=V.getFloatAttribute(r,"height"),a=t.minGISZoom(i,n),o=W.findChildOfType(e,"map").firstElementChild;o.setAttribute("transform","translate(0,0)");var s=V.getIntAttribute(e,"zoom"),l=V.getFloatAttribute(e,"center-lon"),u=V.getFloatAttribute(e,"center-lat");s<a&&(s=a,e.setAttribute("zoom",s.toString()));var c,h=Math.pow(2,s),d=t.latToTileYFloat(u,s),p=n/2/t.tileImageSize;d-p<0?c=p:h<d+p&&(c=h-p),c&&(u=t.tileYToLat(c,s),e.setAttribute("center-lat",u.toString()));var f=W.findChildOfType(o,"tiles");W.removeAllChildren(f),this.updateGISTiles(f,s,u,l,0,0,i,n,h)},t.prototype.updateGISTiles=function(e,r,i,n,a,o,s,l,u){for(var c=t.lonToTileXInt(n,r),h=t.latToTileYInt(i,r),d=a+s/2-t.lonToXOffsetWithinTile(n,r),p=o+l/2-t.latToYOffsetWithinTile(i,r);d>0;)d-=t.tileImageSize,c--;for(;p>0;)p-=t.tileImageSize,h--;c=V.modulo(c,u),h=V.modulo(h,u);for(var f=[],m=W.childElements(e),g=0;g<m.length;g++)f.push(m[g]);for(var b=c,v=d;v<s;v+=t.tileImageSize){for(var y=h,A=p;A<l;A+=t.tileImageSize){var T=r+"/"+b+"/"+y,C=null;for(g=0;g<f.length;g++)if(f[g].getAttribute("tileid")==T){C=f[g];break}null==C&&(C=this.addGISTile(e,r,b,y)),C.setAttribute("x",(v-a).toString()),C.setAttribute("y",(A-o).toString()),y=V.modulo(y+1,u)}b=V.modulo(b+1,u)}},t.prototype.addGISTile=function(e,r,i,n){var a=W.findParentOfType(e,"ShapeGISMap"),o=this.tileURL(a,r,i,n),s=W.createSvgElement("image");return s.setAttribute("width",t.tileImageSize.toString()),s.setAttribute("height",t.tileImageSize.toString()),s.setAttributeNS(W.xlinkns,"href",o),s.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(s),s},t.redrawGISMarkup=function(t){for(var e=W.findChildOfType(t,"map").firstElementChild,r=W.findChildOfType(e,"markup"),i=W.childElements(r),n=0;n<i.length;n++)it.updateGISMarkupPosition(i[n])},t.redrawGISAgents=function(e){for(var r=W.findChildOfType(e,"map").firstElementChild,i=W.findChildOfType(r,"agents"),n=W.childElements(i),a=0;a<n.length;a++)t.updateGISObjectScale(n[a]),"hidden"!=n[a].getAttribute("visibility")&&t.updateGISObjectPosition(n[a])},t.updateGISObjectPosition=function(e){var r=W.findParentOfType(e,"ShapeGISMap"),i=V.getFloatAttribute(e,"lon"),n=V.getFloatAttribute(e,"lat"),a=V.getFloatAttribute(e,"heading"),o=t.lonLatToXY(r,i,n),s="translate("+o[0]+","+o[1]+") rotate("+a+")",l=e.getAttribute("scale");l&&(s+=" scale("+l+")"),e.setAttribute("transform",s)},t.updateGISObjectScale=function(e){var r=W.findParentOfType(e,"ShapeGISMap"),i=V.getIntAttribute(e,"fixed-scale-zoom");if(i){var n=V.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var a=1;if(V.getIntAttribute(e,"real-scale-zoom")<=n){var o=V.getFloatAttribute(e,"pixels-per-meter"),s=V.getFloatAttribute(e,"lat");a=t.pixelsPerGISMeter(n,s)/o}e.setAttribute("scale",a.toString())}},t.prototype.panGIS=function(e,r,i){var n=W.findChildOfType(e,"map").firstElementChild,a=V.parseTranslateTransform(n.getAttribute("transform")),o=a[0]+r,s=a[1]+i,l=V.getIntAttribute(e,"zoom"),u=Math.pow(2,l),c=V.getFloatAttribute(e,"center-lon"),h=V.getFloatAttribute(e,"center-lat"),d=t.latToTileYFloat(h,l),p=W.findChildOfType(e,"background"),f=V.getFloatAttribute(p,"width"),m=V.getFloatAttribute(p,"height"),g=m/2/t.tileImageSize;d-g-s/t.tileImageSize<0?s=(d-g)*t.tileImageSize:u<d+g-s/t.tileImageSize&&(s=(d+g-u)*t.tileImageSize),o=t.normalizedGISX(o,l),o=Math.round(o),s=Math.round(s),n.setAttribute("transform","translate("+o+","+s+")");var b=W.findChildOfType(n,"tiles");this.updateGISTiles(b,l,h,c,o,s,f,m,u)},t.prototype.zoomOutGIS=function(e,r,i){var n=W.findChildOfType(e,"background"),a=V.getFloatAttribute(n,"width"),o=V.getFloatAttribute(n,"height"),s=V.getIntAttribute(e,"zoom");t.minGISZoom(a,o)<s&&this.setGISZoom(e,r,i,s-1)},t.prototype.zoomInGIS=function(t,e,r){var i=V.getIntAttribute(t,"zoom");i<19&&this.setGISZoom(t,e,r,i+1)},t.prototype.setGISZoom=function(e,r,i,n){var a=W.findChildOfType(e,"background"),o=V.getFloatAttribute(a,"width"),s=V.getFloatAttribute(a,"height"),l=W.findChildOfType(e,"map").firstElementChild,u=V.parseTranslateTransform(l.getAttribute("transform")),c=t.xyToLonLat(e,r-u[0],i-u[1]),h=t.lonToTileXFloat(c[0],n),d=t.latToTileYFloat(c[1],n),p=Math.pow(2,n);h=V.remainderPositive(h-(r-o/2)/t.tileImageSize,p),d=V.remainderPositive(d-(i-s/2)/t.tileImageSize,p);var f=t.tileXToLon(h,n),m=t.tileYToLat(d,n);V.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,f,m]),this.redrawGISMap(e)},t.prototype.onGISClick=function(e,r,i){var n=W.findChildOfType(e,"map").firstElementChild,a=V.parseTranslateTransform(n.getAttribute("transform")),o=t.xyToLonLat(e,r-a[0],i-a[1]);this.frameDrawing.client.network.postUserAction(e.id,o[0]+" "+o[1])},t.prototype.onGISEvent=function(e){var r=e.currentTarget;if("true"==r.getAttribute("navigation-enabled")){var i=W.findChildOfType(r,"background"),n=V.getFloatAttribute(i,"width"),a=V.getFloatAttribute(i,"height"),o=i.getBoundingClientRect(),s=o.width/n,l=o.height/a,u=V.offsetPage(i);if(e.type.startsWith("mouse")||"wheel"==e.type){var c=e,h=(c.pageX-u.left)/s,d=(c.pageY-u.top)/l;switch(e.type){case"mousedown":t.buttonDown=c.which,1==t.buttonDown&&(e.stopPropagation(),t.prevPtrCoords=[h,d]);break;case"mousemove":if(1==t.buttonDown){e.stopPropagation(),e.preventDefault();var p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];t.prevPtrCoords=[h,d],this.panGIS(r,p,f)}break;case"mouseup":case"mouseout":if(r.contains(c.relatedTarget))return;if(1==t.buttonDown){e.stopPropagation();p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];Math.abs(p)<=rt.clickTolerance&&Math.abs(f)<=rt.clickTolerance&&this.onGISClick(r,h,d)}t.buttonDown=0;break;case"wheel":if(!c.altKey&&!c.ctrlKey){var m=e;e.stopPropagation(),e.preventDefault(),0<m.deltaY?this.zoomOutGIS(r,h,d):this.zoomInGIS(r,h,d)}}}else if(e.type.startsWith("touch")){var g=e;if(g.touches.length>2)return;var b=void 0,v=void 0,y=void 0,A=void 0;switch(g.touches.length>0&&(b=(g.touches[0].pageX-u.left)/s,v=(g.touches[0].pageY-u.top)/l),g.touches.length>1&&(y=(g.touches[1].pageX-u.left)/s,A=(g.touches[1].pageY-u.top)/l),e.type){case"touchstart":e.stopPropagation(),t.prevPtrCoords=g.touches.length>1?[b,v,y,A]:[b,v];break;case"touchmove":if(e.stopPropagation(),e.preventDefault(),g.touches.length>1&&4==t.prevPtrCoords.length){var T=(b+y)/2,C=(v+A)/2,S=Math.hypot(t.prevPtrCoords[2]-t.prevPtrCoords[0],t.prevPtrCoords[3]-t.prevPtrCoords[1]),E=Math.hypot(y-b,A-v);(E<.8*S||1.2*S<E)&&(E<S?this.zoomOutGIS(r,T,C):this.zoomInGIS(r,T,C),t.prevPtrCoords=[b,v,y,A])}else if(t.prevPtrCoords.length>=2){p=b-t.prevPtrCoords[0],f=v-t.prevPtrCoords[1];if(4==t.prevPtrCoords.length){var w=Math.hypot(p,f),k=b-t.prevPtrCoords[2],x=v-t.prevPtrCoords[3];Math.hypot(k,x)<w&&(p=k,f=x)}this.panGIS(r,p,f),t.prevPtrCoords=g.touches.length>1?[b,v,y,A]:[b,v]}else t.prevPtrCoords=g.touches.length>1?[b,v,y,A]:[b,v];break;case"touchend":e.stopPropagation(),t.prevPtrCoords=[]}}}},t.prototype.onGISAgentLayerClick=function(t){t.stopPropagation(),t.preventDefault();for(var e=t.currentTarget,r=t.target;r.parentNode!=e;)r=r.parentNode;this.frameDrawing.client.network.postUserAction(r.id,"0 0")},t.xyToLonLat=function(e,r,i){var n=W.findChildOfType(e,"background"),a=V.getFloatAttribute(n,"width"),o=V.getFloatAttribute(n,"height"),s=V.getIntAttribute(e,"zoom"),l=Math.pow(2,s),u=t.lonToTileXFloat(V.getFloatAttribute(e,"center-lon"),s),c=t.latToTileYFloat(V.getFloatAttribute(e,"center-lat"),s),h=(r-a/2)/t.tileImageSize,d=(i-o/2)/t.tileImageSize,p=V.remainderPositive(u+h,l),f=V.remainderPositive(c+d,l);return[t.tileXToLon(p,s),t.tileYToLat(f,s)]},t.lonLatToXY=function(e,r,i){var n=W.findChildOfType(e,"background"),a=V.getFloatAttribute(n,"width"),o=V.getFloatAttribute(n,"height"),s=V.getIntAttribute(e,"zoom"),l=t.lonToTileXFloat(V.getFloatAttribute(e,"center-lon"),s),u=t.latToTileYFloat(V.getFloatAttribute(e,"center-lat"),s),c=t.lonToTileXFloat(r,s),h=t.latToTileYFloat(i,s);return[a/2+(c-l)*t.tileImageSize,o/2+(h-u)*t.tileImageSize]},t.lonLatPointsToXYPoints=function(e,r){var i=W.findChildOfType(e,"background"),n=V.getFloatAttribute(i,"width"),a=V.getFloatAttribute(i,"height"),o=V.getIntAttribute(e,"zoom"),s=t.lonToTileXFloat(V.getFloatAttribute(e,"center-lon"),o),l=t.latToTileYFloat(V.getFloatAttribute(e,"center-lat"),o),u=void 0,c=void 0,h="";r=V.splitSkipEmpty(r," ");for(var d=0;d<r.length;d++){var p=r[d].split(","),f=t.lonToTileXFloat(parseFloat(p[0]),o),m=t.latToTileYFloat(parseFloat(p[1]),o),g=n/2+(f-s)*t.tileImageSize,b=a/2+(m-l)*t.tileImageSize;null!=u&&Math.abs(g-u)<t.gisTolerance&&Math.abs(b-c)<t.gisTolerance||(h+=(g=V.reducePrecision(g))+","+(b=V.reducePrecision(b))+" ",u=g,c=b)}return h},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.prototype.tileURL=function(e,r,i,n){var a;switch(e.getAttribute("tile-url-provider-type")){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":a=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":a=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":a=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":a=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":a=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":a=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":a=V.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}return a[Math.floor(Math.random()*a.length)].replace("[zoom]",r.toString()).replace("[x]",i.toString()).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=V.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=V.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(V.byteArrayToString(n))},t.buttonDown=0,t.prevPtrCoords=[0,0],t.gisTolerance=2,t.tileImageSize=256,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),at=function(){function t(){}return t.createMarkupPipe=function(t){var e=W.cloneElementWithId("markup-pipe"),r=t+"basepath";W.findChildOfType(e,"basepath").firstElementChild.id=r;var i=W.findChildOfType(e,"pipe"),n=W.findChildOfType(e,"inner-pipe"),a=W.findChildOfType(e,"bubbles"),o="#"+r;return i.setAttributeNS(W.xlinkns,"href",o),n.setAttributeNS(W.xlinkns,"href",o),a.setAttributeNS(W.xlinkns,"href",o),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=W.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=W.findChildOfType(t,"batches"),s=W.findChildOfType(t,"bubbles"),l=0;l<e.length;l++)switch(e[l]){case"phase":s.setAttribute("stroke-dashoffset",(12-parseFloat(r[l])).toString());break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=W.childElements(o)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=o.childElementCount,m=p;m<f;m++)W.removeElement(o,o.lastElementChild);for(m=f;m<p;m++)d=W.createUseElement(a),o.appendChild(d);break;case"d":var g=parseFloat(W.findChildOfType(t,"pipe").getAttribute("stroke-width")),b=V.roundPathCorners(r[l],2*g,!1);n.setAttribute("d",b);break;case"width":var v=parseFloat(r[l]);W.findChildOfType(t,"pipe").setAttribute("stroke-width",v.toString()),W.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*v).toString()),o.setAttribute("stroke-width",(.6*v).toString());var y=Math.min(5,.2*v);s.setAttribute("stroke-width",y.toString()),s.setAttribute("stroke-dasharray",y+","+(12-y));break;case"color":W.findChildOfType(t,"pipe").setAttribute("stroke",r[l]);break;case"inner-color":W.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[l]);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupStorageTank=function(){return W.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=W.findChildOfType(t,"square"),n=W.findChildOfType(t,"batches"),a=parseFloat(i.getAttribute("width")),o=0;o<e.length;o++)switch(e[o]){case"batch":var s=r[o].split(" "),l=parseFloat(s[1])*a,u=parseFloat(s[2])*a,c=W.childElements(n)[parseInt(s[0])];V.setMultipleAttributes(c,["y","height","fill"],[a/2-l-u,u,s[3]]);break;case"newbatches":for(var h=parseInt(r[o]),d=n.childElementCount,p=h;p<d;p++)W.removeElement(n,n.lastElementChild);for(p=d;p<h;p++)c=W.createSvgElement("rect"),V.setMultipleAttributes(c,["stroke","width","x"],["none",a,-a/2]),n.appendChild(c);break;case"progress":var f=parseFloat(r[o])*Math.PI*2,m=parseFloat(W.findChildOfType(t,"circle").getAttribute("r"))-2,g=m*Math.sin(f),b=-m*Math.cos(f),v="M 0 "+-m+" ";v+="A "+m+" "+m+" 0 "+(f>Math.PI?"1":"0")+" 1 "+g+" "+b,W.findChildOfType(t,"arc").setAttribute("d",v);break;case"radius":W.findChildOfType(t,"circle").setAttribute("r",r[o]),a=Math.max(10,2*parseFloat(r[o])/Math.sqrt(2)-8),V.setMultipleAttributes(i,["width","height","x","y"],[a,a,-a/2,-a/2]);break;case"color":W.findChildOfType(t,"circle").setAttribute("fill",r[o]);break;case"stroke-color":W.findChildOfType(t,"circle").setAttribute("stroke",r[o]),W.findChildOfType(t,"square").setAttribute("stroke",r[o]);break;default:t.setAttribute(e[o],r[o])}},t.createMarkupBulkConveyorBelt=function(t){var e=W.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";W.findChildOfType(e,"basepath").firstElementChild.id=r;var i=W.findChildOfType(e,"belt"),n=W.findChildOfType(e,"belt-sections"),a="#"+r;return i.setAttributeNS(W.xlinkns,"href",a),n.setAttributeNS(W.xlinkns,"href",a),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=W.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=W.findChildOfType(t,"belt-sections"),s=W.findChildOfType(t,"batches"),l=0;l<e.length;l++)switch(e[l]){case"phase":o.setAttribute("stroke-dashoffset",r[l]);break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=W.childElements(s)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=s.childElementCount,m=p;m<f;m++)W.removeElement(s,s.lastElementChild);for(m=f;m<p;m++)d=W.createUseElement(a),s.appendChild(d);break;case"d":n.setAttribute("d",r[l]);break;case"width":var g=r[l];W.findChildOfType(t,"belt").setAttribute("stroke-width",g),o.setAttribute("stroke-width",g),o.setAttribute("stroke-dasharray","2, 10"),s.setAttribute("stroke-width",(.4*parseFloat(g)).toString());break;case"color":W.findChildOfType(t,"belt").setAttribute("stroke",r[l]);break;case"sections-color":o.setAttribute("stroke",r[l]);break;default:t.setAttribute(e[l],r[l])}},t}(),ot=function(){function t(){}return t.createMarkupPath=function(t,e){var r=W.cloneElementWithId("markup-path"),i=e+"basepath";W.findChildOfType(r,"basepath").firstElementChild.id=i;var n=W.findChildOfType(r,"paths"),a=1;"MarkupPathRoad"==t&&(a=2),"MarkupPathRailroad"==t&&(a=4);for(var o=0;o<a;o++){var s=W.createUseElement(i);n.appendChild(s)}var l=W.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),l.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),W.childElements(n)[1].setAttribute("stroke","black"),W.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=W.findChildOfType(t,"basepath").firstElementChild,a=W.findChildOfType(t,"paths"),o=a.firstElementChild,s=W.findChildOfType(t,"arrows"),l=0;l<e.length;l++)switch(e[l]){case"d":n.setAttribute("d",r[l]);break;case"bidirectional":W.removeAllChildren(s),"false"==r[l]&&V.addPathArrows(n,"arrowhead",1.7,s,50,100);break;case"stroke-width":var u=parseFloat(r[l]);switch(i){case"MarkupPathLine":o.setAttribute("stroke-width",u.toString());break;case"MarkupPathDashline":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",4*u+" "+u);break;case"MarkupPathConveyor":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",u/2+" "+u/10);break;case"MarkupPathRoad":o.setAttribute("stroke-width",u.toString());var c=a.lastElementChild;c.setAttribute("stroke-width",(u/12).toString()),c.setAttribute("stroke-dasharray",u/2+" "+u/5);break;case"MarkupPathRailroad":var h=u/10+" "+u/2.5;o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",h),W.childElements(a)[1].setAttribute("stroke-width",(u/2+u/12).toString()),W.childElements(a)[2].setAttribute("stroke-width",(u/2).toString());var d=a.lastElementChild;d.setAttribute("stroke-width",(u/2).toString()),d.setAttribute("stroke-dasharray",h)}break;case"stroke":o.setAttribute("stroke",r[l]),u=parseFloat(o.getAttribute("stroke-width")),s.setAttribute("stroke",u>4?"white":r[l]);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupAreaNode=function(t){var e,r=W.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=W.createSvgElement("rect");break;case"MarkupPolygonalNode":e=W.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:i.setAttribute(e[n],r[n])}},t.createMarkupPalletRack=function(){return W.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"stroke":n.setAttribute(e[a],r[a]);break;case"fill":i.setAttribute(e[a],r[a]);break;case"rack-data":W.removeAllChildren(i),W.removeAllChildren(n);var o=r[a].split(" "),s=parseInt(o[0]),l=parseInt(o[1]),u=parseFloat(o[2]),c=parseFloat(o[3]),h=parseFloat(o[4]),d=void 0,p=void 0,f=void 0;s>1&&(d=parseFloat(o[5]),p=parseFloat(o[6]),f=c+d);var m=W.createSvgElement("rect");if(m.setAttribute("width",u.toString()),m.setAttribute("height",c.toString()),i.appendChild(m),s>1){var g=W.createSvgElement("rect");g.setAttribute("width",u.toString()),g.setAttribute("height",p.toString()),g.setAttribute("transform","translate( 0 "+f+")"),i.appendChild(g)}for(var b=h,v=0;v<l-1;v++){var y=W.createSvgElement("line");V.setMultipleAttributes(y,["x1","x2","y1","y2"],[b,b,"0",c]),n.appendChild(y),b+=h}if(s>1){var A=f+p;b=h;for(v=0;v<l-1;v++){y=W.createSvgElement("line");V.setMultipleAttributes(y,["x1","x2","y1","y2"],[b,b,f,A]),n.appendChild(y),b+=h}}break;default:t.setAttribute(e[a],r[a])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),st=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=W.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=W.createSvgElement("path");break;case"MarkupCircularWall":r=W.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=W.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupTargetLine=function(){return W.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=W.findChildOfType(e,"polyline"),a=W.findChildOfType(e,"serif-start"),o=W.findChildOfType(e,"serif-end"),s=0;s<r.length;s++)switch(r[s]){case"color":e.setAttribute("stroke",i[s]);break;case"points":n.setAttribute(r[s],i[s]);var l=i[s].split(" "),u=l.length;l[u-1].includes(",")||u--,t.setSerif(l[0],l[1],a),t.setSerif(l[u-1],l[u-2],o);break;default:e.setAttribute(r[s],i[s])}},t.createMarkupPathway=function(){return W.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=W.findChildOfType(t,"polygon"),n=W.findChildOfType(t,"polyline"),a=W.findChildOfType(t,"ties"),o=0;o<e.length;o++)switch(e[o]){case"color":a.setAttribute("stroke",r[o]);break;case"points":var s=r[o].split(" "),l="",u="",c="";W.removeAllChildren(a);for(var h=0;h<s.length;h++){var d=V.splitToFloats(s[h],",");if(4==d.length){l+=d[0]+","+d[1]+" ",u=d[2]+","+d[3]+" "+u,c+=(d[0]+d[2])/2+","+(d[1]+d[3])/2+" ";var p=W.createSvgElement("line");V.setMultipleAttributes(p,["x1","y1","x2","y2"],[d[0],d[1],d[2],d[3]]),a.appendChild(p)}}i.setAttribute("points",l+u),n.setAttribute("points",c);break;default:t.setAttribute(e[o],r[o])}},t.createMarkupPedFlowStatistics=function(){return W.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=W.findChildOfType(t,"line"),n=W.findChildOfType(t,"serif-end"),a=W.findChildOfType(t,"direction"),o=W.findChildOfType(t,"arrow-right"),s=W.findChildOfType(t,"arrow-left"),l=0;l<e.length;l++)switch(e[l]){case"color":t.setAttribute("stroke",r[l]);break;case"length":i.setAttribute("x2",r[l]),n.setAttribute("x1",r[l]),n.setAttribute("x2",r[l]);var u=parseInt(r[l])/2;a.setAttribute("x1",u.toString()),a.setAttribute("x2",u.toString()),o.setAttribute("transform","translate("+u+" 13) rotate(90)"),s.setAttribute("transform","translate("+u+" -13) rotate(-90)");break;case"direction":switch(o.setAttribute("visibility","inherit"),s.setAttribute("visibility","inherit"),r[l]){case"right":s.setAttribute("visibility","hidden");break;case"left":o.setAttribute("visibility","hidden")}break;default:t.setAttribute(e[l],r[l])}},t.createMarkupServiceWithLines=function(){return W.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=W.findChildOfType(e,"queues"),a=W.findChildOfType(e,"services"),o=W.findChildOfType(e,"reverse-queues"),s=W.findChildOfType(e,"area"),l=0;l<r.length;l++)switch(r[l]){case"queue-color":n.setAttribute("stroke",i[l]);break;case"reverse-queue-color":o.setAttribute("stroke",i[l]);break;case"service-color":a.setAttribute("stroke",i[l]);break;case"clear-all-queues":W.removeAllChildren(n),W.removeAllChildren(o);break;case"queue":t.addQueue(n,i[l]);break;case"reverse-queue":t.addQueue(o,i[l]);break;case"clear-services":W.removeAllChildren(a);break;case"service":t.addService(a,i[l]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":s.setAttribute(r[l],i[l]);break;default:e.setAttribute(r[l],i[l])}},t.createMarkupServiceWithArea=function(){return W.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=W.findChildOfType(e,"services"),a=0;a<r.length;a++)switch(r[a]){case"service-color":n.setAttribute("stroke",i[a]);break;case"clear-services":W.removeAllChildren(n);break;case"service":t.addService(n,i[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":break;default:e.setAttribute(r[a],i[a])}},t.createMarkupEscalatorGroup=function(){return W.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=W.findChildOfType(t,"background"),n=W.findChildOfType(t,"escalators"),a=0;a<e.length;a++)switch(e[a]){case"balustrade-color":i.setAttribute("fill",r[a]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[a]?"inherit":"hidden");break;case"dimensions-completed":var o=V.getIntAttribute(t,"number-of-escalators"),s=V.getFloatAttribute(t,"width"),l=V.getFloatAttribute(t,"length"),u=V.getFloatAttribute(t,"left-balustrade-width"),c=V.getFloatAttribute(t,"right-balustrade-width"),h=V.getFloatAttribute(t,"internal-balustrade-width"),d=V.getFloatAttribute(t,"lower-landing-length"),p=u+c+o*s+(o-1)*h,f=d+l+V.getFloatAttribute(t,"upper-landing-length");V.setMultipleAttributes(i,["y","width","height"],[-u,f,p]);for(var m=0;m<o;m++){var g=m*(s+h),b=W.cloneElementWithId("escalator"),v=W.findChildOfType(b,"background");V.setMultipleAttributes(v,["y","width","height"],[g,f,s]);var y=W.findChildOfType(b,"handrail-left"),A=W.findChildOfType(b,"handrail-right");V.setMultipleAttributes(y,["x2","y1","y2"],[f,g,g]),V.setMultipleAttributes(A,["x2","y1","y2"],[f,g+s,g+s]);var T=W.findChildOfType(b,"lower-landing-end"),C=W.findChildOfType(b,"upper-landing-end");V.setMultipleAttributes(T,["x1","x2","y1","y2"],[d,d,g,g+s]),V.setMultipleAttributes(C,["x1","x2","y1","y2"],[d+l,d+l,g,g+s]);var S=W.findChildOfType(b,"stairs");V.setMultipleAttributes(S,["x1","x2","y1","y2","stroke-width"],[d,d+l,g+s/2,g+s/2,s]),n.appendChild(b)}break;case"offsets":var E=V.splitToFloats(r[a]," "),w=W.childElements(n);for(m=0;m<w.length;m++)W.findChildOfType(w[m],"stairs").setAttribute("stroke-dashoffset",(-E[m]).toString());break;default:t.setAttribute(e[a],r[a])}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(n[0])-a,l=parseFloat(n[1])-o,u=Math.hypot(s,l),c=3*l/u,h=3*s/u;V.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+c,a-c,o-h,o+h])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(V.getSubAttribute(i,"x")),a=parseFloat(V.getSubAttribute(i,"y")),o=V.radiansToDegrees(parseFloat(V.getSubAttribute(i,"orientation")));if("point"==V.getSubAttribute(i,"type")){(r=W.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+a+")");var s=W.createUseElement("arrowhead-small");s.setAttribute("transform","translate("+(n-11)+" "+a+") rotate("+o+" 11 0)"),t.appendChild(s)}else{(r=W.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+a+") rotate("+o+")");var l=r.firstElementChild.nextElementSibling,u=parseFloat(V.getSubAttribute(i,"length"));if(l.setAttribute("x2",u),"true"==V.getSubAttribute(i,"bidirectional")){var c=r.lastElementChild;c.setAttribute("visibility","inherit"),c.setAttribute("transform","translate("+(u+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=V.splitSkipEmpty(e,"|"),i=V.getSubAttribute(r,"queue-path"),n=W.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),V.addPathArrows(n,"arrowhead-small",.7,t,50,100);var a=V.getSubAttribute(r,"fence-color");if(a)for(var o=[V.getSubAttribute(r,"fence-path-left"),V.getSubAttribute(r,"fence-path-right")],s=0;s<o.length;s++){var l=W.createSvgElement("path");V.setMultipleAttributes(l,["d","stroke","stroke-width","stroke-dasharray"],[o[s],a,"2","none"]),t.appendChild(l)}},t}(),lt=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return W.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return W.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i])},t}(),ut=function(){function t(){}return t.createMarkupIntersection=function(){return W.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=W.findChildOfType(t,"lane-connectors"),a=0;a<e.length;a++)switch(e[a]){case"fill":case"d":i.setAttribute(e[a],r[a]);break;case"lane-connector":var o=W.createSvgElement("g"),s=W.createSvgElement("path");s.setAttribute("d",r[a]),o.appendChild(s),V.addPathArrows(s,"arrowhead-tiny",.5,o,20,40),n.appendChild(o);break;case"lane-connector-colors":for(var l=V.splitSkipEmpty(r[a]," "),u=W.childElements(n),c=0;c<u.length;c++)u[c].setAttribute("stroke",l[c]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupRoad=function(){return W.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=W.findChildOfType(e,"lanes"),a=W.findChildOfType(e,"delimiters"),o=W.findChildOfType(e,"median"),s=0;s<r.length;s++)switch(r[s]){case"lane-width":n.setAttribute("stroke-width",i[s]);break;case"lane-color":n.setAttribute("stroke",i[s]);break;case"forward-lane":case"backward-lane":var l=W.createSvgElement("path");l.setAttribute("d",i[s]),n.appendChild(l);break;case"lane-delimiter-color":a.setAttribute("stroke",i[s]);break;case"lane-delimiter-width":case"lane-delimiter-style":a.setAttribute(r[s],i[s]);break;case"lane-delimiter":var u=V.getFloatAttribute(a,"lane-delimiter-width"),c=a.getAttribute("lane-delimiter-style");t.addDelimiter(a,u,c,i[s],n.getAttribute("stroke"));break;case"median-color":o.setAttribute("stroke",i[s]);break;case"median-width":case"median-style":o.setAttribute(r[s],i[s]);break;case"median":u=V.getFloatAttribute(o,"median-width"),c=o.getAttribute("median-style"),t.addDelimiter(o,u,c,i[s],n.getAttribute("stroke"));break;default:e.setAttribute(r[s],i[s])}},t.addDelimiter=function(t,e,r,i,n){var a=r.includes("DASHED"),o=r.includes("DOUBLE"),s=W.createSvgElement("path");if(s.setAttribute("d",i),s.setAttribute("stroke-width",(o?3*e:e).toString()),a&&s.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(s),o){var l=W.createSvgElement("path");V.setMultipleAttributes(l,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(l)}},t.createMarkupStopLine=function(){return W.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:t.setAttribute(e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return W.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t}(),ct=function(){function t(e){this.serverFPS=t.MAX_FPS,this.client=e,this.chart=new et(this),this.control=new q(this),this.shapeComposite=new Y(this),this.shapeGISMap=new nt(this)}return t.prototype.start=function(){this.frameDrawStartTime=Date.now(),this.catchingUp=!1,this.frameCount=0,this.fpsMeasureStartTime=null,this.actualFPS=0,this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.fullFrame=!1,this.packetFPS=t.MAX_FPS,this.desiredFPS=t.MAX_FPS,this.frameBuffer=[],this.sleepTimeStatistics=new Array(t.SLEEP_TIME_STATISTICS_SIZE),this.sleepTimeStatistics.fill(1e3/t.MAX_FPS),this.startMeasureInterval(),this.startFrameDrawingTimeout(this.desiredFPS)},t.prototype.stop=function(){this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.frameBuffer=[],this.stopMeasureInterval(),this.stopFrameDrawingTimeout()},t.prototype.startMeasureInterval=function(){var t=this;this.fpsMeasureIntervalId=setInterval(function(){return t.measureFPS()},1e3)},t.prototype.stopMeasureInterval=function(){this.fpsMeasureIntervalId&&(clearInterval(this.fpsMeasureIntervalId),this.fpsMeasureIntervalId=void 0)},t.prototype.startFrameDrawingTimeout=function(t){var e=this;this.frameDrawingTimeoutId=setTimeout(function(){var t=Date.now();e.drawFrame();var r=1e3/e.desiredFPS-(Date.now()-t);r<0&&(r=0),e.sleepTimeStatistics.push(r),e.sleepTimeStatistics.shift(),e.startFrameDrawingTimeout(r)},t)},t.prototype.stopFrameDrawingTimeout=function(){this.frameDrawingTimeoutId&&(clearTimeout(this.frameDrawingTimeoutId),this.frameDrawingTimeoutId=void 0)},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.totalFrameCount=function(){var t=this.frameBuffer.length;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.findOrRequestFullFrame=function(){if(this.fullFrame)console.log("Found a full frame in the local buffer, starting from there");else{for(var t=0;t<this.packetBuffer.length;t++){if(this.packetBuffer[t].fullFrame)return console.log("Found a full frame in the local buffer, starting from there"),void this.packetBuffer.splice(0,t)}this.packetBuffer=[],console.log("Cleared local frame buffer, requesting full frame from the server"),this.client.network.requestAndWaitFullFrame()}},t.prototype.switchToNextFrame=function(){if(0==this.frameBuffer.length){if(0==this.packetBuffer.length)return this.fullFrame=!1,this.packetFPS=t.MAX_FPS,void(this.desiredFPS=t.MAX_FPS);var e=this.packetBuffer.shift();this.frameBuffer=e.frames,this.fullFrame=e.fullFrame,this.packetFPS=e.fps,this.desiredFPS=e.fps,this.updateServerFpsIfNeeded()}return this.frameBuffer.shift()},t.prototype.updateServerFpsIfNeeded=function(){var e=this.actualFPS/this.packetFPS,r=this.measureSleepTime();if(e>=.9&&r>50&&this.serverFPS<t.MAX_FPS)return this.serverFPS++,void this.client.network.postMaxFPS(this.serverFPS);e<.9&&r<50&&this.serverFPS>1&&(this.serverFPS--,e<.7&&this.serverFPS>1&&this.serverFPS--,e<.6&&this.serverFPS>1&&this.serverFPS--,this.client.network.postMaxFPS(this.serverFPS))},t.prototype.measureSleepTime=function(){for(var t=0,e=0;e<this.sleepTimeStatistics.length;e++)t+=this.sleepTimeStatistics[e];return t/=this.sleepTimeStatistics.length},t.prototype.drawFrame=function(){var e=this.switchToNextFrame();if(e){this.client.updateExperimentState(e),this.fullFrame&&(this.fullFrame=!1,W.removeAllChildren(this.client.presentation)),this.frameDrawStartTime=Date.now(),this.client.svg.suspendRedraw(5e3),this.time=e.time;var r,i,n,a=e.commands;if(a.length>0&&"white"!=this.client.svg.style.backgroundColor&&(this.client.svg.style.backgroundColor="white"),gt.DEBUG_MODE){var o=this.totalFrameCount();this.client.debugger.timeInfo.innerHTML=V.formatNumber(this.time,2),this.client.debugger.serverQueueInfo.innerHTML=this.client.network.serverQueue,this.client.debugger.browserQueueInfo.innerHTML=o+":"+this.client.network.packetManager.totalFrameCount(),r=0,i=0,n=0}for(var s=0;s<a.length;s++){var l=a[s],u=void 0,c=l.groupId,h=l.att,d=l.val,p=void 0;switch(l.cmd){case"C":if(p=this.createShape(l.type,l.id),null==c)this.client.presentation.appendChild(p);else{if(null==(u=document.getElementById(c)))return console.log("Can't find container to add a shape to, container id = "+c,l),void this.findOrRequestFullFrame();if("ShapeGISMap"==u.getAttribute("type")){var f=W.findChildOfType(u,"map").firstElementChild;u=l.type.startsWith("MarkupGIS")?W.findChildOfType(f,"markup"):W.findChildOfType(f,"agents")}u.appendChild(p)}this.updateShape(p,h,d),r++;break;case"U":if(null==(p=document.getElementById(l.id)))return console.log("Can't find shape to be updated, shape id = "+l.id,l),void this.findOrRequestFullFrame();this.updateShape(p,h,d),i++;break;case"D":if(null==(p=document.getElementById(l.id)))return console.log("Can't find shape to be deleted, shape id = "+l.id,l),void this.findOrRequestFullFrame();W.removeElement(p.parentNode,p),n++;break;case"S":this.applySettings(h,d);break;case"N":this.applyNavigation(h,d);break;case"M":t.showMessage(h,d);break;case"W":t.openURL(h,d);break;default:return void this.client.stopAndAlert("Unknown command: "+l.cmd,null)}}this.client.svg.unsuspendRedrawAll(),this.frameCount++,gt.DEBUG_MODE&&(this.client.debugger.cudCountInfo.innerHTML=r+"/"+i+"/"+n,this.client.debugger.drawTimeInfo.innerHTML=Date.now()-this.frameDrawStartTime,this.client.debugger.shapeCountInfo.innerHTML=z.elementcount),!this.catchingUp&&this.packetBuffer.length>1?(this.catchingUp=!0,this.desiredFPS=1e3/this.packetFPS*.8):this.catchingUp&&(this.catchingUp=!1,this.desiredFPS=1e3/this.packetFPS)}},t.prototype.createShape=function(t,e){var r;if(W.isPrimitiveSVGElement(t))r=W.createSvgElement(t);else switch(t){case"ShapeArc":r=Y.createShapeArc();break;case"ShapeText":r=Y.createShapeText();break;case"ShapeImage":r=Y.createShapeImage();break;case"ShapeCanvas":r=Y.createShapeCanvas(e);break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=ot.createMarkupPath(t,e);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=ot.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=ot.createMarkupPalletRack();break;case"MarkupRailwaySwitch":r=lt.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=lt.createMarkupPositionOnTrack();break;case"MarkupPipe":r=at.createMarkupPipe(e);break;case"MarkupStorageTank":r=at.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=at.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=st.createMarkupWall(t,e);break;case"MarkupTargetLine":r=st.createMarkupTargetLine();break;case"MarkupPathway":r=st.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=st.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=st.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=st.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=st.createMarkupEscalatorGroup();break;case"MarkupIntersection":r=ut.createMarkupIntersection();break;case"MarkupRoad":r=ut.createMarkupRoad();break;case"MarkupStopLine":r=ut.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=ut.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=it.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=et.create();break;case"Window3D":r=j.create();break;default:return this.client.stopAndAlert("Can't create: unknown object type: "+t,void 0),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(t,e,r){var i=t.getAttribute("type");if(W.isPrimitiveSVGElement(i))for(var n=0;n<e.length;n++)if("href"==e[n])t.setAttributeNS(W.xlinkns,"href",r[n]);else if("href-path"==e[n])t.setAttributeNS(W.xlinkns,"href",this.client.network.getJarResourceURL(r[n]));else if("geo"==e[n]){var a=r[n].split("|");t.setAttribute("lon",a[0]),t.setAttribute("lat",a[1]),t.setAttribute("heading",a[2]),nt.updateGISObjectPosition(t)}else t.setAttribute(e[n],r[n]);else switch(i){case"ShapeArc":Y.updateShapeArc(t,e,r);break;case"ShapeText":Y.updateShapeText(t,e,r);break;case"ShapeImage":this.shapeComposite.updateShapeImage(t,e,r);break;case"ShapeCanvas":Y.updateShapeCanvas(t,e,r);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(t,e,r);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(t,e,r);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":ot.updateMarkupPath(t,e,r);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":ot.updateMarkupAreaNode(t,e,r);break;case"MarkupPalletRack":ot.updateMarkupPalletRack(t,e,r);break;case"MarkupRailwaySwitch":lt.updateMarkupRailwaySwitch(t,e,r);break;case"MarkupPositionOnTrack":lt.updateMarkupPositionOnTrack(t,e,r);break;case"MarkupPipe":at.updateMarkupPipe(t,e,r);break;case"MarkupStorageTank":at.updateMarkupStorageTank(t,e,r);break;case"MarkupBulkConveyorBelt":at.updateMarkupBulkConveyorBelt(t,e,r);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":st.updateMarkupWall(t,e,r);break;case"MarkupTargetLine":st.updateMarkupTargetLine(t,e,r);break;case"MarkupPathway":st.updateMarkupPathway(t,e,r);break;case"MarkupPedFlowStatistics":st.updateMarkupPedFlowStatistics(t,e,r);break;case"MarkupServiceWithLines":st.updateMarkupServiceWithLines(t,e,r);break;case"MarkupServiceWithArea":st.updateMarkupServiceWithArea(t,e,r);break;case"MarkupEscalatorGroup":st.updateMarkupEscalatorGroup(t,e,r);break;case"MarkupIntersection":ut.updateMarkupIntersection(t,e,r);break;case"MarkupRoad":ut.updateMarkupRoad(t,e,r);break;case"MarkupStopLine":ut.updateMarkupStopLine(t,e,r);break;case"MarkupBusStop":case"MarkupParkingLot":ut.updateMarkupBusStopOrParkingLot(t,e,r);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":it.updateGISMarkup(t,e,r);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(t,e,r);break;case"Window3D":j.update(t,e,r)}},t.prototype.measureFPS=function(){var t=Date.now();null!=this.fpsMeasureStartTime&&(this.actualFPS=Math.round(1e3*this.frameCount/(t-this.fpsMeasureStartTime))),gt.DEBUG_MODE&&(this.client.debugger.fpsInfo.innerHTML=this.actualFPS+":"+this.packetFPS),this.fpsMeasureStartTime=t,this.frameCount=0},t.prototype.onControlAction=function(t,e){this.client.network.postUserAction(t,e)},t.prototype.onUserClick=function(t,e,r){W.isContainedInElementOfType(t,q.controlTypes)||W.isContainedInElementOfType(t,et.chartTypes)||W.isContainedInElementOfType(t,["Window3D"])||W.isContainedInElementOfType(t,["ShapeGISMap"])||this.client.network.postUserAction(0,e+" "+r)},t.prototype.applySettings=function(t,e){for(var r=0;r<t.length;r++)this.modelSettings[V.hyphenToCameLCase(t[r])]=e[r];this.modelSettings.startTime=parseInt(this.modelSettings.startTime),this.modelSettings.startDate=parseInt(this.modelSettings.startDate),this.modelSettings.stopTime&&(this.modelSettings.stopTime=parseInt(this.modelSettings.startTime),this.modelSettings.stopDate=parseInt(this.modelSettings.startDate))},t.prototype.applyNavigation=function(t,e){for(var r=0;r<t.length;r++)this.navigationSettings[V.hyphenToCameLCase(t[r])]=e[r];this.navigationSettings.x=parseFloat(this.navigationSettings.x),this.navigationSettings.y=parseFloat(this.navigationSettings.y),this.navigationSettings.width=parseFloat(this.navigationSettings.width),this.navigationSettings.height=parseFloat(this.navigationSettings.height),this.navigationSettings.zoomAndPanningEnabled="true"==this.navigationSettings.zoomAndPanningEnabled,this.client.setNavigationSettings(this.navigationSettings.width,this.navigationSettings.height),this.client.navigation.applyNavigationSettings()},t.showMessage=function(t,e){for(var r={},i=0;i<t.length;i++)r[V.hyphenToCameLCase(t[i])]=e[i];var n=document.getElementById("svg-message-background"),a=document.getElementById("svg-message-box-title"),o=document.getElementById("svg-message-box-text"),s=document.getElementById("svg-message-box-icon-info"),l=document.getElementById("svg-message-box-icon-error");a.innerText=r.title,o.innerHTML=r.text.replace(/\n/g,"<br>"),r.type.startsWith("error")?(s.style.display="none",l.style.removeProperty("display"),a.classList.remove("svg-message-box-colors-info"),a.classList.add("svg-message-box-colors-error"),""==r.title&&(a.innerHTML="Error")):(s.style.removeProperty("display"),l.style.display="none",a.classList.remove("svg-message-box-colors-error"),a.classList.add("svg-message-box-colors-info"),""==r.title&&(a.innerHTML="Message")),n.style.removeProperty("display")},t.openURL=function(e,r){var i=r[0];i.startsWith("http://")&&i.startsWith("https://")||(i="http://"+i);var n=["message","Open URL","The model asks you to open an external URL:<br><a href="+i+" target = '_blank' onclick = 'document.getElementById( \"svg-message-background\" ).style.display = \"none\"'>"+i+"</a><br><br>The URL will open in a new window"];t.showMessage(["type","title","text"],n)},t.SLEEP_TIME_STATISTICS_SIZE=20,t.MAX_FPS=20,t}(),ht=function(){function t(t,e,r){var i=this;this.networkManager=t,this.startTime=Date.now(),this.xhttp=this.networkManager.getAnimationPacket(e,function(){i.stopTime=Date.now(),r(i)})}return t.prototype.requestTime=function(){return this.stopTime?this.stopTime-this.startTime:Date.now()-this.startTime},t.prototype.abort=function(){this.xhttp.abort()},t}(),dt=function(){function t(t){this.paused=!1,this.networkManager=t}return t.prototype.start=function(){this.fullFrame=!0,this.activeRequests=[],this.responseTimeStatistics=new Array(t.REQUEST_STATISTICS_SIZE),this.responseTimeStatistics.fill(ft.MIN_REQUEST_INTERVAL),this.requestInterval=ft.MIN_REQUEST_INTERVAL,this.lastRequestTime=0,this.createRequest(),this.startRequestTimeout()},t.prototype.stop=function(){this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.pause=function(){this.paused=!0,this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.requestFullFrame=function(){console.debug(">> SVG: Request full frame."),this.fullFrame=!0},t.prototype.startRequestTimeout=function(){var t=this;this.requestTimeoutId=setTimeout(function(){t.processRequestTimeout()},this.requestInterval)},t.prototype.processRequestTimeout=function(){this.requestTimeoutId=void 0,this.activeRequests.length<ft.MAX_REQUEST_COUNT&&(this.createRequest(),this.startRequestTimeout())},t.prototype.createRequest=function(){var t=this,e=new ht(this.networkManager,this.fullFrame,function(e){return t.processResponse(e)});this.fullFrame=!1,this.activeRequests.push(e),this.lastRequestTime=Date.now()},t.prototype.processResponse=function(t){var e=this.activeRequests.indexOf(t);if(this.activeRequests.splice(e,1),this.addToResponseTimeStatistics(t.requestTime()),void 0!==this.requestTimeoutId||this.paused||(this.createRequest(),this.startRequestTimeout()),4==t.xhttp.readyState&&200==t.xhttp.status){var r=JSON.parse(t.xhttp.responseText);this.networkManager.packetManager.addPacket(r)}},t.prototype.addToResponseTimeStatistics=function(t){this.responseTimeStatistics.push(t),this.responseTimeStatistics.shift(),this.requestInterval=this.calculateRequestInterval(),this.networkManager.RPS=1e3/this.requestInterval},t.prototype.calculateRequestInterval=function(){if(0===this.responseTimeStatistics.length)return ft.MIN_REQUEST_INTERVAL;for(var t=0,e=0;e<this.responseTimeStatistics.length;e++)t+=this.responseTimeStatistics[e];var r=t/this.responseTimeStatistics.length*.5;return r<ft.MIN_REQUEST_INTERVAL?ft.MIN_REQUEST_INTERVAL:r>ft.MAX_REQUEST_INTERVAL?ft.MAX_REQUEST_INTERVAL:r},t.REQUEST_STATISTICS_SIZE=10,t}(),pt=function(){function t(t){this.client=t,this.reset()}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.waitingFullFrame=!1,this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.pause=function(){this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.addPacket=function(t){if(t){var e=t.frames;if(e&&0!==e.length){var r=e[0];if(!(r.number<this.expectedFrameNumber)){if(r.number===this.expectedFrameNumber||t.fullFrame){this.client.network.serverQueue=t.serverQueue;var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),this.cancelWaitExpectedFrameTimeoutIfNeeded(),void(t.fullFrame&&(this.waitingFullFrame=!1))}this.insertToPacketBuffer(t),console.debug(">> SVG: Reordering  or packet loss expectedFrame=",this.expectedFrameNumber),this.startWaitExpectedFrameTimeoutIfNeeded()}}}},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length&&!(this.packetBuffer[0].frames[0].number>=this.expectedFrameNumber)){var t=this.packetBuffer[this.packetBuffer.length-1];if(t.frames[t.frames.length-1].number>=this.expectedFrameNumber)this.packetBuffer=[];else{for(var e=0;e<this.packetBuffer.length&&!(this.packetBuffer[e].frames[0].number>=this.expectedFrameNumber);e++);this.packetBuffer.splice(0,e)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length&&this.packetBuffer[0].frames[0].number===this.expectedFrameNumber){for(var t=this.expectedFrameNumber,e=0;e<this.packetBuffer.length;e++){var r=this.packetBuffer[e].frames;if(r[0].number!==t)break;t=r[r.length-1].number+1}var i=this.packetBuffer.splice(0,e);this.client.frameDrawing.addAllPackets(i),this.expectedFrameNumber=t}},t.prototype.cancelWaitExpectedFrameTimeoutIfNeeded=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startWaitExpectedFrameTimeoutIfNeeded=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,t.client.network.requestFullFrame()},4*this.client.network.RPS*1e3))},t.prototype.waitFullFrame=function(){console.debug(">> SVG: Wait full frame."),this.waitingFullFrame=!0,this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t}(),ft=function(){function t(t){this.client=t,this.packetRequester=new dt(this),this.packetManager=new pt(t)}return t.prototype.start=function(){this.packetManager.reset(),this.packetRequester.start()},t.prototype.stop=function(){this.packetRequester.stop(),this.packetManager.reset()},t.prototype.pause=function(){this.paused=!0,this.packetRequester.pause()},t.prototype.getAnimationPacket=function(t,e){if(!this.paused){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},gt.DEBUG_SPARK_LOCAL?r.open("GET","/http/update?fullFrame="+t+"&time="+Date.now(),!0):r.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+Date.now(),!0),r.send(),r}},t.prototype.postUserAction=function(t,e){if(!this.paused){var r=new XMLHttpRequest;gt.DEBUG_SPARK_LOCAL?r.open("GET","/http/useraction?id="+t+"&value="+encodeURIComponent(e)):r.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),r.send()}},t.prototype.postUserCommand=function(t,e){if(!this.paused){var r=new XMLHttpRequest;r.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),r.send()}},t.prototype.getJarResourceURL=function(t){return this.getResourceURLWithSubpath("internal-resources",t)},t.prototype.getResourceURL=function(t){return this.getResourceURLWithSubpath("resources",t)},t.prototype.getResourceURLWithSubpath=function(t,e){if(!this.paused)return gt.DEBUG_SPARK_LOCAL?"/http/image?path="+e:this.getRestRoot()+t+"?path="+e},t.prototype.getRestRoot=function(){return this.client.svgAnimationInfo.host+"/nodes/"+this.client.svgAnimationInfo.restUrl+"sessions/"+this.client.svgAnimationInfo.sessionUuid+"/"},t.prototype.postMaxFPS=function(t){if(!this.paused){var e=new XMLHttpRequest;gt.DEBUG_SPARK_LOCAL?e.open("POST","http/max-fps"):e.open("POST",this.getRestRoot()+"max-fps"),e.send(t.toString())}},t.prototype.requestFullFrame=function(){this.packetRequester.requestFullFrame()},t.prototype.requestAndWaitFullFrame=function(){this.packetRequester.requestFullFrame(),this.packetManager.waitFullFrame()},t.MIN_REQUEST_INTERVAL=500,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_REQUEST_COUNT=2,t}(),mt=function(){function t(e){var r=this;this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDebugContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDebugContainer.parentElement,this.controlPanel=document.getElementById("control-panel"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDebugTools=document.getElementById("control-panel-button-dev-panel"),this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpInfoState=document.getElementById("control-panel-info-state"),t.assignActionOnClick(this.cpButtonRun,function(){return r.client.network.postUserCommand("run","")}),t.assignActionOnClick(this.cpButtonPause,function(){return r.client.network.postUserCommand("pause","")}),t.assignActionOnClick(this.cpButtonX1,function(){return r.setSpeed(1)}),t.assignActionOnClick(this.cpButtonSlower,function(){return r.speedUpOrDown(!1)}),t.assignActionOnClick(this.cpButtonFaster,function(){return r.speedUpOrDown(!0)}),t.assignActionOnClick(this.cpButtonVirtual,function(){return r.setSpeed(1/0)}),this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},t.assignActionOnClick(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),w.addFullScreenListener(function(){return r.onFullScreenChange()}),this.cpButtonDebugTools.style.display="none"}return t.prototype.updateExperimentState=function(){this.updateInfoState(),this.updateModelTimeScale(),this.updateRunGroup(),this.updateSpeedGroup()},t.prototype.updateModelTimeScale=function(){this.cpInfoScale.innerText=t.timeScaleToString(this.client.getModelTimeScale())},t.prototype.updateExperimentProgress=function(){var t=this.client.getModelProgress(),e=this.progressBar.firstElementChild,r=100*t;this.progressBar.style.width=t<=0?"0":r+"%",e.innerText=t<0?"progress n/a":Math.round(r)+"%"},t.prototype.updateInfoState=function(){var e=this.client.getModelState(),r=t.modelStateToString(e);this.cpInfoState.innerText=t.modelStateToString(r),this.indicateCpErrorState("ERROR"==e)},t.prototype.indicateCpErrorState=function(t){t?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getModelState()&&this.indicateCpErrorState(!1)},t.prototype.updateRunGroup=function(){var e=this.client.getModelState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e;t.setVisible(this.cpButtonRun,!r),this.setEnabled(this.cpButtonRun,!r&&i),t.setVisible(this.cpButtonPause,r),this.setEnabled(this.cpButtonPause,r)},t.prototype.updateSpeedGroup=function(){var e=this.client.getModelState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e,i=t.stringToTimeScale(this.cpInfoScale.innerText);this.setEnabled(this.cpButtonX1,r&&1!=i),this.setEnabled(this.cpButtonSlower,r&&i>t.speeds[0]),this.setEnabled(this.cpButtonFaster,r&&i!=1/0),this.setEnabled(this.cpButtonVirtual,r&&i!=1/0)},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=f.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r)},t.prototype.setSpeed=function(e){this.cpInfoScale.innerText=t.timeScaleToString(e),this.client.network.postUserCommand("setspeed",e.toString()),this.updateSpeedGroup()},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=w.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed"))},t.prototype.toggleFullScreen=function(){w.toggleFullScreen(this.presentationContainer)},t.modelStateToString=function(t){switch(t){case"INITIALIZE":return"Initializing...";case"IDLE":return"Idle";case"RUNNING":return"Running";case"PAUSED":return"Paused";case"FINISHED":return"Finished.";case"ERROR":return"Error!";case"PLEASE_WAIT":return"Please Wait..."}return t},t.timeScaleToString=function(t){return t<0||t==1/0?"Virtual":t>=1?"x"+t:"x1/"+1/t},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.setVisible=function(t,e){e?t.style.removeProperty("display"):t.style.display="none"},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.assignActionOnClick=function(e,r){e.onclick=function(){t.isEnabled(e)&&r()}},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t}(),gt=function(){function t(){this.windowAdjusted=!1,this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new ct(this),this.navigation=new rt(this),this.network=new ft(this),this.controlPanel=new mt(this)}return t.prototype.start=function(t){this.svgAnimationInfo=t,this.svg.style.pointerEvents="auto",this.navigation.initSVGNavigation(),this.network.start(),this.frameDrawing.start()},t.prototype.stop=function(t){t?(this.modelState=t.type,this.controlPanel.updateExperimentState()):this.modelState=void 0,this.frameDrawing.stop(),this.navigation.clearSVGNavigation(),this.network.stop(),this.onToggleFullScreen=void 0,this.onResize=void 0,this.onStop=void 0,this.windowAdjusted=!1,W.removeAllChildren(this.presentation)},t.prototype.setCallback=function(t,e){switch(t){case"ontogglefullscreen":this.onToggleFullScreen=e;break;case"onstop":this.onStop=e;break;case"onresize":this.onResize=e}},t.prototype.pause=function(){this.network.pause()},t.prototype.stopAndAlert=function(t,e){this.frameDrawing.stop(),console.log(t),e&&console.log(e)},t.prototype.updateExperimentState=function(t){t.state!=this.modelState&&(this.modelState=t.state,this.controlPanel.updateExperimentState()),t.progress!=this.modelProgress&&(this.modelProgress=t.progress,this.controlPanel.updateExperimentProgress()),t.time!=this.modelTime&&(this.modelTime=t.time),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.controlPanel.updateModelTimeScale())},t.prototype.getModelTime=function(){},t.prototype.getModelState=function(){},t.prototype.getModelTimeScale=function(){},t.prototype.getModelProgress=function(){},t.prototype.setNavigationSettings=function(t,e){var r=this;!this.windowAdjusted&&this.onResize&&(this.onResize(t,e+50,function(){r.navigation.applyNavigationSettings()}),this.windowAdjusted=!0)},t.DEBUG_MODE=!1,t.DEBUG_SPARK_LOCAL=!1,t}(),bt=function(){function t(){}return t.createClient=function(){return new gt},t.createDebugger=function(){return new z(new gt)},t}(),vt=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(e){var r=this;jt.DEBUG_MODE=!0,jt.DEBUG_SPARK_LOCAL=e,this.client.debugger=this,this.serverQueueInfo=document.getElementById("dev-panel-info-server-queue"),this.browserQueueInfo=document.getElementById("dev-panel-info-browser-queue"),this.parseTimeInfo=document.getElementById("dev-panel-info-parse-time"),this.shapeCountInfo=document.getElementById("dev-panel-info-shape-count"),this.cudCountInfo=document.getElementById("dev-panel-info-cud-count"),this.drawTimeInfo=document.getElementById("dev-panel-info-draw-time"),this.fpsInfo=document.getElementById("dev-panel-info-fps"),this.timeInfo=document.getElementById("dev-panel-info-time"),e&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return r.onNewModelSelected()}),t.elementcount=0},t.prototype.stop=function(){this.serverQueueInfo=void 0,this.browserQueueInfo=void 0,this.parseTimeInfo=void 0,this.shapeCountInfo=void 0,this.cudCountInfo=void 0,this.drawTimeInfo=void 0,this.fpsInfo=void 0,this.timeInfo=void 0,this.modelSelector&&(this.modelSelector.onchange=void 0,this.modelSelector=void 0),t.elementcount=0},t.prototype.onNewModelSelected=function(){var e=this;if(null!=this.client.svg&&this.client.stop("TERMINATED"),this.shapeCountInfo.innerHTML=t.elementcount,"NO MODEL SELECTED"!=this.modelSelector.value){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&e.client.start({})},r.open("GET","/http/start?path="+this.modelSelector.value,!0),r.send()}},t}(),yt=function(){function t(){}return t.createSvgElement=function(e){return jt.DEBUG_MODE&&vt.elementcount++,document.createElementNS(t.svgns,e)},t.createXhtmlElement=function(e){return jt.DEBUG_MODE&&vt.elementcount++,document.createElementNS(t.xhtmlns,e)},t.createTextNode=function(t){return jt.DEBUG_MODE&&vt.elementcount++,document.createTextNode(t)},t.createUseElement=function(e){var r=t.createSvgElement("use"),i="#"+e;return r.setAttributeNS(t.xlinkns,"href",i),r},t.cloneElementWithId=function(e){var r=document.getElementById(e);return t.cloneElement(r)},t.cloneElement=function(e){var r=e.cloneNode(!0);return r.removeAttribute("id"),jt.DEBUG_MODE&&(vt.elementcount+=1+t.childNodeDeepCount(r)),r},t.removeElement=function(e,r){var i=document.getElementById("canvas-group");if(i)for(var n=i.children,a=n.length-1;a>=0;a--){var o=parseInt(n[a].id),s=document.getElementById(o.toString());(r==s||r.contains(s))&&i.removeChild(n[a])}jt.DEBUG_MODE&&(vt.elementcount-=1+t.childNodeDeepCount(r)),e.removeChild(r)},t.removeAllChildren=function(e){for(;e.lastChild;)t.removeElement(e,e.lastChild)},t.bringElementToFront=function(t){t.parentNode.appendChild(t)},t.childElements=function(t){var e=t.children;if(!e){for(var r=t.childNodes,i=[],n=0;n<r.length;n++){var a=r[n];1==a.nodeType&&i.push(a)}return i}return e},t.isPrimitiveSVGElement=function(t){return!(t.startsWith("Shape")||t.startsWith("Markup")||t.startsWith("Control")||t.startsWith("Chart")||t.startsWith("Window3D"))},t.isContainedInElementOfType=function(t,e){for(;t&&1==t.nodeType&&e.indexOf(t.getAttribute("type"))<0;)t=t.parentNode;return t&&1==t.nodeType},t.findChildOfType=function(e,r){for(var i=t.childElements(e),n=0;n<i.length;n++)if(i[n].getAttribute("type")==r)return i[n];return console.log("Child of type "+r+" not found in",e),null},t.findParentOfType=function(t,e){for(var r=t.parentNode;;){if(!r||1!=r.nodeType)return null;var i=r;if(i.getAttribute("type")==e)return i;r=i.parentNode}},t.childNodeDeepCount=function(e){var r=e.childNodes;if(!r)return 0;for(var i=r.length,n=0;n<r.length;n++)i+=t.childNodeDeepCount(r[n]);return i},t.createCanvas=function(){var e=t.createXhtmlElement("canvas");return document.getElementById("canvas-group").appendChild(e),e},t.xhtmlns="http://www.w3.org/1999/xhtml",t.xlinkns="http://www.w3.org/1999/xlink",t.svgns="http://www.w3.org/2000/svg",t}(),At=function(){function t(){}return t.offsetPage=function(t){var e=t.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+i,left:e.left+r}},t.indexInParent=function(t){var e;for(e=0;t=t.previousElementSibling;e++);return e},t.radiansToDegrees=function(t){return 360*t/(2*Math.PI)},t.modulo=function(t,e){var r=t%e;return Math.floor(r>=0?r:r+e)},t.remainderPositive=function(t,e){var r=t%e;return r>=0?r:r+e},t.formatNumber=function(t,e){if(t==-1/0)return"-Infinity";if(t==1/0)return"+Infinity";if(isNaN(t))return"NaN";var r=Math.abs(t);return r<1e-12?String(0):r>9999999999||r<.001&&0!=t?String(+t.toExponential(2)):String(+t.toFixed(2))},t.formatPercent=function(t){return+Math.round(100*t)+"%"},t.reducePrecision=function(t){return+t.toPrecision(4)},t.dateComponent=function(t,e){var r,i=t.getFullYear();switch(e){case"YYYY":return String(i);case"MMM":switch(t.getMonth()+1){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return null}case"MM":r=t.getMonth()+1;break;case"DD":r=t.getDate();break;case"HH":r=t.getHours();break;case"mm":r=t.getMinutes();break;case"ss":r=t.getSeconds()}return r<10?"0"+r:String(r)},t.formatDate=function(e,r){switch(r){case"YYYY":return t.dateComponent(e,"YYYY");case"MMMYYYY":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"YYYY");case"DDMMM":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"DD");case"DDMMHH":return t.dateComponent(e,"MM")+"/"+t.dateComponent(e,"DD")+" "+t.dateComponent(e,"HH")+":00";case"HHmm":return t.dateComponent(e,"HH")+":"+t.dateComponent(e,"mm");case"mmss":default:return t.dateComponent(e,"mm")+"'"+t.dateComponent(e,"ss")+"''"}},t.toMilliseconds=function(e,r){switch(e.modelSettings.timeUnit){case"MILLISECOND":return r*t.MILLISECOND;case"SECOND":return r*t.SECOND;case"MINUTE":return r*t.MINUTE;case"HOUR":return r*t.HOUR;case"DAY":return r*t.DAY;case"WEEK":return r*t.WEEK;case"MONTH":return r*t.MONTH;case"YEAR":return r*t.YEAR}},t.toDate=function(e,r){var i=e.modelSettings,n=r-i.startTime;return new Date(i.startDate+t.toMilliseconds(e,n))},t.date=function(e){return t.toDate(e,e.time)},t.setMultipleAttributes=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i].toString())},t.getSubAttribute=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].split(":");if(2==i.length&&i[0]==e)return i[1]}return null},t.getIntAttribute=function(t,e){return parseInt(t.getAttribute(e))},t.getFloatAttribute=function(t,e){return parseFloat(t.getAttribute(e))},t.splitSkipEmpty=function(e,r){return e.split(r).filter(t.isEmpty)},t.isEmpty=function(t){return t.length>0},t.splitToFloats=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseFloat(i[n]);return i},t.splitToInts=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseInt(i[n]);return i},t.hyphenToCameLCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.parseTranslateTransform=function(e){var r=t.translateRegExp2.exec(e);return null!=r?[parseFloat(r[1]),parseFloat(r[2])]:(r=t.translateRegExp1.exec(e),[parseFloat(r[1]),0])},t.increaseTransparency=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=i[4]?i[4]:1;return"rgba("+i[1]+","+i[2]+","+i[3]+","+r*n+")"},t.addPathArrows=function(e,r,i,n,a,o){for(var s=e.getTotalLength(),l=a;l<s;l+=o){var u=e.getPointAtLength(l),c=e.getPointAtLength(l-3),h=t.radiansToDegrees(Math.PI/2-Math.atan2(u.x-c.x,u.y-c.y)),d=yt.createUseElement(r);d.setAttribute("stroke-width",i.toString()),d.setAttribute("transform","translate("+u.x+" "+u.y+") rotate( "+h+")"),n.appendChild(d)}},t.sectorData=function(t,e,r,i,n,a){var o=Math.abs(a)>2*Math.PI?a%(2*Math.PI):a;a==2*Math.PI&&(a-=1e-4);var s=n+a,l=t+r*Math.cos(n),u=e+i*Math.sin(n),c=t+r*Math.cos(s),h=e+i*Math.sin(s);return"M "+t+" "+e+" L "+l+" "+u+" A "+r+" "+i+" 0 "+(Math.abs(o)>Math.PI?"1 ":"0 ")+(o>0?"1 ":"0 ")+c+" "+h+" Z"},t.roundPathCorners=function(t,e,r){function i(t,e,r){var i=e.x-t.x,a=e.y-t.y,o=Math.sqrt(i*i+a*a);return n(t,e,Math.min(1,r/o))}function n(t,e,r){return{x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}}function a(t,e){t.length>2&&(t[t.length-2]=e.x,t[t.length-1]=e.y)}function o(t){return{x:parseFloat(t[t.length-2]),y:parseFloat(t[t.length-1])}}var s=t.split(/[,\s]/).reduce(function(t,e){var r=e.match("([a-zA-Z])(.+)");return r?(t.push(r[1]),t.push(r[2])):t.push(e),t},[]).reduce(function(t,e){return parseFloat(e)==e&&t.length?t[t.length-1].push(e):t.push([e]),t},[]),l=[];if(s.length>1){var u=o(s[0]),c=null;"Z"==s[s.length-1][0]&&s[0].length>2&&(c=["L",u.x,u.y],s[s.length-1]=c),l.push(s[0]);for(var h=1;h<s.length;h++){var d=l[l.length-1],p=s[h],f=p==c?s[1]:s[h+1];if(f&&d&&d.length>2&&"L"==p[0]&&f.length>2&&"L"==f[0]){var m,g,b=o(d),v=o(p),y=o(f);r?(m=n(v,d.origPoint||b,e),g=n(v,f.origPoint||y,e)):(m=i(v,b,e),g=i(v,y,e)),a(p,m),p.origPoint=v,l.push(p);var A=n(m,v,.5),T=n(v,g,.5),C=["C",A.x,A.y,T.x,T.y,g.x,g.y];C.origPoint=v,l.push(C)}else l.push(p)}if(c){var S=o(l[l.length-1]);l.push(["Z"]),a(l[0],S)}}else l=s;return l.reduce(function(t,e){return t+e.join(" ")+" "},"")},t.stringToByteArray=function(t){for(var e=[],r=0,i=0;i<t.length;i++){for(var n=t.charCodeAt(i);n>255;)e[r++]=255&n,n>>=8;e[r++]=n}return e},t.byteArrayToString=function(t){if(t.length<=8192)return String.fromCharCode.apply(null,t);for(var e="",r=0;r<t.length;r+=8192){var i=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,i)}return e},t.translateRegExp1=/^translate\s*\(\s*(-?\d*.?\d*)\s*\)\s*$/i,t.translateRegExp2=/^translate\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)\s*$/i,t.rgbRegExp=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,t.rgbaRegExp=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*.?\d*)\s*\)\s*$/i,t.MILLISECOND=1,t.SECOND=1e3*t.MILLISECOND,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.MONTH=30*t.DAY,t.YEAR=365*t.DAY,t}(),Tt=function(){function t(t){this.frameDrawing=t}return t.createShapeArc=function(){return yt.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createShapeText=function(){return yt.createSvgElement("text")},t.updateShapeText=function(t,e,r){for(var i=0;i<e.length;i++)if("text-content"==e[i]){null==r[i]&&(r[i]="");var n=r[i].split("\n"),a=t.childElementCount;if(1==n.length&&1==a)t.firstChild.firstChild.textContent=n[0];else{for(var o=At.getFloatAttribute(t,"first-line-offset"),s=At.getFloatAttribute(t,"line-height"),l=0;l<n.length;l++){var u=yt.childElements(t),c=n[l];if(c.endsWith("\r")&&(c=c.substring(0,c.length-1)),u[l])u[l].firstChild.textContent=c;else{var h=yt.createSvgElement("tspan");h.setAttribute("x","0"),h.setAttribute("y",(o+l*s).toString());var d=yt.createTextNode(c);h.appendChild(d),t.appendChild(h)}}for(;t.childElementCount>n.length;)yt.removeElement(t,t.lastChild)}}else t.setAttribute(e[i],r[i])},t.createShapeImage=function(){return yt.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":yt.removeAllChildren(t);break;case"add":var n=yt.createSvgElement("image");n.setAttributeNS(yt.xlinkns,"href",this.frameDrawing.client.network.getJarResourceURL(r[i])),n.setAttribute("visibility","hidden"),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var a=parseInt(r[i]),o=t.childNodes,s=0;s<o.length;s++)(n=o[s]).setAttribute("visibility",s==a?"inherit":"hidden");break;case"width":case"height":o=t.childNodes;for(s=0;s<o.length;s++)(n=o[s]).setAttribute(e[i],r[i]);default:t.setAttribute(e[i],r[i])}},t.createShapeCanvas=function(t){var e=yt.createSvgElement("image");return yt.createCanvas().id=t+"canvas",e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),a=n.getContext("2d"),o=0;o<e.length;o++)switch(e[o]){case"global-composite-operation":a.globalCompositeOperation=r[o];break;case"width":case"height":i.setAttribute(e[o],r[o]),n.setAttribute(e[o],r[o]);break;case"fill-rect":case"clear-rect":var s=r[o].split(" "),l=parseFloat(s[0]),u=parseFloat(s[1]),c=parseFloat(s[2]),h=parseFloat(s[3]);if("clear-rect"==e[o])a.clearRect(l,u,c,h);else{var d=s[4];a.fillStyle=d,a.fillRect(l,u,c,h)}break;case"fill-circle":s=r[o].split(" ");var p=parseFloat(s[0]),f=parseFloat(s[1]),m=parseFloat(s[2]),g=s[3];a.fillStyle=g,a.beginPath(),a.arc(p,f,m,0,2*Math.PI),a.fill();break;case"clear":a.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(yt.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;default:t.setAttribute(e[o],r[o])}},t.createUnsupportedObject=function(t){var e=yt.cloneElementWithId("unsupported-object");return yt.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=yt.findChildOfType(t,"background"),n=yt.findChildOfType(t,"text"),a=0;a<e.length;a++)switch(e[a]){case"width":var o=parseFloat(r[a]);i.setAttribute("width",o.toString());var s=n.getBBox();o<s.width&&(n.firstChild.textContent="Not supported",s=n.getBBox()),o<s.width&&(n.firstChild.textContent="N/A",s=n.getBBox()),o<s.width&&(n.firstChild.textContent=""),n.setAttribute("x",(o/2).toString());break;case"height":var l=parseFloat(r[a]);i.setAttribute("height",l.toString()),n.setAttribute("y",(l/2+3).toString());break;default:t.setAttribute(e[a],r[a])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeGISMap"],t}(),Ct=function(){function t(){}return t.create=function(){return Tt.createUnsupportedObject("Vector 3D is under development. To view 3D use Play(video)")},t.update=function(t,e,r){Tt.updateUnsupportedObject(t,e,r)},t}(),St=function(){function t(t,e){this.frameDrawing=t,this.control=e}return t.createControlList=function(e){var r=yt.cloneElementWithId("control-list"),i=function(e){return t.onControlListMouseEvent(e)};r.addEventListener("mouseover",i),r.addEventListener("mouseout",i),r.addEventListener("wheel",i);var n=yt.findChildOfType(r,"svg"),a=yt.findChildOfType(n,"scrollbargroup"),o=function(e){return t.onControlListScrollbarMouseEvent(e)};return a.addEventListener("mouseout",o),a.addEventListener("mousedown",o),a.addEventListener("mouseup",o),a.addEventListener("mousemove",o),a.addEventListener("click",o),e&&t.onGotFocus(r),r.setAttribute("always-focused",e.toString()),r},t.prototype.updateControlList=function(e,r,i){for(var n=yt.findChildOfType(e,"svg"),a=yt.findChildOfType(e,"border"),o=yt.findChildOfType(n,"background"),s=yt.findChildOfType(n,"itemgroup"),l=(yt.findChildOfType(n,"scrollbargroup"),0);l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);for(var u="true"==i[l],c=yt.childElements(s),h=0;h<c.length;h++)t.updateControlListItemLook(c[h],!1,!1);a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"text-array":yt.removeAllChildren(s),s.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var d=At.splitSkipEmpty(i[l],"\n"),p=0,f=0;for(h=0;h<d.length;h++){var m=yt.cloneElementWithId("list-item");yt.findChildOfType(m,"background").setAttribute("fill",o.getAttribute("fill")),(A=yt.findChildOfType(m,"text")).firstChild.textContent=d[h],e.hasAttribute("text-color")&&A.setAttribute("fill",e.getAttribute("text-color")),s.appendChild(m);var g=A.getBBox();p<g.width&&(p=g.width),f<g.height&&(f=g.height)}c=yt.childElements(s);var b=Math.max(p+4,At.getFloatAttribute(n,"width")),v=Math.max(20,1.35*f);e.setAttribute("item-height",v.toString());for(h=0;h<c.length;h++)this.setupControlListItem(c[h],v*h,b,v,f);t.updateControlListScrollbar(e);break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":e.setAttribute(r[l],i[l]);break;case"font-style":e.style.font=i[l];break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[l],i[l]);break;case"value":var y=At.splitSkipEmpty(i[l],"\n");c=yt.childElements(s),e.setAttribute("last-clicked","0");for(h=0;h<c.length;h++){m=c[h];var A=yt.findChildOfType(m,"text"),T=y.indexOf(A.firstChild.textContent)>=0;m.setAttribute("selected",T),t.updateControlListItemLook(m,!1,!1),T&&e.setAttribute("last-clicked",h.toString())}break;default:e.setAttribute(r[l],i[l])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=yt.findChildOfType(t,"svg"),i=yt.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*At.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled"))switch(e.type){case"mouseover":t.onGotFocus(r);break;case"mouseout":if(r.contains(e.relatedTarget))return;t.onLostFocus(r);break;case"wheel":e.altKey||e.ctrlKey||(e.stopPropagation(),e.preventDefault(),t.scrollControlList(r,e.deltaY<0?1:-1))}},t.onGotFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=yt.findChildOfType(e,"border"),i=yt.findChildOfType(e,"svg"),n=yt.findChildOfType(i,"itemgroup"),a=yt.findChildOfType(i,"scrollbargroup"),o=yt.childElements(n);if("control-border-hover"!=r.getAttribute("class")){r.setAttribute("class","control-border-hover"),a.setAttribute("class","control-opaque1");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!0,!1)}}},t.onLostFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=yt.findChildOfType(e,"border"),i=yt.findChildOfType(e,"svg"),n=yt.findChildOfType(i,"itemgroup"),a=yt.findChildOfType(i,"scrollbargroup"),o=yt.childElements(n);r.setAttribute("class","control-border"),a.setAttribute("class","control-opaque0");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!1,!1)}},t.scrollControlList=function(t,e){var r=yt.findChildOfType(t,"svg"),i=yt.findChildOfType(r,"itemgroup"),n=i.childElementCount;if(0!=n){var a=At.getFloatAttribute(r,"height"),o=At.getFloatAttribute(t,"item-height"),s=n*o,l=i.getAttribute("transform"),u=At.parseTranslateTransform(l)[1];u+=e*o,u=Math.max(-s+a,u),u=Math.min(u,0),u=Math.round(u),i.setAttribute("transform","translate(0,"+u+")");var c=yt.findChildOfType(r,"scrollbargroup"),h=yt.findChildOfType(c,"handle"),d=At.getFloatAttribute(h,"height"),p=(a/2-u)/s,f=Math.max(2,a*p-d/2);f=Math.min(a-d-2,f),h.setAttribute("y",f.toString())}},t.prototype.setupControlListItem=function(t,e,r,i,n){var a=this,o=yt.findChildOfType(t,"background"),s=yt.findChildOfType(t,"text");t.setAttribute("transform","translate(0,"+e+")"),At.setMultipleAttributes(o,["width","height"],[r,i]),At.setMultipleAttributes(s,["x","y"],[2,i/2+.3*n]);var l=function(t){return a.onControlListItemMouseEvent(t)};t.addEventListener("mouseover",l),t.addEventListener("mouseout",l),t.addEventListener("click",l)},t.prototype.onControlListItemMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))switch(e.type){case"mouseover":t.updateControlListItemLook(r,!0,!0);break;case"mouseout":t.updateControlListItemLook(r,!0,!1);break;case"click":e.stopPropagation(),e.preventDefault();var a="true"==n.getAttribute("multiple"),o=yt.childElements(i),s=At.indexInParent(r),l="true"==r.getAttribute("selected");if(a)if(e.ctrlKey)r.setAttribute("selected",String(!l)),t.updateControlListItemLook(r,!0,!0);else if(e.shiftKey){var u=At.getIntAttribute(n,"last-clicked");for(c=0;c<o.length;c++)l=u<=s?u<=c&&c<=s:s<=c&&c<=u,o[c].setAttribute("selected",l),t.updateControlListItemLook(o[c],!0,c==s)}else for(c=0;c<o.length;c++)o[c].setAttribute("selected",c==s),t.updateControlListItemLook(o[c],!0,c==s);else{l=!e.ctrlKey||!l;for(var c=0;c<o.length;c++)o[c].setAttribute("selected",c==s&&l),t.updateControlListItemLook(o[c],!0,c==s)}n.setAttribute("last-clicked",s.toString());var h="";for(c=0;c<o.length;c++){if("true"==o[c].getAttribute("selected"))h+=yt.findChildOfType(o[c],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,h)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=yt.findChildOfType(t,"background"),a=yt.findChildOfType(t,"text"),o="true"==i.getAttribute("enabled"),s="true"==t.getAttribute("selected");if(!o)return n.setAttribute("class",s?"control-background-selected-disabled":""),void a.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",s?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",s?"control-list-background-selected-hover":""),a.setAttribute("class",s?"control-text-selected-hover":"")):(n.setAttribute("class",s?"control-list-background-selected":""),a.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=yt.findChildOfType(e,"svg"),i=yt.findChildOfType(r,"scrollbargroup"),n=yt.findChildOfType(i,"scrollbar"),a=yt.findChildOfType(i,"handle"),o=At.getFloatAttribute(r,"width"),s=At.getFloatAttribute(r,"height"),l=o-At.getFloatAttribute(n,"width");n.setAttribute("x",l.toString()),n.setAttribute("height",s.toString()),a.setAttribute("x",(l+2).toString()),a.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=yt.findChildOfType(t,"svg"),i=yt.findChildOfType(r,"scrollbargroup"),n=(yt.findChildOfType(i,"scrollbar"),yt.findChildOfType(i,"handle")),a=At.getFloatAttribute(r,"height"),o=yt.findChildOfType(r,"itemgroup").childElementCount,s=0;e=o>0&&a<(s=o*At.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e&&n.setAttribute("height",Math.max(a*(a/s)-4,7).toString())},t.onControlListScrollbarMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode.parentNode;if("false"!=i.getAttribute("enabled")){var n=yt.findChildOfType(r,"scrollbar"),a=At.getFloatAttribute(n,"height"),o=n.getBoundingClientRect().height/a,s=At.offsetPage(n),l=(e.pageY-s.top)/o,u=yt.findChildOfType(r,"handle"),c=At.getFloatAttribute(u,"y");switch(e.type){case"mouseout":case"mouseup":t.controlListScrollbarButtonDown=0;break;case"mousedown":1==e.which&&e.target==u&&(e.stopPropagation(),t.controlListScrollbarButtonDown=1,t.controlListScrollbarMousePos=l);break;case"mousemove":if(1==t.controlListScrollbarButtonDown){e.stopPropagation();var h=l-t.controlListScrollbarMousePos,d=yt.findChildOfType(i,"svg"),p=yt.findChildOfType(d,"itemgroup").childElementCount,f=At.getFloatAttribute(i,"item-height"),m=h*(p*f/a)/f;t.scrollControlList(i,-m),t.controlListScrollbarMousePos=l}break;case"click":if(e.stopPropagation(),e.preventDefault(),e.target==n){m=Math.floor(a/At.getFloatAttribute(i,"item-height"));t.scrollControlList(i,l<c?m:-m)}}}},t.controlListScrollbarButtonDown=0,t}(),Et=function(){function t(t){this.frameDrawing=t,this.controlList=new St(t,this)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return Tt.createUnsupportedObject("File chooser is not supported in the Cloud mode");case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":t.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":Tt.updateUnsupportedObject(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=yt.cloneElementWithId("control-button");return new m(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=yt.findChildOfType(e,"background"),a=yt.findChildOfType(e,"text"),o=0;o<r.length;o++)switch(r[o]){case"enabled":e.setAttribute(r[o],i[o]);var s="true"==i[o];n.setAttribute("class",s?"control-background":"control-background-disabled"),a.setAttribute("class",s?"control-button-text":"control-text-disabled");break;case"text":a.firstChild.textContent=i[o];break;case"background-color":break;case"text-color":a.setAttribute("fill",i[o]);break;case"font-style":a.style.font=i[o],t.centerControlText(a,n,!0,!0);break;case"width":case"height":var l=parseFloat(i[o])-2;n.setAttribute(r[o],l.toString()),t.centerControlText(a,n,!0,!0);break;default:e.setAttribute(r[o],i[o])}},t.onButtonOver=function(t){var e=yt.findChildOfType(t,"background"),r=yt.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=yt.findChildOfType(t,"background"),r=yt.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=yt.findChildOfType(t,"background"),r=yt.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.onControlAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=yt.cloneElementWithId("control-checkbox");return new m(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=yt.findChildOfType(e,"background"),a=yt.findChildOfType(e,"box"),o=yt.findChildOfType(e,"check"),s=yt.findChildOfType(e,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-checkbox-box":"control-checkbox-box-disabled"),o.setAttribute("class",u?"control-checkbox-check":"control-checkbox-check-disabled"),s.setAttribute("class",u?"":"control-text-disabled");break;case"text":s.firstChild.textContent=i[l];break;case"background-color":n.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":s.style.font=i[l],t.centerControlText(s,n,!1,!0);break;case"width":n.setAttribute(r[l],i[l]);break;case"height":n.setAttribute(r[l],i[l]);var c=parseFloat(i[l]);a.setAttribute("y",(c/2-8).toString()),o.setAttribute("transform","translate(0,"+(c/2-8)+")"),t.centerControlText(s,n,!1,!0);break;case"value":o.setAttribute("visibility","true"==i[l]?"inherit":"hidden");break;default:e.setAttribute(r[l],i[l])}},t.onCheckboxOver=function(t){var e=yt.findChildOfType(t,"box"),r=yt.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=yt.findChildOfType(t,"box"),r=yt.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=yt.findChildOfType(t,"box"),r=yt.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=yt.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.onControlAction(t.id,r)},t.prototype.createSlider=function(){var t=this,e=yt.cloneElementWithId("control-slider"),r=function(e){return t.onSliderEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r),e},t.updateSlider=function(e,r,i){for(var n=yt.findChildOfType(e,"sensor"),a=yt.findChildOfType(e,"background"),o=yt.findChildOfType(e,"line"),s=yt.findChildOfType(e,"progress"),l=yt.findChildOfType(e,"handle"),u=(yt.findChildOfType(e,"value"),0);u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];o.setAttribute("class",c?"control-background":"control-background-disabled"),s.setAttribute("class",c?"control-slider-progress":"control-background-selected-disabled"),l.setAttribute("class",c?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":a.setAttribute("fill",i[u]);break;case"width":case"height":a.setAttribute(r[u],i[u]);break;case"vertical":e.setAttribute(r[u],i[u]);var h=At.getFloatAttribute(a,"width"),d=At.getFloatAttribute(a,"height");At.setMultipleAttributes(n,["x","y","width","height"],[String(-1e3),String(-1e3),String(h+2e3),String(d+2e3)]);var p=void 0,f=void 0,m=void 0,g=void 0,b=void 0,v=void 0,y=void 0,A=void 0,T=void 0,C=void 0;"false"==i[u]?(b=p=0,v=f=d/2-2,m=h,y=0,A=g=4,T=0,C=d/2):(b=p=h/2-2,f=0,v=d,y=m=4,g=d,A=0,T=h/2,C=d),At.setMultipleAttributes(o,["x","y","width","height"],[p,f,m,g]),At.setMultipleAttributes(s,["x","y","width","height"],[b,v,y,A]),At.setMultipleAttributes(l,["cx","cy"],[T,C]);break;case"value":var S=At.getFloatAttribute(e,"min"),E=At.getFloatAttribute(e,"max");h=At.getFloatAttribute(a,"width"),d=At.getFloatAttribute(a,"height");var w="true"==e.getAttribute("vertical")?d:h,k=(parseFloat(i[u])-S)/(E-S)*w;t.setSliderHandlePosition(e,k);break;default:e.setAttribute(r[u],i[u])}},t.prototype.onSliderEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=yt.findChildOfType(r,"background"),n=yt.findChildOfType(r,"progress"),a=At.getFloatAttribute(i,"width"),o=At.getFloatAttribute(i,"height"),s=i.getBoundingClientRect(),l=s.width/a,u=s.height/o,c=At.offsetPage(i),h="true"==r.getAttribute("vertical");if(e.type.startsWith("mouse")||"wheel"==e.type){var d=e,p=(d.pageX-c.left)/l,f=(d.pageY-c.top)/u,m=h?o-f:p;switch(e.type){case"mouseover":e.stopPropagation(),t.onSliderOver(r);break;case"mouseout":if(r.contains(d.relatedTarget))return;1==t.sliderButtonDown&&(t.setSliderHandlePosition(r,m),this.confirmSliderValue(r)),t.sliderButtonDown=0,t.onSliderOut(r);break;case"mousedown":t.sliderButtonDown=d.which,1==t.sliderButtonDown&&(e.stopPropagation(),t.onSliderHandleGrabbed(r,m));break;case"mousemove":1==t.sliderButtonDown&&(e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m));break;case"mouseup":1==t.sliderButtonDown&&(e.stopPropagation(),this.onSliderHandleReleased(r)),t.sliderButtonDown=0;break;case"wheel":if(!d.altKey&&!d.ctrlKey){var g=e;e.stopPropagation(),e.preventDefault();var b=At.getFloatAttribute(n,h?"height":"width");t.setSliderHandlePosition(r,b+(g.deltaY<0?1:-1)),this.confirmSliderValue(r)}}}else if(e.type.startsWith("touch")){var v=e;if(v.touches.length>1)return void this.onSliderHandleReleased(r);var y="touchend"==e.type?v.changedTouches[0]:v.touches[0];p=void 0,f=void 0;p=(y.pageX-c.left)/l,f=(y.pageY-c.top)/u;m=h?o-f:p;switch(e.type){case"touchstart":e.stopPropagation(),t.onSliderOver(r),t.onSliderHandleGrabbed(r,m);break;case"touchmove":e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m);break;case"touchend":e.stopPropagation(),this.onSliderHandleReleased(r),t.onSliderOut(r)}}}},t.onSliderOver=function(e){var r=yt.findChildOfType(e,"line"),i=yt.findChildOfType(e,"progress"),n=yt.findChildOfType(e,"handle"),a=yt.findChildOfType(e,"value");r.setAttribute("class","control-slider-line-hover"),i.setAttribute("class","control-fill-color-transition"),n.setAttribute("class",1==t.sliderButtonDown?"control-slider-handle-pressed":"control-slider-handle-hover"),a.setAttribute("class","control-opaque1")},t.onSliderOut=function(t){var e=yt.findChildOfType(t,"sensor"),r=yt.findChildOfType(t,"line"),i=yt.findChildOfType(t,"progress"),n=yt.findChildOfType(t,"handle"),a=yt.findChildOfType(t,"value");e.setAttribute("visibility","hidden"),r.setAttribute("class","control-background"),i.setAttribute("class","control-slider-progress"),n.setAttribute("r","8"),n.setAttribute("class","control-slider-handle"),a.setAttribute("class","control-opaque0")},t.onSliderHandleGrabbed=function(e,r){var i=yt.findChildOfType(e,"sensor"),n=yt.findChildOfType(e,"handle");yt.bringElementToFront(e),n.setAttribute("r","7"),n.setAttribute("class","control-slider-handle-pressed"),i.setAttribute("visibility","inherit"),t.setSliderHandlePosition(e,r)},t.prototype.onSliderHandleReleased=function(t){var e=yt.findChildOfType(t,"sensor"),r=yt.findChildOfType(t,"handle");r.setAttribute("r","8"),r.setAttribute("class","control-slider-handle-hover"),e.setAttribute("visibility","hidden"),this.confirmSliderValue(t)},t.setSliderHandlePosition=function(t,e){var r=yt.findChildOfType(t,"background"),i=yt.findChildOfType(t,"progress"),n=yt.findChildOfType(t,"handle"),a=yt.findChildOfType(t,"value"),o=At.getFloatAttribute(r,"width"),s=At.getFloatAttribute(r,"height"),l="true"==t.getAttribute("vertical"),u=l?s:o;e=Math.min(u,Math.max(e,0));var c,h=At.getFloatAttribute(t,"min"),d=At.getFloatAttribute(t,"max"),p=At.getFloatAttribute(t,"step");c=p>0?h+Math.round(e/u*(d-h)/p)*p:h+e/u*(d-h),e=((c=Math.min(c,d))-h)/(d-h)*u,l?(i.setAttribute("y",(u-e).toString()),i.setAttribute("height",e.toString()),n.setAttribute("cy",(u-e).toString())):(i.setAttribute("width",e.toString()),n.setAttribute("cx",e.toString()));var f=a.firstElementChild,m=a.lastElementChild;m.firstChild.textContent=At.formatNumber(c,void 0);var g=m.getComputedTextLength()+10;f.setAttribute("width",g.toString()),f.setAttribute("x",(5-g).toString());var b=l?o/2-9:e-14,v=l?s-e-15-10:s/2-15-4;a.setAttribute("transform","translate("+b+","+v+")"),t.setAttribute("current-value",c)},t.prototype.confirmSliderValue=function(t){var e=At.getFloatAttribute(t,"current-value");e!=At.getFloatAttribute(t,"last-value")&&(this.frameDrawing.onControlAction(t.id,e),t.setAttribute("last-value",e.toString()))},t.createRadioButtonGroup=function(){return yt.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"enabled":e.setAttribute(r[a],i[a]);for(var o="true"==i[a],s=yt.childElements(e),l=0;l<s.length;l++){var u=s[l],c=yt.findChildOfType(u,"circle"),h=yt.findChildOfType(u,"check"),d=yt.findChildOfType(u,"text");c.setAttribute("class",o?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),h.setAttribute("class",o?"control-radiobutton-check":"control-text-disabled"),d.setAttribute("class",o?"":"control-text-disabled")}break;case"text-array":var p=i[a].split("\n"),f=function(r){var i=yt.cloneElementWithId("radio-button"),a=yt.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var o=yt.findChildOfType(i,"text");o.firstChild.textContent=p[r],e.hasAttribute("text-color")&&o.setAttribute("fill",e.getAttribute("text-color")),new m(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(l=0;l<p.length;l++)f(l);break;case"background-color":case"text-color":e.setAttribute(r[a],i[a]);break;case"font-style":e.style.font=i[a];break;case"width":case"height":e.setAttribute(r[a],i[a]);break;case"vertical":var g=At.getFloatAttribute(e,"width"),b=At.getFloatAttribute(e,"height"),v=0;s=yt.childElements(e);for(l=0;l<s.length;l++){u=s[l];var y=yt.findChildOfType(u,"background"),A=(d=yt.findChildOfType(u,"text")).getBBox();if("true"==i[a]){var T=Math.max(25,1.5*A.height);u.setAttribute("transform","translate(0,"+T*l+")"),At.setMultipleAttributes(y,["width","height"],[g,T])}else{var C=20+A.width+10;u.setAttribute("transform","translate("+v+",0)"),At.setMultipleAttributes(y,["width","height"],[C,b]),v+=C}t.centerRadioButton(u)}break;case"value":var S=parseInt(i[a]);s=yt.childElements(e);for(l=0;l<s.length;l++){u=s[l];(h=yt.findChildOfType(u,"check")).setAttribute("visibility",S==l?"inherit":"hidden")}break;default:e.setAttribute(r[a],i[a])}},t.onRadioButtonOver=function(t){var e=yt.findChildOfType(t,"circle"),r=yt.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=yt.findChildOfType(t,"circle"),r=yt.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=yt.findChildOfType(t,"circle"),r=yt.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=yt.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=yt.childElements(r),n=0;n<i.length;n++){var a=i[n];yt.findChildOfType(a,"check").setAttribute("visibility",a==t?"inherit":"hidden"),a==t&&(e=n)}this.frameDrawing.onControlAction(r.id,e)}},t.centerRadioButton=function(e){var r=yt.findChildOfType(e,"background"),i=yt.findChildOfType(e,"circle"),n=yt.findChildOfType(e,"check"),a=yt.findChildOfType(e,"text"),o=At.getFloatAttribute(r,"height");i.setAttribute("cy",(o/2).toString()),n.setAttribute("cy",(o/2).toString()),t.centerControlText(a,r,!1,!0)},t.createListBox=function(){return St.createControlList(!1)},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var t=this,e=yt.cloneElementWithId("control-combobox"),r=function(e){return t.onComboBoxEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("click",r);var i=St.createControlList(!0);return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),e.appendChild(i),e},t.prototype.updateComboBox=function(e,r,i){for(var n=yt.findChildOfType(e,"svg"),a=yt.findChildOfType(e,"border"),o=yt.findChildOfType(e,"dropdown"),s=yt.findChildOfType(n,"background"),l=yt.findChildOfType(n,"text"),u=yt.findChildOfType(n,"arrowback"),c=yt.findChildOfType(n,"arrow"),h=0;h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var d="true"==i[h];l.setAttribute("class",d?"":"control-text-disabled"),a.setAttribute("class",d?"control-border":"control-border-disabled"),d||o.setAttribute("visibility","hidden"),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-array":var p=At.splitSkipEmpty(i[h],"\n"),f=p.length>0?p[0]:"";l.firstChild.textContent=f,this.controlList.updateControlList(o,[r[h]],[i[h]]),this.controlList.adjustControlListHeightToItems(o,5),this.controlList.updateControlList(o,["value"],[f]);break;case"background-color":s.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-color":l.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"font-style":e.style.font=i[h],t.centerControlText(l,s,!1,!0),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"width":case"height":var m=parseFloat(i[h]);if(n.setAttribute(r[h],i[h]),s.setAttribute(r[h],i[h]),a.setAttribute(r[h],i[h]),"width"==r[h])u.setAttribute("x",(m-20).toString()),this.controlList.updateControlList(o,[r[h]],[i[h]]);else{t.centerControlText(l,s,!1,!0),u.setAttribute("height",m.toString()),o.setAttribute("transform","translate(0,"+i[h]+")");var g=5*parseFloat(i[h]);this.controlList.updateControlList(o,["height"],[g.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var b=At.getFloatAttribute(n,"width")-10,v=At.getFloatAttribute(n,"height")/2;c.setAttribute("transform","translate("+b+","+v+")")}break;case"editable":e.setAttribute(r[h],i[h]);break;case"value":l.firstChild.textContent=i[h],this.controlList.updateControlList(o,[r[h]],[i[h]]);break;default:e.setAttribute(r[h],i[h])}},t.prototype.onComboBoxEvent=function(t){var e=t.currentTarget;if("false"!=e.getAttribute("enabled")){var r=yt.findChildOfType(e,"svg"),i=yt.findChildOfType(e,"border"),n=yt.findChildOfType(e,"dropdown"),a=yt.findChildOfType(r,"background"),o=yt.findChildOfType(r,"text"),s=yt.findChildOfType(r,"arrowback"),l=yt.findChildOfType(r,"arrow"),u="true"==e.getAttribute("editable");switch(t.type){case"mouseover":i.setAttribute("class","control-border-hover"),s.setAttribute("class","control-combobox-arrow-background-hover"),l.setAttribute("class","control-fill-color-transition");break;case"mouseout":if(e.contains(t.relatedTarget))return;i.setAttribute("class","control-border"),s.setAttribute("class","control-fill-transparent-transition"),l.setAttribute("class","control-fill-transparent-transition"),n.setAttribute("visibility","hidden");break;case"mousedown":1!=t.which||!u||t.target!=a&&t.target!=o||(t.stopPropagation(),this.displayTextInputForSVG(e,"left"));break;case"click":if(!u||t.target==s||t.target==l){t.stopPropagation(),t.preventDefault(),yt.bringElementToFront(e);var c="inherit"==n.getAttribute("visibility");n.setAttribute("visibility",c?"hidden":"inherit")}}}},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=yt.findChildOfType(t,"svg"),i=yt.findChildOfType(t,"dropdown"),n=yt.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var a=e.split("\n")[0];n.firstChild.textContent=a,this.frameDrawing.onControlAction(t.id,a)},t.prototype.createTextField=function(){var e=this,r=yt.cloneElementWithId("control-textfield");return new m(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r)},function(t){return e.onTextFieldDown(r)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=yt.findChildOfType(e,"svg"),a=yt.findChildOfType(e,"border"),o=yt.findChildOfType(n,"background"),s=yt.findChildOfType(n,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];s.setAttribute("class",u?"":"control-text-disabled"),a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":e.style.font=i[l],t.centerControlText(s,o,!1,!0);break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),"width"==r[l]&&s.setAttribute("x",(parseFloat(i[l])-2).toString()),t.centerControlText(s,o,!1,!0);break;case"value":s.firstChild.textContent=i[l];break;default:e.setAttribute(r[l],i[l])}},t.onTextFieldOver=function(t){yt.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){yt.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t){this.displayTextInputForSVG(t,"right")},t.createProgressBar=function(){return yt.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,a=yt.findChildOfType(n,"background"),o=yt.findChildOfType(n,"progress"),s=yt.findChildOfType(n,"text"),l=yt.findChildOfType(n,"border"),u=0;u<r.length;u++)switch(r[u]){case"background-color":a.setAttribute("fill",i[u]);break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":e.style.font=i[u],t.centerControlText(s,a,!1,!0);break;case"width":case"height":e.setAttribute(r[u],i[u]);break;case"vertical":var c="true"==i[u],h=e.getAttribute(c?"height":"width"),d=e.getAttribute(c?"width":"height");a.setAttribute("width",h),a.setAttribute("height",d),o.setAttribute("height",d),t.centerControlText(s,a,!0,!0),l.setAttribute("width",h),l.setAttribute("height",d),c&&n.setAttribute("transform","translate(0,"+h+") rotate(-90)");break;case"text":s.firstChild.textContent="null"==i[u]?"":i[u];break;case"value":var p=At.getFloatAttribute(a,"width");"null"==i[u]?(o.setAttribute("class","control-progressbar-indeterminate"),o.setAttribute("width",p.toString())):(o.setAttribute("class","control-slider-progress"),o.setAttribute("width",(parseFloat(i[u])*p).toString()));break;default:e.setAttribute(r[u],i[u])}},t.prototype.displayTextInputForSVG=function(t,e){var r=this,i=yt.findChildOfType(t,"svg"),n=yt.findChildOfType(i,"text"),a=document.getElementById("text-input-for-svg-container");a.style.display="block";var o=i.getBoundingClientRect(),s=At.getFloatAttribute(i,"width"),l=At.getFloatAttribute(i,"height"),u=o.width/s,c=a.firstElementChild;c.style.left=o.left+"px",c.style.top=o.top+"px",c.style.width=s+"px",c.style.height=l+"px",c.style.transform="scale("+u+")",c.style.font=t.style.font,c.style.textAlign=e,c.value=n.firstChild.textContent,a.setAttribute("control-id",t.id);var h=function(t){return r.onTextInputForSVGEvent(t)};a.onmousedown=h,a.onwheel=h,a.onkeypress=h,a.ontouchstart=h,window.setTimeout(function(){c.focus(),c.select()},0)},t.prototype.onTextInputForSVGEvent=function(t){var e=t.currentTarget,r=e.firstElementChild,i=e.getAttribute("control-id"),n=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=r&&(n=!0);break;case"wheel":n=!0;break;case"keypress":"Enter"==t.code&&(n=!0)}n&&(e.style.display="none",this.onTextInputForSVGChanged(i,r.value))},t.prototype.onTextInputForSVGChanged=function(t,e){var r=document.getElementById(t),i=yt.findChildOfType(r,"svg");if(yt.findChildOfType(i,"text").firstChild.textContent=e,this.frameDrawing.onControlAction(t,e),"ControlComboBox"==r.getAttribute("type")){var n=yt.findChildOfType(r,"dropdown");this.controlList.updateControlList(n,["value"],[e])}},t.centerControlText=function(t,e,r,i){var n=At.getFloatAttribute(e,"width"),a=At.getFloatAttribute(e,"height"),o=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*o.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.onControlAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t.sliderButtonDown=0,t}(),wt=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){for(var e=yt.findChildOfType(t,"picture"),r=yt.findChildOfType(t,"pictureback"),i=yt.childElements(yt.findChildOfType(t,"legend")),n=i.length,a="true"==t.getAttribute("show-pdf"),o="true"==t.getAttribute("show-cdf"),s="true"==t.getAttribute("show-mean"),l=(At.getFloatAttribute(r,"x"),At.getFloatAttribute(r,"y")),u=(At.getFloatAttribute(r,"width"),At.getFloatAttribute(r,"height")),c=0;c<n;c++){var h=yt.createSvgElement("g");if(a){var d=yt.createSvgElement("g");h.appendChild(d)}if(o){var p=yt.createSvgElement("polyline");At.setMultipleAttributes(p,["fill","stroke-width","stroke"],["none",i[c].getAttribute("cdf-line-width"),i[c].getAttribute("cdf-color")]),h.appendChild(p)}if(s){var f=yt.createSvgElement("line");At.setMultipleAttributes(f,["stroke-width","stroke","y1","y2"],[i[c].getAttribute("cdf-line-width"),i[c].getAttribute("mean-color"),l.toString(),(l+u).toString()]),h.appendChild(f)}e.appendChild(h),_t.addClickTapHandlerToChartItem(h)}},t.prototype.draw=function(t,e){for(var r=yt.findChildOfType(t,"pictureback"),i=yt.findChildOfType(t,"picture"),n=yt.findChildOfType(t,"grid"),a=yt.childElements(yt.findChildOfType(t,"legend")),o="true"==t.getAttribute("show-pdf"),s="true"==t.getAttribute("show-cdf"),l="true"==t.getAttribute("show-mean"),u=At.getFloatAttribute(t,"bar-width"),c=At.getFloatAttribute(r,"x"),h=At.getFloatAttribute(r,"y"),d=At.getFloatAttribute(r,"width"),p=At.getFloatAttribute(r,"height"),f=At.splitSkipEmpty(e," "),m=f.length,g=1/0,b=-1/0,v=1/0,y=-1/0,A=[],T=[],C=[],S=[],E=[],w=[],k=[],x=[],M=[],O=0;O<m;O++)if("empty"!=f[O]){f[O]=At.splitSkipEmpty(f[O],":"),A[O]="true"==f[O][0],T[O]="true"==f[O][1],C[O]=parseFloat(f[O][2]),S[O]=parseFloat(f[O][3]),E[O]=parseFloat(f[O][4]),w[O]=parseInt(f[O][5]),k[O]=parseInt(f[O][6]),x[O]=At.splitToFloats(f[O][7],"|");for(var I=0;I<x[O].length;I++)x[O][I]<v&&(v=x[O][I]),y<x[O][I]&&(y=x[O][I]);A[O]&&(M[O]=At.splitToFloats(f[O][8],"|")),C[O]<g&&(g=C[O]),b<S[O]&&(b=S[O])}g==1/0&&(g=0,b=0),v==1/0&&(v=0,y=1),this.chartScaleAndGrid.recalcChartScale(t,g,b,!1,!1),this.chartScaleAndGrid.recalcChartScale(t,0,y,!0,!1);var _=At.getFloatAttribute(n,"min-x"),L=At.getFloatAttribute(n,"max-x"),P=At.getFloatAttribute(n,"min-y"),R=At.getFloatAttribute(n,"max-y"),F=d/(L-_),D=p/(R-P),N=yt.childElements(i);for(O=0;O<m;O++)if("empty"!=f[O]){"hidden"==N[O].getAttribute("visibility")&&N[O].setAttribute("visibility","inherit");var B=x[O].length,G=(S[O]-C[O])/B,U=a[O].getAttribute("original-color"),H=void 0,z=void 0;if(T[O]&&(H=a[O].getAttribute("low-color"),z=a[O].getAttribute("high-color")),o){var W=N[O].firstElementChild,V=u*G*F,Y=G*(1-u)/2;for(I=0;I<B;I++){var j=c+(C[O]+I*G+Y-_)*F,X=h+(R-x[O][I])*D,q=x[O][I]*D,Z=yt.childElements(W)[I];Z?Z.setAttribute("visibility","inherit"):(Z=yt.createSvgElement("rect"),W.appendChild(Z)),At.setMultipleAttributes(Z,["x","y","width","height"],[At.reducePrecision(j),At.reducePrecision(X),At.reducePrecision(V),At.reducePrecision(q)]),A[O]&&T[O]&&I<w[O]?Z.setAttribute("fill",H):A[O]&&T[O]&&k[O]<I?Z.setAttribute("fill",z):Z.setAttribute("fill",U)}var K=yt.childElements(W);for(I=B;I<K.length;I++)K[I].setAttribute("visibility","hidden")}if(s){var Q=o?N[O].firstElementChild.nextElementSibling:N[O].firstElementChild,J="";if(J+=c+(C[O]-_)*F+" "+(h+p)+" ",A[O])for(I=0;I<B;I++){J+=At.reducePrecision(c+(C[O]+(I+1)*G-_)*F)+","+At.reducePrecision(h+(1-M[O][I])*p)+" "}Q.setAttribute("points",J)}if(l){var $=N[O].lastElementChild,tt=c+(E[O]-_)*F;$.setAttribute("x1",tt),$.setAttribute("x2",tt)}if("NONE"!=t.getAttribute("leg-pos")){var et=yt.findChildOfType(a[O],"value");et.firstChild.textContent=At.formatNumber(E[O],void 0),et.setAttribute("fill",a[O].getAttribute("mean-color"))}}else N[O].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&_t.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=yt.findChildOfType(t,"picture"),a=yt.childElements(n),o=yt.childElements(a[e]),s=0;s<o.length;s++)o[s].setAttribute("visibility",r?"hidden":"inherit")},t}(),kt=function(){function t(t){this.frameDrawing=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),a=yt.findChildOfType(t,"grid"),o=yt.findChildOfType(t,"pictureback"),s=yt.findChildOfType(t,e?"pictureborderh":"pictureborderw"),l=a.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=l){var u=At.getFloatAttribute(o,"x"),c=At.getFloatAttribute(o,"y"),h=At.getFloatAttribute(o,"width"),d=At.getFloatAttribute(o,"height"),p="GRID_DEFAULT"==l,f="ChartBar"==r||"ChartStack"==r,m=t.getAttribute("bar-dir");e?f&&(!f||"NORTH"!=m&&"SOUTH"!=m)||At.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c,u,c+d]:[u+h,c,u+h,c+d]):f&&(!f||"EAST"!=m&&"WEST"!=m)||At.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c+d,u+h,c+d]:[u,c,u+h,c])}var g=a.getAttribute("grid-line-color");switch(a.setAttribute("grid-line-color",At.increaseTransparency(g,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var b=At.getFloatAttribute(t,"scale-min-"+i),v=At.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(b="ChartStack"==r?0:Math.min(0,b),v=Math.max(0,v)),this.recalcChartScale(t,b,v,e,!0);break;case"SCALE_TIME_WINDOW":v=Math.max(0,At.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,v,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var a=yt.findChildOfType(t,"grid"),o=i?"min-y":"min-x",s=i?"max-y":"max-x";if(e!=At.getFloatAttribute(a,o)||r!=At.getFloatAttribute(a,s)){var l=e,u=r;if(l==u){if(n)return;l-=1,u+=1}var c=yt.findChildOfType(t,"pictureback"),h=At.getFloatAttribute(c,i?"height":"width"),d=i?25:45,p=(u-l)/Math.floor(h/d),f=Math.pow(10,Math.ceil(Math.log(u-l)/Math.log(10))-1),m=f/5;m<p&&(m=f/2)<p&&(m=f)<p&&(m=2*f)<p&&(m=5*f),n?(l=Math.ceil(l/m)*m,u=Math.floor(u/m)*m):(l=Math.floor(l/m)*m,u=Math.ceil(u/m)*m);var g=n?e:l,b=n?r:u;At.setMultipleAttributes(a,[o,s],[g,b]),this.drawChartGrid(t,l,u,m,g,b,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,a,o){var s=t.getAttribute("type"),l=yt.findChildOfType(t,"grid"),u=l.getAttribute(o?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=u){var c=o?l.lastElementChild:l.firstElementChild,h=yt.findChildOfType(t,"pictureback"),d=l.getAttribute("grid-text-color"),p=l.getAttribute("grid-line-color"),f=o?"scale-type-y":"scale-type-x",m="SCALE_100_PERCENT"==t.getAttribute(f),g="SCALE_TIME_WINDOW"==t.getAttribute(f)?t.getAttribute("date-format-pattern"):"null",b=Math.round((r-e)/i)+1,v="GRID_DEFAULT"==u,y=!0;if("ChartBar"==s||"ChartStack"==s){var A=t.getAttribute("bar-dir");"SOUTH"!=A&&"WEST"!=A||(y=!1)}for(var T=At.getFloatAttribute(h,"x"),C=At.getFloatAttribute(h,"y"),S=At.getFloatAttribute(h,"width"),E=At.getFloatAttribute(h,"height"),w=a-n,k=(o?E:S)/w,x=i*k;c.childElementCount<b;){var M=yt.cloneElementWithId("grid-item");c.appendChild(M)}for(var O=yt.childElements(c),I=e,_=o?y?C+(a-e)*k:C+(e-n)*k:y?T+(e-n)*k:T+(a-e)*k,L=0;L<b;L++){var P=o?v?T-4:T:_,R=o?_:v?C+E+4:C+E,F=o?v?T+S:T+S+4:_,D=o?_:v?C:C-4,N=o?v?P-3:F+3:P,B=o?R+3:v?R+11:D-3,G=o?v?"end":"start":"middle";(M=O[L]).setAttribute("visibility","inherit");var U=M.lastElementChild;At.setMultipleAttributes(U,["x1","x2","y1","y2","stroke"],[P,F,R,D,p]);var H=M.firstElementChild;At.setMultipleAttributes(H,["x","y","text-anchor","fill"],[N,B,G,d]);var z=void 0;z=m?At.formatPercent(I):"null"!=g?this.gridFormattedDate(I,w,g):At.formatNumber(I,void 0),H.firstChild.textContent=z,I+=i,_+=o?y?-x:+x:y?+x:-x}for(L=b;L<O.length;L++)O[L].setAttribute("visibility","hidden")}},t.prototype.gridFormattedDate=function(t,e,r){var i=At.toDate(this.frameDrawing,t),n=At.toMilliseconds(this.frameDrawing,e);return n>5*At.YEAR?At.formatDate(i,"YYYY"):n>5*At.MONTH?At.formatDate(i,"MMMYYYY"):n>5*At.DAY?At.formatDate(i,"DDMMM"):n>5*At.HOUR?At.formatDate(i,"DDMMHH"):n>5*At.MINUTE?At.formatDate(i,"HHmm"):At.formatDate(i,"mmss")},t}(),xt=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e,r,i=t.getAttribute("type"),n=yt.findChildOfType(t,"pictureback"),a=yt.findChildOfType(t,"picture"),o=yt.childElements(yt.findChildOfType(t,"legend")),s=o.length,l=At.getFloatAttribute(n,"x"),u=At.getFloatAttribute(n,"y"),c=At.getFloatAttribute(n,"width"),h=At.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var d=t.getAttribute("bar-dir");e="NORTH"==d||"SOUTH"==d;var p=At.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?c/s:h/s)*p:(e?c:h)*p}for(var f=0;f<s;f++){var m=void 0,g=o[f].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(m=yt.createSvgElement("rect")).setAttribute("stroke","none"),m.setAttribute("fill",g);var b=void 0;e?(b=c/s,m.setAttribute("x","ChartBar"==i?l+b*f+(b-r)/2:l+(c-r)/2),m.setAttribute("width",r)):(b=h/s,m.setAttribute("y","ChartBar"==i?u+b*f+(b-r)/2:u+(h-r)/2),m.setAttribute("height",r)),a.appendChild(m);break;case"ChartPie":(m=yt.createSvgElement("path")).setAttribute("stroke","none"),m.setAttribute("fill",g),a.appendChild(m)}_t.addClickTapHandlerToChartItem(m)}},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=yt.findChildOfType(t,"pictureback"),n=yt.findChildOfType(t,"picture"),a=yt.childElements(n),o=yt.findChildOfType(t,"grid"),s=At.getFloatAttribute(i,"x"),l=At.getFloatAttribute(i,"y"),u=At.getFloatAttribute(i,"width"),c=At.getFloatAttribute(i,"height"),h=At.splitSkipEmpty(e," "),d=h.length,p=1/0,f=-1/0,m=!1,g=0,b=0;b<d;b++)h[b]=parseFloat(h[b]),h[b]<p&&(p=h[b]),f<h[b]&&(f=h[b]),h[b]<0&&(m=!0),g+=h[b];var v=!1;if("ChartBar"==r||"ChartStack"==r){var y=t.getAttribute("bar-dir"),A="NORTH"==y||"SOUTH"==y;"ChartBar"==r?(p=Math.min(0,p),f=Math.max(0,f)):(p=0,f=Math.max(0,g));var T=t.getAttribute(A?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=T&&"SCALE_AUTO_FROM_0"!=T||this.chartScaleAndGrid.recalcChartScale(t,p,f,A,!1),v="SCALE_100_PERCENT"==T;var C=At.getFloatAttribute(o,A?"min-y":"min-x"),S=At.getFloatAttribute(o,A?"max-y":"max-x"),E=(A?c:u)/(S-C),w=0;for(b=0;b<d;b++)if("ChartStack"==r&&(m||0==g)||"ChartBar"==r&&v&&(m||0==g))a[b].setAttribute(A?"height":"width",0);else{var k=v?h[b]/g:h[b],x=Math.abs(k),M=void 0;if("ChartBar"==r)switch(y){case"NORTH":case"WEST":M=k>0?S-k:S;break;case"SOUTH":case"EAST":M=k<0?k-C:-C}else{switch(y){case"NORTH":case"WEST":M=S-(k+w);break;case"SOUTH":case"EAST":M=-C+w}w+=k}x*=E;var O=A?c:u;(M*=E)<0?(x-=-M,M=0):M+x>O&&(x-=M+x-O),x<0&&(x=0),A?(a[b].setAttribute("y",l+M),a[b].setAttribute("height",x)):(a[b].setAttribute("x",s+M),a[b].setAttribute("width",x))}}else{var I=-Math.PI/2;for(b=0;b<d;b++){var _=g<=0||m?0:2*Math.PI*(h[b]/g),L=u/2,P=c/2,R=At.sectorData(s+L,l+P,L,P,I,_);a[b].setAttribute("d",R),I+=_}}if(("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&v)&&m?_t.showChartWarning(t,"Neg!"):_t.hideChartWarning(t),"NONE"!=t.getAttribute("leg-pos")){var F=yt.childElements(yt.findChildOfType(t,"legend"));for(b=0;b<d;b++){var D=yt.findChildOfType(F[b],"value"),N=At.formatNumber(h[b],void 0);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&v)&&g>0&&!m&&(N+=" ("+At.formatPercent(h[b]/g)+")"),D.firstChild.textContent=N,D.setAttribute("fill",h[b]>=0?"royalBlue":"fireBrick")}_t.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){yt.childElements(yt.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t}(),Mt=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(e){for(var r=e.getAttribute("type"),i=yt.findChildOfType(e,"picture"),n=yt.childElements(yt.findChildOfType(e,"legend")),a=n.length,o=0;o<a;o++){var s=n[o].getAttribute("original-color"),l=yt.createSvgElement("g");switch(n[o].setAttribute("data","empty"),r){case"ChartPlot":case"ChartTimePlot":if("true"==n[o].getAttribute("draw-line")){var u=yt.createSvgElement("polyline");if(u.setAttribute("fill","none"),u.setAttribute("stroke",s),u.setAttribute("stroke-width",n[o].getAttribute("line-width")),l.appendChild(u),"ChartTimePlot"==r){var c=yt.createSvgElement("polyline");c.setAttribute("stroke","none"),c.setAttribute("fill",At.increaseTransparency(s,t.timePlotAlpha)),l.appendChild(c)}}if("POINT_NONE"!=n[o].getAttribute("point-style")){var h=yt.createSvgElement("g");h.setAttribute("fill",s),l.appendChild(h)}break;case"ChartTimeStack":var d=yt.createSvgElement("polyline");d.setAttribute("stroke-width","1"),d.setAttribute("stroke",s),d.setAttribute("fill","none"),l.appendChild(d);var p=yt.createSvgElement("polyline");p.setAttribute("stroke","none"),p.setAttribute("fill",At.increaseTransparency(s,t.stackChartAlpha)),l.appendChild(p)}i.appendChild(l),_t.addClickTapHandlerToChartItem(l)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=yt.findChildOfType(e,"pictureback"),a=yt.findChildOfType(e,"picture"),o=yt.findChildOfType(e,"grid"),s=yt.childElements(yt.findChildOfType(e,"legend")),l=At.getFloatAttribute(n,"x"),u=At.getFloatAttribute(n,"y"),c=At.getFloatAttribute(n,"width"),h=At.getFloatAttribute(n,"height"),d=u+h,p=t.mergeData(e,r),f=p.length,m=t.parseDataAndFindMinMax(p),g=m.datasets,b=m.minx,v=m.maxx,y=m.miny,A=m.maxy;if("ChartTimeStack"==i&&y<0)_t.showChartWarning(e,"Neg!");else{_t.hideChartWarning(e),"ChartTimeStack"==i&&(y=0,A=t.prepareChartTimeStackData(g));var T,C=e.getAttribute("scale-type-x"),S=e.getAttribute("scale-type-y"),E="SCALE_100_PERCENT"==S;if("SCALE_AUTO"==C)this.chartScaleAndGrid.recalcChartScale(e,b,v,!1,!1);else if("SCALE_TIME_WINDOW"==C){T=At.getFloatAttribute(e,"scale-max-x");var w=void 0;w="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(v,T):Math.max(v,T,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,w-T,w,!1,!0)}"SCALE_AUTO"==S&&this.chartScaleAndGrid.recalcChartScale(e,y,A,!0,!1);for(var k=At.getFloatAttribute(o,"min-x"),x=At.getFloatAttribute(o,"max-x"),M=At.getFloatAttribute(o,"min-y"),O=At.getFloatAttribute(o,"max-y"),I=c/(x-k),_=h/(O-M),L=yt.childElements(a),P="",R=0;R<f;R++){var F=void 0,D=void 0,N=void 0,B=void 0,G=void 0,U=void 0,H=void 0,z=void 0,W=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(F="true"==s[R].getAttribute("draw-line"),D=s[R].getAttribute("point-style"),N="INTERPOLATION_STEP"==s[R].getAttribute("interpolation")),(F||"ChartTimeStack"==i)&&(G=(B=L[R].firstElementChild).nextElementSibling),D&&"POINT_NONE"!=D)switch(U=L[R].lastElementChild,D){case"POINT_CIRCLE":H="plot-point-circle",z=0,W=0;break;case"POINT_SQUARE":H="plot-point-square",z=-1.5,W=-1.5;break;case"POINT_TRIANGLE":H="plot-point-triangle",z=0,W=0}for(var V=void 0,Y=void 0,j="",X="",q=void 0,Z=void 0,K=0,Q=0;Q<g[R].length;Q++){var J=l+(g[R][Q][0]-k)*I,$=void 0;if(E){var tt=g[f-1][Q][1];$=tt<=0?0:g[R][Q][1]/tt}else $=g[R][Q][1];var et=u+(-$+O)*_;if(J<l&&(J=l),l+c<J&&(J=l+c),et<u&&(et=u),u+h<et&&(et=u+h),!(null!=V&&Math.abs(J-V)<_t.chartTolerance&&Math.abs(et-Y)<_t.chartTolerance)){if(J=At.reducePrecision(J),et=At.reducePrecision(et),0==Q&&(q=J),Z=J,B&&(N&&null!=V&&(j+=J+","+Y+" "),j+=J+","+et+" ",G&&(0==R&&(P=J+","+d+" "+P),X=J+","+et+" "+X)),U){var rt=yt.childElements(U)[K];rt?rt.setAttribute("visibility","inherit"):(rt=yt.createUseElement(H),U.appendChild(rt)),rt.setAttribute("x",z+J),rt.setAttribute("y",W+et)}K++,V=J,Y=et}}if(B&&(B.setAttribute("points",j),G))if("ChartTimePlot"==i){var it="";if(""!=j){var nt=u+O*_;nt<u&&(nt=u),u+h<nt&&(nt=u+h),it=Z+","+nt+" "+q+","+nt}G.setAttribute("points",j+it)}else G.setAttribute("points",j+P),P=X;if(U){var at=yt.childElements(U);for(Q=K;Q<at.length;Q++)at[Q].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var a=e.getAttribute("type"),o=yt.childElements(yt.findChildOfType(e,"legend")),s=yt.childElements(yt.findChildOfType(e,"picture"));if("ChartTimeStack"==a)s[r].firstElementChild.setAttribute("stroke",n),s[r].lastElementChild.setAttribute("fill",At.increaseTransparency(n,t.stackChartAlpha));else{if("true"==o[r].getAttribute("draw-line")){var l=s[r].firstElementChild;l.setAttribute("stroke",n),"ChartTimePlot"==a&&l.nextElementSibling.setAttribute("fill",At.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=o[r].getAttribute("point-style")&&s[r].lastElementChild.setAttribute("fill",n)}},t.mergeData=function(e,r){for(var i=yt.childElements(yt.findChildOfType(e,"legend")),n=At.splitSkipEmpty(r," "),a=n.length,o=[],s=0;s<a;s++){var l=i[s].getAttribute("data"),u=t.mergeDataset(l,n[s]);i[s].setAttribute("data",u),o.push(u)}return o},t.mergeDataset=function(t,e){var r=At.splitSkipEmpty(e,"#"),i=parseInt(r[0]),n=parseInt(r[1]),a=r[2];if("empty"==t||0==n)return a;var o=At.splitSkipEmpty(t,"|");o.splice(0,i),o.splice(n);var s=o.join("|")+"|";return"empty"==a?s:s+a},t.parseDataAndFindMinMax=function(t){for(var e=t,r=e.length,i=1/0,n=-1/0,a=1/0,o=-1/0,s=0;s<r;s++)if("empty"==e[s])e[s]=[];else{e[s]=At.splitSkipEmpty(e[s],"|");for(var l=0;l<e[s].length;l++){e[s][l]=e[s][l].split(":");var u=e[s][l][0]=parseFloat(e[s][l][0]),c=e[s][l][1]=parseFloat(e[s][l][1]);u<i&&(i=u),n<u&&(n=u),c<a&&(a=c),o<c&&(o=c)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,o=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:o}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a].length<=i||t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),Ot=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=yt.findChildOfType(t,"picture"),r=yt.findChildOfType(t,"pictureback"),i=At.getFloatAttribute(r,"x"),n=At.getFloatAttribute(r,"y"),a=At.getFloatAttribute(r,"width"),o=At.getFloatAttribute(r,"height"),s=yt.cloneElementWithId("normal-text");s.setAttribute("fill","grey"),s.setAttribute("text-anchor","middle"),s.setAttribute("x",(i+a/2).toString()),s.setAttribute("y",(n+o/2+3).toString()),s.firstChild.textContent="Not supported at the moment",e.appendChild(s)},t.draw=function(t,e){},t.setItemLook=function(t,e,r,i){},t}(),It=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=yt.findChildOfType(t,"picture"),r=yt.findChildOfType(t,"pictureback"),i=At.getFloatAttribute(r,"x"),n=At.getFloatAttribute(r,"y"),a=At.getFloatAttribute(r,"height"),o=yt.childElements(yt.findChildOfType(t,"legend")),s=o.length,l=a/s,u=l*At.getFloatAttribute(t,"bar-width"),c=(l-u)/2;t.setAttribute("rect-height",At.reducePrecision(u).toString());for(var h=0;h<s;h++){o[h].setAttribute("data","empty");var d=yt.createSvgElement("g");d.setAttribute("transform","translate("+i+","+(n+h*l+c)+")"),e.appendChild(d),_t.addClickTapHandlerToChartItem(d)}},t.prototype.draw=function(e,r){for(var i=yt.findChildOfType(e,"pictureback"),n=yt.findChildOfType(e,"picture"),a=yt.findChildOfType(e,"grid"),o=(At.getFloatAttribute(i,"x"),At.getFloatAttribute(i,"width")),s=Mt.mergeData(e,r),l=s.length,u=-1/0,c=0;c<l;c++)if("empty"==s[c])s[c]=[];else{s[c]=At.splitSkipEmpty(s[c],"|");for(var h=0;h<s[c].length;h++)s[c][h]=s[c][h].split(":"),s[c][h][0]=parseFloat(s[c][h][0]),s[c][h][1]=parseFloat(s[c][h][1]);var d=s[c][s[c].length-1][0];u<d&&(u=d)}u==1/0&&(u=0);for(c=0;c<l;c++)0!=s[c].length&&s[c][s[c].length-1][0]<u&&s[c].push([u,s[c][s[c].length-1][1]]);var p,f=At.getFloatAttribute(e,"scale-max-x");p="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(u,f):Math.max(u,f,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,p-f,p,!1,!0);var m=At.getFloatAttribute(a,"min-x"),g=o/(At.getFloatAttribute(a,"max-x")-m),b=yt.childElements(n),v=At.getFloatAttribute(e,"rect-height"),y=t.colorMapping(e);for(c=0;c<l;c++){var A=b[c],T=yt.childElements(A),C=T.length,S=0,E="",w=null;for(h=0;h<s[c].length;h++){var k=s[c][h][0],x=s[c][h][1];if(k<m)w=0,E=y(x);else if(null==w)w=(k-m)*g,E=y(x);else{var M=y(x);if(M!=E||h==s[c].length-1){var O=(k-m)*g,I=void 0;S<C?(I=T[S],S++,I.setAttribute("visibility","inherit")):(I=yt.createSvgElement("rect"),A.appendChild(I)),At.setMultipleAttributes(I,["x","width","height","fill"],[At.reducePrecision(w),At.reducePrecision(O-w),v,E]),w=O,E=M}}}for(var _=S;_<C;_++)T[_].setAttribute("visibility","hidden")}},t.colorMapping=function(t){var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color");e=At.splitSkipEmpty(e," ");for(var i=[],n=[],a=function(t){var r=e[t].split(":"),a=void 0,o=parseFloat(r[1]);switch(r[0]){case"GREATER":a=function(t){return t>o};break;case"GREATER_OR_EQUALS":a=function(t){return t>=o};break;case"LESS":a=function(t){return t<o};break;case"LESS_OR_EQUALS":a=function(t){return t<=o};break;case"EQUALS":a=function(t){return t==o};break;case"NOT_EQUALS":a=function(t){return t!=o}}i[t]=a,n[t]=r[2]},o=0;o<e.length;o++)a(o);return function(t){for(var e=0;e<i.length;e++)if(i[e](t))return n[e];return r}},t.setItemLook=function(t,e,r,i){var n=yt.findChildOfType(t,"picture");yt.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),_t=function(){function t(t){this.frameDrawing=t,this.chartScaleAndGrid=new kt(t),this.chart1D=new xt(t,this.chartScaleAndGrid),this.chart2D=new Mt(t,this.chartScaleAndGrid),this.chartHistogram=new wt(t,this.chartScaleAndGrid),this.chartHistogram2D=new Ot(t,this.chartScaleAndGrid),this.chartTimeColor=new It(t,this.chartScaleAndGrid)}return t.create=function(){return yt.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),a=yt.findChildOfType(e,"background"),o=yt.findChildOfType(e,"pictureback"),s=yt.findChildOfType(e,"pictureselect"),l=yt.findChildOfType(e,"pictureborderh"),u=yt.findChildOfType(e,"pictureborderw"),c=yt.findChildOfType(e,"grid"),h=0;h<r.length;h++)switch(r[h]){case"width":case"height":case"fill":case"stroke":a.setAttribute(r[h],i[h]);break;case"pic-width":case"pic-height":o.setAttribute(r[h].substring(4),i[h]),s.setAttribute(r[h].substring(4),i[h]);break;case"pic-fill":o.setAttribute(r[h].substring(4),i[h]);break;case"pic-stroke":l.setAttribute(r[h].substring(4),i[h]),u.setAttribute(r[h].substring(4),i[h]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":c.setAttribute(r[h],i[h]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":t.addItem(e,i[h]);break;case"items-completed":t.setupLegendItemsLayout(e),t.setupPicture(e);break;case"data":this.drawPicture(e,i[h]);break;default:e.setAttribute(r[h],i[h])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=yt.findChildOfType(e,"background"),n=yt.findChildOfType(e,"pictureback"),a=yt.findChildOfType(e,"pictureselect"),o=yt.findChildOfType(e,"pictureborderh"),s=yt.findChildOfType(e,"pictureborderw"),l=yt.findChildOfType(e,"warning"),u=yt.findChildOfType(e,"legend"),c=e.getAttribute("leg-pos"),h=At.getFloatAttribute(i,"width"),d=At.getFloatAttribute(i,"height"),p=At.getFloatAttribute(e,"pic-offset-x"),f=At.getFloatAttribute(e,"pic-offset-y"),m=At.getFloatAttribute(n,"width"),g=At.getFloatAttribute(n,"height"),b=At.getFloatAttribute(e,"leg-size"),v=0,y=0,A=0,T=0;switch(c){case"SOUTH":v=p,y=d-b,A=h-p,T=b;break;case"WEST":p+=b,v=0,y=f,A=b,T=d-f;break;case"EAST":v=h-b,y=f,A=b,T=d-f;break;case"NORTH":f+=b,v=p,y=0,A=h-p,T=b}if(At.setMultipleAttributes(n,["x","y"],[p,f]),At.setMultipleAttributes(a,["x","y"],[p,f]),At.setMultipleAttributes(l,["x","y"],[p+m/2,f+g/2+3]),"NONE"==c?u.setAttribute("visibility","hidden"):(u.setAttribute("transform","translate("+v+","+y+")"),At.setMultipleAttributes(u,["width","height"],[A,T])),"ChartPie"==r){var C=m/2,S=g/2,E=yt.createSvgElement("ellipse");At.setMultipleAttributes(E,["cx","cy","rx","ry","stroke","fill","visibility"],[p+C,f+S,C,S,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(E,n);var w=yt.createSvgElement("ellipse");At.setMultipleAttributes(w,["cx","cy","rx","ry","stroke","fill"],[p+C,f+S,C,S,o.getAttribute("stroke"),"none"]),e.insertBefore(w,o),yt.removeElement(e,o),yt.removeElement(e,s)}e.onmouseover=function(e){return t.selectChart(e,!0)},e.onmouseout=function(e){return t.selectChart(e,!1)}},t.setupLegendItemsLayout=function(t){for(var e=yt.findChildOfType(t,"legend"),r=yt.childElements(e),i=At.getFloatAttribute(e,"width"),n=0,a=0,o=0;o<r.length;o++){var s=r[o],l=yt.findChildOfType(s,"back"),u=At.getFloatAttribute(l,"width"),c=yt.findChildOfType(s,"value"),h=c.getComputedTextLength(),d=Math.max(u,At.getFloatAttribute(c,"x")+h);l.setAttribute("width",d.toString()),0<n&&i<n+d&&(n=0,a+=20),s.setAttribute("transform","translate("+n+","+a+")"),n+=d+5}},t.showChartWarning=function(t,e){var r=yt.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=yt.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=yt.findChildOfType(t,"picture"),r=yt.findChildOfType(t,"legend");yt.removeAllChildren(r),yt.removeAllChildren(e)},t.addItem=function(e,r){var i=e.getAttribute("type"),n=yt.findChildOfType(e,"legend"),a=r.split("\n"),o=a[0],s=a[1],l=yt.cloneElementWithId("legend-item"),u=yt.findChildOfType(l,"color"),c=yt.findChildOfType(l,"name"),h=yt.findChildOfType(l,"value");u.setAttribute("fill",o),l.setAttribute("original-color",o),c.setAttribute("fill",e.getAttribute("leg-text-color")),c.appendChild(yt.createTextNode(s)),h.appendChild(yt.createTextNode("")),n.appendChild(l);var d=c.getComputedTextLength();h.setAttribute("x",(At.getFloatAttribute(c,"x")+d+4).toString()),"ChartPlot"==i||"ChartTimePlot"==i?At.setMultipleAttributes(l,["draw-line","line-width","interpolation","point-style"],[a[2],a[3],a[4],a[5]]):"ChartHistogram"==i&&At.setMultipleAttributes(l,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[a[2],a[3],a[4],a[5],a[6]]),t.addClickTapHandlerToChartItem(l)},t.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":xt.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":Mt.setup(t);break;case"ChartTimeColor":It.setup(t);break;case"ChartHistogram":wt.setup(t);break;case"ChartHistogram2D":Ot.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":Ot.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.selectChart=function(t,e){var r=t.currentTarget;yt.findChildOfType(r,"pictureselect").setAttribute("visibility",e?"inherit":"hidden")},t.addClickTapHandlerToChartItem=function(e){new m(e,function(r){return t.selectChartItem(e,!0,!1)},function(r){return t.selectChartItem(e,!1,!1)},null,function(r){return t.selectChartItem(e,!0,!0)},function(t){return!1})},t.selectChartItem=function(e,r,i){for(var n=t.getChartShape(e),a=At.indexInParent(e),o=yt.childElements(yt.findChildOfType(n,"legend")),s=o[a],l="true"==s.getAttribute("selected"),u=!1,c=0;c<o.length;c++)if(c!=a&&"true"==o[c].getAttribute("selected")){u=!0;break}if(i)return l=!l,s.setAttribute("selected",l?"true":"false"),void t.setChartItemLook(n,a,!1,l);if(l||u){if(l)return;t.setChartItemLook(n,a,!r,r)}else{t.setChartItemLook(n,a,!1,r);for(c=0;c<o.length;c++)c!=a&&t.setChartItemLook(n,c,r,!1)}},t.setChartItemLook=function(e,r,i,n){var a=yt.childElements(yt.findChildOfType(e,"legend")),o=yt.findChildOfType(a[r],"back"),s=yt.findChildOfType(a[r],"color");o.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var l=i?t.colorItemGrayed:a[r].getAttribute("original-color");switch(s.setAttribute("fill",l),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":xt.setItemLook(e,r,i,l);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":Mt.setItemLook(e,r,i,l);break;case"ChartTimeColor":It.setItemLook(e,r,i,l);break;case"ChartHistogram":wt.setItemLook(e,r,i,l);break;case"ChartHistogram2D":Ot.setItemLook(e,r,i,l)}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),Lt=function(){function t(t){var e=this;this.client=t,this.onWindowResizeEventClosure=function(t){return e.applyNavigationSettings()},this.onSVGPointingEventClosure=function(t){return e.onSVGPointingEvent(t)}}return t.prototype.initSVGNavigation=function(){window.addEventListener("resize",this.onWindowResizeEventClosure,!1),w.addFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.oncontextmenu=function(){return!1},t.addEventListener("mousedown",this.onSVGPointingEventClosure),t.addEventListener("mousemove",this.onSVGPointingEventClosure),t.addEventListener("mouseup",this.onSVGPointingEventClosure),t.addEventListener("mouseout",this.onSVGPointingEventClosure),t.addEventListener("wheel",this.onSVGPointingEventClosure),t.addEventListener("touchstart",this.onSVGPointingEventClosure),t.addEventListener("touchmove",this.onSVGPointingEventClosure),t.addEventListener("touchend",this.onSVGPointingEventClosure),this.buttonDown=0,this.prevPtrCoords=[],this.presentationCoords=[0,0],this.zoom=1},t.prototype.clearSVGNavigation=function(){if(this.client.svg){window.removeEventListener("resize",this.onWindowResizeEventClosure),w.removeFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.removeEventListener("mousedown",this.onSVGPointingEventClosure),t.removeEventListener("mousemove",this.onSVGPointingEventClosure),t.removeEventListener("mouseup",this.onSVGPointingEventClosure),t.removeEventListener("mouseout",this.onSVGPointingEventClosure),t.removeEventListener("wheel",this.onSVGPointingEventClosure),t.removeEventListener("touchstart",this.onSVGPointingEventClosure),t.removeEventListener("touchmove",this.onSVGPointingEventClosure),t.removeEventListener("touchend",this.onSVGPointingEventClosure)}},t.prototype.onSVGPointingEvent=function(e){e.stopPropagation();var r=At.offsetPage(this.client.svg);if(e.type.startsWith("mouse")||"wheel"==e.type){var i=e,n=i.pageX-r.left,a=i.pageY-r.top;switch(i.type){case"mousedown":this.buttonDown=i.which,this.prevPtrCoords=[n,a],1==this.buttonDown||this.buttonDown;break;case"mousemove":if(1==this.buttonDown)i.preventDefault();else if(3==this.buttonDown){var o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];this.applyPanning(o,s),this.prevPtrCoords=[n,a]}break;case"mouseup":case"mouseout":if(this.client.svg.parentNode.contains(i.relatedTarget))return;var l=this.buttonDown;if(this.buttonDown=0,1==l){o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];Math.abs(o)<=t.clickTolerance&&Math.abs(s)<=t.clickTolerance&&this.onPresentationClick(i,n,a)}this.prevPtrCoords=[];break;case"wheel":var u=e;u.altKey?this.onWheelZooming(0<u.deltaY,n,a):(e.preventDefault(),0<u.deltaY?this.applyPanning(0,-50):this.applyPanning(0,50))}}else if(e.type.startsWith("touch")){var c=e,h=void 0,d=void 0,p=void 0,f=void 0;switch(c.touches.length>0&&(h=c.touches[0].pageX-r.left,d=c.touches[0].pageY-r.top),c.touches.length>1&&(p=c.touches[1].pageX-r.left,f=c.touches[1].pageY-r.top),c.type){case"touchstart":this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchmove":if(c.preventDefault(),c.touches.length>1&&4==this.prevPtrCoords.length){var m=(h+p)/2,g=(d+f)/2,b=Math.hypot(this.prevPtrCoords[2]-this.prevPtrCoords[0],this.prevPtrCoords[3]-this.prevPtrCoords[1]),v=Math.hypot(p-h,f-d)/b*this.zoom;v=Math.max(v,t.zooms[0]),v=Math.min(v,t.zooms[t.zooms.length-1]),this.applyZoom(v,m,g)}else if(this.prevPtrCoords.length>=2){o=h-this.prevPtrCoords[0],s=d-this.prevPtrCoords[1];if(4==this.prevPtrCoords.length){var y=Math.hypot(o,s),A=h-this.prevPtrCoords[2],T=d-this.prevPtrCoords[3];Math.hypot(A,T)<y&&(o=A,s=T)}this.applyPanning(o,s)}this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchend":this.prevPtrCoords=[]}}},t.prototype.applyPresentationTransform=function(){var t=this.client.frameDrawing.navigationSettings;if(!t.zoomAndPanningEnabled){var e=this.zoom,r=this.presentationCoords[0],i=this.presentationCoords[1],n=this.client.svg.getBoundingClientRect(),a=n.width,o=n.height;e=Math.max(e,a/t.width),e=Math.max(e,o/t.height),r=Math.min(r,-t.x*e),r=Math.max(r,a-(t.x+t.width)*e),i=Math.min(i,-t.y*e),i=Math.max(i,o-(t.y+t.height)*e),this.presentationCoords=[r,i],this.zoom=e}var s="translate("+this.presentationCoords[0]+","+this.presentationCoords[1]+")",l="scale("+this.zoom+")";this.client.presentation.setAttribute("transform",s+" "+l)},t.prototype.applyZoom=function(t,e,r){if(t!=this.zoom){var i=this.client.frameDrawing.navigationSettings;if(!i.zoomAndPanningEnabled){var n=this.client.svg,a=this.client.svg.getBoundingClientRect(),o=a.width,s=a.height,l=i.width,u=i.height,c=n.parentNode.getBoundingClientRect(),h=c.width,d=c.height;if((t=l/u>h/d?Math.max(t,h/l):Math.max(t,d/u))==this.zoom)return;var p=Math.min(l*t,h),f=Math.min(u*t,d);p!=o&&n.setAttribute("width",p.toString()),f!=s&&n.setAttribute("height",f.toString())}var m=t/this.zoom,g=e-(e-this.presentationCoords[0])*m,b=r-(r-this.presentationCoords[1])*m;this.presentationCoords=[g,b],this.zoom=t,this.applyPresentationTransform()}},t.prototype.applyPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform()},t.prototype.navigateTo=function(t,e,r){this.zoom=r,this.presentationCoords=[-t*this.zoom,-e*this.zoom],this.applyPresentationTransform()},t.prototype.onWheelZooming=function(e,r,i){var n=this.zoom;if(e){for(var a=t.zooms.length-1;a>=0;a--)if(t.zooms[a]<this.zoom){n=t.zooms[a];break}}else for(a=0;a<t.zooms.length;a++)if(this.zoom<t.zooms[a]){n=t.zooms[a];break}this.applyZoom(n,r,i)},t.prototype.onPresentationClick=function(t,e,r){var i=e-this.presentationCoords[0],n=r-this.presentationCoords[1];i/=this.zoom,n/=this.zoom,this.client.frameDrawing.onUserClick(t.target,i,n)},t.prototype.applyNavigationSettings=function(){var t,e,r,i=this.client.svg,n=this.client.frameDrawing.navigationSettings,a=n.width,o=n.height,s=n.zoomAndPanningEnabled,l=n.width/n.height,u=i.parentNode.getBoundingClientRect(),c=u.width,h=u.height,d=c/h,p=n.x,f=n.y;l>d?(r=c/a,t=c,s?f-=((e=h)/r-o)/2:e=c/l):(r=h/o,s?p-=((t=c)/r-a)/2:t=h*l,e=h),At.setMultipleAttributes(i,["width","height"],[t,e]),this.navigateTo(p,f,r)},t.clickTolerance=1,t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t}(),Pt=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return yt.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return yt.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return yt.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)r[n],e.setAttribute(r[n],i[n]);t.updateGISMarkupPosition(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=yt.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=At.getFloatAttribute(t,"lon"),n=At.getFloatAttribute(t,"lat"),a=Rt.lonLatToXY(r,i,n);At.setMultipleAttributes(t,["cx","cy"],[a[0],a[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var o=t.getAttribute("lonlatpoints"),s=Rt.lonLatPointsToXYPoints(r,o);t.setAttribute("points",s)}},t}(),Rt=function(){function t(t){this.frameDrawing=t}return t.prototype.createShapeGISMap=function(){var t=this,e=yt.cloneElementWithId("shape-gis-map"),r=function(e){return t.onGISEvent(e)};e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r);var i=yt.findChildOfType(e,"map").firstElementChild;return yt.findChildOfType(i,"agents").addEventListener("click",function(e){return t.onGISAgentLayerClick(e)}),e},t.prototype.updateShapeGISMap=function(t,e,r){for(var i=yt.findChildOfType(t,"background"),n=yt.findChildOfType(t,"map"),a=yt.findChildOfType(t,"shadow"),o=yt.findChildOfType(t,"border"),s=0;s<e.length;s++)switch(e[s]){case"width":case"height":i.setAttribute(e[s],r[s]),n.setAttribute(e[s],r[s]),a.setAttribute(e[s],r[s]),o.setAttribute(e[s],r[s]);break;case"size-completed":t.getAttribute("zoom")&&this.redrawGISMap(t);break;case"background-color":i.setAttribute("fill",r[s]);break;case"border-color":o.setAttribute("stroke",r[s]);break;case"map-completed":this.redrawGISMap(t);break;default:t.setAttribute(e[s],r[s])}},t.prototype.redrawGISMap=function(e){this.redrawGISTiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.prototype.redrawGISTiles=function(e){var r=yt.findChildOfType(e,"background"),i=At.getFloatAttribute(r,"width"),n=At.getFloatAttribute(r,"height"),a=t.minGISZoom(i,n),o=yt.findChildOfType(e,"map").firstElementChild;o.setAttribute("transform","translate(0,0)");var s=At.getIntAttribute(e,"zoom"),l=At.getFloatAttribute(e,"center-lon"),u=At.getFloatAttribute(e,"center-lat");s<a&&(s=a,e.setAttribute("zoom",s.toString()));var c,h=Math.pow(2,s),d=t.latToTileYFloat(u,s),p=n/2/t.tileImageSize;d-p<0?c=p:h<d+p&&(c=h-p),c&&(u=t.tileYToLat(c,s),e.setAttribute("center-lat",u.toString()));var f=yt.findChildOfType(o,"tiles");yt.removeAllChildren(f),this.updateGISTiles(f,s,u,l,0,0,i,n,h)},t.prototype.updateGISTiles=function(e,r,i,n,a,o,s,l,u){for(var c=t.lonToTileXInt(n,r),h=t.latToTileYInt(i,r),d=a+s/2-t.lonToXOffsetWithinTile(n,r),p=o+l/2-t.latToYOffsetWithinTile(i,r);d>0;)d-=t.tileImageSize,c--;for(;p>0;)p-=t.tileImageSize,h--;c=At.modulo(c,u),h=At.modulo(h,u);for(var f=[],m=yt.childElements(e),g=0;g<m.length;g++)f.push(m[g]);for(var b=c,v=d;v<s;v+=t.tileImageSize){for(var y=h,A=p;A<l;A+=t.tileImageSize){var T=r+"/"+b+"/"+y,C=null;for(g=0;g<f.length;g++)if(f[g].getAttribute("tileid")==T){C=f[g];break}null==C&&(C=this.addGISTile(e,r,b,y)),C.setAttribute("x",(v-a).toString()),C.setAttribute("y",(A-o).toString()),y=At.modulo(y+1,u)}b=At.modulo(b+1,u)}},t.prototype.addGISTile=function(e,r,i,n){var a=yt.findParentOfType(e,"ShapeGISMap"),o=this.tileURL(a,r,i,n),s=yt.createSvgElement("image");return s.setAttribute("width",t.tileImageSize.toString()),s.setAttribute("height",t.tileImageSize.toString()),s.setAttributeNS(yt.xlinkns,"href",o),s.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(s),s},t.redrawGISMarkup=function(t){for(var e=yt.findChildOfType(t,"map").firstElementChild,r=yt.findChildOfType(e,"markup"),i=yt.childElements(r),n=0;n<i.length;n++)Pt.updateGISMarkupPosition(i[n])},t.redrawGISAgents=function(e){for(var r=yt.findChildOfType(e,"map").firstElementChild,i=yt.findChildOfType(r,"agents"),n=yt.childElements(i),a=0;a<n.length;a++)t.updateGISObjectScale(n[a]),"hidden"!=n[a].getAttribute("visibility")&&t.updateGISObjectPosition(n[a])},t.updateGISObjectPosition=function(e){var r=yt.findParentOfType(e,"ShapeGISMap"),i=At.getFloatAttribute(e,"lon"),n=At.getFloatAttribute(e,"lat"),a=At.getFloatAttribute(e,"heading"),o=t.lonLatToXY(r,i,n),s="translate("+o[0]+","+o[1]+") rotate("+a+")",l=e.getAttribute("scale");l&&(s+=" scale("+l+")"),e.setAttribute("transform",s)},t.updateGISObjectScale=function(e){var r=yt.findParentOfType(e,"ShapeGISMap"),i=At.getIntAttribute(e,"fixed-scale-zoom");if(i){var n=At.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var a=1;if(At.getIntAttribute(e,"real-scale-zoom")<=n){var o=At.getFloatAttribute(e,"pixels-per-meter"),s=At.getFloatAttribute(e,"lat");a=t.pixelsPerGISMeter(n,s)/o}e.setAttribute("scale",a.toString())}},t.prototype.panGIS=function(e,r,i){var n=yt.findChildOfType(e,"map").firstElementChild,a=At.parseTranslateTransform(n.getAttribute("transform")),o=a[0]+r,s=a[1]+i,l=At.getIntAttribute(e,"zoom"),u=Math.pow(2,l),c=At.getFloatAttribute(e,"center-lon"),h=At.getFloatAttribute(e,"center-lat"),d=t.latToTileYFloat(h,l),p=yt.findChildOfType(e,"background"),f=At.getFloatAttribute(p,"width"),m=At.getFloatAttribute(p,"height"),g=m/2/t.tileImageSize;d-g-s/t.tileImageSize<0?s=(d-g)*t.tileImageSize:u<d+g-s/t.tileImageSize&&(s=(d+g-u)*t.tileImageSize),o=t.normalizedGISX(o,l),o=Math.round(o),s=Math.round(s),n.setAttribute("transform","translate("+o+","+s+")");var b=yt.findChildOfType(n,"tiles");this.updateGISTiles(b,l,h,c,o,s,f,m,u)},t.prototype.zoomOutGIS=function(e,r,i){var n=yt.findChildOfType(e,"background"),a=At.getFloatAttribute(n,"width"),o=At.getFloatAttribute(n,"height"),s=At.getIntAttribute(e,"zoom");t.minGISZoom(a,o)<s&&this.setGISZoom(e,r,i,s-1)},t.prototype.zoomInGIS=function(t,e,r){var i=At.getIntAttribute(t,"zoom");i<19&&this.setGISZoom(t,e,r,i+1)},t.prototype.setGISZoom=function(e,r,i,n){var a=yt.findChildOfType(e,"background"),o=At.getFloatAttribute(a,"width"),s=At.getFloatAttribute(a,"height"),l=yt.findChildOfType(e,"map").firstElementChild,u=At.parseTranslateTransform(l.getAttribute("transform")),c=t.xyToLonLat(e,r-u[0],i-u[1]),h=t.lonToTileXFloat(c[0],n),d=t.latToTileYFloat(c[1],n),p=Math.pow(2,n);h=At.remainderPositive(h-(r-o/2)/t.tileImageSize,p),d=At.remainderPositive(d-(i-s/2)/t.tileImageSize,p);var f=t.tileXToLon(h,n),m=t.tileYToLat(d,n);At.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,f,m]),this.redrawGISMap(e)},t.prototype.onGISClick=function(e,r,i){var n=yt.findChildOfType(e,"map").firstElementChild,a=At.parseTranslateTransform(n.getAttribute("transform")),o=t.xyToLonLat(e,r-a[0],i-a[1]);this.frameDrawing.client.network.postUserAction(e.id,o[0]+" "+o[1])},t.prototype.onGISEvent=function(e){var r=e.currentTarget;if("true"==r.getAttribute("navigation-enabled")){var i=yt.findChildOfType(r,"background"),n=At.getFloatAttribute(i,"width"),a=At.getFloatAttribute(i,"height"),o=i.getBoundingClientRect(),s=o.width/n,l=o.height/a,u=At.offsetPage(i);if(e.type.startsWith("mouse")||"wheel"==e.type){var c=e,h=(c.pageX-u.left)/s,d=(c.pageY-u.top)/l;switch(e.type){case"mousedown":t.buttonDown=c.which,1==t.buttonDown&&(e.stopPropagation(),t.prevPtrCoords=[h,d]);break;case"mousemove":if(1==t.buttonDown){e.stopPropagation(),e.preventDefault();var p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];t.prevPtrCoords=[h,d],this.panGIS(r,p,f)}break;case"mouseup":case"mouseout":if(r.contains(c.relatedTarget))return;if(1==t.buttonDown){e.stopPropagation();p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];Math.abs(p)<=Lt.clickTolerance&&Math.abs(f)<=Lt.clickTolerance&&this.onGISClick(r,h,d)}t.buttonDown=0;break;case"wheel":if(!c.altKey&&!c.ctrlKey){var m=e;e.stopPropagation(),e.preventDefault(),0<m.deltaY?this.zoomOutGIS(r,h,d):this.zoomInGIS(r,h,d)}}}else if(e.type.startsWith("touch")){var g=e;if(g.touches.length>2)return;var b=void 0,v=void 0,y=void 0,A=void 0;switch(g.touches.length>0&&(b=(g.touches[0].pageX-u.left)/s,v=(g.touches[0].pageY-u.top)/l),g.touches.length>1&&(y=(g.touches[1].pageX-u.left)/s,A=(g.touches[1].pageY-u.top)/l),e.type){case"touchstart":e.stopPropagation(),t.prevPtrCoords=g.touches.length>1?[b,v,y,A]:[b,v];break;case"touchmove":if(e.stopPropagation(),e.preventDefault(),g.touches.length>1&&4==t.prevPtrCoords.length){var T=(b+y)/2,C=(v+A)/2,S=Math.hypot(t.prevPtrCoords[2]-t.prevPtrCoords[0],t.prevPtrCoords[3]-t.prevPtrCoords[1]),E=Math.hypot(y-b,A-v);(E<.8*S||1.2*S<E)&&(E<S?this.zoomOutGIS(r,T,C):this.zoomInGIS(r,T,C),t.prevPtrCoords=[b,v,y,A])}else if(t.prevPtrCoords.length>=2){p=b-t.prevPtrCoords[0],f=v-t.prevPtrCoords[1];if(4==t.prevPtrCoords.length){var w=Math.hypot(p,f),k=b-t.prevPtrCoords[2],x=v-t.prevPtrCoords[3];Math.hypot(k,x)<w&&(p=k,f=x)}this.panGIS(r,p,f),t.prevPtrCoords=g.touches.length>1?[b,v,y,A]:[b,v]}else t.prevPtrCoords=g.touches.length>1?[b,v,y,A]:[b,v];break;case"touchend":e.stopPropagation(),t.prevPtrCoords=[]}}}},t.prototype.onGISAgentLayerClick=function(t){t.stopPropagation(),t.preventDefault();for(var e=t.currentTarget,r=t.target;r.parentNode!=e;)r=r.parentNode;this.frameDrawing.client.network.postUserAction(r.id,"0 0")},t.xyToLonLat=function(e,r,i){var n=yt.findChildOfType(e,"background"),a=At.getFloatAttribute(n,"width"),o=At.getFloatAttribute(n,"height"),s=At.getIntAttribute(e,"zoom"),l=Math.pow(2,s),u=t.lonToTileXFloat(At.getFloatAttribute(e,"center-lon"),s),c=t.latToTileYFloat(At.getFloatAttribute(e,"center-lat"),s),h=(r-a/2)/t.tileImageSize,d=(i-o/2)/t.tileImageSize,p=At.remainderPositive(u+h,l),f=At.remainderPositive(c+d,l);return[t.tileXToLon(p,s),t.tileYToLat(f,s)]},t.lonLatToXY=function(e,r,i){var n=yt.findChildOfType(e,"background"),a=At.getFloatAttribute(n,"width"),o=At.getFloatAttribute(n,"height"),s=At.getIntAttribute(e,"zoom"),l=t.lonToTileXFloat(At.getFloatAttribute(e,"center-lon"),s),u=t.latToTileYFloat(At.getFloatAttribute(e,"center-lat"),s),c=t.lonToTileXFloat(r,s),h=t.latToTileYFloat(i,s);return[a/2+(c-l)*t.tileImageSize,o/2+(h-u)*t.tileImageSize]},t.lonLatPointsToXYPoints=function(e,r){var i=yt.findChildOfType(e,"background"),n=At.getFloatAttribute(i,"width"),a=At.getFloatAttribute(i,"height"),o=At.getIntAttribute(e,"zoom"),s=t.lonToTileXFloat(At.getFloatAttribute(e,"center-lon"),o),l=t.latToTileYFloat(At.getFloatAttribute(e,"center-lat"),o),u=void 0,c=void 0,h="";r=At.splitSkipEmpty(r," ");for(var d=0;d<r.length;d++){var p=r[d].split(","),f=t.lonToTileXFloat(parseFloat(p[0]),o),m=t.latToTileYFloat(parseFloat(p[1]),o),g=n/2+(f-s)*t.tileImageSize,b=a/2+(m-l)*t.tileImageSize;null!=u&&Math.abs(g-u)<t.gisTolerance&&Math.abs(b-c)<t.gisTolerance||(h+=(g=At.reducePrecision(g))+","+(b=At.reducePrecision(b))+" ",u=g,c=b)}return h},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.prototype.tileURL=function(e,r,i,n){var a;switch(e.getAttribute("tile-url-provider-type")){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":a=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":a=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":a=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":a=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":a=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":a=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":a=At.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}return a[Math.floor(Math.random()*a.length)].replace("[zoom]",r.toString()).replace("[x]",i.toString()).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=At.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=At.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(At.byteArrayToString(n))},t.buttonDown=0,t.prevPtrCoords=[0,0],t.gisTolerance=2,t.tileImageSize=256,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),Ft=function(){function t(){}return t.createMarkupPipe=function(t){var e=yt.cloneElementWithId("markup-pipe"),r=t+"basepath";yt.findChildOfType(e,"basepath").firstElementChild.id=r;var i=yt.findChildOfType(e,"pipe"),n=yt.findChildOfType(e,"inner-pipe"),a=yt.findChildOfType(e,"bubbles"),o="#"+r;return i.setAttributeNS(yt.xlinkns,"href",o),n.setAttributeNS(yt.xlinkns,"href",o),a.setAttributeNS(yt.xlinkns,"href",o),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=yt.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=yt.findChildOfType(t,"batches"),s=yt.findChildOfType(t,"bubbles"),l=0;l<e.length;l++)switch(e[l]){case"phase":s.setAttribute("stroke-dashoffset",(12-parseFloat(r[l])).toString());break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=yt.childElements(o)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=o.childElementCount,m=p;m<f;m++)yt.removeElement(o,o.lastElementChild);for(m=f;m<p;m++)d=yt.createUseElement(a),o.appendChild(d);break;case"d":var g=parseFloat(yt.findChildOfType(t,"pipe").getAttribute("stroke-width")),b=At.roundPathCorners(r[l],2*g,!1);n.setAttribute("d",b);break;case"width":var v=parseFloat(r[l]);yt.findChildOfType(t,"pipe").setAttribute("stroke-width",v.toString()),yt.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*v).toString()),o.setAttribute("stroke-width",(.6*v).toString());var y=Math.min(5,.2*v);s.setAttribute("stroke-width",y.toString()),s.setAttribute("stroke-dasharray",y+","+(12-y));break;case"color":yt.findChildOfType(t,"pipe").setAttribute("stroke",r[l]);break;case"inner-color":yt.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[l]);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupStorageTank=function(){return yt.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=yt.findChildOfType(t,"square"),n=yt.findChildOfType(t,"batches"),a=parseFloat(i.getAttribute("width")),o=0;o<e.length;o++)switch(e[o]){case"batch":var s=r[o].split(" "),l=parseFloat(s[1])*a,u=parseFloat(s[2])*a,c=yt.childElements(n)[parseInt(s[0])];At.setMultipleAttributes(c,["y","height","fill"],[a/2-l-u,u,s[3]]);break;case"newbatches":for(var h=parseInt(r[o]),d=n.childElementCount,p=h;p<d;p++)yt.removeElement(n,n.lastElementChild);for(p=d;p<h;p++)c=yt.createSvgElement("rect"),At.setMultipleAttributes(c,["stroke","width","x"],["none",a,-a/2]),n.appendChild(c);break;case"progress":var f=parseFloat(r[o])*Math.PI*2,m=parseFloat(yt.findChildOfType(t,"circle").getAttribute("r"))-2,g=m*Math.sin(f),b=-m*Math.cos(f),v="M 0 "+-m+" ";v+="A "+m+" "+m+" 0 "+(f>Math.PI?"1":"0")+" 1 "+g+" "+b,yt.findChildOfType(t,"arc").setAttribute("d",v);break;case"radius":yt.findChildOfType(t,"circle").setAttribute("r",r[o]),a=Math.max(10,2*parseFloat(r[o])/Math.sqrt(2)-8),At.setMultipleAttributes(i,["width","height","x","y"],[a,a,-a/2,-a/2]);break;case"color":yt.findChildOfType(t,"circle").setAttribute("fill",r[o]);break;case"stroke-color":yt.findChildOfType(t,"circle").setAttribute("stroke",r[o]),yt.findChildOfType(t,"square").setAttribute("stroke",r[o]);break;default:t.setAttribute(e[o],r[o])}},t.createMarkupBulkConveyorBelt=function(t){var e=yt.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";yt.findChildOfType(e,"basepath").firstElementChild.id=r;var i=yt.findChildOfType(e,"belt"),n=yt.findChildOfType(e,"belt-sections"),a="#"+r;return i.setAttributeNS(yt.xlinkns,"href",a),n.setAttributeNS(yt.xlinkns,"href",a),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=yt.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=yt.findChildOfType(t,"belt-sections"),s=yt.findChildOfType(t,"batches"),l=0;l<e.length;l++)switch(e[l]){case"phase":o.setAttribute("stroke-dashoffset",r[l]);break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=yt.childElements(s)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=s.childElementCount,m=p;m<f;m++)yt.removeElement(s,s.lastElementChild);for(m=f;m<p;m++)d=yt.createUseElement(a),s.appendChild(d);break;case"d":n.setAttribute("d",r[l]);break;case"width":var g=r[l];yt.findChildOfType(t,"belt").setAttribute("stroke-width",g),o.setAttribute("stroke-width",g),o.setAttribute("stroke-dasharray","2, 10"),s.setAttribute("stroke-width",(.4*parseFloat(g)).toString());break;case"color":yt.findChildOfType(t,"belt").setAttribute("stroke",r[l]);break;case"sections-color":o.setAttribute("stroke",r[l]);break;default:t.setAttribute(e[l],r[l])}},t}(),Dt=function(){function t(){}return t.createMarkupPath=function(t,e){var r=yt.cloneElementWithId("markup-path"),i=e+"basepath";yt.findChildOfType(r,"basepath").firstElementChild.id=i;var n=yt.findChildOfType(r,"paths"),a=1;"MarkupPathRoad"==t&&(a=2),"MarkupPathRailroad"==t&&(a=4);for(var o=0;o<a;o++){var s=yt.createUseElement(i);n.appendChild(s)}var l=yt.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),l.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),yt.childElements(n)[1].setAttribute("stroke","black"),yt.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=yt.findChildOfType(t,"basepath").firstElementChild,a=yt.findChildOfType(t,"paths"),o=a.firstElementChild,s=yt.findChildOfType(t,"arrows"),l=0;l<e.length;l++)switch(e[l]){case"d":n.setAttribute("d",r[l]);break;case"bidirectional":yt.removeAllChildren(s),"false"==r[l]&&At.addPathArrows(n,"arrowhead",1.7,s,50,100);break;case"stroke-width":var u=parseFloat(r[l]);switch(i){case"MarkupPathLine":o.setAttribute("stroke-width",u.toString());break;case"MarkupPathDashline":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",4*u+" "+u);break;case"MarkupPathConveyor":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",u/2+" "+u/10);break;case"MarkupPathRoad":o.setAttribute("stroke-width",u.toString());var c=a.lastElementChild;c.setAttribute("stroke-width",(u/12).toString()),c.setAttribute("stroke-dasharray",u/2+" "+u/5);break;case"MarkupPathRailroad":var h=u/10+" "+u/2.5;o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",h),yt.childElements(a)[1].setAttribute("stroke-width",(u/2+u/12).toString()),yt.childElements(a)[2].setAttribute("stroke-width",(u/2).toString());var d=a.lastElementChild;d.setAttribute("stroke-width",(u/2).toString()),d.setAttribute("stroke-dasharray",h)}break;case"stroke":o.setAttribute("stroke",r[l]),u=parseFloat(o.getAttribute("stroke-width")),s.setAttribute("stroke",u>4?"white":r[l]);break;default:t.setAttribute(e[l],r[l])}},t.createMarkupAreaNode=function(t){var e,r=yt.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=yt.createSvgElement("rect");break;case"MarkupPolygonalNode":e=yt.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:i.setAttribute(e[n],r[n])}},t.createMarkupPalletRack=function(){return yt.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"stroke":n.setAttribute(e[a],r[a]);break;case"fill":i.setAttribute(e[a],r[a]);break;case"rack-data":yt.removeAllChildren(i),yt.removeAllChildren(n);var o=r[a].split(" "),s=parseInt(o[0]),l=parseInt(o[1]),u=parseFloat(o[2]),c=parseFloat(o[3]),h=parseFloat(o[4]),d=void 0,p=void 0,f=void 0;s>1&&(d=parseFloat(o[5]),p=parseFloat(o[6]),f=c+d);var m=yt.createSvgElement("rect");if(m.setAttribute("width",u.toString()),m.setAttribute("height",c.toString()),i.appendChild(m),s>1){var g=yt.createSvgElement("rect");g.setAttribute("width",u.toString()),g.setAttribute("height",p.toString()),g.setAttribute("transform","translate( 0 "+f+")"),i.appendChild(g)}for(var b=h,v=0;v<l-1;v++){var y=yt.createSvgElement("line");At.setMultipleAttributes(y,["x1","x2","y1","y2"],[b,b,"0",c]),n.appendChild(y),b+=h}if(s>1){var A=f+p;b=h;for(v=0;v<l-1;v++){y=yt.createSvgElement("line");At.setMultipleAttributes(y,["x1","x2","y1","y2"],[b,b,f,A]),n.appendChild(y),b+=h}}break;default:t.setAttribute(e[a],r[a])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),Nt=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=yt.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=yt.createSvgElement("path");break;case"MarkupCircularWall":r=yt.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=yt.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupTargetLine=function(){return yt.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=yt.findChildOfType(e,"polyline"),a=yt.findChildOfType(e,"serif-start"),o=yt.findChildOfType(e,"serif-end"),s=0;s<r.length;s++)switch(r[s]){case"color":e.setAttribute("stroke",i[s]);break;case"points":n.setAttribute(r[s],i[s]);var l=i[s].split(" "),u=l.length;l[u-1].includes(",")||u--,t.setSerif(l[0],l[1],a),t.setSerif(l[u-1],l[u-2],o);break;default:e.setAttribute(r[s],i[s])}},t.createMarkupPathway=function(){return yt.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=yt.findChildOfType(t,"polygon"),n=yt.findChildOfType(t,"polyline"),a=yt.findChildOfType(t,"ties"),o=0;o<e.length;o++)switch(e[o]){case"color":a.setAttribute("stroke",r[o]);break;case"points":var s=r[o].split(" "),l="",u="",c="";yt.removeAllChildren(a);for(var h=0;h<s.length;h++){var d=At.splitToFloats(s[h],",");if(4==d.length){l+=d[0]+","+d[1]+" ",u=d[2]+","+d[3]+" "+u,c+=(d[0]+d[2])/2+","+(d[1]+d[3])/2+" ";var p=yt.createSvgElement("line");At.setMultipleAttributes(p,["x1","y1","x2","y2"],[d[0],d[1],d[2],d[3]]),a.appendChild(p)}}i.setAttribute("points",l+u),n.setAttribute("points",c);break;default:t.setAttribute(e[o],r[o])}},t.createMarkupPedFlowStatistics=function(){return yt.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=yt.findChildOfType(t,"line"),n=yt.findChildOfType(t,"serif-end"),a=yt.findChildOfType(t,"direction"),o=yt.findChildOfType(t,"arrow-right"),s=yt.findChildOfType(t,"arrow-left"),l=0;l<e.length;l++)switch(e[l]){case"color":t.setAttribute("stroke",r[l]);break;case"length":i.setAttribute("x2",r[l]),n.setAttribute("x1",r[l]),n.setAttribute("x2",r[l]);var u=parseInt(r[l])/2;a.setAttribute("x1",u.toString()),a.setAttribute("x2",u.toString()),o.setAttribute("transform","translate("+u+" 13) rotate(90)"),s.setAttribute("transform","translate("+u+" -13) rotate(-90)");break;case"direction":switch(o.setAttribute("visibility","inherit"),s.setAttribute("visibility","inherit"),r[l]){case"right":s.setAttribute("visibility","hidden");break;case"left":o.setAttribute("visibility","hidden")}break;default:t.setAttribute(e[l],r[l])}},t.createMarkupServiceWithLines=function(){return yt.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=yt.findChildOfType(e,"queues"),a=yt.findChildOfType(e,"services"),o=yt.findChildOfType(e,"reverse-queues"),s=yt.findChildOfType(e,"area"),l=0;l<r.length;l++)switch(r[l]){case"queue-color":n.setAttribute("stroke",i[l]);break;case"reverse-queue-color":o.setAttribute("stroke",i[l]);break;case"service-color":a.setAttribute("stroke",i[l]);break;case"clear-all-queues":yt.removeAllChildren(n),yt.removeAllChildren(o);break;case"queue":t.addQueue(n,i[l]);break;case"reverse-queue":t.addQueue(o,i[l]);break;case"clear-services":yt.removeAllChildren(a);break;case"service":t.addService(a,i[l]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":s.setAttribute(r[l],i[l]);break;default:e.setAttribute(r[l],i[l])}},t.createMarkupServiceWithArea=function(){return yt.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=yt.findChildOfType(e,"services"),a=0;a<r.length;a++)switch(r[a]){case"service-color":n.setAttribute("stroke",i[a]);break;case"clear-services":yt.removeAllChildren(n);break;case"service":t.addService(n,i[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"transform":case"points":break;default:e.setAttribute(r[a],i[a])}},t.createMarkupEscalatorGroup=function(){return yt.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=yt.findChildOfType(t,"background"),n=yt.findChildOfType(t,"escalators"),a=0;a<e.length;a++)switch(e[a]){case"balustrade-color":i.setAttribute("fill",r[a]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[a]?"inherit":"hidden");break;case"dimensions-completed":var o=At.getIntAttribute(t,"number-of-escalators"),s=At.getFloatAttribute(t,"width"),l=At.getFloatAttribute(t,"length"),u=At.getFloatAttribute(t,"left-balustrade-width"),c=At.getFloatAttribute(t,"right-balustrade-width"),h=At.getFloatAttribute(t,"internal-balustrade-width"),d=At.getFloatAttribute(t,"lower-landing-length"),p=u+c+o*s+(o-1)*h,f=d+l+At.getFloatAttribute(t,"upper-landing-length");At.setMultipleAttributes(i,["y","width","height"],[-u,f,p]);for(var m=0;m<o;m++){var g=m*(s+h),b=yt.cloneElementWithId("escalator"),v=yt.findChildOfType(b,"background");At.setMultipleAttributes(v,["y","width","height"],[g,f,s]);var y=yt.findChildOfType(b,"handrail-left"),A=yt.findChildOfType(b,"handrail-right");At.setMultipleAttributes(y,["x2","y1","y2"],[f,g,g]),At.setMultipleAttributes(A,["x2","y1","y2"],[f,g+s,g+s]);var T=yt.findChildOfType(b,"lower-landing-end"),C=yt.findChildOfType(b,"upper-landing-end");At.setMultipleAttributes(T,["x1","x2","y1","y2"],[d,d,g,g+s]),At.setMultipleAttributes(C,["x1","x2","y1","y2"],[d+l,d+l,g,g+s]);var S=yt.findChildOfType(b,"stairs");At.setMultipleAttributes(S,["x1","x2","y1","y2","stroke-width"],[d,d+l,g+s/2,g+s/2,s]),n.appendChild(b)}break;case"offsets":var E=At.splitToFloats(r[a]," "),w=yt.childElements(n);for(m=0;m<w.length;m++)yt.findChildOfType(w[m],"stairs").setAttribute("stroke-dashoffset",(-E[m]).toString());break;default:t.setAttribute(e[a],r[a])}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(n[0])-a,l=parseFloat(n[1])-o,u=Math.hypot(s,l),c=3*l/u,h=3*s/u;At.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+c,a-c,o-h,o+h])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(At.getSubAttribute(i,"x")),a=parseFloat(At.getSubAttribute(i,"y")),o=At.radiansToDegrees(parseFloat(At.getSubAttribute(i,"orientation")));if("point"==At.getSubAttribute(i,"type")){(r=yt.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+a+")");var s=yt.createUseElement("arrowhead-small");s.setAttribute("transform","translate("+(n-11)+" "+a+") rotate("+o+" 11 0)"),t.appendChild(s)}else{(r=yt.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+a+") rotate("+o+")");var l=r.firstElementChild.nextElementSibling,u=parseFloat(At.getSubAttribute(i,"length"));if(l.setAttribute("x2",u),"true"==At.getSubAttribute(i,"bidirectional")){var c=r.lastElementChild;c.setAttribute("visibility","inherit"),c.setAttribute("transform","translate("+(u+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=At.splitSkipEmpty(e,"|"),i=At.getSubAttribute(r,"queue-path"),n=yt.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),At.addPathArrows(n,"arrowhead-small",.7,t,50,100);var a=At.getSubAttribute(r,"fence-color");if(a)for(var o=[At.getSubAttribute(r,"fence-path-left"),At.getSubAttribute(r,"fence-path-right")],s=0;s<o.length;s++){var l=yt.createSvgElement("path");At.setMultipleAttributes(l,["d","stroke","stroke-width","stroke-dasharray"],[o[s],a,"2","none"]),t.appendChild(l)}},t}(),Bt=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return yt.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return yt.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i])},t}(),Gt=function(){function t(){}return t.createMarkupIntersection=function(){return yt.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=yt.findChildOfType(t,"lane-connectors"),a=0;a<e.length;a++)switch(e[a]){case"fill":case"d":i.setAttribute(e[a],r[a]);break;case"lane-connector":var o=yt.createSvgElement("g"),s=yt.createSvgElement("path");s.setAttribute("d",r[a]),o.appendChild(s),At.addPathArrows(s,"arrowhead-tiny",.5,o,20,40),n.appendChild(o);break;case"lane-connector-colors":for(var l=At.splitSkipEmpty(r[a]," "),u=yt.childElements(n),c=0;c<u.length;c++)u[c].setAttribute("stroke",l[c]);break;default:t.setAttribute(e[a],r[a])}},t.createMarkupRoad=function(){return yt.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=yt.findChildOfType(e,"lanes"),a=yt.findChildOfType(e,"delimiters"),o=yt.findChildOfType(e,"median"),s=0;s<r.length;s++)switch(r[s]){case"lane-width":n.setAttribute("stroke-width",i[s]);break;case"lane-color":n.setAttribute("stroke",i[s]);break;case"forward-lane":case"backward-lane":var l=yt.createSvgElement("path");l.setAttribute("d",i[s]),n.appendChild(l);break;case"lane-delimiter-color":a.setAttribute("stroke",i[s]);break;case"lane-delimiter-width":case"lane-delimiter-style":a.setAttribute(r[s],i[s]);break;case"lane-delimiter":var u=At.getFloatAttribute(a,"lane-delimiter-width"),c=a.getAttribute("lane-delimiter-style");t.addDelimiter(a,u,c,i[s],n.getAttribute("stroke"));break;case"median-color":o.setAttribute("stroke",i[s]);break;case"median-width":case"median-style":o.setAttribute(r[s],i[s]);break;case"median":u=At.getFloatAttribute(o,"median-width"),c=o.getAttribute("median-style"),t.addDelimiter(o,u,c,i[s],n.getAttribute("stroke"));break;default:e.setAttribute(r[s],i[s])}},t.addDelimiter=function(t,e,r,i,n){var a=r.includes("DASHED"),o=r.includes("DOUBLE"),s=yt.createSvgElement("path");if(s.setAttribute("d",i),s.setAttribute("stroke-width",(o?3*e:e).toString()),a&&s.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(s),o){var l=yt.createSvgElement("path");At.setMultipleAttributes(l,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(l)}},t.createMarkupStopLine=function(){return yt.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:t.setAttribute(e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return yt.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:t.setAttribute(e[a],r[a])}},t}(),Ut=function(){function t(e){this.serverFPS=t.MAX_FPS,this.client=e,this.chart=new _t(this),this.control=new Et(this),this.shapeComposite=new Tt(this),this.shapeGISMap=new Rt(this)}return t.prototype.start=function(){this.frameDrawStartTime=Date.now(),this.catchingUp=!1,this.frameCount=0,this.fpsMeasureStartTime=null,this.actualFPS=0,this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.fullFrame=!1,this.packetFPS=t.MAX_FPS,this.desiredFPS=t.MAX_FPS,this.frameBuffer=[],this.sleepTimeStatistics=new Array(t.SLEEP_TIME_STATISTICS_SIZE),this.sleepTimeStatistics.fill(1e3/t.MAX_FPS),this.startMeasureInterval(),this.startFrameDrawingTimeout(this.desiredFPS)},t.prototype.stop=function(){this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.frameBuffer=[],this.stopMeasureInterval(),this.stopFrameDrawingTimeout()},t.prototype.startMeasureInterval=function(){var t=this;this.fpsMeasureIntervalId=setInterval(function(){return t.measureFPS()},1e3)},t.prototype.stopMeasureInterval=function(){this.fpsMeasureIntervalId&&(clearInterval(this.fpsMeasureIntervalId),this.fpsMeasureIntervalId=void 0)},t.prototype.startFrameDrawingTimeout=function(t){var e=this;this.frameDrawingTimeoutId=setTimeout(function(){var t=Date.now();e.drawFrame();var r=1e3/e.desiredFPS-(Date.now()-t);r<0&&(r=0),e.sleepTimeStatistics.push(r),e.sleepTimeStatistics.shift(),e.startFrameDrawingTimeout(r)},t)},t.prototype.stopFrameDrawingTimeout=function(){this.frameDrawingTimeoutId&&(clearTimeout(this.frameDrawingTimeoutId),this.frameDrawingTimeoutId=void 0)},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.totalFrameCount=function(){var t=this.frameBuffer.length;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.findOrRequestFullFrame=function(){if(this.fullFrame)console.log("Found a full frame in the local buffer, starting from there");else{for(var t=0;t<this.packetBuffer.length;t++){if(this.packetBuffer[t].fullFrame)return console.log("Found a full frame in the local buffer, starting from there"),void this.packetBuffer.splice(0,t)}this.packetBuffer=[],console.log("Cleared local frame buffer, requesting full frame from the server"),this.client.network.requestAndWaitFullFrame()}},t.prototype.switchToNextFrame=function(){if(0==this.frameBuffer.length){if(0==this.packetBuffer.length)return this.fullFrame=!1,this.packetFPS=t.MAX_FPS,void(this.desiredFPS=t.MAX_FPS);var e=this.packetBuffer.shift();this.frameBuffer=e.frames,this.fullFrame=e.fullFrame,this.packetFPS=e.fps,this.desiredFPS=e.fps,this.updateServerFpsIfNeeded()}return this.frameBuffer.shift()},t.prototype.updateServerFpsIfNeeded=function(){var e=this.actualFPS/this.packetFPS,r=this.measureSleepTime();if(e>=.9&&r>50&&this.serverFPS<t.MAX_FPS)return this.serverFPS++,void this.client.network.postMaxFPS(this.serverFPS);e<.9&&r<50&&this.serverFPS>1&&(this.serverFPS--,e<.7&&this.serverFPS>1&&this.serverFPS--,e<.6&&this.serverFPS>1&&this.serverFPS--,this.client.network.postMaxFPS(this.serverFPS))},t.prototype.measureSleepTime=function(){for(var t=0,e=0;e<this.sleepTimeStatistics.length;e++)t+=this.sleepTimeStatistics[e];return t/=this.sleepTimeStatistics.length},t.prototype.drawFrame=function(){var e=this.switchToNextFrame();if(e){this.client.updateExperimentState(e),this.fullFrame&&(this.fullFrame=!1,yt.removeAllChildren(this.client.presentation)),this.frameDrawStartTime=Date.now(),this.client.svg.suspendRedraw(5e3),this.time=e.time;var r,i,n,a=e.commands;if(a.length>0&&"white"!=this.client.svg.style.backgroundColor&&(this.client.svg.style.backgroundColor="white"),jt.DEBUG_MODE){var o=this.totalFrameCount();this.client.debugger.timeInfo.innerHTML=At.formatNumber(this.time,2),this.client.debugger.serverQueueInfo.innerHTML=this.client.network.serverQueue,this.client.debugger.browserQueueInfo.innerHTML=o+":"+this.client.network.packetManager.totalFrameCount(),r=0,i=0,n=0}for(var s=0;s<a.length;s++){var l=a[s],u=void 0,c=l.groupId,h=l.att,d=l.val,p=void 0;switch(l.cmd){case"C":if(p=this.createShape(l.type,l.id),null==c)this.client.presentation.appendChild(p);else{if(null==(u=document.getElementById(c)))return console.log("Can't find container to add a shape to, container id = "+c,l),void this.findOrRequestFullFrame();if("ShapeGISMap"==u.getAttribute("type")){var f=yt.findChildOfType(u,"map").firstElementChild;u=l.type.startsWith("MarkupGIS")?yt.findChildOfType(f,"markup"):yt.findChildOfType(f,"agents")}u.appendChild(p)}this.updateShape(p,h,d),r++;break;case"U":if(null==(p=document.getElementById(l.id)))return console.log("Can't find shape to be updated, shape id = "+l.id,l),void this.findOrRequestFullFrame();this.updateShape(p,h,d),i++;break;case"D":if(null==(p=document.getElementById(l.id)))return console.log("Can't find shape to be deleted, shape id = "+l.id,l),void this.findOrRequestFullFrame();yt.removeElement(p.parentNode,p),n++;break;case"S":this.applySettings(h,d);break;case"N":this.applyNavigation(h,d);break;case"M":t.showMessage(h,d);break;case"W":t.openURL(h,d);break;default:return void this.client.stopAndAlert("Unknown command: "+l.cmd,null)}}this.client.svg.unsuspendRedrawAll(),this.frameCount++,jt.DEBUG_MODE&&(this.client.debugger.cudCountInfo.innerHTML=r+"/"+i+"/"+n,this.client.debugger.drawTimeInfo.innerHTML=Date.now()-this.frameDrawStartTime,this.client.debugger.shapeCountInfo.innerHTML=vt.elementcount),!this.catchingUp&&this.packetBuffer.length>1?(this.catchingUp=!0,this.desiredFPS=1e3/this.packetFPS*.8):this.catchingUp&&(this.catchingUp=!1,this.desiredFPS=1e3/this.packetFPS)}},t.prototype.createShape=function(t,e){var r;if(yt.isPrimitiveSVGElement(t))r=yt.createSvgElement(t);else switch(t){case"ShapeArc":r=Tt.createShapeArc();break;case"ShapeText":r=Tt.createShapeText();break;case"ShapeImage":r=Tt.createShapeImage();break;case"ShapeCanvas":r=Tt.createShapeCanvas(e);break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=Dt.createMarkupPath(t,e);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=Dt.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=Dt.createMarkupPalletRack();break;case"MarkupRailwaySwitch":r=Bt.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=Bt.createMarkupPositionOnTrack();break;case"MarkupPipe":r=Ft.createMarkupPipe(e);break;case"MarkupStorageTank":r=Ft.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=Ft.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=Nt.createMarkupWall(t,e);break;case"MarkupTargetLine":r=Nt.createMarkupTargetLine();break;case"MarkupPathway":r=Nt.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=Nt.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=Nt.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=Nt.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=Nt.createMarkupEscalatorGroup();break;case"MarkupIntersection":r=Gt.createMarkupIntersection();break;case"MarkupRoad":r=Gt.createMarkupRoad();break;case"MarkupStopLine":r=Gt.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=Gt.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=Pt.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=_t.create();break;case"Window3D":r=Ct.create();break;default:return this.client.stopAndAlert("Can't create: unknown object type: "+t,void 0),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(t,e,r){var i=t.getAttribute("type");if(yt.isPrimitiveSVGElement(i))for(var n=0;n<e.length;n++)if("href"==e[n])t.setAttributeNS(yt.xlinkns,"href",r[n]);else if("href-path"==e[n])t.setAttributeNS(yt.xlinkns,"href",this.client.network.getJarResourceURL(r[n]));else if("geo"==e[n]){var a=r[n].split("|");t.setAttribute("lon",a[0]),t.setAttribute("lat",a[1]),t.setAttribute("heading",a[2]),Rt.updateGISObjectPosition(t)}else t.setAttribute(e[n],r[n]);else switch(i){case"ShapeArc":Tt.updateShapeArc(t,e,r);break;case"ShapeText":Tt.updateShapeText(t,e,r);break;case"ShapeImage":this.shapeComposite.updateShapeImage(t,e,r);break;case"ShapeCanvas":Tt.updateShapeCanvas(t,e,r);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(t,e,r);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(t,e,r);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":Dt.updateMarkupPath(t,e,r);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":Dt.updateMarkupAreaNode(t,e,r);break;case"MarkupPalletRack":Dt.updateMarkupPalletRack(t,e,r);break;case"MarkupRailwaySwitch":Bt.updateMarkupRailwaySwitch(t,e,r);break;case"MarkupPositionOnTrack":Bt.updateMarkupPositionOnTrack(t,e,r);break;case"MarkupPipe":Ft.updateMarkupPipe(t,e,r);break;case"MarkupStorageTank":Ft.updateMarkupStorageTank(t,e,r);break;case"MarkupBulkConveyorBelt":Ft.updateMarkupBulkConveyorBelt(t,e,r);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":Nt.updateMarkupWall(t,e,r);break;case"MarkupTargetLine":Nt.updateMarkupTargetLine(t,e,r);break;case"MarkupPathway":Nt.updateMarkupPathway(t,e,r);break;case"MarkupPedFlowStatistics":Nt.updateMarkupPedFlowStatistics(t,e,r);break;case"MarkupServiceWithLines":Nt.updateMarkupServiceWithLines(t,e,r);break;case"MarkupServiceWithArea":Nt.updateMarkupServiceWithArea(t,e,r);break;case"MarkupEscalatorGroup":Nt.updateMarkupEscalatorGroup(t,e,r);break;case"MarkupIntersection":Gt.updateMarkupIntersection(t,e,r);break;case"MarkupRoad":Gt.updateMarkupRoad(t,e,r);break;case"MarkupStopLine":Gt.updateMarkupStopLine(t,e,r);break;case"MarkupBusStop":case"MarkupParkingLot":Gt.updateMarkupBusStopOrParkingLot(t,e,r);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":Pt.updateGISMarkup(t,e,r);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(t,e,r);break;case"Window3D":Ct.update(t,e,r)}},t.prototype.measureFPS=function(){var t=Date.now();null!=this.fpsMeasureStartTime&&(this.actualFPS=Math.round(1e3*this.frameCount/(t-this.fpsMeasureStartTime))),jt.DEBUG_MODE&&(this.client.debugger.fpsInfo.innerHTML=this.actualFPS+":"+this.packetFPS),this.fpsMeasureStartTime=t,this.frameCount=0},t.prototype.onControlAction=function(t,e){this.client.network.postUserAction(t,e)},t.prototype.onUserClick=function(t,e,r){yt.isContainedInElementOfType(t,Et.controlTypes)||yt.isContainedInElementOfType(t,_t.chartTypes)||yt.isContainedInElementOfType(t,["Window3D"])||yt.isContainedInElementOfType(t,["ShapeGISMap"])||this.client.network.postUserAction(0,e+" "+r)},t.prototype.applySettings=function(t,e){for(var r=0;r<t.length;r++)this.modelSettings[At.hyphenToCameLCase(t[r])]=e[r];this.modelSettings.startTime=parseInt(this.modelSettings.startTime),this.modelSettings.startDate=parseInt(this.modelSettings.startDate),this.modelSettings.stopTime&&(this.modelSettings.stopTime=parseInt(this.modelSettings.startTime),this.modelSettings.stopDate=parseInt(this.modelSettings.startDate))},t.prototype.applyNavigation=function(t,e){for(var r=0;r<t.length;r++)this.navigationSettings[At.hyphenToCameLCase(t[r])]=e[r];this.navigationSettings.x=parseFloat(this.navigationSettings.x),this.navigationSettings.y=parseFloat(this.navigationSettings.y),this.navigationSettings.width=parseFloat(this.navigationSettings.width),this.navigationSettings.height=parseFloat(this.navigationSettings.height),this.navigationSettings.zoomAndPanningEnabled="true"==this.navigationSettings.zoomAndPanningEnabled,this.client.setNavigationSettings(this.navigationSettings.width,this.navigationSettings.height),this.client.navigation.applyNavigationSettings()},t.showMessage=function(t,e){for(var r={},i=0;i<t.length;i++)r[At.hyphenToCameLCase(t[i])]=e[i];var n=document.getElementById("svg-message-background"),a=document.getElementById("svg-message-box-title"),o=document.getElementById("svg-message-box-text"),s=document.getElementById("svg-message-box-icon-info"),l=document.getElementById("svg-message-box-icon-error");a.innerText=r.title,o.innerHTML=r.text.replace(/\n/g,"<br>"),r.type.startsWith("error")?(s.style.display="none",l.style.removeProperty("display"),a.classList.remove("svg-message-box-colors-info"),a.classList.add("svg-message-box-colors-error"),""==r.title&&(a.innerHTML="Error")):(s.style.removeProperty("display"),l.style.display="none",a.classList.remove("svg-message-box-colors-error"),a.classList.add("svg-message-box-colors-info"),""==r.title&&(a.innerHTML="Message")),n.style.removeProperty("display")},t.openURL=function(e,r){var i=r[0];i.startsWith("http://")&&i.startsWith("https://")||(i="http://"+i);var n=["message","Open URL","The model asks you to open an external URL:<br><a href="+i+" target = '_blank' onclick = 'document.getElementById( \"svg-message-background\" ).style.display = \"none\"'>"+i+"</a><br><br>The URL will open in a new window"];t.showMessage(["type","title","text"],n)},t.SLEEP_TIME_STATISTICS_SIZE=20,t.MAX_FPS=20,t}(),Ht=function(){function t(t,e,r){var i=this;this.networkManager=t,this.startTime=Date.now(),this.xhttp=this.networkManager.getAnimationPacket(e,function(){i.stopTime=Date.now(),r(i)})}return t.prototype.requestTime=function(){return this.stopTime?this.stopTime-this.startTime:Date.now()-this.startTime},t.prototype.abort=function(){this.xhttp.abort()},t}(),zt=function(){function t(t){this.paused=!1,this.networkManager=t}return t.prototype.start=function(){this.fullFrame=!0,this.activeRequests=[],this.responseTimeStatistics=new Array(t.REQUEST_STATISTICS_SIZE),this.responseTimeStatistics.fill(Vt.MIN_REQUEST_INTERVAL),this.requestInterval=Vt.MIN_REQUEST_INTERVAL,this.lastRequestTime=0,this.createRequest(),this.startRequestTimeout()},t.prototype.stop=function(){this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.pause=function(){this.paused=!0,this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.requestFullFrame=function(){console.debug(">> SVG: Request full frame."),this.fullFrame=!0},t.prototype.startRequestTimeout=function(){var t=this;this.requestTimeoutId=setTimeout(function(){t.processRequestTimeout()},this.requestInterval)},t.prototype.processRequestTimeout=function(){this.requestTimeoutId=void 0,this.activeRequests.length<Vt.MAX_REQUEST_COUNT&&(this.createRequest(),this.startRequestTimeout())},t.prototype.createRequest=function(){var t=this,e=new Ht(this.networkManager,this.fullFrame,function(e){return t.processResponse(e)});this.fullFrame=!1,this.activeRequests.push(e),this.lastRequestTime=Date.now()},t.prototype.processResponse=function(t){var e=this.activeRequests.indexOf(t);if(this.activeRequests.splice(e,1),this.addToResponseTimeStatistics(t.requestTime()),void 0!==this.requestTimeoutId||this.paused||(this.createRequest(),this.startRequestTimeout()),4==t.xhttp.readyState&&200==t.xhttp.status){var r=JSON.parse(t.xhttp.responseText);this.networkManager.packetManager.addPacket(r)}},t.prototype.addToResponseTimeStatistics=function(t){this.responseTimeStatistics.push(t),this.responseTimeStatistics.shift(),this.requestInterval=this.calculateRequestInterval(),this.networkManager.RPS=1e3/this.requestInterval},t.prototype.calculateRequestInterval=function(){if(0===this.responseTimeStatistics.length)return Vt.MIN_REQUEST_INTERVAL;for(var t=0,e=0;e<this.responseTimeStatistics.length;e++)t+=this.responseTimeStatistics[e];var r=t/this.responseTimeStatistics.length*.5;return r<Vt.MIN_REQUEST_INTERVAL?Vt.MIN_REQUEST_INTERVAL:r>Vt.MAX_REQUEST_INTERVAL?Vt.MAX_REQUEST_INTERVAL:r},t.REQUEST_STATISTICS_SIZE=10,t}(),Wt=function(){function t(t){this.client=t,this.reset()}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.waitingFullFrame=!1,this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.pause=function(){this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.addPacket=function(t){if(t){var e=t.frames;if(e&&0!==e.length){var r=e[0];if(!(r.number<this.expectedFrameNumber)){if(r.number===this.expectedFrameNumber||t.fullFrame){this.client.network.serverQueue=t.serverQueue;var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),this.cancelWaitExpectedFrameTimeoutIfNeeded(),void(t.fullFrame&&(this.waitingFullFrame=!1))}this.insertToPacketBuffer(t),console.debug(">> SVG: Reordering  or packet loss expectedFrame=",this.expectedFrameNumber),this.startWaitExpectedFrameTimeoutIfNeeded()}}}},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length&&!(this.packetBuffer[0].frames[0].number>=this.expectedFrameNumber)){var t=this.packetBuffer[this.packetBuffer.length-1];if(t.frames[t.frames.length-1].number>=this.expectedFrameNumber)this.packetBuffer=[];else{for(var e=0;e<this.packetBuffer.length&&!(this.packetBuffer[e].frames[0].number>=this.expectedFrameNumber);e++);this.packetBuffer.splice(0,e)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length&&this.packetBuffer[0].frames[0].number===this.expectedFrameNumber){for(var t=this.expectedFrameNumber,e=0;e<this.packetBuffer.length;e++){var r=this.packetBuffer[e].frames;if(r[0].number!==t)break;t=r[r.length-1].number+1}var i=this.packetBuffer.splice(0,e);this.client.frameDrawing.addAllPackets(i),this.expectedFrameNumber=t}},t.prototype.cancelWaitExpectedFrameTimeoutIfNeeded=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startWaitExpectedFrameTimeoutIfNeeded=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,t.client.network.requestFullFrame()},4*this.client.network.RPS*1e3))},t.prototype.waitFullFrame=function(){console.debug(">> SVG: Wait full frame."),this.waitingFullFrame=!0,this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t}(),Vt=function(){function t(t){this.client=t,this.packetRequester=new zt(this),this.packetManager=new Wt(t)}return t.prototype.start=function(){this.packetManager.reset(),this.packetRequester.start()},t.prototype.stop=function(){this.packetRequester.stop(),this.packetManager.reset()},t.prototype.pause=function(){this.paused=!0,this.packetRequester.pause()},t.prototype.getAnimationPacket=function(t,e){if(!this.paused){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},jt.DEBUG_SPARK_LOCAL?r.open("GET","/http/update?fullFrame="+t+"&time="+Date.now(),!0):r.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+Date.now(),!0),r.send(),r}},t.prototype.postUserAction=function(t,e){if(!this.paused){var r=new XMLHttpRequest;jt.DEBUG_SPARK_LOCAL?r.open("GET","/http/useraction?id="+t+"&value="+encodeURIComponent(e)):r.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),r.send()}},t.prototype.postUserCommand=function(t,e){if(!this.paused){var r=new XMLHttpRequest;r.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),r.send()}},t.prototype.getJarResourceURL=function(t){return this.getResourceURLWithSubpath("internal-resources",t)},t.prototype.getResourceURL=function(t){return this.getResourceURLWithSubpath("resources",t)},t.prototype.getResourceURLWithSubpath=function(t,e){if(!this.paused)return jt.DEBUG_SPARK_LOCAL?"/http/image?path="+e:this.getRestRoot()+t+"?path="+e},t.prototype.getRestRoot=function(){return this.client.svgAnimationInfo.host+"/nodes/"+this.client.svgAnimationInfo.restUrl+"sessions/"+this.client.svgAnimationInfo.sessionUuid+"/"},t.prototype.postMaxFPS=function(t){if(!this.paused){var e=new XMLHttpRequest;jt.DEBUG_SPARK_LOCAL?e.open("POST","http/max-fps"):e.open("POST",this.getRestRoot()+"max-fps"),e.send(t.toString())}},t.prototype.requestFullFrame=function(){this.packetRequester.requestFullFrame()},t.prototype.requestAndWaitFullFrame=function(){this.packetRequester.requestFullFrame(),this.packetManager.waitFullFrame()},t.MIN_REQUEST_INTERVAL=500,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_REQUEST_COUNT=2,t}(),Yt=function(){function t(e){var r=this;this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDebugContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDebugContainer.parentElement,this.controlPanel=document.getElementById("control-panel"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDebugTools=document.getElementById("control-panel-button-dev-panel"),this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpInfoState=document.getElementById("control-panel-info-state"),t.assignActionOnClick(this.cpButtonRun,function(){return r.client.network.postUserCommand("run","")}),t.assignActionOnClick(this.cpButtonPause,function(){return r.client.network.postUserCommand("pause","")}),t.assignActionOnClick(this.cpButtonX1,function(){return r.setSpeed(1)}),t.assignActionOnClick(this.cpButtonSlower,function(){return r.speedUpOrDown(!1)}),t.assignActionOnClick(this.cpButtonFaster,function(){return r.speedUpOrDown(!0)}),t.assignActionOnClick(this.cpButtonVirtual,function(){return r.setSpeed(1/0)}),this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},t.assignActionOnClick(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),w.addFullScreenListener(function(){return r.onFullScreenChange()}),this.cpButtonDebugTools.style.display="none"}return t.prototype.updateExperimentState=function(){this.updateInfoState(),this.updateModelTimeScale(),this.updateRunGroup(),this.updateSpeedGroup()},t.prototype.updateModelTimeScale=function(){this.cpInfoScale.innerText=t.timeScaleToString(this.client.getModelTimeScale())},t.prototype.updateExperimentProgress=function(){var t=this.client.getModelProgress(),e=this.progressBar.firstElementChild,r=100*t;this.progressBar.style.width=t<=0?"0":r+"%",e.innerText=t<0?"progress n/a":Math.round(r)+"%"},t.prototype.updateInfoState=function(){var e=this.client.getModelState(),r=t.modelStateToString(e);this.cpInfoState.innerText=t.modelStateToString(r),this.indicateCpErrorState("ERROR"==e)},t.prototype.indicateCpErrorState=function(t){t?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getModelState()&&this.indicateCpErrorState(!1)},t.prototype.updateRunGroup=function(){var e=this.client.getModelState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e;t.setVisible(this.cpButtonRun,!r),this.setEnabled(this.cpButtonRun,!r&&i),t.setVisible(this.cpButtonPause,r),this.setEnabled(this.cpButtonPause,r)},t.prototype.updateSpeedGroup=function(){var e=this.client.getModelState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e,i=t.stringToTimeScale(this.cpInfoScale.innerText);this.setEnabled(this.cpButtonX1,r&&1!=i),this.setEnabled(this.cpButtonSlower,r&&i>t.speeds[0]),this.setEnabled(this.cpButtonFaster,r&&i!=1/0),this.setEnabled(this.cpButtonVirtual,r&&i!=1/0)},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=f.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r)},t.prototype.setSpeed=function(e){this.cpInfoScale.innerText=t.timeScaleToString(e),this.client.network.postUserCommand("setspeed",e.toString()),this.updateSpeedGroup()},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=w.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed"))},t.prototype.toggleFullScreen=function(){w.toggleFullScreen(this.presentationContainer)},t.modelStateToString=function(t){switch(t){case"INITIALIZE":return"Initializing...";case"IDLE":return"Idle";case"RUNNING":return"Running";case"PAUSED":return"Paused";case"FINISHED":return"Finished.";case"ERROR":return"Error!";case"PLEASE_WAIT":return"Please Wait..."}return t},t.timeScaleToString=function(t){return t<0||t==1/0?"Virtual":t>=1?"x"+t:"x1/"+1/t},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.setVisible=function(t,e){e?t.style.removeProperty("display"):t.style.display="none"},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.assignActionOnClick=function(e,r){e.onclick=function(){t.isEnabled(e)&&r()}},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t}(),jt=function(){function t(){this.windowAdjusted=!1,this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new Ut(this),this.navigation=new Lt(this),this.network=new Vt(this),this.controlPanel=new Yt(this)}return t.prototype.start=function(t){this.svgAnimationInfo=t,this.svg.style.pointerEvents="auto",this.navigation.initSVGNavigation(),this.network.start(),this.frameDrawing.start()},t.prototype.stop=function(t){t?(this.modelState=t.type,this.controlPanel.updateExperimentState()):this.modelState=void 0,this.frameDrawing.stop(),this.navigation.clearSVGNavigation(),this.network.stop(),this.onToggleFullScreen=void 0,this.onResize=void 0,this.onStop=void 0,this.windowAdjusted=!1,yt.removeAllChildren(this.presentation)},t.prototype.setCallback=function(t,e){switch(t){case"ontogglefullscreen":this.onToggleFullScreen=e;break;case"onstop":this.onStop=e;break;case"onresize":this.onResize=e}},t.prototype.pause=function(){this.network.pause()},t.prototype.stopAndAlert=function(t,e){this.frameDrawing.stop(),console.log(t),e&&console.log(e)},t.prototype.updateViewArea=function(){this.navigation.applyNavigationSettings()},t.prototype.updateExperimentState=function(t){t.state!=this.modelState&&(this.modelState=t.state,this.controlPanel.updateExperimentState()),t.progress!=this.modelProgress&&(this.modelProgress=t.progress,this.controlPanel.updateExperimentProgress()),t.time!=this.modelTime&&(this.modelTime=t.time),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.controlPanel.updateModelTimeScale())},t.prototype.getModelTime=function(){},t.prototype.getModelState=function(){},t.prototype.getModelTimeScale=function(){},t.prototype.getModelProgress=function(){},t.prototype.setNavigationSettings=function(t,e){var r=this;!this.windowAdjusted&&this.onResize&&(this.onResize(t,e+50,function(){r.navigation.applyNavigationSettings()}),this.windowAdjusted=!0)},t.DEBUG_MODE=!1,t.DEBUG_SPARK_LOCAL=!1,t}(),Xt=function(){function t(){}return t.createClient=function(){return new jt},t.createDebugger=function(){return new vt(new jt)},t}(),qt=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(e){var r=this;bf.DEBUG_MODE=!0,bf.DEBUG_SPARK_LOCAL=e,this.client.debugger=this,this.serverQueueInfo=document.getElementById("dev-panel-info-server-queue"),this.browserQueueInfo=document.getElementById("dev-panel-info-browser-queue"),this.parseTimeInfo=document.getElementById("dev-panel-info-parse-time"),this.shapeCountInfo=document.getElementById("dev-panel-info-shape-count"),this.cudCountInfo=document.getElementById("dev-panel-info-cud-count"),this.drawTimeInfo=document.getElementById("dev-panel-info-draw-time"),this.fpsInfo=document.getElementById("dev-panel-info-fps"),this.timeInfo=document.getElementById("dev-panel-info-time"),e&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return r.onNewModelSelected()}),t.elementcount=0},t.prototype.stop=function(){this.serverQueueInfo=void 0,this.browserQueueInfo=void 0,this.parseTimeInfo=void 0,this.shapeCountInfo=void 0,this.cudCountInfo=void 0,this.drawTimeInfo=void 0,this.fpsInfo=void 0,this.timeInfo=void 0,this.modelSelector&&(this.modelSelector.onchange=void 0,this.modelSelector=void 0),t.elementcount=0},t.prototype.onNewModelSelected=function(){var e=this;if(null!=this.client.svg&&this.client.stop("TERMINATED"),this.shapeCountInfo.innerHTML=t.elementcount,"NO MODEL SELECTED"!=this.modelSelector.value){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&e.client.start({})},r.open("GET","/http/start?path="+this.modelSelector.value,!0),r.send()}},t}(),Zt=function(){function t(){}return t.createSvgElement=function(e){return bf.DEBUG_MODE&&qt.elementcount++,document.createElementNS(t.svgns,e)},t.createXhtmlElement=function(e){return bf.DEBUG_MODE&&qt.elementcount++,document.createElementNS(t.xhtmlns,e)},t.createTextNode=function(t){return bf.DEBUG_MODE&&qt.elementcount++,document.createTextNode(t)},t.createUseElement=function(e){var r=t.createSvgElement("use"),i="#"+e;return r.setAttributeNS(t.xlinkns,"href",i),r},t.changeUseHref=function(e,r){e.setAttributeNS(t.xlinkns,"href","#"+r)},t.cloneElementWithId=function(e){var r=document.getElementById(e);return t.cloneElement(r)},t.cloneElement=function(e){var r=e.cloneNode(!0);return r.removeAttribute("id"),bf.DEBUG_MODE&&(qt.elementcount+=1+t.childNodeDeepCount(r)),r},t.removeElement=function(e,r){for(var i=0,n=["canvas-group","canvas-group-3d"];i<n.length;i++){var a=n[i],o=document.getElementById(a);if(o)for(var s=o.children,l=s.length-1;l>=0;l--){var u=parseInt(s[l].id),c=document.getElementById(u.toString());(r==c||r.contains(c))&&(o.removeChild(s[l]),bf.DEBUG_MODE&&qt.elementcount--)}}bf.DEBUG_MODE&&(qt.elementcount-=1+t.childNodeDeepCount(r)),e.removeChild(r)},t.removeAllChildren=function(e){for(;e.lastChild;)t.removeElement(e,e.lastChild)},t.bringElementToFront=function(t){t.parentNode.appendChild(t)},t.childElements=function(t){var e=t.children;if(!e){for(var r=t.childNodes,i=[],n=0;n<r.length;n++){var a=r[n];1==a.nodeType&&i.push(a)}return i}return e},t.isPrimitiveSVGElement=function(t){return!(t.startsWith("Shape")||t.startsWith("Markup")||t.startsWith("Control")||t.startsWith("Chart")||t.startsWith("Window3D"))},t.isContainedInElementOfType=function(t,e){for(;t&&1==t.nodeType&&e.indexOf(t.getAttribute("type"))<0;)t=t.parentNode;return t&&1==t.nodeType},t.findChildOfType=function(e,r){for(var i=t.childElements(e),n=0;n<i.length;n++)if(i[n].getAttribute("type")==r)return i[n];return console.log("Child of type "+r+" not found in",e),null},t.findChildWithId=function(t,e){for(var r=t.childNodes,i=0;i<r.length;i++){var n=r[i];if(n.id==e)return n}return console.log("Child with id "+e+" not found in",t),null},t.findParentOfType=function(t,e){for(var r=t.parentNode;;){if(!r||1!=r.nodeType)return null;var i=r;if(i.getAttribute("type")==e)return i;r=i.parentNode}},t.childNodeDeepCount=function(e){var r=e.childNodes;if(!r)return 0;for(var i=r.length,n=0;n<r.length;n++)i+=t.childNodeDeepCount(r[n]);return i},t.createCanvas=function(e,r){var i=t.createXhtmlElement("canvas");return document.getElementById(r).appendChild(i),i.id=e+"canvas",i},t.xhtmlns="http://www.w3.org/1999/xhtml",t.xlinkns="http://www.w3.org/1999/xlink",t.svgns="http://www.w3.org/2000/svg",t}(),Kt=function(){function t(){}return t.offsetPage=function(t){var e=t.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+i,left:e.left+r}},t.indexInParent=function(t){var e;for(e=0;t=t.previousElementSibling;e++);return e},t.radiansToDegrees=function(t){return 360*t/(2*Math.PI)},t.modulo=function(t,e){var r=t%e;return Math.floor(r>=0?r:r+e)},t.remainderPositive=function(t,e){var r=t%e;return r>=0?r:r+e},t.formatNumber=function(t,e){if(t==-1/0)return"-Infinity";if(t==1/0)return"+Infinity";if(isNaN(t))return"NaN";var r=Math.abs(t);return r<1e-12?String(0):r>9999999999||r<.001&&0!=t?String(+t.toExponential(2)):String(+t.toFixed(2))},t.formatPercent=function(t){return+Math.round(100*t)+"%"},t.reducePrecision=function(t){return+t.toPrecision(4)},t.fixedPrecision=function(t,e){return+t.toFixed(e)},t.dateComponent=function(t,e){var r,i=t.getFullYear();switch(e){case"YYYY":return String(i);case"MMM":switch(t.getMonth()+1){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec";default:return null}case"MM":r=t.getMonth()+1;break;case"DD":r=t.getDate();break;case"HH":r=t.getHours();break;case"mm":r=t.getMinutes();break;case"ss":r=t.getSeconds()}return r<10?"0"+r:String(r)},t.formatDate=function(e,r){switch(r){case"YYYY":return t.dateComponent(e,"YYYY");case"MMMYYYY":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"YYYY");case"DDMMM":return t.dateComponent(e,"MMM")+" "+t.dateComponent(e,"DD");case"DDMMHH":return t.dateComponent(e,"MM")+"/"+t.dateComponent(e,"DD")+" "+t.dateComponent(e,"HH")+":00";case"HHmm":return t.dateComponent(e,"HH")+":"+t.dateComponent(e,"mm");case"mmss":default:return t.dateComponent(e,"mm")+"'"+t.dateComponent(e,"ss")+"''"}},t.toMilliseconds=function(e,r){switch(e.modelSettings.timeUnit){case"MILLISECOND":return r*t.MILLISECOND;case"SECOND":return r*t.SECOND;case"MINUTE":return r*t.MINUTE;case"HOUR":return r*t.HOUR;case"DAY":return r*t.DAY;case"WEEK":return r*t.WEEK;case"MONTH":return r*t.MONTH;case"YEAR":return r*t.YEAR}},t.toDate=function(e,r){var i=e.modelSettings,n=r-i.startTime;return new Date(i.startDate+t.toMilliseconds(e,n))},t.date=function(e){return t.toDate(e,e.time)},t.setMultipleAttributes=function(t,e,r){for(var i=0;i<e.length;i++)t.setAttribute(e[i],r[i].toString())},t.getAttributeValue=function(t,e,r){var i=t.indexOf(r);return i<0?null:e[i]},t.removeAttribute=function(t,e,r){for(var i=0;i<t.length;i++)if(t[i]==r)return t.splice(i,1),void e.splice(i,1)},t.getSubAttribute=function(t,e){for(var r=0;r<t.length;r++){var i=t[r].split(":");if(2==i.length&&i[0]==e)return i[1]}return null},t.getFloatSubAttribute=function(e,r){var i=t.getSubAttribute(e,r);return null==i?null:parseFloat(i)},t.getIntAttribute=function(t,e){return parseInt(t.getAttribute(e))},t.getFloatAttribute=function(t,e){return parseFloat(t.getAttribute(e))},t.splitSkipEmpty=function(e,r){return e.split(r).filter(t.isEmpty)},t.isEmpty=function(t){return t.length>0},t.splitToFloats=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseFloat(i[n]);return i},t.splitToInts=function(e,r){for(var i=t.splitSkipEmpty(e,r),n=0;n<i.length;n++)i[n]=parseInt(i[n]);return i},t.hyphenToCameLCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.parseTranslateTransform=function(e){var r=t.translateRegExp2.exec(e);return null!=r?[parseFloat(r[1]),parseFloat(r[2])]:(r=t.translateRegExp1.exec(e),[parseFloat(r[1]),0])},t.increaseTransparency=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=i[4]?i[4]:1;return"rgba("+i[1]+","+i[2]+","+i[3]+","+r*n+")"},t.changeBrightness=function(e,r){var i=t.rgbRegExp.exec(e);if(i||(i=t.rgbaRegExp.exec(e)),!i)return e;var n=parseInt(i[1]),a=parseInt(i[2]),o=parseInt(i[3]);if(r<=1)n*=r,a*=r,o*=r;else{var s=1-1/r;n+=(255-n)*s,a+=(255-a)*s,o+=(255-o)*s}return n=Math.round(n),a=Math.round(a),o=Math.round(o),i[4]?"rgba("+n+","+a+","+o+","+i[4]+")":"rgb("+n+","+a+","+o+")"},t.pathAngleAt=function(t,e){var r=t.getTotalLength();e=Math.max(3,e),e=Math.min(e,r);var i=Math.max(0,e-3),n=t.getPointAtLength(e),a=t.getPointAtLength(i);return Math.atan2(n.y-a.y,n.x-a.x)},t.addPathArrows=function(e,r,i,n,a,o){for(var s=e.getTotalLength(),l=a;l<s;l+=o){var u=e.getPointAtLength(l),c=e.getPointAtLength(l-3),h=t.radiansToDegrees(Math.PI/2-Math.atan2(u.x-c.x,u.y-c.y)),d=Zt.createUseElement(r);d.setAttribute("stroke-width",i.toString()),d.setAttribute("transform","translate("+u.x+" "+u.y+") rotate( "+h+")"),n.appendChild(d)}},t.sectorData=function(t,e,r,i,n,a){var o=Math.abs(a)>2*Math.PI?a%(2*Math.PI):a;a==2*Math.PI&&(a-=1e-4);var s=n+a,l=t+r*Math.cos(n),u=e+i*Math.sin(n),c=t+r*Math.cos(s),h=e+i*Math.sin(s);return"M "+t+" "+e+" L "+l+" "+u+" A "+r+" "+i+" 0 "+(Math.abs(o)>Math.PI?"1 ":"0 ")+(o>0?"1 ":"0 ")+c+" "+h+" Z"},t.roundPathCorners=function(t,e,r){function i(t,e,r){var i=e.x-t.x,a=e.y-t.y,o=Math.sqrt(i*i+a*a);return n(t,e,Math.min(1,r/o))}function n(t,e,r){return{x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}}function a(t,e){t.length>2&&(t[t.length-2]=e.x,t[t.length-1]=e.y)}function o(t){return{x:parseFloat(t[t.length-2]),y:parseFloat(t[t.length-1])}}var s=t.split(/[,\s]/).reduce(function(t,e){var r=e.match("([a-zA-Z])(.+)");return r?(t.push(r[1]),t.push(r[2])):t.push(e),t},[]).reduce(function(t,e){return parseFloat(e)==e&&t.length?t[t.length-1].push(e):t.push([e]),t},[]),l=[];if(s.length>1){var u=o(s[0]),c=null;"Z"==s[s.length-1][0]&&s[0].length>2&&(c=["L",u.x,u.y],s[s.length-1]=c),l.push(s[0]);for(var h=1;h<s.length;h++){var d=l[l.length-1],p=s[h],f=p==c?s[1]:s[h+1];if(f&&d&&d.length>2&&"L"==p[0]&&f.length>2&&"L"==f[0]){var m,g,b=o(d),v=o(p),y=o(f);r?(m=n(v,d.origPoint||b,e),g=n(v,f.origPoint||y,e)):(m=i(v,b,e),g=i(v,y,e)),a(p,m),p.origPoint=v,l.push(p);var A=n(m,v,.5),T=n(v,g,.5),C=["C",A.x,A.y,T.x,T.y,g.x,g.y];C.origPoint=v,l.push(C)}else l.push(p)}if(c){var S=o(l[l.length-1]);l.push(["Z"]),a(l[0],S)}}else l=s;return l.reduce(function(t,e){return t+e.join(" ")+" "},"")},t.stringToByteArray=function(t){for(var e=[],r=0,i=0;i<t.length;i++){for(var n=t.charCodeAt(i);n>255;)e[r++]=255&n,n>>=8;e[r++]=n}return e},t.byteArrayToString=function(t){if(t.length<=8192)return String.fromCharCode.apply(null,t);for(var e="",r=0;r<t.length;r+=8192){var i=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,i)}return e},t.translateRegExp1=/^translate\s*\(\s*(-?\d*.?\d*)\s*\)\s*$/i,t.translateRegExp2=/^translate\s*\(\s*(-?\d*.?\d*)\s*[\s|,]\s*(-?\d*.?\d*)\s*\)\s*$/i,t.rgbRegExp=/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,t.rgbaRegExp=/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*.?\d*)\s*\)\s*$/i,t.MILLISECOND=1,t.SECOND=1e3*t.MILLISECOND,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR,t.WEEK=7*t.DAY,t.MONTH=30*t.DAY,t.YEAR=365*t.DAY,t}(),Qt=function(){function t(t){this.frameDrawing=t}return t.createShapeArc=function(){return Zt.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:hf.filterAndSetAttribute(t,e[a],r[a])}},t.createShapeText=function(){return Zt.createSvgElement("text")},t.updateShapeText=function(t,e,r){for(var i=0;i<e.length;i++)if("text-content"==e[i]){null==r[i]&&(r[i]="");var n=r[i].split("\n"),a=t.childElementCount;if(1==n.length&&1==a)t.firstChild.firstChild.textContent=n[0];else{for(var o=Kt.getFloatAttribute(t,"first-line-offset"),s=Kt.getFloatAttribute(t,"line-height"),l=0;l<n.length;l++){var u=Zt.childElements(t),c=n[l];if(c.endsWith("\r")&&(c=c.substring(0,c.length-1)),u[l])u[l].firstChild.textContent=c;else{var h=Zt.createSvgElement("tspan");h.setAttribute("x","0"),h.setAttribute("y",(o+l*s).toString());var d=Zt.createTextNode(c);h.appendChild(d),t.appendChild(h)}}for(;t.childElementCount>n.length;)Zt.removeElement(t,t.lastChild)}}else hf.filterAndSetAttribute(t,e[i],r[i])},t.createShapeImage=function(){return Zt.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":Zt.removeAllChildren(t);break;case"add":var n=Zt.createSvgElement("image");n.setAttributeNS(Zt.xlinkns,"href",this.frameDrawing.client.network.getJarResourceURL(r[i])),n.setAttribute("visibility","hidden"),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var a=parseInt(r[i]),o=t.childNodes,s=0;s<o.length;s++)(n=o[s]).setAttribute("visibility",s==a?"inherit":"hidden");break;case"width":case"height":o=t.childNodes;for(s=0;s<o.length;s++)(n=o[s]).setAttribute(e[i],r[i]);default:hf.filterAndSetAttribute(t,e[i],r[i])}},t.createShapeCanvas=function(t){var e=Zt.createSvgElement("image");Zt.createCanvas(t,"canvas-group");return e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),a=n.getContext("2d"),o=0;o<e.length;o++)switch(e[o]){case"global-composite-operation":a.globalCompositeOperation=r[o];break;case"width":case"height":i.setAttribute(e[o],r[o]),n.setAttribute(e[o],r[o]);break;case"fill-rect":case"clear-rect":var s=r[o].split(" "),l=parseFloat(s[0]),u=parseFloat(s[1]),c=parseFloat(s[2]),h=parseFloat(s[3]);if("clear-rect"==e[o])a.clearRect(l,u,c,h);else{var d=s[4];a.fillStyle=d,a.fillRect(l,u,c,h)}break;case"fill-circle":s=r[o].split(" ");var p=parseFloat(s[0]),f=parseFloat(s[1]),m=parseFloat(s[2]),g=s[3];a.fillStyle=g,a.beginPath(),a.arc(p,f,m,0,2*Math.PI),a.fill();break;case"clear":a.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(Zt.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;default:hf.filterAndSetAttribute(t,e[o],r[o])}},t.createUnsupportedObject=function(t){var e=Zt.cloneElementWithId("unsupported-object");return Zt.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=Zt.findChildOfType(t,"background"),n=Zt.findChildOfType(t,"text"),a=0;a<e.length;a++)switch(e[a]){case"width":var o=parseFloat(r[a]);i.setAttribute("width",o.toString());var s=n.getBBox();o<s.width&&(n.firstChild.textContent="Not supported",s=n.getBBox()),o<s.width&&(n.firstChild.textContent="N/A",s=n.getBBox()),o<s.width&&(n.firstChild.textContent=""),n.setAttribute("x",(o/2).toString());break;case"height":var l=parseFloat(r[a]);i.setAttribute("height",l.toString()),n.setAttribute("y",(l/2+3).toString());break;default:hf.filterAndSetAttribute(t,e[a],r[a])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeGISMap"],t}(),Jt=function(){function t(){}return t.createStockIcon=function(t){var e=Zt.cloneElementWithId("STOCK"),r=Zt.findChildOfType(e,"back"),i=parseFloat(Kt.getSubAttribute(t,"width")),n=parseFloat(Kt.getSubAttribute(t,"height"));Kt.setMultipleAttributes(r,["x","y","width","height"],[-i/2,-n/2,i,n]);var a=Zt.findChildOfType(e,"bars").firstElementChild;Kt.setMultipleAttributes(a,["x","width"],[-i/2+1,i-2]);var o=Kt.getSubAttribute(t,"color");return null!=o&&(r.setAttribute("stroke",o),a.setAttribute("fill",o)),e},t.createFlowIcon=function(e){for(var r=Zt.cloneElementWithId("FLOW"),i=Zt.findChildOfType(r,"basepath"),n=Zt.findChildOfType(r,"innerpath"),a=Zt.findChildOfType(r,"animation"),o=Zt.findChildOfType(r,"arrow"),s=Zt.findChildOfType(r,"valve"),l=Kt.getSubAttribute(e,"color"),u=Kt.getSubAttribute(e,"points"),c=Kt.splitSkipEmpty(u,";"),h="",d=0;d<c.length;d++){var p=Kt.splitToFloats(c[d],",");if(h+=0==d?"M ":"L ",h+=p[0]+" "+p[1]+" ",0==d&&"null"==Kt.getSubAttribute(e,"source")){var f=Kt.splitToFloats(c[1],","),m=Math.atan2(p[1]-f[1],p[0]-f[0]);t.addFlowCloud(r,!0,p[0],p[1],m,l)}if(d==c.length-1){var g=Kt.splitToFloats(c[d-1],","),b=(m=Math.atan2(p[1]-g[1],p[0]-g[0]),Kt.radiansToDegrees(m)),v="translate("+p[0]+","+p[1]+") rotate("+b+")";o.setAttribute("transform",v),"null"==Kt.getSubAttribute(e,"target")&&t.addFlowCloud(r,!1,p[0],p[1],m,l)}}var y=Kt.roundPathCorners(h,5,!1);i.setAttribute("d",y),n.setAttribute("d",y),a.setAttribute("d",y);var A=Kt.getSubAttribute(e,"valve-pos"),T=Kt.splitToFloats(A,","),C="translate("+T[0]+","+T[1]+") rotate("+Kt.radiansToDegrees(T[2])+")";return s.setAttribute("transform",C),"true"==Kt.getSubAttribute(e,"external")&&s.setAttribute("stroke-dasharray","1,1"),null!=l&&(i.setAttribute("stroke",l),o.setAttribute("stroke",l),o.setAttribute("fill",Kt.changeBrightness(l,2)),s.setAttribute("stroke",l),s.setAttribute("fill",Kt.changeBrightness(l,2))),r},t.addFlowCloud=function(t,e,r,i,n,a){var o=e?15:35,s=r+o*Math.cos(n),l=i+o*Math.sin(n),u=Zt.createUseElement("flow-cloud-fill"),c=Zt.createUseElement("flow-cloud-line");Kt.setMultipleAttributes(u,["x","y"],[s,l]),Kt.setMultipleAttributes(c,["x","y"],[s,l]),c.setAttribute("stroke",null==a?"CornflowerBlue":a),t.appendChild(u),t.appendChild(c)},t.createDynamicVariableIcon=function(t){var e,r=(e="true"==Kt.getSubAttribute(t,"external")?Zt.cloneElementWithId("DYNAMIC_VARIABLE_EXTERNAL"):"true"==Kt.getSubAttribute(t,"constant")?Zt.cloneElementWithId("DYNAMIC_VARIABLE_CONSTANT"):Zt.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,i=Kt.getSubAttribute(t,"color");return null!=i&&r.setAttribute("fill",i),e},t.createShadowIconAndInfo=function(t,e,r){var i=Kt.getSubAttribute(r,"original"),n=te.getModelElementByName(t,i);if(null==n)return console.log("Shadow variable could not find its original, name: "+i),Zt.createUseElement("DEFAULT_MODEL_ELEMENT");var a,o=Zt.findChildOfType(n,"icon");if("FLOW"==n.getAttribute("type")){var s=(a=Zt.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,l=Zt.findChildOfType(o,"valve");s.setAttribute("fill",l.getAttribute("stroke"))}else o.id=n.id+"icon",a=Zt.createUseElement(o.id);var u=Zt.findChildOfType(n,"info");u.id=n.id+"info";var c=Zt.createUseElement(u.id);c.setAttribute("type","info");var h=Zt.findChildOfType(e,"info"),d=Kt.getFloatAttribute(h,"x"),p=Kt.getFloatAttribute(h,"y");e.removeChild(h);var f=Kt.getFloatAttribute(u,"x"),m=Kt.getFloatAttribute(u,"y");return Kt.setMultipleAttributes(c,["x","y"],[-f+d,-m+p]),e.appendChild(c),a},t.createLinkIcon=function(t){var e=Zt.cloneElementWithId("LINK"),r=Zt.findChildOfType(e,"path"),i=Kt.splitToFloats(Kt.getSubAttribute(t,"start-point"),","),n=Kt.splitToFloats(Kt.getSubAttribute(t,"end-point"),","),a=Kt.getFloatSubAttribute(t,"r");if(null==a)r.setAttribute("d","M "+i[0]+" "+i[1]+" L "+n[0]+" "+n[1]);else{var o=Kt.getSubAttribute(t,"large"),s=Kt.getSubAttribute(t,"sweep");r.setAttribute("d","M "+i[0]+" "+i[1]+" A "+a+" "+a+" 0 "+o+" "+s+" "+n[0]+" "+n[1])}var l=r.getTotalLength(),u=Zt.findChildOfType(e,"arrow"),c=Kt.pathAngleAt(r,l),h=Kt.radiansToDegrees(c);u.setAttribute("transform","translate("+n[0]+" "+n[1]+") rotate("+h+")");var d=Kt.getSubAttribute(t,"color");null!=d&&(r.setAttribute("stroke",d),u.setAttribute("fill",d));var p=Kt.getSubAttribute(t,"stroke-width");if(null!=p){r.setAttribute("stroke-width",p);var f=1+((C=parseInt(p))-1)/4;u.setAttribute("transform",u.getAttribute("transform")+" scale("+f+")")}var m=Kt.getSubAttribute(t,"polarity");if(null!=m){var g=Zt.createSvgElement("text");g.appendChild(Zt.createTextNode(m));var b=n[0]+8*Math.cos(c-Math.PI/2),v=n[1]+8*Math.sin(c-Math.PI/2)+4;Kt.setMultipleAttributes(g,["x","y"],[b,v]),Kt.setMultipleAttributes(g,["fill","text-anchor"],[r.getAttribute("stroke"),"middle"]),e.appendChild(g)}if("true"==Kt.getSubAttribute(t,"delay")){var y=Zt.createUseElement("link-delay");y.setAttribute("stroke",null==d?"CornflowerBlue":d);var A=r.getPointAtLength(l/2),T=Kt.radiansToDegrees(Kt.pathAngleAt(r,l/2));y.setAttribute("transform","translate("+A.x+" "+A.y+") rotate( "+T+")"),e.appendChild(y)}if("true"==Kt.getSubAttribute(t,"initial-value")){var C=Kt.getFloatAttribute(r,"stroke-width");r.setAttribute("stroke-dasharray",4*C+","+1.5*C)}return e},t.createCausalLoopIcon=function(t){var e="true"==Kt.getSubAttribute(t,"clockwise"),r=Zt.cloneElementWithId(e?"CAUSAL_LOOP_CW":"CAUSAL_LOOP_CCW"),i=Zt.findChildOfType(r,"loop"),n=Zt.findChildOfType(r,"arrow"),a=Zt.findChildOfType(r,"text"),o=Kt.getSubAttribute(t,"text");a.firstChild.textContent=o;var s=8*o.length;if(s>18){var l=(s+6)/2;i.setAttribute("d","M0 -"+l+" A "+l+" "+l+" 0 1 "+(e?1:0)+" "+(e?-l:l)+" 0"),n.setAttribute("transform","translate("+(e?-1:1)*(l-12)+" 0)")}var u=Kt.getSubAttribute(t,"color");return null!=u&&(i.setAttribute("stroke",u),n.setAttribute("fill",u),a.setAttribute("fill",u)),r},t.updateStockState=function(t,e){var r=Kt.splitToFloats(e,","),i=r.length,n=Zt.findChildOfType(t,"back"),a=Zt.findChildOfType(t,"bars");if(a.childElementCount<i){for(var o=a.firstElementChild;a.childElementCount<i;)a.appendChild(Zt.cloneElement(o));var s=Kt.getFloatAttribute(n,"width"),l=-s/2+1,u=(s-1)/i-1;do{Kt.setMultipleAttributes(o,["x","width"],[l,u]),l+=u+1,o=o.nextElementSibling}while(null!=o)}for(var c=1/0,h=-1/0,d=0,p=r;d<p.length;d++){var f=p[d];f<c&&(c=f),h<f&&(h=f)}var m=Math.max(Math.abs(c),Math.abs(h)),g=Math.pow(10,Math.ceil(Math.log10(m)));c<0&&(g*=2),g<=0&&(g=1);for(var b=Kt.getFloatAttribute(n,"height"),v=a.firstElementChild,y=0;y<i;y++){var A=(b-2)*(r[y]/g),T=void 0;r[y]>=0?T=c>=0?b/2-1-A:-A:(A=-A,T=0),Kt.setMultipleAttributes(v,["y","height"],[T,A]),v=v.nextElementSibling}},t.updateFlowDirection=function(t,e){var r;r="1"==e?"model-primitive-flow-forward":"-1"==e?"model-primitive-flow-backward":"",Zt.findChildOfType(t,"animation").setAttribute("class",r)},t}(),$t=function(){function t(){}return t.createStateIcon=function(t){var e=Zt.cloneElementWithId("STATE"),r=parseFloat(Kt.getSubAttribute(t,"width")),i=parseFloat(Kt.getSubAttribute(t,"height"));Kt.setMultipleAttributes(e,["width","height"],[r,i]);var n=Kt.getSubAttribute(t,"color"),a="true"==Kt.getSubAttribute(t,"composite");return e.setAttribute("composite",a?"true":"false"),null!=n?(e.setAttribute("fill",n),e.setAttribute("stroke",Kt.changeBrightness(n,.8))):a&&(e.setAttribute("fill","none"),e.setAttribute("stroke","Gray")),e.setAttribute("stroke-width",a?"2":"1"),e},t.createFinalStateIcon=function(){return Zt.cloneElementWithId("FINAL_STATE")},t.createTransitionIcon=function(t){for(var e=Zt.cloneElementWithId("TRANSITION"),r=Zt.findChildOfType(e,"path"),i=Kt.getSubAttribute(t,"points"),n=Kt.splitSkipEmpty(i,";"),a="",o=0;o<n.length;o++){var s=Kt.splitToFloats(n[o],",");if(o==n.length-1){var l=Kt.splitToFloats(n[o-1],","),u=Math.atan2(s[1]-l[1],s[0]-l[0]);s[0]-=Math.round(4*Math.cos(u)),s[1]-=Math.round(4*Math.sin(u));var c=Kt.radiansToDegrees(u),h="translate("+s[0]+","+s[1]+") rotate("+c+")";Zt.findChildOfType(e,"arrow").setAttribute("transform",h)}a+=(0==o?"M ":"L ")+s[0]+" "+s[1]+" "}var d=Kt.roundPathCorners(a,10,!1);r.setAttribute("d",d);var p=Kt.getSubAttribute(t,"trigger");if(null!=p){var f=Zt.createUseElement("transition-icon-"+p);f.setAttribute("type","trigger"),f.setAttribute("stroke","Black"),Zt.findChildOfType(e,"path").setAttribute("d",d);var m=Kt.getFloatSubAttribute(t,"icon-offset"),g=r.getPointAtLength(m);f.setAttribute("transform","translate("+g.x+","+g.y+")"),e.appendChild(f)}return e},t.createStatePointerIcon=function(t,e){var r=Zt.cloneElementWithId("STATE_POINTER"),i=Zt.findChildOfType(r,"line"),n=Zt.findChildOfType(r,"entry-dash"),a=Kt.getSubAttribute(t,"dxdy"),o=Kt.splitToFloats(a,","),s=Math.atan2(o[1],o[0]);o[0]-=Math.round(4*Math.cos(s)),o[1]-=Math.round(4*Math.sin(s)),Kt.setMultipleAttributes(i,["x2","y2"],[o[0],o[1]]);var l=Kt.radiansToDegrees(s),u="translate("+o[0]+","+o[1]+") rotate("+l+")";return Zt.findChildOfType(r,"arrow").setAttribute("transform",u),e?n.setAttribute("transform","rotate("+l+")"):Zt.removeElement(r,n),r},t.updateStateState=function(t,e,r){var i="true"==r;if("STATE"==e)if(i)Kt.setMultipleAttributes(t,["stroke","stroke-width"],["Red",2]);else{var n="true"==t.getAttribute("composite")?2:1,a=t.getAttribute("fill"),o="none"==a?"Gray":Kt.changeBrightness(a,.8);Kt.setMultipleAttributes(t,["stroke","stroke-width"],[o,n])}else{var s=Zt.findChildOfType(t,"outer");n=i?2:1,o=i?"Red":"Black";Kt.setMultipleAttributes(s,["stroke","stroke-width"],[o,n])}},t.updateTransitionState=function(t,e){var r=Zt.findChildOfType(t,"path"),i=Zt.findChildOfType(t,"arrow"),n=Zt.findChildOfType(t,"trigger"),a="Black";switch(e){case"SCHEDULED":a="Blue";break;case"CURRENT":a="Red"}r.setAttribute("stroke",a),i.setAttribute("fill",a),null!=n&&n.setAttribute("stroke",a)},t}(),te=function(){function t(){}return t.create=function(){return Zt.cloneElementWithId("shape-model-primitives")},t.update=function(e,r,i){for(var n=0;n<r.length;n++)switch(r[n]){case"static-info":for(var a=Kt.splitSkipEmpty(i[n],"\n"),o=0;o<a.length;o++){var s=Kt.splitSkipEmpty(a[o],"|"),l=Kt.getSubAttribute(s,"index"),u=Kt.getSubAttribute(s,"type"),c=Kt.getSubAttribute(s,"name"),h=Kt.getSubAttribute(s,"x"),d=Kt.getSubAttribute(s,"y"),p=Zt.cloneElementWithId("model-primitive");p.id=e.id+"-"+l,p.setAttribute("type",u),p.setAttribute("transform","translate("+h+","+d+")");var f=Zt.findChildOfType(p,"label"),m=Zt.findChildOfType(p,"info");if(f.appendChild(Zt.createTextNode(c)),"false"==Kt.getSubAttribute(s,"show-label"))f.setAttribute("visibility","hidden"),m.setAttribute("visibility","hidden");else{var g=parseFloat(Kt.getSubAttribute(s,"label-dx")),b=parseFloat(Kt.getSubAttribute(s,"label-dy"));if("FLOW"==u){var v=Kt.getSubAttribute(s,"valve-pos"),y=Kt.splitToFloats(v,",");g+=y[0],b+=y[1]}Kt.setMultipleAttributes(f,["x","y"],[g,b+4]),Kt.setMultipleAttributes(m,["x","y"],[g,b+4+9]),m.appendChild(Zt.createTextNode(""))}var A=void 0;switch(u){case"CONNECTOR":A=t.createConnectorIcon(s);break;case"STOCK":A=Jt.createStockIcon(s);break;case"FLOW":A=Jt.createFlowIcon(s);break;case"DYNAMIC_VARIABLE":A=Jt.createDynamicVariableIcon(s);break;case"SHADOW":A=Jt.createShadowIconAndInfo(e,p,s);break;case"LINK":A=Jt.createLinkIcon(s);break;case"CAUSAL_LOOP":A=Jt.createCausalLoopIcon(s);break;case"STATE":A=$t.createStateIcon(s);break;case"FINAL_STATE":A=$t.createFinalStateIcon();break;case"TRANSITION":A=$t.createTransitionIcon(s);break;case"STATECHART_ENTRY_POINT":A=$t.createStatePointerIcon(s,!0);break;case"INITIAL_STATE_POINTER":A=$t.createStatePointerIcon(s,!1);break;default:var T=null==document.getElementById(u)?"DEFAULT_MODEL_ELEMENT":u;A=Zt.createUseElement(T)}A.setAttribute("type","icon"),p.insertBefore(A,f),e.appendChild(p)}break;case"update":var C=parseInt(i[n]),S=i[n].slice(i[n].indexOf(" ")+1),E=Kt.splitSkipEmpty(S,"|"),w=Zt.findChildWithId(e,e.id+"-"+C),k=Zt.findChildOfType(w,"icon"),x=w.getAttribute("type");for(o=0;o<E.length;o++){var M=E[o].split(":");switch(M[0]){case"label":case"info":Zt.findChildOfType(w,M[0]).firstChild.textContent=M[1];break;case"info-flag":m=Zt.findChildOfType(w,"info");var O="model-primitive-info";"warning"==M[1]&&(O="model-primitive-info-warning"),m.setAttribute("class",O);break;case"null":T=x+("true"==M[1]?"_NULL":"");Zt.changeUseHref(k,T);break;case"standard-icon":k.setAttribute("visibility","true"==M[1]?"inherit":"hidden");break;case"event-state":Zt.changeUseHref(k,"EVENT_"+M[1]);break;case"port-state":Zt.changeUseHref(k,"PORT_"+M[1]);break;case"empty":T=x+("true"==M[1]?"_EMPTY":""),Zt.changeUseHref(k,T);break;case"stock-state":Jt.updateStockState(k,M[1]);break;case"flow-sign":Jt.updateFlowDirection(k,M[1]);break;case"state-active":$t.updateStateState(k,x,M[1]);break;case"transition-state":$t.updateTransitionState(k,M[1])}}break;default:hf.filterAndSetAttribute(e,r[n],i[n])}},t.createConnectorIcon=function(t){for(var e=Zt.cloneElementWithId("CONNECTOR"),r=Kt.getSubAttribute(t,"points"),i=Kt.splitSkipEmpty(r,";"),n="",a=0;a<i.length;a++){var o=i[a].split(",");if(0==a){n+="M ";var s=Zt.findChildOfType(e,"start-circle");Kt.setMultipleAttributes(s,["cx","cy"],o)}else n+="L ";if(n+=o[0]+" "+o[1]+" ",a==i.length-1){var l=Zt.findChildOfType(e,"end-circle");Kt.setMultipleAttributes(l,["cx","cy"],o)}}var u=Kt.roundPathCorners(n,5,!1);return Zt.findChildOfType(e,"path").setAttribute("d",u),e},t.getModelElementByName=function(t,e){for(var r=0,i=Zt.childElements(t);r<i.length;r++){var n=i[r],a=Zt.findChildOfType(n,"label");if(null!=a&&a.innerHTML==e)return n}return null},t}();function ee(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}),Object.assign(ee.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var i=r.indexOf(e);-1!==i&&r.splice(i,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),i=0,n=r.length;i<n;i++)r[i].call(this,t)}}}});var re,ie,ne,ae="104",oe={LEFT:0,MIDDLE:1,RIGHT:2},se=0,le=1,ue=2,ce=3,he=0,de=1,pe=0,fe=1,me=2,ge=0,be=1,ve=2,ye=1,Ae=2,Te=0,Ce=1,Se=2,Ee=0,we=1,ke=2,xe=3,Me=4,Oe=5,Ie=100,_e=101,Le=102,Pe=103,Re=104,Fe=200,De=201,Ne=202,Be=203,Ge=204,Ue=205,He=206,ze=207,We=208,Ve=209,Ye=210,je=0,Xe=1,qe=2,Ze=3,Ke=4,Qe=5,Je=6,$e=7,tr=0,er=1,rr=2,ir=0,nr=1,ar=2,or=3,sr=4,lr=5,ur=300,cr=301,hr=302,dr=303,pr=304,fr=305,mr=306,gr=307,br=1e3,vr=1001,yr=1002,Ar=1003,Tr=1004,Cr=1005,Sr=1006,Er=1007,wr=1008,kr=1009,xr=1010,Mr=1011,Or=1012,Ir=1013,_r=1014,Lr=1015,Pr=1016,Rr=1017,Fr=1018,Dr=1019,Nr=1020,Br=1021,Gr=1022,Ur=1023,Hr=1024,zr=1025,Wr=Ur,Vr=1026,Yr=1027,jr=1028,Xr=33776,qr=33777,Zr=33778,Kr=33779,Qr=35840,Jr=35841,$r=35842,ti=35843,ei=36196,ri=37808,ii=37809,ni=37810,ai=37811,oi=37812,si=37813,li=37814,ui=37815,ci=37816,hi=37817,di=37818,pi=37819,fi=37820,mi=37821,gi=2200,bi=2201,vi=2202,yi=2300,Ai=2301,Ti=2302,Ci=2400,Si=2401,Ei=2402,wi=0,ki=1,xi=2,Mi=3e3,Oi=3001,Ii=3007,_i=3002,Li=3003,Pi=3004,Ri=3005,Fi=3006,Di=3200,Ni=3201,Bi=0,Gi=1,Ui={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return function(){var e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&r]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[63&i|128]+t[i>>8&255]+"-"+t[i>>16&255]+t[i>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]).toUpperCase()}}(),clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,i,n){return i+(t-e)*(n-i)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Ui.DEG2RAD},radToDeg:function(t){return t*Ui.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function Hi(t,e){this.x=t||0,this.y=e||0}function zi(t,e,r,i){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==i?i:1}function Wi(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}function Vi(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Hi.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Hi.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6],this.y=i[1]*e+i[4]*r+i[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e),i=Math.sin(e),n=this.x-t.x,a=this.y-t.y;return this.x=n*r-a*i+t.x,this.y=n*i+a*r+t.y,this}}),Object.assign(zi,{slerp:function(t,e,r,i){return r.copy(t).slerp(e,i)},slerpFlat:function(t,e,r,i,n,a,o){var s=r[i+0],l=r[i+1],u=r[i+2],c=r[i+3],h=n[a+0],d=n[a+1],p=n[a+2],f=n[a+3];if(c!==f||s!==h||l!==d||u!==p){var m=1-o,g=s*h+l*d+u*p+c*f,b=g>=0?1:-1,v=1-g*g;if(v>Number.EPSILON){var y=Math.sqrt(v),A=Math.atan2(y,g*b);m=Math.sin(m*A)/y,o=Math.sin(o*A)/y}var T=o*b;if(s=s*m+h*T,l=l*m+d*T,u=u*m+p*T,c=c*m+f*T,m===1-o){var C=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=C,l*=C,u*=C,c*=C}}t[e]=s,t[e+1]=l,t[e+2]=u,t[e+3]=c}}),Object.defineProperties(zi.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(zi.prototype,{isQuaternion:!0,set:function(t,e,r,i){return this._x=t,this._y=e,this._z=r,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,i=t._y,n=t._z,a=t.order,o=Math.cos,s=Math.sin,l=o(r/2),u=o(i/2),c=o(n/2),h=s(r/2),d=s(i/2),p=s(n/2);return"XYZ"===a?(this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p):"YXZ"===a?(this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p):"ZXY"===a?(this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p):"ZYX"===a?(this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p):"YZX"===a?(this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p):"XZY"===a&&(this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,i=Math.sin(r);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,i=r[0],n=r[4],a=r[8],o=r[1],s=r[5],l=r[9],u=r[2],c=r[6],h=r[10],d=i+s+h;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(c-l)*e,this._y=(a-u)*e,this._z=(o-n)*e):i>s&&i>h?(e=2*Math.sqrt(1+i-s-h),this._w=(c-l)/e,this._x=.25*e,this._y=(n+o)/e,this._z=(a+u)/e):s>h?(e=2*Math.sqrt(1+s-i-h),this._w=(a-u)/e,this._x=(n+o)/e,this._y=.25*e,this._z=(l+c)/e):(e=2*Math.sqrt(1+h-i-s),this._w=(o-n)/e,this._x=(a+u)/e,this._y=(l+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(t,e){var r=t.dot(e)+1;return r<1e-6?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Ui.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var r=this.angleTo(t);if(0===r)return this;var i=Math.min(1,e/r);return this.slerp(t,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,i=t._y,n=t._z,a=t._w,o=e._x,s=e._y,l=e._z,u=e._w;return this._x=r*u+a*o+i*l-n*s,this._y=i*u+a*s+n*o-r*l,this._z=n*u+a*l+r*s-i*o,this._w=a*u-r*o-i*s-n*l,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,i=this._y,n=this._z,a=this._w,o=a*t._w+r*t._x+i*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=i,this._z=n,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-e;return this._w=l*a+e*this._w,this._x=l*r+e*this._x,this._y=l*i+e*this._y,this._z=l*n+e*this._z,this.normalize()}var u=Math.sqrt(s),c=Math.atan2(u,o),h=Math.sin((1-e)*c)/u,d=Math.sin(e*c)/u;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=i*h+this._y*d,this._z=n*h+this._z*d,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Wi.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:(ie=new zi,function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ie.setFromEuler(t))}),applyAxisAngle:function(){var t=new zi;return function(e,r){return this.applyQuaternion(t.setFromAxisAngle(e,r))}}(),applyMatrix3:function(t){var e=this.x,r=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6]*i,this.y=n[1]*e+n[4]*r+n[7]*i,this.z=n[2]*e+n[5]*r+n[8]*i,this},applyMatrix4:function(t){var e=this.x,r=this.y,i=this.z,n=t.elements,a=1/(n[3]*e+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*r+n[8]*i+n[12])*a,this.y=(n[1]*e+n[5]*r+n[9]*i+n[13])*a,this.z=(n[2]*e+n[6]*r+n[10]*i+n[14])*a,this},applyQuaternion:function(t){var e=this.x,r=this.y,i=this.z,n=t.x,a=t.y,o=t.z,s=t.w,l=s*e+a*i-o*r,u=s*r+o*e-n*i,c=s*i+n*r-a*e,h=-n*e-a*r-o*i;return this.x=l*s+h*-n+u*-o-c*-a,this.y=u*s+h*-a+c*-n-l*-o,this.z=c*s+h*-o+l*-a-u*-n,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,r=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*r+n[8]*i,this.y=n[1]*e+n[5]*r+n[9]*i,this.z=n[2]*e+n[6]*r+n[10]*i,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,i=t.y,n=t.z,a=e.x,o=e.y,s=e.z;return this.x=i*s-n*o,this.y=n*a-r*s,this.z=r*o-i*a,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:(re=new Wi,function(t){return re.copy(this).projectOnVector(t),this.sub(re)}),reflect:function(){var t=new Wi;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(Ui.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,r){var i=Math.sin(e)*t;return this.x=i*Math.sin(r),this.y=Math.cos(e)*t,this.z=i*Math.cos(r),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=i,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(Vi.prototype,{isMatrix3:!0,set:function(t,e,r,i,n,a,o,s,l){var u=this.elements;return u[0]=t,u[1]=i,u[2]=o,u[3]=e,u[4]=n,u[5]=s,u[6]=r,u[7]=a,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new Wi;return function(e){for(var r=0,i=e.count;r<i;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix3(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,i=e.elements,n=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],u=r[4],c=r[7],h=r[2],d=r[5],p=r[8],f=i[0],m=i[3],g=i[6],b=i[1],v=i[4],y=i[7],A=i[2],T=i[5],C=i[8];return n[0]=a*f+o*b+s*A,n[3]=a*m+o*v+s*T,n[6]=a*g+o*y+s*C,n[1]=l*f+u*b+c*A,n[4]=l*m+u*v+c*T,n[7]=l*g+u*y+c*C,n[2]=h*f+d*b+p*A,n[5]=h*m+d*v+p*T,n[8]=h*g+d*y+p*C,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],s=t[6],l=t[7],u=t[8];return e*a*u-e*o*l-r*n*u+r*o*s+i*n*l-i*a*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=t.elements,i=this.elements,n=r[0],a=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],h=r[7],d=r[8],p=d*l-u*h,f=u*c-d*s,m=h*s-l*c,g=n*p+a*f+o*m;if(0===g){var b="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(b);return console.warn(b),this.identity()}var v=1/g;return i[0]=p*v,i[1]=(o*h-d*a)*v,i[2]=(u*a-o*l)*v,i[3]=f*v,i[4]=(d*n-o*c)*v,i[5]=(o*s-u*n)*v,i[6]=m*v,i[7]=(a*c-h*n)*v,i[8]=(l*n-a*s)*v,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,i,n,a,o){var s=Math.cos(n),l=Math.sin(n);this.set(r*s,r*l,-r*(s*a+l*o)+a+t,-i*l,i*s,-i*(-l*a+s*o)+o+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=this.elements,n=i[0],a=i[3],o=i[6],s=i[1],l=i[4],u=i[7];return i[0]=e*n+r*s,i[3]=e*a+r*l,i[6]=e*o+r*u,i[1]=-r*n+e*s,i[4]=-r*a+e*l,i[7]=-r*o+e*u,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,i=0;i<9;i++)if(e[i]!==r[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var Yi,ji,Xi,qi,Zi,Ki,Qi,Ji,$i,tn,en,rn,nn,an,on={getDataURL:function(t){var e;if("undefined"==typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)e=t;else{void 0===ne&&(ne=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),ne.width=t.width,ne.height=t.height;var r=ne.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=ne}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},sn=0;function ln(t,e,r,i,n,a,o,s,l,u){Object.defineProperty(this,"id",{value:sn++}),this.uuid=Ui.generateUUID(),this.name="",this.image=void 0!==t?t:ln.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:ln.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:vr,this.wrapT=void 0!==i?i:vr,this.magFilter=void 0!==n?n:Sr,this.minFilter=void 0!==a?a:wr,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:Ur,this.type=void 0!==s?s:kr,this.offset=new Hi(0,0),this.repeat=new Hi(1,1),this.center=new Hi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Vi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:Mi,this.version=0,this.onUpdate=null}function un(t,e,r,i){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==i?i:1}function cn(t,e,r){this.width=t,this.height=e,this.scissor=new un(0,0,t,e),this.scissorTest=!1,this.viewport=new un(0,0,t,e),r=r||{},this.texture=new ln(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:Sr,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function hn(t,e,r){cn.call(this,t,e,r),this.samples=4}function dn(t,e,r){cn.call(this,t,e,r)}function pn(t,e,r,i,n,a,o,s,l,u,c,h){ln.call(this,null,a,o,s,l,u,i,n,c,h),this.image={data:t,width:e,height:r},this.magFilter=void 0!==l?l:Ar,this.minFilter=void 0!==u?u:Ar,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function fn(t,e){this.min=void 0!==t?t:new Wi(1/0,1/0,1/0),this.max=void 0!==e?e:new Wi(-1/0,-1/0,-1/0)}function mn(t,e){this.center=void 0!==t?t:new Wi,this.radius=void 0!==e?e:0}function gn(t,e){this.normal=void 0!==t?t:new Wi(1,0,0),this.constant=void 0!==e?e:0}function bn(t,e,r,i,n,a){this.planes=[void 0!==t?t:new gn,void 0!==e?e:new gn,void 0!==r?r:new gn,void 0!==i?i:new gn,void 0!==n?n:new gn,void 0!==a?a:new gn]}function vn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}ln.DEFAULT_IMAGE=void 0,ln.DEFAULT_MAPPING=ur,ln.prototype=Object.assign(Object.create(ee.prototype),{constructor:ln,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=Ui.generateUUID()),!e&&void 0===t.images[i.uuid]){var n;if(Array.isArray(i)){n=[];for(var a=0,o=i.length;a<o;a++)n.push(on.getDataURL(i[a]))}else n=on.getDataURL(i);t.images[i.uuid]={uuid:i.uuid,url:n}}r.image=i.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==ur)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case br:t.x=t.x-Math.floor(t.x);break;case vr:t.x=t.x<0?0:1;break;case yr:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case br:t.y=t.y-Math.floor(t.y);break;case vr:t.y=t.y<0?0:1;break;case yr:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(ln.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(un.prototype,{isVector4:!0,set:function(t,e,r,i){return this.x=t,this.y=e,this.z=r,this.w=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,i=this.z,n=this.w,a=t.elements;return this.x=a[0]*e+a[4]*r+a[8]*i+a[12]*n,this.y=a[1]*e+a[5]*r+a[9]*i+a[13]*n,this.z=a[2]*e+a[6]*r+a[10]*i+a[14]*n,this.w=a[3]*e+a[7]*r+a[11]*i+a[15]*n,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,i,n,a=t.elements,o=a[0],s=a[4],l=a[8],u=a[1],c=a[5],h=a[9],d=a[2],p=a[6],f=a[10];if(Math.abs(s-u)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+u)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(o+c+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(o+1)/2,g=(c+1)/2,b=(f+1)/2,v=(s+u)/4,y=(l+d)/4,A=(h+p)/4;return m>g&&m>b?m<.01?(r=0,i=.707106781,n=.707106781):(i=v/(r=Math.sqrt(m)),n=y/r):g>b?g<.01?(r=.707106781,i=0,n=.707106781):(r=v/(i=Math.sqrt(g)),n=A/i):b<.01?(r=.707106781,i=.707106781,n=0):(r=y/(n=Math.sqrt(b)),i=A/n),this.set(r,i,n,e),this}var T=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(u-s)*(u-s));return Math.abs(T)<.001&&(T=1),this.x=(p-h)/T,this.y=(l-d)/T,this.z=(u-s)/T,this.w=Math.acos((o+c+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return void 0===Yi&&(Yi=new un,ji=new un),Yi.set(t,t,t,t),ji.set(e,e,e,e),this.clamp(Yi,ji)},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),cn.prototype=Object.assign(Object.create(ee.prototype),{constructor:cn,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),hn.prototype=Object.assign(Object.create(cn.prototype),{constructor:hn,isWebGLMultisampleRenderTarget:!0,copy:function(t){return cn.prototype.copy.call(this,t),this.samples=t.samples,this}}),dn.prototype=Object.create(cn.prototype),dn.prototype.constructor=dn,dn.prototype.isWebGLRenderTargetCube=!0,pn.prototype=Object.create(ln.prototype),pn.prototype.constructor=pn,pn.prototype.isDataTexture=!0,Object.assign(fn.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,i=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,l=t.length;s<l;s+=3){var u=t[s],c=t[s+1],h=t[s+2];u<e&&(e=u),c<r&&(r=c),h<i&&(i=h),u>n&&(n=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(e,r,i),this.max.set(n,a,o),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,i=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,l=t.count;s<l;s++){var u=t.getX(s),c=t.getY(s),h=t.getZ(s);u<e&&(e=u),c<r&&(r=c),h<i&&(i=h),u>n&&(n=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(e,r,i),this.max.set(n,a,o),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Wi;return function(e,r){var i=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Wi),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Wi),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,r,i=new Wi;function n(n){var a=n.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(e=0,r=o.length;e<r;e++)i.copy(o[e]),i.applyMatrix4(n.matrixWorld),t.expandByPoint(i)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(e=0,r=s.count;e<r;e++)i.fromBufferAttribute(s,e).applyMatrix4(n.matrixWorld),t.expandByPoint(i)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(n),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Wi),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:(qi=new Wi,function(t){return this.clampPoint(t.center,qi),qi.distanceToSquared(t.center)<=t.radius*t.radius}),intersectsPlane:function(t){var e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant},intersectsTriangle:function(){var t=new Wi,e=new Wi,r=new Wi,i=new Wi,n=new Wi,a=new Wi,o=new Wi,s=new Wi,l=new Wi,u=new Wi;function c(i){var n,a;for(n=0,a=i.length-3;n<=a;n+=3){o.fromArray(i,n);var s=l.x*Math.abs(o.x)+l.y*Math.abs(o.y)+l.z*Math.abs(o.z),u=t.dot(o),c=e.dot(o),h=r.dot(o);if(Math.max(-Math.max(u,c,h),Math.min(u,c,h))>s)return!1}return!0}return function(o){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),t.subVectors(o.a,s),e.subVectors(o.b,s),r.subVectors(o.c,s),i.subVectors(e,t),n.subVectors(r,e),a.subVectors(t,r);var h=[0,-i.z,i.y,0,-n.z,n.y,0,-a.z,a.y,i.z,0,-i.x,n.z,0,-n.x,a.z,0,-a.x,-i.y,i.x,0,-n.y,n.x,0,-a.y,a.x,0];return!!c(h)&&(!!c(h=[1,0,0,0,1,0,0,0,1])&&(u.crossVectors(i,n),c(h=[u.x,u.y,u.z])))}}(),clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Wi),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Wi;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new Wi;return function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(t).length(),e}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(Xi=[new Wi,new Wi,new Wi,new Wi,new Wi,new Wi,new Wi,new Wi],function(t){return this.isEmpty()?this:(Xi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Xi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Xi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Xi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Xi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Xi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Xi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Xi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Xi),this)}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(mn.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:(Zi=new fn,function(t,e){var r=this.center;void 0!==e?r.copy(e):Zi.setFromPoints(t).getCenter(r);for(var i=0,n=0,a=t.length;n<a;n++)i=Math.max(i,r.distanceToSquared(t[n]));return this.radius=Math.sqrt(i),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Wi),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new fn),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(gn.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,i){return this.normal.set(t,e,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new Wi,e=new Wi;return function(r,i,n){var a=t.subVectors(n,i).cross(e.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(a,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Wi),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new Wi;return function(e,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new Wi);var i=e.delta(t),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?r.copy(e.start):void 0;var a=-(e.start.dot(this.normal)+this.constant)/n;return a<0||a>1?void 0:r.copy(i).multiplyScalar(a).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Wi),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new Wi,e=new Vi;return function(r,i){var n=i||e.getNormalMatrix(r),a=this.coplanarPoint(t).applyMatrix4(r),o=this.normal.applyMatrix3(n).normalize();return this.constant=-a.dot(o),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(bn.prototype,{set:function(t,e,r,i,n,a){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(r),o[3].copy(i),o[4].copy(n),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements,i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],g=r[13],b=r[14],v=r[15];return e[0].setComponents(o-i,c-s,f-h,v-m).normalize(),e[1].setComponents(o+i,c+s,f+h,v+m).normalize(),e[2].setComponents(o+n,c+l,f+d,v+g).normalize(),e[3].setComponents(o-n,c-l,f-d,v-g).normalize(),e[4].setComponents(o-a,c-u,f-p,v-b).normalize(),e[5].setComponents(o+a,c+u,f+p,v+b).normalize(),this},intersectsObject:(Qi=new mn,function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Qi.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Qi)}),intersectsSprite:function(){var t=new mn;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,r=t.center,i=-t.radius,n=0;n<6;n++){if(e[n].distanceToPoint(r)<i)return!1}return!0},intersectsBox:(Ki=new Wi,function(t){for(var e=this.planes,r=0;r<6;r++){var i=e[r];if(Ki.x=i.normal.x>0?t.max.x:t.min.x,Ki.y=i.normal.y>0?t.max.y:t.min.y,Ki.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Ki)<0)return!1}return!0}),containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}}),Object.assign(vn.prototype,{isMatrix4:!0,set:function(t,e,r,i,n,a,o,s,l,u,c,h,d,p,f,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=i,g[1]=n,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new vn).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t=new Wi;return function(e){var r=this.elements,i=e.elements,n=1/t.setFromMatrixColumn(e,0).length(),a=1/t.setFromMatrixColumn(e,1).length(),o=1/t.setFromMatrixColumn(e,2).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[3]=0,r[4]=i[4]*a,r[5]=i[5]*a,r[6]=i[6]*a,r[7]=0,r[8]=i[8]*o,r[9]=i[9]*o,r[10]=i[10]*o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,i=t.y,n=t.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(i),l=Math.sin(i),u=Math.cos(n),c=Math.sin(n);if("XYZ"===t.order){var h=a*u,d=a*c,p=o*u,f=o*c;e[0]=s*u,e[4]=-s*c,e[8]=l,e[1]=d+p*l,e[5]=h-f*l,e[9]=-o*s,e[2]=f-h*l,e[6]=p+d*l,e[10]=a*s}else if("YXZ"===t.order){var m=s*u,g=s*c,b=l*u,v=l*c;e[0]=m+v*o,e[4]=b*o-g,e[8]=a*l,e[1]=a*c,e[5]=a*u,e[9]=-o,e[2]=g*o-b,e[6]=v+m*o,e[10]=a*s}else if("ZXY"===t.order){m=s*u,g=s*c,b=l*u,v=l*c;e[0]=m-v*o,e[4]=-a*c,e[8]=b+g*o,e[1]=g+b*o,e[5]=a*u,e[9]=v-m*o,e[2]=-a*l,e[6]=o,e[10]=a*s}else if("ZYX"===t.order){h=a*u,d=a*c,p=o*u,f=o*c;e[0]=s*u,e[4]=p*l-d,e[8]=h*l+f,e[1]=s*c,e[5]=f*l+h,e[9]=d*l-p,e[2]=-l,e[6]=o*s,e[10]=a*s}else if("YZX"===t.order){var y=a*s,A=a*l,T=o*s,C=o*l;e[0]=s*u,e[4]=C-y*c,e[8]=T*c+A,e[1]=c,e[5]=a*u,e[9]=-o*u,e[2]=-l*u,e[6]=A*c+T,e[10]=y-C*c}else if("XZY"===t.order){y=a*s,A=a*l,T=o*s,C=o*l;e[0]=s*u,e[4]=-c,e[8]=l*u,e[1]=y*c+C,e[5]=a*u,e[9]=A*c-T,e[2]=T*c-A,e[6]=o*u,e[10]=C*c+y}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:(nn=new Wi(0,0,0),an=new Wi(1,1,1),function(t){return this.compose(nn,t,an)}),lookAt:(tn=new Wi,en=new Wi,rn=new Wi,function(t,e,r){var i=this.elements;return rn.subVectors(t,e),0===rn.lengthSq()&&(rn.z=1),rn.normalize(),tn.crossVectors(r,rn),0===tn.lengthSq()&&(1===Math.abs(r.z)?rn.x+=1e-4:rn.z+=1e-4,rn.normalize(),tn.crossVectors(r,rn)),tn.normalize(),en.crossVectors(rn,tn),i[0]=tn.x,i[4]=en.x,i[8]=rn.x,i[1]=tn.y,i[5]=en.y,i[9]=rn.y,i[2]=tn.z,i[6]=en.z,i[10]=rn.z,this}),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,i=e.elements,n=this.elements,a=r[0],o=r[4],s=r[8],l=r[12],u=r[1],c=r[5],h=r[9],d=r[13],p=r[2],f=r[6],m=r[10],g=r[14],b=r[3],v=r[7],y=r[11],A=r[15],T=i[0],C=i[4],S=i[8],E=i[12],w=i[1],k=i[5],x=i[9],M=i[13],O=i[2],I=i[6],_=i[10],L=i[14],P=i[3],R=i[7],F=i[11],D=i[15];return n[0]=a*T+o*w+s*O+l*P,n[4]=a*C+o*k+s*I+l*R,n[8]=a*S+o*x+s*_+l*F,n[12]=a*E+o*M+s*L+l*D,n[1]=u*T+c*w+h*O+d*P,n[5]=u*C+c*k+h*I+d*R,n[9]=u*S+c*x+h*_+d*F,n[13]=u*E+c*M+h*L+d*D,n[2]=p*T+f*w+m*O+g*P,n[6]=p*C+f*k+m*I+g*R,n[10]=p*S+f*x+m*_+g*F,n[14]=p*E+f*M+m*L+g*D,n[3]=b*T+v*w+y*O+A*P,n[7]=b*C+v*k+y*I+A*R,n[11]=b*S+v*x+y*_+A*F,n[15]=b*E+v*M+y*L+A*D,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new Wi;return function(e){for(var r=0,i=e.count;r<i;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.applyMatrix4(this),e.setXYZ(r,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],r=t[4],i=t[8],n=t[12],a=t[1],o=t[5],s=t[9],l=t[13],u=t[2],c=t[6],h=t[10],d=t[14];return t[3]*(+n*s*c-i*l*c-n*o*h+r*l*h+i*o*d-r*s*d)+t[7]*(+e*s*d-e*l*h+n*a*h-i*a*d+i*l*u-n*s*u)+t[11]*(+e*l*c-e*o*d-n*a*c+r*a*d+n*o*u-r*l*u)+t[15]*(-i*o*u-e*s*c+e*o*h+i*a*c-r*a*h+r*s*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,i=t.elements,n=i[0],a=i[1],o=i[2],s=i[3],l=i[4],u=i[5],c=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],b=i[13],v=i[14],y=i[15],A=p*v*h-b*f*h+b*c*m-u*v*m-p*c*y+u*f*y,T=g*f*h-d*v*h-g*c*m+l*v*m+d*c*y-l*f*y,C=d*b*h-g*p*h+g*u*m-l*b*m-d*u*y+l*p*y,S=g*p*c-d*b*c-g*u*f+l*b*f+d*u*v-l*p*v,E=n*A+a*T+o*C+s*S;if(0===E){var w="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(w);return console.warn(w),this.identity()}var k=1/E;return r[0]=A*k,r[1]=(b*f*s-p*v*s-b*o*m+a*v*m+p*o*y-a*f*y)*k,r[2]=(u*v*s-b*c*s+b*o*h-a*v*h-u*o*y+a*c*y)*k,r[3]=(p*c*s-u*f*s-p*o*h+a*f*h+u*o*m-a*c*m)*k,r[4]=T*k,r[5]=(d*v*s-g*f*s+g*o*m-n*v*m-d*o*y+n*f*y)*k,r[6]=(g*c*s-l*v*s-g*o*h+n*v*h+l*o*y-n*c*y)*k,r[7]=(l*f*s-d*c*s+d*o*h-n*f*h-l*o*m+n*c*m)*k,r[8]=C*k,r[9]=(g*p*s-d*b*s-g*a*m+n*b*m+d*a*y-n*p*y)*k,r[10]=(l*b*s-g*u*s+g*a*h-n*b*h-l*a*y+n*u*y)*k,r[11]=(d*u*s-l*p*s-d*a*h+n*p*h+l*a*m-n*u*m)*k,r[12]=S*k,r[13]=(d*b*o-g*p*o+g*a*f-n*b*f-d*a*v+n*p*v)*k,r[14]=(g*u*o-l*b*o-g*a*c+n*b*c+l*a*v-n*u*v)*k,r[15]=(l*p*o-d*u*o+d*a*c-n*p*c-l*a*f+n*u*f)*k,this},scale:function(t){var e=this.elements,r=t.x,i=t.y,n=t.z;return e[0]*=r,e[4]*=i,e[8]*=n,e[1]*=r,e[5]*=i,e[9]*=n,e[2]*=r,e[6]*=i,e[10]*=n,e[3]*=r,e[7]*=i,e[11]*=n,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),i=Math.sin(e),n=1-r,a=t.x,o=t.y,s=t.z,l=n*a,u=n*o;return this.set(l*a+r,l*o-i*s,l*s+i*o,0,l*o+i*s,u*o+r,u*s-i*a,0,l*s-i*o,u*s+i*a,n*s*s+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){var i=this.elements,n=e._x,a=e._y,o=e._z,s=e._w,l=n+n,u=a+a,c=o+o,h=n*l,d=n*u,p=n*c,f=a*u,m=a*c,g=o*c,b=s*l,v=s*u,y=s*c,A=r.x,T=r.y,C=r.z;return i[0]=(1-(f+g))*A,i[1]=(d+y)*A,i[2]=(p-v)*A,i[3]=0,i[4]=(d-y)*T,i[5]=(1-(h+g))*T,i[6]=(m+b)*T,i[7]=0,i[8]=(p+v)*C,i[9]=(m-b)*C,i[10]=(1-(h+f))*C,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this},decompose:(Ji=new Wi,$i=new vn,function(t,e,r){var i=this.elements,n=Ji.set(i[0],i[1],i[2]).length(),a=Ji.set(i[4],i[5],i[6]).length(),o=Ji.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],$i.copy(this);var s=1/n,l=1/a,u=1/o;return $i.elements[0]*=s,$i.elements[1]*=s,$i.elements[2]*=s,$i.elements[4]*=l,$i.elements[5]*=l,$i.elements[6]*=l,$i.elements[8]*=u,$i.elements[9]*=u,$i.elements[10]*=u,e.setFromRotationMatrix($i),r.x=n,r.y=a,r.z=o,this}),makePerspective:function(t,e,r,i,n,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*n/(e-t),l=2*n/(r-i),u=(e+t)/(e-t),c=(r+i)/(r-i),h=-(a+n)/(a-n),d=-2*a*n/(a-n);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,r,i,n,a){var o=this.elements,s=1/(e-t),l=1/(r-i),u=1/(a-n),c=(e+t)*s,h=(r+i)*l,d=(a+n)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,i=0;i<16;i++)if(e[i]!==r[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}});var yn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick( specularColor, dotNV );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#endif\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\tvec3 diffuse = material.diffuseColor;\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\t#else\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#endif\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\t#ifdef USE_TANGENT\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy = normalScale * mapN.xy;\n\t\t\tnormal = normalize( vTBN * mapN );\n\t\t#else\n\t\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t\t#endif\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"};function An(t){var e={};for(var r in t)for(var i in e[r]={},t[r]){var n=t[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?e[r][i]=n.clone():Array.isArray(n)?e[r][i]=n.slice():e[r][i]=n}return e}function Tn(t){for(var e={},r=0;r<t.length;r++){var i=An(t[r]);for(var n in i)e[n]=i[n]}return e}var Cn,Sn,En,wn={clone:An,merge:Tn},kn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function xn(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}Object.assign(xn.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(){function t(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}return function(e,r,i){if(e=Ui.euclideanModulo(e,1),r=Ui.clamp(r,0,1),i=Ui.clamp(i,0,1),0===r)this.r=this.g=this.b=i;else{var n=i<=.5?i*(1+r):i+r-i*r,a=2*i-n;this.r=t(a,n,e+1/3),this.g=t(a,n,e),this.b=t(a,n,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var i,n=r[1],a=r[2];switch(n){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,e(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,e(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,l=parseInt(i[3],10)/100;return e(i[5]),this.setHSL(o,s,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var u,c=(u=r[1]).length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}t&&t.length>0&&(void 0!==(u=kn[t])?this.setHex(u):console.warn("THREE.Color: Unknown color "+t));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(){function t(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}return function(e){return this.r=t(e.r),this.g=t(e.g),this.b=t(e.b),this}}(),copyLinearToSRGB:function(){function t(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}return function(e){return this.r=t(e.r),this.g=t(e.g),this.b=t(e.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r,i=this.r,n=this.g,a=this.b,o=Math.max(i,n,a),s=Math.min(i,n,a),l=(s+o)/2;if(s===o)e=0,r=0;else{var u=o-s;switch(r=l<=.5?u/(o+s):u/(2-o-s),o){case i:e=(n-a)/u+(n<a?6:0);break;case n:e=(a-i)/u+2;break;case a:e=(i-n)/u+4}e/=6}return t.h=e,t.s=r,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(En={},function(t,e,r){return this.getHSL(En),En.h+=t,En.s+=e,En.l+=r,this.setHSL(En.h,En.s,En.l),this}),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:(Cn={h:0,s:0,l:0},Sn={h:0,s:0,l:0},function(t,e){this.getHSL(Cn),t.getHSL(Sn);var r=Ui.lerp(Cn.h,Sn.h,e),i=Ui.lerp(Cn.s,Sn.s,e),n=Ui.lerp(Cn.l,Sn.l,e);return this.setHSL(r,i,n),this}),equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var Mn,On={common:{diffuse:{value:new xn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Vi},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Hi(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new xn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new xn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Vi}},sprite:{diffuse:{value:new xn(15658734)},opacity:{value:1},center:{value:new Hi(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Vi}}},In={basic:{uniforms:Tn([On.common,On.specularmap,On.envmap,On.aomap,On.lightmap,On.fog]),vertexShader:yn.meshbasic_vert,fragmentShader:yn.meshbasic_frag},lambert:{uniforms:Tn([On.common,On.specularmap,On.envmap,On.aomap,On.lightmap,On.emissivemap,On.fog,On.lights,{emissive:{value:new xn(0)}}]),vertexShader:yn.meshlambert_vert,fragmentShader:yn.meshlambert_frag},phong:{uniforms:Tn([On.common,On.specularmap,On.envmap,On.aomap,On.lightmap,On.emissivemap,On.bumpmap,On.normalmap,On.displacementmap,On.gradientmap,On.fog,On.lights,{emissive:{value:new xn(0)},specular:{value:new xn(1118481)},shininess:{value:30}}]),vertexShader:yn.meshphong_vert,fragmentShader:yn.meshphong_frag},standard:{uniforms:Tn([On.common,On.envmap,On.aomap,On.lightmap,On.emissivemap,On.bumpmap,On.normalmap,On.displacementmap,On.roughnessmap,On.metalnessmap,On.fog,On.lights,{emissive:{value:new xn(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:yn.meshphysical_vert,fragmentShader:yn.meshphysical_frag},matcap:{uniforms:Tn([On.common,On.bumpmap,On.normalmap,On.displacementmap,On.fog,{matcap:{value:null}}]),vertexShader:yn.meshmatcap_vert,fragmentShader:yn.meshmatcap_frag},points:{uniforms:Tn([On.points,On.fog]),vertexShader:yn.points_vert,fragmentShader:yn.points_frag},dashed:{uniforms:Tn([On.common,On.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yn.linedashed_vert,fragmentShader:yn.linedashed_frag},depth:{uniforms:Tn([On.common,On.displacementmap]),vertexShader:yn.depth_vert,fragmentShader:yn.depth_frag},normal:{uniforms:Tn([On.common,On.bumpmap,On.normalmap,On.displacementmap,{opacity:{value:1}}]),vertexShader:yn.normal_vert,fragmentShader:yn.normal_frag},sprite:{uniforms:Tn([On.sprite,On.fog]),vertexShader:yn.sprite_vert,fragmentShader:yn.sprite_frag},background:{uniforms:{uvTransform:{value:new Vi},t2D:{value:null}},vertexShader:yn.background_vert,fragmentShader:yn.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yn.cube_vert,fragmentShader:yn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yn.equirect_vert,fragmentShader:yn.equirect_frag},distanceRGBA:{uniforms:Tn([On.common,On.displacementmap,{referencePosition:{value:new Wi},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yn.distanceRGBA_vert,fragmentShader:yn.distanceRGBA_frag},shadow:{uniforms:Tn([On.lights,On.fog,{color:{value:new xn(0)},opacity:{value:1}}]),vertexShader:yn.shadow_vert,fragmentShader:yn.shadow_frag}};function _n(){var t=null,e=!1,r=null;function i(n,a){!1!==e&&(r(n,a),t.requestAnimationFrame(i))}return{start:function(){!0!==e&&null!==r&&(t.requestAnimationFrame(i),e=!0)},stop:function(){e=!1},setAnimationLoop:function(t){r=t},setContext:function(e){t=e}}}function Ln(t){var e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var i=e.get(r);i&&(t.deleteBuffer(i.buffer),e.delete(r))},update:function(r,i){r.isInterleavedBufferAttribute&&(r=r.data);var n=e.get(r);void 0===n?e.set(r,function(e,r){var i=e.array,n=e.dynamic?35048:35044,a=t.createBuffer();t.bindBuffer(r,a),t.bufferData(r,i,n),e.onUploadCallback();var o=5126;return i instanceof Float32Array?o=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?o=5123:i instanceof Int16Array?o=5122:i instanceof Uint32Array?o=5125:i instanceof Int32Array?o=5124:i instanceof Int8Array?o=5120:i instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(r,i)):n.version<r.version&&(function(e,r,i){var n=r.array,a=r.updateRange;t.bindBuffer(i,e),!1===r.dynamic?t.bufferData(i,n,35044):-1===a.count?t.bufferSubData(i,0,n):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(i,a.offset*n.BYTES_PER_ELEMENT,n.subarray(a.offset,a.offset+a.count)),a.count=-1)}(n.buffer,r,i),n.version=r.version)}}}function Pn(t,e,r,i,n,a){this.a=t,this.b=e,this.c=r,this.normal=i&&i.isVector3?i:new Wi,this.vertexNormals=Array.isArray(i)?i:[],this.color=n&&n.isColor?n:new xn,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==a?a:0}function Rn(t,e,r,i){this._x=t||0,this._y=e||0,this._z=r||0,this._order=i||Rn.DefaultOrder}function Fn(){this.mask=1}In.physical={uniforms:Tn([In.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:yn.meshphysical_vert,fragmentShader:yn.meshphysical_frag},Object.assign(Pn.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}),Rn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Rn.DefaultOrder="XYZ",Object.defineProperties(Rn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(Rn.prototype,{isEuler:!0,set:function(t,e,r,i){return this._x=t,this._y=e,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var i=Ui.clamp,n=t.elements,a=n[0],o=n[4],s=n[8],l=n[1],u=n[5],c=n[9],h=n[2],d=n[6],p=n[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-i(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===e?(this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,u))):"YZX"===e?(this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===e?(this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new vn;return function(e,r,i){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,r,i)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(Mn=new zi,function(t){return Mn.setFromEuler(this),this.setFromQuaternion(Mn,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Wi(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Fn.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var Dn,Nn,Bn,Gn,Un=0;function Hn(){Object.defineProperty(this,"id",{value:Un++}),this.uuid=Ui.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hn.DefaultUp.clone();var t=new Wi,e=new Rn,r=new zi,i=new Wi(1,1,1);e.onChange(function(){r.setFromEuler(e,!1)}),r.onChange(function(){e.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new vn},normalMatrix:{value:new Vi}}),this.matrix=new vn,this.matrixWorld=new vn,this.matrixAutoUpdate=Hn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Fn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Hn.DefaultUp=new Wi(0,1,0),Hn.DefaultMatrixAutoUpdate=!0,Hn.prototype=Object.assign(Object.create(ee.prototype),{constructor:Hn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:(Gn=new zi,function(t,e){return Gn.setFromAxisAngle(t,e),this.quaternion.multiply(Gn),this}),rotateOnWorldAxis:function(){var t=new zi;return function(e,r){return t.setFromAxisAngle(e,r),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new Wi(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new Wi(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new Wi(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new Wi;return function(e,r){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(r)),this}}(),translateX:function(){var t=new Wi(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new Wi(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new Wi(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(Bn=new vn,function(t){return t.applyMatrix4(Bn.getInverse(this.matrixWorld))}),lookAt:function(){var t=new zi,e=new vn,r=new Wi,i=new Wi;return function(n,a,o){n.isVector3?r.copy(n):r.set(n,a,o);var s=this.parent;this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?e.lookAt(i,r,this.up):e.lookAt(r,i,this.up),this.quaternion.setFromRotationMatrix(e),s&&(e.extractRotation(s.matrixWorld),t.setFromRotationMatrix(e),this.quaternion.premultiply(t.inverse()))}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r].getObjectByProperty(t,e);if(void 0!==n)return n}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Wi),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(Dn=new Wi,Nn=new Wi,function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new zi),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Dn,t,Nn),t}),getWorldScale:function(){var t=new Wi,e=new zi;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new Wi),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,r),r}}(),getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Wi),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,i=e.length;r<i;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,i=e.length;r<i;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,i=e.length;r<i;r++)e[r].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var i=this.children,n=0,a=i.length;n<a;n++)i[n].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function n(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==wi&&(i.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var u=o[s];n(t.shapes,u)}else n(t.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,l=this.material.length;s<l;s++)c.push(n(t.materials,this.material[s]));i.material=c}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(s=0;s<this.children.length;s++)i.children.push(this.children[s].toJSON(t).object)}if(e){var h=m(t.geometries),d=m(t.materials),p=m(t.textures),f=m(t.images);o=m(t.shapes);h.length>0&&(r.geometries=h),d.length>0&&(r.materials=d),p.length>0&&(r.textures=p),f.length>0&&(r.images=f),o.length>0&&(r.shapes=o)}return r.object=i,r;function m(t){var e=[];for(var r in t){var i=t[r];delete i.metadata,e.push(i)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++){var i=t.children[r];this.add(i.clone())}return this}});var zn,Wn,Vn=0;function Yn(){Object.defineProperty(this,"id",{value:Vn+=2}),this.uuid=Ui.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function jn(t,e,r){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Xn(t,e,r){jn.call(this,new Int8Array(t),e,r)}function qn(t,e,r){jn.call(this,new Uint8Array(t),e,r)}function Zn(t,e,r){jn.call(this,new Uint8ClampedArray(t),e,r)}function Kn(t,e,r){jn.call(this,new Int16Array(t),e,r)}function Qn(t,e,r){jn.call(this,new Uint16Array(t),e,r)}function Jn(t,e,r){jn.call(this,new Int32Array(t),e,r)}function $n(t,e,r){jn.call(this,new Uint32Array(t),e,r)}function ta(t,e,r){jn.call(this,new Float32Array(t),e,r)}function ea(t,e,r){jn.call(this,new Float64Array(t),e,r)}function ra(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function ia(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,i=t.length;r<i;++r)t[r]>e&&(e=t[r]);return e}Yn.prototype=Object.assign(Object.create(ee.prototype),{constructor:Yn,isGeometry:!0,applyMatrix:function(t){for(var e=(new Vi).getNormalMatrix(t),r=0,i=this.vertices.length;r<i;r++){this.vertices[r].applyMatrix4(t)}for(r=0,i=this.faces.length;r<i;r++){var n=this.faces[r];n.normal.applyMatrix3(e).normalize();for(var a=0,o=n.vertexNormals.length;a<o;a++)n.vertexNormals[a].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new vn;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new vn;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new vn;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new vn;return function(e,r,i){return t.makeTranslation(e,r,i),this.applyMatrix(t),this}}(),scale:function(){var t=new vn;return function(e,r,i){return t.makeScale(e,r,i),this.applyMatrix(t),this}}(),lookAt:(Wn=new Hn,function(t){Wn.lookAt(t),Wn.updateMatrix(),this.applyMatrix(Wn.matrix)}),fromBufferGeometry:function(t){var e=this,r=null!==t.index?t.index.array:void 0,i=t.attributes,n=i.position.array,a=void 0!==i.normal?i.normal.array:void 0,o=void 0!==i.color?i.color.array:void 0,s=void 0!==i.uv?i.uv.array:void 0,l=void 0!==i.uv2?i.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var u=0,c=0;u<n.length;u+=3,c+=2)e.vertices.push((new Wi).fromArray(n,u)),void 0!==o&&e.colors.push((new xn).fromArray(o,u));function h(t,r,i,n){var u=void 0===o?[]:[e.colors[t].clone(),e.colors[r].clone(),e.colors[i].clone()],c=new Pn(t,r,i,void 0===a?[]:[(new Wi).fromArray(a,3*t),(new Wi).fromArray(a,3*r),(new Wi).fromArray(a,3*i)],u,n);e.faces.push(c),void 0!==s&&e.faceVertexUvs[0].push([(new Hi).fromArray(s,2*t),(new Hi).fromArray(s,2*r),(new Hi).fromArray(s,2*i)]),void 0!==l&&e.faceVertexUvs[1].push([(new Hi).fromArray(l,2*t),(new Hi).fromArray(l,2*r),(new Hi).fromArray(l,2*i)])}var d=t.groups;if(d.length>0)for(u=0;u<d.length;u++)for(var p=d[u],f=p.start,m=(c=f,f+p.count);c<m;c+=3)void 0!==r?h(r[c],r[c+1],r[c+2],p.materialIndex):h(c,c+1,c+2,p.materialIndex);else if(void 0!==r)for(u=0;u<r.length;u+=3)h(r[u],r[u+1],r[u+2]);else for(u=0;u<n.length/3;u+=3)h(u,u+1,u+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:(zn=new Wi,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(zn).negate(),this.translate(zn.x,zn.y,zn.z),this}),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=0===e?1:1/e,i=new vn;return i.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var t=new Wi,e=new Wi,r=0,i=this.faces.length;r<i;r++){var n=this.faces[r],a=this.vertices[n.a],o=this.vertices[n.b],s=this.vertices[n.c];t.subVectors(s,o),e.subVectors(a,o),t.cross(e),t.normalize(),n.normal.copy(t)}},computeVertexNormals:function(t){var e,r,i,n,a,o;for(void 0===t&&(t=!0),o=new Array(this.vertices.length),e=0,r=this.vertices.length;e<r;e++)o[e]=new Wi;if(t){var s,l,u,c=new Wi,h=new Wi;for(i=0,n=this.faces.length;i<n;i++)a=this.faces[i],s=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c],c.subVectors(u,l),h.subVectors(s,l),c.cross(h),o[a.a].add(c),o[a.b].add(c),o[a.c].add(c)}else for(this.computeFaceNormals(),i=0,n=this.faces.length;i<n;i++)o[(a=this.faces[i]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(e=0,r=this.vertices.length;e<r;e++)o[e].normalize();for(i=0,n=this.faces.length;i<n;i++){var d=(a=this.faces[i]).vertexNormals;3===d.length?(d[0].copy(o[a.a]),d[1].copy(o[a.b]),d[2].copy(o[a.c])):(d[0]=o[a.a].clone(),d[1]=o[a.b].clone(),d[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,r;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var i=(r=this.faces[t]).vertexNormals;3===i.length?(i[0].copy(r.normal),i[1].copy(r.normal),i[2].copy(r.normal)):(i[0]=r.normal.clone(),i[1]=r.normal.clone(),i[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r,i,n;for(r=0,i=this.faces.length;r<i;r++)for((n=this.faces[r]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),t=0,e=n.vertexNormals.length;t<e;t++)n.__originalVertexNormals[t]?n.__originalVertexNormals[t].copy(n.vertexNormals[t]):n.__originalVertexNormals[t]=n.vertexNormals[t].clone();var a=new Yn;for(a.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var o=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)l=new Wi,u={a:new Wi,b:new Wi,c:new Wi},o.push(l),s.push(u)}var l,u,c=this.morphNormals[t];for(a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals(),r=0,i=this.faces.length;r<i;r++)n=this.faces[r],l=c.faceNormals[r],u=c.vertexNormals[r],l.copy(n.normal),u.a.copy(n.vertexNormals[0]),u.b.copy(n.vertexNormals[1]),u.c.copy(n.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)(n=this.faces[r]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new fn),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new mn),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var i,n=this.vertices.length,a=this.vertices,o=t.vertices,s=this.faces,l=t.faces,u=this.faceVertexUvs[0],c=t.faceVertexUvs[0],h=this.colors,d=t.colors;void 0===r&&(r=0),void 0!==e&&(i=(new Vi).getNormalMatrix(e));for(var p=0,f=o.length;p<f;p++){var m=o[p].clone();void 0!==e&&m.applyMatrix4(e),a.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var g,b,v,y=l[p],A=y.vertexNormals,T=y.vertexColors;(g=new Pn(y.a+n,y.b+n,y.c+n)).normal.copy(y.normal),void 0!==i&&g.normal.applyMatrix3(i).normalize();for(var C=0,S=A.length;C<S;C++)b=A[C].clone(),void 0!==i&&b.applyMatrix3(i).normalize(),g.vertexNormals.push(b);g.color.copy(y.color);for(C=0,S=T.length;C<S;C++)v=T[C],g.vertexColors.push(v.clone());g.materialIndex=y.materialIndex+r,s.push(g)}for(p=0,f=c.length;p<f;p++){var E=c[p],w=[];if(void 0!==E){for(C=0,S=E.length;C<S;C++)w.push(E[C].clone());u.push(w)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,r,i,n,a,o,s,l={},u=[],c=[],h=Math.pow(10,4);for(r=0,i=this.vertices.length;r<i;r++)t=this.vertices[r],void 0===l[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(l[e]=r,u.push(this.vertices[r]),c[r]=u.length-1):c[r]=c[l[e]];var d=[];for(r=0,i=this.faces.length;r<i;r++){(n=this.faces[r]).a=c[n.a],n.b=c[n.b],n.c=c[n.c],a=[n.a,n.b,n.c];for(var p=0;p<3;p++)if(a[p]===a[(p+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var f=d[r];for(this.faces.splice(f,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(f,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var i=t[e];this.vertices.push(new Wi(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var i,n,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===e&&(i=[]),o&&o.length===e&&(n=[]);for(r=0;r<e;r++){var s=t[r]._id;i&&i.push(a[s]),n&&n.push(o[s])}i&&(this.faceVertexUvs[0]=i),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}for(var i=[],n=0;n<this.vertices.length;n++){var a=this.vertices[n];i.push(a.x,a.y,a.z)}var o=[],s=[],l={},u=[],c={},h=[],d={};for(n=0;n<this.faces.length;n++){var p=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=p.normal.length()>0,g=p.vertexNormals.length>0,b=1!==p.color.r||1!==p.color.g||1!==p.color.b,v=p.vertexColors.length>0,y=0;if(y=S(y,0,0),y=S(y,1,!0),y=S(y,2,!1),y=S(y,3,f),y=S(y,4,m),y=S(y,5,g),y=S(y,6,b),y=S(y,7,v),o.push(y),o.push(p.a,p.b,p.c),o.push(p.materialIndex),f){var A=this.faceVertexUvs[0][n];o.push(k(A[0]),k(A[1]),k(A[2]))}if(m&&o.push(E(p.normal)),g){var T=p.vertexNormals;o.push(E(T[0]),E(T[1]),E(T[2]))}if(b&&o.push(w(p.color)),v){var C=p.vertexColors;o.push(w(C[0]),w(C[1]),w(C[2]))}}function S(t,e,r){return r?t|1<<e:t&~(1<<e)}function E(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==l[e]?l[e]:(l[e]=s.length/3,s.push(t.x,t.y,t.z),l[e])}function w(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==c[e]?c[e]:(c[e]=u.length,u.push(t.getHex()),c[e])}function k(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]?d[e]:(d[e]=h.length/2,h.push(t.x,t.y),d[e])}return t.data={},t.data.vertices=i,t.data.normals=s,u.length>0&&(t.data.colors=u),h.length>0&&(t.data.uvs=[h]),t.data.faces=o,t},clone:function(){return(new Yn).copy(this)},copy:function(t){var e,r,i,n,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,r=s.length;e<r;e++)this.vertices.push(s[e].clone());var l=t.colors;for(e=0,r=l.length;e<r;e++)this.colors.push(l[e].clone());var u=t.faces;for(e=0,r=u.length;e<r;e++)this.faces.push(u[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),i=0,n=c.length;i<n;i++){var h=c[i],d=[];for(a=0,o=h.length;a<o;a++){var p=h[a];d.push(p.clone())}this.faceVertexUvs[e].push(d)}}var f=t.morphTargets;for(e=0,r=f.length;e<r;e++){var m={};if(m.name=f[e].name,void 0!==f[e].vertices)for(m.vertices=[],i=0,n=f[e].vertices.length;i<n;i++)m.vertices.push(f[e].vertices[i].clone());if(void 0!==f[e].normals)for(m.normals=[],i=0,n=f[e].normals.length;i<n;i++)m.normals.push(f[e].normals[i].clone());this.morphTargets.push(m)}var g=t.morphNormals;for(e=0,r=g.length;e<r;e++){var b={};if(void 0!==g[e].vertexNormals)for(b.vertexNormals=[],i=0,n=g[e].vertexNormals.length;i<n;i++){var v=g[e].vertexNormals[i],y={};y.a=v.a.clone(),y.b=v.b.clone(),y.c=v.c.clone(),b.vertexNormals.push(y)}if(void 0!==g[e].faceNormals)for(b.faceNormals=[],i=0,n=g[e].faceNormals.length;i<n;i++)b.faceNormals.push(g[e].faceNormals[i].clone());this.morphNormals.push(b)}var A=t.skinWeights;for(e=0,r=A.length;e<r;e++)this.skinWeights.push(A[e].clone());var T=t.skinIndices;for(e=0,r=T.length;e<r;e++)this.skinIndices.push(T[e].clone());var C=t.lineDistances;for(e=0,r=C.length;e<r;e++)this.lineDistances.push(C[e]);var S=t.boundingBox;null!==S&&(this.boundingBox=S.clone());var E=t.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(jn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(jn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==t?t.length/this.itemSize:0,this.array=t,this},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[r+i];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,i=0,n=t.length;i<n;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new xn),e[r++]=a.r,e[r++]=a.g,e[r++]=a.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,i=0,n=t.length;i<n;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new Hi),e[r++]=a.x,e[r++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,i=0,n=t.length;i<n;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new Wi),e[r++]=a.x,e[r++]=a.y,e[r++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,i=0,n=t.length;i<n;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new un),e[r++]=a.x,e[r++]=a.y,e[r++]=a.z,e[r++]=a.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this},setXYZW:function(t,e,r,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this.array[t+3]=n,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),Xn.prototype=Object.create(jn.prototype),Xn.prototype.constructor=Xn,qn.prototype=Object.create(jn.prototype),qn.prototype.constructor=qn,Zn.prototype=Object.create(jn.prototype),Zn.prototype.constructor=Zn,Kn.prototype=Object.create(jn.prototype),Kn.prototype.constructor=Kn,Qn.prototype=Object.create(jn.prototype),Qn.prototype.constructor=Qn,Jn.prototype=Object.create(jn.prototype),Jn.prototype.constructor=Jn,$n.prototype=Object.create(jn.prototype),$n.prototype.constructor=$n,ta.prototype=Object.create(jn.prototype),ta.prototype.constructor=ta,ea.prototype=Object.create(jn.prototype),ea.prototype.constructor=ea,Object.assign(ra.prototype,{computeGroups:function(t){for(var e,r=[],i=void 0,n=t.faces,a=0;a<n.length;a++){var o=n[a];o.materialIndex!==i&&(i=o.materialIndex,void 0!==e&&(e.count=3*a-e.start,r.push(e)),e={start:3*a,materialIndex:i})}void 0!==e&&(e.count=3*a-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,r=t.faces,i=t.vertices,n=t.faceVertexUvs,a=n[0]&&n[0].length>0,o=n[1]&&n[1].length>0,s=t.morphTargets,l=s.length;if(l>0){e=[];for(var u=0;u<l;u++)e[u]={name:s[u].name,data:[]};this.morphTargets.position=e}var c,h=t.morphNormals,d=h.length;if(d>0){c=[];for(u=0;u<d;u++)c[u]={name:h[u].name,data:[]};this.morphTargets.normal=c}var p=t.skinIndices,f=t.skinWeights,m=p.length===i.length,g=f.length===i.length;i.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(u=0;u<r.length;u++){var b=r[u];this.vertices.push(i[b.a],i[b.b],i[b.c]);var v=b.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{var y=b.normal;this.normals.push(y,y,y)}var A,T=b.vertexColors;if(3===T.length)this.colors.push(T[0],T[1],T[2]);else{var C=b.color;this.colors.push(C,C,C)}if(!0===a)void 0!==(A=n[0][u])?this.uvs.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new Hi,new Hi,new Hi));if(!0===o)void 0!==(A=n[1][u])?this.uvs2.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new Hi,new Hi,new Hi));for(var S=0;S<l;S++){var E=s[S].vertices;e[S].data.push(E[b.a],E[b.b],E[b.c])}for(S=0;S<d;S++){var w=h[S].vertexNormals[u];c[S].data.push(w.a,w.b,w.c)}m&&this.skinIndices.push(p[b.a],p[b.b],p[b.c]),g&&this.skinWeights.push(f[b.a],f[b.b],f[b.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var na=1;function aa(){Object.defineProperty(this,"id",{value:na+=2}),this.uuid=Ui.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function oa(t,e,r,i,n,a){Yn.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:i,heightSegments:n,depthSegments:a},this.fromBufferGeometry(new sa(t,e,r,i,n,a)),this.mergeVertices()}function sa(t,e,r,i,n,a){aa.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:i,heightSegments:n,depthSegments:a};var o=this;t=t||1,e=e||1,r=r||1,i=Math.floor(i)||1,n=Math.floor(n)||1,a=Math.floor(a)||1;var s=[],l=[],u=[],c=[],h=0,d=0;function p(t,e,r,i,n,a,p,f,m,g,b){var v,y,A=a/m,T=p/g,C=a/2,S=p/2,E=f/2,w=m+1,k=g+1,x=0,M=0,O=new Wi;for(y=0;y<k;y++){var I=y*T-S;for(v=0;v<w;v++){var _=v*A-C;O[t]=_*i,O[e]=I*n,O[r]=E,l.push(O.x,O.y,O.z),O[t]=0,O[e]=0,O[r]=f>0?1:-1,u.push(O.x,O.y,O.z),c.push(v/m),c.push(1-y/g),x+=1}}for(y=0;y<g;y++)for(v=0;v<m;v++){var L=h+v+w*y,P=h+v+w*(y+1),R=h+(v+1)+w*(y+1),F=h+(v+1)+w*y;s.push(L,P,F),s.push(P,R,F),M+=6}o.addGroup(d,M,b),d+=M,h+=x}p("z","y","x",-1,-1,r,e,t,a,n,0),p("z","y","x",1,-1,r,e,-t,a,n,1),p("x","z","y",1,1,t,r,e,i,a,2),p("x","z","y",1,-1,t,r,-e,i,a,3),p("x","y","z",1,-1,t,e,r,i,n,4),p("x","y","z",-1,-1,t,e,-r,i,n,5),this.setIndex(s),this.addAttribute("position",new ta(l,3)),this.addAttribute("normal",new ta(u,3)),this.addAttribute("uv",new ta(c,2))}function la(t,e,r,i){Yn.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new ua(t,e,r,i)),this.mergeVertices()}function ua(t,e,r,i){aa.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:i};var n,a,o=(t=t||1)/2,s=(e=e||1)/2,l=Math.floor(r)||1,u=Math.floor(i)||1,c=l+1,h=u+1,d=t/l,p=e/u,f=[],m=[],g=[],b=[];for(a=0;a<h;a++){var v=a*p-s;for(n=0;n<c;n++){var y=n*d-o;m.push(y,-v,0),g.push(0,0,1),b.push(n/l),b.push(1-a/u)}}for(a=0;a<u;a++)for(n=0;n<l;n++){var A=n+c*a,T=n+c*(a+1),C=n+1+c*(a+1),S=n+1+c*a;f.push(A,T,S),f.push(T,C,S)}this.setIndex(f),this.addAttribute("position",new ta(m,3)),this.addAttribute("normal",new ta(g,3)),this.addAttribute("uv",new ta(b,2))}aa.prototype=Object.assign(Object.create(ee.prototype),{constructor:aa,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(ia(t)>65535?$n:Qn)(t,1):this.index=t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):(this.attributes[t]=e,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(t,new jn(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new Vi).getNormalMatrix(t).applyToBufferAttribute(r),r.needsUpdate=!0);var i=this.attributes.tangent;void 0!==i&&((new Vi).getNormalMatrix(t).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new vn;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new vn;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new vn;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new vn;return function(e,r,i){return t.makeTranslation(e,r,i),this.applyMatrix(t),this}}(),scale:function(){var t=new vn;return function(e,r,i){return t.makeScale(e,r,i),this.applyMatrix(t),this}}(),lookAt:function(){var t=new Hn;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){var t=new Wi;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var r=new ta(3*e.vertices.length,3),i=new ta(3*e.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(e.vertices)),this.addAttribute("color",i.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var n=new ta(e.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r];e.push(n.x,n.y,n.z||0)}return this.addAttribute("position",new ta(e,3)),this},updateFromObject:function(t){var e,r=t.geometry;if(t.isMesh){var i=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(i=void 0,r.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(r);i.verticesNeedUpdate=r.verticesNeedUpdate,i.normalsNeedUpdate=r.normalsNeedUpdate,i.colorsNeedUpdate=r.colorsNeedUpdate,i.uvsNeedUpdate=r.uvsNeedUpdate,i.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=i}return!0===r.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(r.vertices),e.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(r.normals),e.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(r.colors),e.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(r.uvs),e.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(r.lineDistances),e.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new ra).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new jn(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.addAttribute("normal",new jn(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var i=new Float32Array(3*t.colors.length);this.addAttribute("color",new jn(i,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var n=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new jn(n,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var a=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new jn(a,2).copyVector2sArray(t.uvs2))}for(var o in this.groups=t.groups,t.morphTargets){for(var s=[],l=t.morphTargets[o],u=0,c=l.length;u<c;u++){var h=l[u],d=new ta(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(t.skinIndices.length>0){var p=new ta(4*t.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var f=new ta(4*t.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){var t=new fn;return function(){null===this.boundingBox&&(this.boundingBox=new fn);var e=this.attributes.position,r=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),r)for(var i=0,n=r.length;i<n;i++){var a=r[i];t.setFromBufferAttribute(a),this.boundingBox.expandByPoint(t.min),this.boundingBox.expandByPoint(t.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var t=new fn,e=new fn,r=new Wi;return function(){null===this.boundingSphere&&(this.boundingSphere=new mn);var i=this.attributes.position,n=this.morphAttributes.position;if(i){var a=this.boundingSphere.center;if(t.setFromBufferAttribute(i),n)for(var o=0,s=n.length;o<s;o++){var l=n[o];e.setFromBufferAttribute(l),t.expandByPoint(e.min),t.expandByPoint(e.max)}t.getCenter(a);var u=0;for(o=0,s=i.count;o<s;o++)r.fromBufferAttribute(i,o),u=Math.max(u,a.distanceToSquared(r));if(n)for(o=0,s=n.length;o<s;o++)for(var c=0,h=(l=n[o]).count;c<h;c++)r.fromBufferAttribute(l,c),u=Math.max(u,a.distanceToSquared(r));this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var r=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new jn(new Float32Array(r.length),3));else for(var i=e.normal.array,n=0,a=i.length;n<a;n++)i[n]=0;var o,s,l,u=e.normal.array,c=new Wi,h=new Wi,d=new Wi,p=new Wi,f=new Wi;if(t){var m=t.array;for(n=0,a=t.count;n<a;n+=3)o=3*m[n+0],s=3*m[n+1],l=3*m[n+2],c.fromArray(r,o),h.fromArray(r,s),d.fromArray(r,l),p.subVectors(d,h),f.subVectors(c,h),p.cross(f),u[o]+=p.x,u[o+1]+=p.y,u[o+2]+=p.z,u[s]+=p.x,u[s+1]+=p.y,u[s+2]+=p.z,u[l]+=p.x,u[l+1]+=p.y,u[l+2]+=p.z}else for(n=0,a=r.length;n<a;n+=9)c.fromArray(r,n),h.fromArray(r,n+3),d.fromArray(r,n+6),p.subVectors(d,h),f.subVectors(c,h),p.cross(f),u[n]=p.x,u[n+1]=p.y,u[n+2]=p.z,u[n+3]=p.x,u[n+4]=p.y,u[n+5]=p.z,u[n+6]=p.x,u[n+7]=p.y,u[n+8]=p.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var i in r)if(void 0!==t.attributes[i])for(var n=r[i].array,a=t.attributes[i],o=a.array,s=a.itemSize*e,l=Math.min(o.length,n.length-s),u=0,c=s;u<l;u++,c++)n[c]=o[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){var t=new Wi;return function(){for(var e=this.attributes.normal,r=0,i=e.count;r<i;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.normalize(),e.setXYZ(r,t.x,t.y,t.z)}}(),toNonIndexed:function(){function t(t,e){for(var r=t.array,i=t.itemSize,n=new r.constructor(e.length*i),a=0,o=0,s=0,l=e.length;s<l;s++){a=e[s]*i;for(var u=0;u<i;u++)n[o++]=r[a++]}return new jn(n,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new aa,r=this.index.array,i=this.attributes;for(var n in i){var a=t(i[n],r);e.addAttribute(n,a)}var o=this.morphAttributes;for(n in o){for(var s=[],l=o[n],u=0,c=l.length;u<c;u++){a=t(l[u],r);s.push(a)}e.morphAttributes[n]=s}for(var h=this.groups,d=(u=0,h.length);u<d;u++){var p=h[u];e.addGroup(p.start,p.count,p.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};var i=this.index;null!==i&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var n=this.attributes;for(var r in n){var a={itemSize:(d=n[r]).itemSize,type:d.array.constructor.name,array:Array.prototype.slice.call(d.array),normalized:d.normalized};""!==d.name&&(a.name=d.name),t.data.attributes[r]=a}var o={},s=!1;for(var r in this.morphAttributes){for(var l=this.morphAttributes[r],u=[],c=0,h=l.length;c<h;c++){var d;a={itemSize:(d=l[c]).itemSize,type:d.array.constructor.name,array:Array.prototype.slice.call(d.array),normalized:d.normalized};""!==d.name&&(a.name=d.name),u.push(a)}u.length>0&&(o[r]=u,s=!0)}s&&(t.data.morphAttributes=o);var p=this.groups;p.length>0&&(t.data.groups=JSON.parse(JSON.stringify(p)));var f=this.boundingSphere;return null!==f&&(t.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),t},clone:function(){return(new aa).copy(this)},copy:function(t){var e,r,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var n=t.index;null!==n&&this.setIndex(n.clone());var a=t.attributes;for(e in a){var o=a[e];this.addAttribute(e,o.clone())}var s=t.morphAttributes;for(e in s){var l=[],u=s[e];for(r=0,i=u.length;r<i;r++)l.push(u[r].clone());this.morphAttributes[e]=l}var c=t.groups;for(r=0,i=c.length;r<i;r++){var h=c[r];this.addGroup(h.start,h.count,h.materialIndex)}var d=t.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=t.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),oa.prototype=Object.create(Yn.prototype),oa.prototype.constructor=oa,sa.prototype=Object.create(aa.prototype),sa.prototype.constructor=sa,la.prototype=Object.create(Yn.prototype),la.prototype.constructor=la,ua.prototype=Object.create(aa.prototype),ua.prototype.constructor=ua;var ca=0;function ha(){Object.defineProperty(this,"id",{value:ca++}),this.uuid=Ui.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=we,this.side=ge,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=Te,this.opacity=1,this.transparent=!1,this.blendSrc=Ge,this.blendDst=Ue,this.blendEquation=Ie,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ze,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}ha.prototype=Object.assign(Object.create(ee.prototype),{constructor:ha,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0!==r)if("shading"!==e){var i=this[e];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[e]=r:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===ye;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){var e=[];for(var r in t){var i=t[r];delete i.metadata,e.push(i)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==we&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==ge&&(r.side=this.side),this.vertexColors!==Te&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e){var n=i(t.textures),a=i(t.images);n.length>0&&(r.textures=n),a.length>0&&(r.images=a)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,r=null;if(null!==e){var i=e.length;r=new Array(i);for(var n=0;n!==i;++n)r[n]=e[n].clone()}return this.clippingPlanes=r,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var da,pa,fa,ma,ga,ba,va,ya,Aa,Ta,Ca,Sa,Ea="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",wa="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ka(t){ha.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Ea,this.fragmentShader=wa,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function xa(t,e){this.origin=void 0!==t?t:new Wi,this.direction=void 0!==e?e:new Wi}function Ma(t,e,r){this.a=void 0!==t?t:new Wi,this.b=void 0!==e?e:new Wi,this.c=void 0!==r?r:new Wi}function Oa(t){ha.call(this),this.type="MeshBasicMaterial",this.color=new xn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=tr,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function Ia(t,e){Hn.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new aa,this.material=void 0!==e?e:new Oa({color:16777215*Math.random()}),this.drawMode=wi,this.updateMorphTargets()}function _a(t,e,r,i){var n,a,o=new xn(0),s=0,l=null,u=0;function c(t,r){e.buffers.color.setClear(t.r,t.g,t.b,r,i)}return{getClearColor:function(){return o},setClearColor:function(t,e){o.set(t),c(o,s=void 0!==e?e:1)},getClearAlpha:function(){return s},setClearAlpha:function(t){c(o,s=t)},render:function(e,i,h,d){var p=i.background,f=t.vr,m=f.getSession&&f.getSession();if(m&&"additive"===m.environmentBlendMode&&(p=null),null===p?(c(o,s),l=null,u=0):p&&p.isColor&&(c(p,1),d=!0,l=null,u=0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),p&&(p.isCubeTexture||p.isWebGLRenderTargetCube)){void 0===a&&((a=new Ia(new sa(1,1,1),new ka({type:"BackgroundCubeMaterial",uniforms:An(In.cube.uniforms),vertexShader:In.cube.vertexShader,fragmentShader:In.cube.fragmentShader,side:be,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(t,e,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.tCube.value}}),r.update(a));var g=p.isWebGLRenderTargetCube?p.texture:p;a.material.uniforms.tCube.value=g,a.material.uniforms.tFlip.value=p.isWebGLRenderTargetCube?1:-1,l===p&&u===g.version||(a.material.needsUpdate=!0,l=p,u=g.version),e.unshift(a,a.geometry,a.material,0,0,null)}else p&&p.isTexture&&(void 0===n&&((n=new Ia(new ua(2,2),new ka({type:"BackgroundMaterial",uniforms:An(In.background.uniforms),vertexShader:In.background.vertexShader,fragmentShader:In.background.fragmentShader,side:ge,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(n.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(n)),n.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),n.material.uniforms.uvTransform.value.copy(p.matrix),l===p&&u===p.version||(n.material.needsUpdate=!0,l=p,u=p.version),e.unshift(n,n.geometry,n.material,0,0,null))}}}function La(t,e,r,i){var n;this.setMode=function(t){n=t},this.render=function(e,i){t.drawArrays(n,e,i),r.update(i,n)},this.renderInstances=function(a,o,s){var l;if(i.isWebGL2)l=t;else if(null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[i.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](n,o,s,a.maxInstancedCount),r.update(s,n,a.maxInstancedCount)}}function Pa(t,e,r){var i;function n(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,o=void 0!==r.precision?r.precision:"highp",s=n(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===r.logarithmicDepthBuffer,u=t.getParameter(34930),c=t.getParameter(35660),h=t.getParameter(3379),d=t.getParameter(34076),p=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),b=c>0,v=a||!!e.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==i)return i;var r=e.get("EXT_texture_filter_anisotropic");return i=null!==r?t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:b,floatFragmentTextures:v,floatVertexTextures:b&&v,maxSamples:a?t.getParameter(36183):0}}function Ra(){var t=this,e=null,r=0,i=!1,n=!1,a=new gn,o=new Vi,s={value:null,needsUpdate:!1};function l(){s.value!==e&&(s.value=e,s.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(e,r,i,n){var l=null!==e?e.length:0,u=null;if(0!==l){if(u=s.value,!0!==n||null===u){var c=i+4*l,h=r.matrixWorldInverse;o.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var d=0,p=i;d!==l;++d,p+=4)a.copy(e[d]).applyMatrix4(h,o),a.normal.toArray(u,p),u[p+3]=a.constant}s.value=u,s.needsUpdate=!0}return t.numPlanes=l,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(t,n,a){var o=0!==t.length||n||0!==r||i;return i=n,e=u(t,a,0),r=t.length,o},this.beginShadows=function(){n=!0,u(null)},this.endShadows=function(){n=!1,l()},this.setState=function(t,a,o,c,h,d){if(!i||null===t||0===t.length||n&&!o)n?u(null):l();else{var p=n?0:r,f=4*p,m=h.clippingState||null;s.value=m,m=u(t,c,f,d);for(var g=0;g!==f;++g)m[g]=e[g];h.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=p}}}function Fa(t){var e={};return{get:function(r){if(void 0!==e[r])return e[r];var i;switch(r){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(r)}return null===i&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),e[r]=i,i}}}function Da(t,e,r){var i={},n={};function a(t){var o=t.target,s=i[o.id];for(var l in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[l]);o.removeEventListener("dispose",a),delete i[o.id];var u=n[s.id];u&&(e.remove(u),delete n[s.id]),r.memory.geometries--}return{get:function(t,e){var n=i[e.id];return n||(e.addEventListener("dispose",a),e.isBufferGeometry?n=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new aa).setFromObject(t)),n=e._bufferGeometry),i[e.id]=n,r.memory.geometries++,n)},update:function(t){var r=t.index,i=t.attributes;for(var n in null!==r&&e.update(r,34963),i)e.update(i[n],34962);var a=t.morphAttributes;for(var n in a)for(var o=a[n],s=0,l=o.length;s<l;s++)e.update(o[s],34962)},getWireframeAttribute:function(t){var r=n[t.id];if(r)return r;var i,a=[],o=t.index,s=t.attributes;if(null!==o)for(var l=0,u=(i=o.array).length;l<u;l+=3){var c=i[l+0],h=i[l+1],d=i[l+2];a.push(c,h,h,d,d,c)}else for(l=0,u=(i=s.position.array).length/3-1;l<u;l+=3)c=l+0,h=l+1,d=l+2,a.push(c,h,h,d,d,c);return r=new(ia(a)>65535?$n:Qn)(a,1),e.update(r,34963),n[t.id]=r,r}}}function Na(t,e,r,i){var n,a,o;this.setMode=function(t){n=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,i){t.drawElements(n,i,a,e*o),r.update(i,n)},this.renderInstances=function(s,l,u){var c;if(i.isWebGL2)c=t;else if(null===(c=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[i.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](n,u,a,l*o,s.maxInstancedCount),r.update(u,n,s.maxInstancedCount)}}function Ba(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,r,i){switch(i=i||1,e.calls++,r){case 4:e.triangles+=i*(t/3);break;case 5:case 6:e.triangles+=i*(t-2);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Ga(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Ua(t){var e={},r=new Float32Array(8);return{update:function(i,n,a,o){var s=i.morphTargetInfluences,l=s.length,u=e[n.id];if(void 0===u){u=[];for(var c=0;c<l;c++)u[c]=[c,0];e[n.id]=u}var h=a.morphTargets&&n.morphAttributes.position,d=a.morphNormals&&n.morphAttributes.normal;for(c=0;c<l;c++)0!==(p=u[c])[1]&&(h&&n.removeAttribute("morphTarget"+c),d&&n.removeAttribute("morphNormal"+c));for(c=0;c<l;c++)(p=u[c])[0]=c,p[1]=s[c];for(u.sort(Ga),c=0;c<8;c++){var p;if(p=u[c]){var f=p[0],m=p[1];if(m){h&&n.addAttribute("morphTarget"+c,h[f]),d&&n.addAttribute("morphNormal"+c,d[f]),r[c]=m;continue}}r[c]=0}o.getUniforms().setValue(t,"morphTargetInfluences",r)}}}function Ha(t,e){var r={};return{update:function(i){var n=e.render.frame,a=i.geometry,o=t.get(i,a);return r[o.id]!==n&&(a.isGeometry&&o.updateFromObject(i),t.update(o),r[o.id]=n),o},dispose:function(){r={}}}}function za(t,e,r,i,n,a,o,s,l,u){t=void 0!==t?t:[],e=void 0!==e?e:cr,o=void 0!==o?o:Gr,ln.call(this,t,e,r,i,n,a,o,s,l,u),this.flipY=!1}function Wa(t,e,r,i){ln.call(this,null),this.image={data:t,width:e,height:r,depth:i},this.magFilter=Ar,this.minFilter=Ar,this.wrapR=vr,this.generateMipmaps=!1,this.flipY=!1}function Va(t,e,r,i){ln.call(this,null),this.image={data:t,width:e,height:r,depth:i},this.magFilter=Ar,this.minFilter=Ar,this.wrapR=vr,this.generateMipmaps=!1,this.flipY=!1}ka.prototype=Object.create(ha.prototype),ka.prototype.constructor=ka,ka.prototype.isShaderMaterial=!0,ka.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=An(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},ka.prototype.toJSON=function(t){var e=ha.prototype.toJSON.call(this,t);for(var r in e.uniforms={},this.uniforms){var i=this.uniforms[r].value;i&&i.isTexture?e.uniforms[r]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[r]={type:"m4",value:i.toArray()}:e.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var n={};for(var a in this.extensions)!0===this.extensions[a]&&(n[a]=!0);return Object.keys(n).length>0&&(e.extensions=n),e},Object.assign(xa.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Wi),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new Wi;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Wi),e.subVectors(t,this.origin);var r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new Wi;return function(e){var r=t.subVectors(e,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(r).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:(pa=new Wi,fa=new Wi,ma=new Wi,function(t,e,r,i){pa.copy(t).add(e).multiplyScalar(.5),fa.copy(e).sub(t).normalize(),ma.copy(this.origin).sub(pa);var n,a,o,s,l=.5*t.distanceTo(e),u=-this.direction.dot(fa),c=ma.dot(this.direction),h=-ma.dot(fa),d=ma.lengthSq(),p=Math.abs(1-u*u);if(p>0)if(a=u*c-h,s=l*p,(n=u*h-c)>=0)if(a>=-s)if(a<=s){var f=1/p;o=(n*=f)*(n+u*(a*=f)+2*c)+a*(u*n+a+2*h)+d}else a=l,o=-(n=Math.max(0,-(u*a+c)))*n+a*(a+2*h)+d;else a=-l,o=-(n=Math.max(0,-(u*a+c)))*n+a*(a+2*h)+d;else a<=-s?o=-(n=Math.max(0,-(-u*l+c)))*n+(a=n>0?-l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d:a<=s?(n=0,o=(a=Math.min(Math.max(-l,-h),l))*(a+2*h)+d):o=-(n=Math.max(0,-(u*l+c)))*n+(a=n>0?l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d;else a=u>0?-l:l,o=-(n=Math.max(0,-(u*a+c)))*n+a*(a+2*h)+d;return r&&r.copy(this.direction).multiplyScalar(n).add(this.origin),i&&i.copy(fa).multiplyScalar(a).add(pa),o}),intersectSphere:function(){var t=new Wi;return function(e,r){t.subVectors(e.center,this.origin);var i=t.dot(this.direction),n=t.dot(t)-i*i,a=e.radius*e.radius;if(n>a)return null;var o=Math.sqrt(a-n),s=i-o,l=i+o;return s<0&&l<0?null:s<0?this.at(l,r):this.at(s,r)}}(),intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r,i,n,a,o,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(r=(t.min.x-h.x)*l,i=(t.max.x-h.x)*l):(r=(t.max.x-h.x)*l,i=(t.min.x-h.x)*l),u>=0?(n=(t.min.y-h.y)*u,a=(t.max.y-h.y)*u):(n=(t.max.y-h.y)*u,a=(t.min.y-h.y)*u),r>a||n>i?null:((n>r||r!=r)&&(r=n),(a<i||i!=i)&&(i=a),c>=0?(o=(t.min.z-h.z)*c,s=(t.max.z-h.z)*c):(o=(t.max.z-h.z)*c,s=(t.min.z-h.z)*c),r>s||o>i?null:((o>r||r!=r)&&(r=o),(s<i||i!=i)&&(i=s),i<0?null:this.at(r>=0?r:i,e)))},intersectsBox:(da=new Wi,function(t){return null!==this.intersectBox(t,da)}),intersectTriangle:function(){var t=new Wi,e=new Wi,r=new Wi,i=new Wi;return function(n,a,o,s,l){e.subVectors(a,n),r.subVectors(o,n),i.crossVectors(e,r);var u,c=this.direction.dot(i);if(c>0){if(s)return null;u=1}else{if(!(c<0))return null;u=-1,c=-c}t.subVectors(this.origin,n);var h=u*this.direction.dot(r.crossVectors(t,r));if(h<0)return null;var d=u*this.direction.dot(e.cross(t));if(d<0)return null;if(h+d>c)return null;var p=-u*t.dot(i);return p<0?null:this.at(p/c,l)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(Ma,{getNormal:(ba=new Wi,function(t,e,r,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Wi),i.subVectors(r,e),ba.subVectors(t,e),i.cross(ba);var n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}),getBarycoord:function(){var t=new Wi,e=new Wi,r=new Wi;return function(i,n,a,o,s){t.subVectors(o,n),e.subVectors(a,n),r.subVectors(i,n);var l=t.dot(t),u=t.dot(e),c=t.dot(r),h=e.dot(e),d=e.dot(r),p=l*h-u*u;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Wi),0===p)return s.set(-2,-1,-1);var f=1/p,m=(h*c-u*d)*f,g=(l*d-u*c)*f;return s.set(1-m-g,g,m)}}(),containsPoint:function(){var t=new Wi;return function(e,r,i,n){return Ma.getBarycoord(e,r,i,n,t),t.x>=0&&t.y>=0&&t.x+t.y<=1}}(),getUV:(ga=new Wi,function(t,e,r,i,n,a,o,s){return this.getBarycoord(t,e,r,i,ga),s.set(0,0),s.addScaledVector(n,ga.x),s.addScaledVector(a,ga.y),s.addScaledVector(o,ga.z),s})}),Object.assign(Ma.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,i){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){var t=new Wi,e=new Wi;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Wi),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Ma.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Wi),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return Ma.getBarycoord(t,this.a,this.b,this.c,e)},containsPoint:function(t){return Ma.containsPoint(t,this.a,this.b,this.c)},getUV:function(t,e,r,i,n){return Ma.getUV(t,this.a,this.b,this.c,e,r,i,n)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:(va=new Wi,ya=new Wi,Aa=new Wi,Ta=new Wi,Ca=new Wi,Sa=new Wi,function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Wi);var r,i,n=this.a,a=this.b,o=this.c;va.subVectors(a,n),ya.subVectors(o,n),Ta.subVectors(t,n);var s=va.dot(Ta),l=ya.dot(Ta);if(s<=0&&l<=0)return e.copy(n);Ca.subVectors(t,a);var u=va.dot(Ca),c=ya.dot(Ca);if(u>=0&&c<=u)return e.copy(a);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return r=s/(s-u),e.copy(n).addScaledVector(va,r);Sa.subVectors(t,o);var d=va.dot(Sa),p=ya.dot(Sa);if(p>=0&&d<=p)return e.copy(o);var f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return i=l/(l-p),e.copy(n).addScaledVector(ya,i);var m=u*p-d*c;if(m<=0&&c-u>=0&&d-p>=0)return Aa.subVectors(o,a),i=(c-u)/(c-u+(d-p)),e.copy(a).addScaledVector(Aa,i);var g=1/(m+f+h);return r=f*g,i=h*g,e.copy(n).addScaledVector(va,r).addScaledVector(ya,i)}),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),Oa.prototype=Object.create(ha.prototype),Oa.prototype.constructor=Oa,Oa.prototype.isMeshBasicMaterial=!0,Oa.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},Ia.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Ia,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return Hn.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,r,i=this.geometry;if(i.isBufferGeometry){var n=i.morphAttributes,a=Object.keys(n);if(a.length>0){var o=n[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)r=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(){var t=new vn,e=new xa,r=new mn,i=new Wi,n=new Wi,a=new Wi,o=new Wi,s=new Wi,l=new Wi,u=new Wi,c=new Wi,h=new Wi,d=new Hi,p=new Hi,f=new Hi,m=new Wi,g=new Wi;function b(t,e,r,i,n,a,o,s){if(null===(e.side===be?i.intersectTriangle(o,a,n,!0,s):i.intersectTriangle(n,a,o,e.side!==ve,s)))return null;g.copy(s),g.applyMatrix4(t.matrixWorld);var l=r.ray.origin.distanceTo(g);return l<r.near||l>r.far?null:{distance:l,point:g.clone(),object:t}}function v(t,e,r,g,v,y,A,T,C,S){i.fromBufferAttribute(v,T),n.fromBufferAttribute(v,C),a.fromBufferAttribute(v,S);var E=t.morphTargetInfluences;if(e.morphTargets&&y&&E){u.set(0,0,0),c.set(0,0,0),h.set(0,0,0);for(var w=0,k=y.length;w<k;w++){var x=E[w],M=y[w];0!==x&&(o.fromBufferAttribute(M,T),s.fromBufferAttribute(M,C),l.fromBufferAttribute(M,S),u.addScaledVector(o.sub(i),x),c.addScaledVector(s.sub(n),x),h.addScaledVector(l.sub(a),x))}i.add(u),n.add(c),a.add(h)}var O=b(t,e,r,g,i,n,a,m);if(O){A&&(d.fromBufferAttribute(A,T),p.fromBufferAttribute(A,C),f.fromBufferAttribute(A,S),O.uv=Ma.getUV(m,i,n,a,d,p,f,new Hi));var I=new Pn(T,C,S);Ma.getNormal(i,n,a,I.normal),O.face=I}return O}return function(i,n){var a,o=this.geometry,s=this.material,l=this.matrixWorld;if(void 0!==s&&(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(l),!1!==i.ray.intersectsSphere(r)&&(t.getInverse(l),e.copy(i.ray).applyMatrix4(t),null===o.boundingBox||!1!==e.intersectsBox(o.boundingBox))))if(o.isBufferGeometry){var u,c,h,g,y,A,T,C,S,E=o.index,w=o.attributes.position,k=o.morphAttributes.position,x=o.attributes.uv,M=o.groups,O=o.drawRange;if(null!==E)if(Array.isArray(s))for(g=0,A=M.length;g<A;g++)for(S=s[(C=M[g]).materialIndex],y=Math.max(C.start,O.start),T=Math.min(C.start+C.count,O.start+O.count);y<T;y+=3)u=E.getX(y),c=E.getX(y+1),h=E.getX(y+2),(a=v(this,S,i,e,w,k,x,u,c,h))&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=C.materialIndex,n.push(a));else for(g=Math.max(0,O.start),A=Math.min(E.count,O.start+O.count);g<A;g+=3)u=E.getX(g),c=E.getX(g+1),h=E.getX(g+2),(a=v(this,s,i,e,w,k,x,u,c,h))&&(a.faceIndex=Math.floor(g/3),n.push(a));else if(void 0!==w)if(Array.isArray(s))for(g=0,A=M.length;g<A;g++)for(S=s[(C=M[g]).materialIndex],y=Math.max(C.start,O.start),T=Math.min(C.start+C.count,O.start+O.count);y<T;y+=3)(a=v(this,S,i,e,w,k,x,u=y,c=y+1,h=y+2))&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=C.materialIndex,n.push(a));else for(g=Math.max(0,O.start),A=Math.min(w.count,O.start+O.count);g<A;g+=3)(a=v(this,s,i,e,w,k,x,u=g,c=g+1,h=g+2))&&(a.faceIndex=Math.floor(g/3),n.push(a))}else if(o.isGeometry){var I,_,L,P,R=Array.isArray(s),F=o.vertices,D=o.faces,N=o.faceVertexUvs[0];N.length>0&&(P=N);for(var B=0,G=D.length;B<G;B++){var U=D[B],H=R?s[U.materialIndex]:s;if(void 0!==H&&(I=F[U.a],_=F[U.b],L=F[U.c],a=b(this,H,i,e,I,_,L,m))){if(P&&P[B]){var z=P[B];d.copy(z[0]),p.copy(z[1]),f.copy(z[2]),a.uv=Ma.getUV(m,I,_,L,d,p,f,new Hi)}a.face=U,a.faceIndex=B,n.push(a)}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),za.prototype=Object.create(ln.prototype),za.prototype.constructor=za,za.prototype.isCubeTexture=!0,Object.defineProperty(za.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),Wa.prototype=Object.create(ln.prototype),Wa.prototype.constructor=Wa,Wa.prototype.isDataTexture2DArray=!0,Va.prototype=Object.create(ln.prototype),Va.prototype.constructor=Va,Va.prototype.isDataTexture3D=!0;var Ya=new ln,ja=new Wa,Xa=new Va,qa=new za,Za=[],Ka=[],Qa=new Float32Array(16),Ja=new Float32Array(9),$a=new Float32Array(4);function to(t,e,r){var i=t[0];if(i<=0||i>0)return t;var n=e*r,a=Za[n];if(void 0===a&&(a=new Float32Array(n),Za[n]=a),0!==e){i.toArray(a,0);for(var o=1,s=0;o!==e;++o)s+=r,t[o].toArray(a,s)}return a}function eo(t,e){if(t.length!==e.length)return!1;for(var r=0,i=t.length;r<i;r++)if(t[r]!==e[r])return!1;return!0}function ro(t,e){for(var r=0,i=e.length;r<i;r++)t[r]=e[r]}function io(t,e){var r=Ka[e];void 0===r&&(r=new Int32Array(e),Ka[e]=r);for(var i=0;i!==e;++i)r[i]=t.allocateTextureUnit();return r}function no(t,e){var r=this.cache;r[0]!==e&&(t.uniform1f(this.addr,e),r[0]=e)}function ao(t,e){var r=this.cache;r[0]!==e&&(t.uniform1i(this.addr,e),r[0]=e)}function oo(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),r[0]=e.x,r[1]=e.y);else{if(eo(r,e))return;t.uniform2fv(this.addr,e),ro(r,e)}}function so(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),r[0]=e.x,r[1]=e.y,r[2]=e.z);else if(void 0!==e.r)r[0]===e.r&&r[1]===e.g&&r[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),r[0]=e.r,r[1]=e.g,r[2]=e.b);else{if(eo(r,e))return;t.uniform3fv(this.addr,e),ro(r,e)}}function lo(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z&&r[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=e.w);else{if(eo(r,e))return;t.uniform4fv(this.addr,e),ro(r,e)}}function uo(t,e){var r=this.cache,i=e.elements;if(void 0===i){if(eo(r,e))return;t.uniformMatrix2fv(this.addr,!1,e),ro(r,e)}else{if(eo(r,i))return;$a.set(i),t.uniformMatrix2fv(this.addr,!1,$a),ro(r,i)}}function co(t,e){var r=this.cache,i=e.elements;if(void 0===i){if(eo(r,e))return;t.uniformMatrix3fv(this.addr,!1,e),ro(r,e)}else{if(eo(r,i))return;Ja.set(i),t.uniformMatrix3fv(this.addr,!1,Ja),ro(r,i)}}function ho(t,e){var r=this.cache,i=e.elements;if(void 0===i){if(eo(r,e))return;t.uniformMatrix4fv(this.addr,!1,e),ro(r,e)}else{if(eo(r,i))return;Qa.set(i),t.uniformMatrix4fv(this.addr,!1,Qa),ro(r,i)}}function po(t,e,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(t.uniform1i(this.addr,n),i[0]=n),r.safeSetTexture2D(e||Ya,n)}function fo(t,e,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(t.uniform1i(this.addr,n),i[0]=n),r.setTexture2DArray(e||ja,n)}function mo(t,e,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(t.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(e||Xa,n)}function go(t,e,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(t.uniform1i(this.addr,n),i[0]=n),r.safeSetTextureCube(e||qa,n)}function bo(t,e){var r=this.cache;eo(r,e)||(t.uniform2iv(this.addr,e),ro(r,e))}function vo(t,e){var r=this.cache;eo(r,e)||(t.uniform3iv(this.addr,e),ro(r,e))}function yo(t,e){var r=this.cache;eo(r,e)||(t.uniform4iv(this.addr,e),ro(r,e))}function Ao(t,e){var r=this.cache;eo(r,e)||(t.uniform1fv(this.addr,e),ro(r,e))}function To(t,e){var r=this.cache;eo(r,e)||(t.uniform1iv(this.addr,e),ro(r,e))}function Co(t,e){var r=this.cache,i=to(e,this.size,2);eo(r,i)||(t.uniform2fv(this.addr,i),this.updateCache(i))}function So(t,e){var r=this.cache,i=to(e,this.size,3);eo(r,i)||(t.uniform3fv(this.addr,i),this.updateCache(i))}function Eo(t,e){var r=this.cache,i=to(e,this.size,4);eo(r,i)||(t.uniform4fv(this.addr,i),this.updateCache(i))}function wo(t,e){var r=this.cache,i=to(e,this.size,4);eo(r,i)||(t.uniformMatrix2fv(this.addr,!1,i),this.updateCache(i))}function ko(t,e){var r=this.cache,i=to(e,this.size,9);eo(r,i)||(t.uniformMatrix3fv(this.addr,!1,i),this.updateCache(i))}function xo(t,e){var r=this.cache,i=to(e,this.size,16);eo(r,i)||(t.uniformMatrix4fv(this.addr,!1,i),this.updateCache(i))}function Mo(t,e,r){var i=this.cache,n=e.length,a=io(r,n);!1===eo(i,a)&&(t.uniform1iv(this.addr,a),ro(i,a));for(var o=0;o!==n;++o)r.safeSetTexture2D(e[o]||Ya,a[o])}function Oo(t,e,r){var i=this.cache,n=e.length,a=io(r,n);!1===eo(i,a)&&(t.uniform1iv(this.addr,a),ro(i,a));for(var o=0;o!==n;++o)r.safeSetTextureCube(e[o]||qa,a[o])}function Io(t,e,r){this.id=t,this.addr=r,this.cache=[],this.setValue=function(t){switch(t){case 5126:return no;case 35664:return oo;case 35665:return so;case 35666:return lo;case 35674:return uo;case 35675:return co;case 35676:return ho;case 35678:case 36198:return po;case 35679:return mo;case 35680:return go;case 36289:return fo;case 5124:case 35670:return ao;case 35667:case 35671:return bo;case 35668:case 35672:return vo;case 35669:case 35673:return yo}}(e.type)}function _o(t,e,r){this.id=t,this.addr=r,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Ao;case 35664:return Co;case 35665:return So;case 35666:return Eo;case 35674:return wo;case 35675:return ko;case 35676:return xo;case 35678:return Mo;case 35680:return Oo;case 5124:case 35670:return To;case 35667:case 35671:return bo;case 35668:case 35672:return vo;case 35669:case 35673:return yo}}(e.type)}function Lo(t){this.id=t,this.seq=[],this.map={}}_o.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),ro(e,t)},Lo.prototype.setValue=function(t,e,r){for(var i=this.seq,n=0,a=i.length;n!==a;++n){var o=i[n];o.setValue(t,e[o.id],r)}};var Po=/([\w\d_]+)(\])?(\[|\.)?/g;function Ro(t,e){t.seq.push(e),t.map[e.id]=e}function Fo(t,e,r){var i=t.name,n=i.length;for(Po.lastIndex=0;;){var a=Po.exec(i),o=Po.lastIndex,s=a[1],l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===n){Ro(r,void 0===u?new Io(s,t,e):new _o(s,t,e));break}var c=r.map[s];void 0===c&&Ro(r,c=new Lo(s)),r=c}}function Do(t,e){this.seq=[],this.map={};for(var r=t.getProgramParameter(e,35718),i=0;i<r;++i){var n=t.getActiveUniform(e,i);Fo(n,t.getUniformLocation(e,n.name),this)}}function No(t,e,r,i){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),!0===i&&(!1===t.getShaderParameter(n,35713)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",35633===e?"vertex":"fragment",t.getShaderInfoLog(n),function(t){for(var e=t.split("\n"),r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join("\n")}(r))),n}Do.prototype.setValue=function(t,e,r,i){var n=this.map[e];void 0!==n&&n.setValue(t,r,i)},Do.prototype.setOptional=function(t,e,r){var i=e[r];void 0!==i&&this.setValue(t,r,i)},Do.upload=function(t,e,r,i){for(var n=0,a=e.length;n!==a;++n){var o=e[n],s=r[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,i)}},Do.seqWithValue=function(t,e){for(var r=[],i=0,n=t.length;i!==n;++i){var a=t[i];a.id in e&&r.push(a)}return r};var Bo=0;function Go(t){switch(t){case Mi:return["Linear","( value )"];case Oi:return["sRGB","( value )"];case _i:return["RGBE","( value )"];case Pi:return["RGBM","( value, 7.0 )"];case Ri:return["RGBM","( value, 16.0 )"];case Fi:return["RGBD","( value, 256.0 )"];case Ii:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function Uo(t,e){var r=Go(e);return"vec4 "+t+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Ho(t,e){var r;switch(e){case nr:r="Linear";break;case ar:r="Reinhard";break;case or:r="Uncharted2";break;case sr:r="OptimizedCineon";break;case lr:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function zo(t){return""!==t}function Wo(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function Vo(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function Yo(t){return t.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(t,e){var r=yn[e];if(void 0===r)throw new Error("Can not resolve #include <"+e+">");return Yo(r)})}function jo(t){return t.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,r,i){for(var n="",a=parseInt(e);a<parseInt(r);a++)n+=i.replace(/\[ i \]/g,"[ "+a+" ]");return n})}function Xo(t,e,r,i,n,a,o,s){var l=t.context,u=i.defines,c=n.vertexShader,h=n.fragmentShader,d="SHADOWMAP_TYPE_BASIC";a.shadowMapType===fe?d="SHADOWMAP_TYPE_PCF":a.shadowMapType===me&&(d="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",f="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(i.envMap.mapping){case cr:case hr:p="ENVMAP_TYPE_CUBE";break;case mr:case gr:p="ENVMAP_TYPE_CUBE_UV";break;case dr:case pr:p="ENVMAP_TYPE_EQUIREC";break;case fr:p="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case hr:case pr:f="ENVMAP_MODE_REFRACTION"}switch(i.combine){case tr:m="ENVMAP_BLENDING_MULTIPLY";break;case er:m="ENVMAP_BLENDING_MIX";break;case rr:m="ENVMAP_BLENDING_ADD"}}var g,b,v,y,A,T=t.gammaFactor>0?t.gammaFactor:1,C=o.isWebGL2?"":function(t,e,r){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap&&!e.objectSpaceNormalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(zo).join("\n")}(i.extensions,a,e),S=function(t){var e=[];for(var r in t){var i=t[r];!1!==i&&e.push("#define "+r+" "+i)}return e.join("\n")}(u),E=l.createProgram();if(i.isRawShaderMaterial?((g=[S].filter(zo).join("\n")).length>0&&(g+="\n"),(b=[C,S].filter(zo).join("\n")).length>0&&(b+="\n")):(g=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,S,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+T,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+d:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(zo).join("\n"),b=[C,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,S,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+T,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+p:"",a.envMap?"#define "+f:"",a.envMap?"#define "+m:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+d:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(o.isWebGL2||e.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==ir?"#define TONE_MAPPING":"",a.toneMapping!==ir?yn.tonemapping_pars_fragment:"",a.toneMapping!==ir?Ho("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?yn.encodings_pars_fragment:"",a.mapEncoding?Uo("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?Uo("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?Uo("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?Uo("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?(v="linearToOutputTexel",y=a.outputEncoding,A=Go(y),"vec4 "+v+"( vec4 value ) { return LinearTo"+A[0]+A[1]+"; }"):"",a.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(zo).join("\n")),c=Vo(c=Wo(c=Yo(c),a),a),h=Vo(h=Wo(h=Yo(h),a),a),c=jo(c),h=jo(h),o.isWebGL2&&!i.isRawShaderMaterial){var w=!1,k=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&null!==c.match(k)&&null!==h.match(k)&&(w=!0,c=c.replace(k,""),h=h.replace(k,"")),g=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,b=["#version 300 es\n","#define varying in",w?"":"out highp vec4 pc_fragColor;",w?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b}var x,M,O=b+h,I=No(l,35633,g+c,t.debug.checkShaderErrors),_=No(l,35632,O,t.debug.checkShaderErrors);if(l.attachShader(E,I),l.attachShader(E,_),void 0!==i.index0AttributeName?l.bindAttribLocation(E,0,i.index0AttributeName):!0===a.morphTargets&&l.bindAttribLocation(E,0,"position"),l.linkProgram(E),t.debug.checkShaderErrors){var L=l.getProgramInfoLog(E).trim(),P=l.getShaderInfoLog(I).trim(),R=l.getShaderInfoLog(_).trim(),F=!0,D=!0;!1===l.getProgramParameter(E,35714)?(F=!1,console.error("THREE.WebGLProgram: shader error: ",l.getError(),"35715",l.getProgramParameter(E,35715),"gl.getProgramInfoLog",L,P,R)):""!==L?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",L):""!==P&&""!==R||(D=!1),D&&(this.diagnostics={runnable:F,material:i,programLog:L,vertexShader:{log:P,prefix:g},fragmentShader:{log:R,prefix:b}})}return l.deleteShader(I),l.deleteShader(_),this.getUniforms=function(){return void 0===x&&(x=new Do(l,E,s)),x},this.getAttributes=function(){return void 0===M&&(M=function(t,e){for(var r={},i=t.getProgramParameter(e,35721),n=0;n<i;n++){var a=t.getActiveAttrib(e,n).name;r[a]=t.getAttribLocation(e,a)}return r}(l,E)),M},this.destroy=function(){l.deleteProgram(E),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=n.name,this.id=Bo++,this.code=r,this.usedTimes=1,this.program=E,this.vertexShader=I,this.fragmentShader=_,this}function qo(t,e,r,i){var n=[],a={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},o=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(t,e){var r;return t?t.isTexture?r=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=t.texture.encoding):r=Mi,r===Mi&&e&&(r=Ii),r}this.getParameters=function(e,i,n,o,l,u,c){var h=a[e.type],d=c.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(r.floatVertexTextures)return 1024;var i=r.maxVertexUniforms,n=Math.floor((i-20)/4),a=Math.min(n,e.length);return a<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+a+"."),0):a}(c):0,p=r.precision;null!==e.precision&&(p=r.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",p,"instead.");var f=t.getRenderTarget();return{shaderID:h,precision:p,supportsVertexTextures:r.vertexTextures,outputEncoding:s(f?f.texture:null,t.gammaOutput),map:!!e.map,mapEncoding:s(e.map,t.gammaInput),matcap:!!e.matcap,matcapEncoding:s(e.matcap,t.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:s(e.envMap,t.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===mr||e.envMap.mapping===gr),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:s(e.emissiveMap,t.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===Gi,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,combine:e.combine,vertexTangents:e.normalMap&&e.vertexTangents,vertexColors:e.vertexColors,fog:!!o,useFog:e.fog,fogExp:o&&o.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:e.skinning&&d>0,maxBones:d,useVertexTexture:r.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:i.directional.length,numPointLights:i.point.length,numSpotLights:i.spot.length,numRectAreaLights:i.rectArea.length,numHemiLights:i.hemi.length,numClippingPlanes:l,numClipIntersection:u,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.receiveShadow&&n.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===ve,flipSided:e.side===be,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,r){var i=[];if(r.shaderID?i.push(r.shaderID):(i.push(e.fragmentShader),i.push(e.vertexShader)),void 0!==e.defines)for(var n in e.defines)i.push(n),i.push(e.defines[n]);for(var a=0;a<o.length;a++)i.push(r[o[a]]);return i.push(e.onBeforeCompile.toString()),i.push(t.gammaOutput),i.push(t.gammaFactor),i.join()},this.acquireProgram=function(a,o,s,l){for(var u,c=0,h=n.length;c<h;c++){var d=n[c];if(d.code===l){++(u=d).usedTimes;break}}return void 0===u&&(u=new Xo(t,e,l,a,o,s,r,i),n.push(u)),u},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}function Zo(){var t=new WeakMap;return{get:function(e){var r=t.get(e);return void 0===r&&(r={},t.set(e,r)),r},remove:function(e){t.delete(e)},update:function(e,r,i){t.get(e)[r]=i},dispose:function(){t=new WeakMap}}}function Ko(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Qo(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Jo(){var t=[],e=0,r=[],i=[],n={id:-1};function a(r,i,a,o,s,l){var u=t[e];return void 0===u?(u={id:r.id,object:r,geometry:i,material:a,program:a.program||n,groupOrder:o,renderOrder:r.renderOrder,z:s,group:l},t[e]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=a,u.program=a.program||n,u.groupOrder=o,u.renderOrder=r.renderOrder,u.z=s,u.group=l),e++,u}return{opaque:r,transparent:i,init:function(){e=0,r.length=0,i.length=0},push:function(t,e,n,o,s,l){var u=a(t,e,n,o,s,l);(!0===n.transparent?i:r).push(u)},unshift:function(t,e,n,o,s,l){var u=a(t,e,n,o,s,l);(!0===n.transparent?i:r).unshift(u)},sort:function(){r.length>1&&r.sort(Ko),i.length>1&&i.sort(Qo)}}}function $o(){var t={};function e(r){var i=r.target;i.removeEventListener("dispose",e),delete t[i.id]}return{get:function(r,i){var n,a=t[r.id];return void 0===a?(n=new Jo,t[r.id]={},t[r.id][i.id]=n,r.addEventListener("dispose",e)):void 0===(n=a[i.id])&&(n=new Jo,a[i.id]=n),n},dispose:function(){t={}}}}function ts(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var r;switch(e.type){case"DirectionalLight":r={direction:new Wi,color:new xn,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Hi};break;case"SpotLight":r={position:new Wi,direction:new Wi,color:new xn,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Hi};break;case"PointLight":r={position:new Wi,color:new xn,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Hi,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new Wi,skyColor:new xn,groundColor:new xn};break;case"RectAreaLight":r={color:new xn,position:new Wi,halfWidth:new Wi,halfHeight:new Wi}}return t[e.id]=r,r}}}var es=0;function rs(){for(var t=new ts,e={id:es++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=0;r<9;r++)e.probe.push(new Wi);var i=new Wi,n=new vn,a=new vn;return{setup:function(r,o,s){for(var l=0,u=0,c=0,h=0;h<9;h++)e.probe[h].set(0,0,0);for(var d=0,p=0,f=0,m=0,g=0,b=s.matrixWorldInverse,v=(h=0,r.length);h<v;h++){var y=r[h],A=y.color,T=y.intensity,C=y.distance,S=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)l+=A.r*T,u+=A.g*T,c+=A.b*T;else if(y.isLightProbe)for(var E=0;E<9;E++)e.probe[E].addScaledVector(y.sh.coefficients[E],T);else if(y.isDirectionalLight){if((k=t.get(y)).color.copy(y.color).multiplyScalar(y.intensity),k.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),k.direction.sub(i),k.direction.transformDirection(b),k.shadow=y.castShadow,y.castShadow){var w=y.shadow;k.shadowBias=w.bias,k.shadowRadius=w.radius,k.shadowMapSize=w.mapSize}e.directionalShadowMap[d]=S,e.directionalShadowMatrix[d]=y.shadow.matrix,e.directional[d]=k,d++}else if(y.isSpotLight)(k=t.get(y)).position.setFromMatrixPosition(y.matrixWorld),k.position.applyMatrix4(b),k.color.copy(A).multiplyScalar(T),k.distance=C,k.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),k.direction.sub(i),k.direction.transformDirection(b),k.coneCos=Math.cos(y.angle),k.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),k.decay=y.decay,k.shadow=y.castShadow,y.castShadow&&(w=y.shadow,k.shadowBias=w.bias,k.shadowRadius=w.radius,k.shadowMapSize=w.mapSize),e.spotShadowMap[f]=S,e.spotShadowMatrix[f]=y.shadow.matrix,e.spot[f]=k,f++;else if(y.isRectAreaLight)(k=t.get(y)).color.copy(A).multiplyScalar(T),k.position.setFromMatrixPosition(y.matrixWorld),k.position.applyMatrix4(b),a.identity(),n.copy(y.matrixWorld),n.premultiply(b),a.extractRotation(n),k.halfWidth.set(.5*y.width,0,0),k.halfHeight.set(0,.5*y.height,0),k.halfWidth.applyMatrix4(a),k.halfHeight.applyMatrix4(a),e.rectArea[m]=k,m++;else if(y.isPointLight)(k=t.get(y)).position.setFromMatrixPosition(y.matrixWorld),k.position.applyMatrix4(b),k.color.copy(y.color).multiplyScalar(y.intensity),k.distance=y.distance,k.decay=y.decay,k.shadow=y.castShadow,y.castShadow&&(w=y.shadow,k.shadowBias=w.bias,k.shadowRadius=w.radius,k.shadowMapSize=w.mapSize,k.shadowCameraNear=w.camera.near,k.shadowCameraFar=w.camera.far),e.pointShadowMap[p]=S,e.pointShadowMatrix[p]=y.shadow.matrix,e.point[p]=k,p++;else if(y.isHemisphereLight){var k;(k=t.get(y)).direction.setFromMatrixPosition(y.matrixWorld),k.direction.transformDirection(b),k.direction.normalize(),k.skyColor.copy(y.color).multiplyScalar(T),k.groundColor.copy(y.groundColor).multiplyScalar(T),e.hemi[g]=k,g++}}e.ambient[0]=l,e.ambient[1]=u,e.ambient[2]=c,e.directional.length=d,e.spot.length=f,e.rectArea.length=m,e.point.length=p,e.hemi.length=g,e.hash.stateID=e.id,e.hash.directionalLength=d,e.hash.pointLength=p,e.hash.spotLength=f,e.hash.rectAreaLength=m,e.hash.hemiLength=g,e.hash.shadowsLength=o.length},state:e}}function is(){var t=new rs,e=[],r=[];return{init:function(){e.length=0,r.length=0},state:{lightsArray:e,shadowsArray:r,lights:t},setupLights:function(i){t.setup(e,r,i)},pushLight:function(t){e.push(t)},pushShadow:function(t){r.push(t)}}}function ns(){var t={};function e(r){var i=r.target;i.removeEventListener("dispose",e),delete t[i.id]}return{get:function(r,i){var n;return void 0===t[r.id]?(n=new is,t[r.id]={},t[r.id][i.id]=n,r.addEventListener("dispose",e)):void 0===t[r.id][i.id]?(n=new is,t[r.id][i.id]=n):n=t[r.id][i.id],n},dispose:function(){t={}}}}function as(t){ha.call(this),this.type="MeshDepthMaterial",this.depthPacking=Di,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function os(t){ha.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Wi,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function ss(t,e,r){for(var i=new bn,n=new vn,a=new Hi,o=new Hi(r,r),s=new Wi,l=new Wi,u=1,c=2,h=1+(u|c),d=new Array(h),p=new Array(h),f={},m={0:be,1:ge,2:ve},g=[new Wi(1,0,0),new Wi(-1,0,0),new Wi(0,0,1),new Wi(0,0,-1),new Wi(0,1,0),new Wi(0,-1,0)],b=[new Wi(0,1,0),new Wi(0,1,0),new Wi(0,1,0),new Wi(0,1,0),new Wi(0,0,1),new Wi(0,0,-1)],v=[new un,new un,new un,new un,new un,new un],y=0;y!==h;++y){var A=0!=(y&u),T=0!=(y&c),C=new as({depthPacking:Ni,morphTargets:A,skinning:T});d[y]=C;var S=new os({morphTargets:A,skinning:T});p[y]=S}var E=this;function w(e,r,i,n,a,o){var s=e.geometry,l=null,h=d,g=e.customDepthMaterial;if(i&&(h=p,g=e.customDistanceMaterial),g)l=g;else{var b=!1;r.morphTargets&&(s&&s.isBufferGeometry?b=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(b=s.morphTargets&&s.morphTargets.length>0)),e.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e);var v=e.isSkinnedMesh&&r.skinning,y=0;b&&(y|=u),v&&(y|=c),l=h[y]}if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var A=l.uuid,T=r.uuid,C=f[A];void 0===C&&(C={},f[A]=C);var S=C[T];void 0===S&&(S=l.clone(),C[T]=S),l=S}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=null!=r.shadowSide?r.shadowSide:m[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,i&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(n),l.nearDistance=a,l.farDistance=o),l}function k(r,n,a,o){if(!1!==r.visible){if(r.layers.test(n.layers)&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||i.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);var s=e.update(r),u=r.material;if(Array.isArray(u))for(var c=s.groups,h=0,d=c.length;h<d;h++){var p=c[h],f=u[p.materialIndex];if(f&&f.visible){var m=w(r,f,o,l,a.near,a.far);t.renderBufferDirect(a,null,s,m,r,p)}}else if(u.visible){m=w(r,u,o,l,a.near,a.far);t.renderBufferDirect(a,null,s,m,r,null)}}for(var g=r.children,b=0,v=g.length;b<v;b++)k(g[b],n,a,o)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=fe,this.render=function(e,r,u){if(!1!==E.enabled&&(!1!==E.autoUpdate||!1!==E.needsUpdate)&&0!==e.length){var c,h=t.getRenderTarget(),d=t.state;d.setBlending(Ee),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var p=0,f=e.length;p<f;p++){var m=e[p],y=m.shadow,A=m&&m.isPointLight;if(void 0!==y){var T=y.camera;if(a.copy(y.mapSize),a.min(o),A){var C=a.x,S=a.y;v[0].set(2*C,S,C,S),v[1].set(0,S,C,S),v[2].set(3*C,S,C,S),v[3].set(C,S,C,S),v[4].set(3*C,0,C,S),v[5].set(C,0,C,S),a.x*=4,a.y*=2}if(null===y.map){var w={minFilter:Ar,magFilter:Ar,format:Ur};y.map=new cn(a.x,a.y,w),y.map.texture.name=m.name+".shadowMap",T.updateProjectionMatrix()}y.isSpotLightShadow&&y.update(m);var x=y.map,M=y.matrix;l.setFromMatrixPosition(m.matrixWorld),T.position.copy(l),A?(c=6,M.makeTranslation(-l.x,-l.y,-l.z)):(c=1,s.setFromMatrixPosition(m.target.matrixWorld),T.lookAt(s),T.updateMatrixWorld(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(T.projectionMatrix),M.multiply(T.matrixWorldInverse)),t.setRenderTarget(x),t.clear();for(var O=0;O<c;O++){if(A){s.copy(T.position),s.add(g[O]),T.up.copy(b[O]),T.lookAt(s),T.updateMatrixWorld();var I=v[O];d.viewport(I)}n.multiplyMatrices(T.projectionMatrix,T.matrixWorldInverse),i.setFromMatrix(n),k(r,u,T,A)}}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}E.needsUpdate=!1,t.setRenderTarget(h)}}}function ls(t,e,r,i){var n=new function(){var e=!1,r=new un,i=null,n=new un(0,0,0,0);return{setMask:function(r){i===r||e||(t.colorMask(r,r,r,r),i=r)},setLocked:function(t){e=t},setClear:function(e,i,a,o,s){!0===s&&(e*=o,i*=o,a*=o),r.set(e,i,a,o),!1===n.equals(r)&&(t.clearColor(e,i,a,o),n.copy(r))},reset:function(){e=!1,i=null,n.set(-1,0,0,0)}}},a=new function(){var e=!1,r=null,i=null,n=null;return{setTest:function(t){t?G(2929):U(2929)},setMask:function(i){r===i||e||(t.depthMask(i),r=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case je:t.depthFunc(512);break;case Xe:t.depthFunc(519);break;case qe:t.depthFunc(513);break;case Ze:t.depthFunc(515);break;case Ke:t.depthFunc(514);break;case Qe:t.depthFunc(518);break;case Je:t.depthFunc(516);break;case $e:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){n!==e&&(t.clearDepth(e),n=e)},reset:function(){e=!1,r=null,i=null,n=null}}},o=new function(){var e=!1,r=null,i=null,n=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(t){t?G(2960):U(2960)},setMask:function(i){r===i||e||(t.stencilMask(i),r=i)},setFunc:function(e,r,o){i===e&&n===r&&a===o||(t.stencilFunc(e,r,o),i=e,n=r,a=o)},setOp:function(e,r,i){o===e&&s===r&&l===i||(t.stencilOp(e,r,i),o=e,s=r,l=i)},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1,r=null,i=null,n=null,a=null,o=null,s=null,l=null,u=null}}},s=t.getParameter(34921),l=new Uint8Array(s),u=new Uint8Array(s),c=new Uint8Array(s),h={},d=null,p=null,f=null,m=null,g=null,b=null,v=null,y=null,A=null,T=null,C=!1,S=null,E=null,w=null,k=null,x=null,M=t.getParameter(35661),O=!1,I=0,_=t.getParameter(7938);-1!==_.indexOf("WebGL")?(I=parseFloat(/^WebGL\ ([0-9])/.exec(_)[1]),O=I>=1):-1!==_.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(_)[1]),O=I>=2);var L=null,P={},R=new un,F=new un;function D(e,r,i){var n=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(var o=0;o<i;o++)t.texImage2D(r+o,0,6408,1,1,0,6408,5121,n);return a}var N={};function B(r,n){(l[r]=1,0===u[r]&&(t.enableVertexAttribArray(r),u[r]=1),c[r]!==n)&&((i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,n),c[r]=n)}function G(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function U(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}function H(e,i,n,a,o,s,l,u){if(e!==Ee){if(f||(G(3042),f=!0),e===Oe)o=o||i,s=s||n,l=l||a,i===g&&o===y||(t.blendEquationSeparate(r.convert(i),r.convert(o)),g=i,y=o),n===b&&a===v&&s===A&&l===T||(t.blendFuncSeparate(r.convert(n),r.convert(a),r.convert(s),r.convert(l)),b=n,v=a,A=s,T=l),m=e,C=null;else if(e!==m||u!==C){if(g===Ie&&y===Ie||(t.blendEquation(32774),g=Ie,y=Ie),u)switch(e){case we:t.blendFuncSeparate(1,771,1,771);break;case ke:t.blendFunc(1,1);break;case xe:t.blendFuncSeparate(0,0,769,771);break;case Me:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case we:t.blendFuncSeparate(770,771,1,771);break;case ke:t.blendFunc(770,1);break;case xe:t.blendFunc(0,769);break;case Me:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}b=null,v=null,A=null,T=null,m=e,C=u}}else f&&(U(3042),f=!1)}function z(e){S!==e&&(e?t.frontFace(2304):t.frontFace(2305),S=e)}function W(e){e!==se?(G(2884),e!==E&&(e===le?t.cullFace(1029):e===ue?t.cullFace(1028):t.cullFace(1032))):U(2884),E=e}function V(e,r,i){e?(G(32823),k===r&&x===i||(t.polygonOffset(r,i),k=r,x=i)):U(32823)}function Y(e){void 0===e&&(e=33984+M-1),L!==e&&(t.activeTexture(e),L=e)}return N[3553]=D(3553,3553,1),N[34067]=D(34067,34069,6),n.setClear(0,0,0,1),a.setClear(1),o.setClear(0),G(2929),a.setFunc(Ze),z(!1),W(le),G(2884),H(Ee),{buffers:{color:n,depth:a,stencil:o},initAttributes:function(){for(var t=0,e=l.length;t<e;t++)l[t]=0},enableAttribute:function(t){B(t,0)},enableAttributeAndDivisor:B,disableUnusedAttributes:function(){for(var e=0,r=u.length;e!==r;++e)u[e]!==l[e]&&(t.disableVertexAttribArray(e),u[e]=0)},enable:G,disable:U,getCompressedTextureFormats:function(){if(null===d&&(d=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")||e.get("WEBGL_compressed_texture_astc")))for(var r=t.getParameter(34467),i=0;i<r.length;i++)d.push(r[i]);return d},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:H,setMaterial:function(t,e){t.side===ve?U(2884):G(2884);var r=t.side===be;e&&(r=!r),z(r),t.blending===we&&!1===t.transparent?H(Ee):H(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),n.setMask(t.colorWrite),V(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:z,setCullFace:W,setLineWidth:function(e){e!==w&&(O&&t.lineWidth(e),w=e)},setPolygonOffset:V,setScissorTest:function(t){t?G(3089):U(3089)},activeTexture:Y,bindTexture:function(e,r){null===L&&Y();var i=P[L];void 0===i&&(i={type:void 0,texture:void 0},P[L]=i),i.type===e&&i.texture===r||(t.bindTexture(e,r||N[e]),i.type=e,i.texture=r)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===R.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),R.copy(e))},viewport:function(e){!1===F.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),F.copy(e))},reset:function(){for(var e=0;e<u.length;e++)1===u[e]&&(t.disableVertexAttribArray(e),u[e]=0);h={},d=null,L=null,P={},p=null,m=null,S=null,E=null,n.reset(),a.reset(),o.reset()}}}function us(t,e,r,i,n,a,o){var s,l={},u="undefined"!=typeof OffscreenCanvas;function c(t,e){return u?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function h(t,e,r,i){var n=1;if((t.width>i||t.height>i)&&(n=i/Math.max(t.width,t.height)),n<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var a=e?Ui.floorPowerOfTwo:Math.floor,o=a(n*t.width),l=a(n*t.height);void 0===s&&(s=c(o,l));var u=r?c(o,l):s;return u.width=o,u.height=l,u.getContext("2d").drawImage(t,0,0,o,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+l+")."),u}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function d(t){return Ui.isPowerOfTwo(t.width)&&Ui.isPowerOfTwo(t.height)}function p(t,e){return t.generateMipmaps&&e&&t.minFilter!==Ar&&t.minFilter!==Sr}function f(e,r,n,a){t.generateMipmap(e),i.get(r).__maxMipLevel=Math.log(Math.max(n,a))*Math.LOG2E}function m(t,r){if(!n.isWebGL2)return t;var i=t;return 6403===t&&(5126===r&&(i=33326),5131===r&&(i=33325),5121===r&&(i=33321)),6407===t&&(5126===r&&(i=34837),5131===r&&(i=34843),5121===r&&(i=32849)),6408===t&&(5126===r&&(i=34836),5131===r&&(i=34842),5121===r&&(i=32856)),33325===i||33326===i||34842===i||34836===i?e.get("EXT_color_buffer_float"):34843!==i&&34837!==i||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),i}function g(t){return t===Ar||t===Tr||t===Cr?9728:9729}function b(e){var r=e.target;r.removeEventListener("dispose",b),function(e){var r=i.get(e);if(void 0===r.__webglInit)return;t.deleteTexture(r.__webglTexture),i.remove(e)}(r),r.isVideoTexture&&delete l[r.id],o.memory.textures--}function v(e){var r=e.target;r.removeEventListener("dispose",v),function(e){var r=i.get(e),n=i.get(e.texture);if(!e)return;void 0!==n.__webglTexture&&t.deleteTexture(n.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(var a=0;a<6;a++)t.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[a]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer);i.remove(e.texture),i.remove(e)}(r),o.memory.textures--}var y=0;function A(t,e){var n=i.get(t);if(t.isVideoTexture&&function(t){var e=t.id,r=o.render.frame;l[e]!==r&&(l[e]=r,t.update())}(t),t.version>0&&n.__version!==t.version){var a=t.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void w(n,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+e),r.bindTexture(3553,n.__webglTexture)}function T(e,o){var s=i.get(e);if(6===e.image.length)if(e.version>0&&s.__version!==e.version){E(s,e),r.activeTexture(33984+o),r.bindTexture(34067,s.__webglTexture),t.pixelStorei(37440,e.flipY);for(var l=e&&e.isCompressedTexture,u=e.image[0]&&e.image[0].isDataTexture,c=[],g=0;g<6;g++)c[g]=l||u?u?e.image[g].image:e.image[g]:h(e.image[g],!1,!0,n.maxCubemapSize);var b=c[0],v=d(b)||n.isWebGL2,y=a.convert(e.format),A=a.convert(e.type),T=m(y,A);S(34067,e,v);for(g=0;g<6;g++)if(l)for(var C,w=c[g].mipmaps,k=0,x=w.length;k<x;k++)C=w[k],e.format!==Ur&&e.format!==Gr?r.getCompressedTextureFormats().indexOf(y)>-1?r.compressedTexImage2D(34069+g,k,T,C.width,C.height,0,C.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+g,k,T,C.width,C.height,0,y,A,C.data);else u?r.texImage2D(34069+g,0,T,c[g].width,c[g].height,0,y,A,c[g].data):r.texImage2D(34069+g,0,T,y,A,c[g]);s.__maxMipLevel=l?w.length-1:0,p(e,v)&&f(34067,e,b.width,b.height),s.__version=e.version,e.onUpdate&&e.onUpdate(e)}else r.activeTexture(33984+o),r.bindTexture(34067,s.__webglTexture)}function C(t,e){r.activeTexture(33984+e),r.bindTexture(34067,i.get(t).__webglTexture)}function S(r,o,s){var l;if(s?(t.texParameteri(r,10242,a.convert(o.wrapS)),t.texParameteri(r,10243,a.convert(o.wrapT)),32879!==r&&35866!==r||t.texParameteri(r,32882,a.convert(o.wrapR)),t.texParameteri(r,10240,a.convert(o.magFilter)),t.texParameteri(r,10241,a.convert(o.minFilter))):(t.texParameteri(r,10242,33071),t.texParameteri(r,10243,33071),32879!==r&&35866!==r||t.texParameteri(r,32882,33071),o.wrapS===vr&&o.wrapT===vr||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(r,10240,g(o.magFilter)),t.texParameteri(r,10241,g(o.minFilter)),o.minFilter!==Ar&&o.minFilter!==Sr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),l=e.get("EXT_texture_filter_anisotropic")){if(o.type===Lr&&null===e.get("OES_texture_float_linear"))return;if(o.type===Pr&&null===(n.isWebGL2||e.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(t.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,n.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function E(e,r){void 0===e.__webglInit&&(e.__webglInit=!0,r.addEventListener("dispose",b),e.__webglTexture=t.createTexture(),o.memory.textures++)}function w(e,i,o){var s=3553;i.isDataTexture2DArray&&(s=35866),i.isDataTexture3D&&(s=32879),E(e,i),r.activeTexture(33984+o),r.bindTexture(s,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment);var l=function(t){return!n.isWebGL2&&(t.wrapS!==vr||t.wrapT!==vr||t.minFilter!==Ar&&t.minFilter!==Sr)}(i)&&!1===d(i.image),u=h(i.image,l,!1,n.maxTextureSize),c=d(u)||n.isWebGL2,g=a.convert(i.format),b=a.convert(i.type),v=m(g,b);S(s,i,c);var y,A=i.mipmaps;if(i.isDepthTexture){if(v=6402,i.type===Lr){if(!n.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");v=36012}else n.isWebGL2&&(v=33189);i.format===Vr&&6402===v&&i.type!==Or&&i.type!==_r&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Or,b=a.convert(i.type)),i.format===Yr&&(v=34041,i.type!==Nr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Nr,b=a.convert(i.type))),r.texImage2D(3553,0,v,u.width,u.height,0,g,b,null)}else if(i.isDataTexture)if(A.length>0&&c){for(var T=0,C=A.length;T<C;T++)y=A[T],r.texImage2D(3553,T,v,y.width,y.height,0,g,b,y.data);i.generateMipmaps=!1,e.__maxMipLevel=A.length-1}else r.texImage2D(3553,0,v,u.width,u.height,0,g,b,u.data),e.__maxMipLevel=0;else if(i.isCompressedTexture){for(T=0,C=A.length;T<C;T++)y=A[T],i.format!==Ur&&i.format!==Gr?r.getCompressedTextureFormats().indexOf(g)>-1?r.compressedTexImage2D(3553,T,v,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,T,v,y.width,y.height,0,g,b,y.data);e.__maxMipLevel=A.length-1}else if(i.isDataTexture2DArray)r.texImage3D(35866,0,v,u.width,u.height,u.depth,0,g,b,u.data),e.__maxMipLevel=0;else if(i.isDataTexture3D)r.texImage3D(32879,0,v,u.width,u.height,u.depth,0,g,b,u.data),e.__maxMipLevel=0;else if(A.length>0&&c){for(T=0,C=A.length;T<C;T++)y=A[T],r.texImage2D(3553,T,v,g,b,y);i.generateMipmaps=!1,e.__maxMipLevel=A.length-1}else r.texImage2D(3553,0,v,g,b,u),e.__maxMipLevel=0;p(i,c)&&f(3553,i,u.width,u.height),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function k(e,n,o,s){var l=a.convert(n.texture.format),u=a.convert(n.texture.type),c=m(l,u);r.texImage2D(s,0,c,n.width,n.height,0,l,u,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,o,s,i.get(n.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function x(e,r,i){if(t.bindRenderbuffer(36161,e),r.depthBuffer&&!r.stencilBuffer){if(i){var n=O(r);t.renderbufferStorageMultisample(36161,n,33189,r.width,r.height)}else t.renderbufferStorage(36161,33189,r.width,r.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(r.depthBuffer&&r.stencilBuffer){if(i){n=O(r);t.renderbufferStorageMultisample(36161,n,34041,r.width,r.height)}else t.renderbufferStorage(36161,34041,r.width,r.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{var o=m(a.convert(r.texture.format),a.convert(r.texture.type));if(i){n=O(r);t.renderbufferStorageMultisample(36161,n,o,r.width,r.height)}else t.renderbufferStorage(36161,o,r.width,r.height)}t.bindRenderbuffer(36161,null)}function M(e){var r=i.get(e),n=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),A(r.depthTexture,0);var n=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Vr)t.framebufferTexture2D(36160,36096,3553,n,0);else{if(r.depthTexture.format!==Yr)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,n,0)}}(r.__webglFramebuffer,e)}else if(n){r.__webglDepthbuffer=[];for(var a=0;a<6;a++)t.bindFramebuffer(36160,r.__webglFramebuffer[a]),r.__webglDepthbuffer[a]=t.createRenderbuffer(),x(r.__webglDepthbuffer[a],e)}else t.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),x(r.__webglDepthbuffer,e);t.bindFramebuffer(36160,null)}function O(t){return n.isWebGL2&&t.isWebGLMultisampleRenderTarget?Math.min(n.maxSamples,t.samples):0}var I=!1,_=!1;this.allocateTextureUnit=function(){var t=y;return t>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+n.maxTextures),y+=1,t},this.resetTextureUnits=function(){y=0},this.setTexture2D=A,this.setTexture2DArray=function(t,e){var n=i.get(t);t.version>0&&n.__version!==t.version?w(n,t,e):(r.activeTexture(33984+e),r.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(t,e){var n=i.get(t);t.version>0&&n.__version!==t.version?w(n,t,e):(r.activeTexture(33984+e),r.bindTexture(32879,n.__webglTexture))},this.setTextureCube=T,this.setTextureCubeDynamic=C,this.setupRenderTarget=function(e){var s=i.get(e),l=i.get(e.texture);e.addEventListener("dispose",v),l.__webglTexture=t.createTexture(),o.memory.textures++;var u=!0===e.isWebGLRenderTargetCube,c=!0===e.isWebGLMultisampleRenderTarget,h=d(e)||n.isWebGL2;if(u){s.__webglFramebuffer=[];for(var g=0;g<6;g++)s.__webglFramebuffer[g]=t.createFramebuffer()}else if(s.__webglFramebuffer=t.createFramebuffer(),c)if(n.isWebGL2){s.__webglMultisampledFramebuffer=t.createFramebuffer(),s.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var b=m(a.convert(e.texture.format),a.convert(e.texture.type)),y=O(e);t.renderbufferStorageMultisample(36161,y,b,e.width,e.height),t.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(s.__webglDepthRenderbuffer=t.createRenderbuffer(),x(s.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){for(r.bindTexture(34067,l.__webglTexture),S(34067,e.texture,h),g=0;g<6;g++)k(s.__webglFramebuffer[g],e,36064,34069+g);p(e.texture,h)&&f(34067,e.texture,e.width,e.height),r.bindTexture(34067,null)}else r.bindTexture(3553,l.__webglTexture),S(3553,e.texture,h),k(s.__webglFramebuffer,e,36064,3553),p(e.texture,h)&&f(3553,e.texture,e.width,e.height),r.bindTexture(3553,null);e.depthBuffer&&M(e)},this.updateRenderTargetMipmap=function(t){var e=t.texture;if(p(e,d(t)||n.isWebGL2)){var a=t.isWebGLRenderTargetCube?34067:3553,o=i.get(e).__webglTexture;r.bindTexture(a,o),f(a,e,t.width,t.height),r.bindTexture(a,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(n.isWebGL2){var r=i.get(e);t.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,r.__webglFramebuffer);var a=e.width,o=e.height,s=16384;e.depthBuffer&&(s|=256),e.stencilBuffer&&(s|=1024),t.blitFramebuffer(0,0,a,o,0,0,a,o,s,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===I&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),I=!0),t=t.texture),A(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLRenderTargetCube&&(!1===_&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),_=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?T(t,e):C(t,e)}}function cs(t,e,r){return{convert:function(t){var i;if(t===br)return 10497;if(t===vr)return 33071;if(t===yr)return 33648;if(t===Ar)return 9728;if(t===Tr)return 9984;if(t===Cr)return 9986;if(t===Sr)return 9729;if(t===Er)return 9985;if(t===wr)return 9987;if(t===kr)return 5121;if(t===Rr)return 32819;if(t===Fr)return 32820;if(t===Dr)return 33635;if(t===xr)return 5120;if(t===Mr)return 5122;if(t===Or)return 5123;if(t===Ir)return 5124;if(t===_r)return 5125;if(t===Lr)return 5126;if(t===Pr){if(r.isWebGL2)return 5131;if(null!==(i=e.get("OES_texture_half_float")))return i.HALF_FLOAT_OES}if(t===Br)return 6406;if(t===Gr)return 6407;if(t===Ur)return 6408;if(t===Hr)return 6409;if(t===zr)return 6410;if(t===Vr)return 6402;if(t===Yr)return 34041;if(t===jr)return 6403;if(t===Ie)return 32774;if(t===_e)return 32778;if(t===Le)return 32779;if(t===Fe)return 0;if(t===De)return 1;if(t===Ne)return 768;if(t===Be)return 769;if(t===Ge)return 770;if(t===Ue)return 771;if(t===He)return 772;if(t===ze)return 773;if(t===We)return 774;if(t===Ve)return 775;if(t===Ye)return 776;if((t===Xr||t===qr||t===Zr||t===Kr)&&null!==(i=e.get("WEBGL_compressed_texture_s3tc"))){if(t===Xr)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===qr)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Zr)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Kr)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((t===Qr||t===Jr||t===$r||t===ti)&&null!==(i=e.get("WEBGL_compressed_texture_pvrtc"))){if(t===Qr)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Jr)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===$r)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===ti)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===ei&&null!==(i=e.get("WEBGL_compressed_texture_etc1")))return i.COMPRESSED_RGB_ETC1_WEBGL;if((t===ri||t===ii||t===ni||t===ai||t===oi||t===si||t===li||t===ui||t===ci||t===hi||t===di||t===pi||t===fi||t===mi)&&null!==(i=e.get("WEBGL_compressed_texture_astc")))return t;if(t===Pe||t===Re){if(r.isWebGL2){if(t===Pe)return 32775;if(t===Re)return 32776}if(null!==(i=e.get("EXT_blend_minmax"))){if(t===Pe)return i.MIN_EXT;if(t===Re)return i.MAX_EXT}}if(t===Nr){if(r.isWebGL2)return 34042;if(null!==(i=e.get("WEBGL_depth_texture")))return i.UNSIGNED_INT_24_8_WEBGL}return 0}}}function hs(){Hn.call(this),this.type="Group"}function ds(){Hn.call(this),this.type="Camera",this.matrixWorldInverse=new vn,this.projectionMatrix=new vn,this.projectionMatrixInverse=new vn}function ps(t,e,r,i){ds.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function fs(t){ps.call(this),this.cameras=t||[]}as.prototype=Object.create(ha.prototype),as.prototype.constructor=as,as.prototype.isMeshDepthMaterial=!0,as.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},os.prototype=Object.create(ha.prototype),os.prototype.constructor=os,os.prototype.isMeshDistanceMaterial=!0,os.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},hs.prototype=Object.assign(Object.create(Hn.prototype),{constructor:hs,isGroup:!0}),ds.prototype=Object.assign(Object.create(Hn.prototype),{constructor:ds,isCamera:!0,copy:function(t,e){return Hn.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Wi),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){Hn.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ps.prototype=Object.assign(Object.create(ds.prototype),{constructor:ps,isPerspectiveCamera:!0,copy:function(t,e){return ds.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*Ui.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Ui.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Ui.RAD2DEG*Math.atan(Math.tan(.5*Ui.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,i,n,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*Ui.DEG2RAD*this.fov)/this.zoom,r=2*e,i=this.aspect*r,n=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;n+=a.offsetX*i/o,e-=a.offsetY*r/s,i*=a.width/o,r*=a.height/s}var l=this.filmOffset;0!==l&&(n+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,e,e-r,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=Hn.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),fs.prototype=Object.assign(Object.create(ps.prototype),{constructor:fs,isArrayCamera:!0});var ms,gs,bs,vs,ys,As,Ts=new Wi,Cs=new Wi;function Ss(t,e,r){Ts.setFromMatrixPosition(e.matrixWorld),Cs.setFromMatrixPosition(r.matrixWorld);var i=Ts.distanceTo(Cs),n=e.projectionMatrix.elements,a=r.projectionMatrix.elements,o=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],u=(n[9]-1)/n[5],c=(n[8]-1)/n[0],h=(a[8]+1)/a[0],d=o*c,p=o*h,f=i/(-c+h),m=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);var g=o+f,b=s+f,v=d-m,y=p+(i-m),A=l*s/b*g,T=u*s/b*g;t.projectionMatrix.makePerspective(v,y,A,T,g,b)}function Es(t){var e=this,r=null,i=null,n=null,a=[],o=new vn,s=new vn,l=1,u="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(i=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",y,!1));var c=new vn,h=new zi,d=new Wi,p=new ps;p.bounds=new un(0,0,.5,1),p.layers.enable(1);var f=new ps;f.bounds=new un(.5,0,.5,1),f.layers.enable(2);var m=new fs([p,f]);function g(){return null!==r&&!0===r.isPresenting}m.layers.enable(1),m.layers.enable(2);var b,v=new Hi;function y(){if(g()){var i=r.getEyeParameters("left"),n=i.renderWidth*l,a=i.renderHeight*l;b=t.getPixelRatio(),t.getSize(v),t.setDrawingBufferSize(2*n,a,1),C.start()}else e.enabled&&t.setDrawingBufferSize(v.width,v.height,b),C.stop()}var A=[];function T(t){for(var e=navigator.getGamepads&&navigator.getGamepads(),r=0,i=0,n=e.length;r<n;r++){var a=e[r];if(a&&("Daydream Controller"===a.id||"Gear VR Controller"===a.id||"Oculus Go Controller"===a.id||"OpenVR Gamepad"===a.id||a.id.startsWith("Oculus Touch")||a.id.startsWith("Spatial Controller"))){if(i===t)return a;i++}}}this.enabled=!1,this.getController=function(t){var e=a[t];return void 0===e&&((e=new hs).matrixAutoUpdate=!1,e.visible=!1,a[t]=e),e},this.getDevice=function(){return r},this.setDevice=function(t){void 0!==t&&(r=t),C.setContext(t)},this.setFramebufferScaleFactor=function(t){l=t},this.setFrameOfReferenceType=function(t){u=t},this.setPoseTarget=function(t){void 0!==t&&(n=t)},this.getCamera=function(t){var e="stage"===u?1.6:0;if(!1===g())return t.position.set(0,e,0),t.rotation.set(0,0,0),t;if(r.depthNear=t.near,r.depthFar=t.far,r.getFrameData(i),"stage"===u){var l=r.stageParameters;l?o.fromArray(l.sittingToStandingTransform):o.makeTranslation(0,e,0)}var b=i.pose,v=null!==n?n:t;v.matrix.copy(o),v.matrix.decompose(v.position,v.quaternion,v.scale),null!==b.orientation&&(h.fromArray(b.orientation),v.quaternion.multiply(h)),null!==b.position&&(h.setFromRotationMatrix(o),d.fromArray(b.position),d.applyQuaternion(h),v.position.add(d)),v.updateMatrixWorld(),p.near=t.near,f.near=t.near,p.far=t.far,f.far=t.far,p.matrixWorldInverse.fromArray(i.leftViewMatrix),f.matrixWorldInverse.fromArray(i.rightViewMatrix),s.getInverse(o),"stage"===u&&(p.matrixWorldInverse.multiply(s),f.matrixWorldInverse.multiply(s));var y=v.parent;null!==y&&(c.getInverse(y.matrixWorld),p.matrixWorldInverse.multiply(c),f.matrixWorldInverse.multiply(c)),p.matrixWorld.getInverse(p.matrixWorldInverse),f.matrixWorld.getInverse(f.matrixWorldInverse),p.projectionMatrix.fromArray(i.leftProjectionMatrix),f.projectionMatrix.fromArray(i.rightProjectionMatrix),Ss(m,p,f);var C=r.getLayers();if(C.length){var S=C[0];null!==S.leftBounds&&4===S.leftBounds.length&&p.bounds.fromArray(S.leftBounds),null!==S.rightBounds&&4===S.rightBounds.length&&f.bounds.fromArray(S.rightBounds)}return function(){for(var t=0;t<a.length;t++){var e=a[t],r=T(t);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;var i=r.pose;!1===i.hasPosition&&e.position.set(.2,-.6,-.05),null!==i.position&&e.position.fromArray(i.position),null!==i.orientation&&e.quaternion.fromArray(i.orientation),e.matrix.compose(e.position,e.quaternion,e.scale),e.matrix.premultiply(o),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorldNeedsUpdate=!0,e.visible=!0;var n="Daydream Controller"===r.id?0:1;A[t]!==r.buttons[n].pressed&&(A[t]=r.buttons[n].pressed,!0===A[t]?e.dispatchEvent({type:"selectstart"}):(e.dispatchEvent({type:"selectend"}),e.dispatchEvent({type:"select"})))}else e.visible=!1}}(),m},this.getStandingMatrix=function(){return o},this.isPresenting=g;var C=new _n;this.setAnimationLoop=function(t){C.setAnimationLoop(t),g()&&C.start()},this.submitFrame=function(){g()&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",y)}}function ws(t){var e=t.context,r=null,i=null,n=1,a=null,o="stage",s=null,l=[],u=[];function c(){return null!==i&&null!==a}var h=new ps;h.layers.enable(1),h.viewport=new un;var d=new ps;d.layers.enable(2),d.viewport=new un;var p=new fs([h,d]);function f(t){var e=l[u.indexOf(t.inputSource)];e&&e.dispatchEvent({type:t.type})}function m(){t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),v.stop()}function g(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}p.layers.enable(1),p.layers.enable(2),this.enabled=!1,this.getController=function(t){var e=l[t];return void 0===e&&((e=new hs).matrixAutoUpdate=!1,e.visible=!1,l[t]=e),e},this.getDevice=function(){return r},this.setDevice=function(t){void 0!==t&&(r=t),t instanceof XRDevice&&e.setCompatibleXRDevice(t)},this.setFramebufferScaleFactor=function(t){n=t},this.setFrameOfReferenceType=function(t){o=t},this.setSession=function(r){null!==(i=r)&&(i.addEventListener("select",f),i.addEventListener("selectstart",f),i.addEventListener("selectend",f),i.addEventListener("end",m),i.baseLayer=new XRWebGLLayer(i,e,{framebufferScaleFactor:n}),i.requestFrameOfReference(o).then(function(e){a=e,t.setFramebuffer(i.baseLayer.framebuffer),v.setContext(i),v.start()}),u=i.getInputSources(),i.addEventListener("inputsourceschange",function(){u=i.getInputSources(),console.log(u);for(var t=0;t<l.length;t++){l[t].userData.inputSource=u[t]}}))},this.getCamera=function(t){if(c()){var e=t.parent,r=p.cameras;g(p,e);for(var i=0;i<r.length;i++)g(r[i],e);t.matrixWorld.copy(p.matrixWorld);for(var n=t.children,a=(i=0,n.length);i<a;i++)n[i].updateMatrixWorld(!0);return Ss(p,h,d),p}return t},this.isPresenting=c;var b=null;var v=new _n;v.setAnimationLoop(function(t,e){if(null!==(s=e.getDevicePose(a)))for(var r=i.baseLayer,n=e.views,o=0;o<n.length;o++){var c=n[o],h=r.getViewport(c),d=s.getViewMatrix(c),f=p.cameras[o];f.matrix.fromArray(d).getInverse(f.matrix),f.projectionMatrix.fromArray(c.projectionMatrix),f.viewport.set(h.x,h.y,h.width,h.height),0===o&&p.matrix.copy(f.matrix)}for(o=0;o<l.length;o++){var m=l[o],g=u[o];if(g){var v=e.getInputPose(g,a);if(null!==v){"targetRay"in v?m.matrix.elements=v.targetRay.transformMatrix:"pointerMatrix"in v&&(m.matrix.elements=v.pointerMatrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.visible=!0;continue}}m.visible=!1}b&&b(t)}),this.setAnimationLoop=function(t){b=t},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new vn},this.submitFrame=function(){}}function ks(t){console.log("THREE.WebGLRenderer",ae);var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,n=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,u=void 0!==t.powerPreference?t.powerPreference:"default",c=null,h=null;this.domElement=e,this.context=null,this.debug={checkShaderErrors:!1},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=nr,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d,p,f,m,g,b,v,y,A,T,C,S,E,w,k,x,M,O,I=this,_=!1,L=null,P=null,R=null,F=-1,D={geometry:null,program:null,wireframe:!1},N=null,B=null,G=new un,U=new un,H=null,z=e.width,W=e.height,V=1,Y=new un(0,0,z,W),j=new un(0,0,z,W),X=!1,q=new bn,Z=new Ra,K=!1,Q=!1,J=new vn,$=new Wi;function tt(){return null===P?V:1}try{var et={alpha:i,depth:n,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u};if(e.addEventListener("webglcontextlost",at,!1),e.addEventListener("webglcontextrestored",ot,!1),null===(d=r||e.getContext("webgl",et)||e.getContext("experimental-webgl",et)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function rt(){p=new Fa(d),(f=new Pa(d,p,t)).isWebGL2||(p.get("WEBGL_depth_texture"),p.get("OES_texture_float"),p.get("OES_texture_half_float"),p.get("OES_texture_half_float_linear"),p.get("OES_standard_derivatives"),p.get("OES_element_index_uint"),p.get("ANGLE_instanced_arrays")),p.get("OES_texture_float_linear"),O=new cs(d,p,f),(m=new ls(d,p,O,f)).scissor(U.copy(j).multiplyScalar(V)),m.viewport(G.copy(Y).multiplyScalar(V)),g=new Ba(d),b=new Zo,v=new us(d,p,m,b,f,O,g),y=new Ln(d),A=new Da(d,y,g),T=new Ha(A,g),k=new Ua(d),C=new qo(I,p,f,v),S=new $o,E=new ns,w=new _a(I,m,T,s),x=new La(d,p,g,f),M=new Na(d,p,g,f),g.programs=C.programs,I.context=d,I.capabilities=f,I.extensions=p,I.properties=b,I.renderLists=S,I.state=m,I.info=g}rt();var it="undefined"!=typeof navigator&&"xr"in navigator?new ws(I):new Es(I);this.vr=it;var nt=new ss(I,T,f.maxTextureSize);function at(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function ot(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1,rt()}function st(t){var e=t.target;e.removeEventListener("dispose",st),function(t){lt(t),b.remove(t)}(e)}function lt(t){var e=b.get(t).program;t.program=void 0,void 0!==e&&C.releaseProgram(e)}this.shadowMap=nt,this.getContext=function(){return d},this.getContextAttributes=function(){return d.getContextAttributes()},this.forceContextLoss=function(){var t=p.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=p.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return V},this.setPixelRatio=function(t){void 0!==t&&(V=t,this.setSize(z,W,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Hi),t.set(z,W)},this.setSize=function(t,r,i){it.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(z=t,W=r,e.width=t*V,e.height=r*V,!1!==i&&(e.style.width=t+"px",e.style.height=r+"px"),this.setViewport(0,0,t,r))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Hi),t.set(z*V,W*V)},this.setDrawingBufferSize=function(t,r,i){z=t,W=r,V=i,e.width=t*i,e.height=r*i,this.setViewport(0,0,t,r)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new un),t.copy(G)},this.getViewport=function(t){return t.copy(Y)},this.setViewport=function(t,e,r,i){t.isVector4?Y.set(t.x,t.y,t.z,t.w):Y.set(t,e,r,i),m.viewport(G.copy(Y).multiplyScalar(V))},this.getScissor=function(t){return t.copy(j)},this.setScissor=function(t,e,r,i){t.isVector4?j.set(t.x,t.y,t.z,t.w):j.set(t,e,r,i),m.scissor(U.copy(j).multiplyScalar(V))},this.getScissorTest=function(){return X},this.setScissorTest=function(t){m.setScissorTest(X=t)},this.getClearColor=function(){return w.getClearColor()},this.setClearColor=function(){w.setClearColor.apply(w,arguments)},this.getClearAlpha=function(){return w.getClearAlpha()},this.setClearAlpha=function(){w.setClearAlpha.apply(w,arguments)},this.clear=function(t,e,r){var i=0;(void 0===t||t)&&(i|=16384),(void 0===e||e)&&(i|=256),(void 0===r||r)&&(i|=1024),d.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",at,!1),e.removeEventListener("webglcontextrestored",ot,!1),S.dispose(),E.dispose(),b.dispose(),T.dispose(),it.dispose(),ct.stop()},this.renderBufferImmediate=function(t,e){m.initAttributes();var r=b.get(t);t.hasPositions&&!r.position&&(r.position=d.createBuffer()),t.hasNormals&&!r.normal&&(r.normal=d.createBuffer()),t.hasUvs&&!r.uv&&(r.uv=d.createBuffer()),t.hasColors&&!r.color&&(r.color=d.createBuffer());var i=e.getAttributes();t.hasPositions&&(d.bindBuffer(34962,r.position),d.bufferData(34962,t.positionArray,35048),m.enableAttribute(i.position),d.vertexAttribPointer(i.position,3,5126,!1,0,0)),t.hasNormals&&(d.bindBuffer(34962,r.normal),d.bufferData(34962,t.normalArray,35048),m.enableAttribute(i.normal),d.vertexAttribPointer(i.normal,3,5126,!1,0,0)),t.hasUvs&&(d.bindBuffer(34962,r.uv),d.bufferData(34962,t.uvArray,35048),m.enableAttribute(i.uv),d.vertexAttribPointer(i.uv,2,5126,!1,0,0)),t.hasColors&&(d.bindBuffer(34962,r.color),d.bufferData(34962,t.colorArray,35048),m.enableAttribute(i.color),d.vertexAttribPointer(i.color,3,5126,!1,0,0)),m.disableUnusedAttributes(),d.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,r,i,n,a){var o=n.isMesh&&n.matrixWorld.determinant()<0;m.setMaterial(i,o);var s=ft(t,e,i,n),l=!1;D.geometry===r.id&&D.program===s.id&&D.wireframe===(!0===i.wireframe)||(D.geometry=r.id,D.program=s.id,D.wireframe=!0===i.wireframe,l=!0),n.morphTargetInfluences&&(k.update(n,r,i,s),l=!0);var u,c=r.index,h=r.attributes.position,g=1;!0===i.wireframe&&(c=A.getWireframeAttribute(r),g=2);var b=x;null!==c&&(u=y.get(c),(b=M).setIndex(u)),l&&(!function(t,e,r){if(r&&r.isInstancedBufferGeometry&&!f.isWebGL2&&null===p.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m.initAttributes();var i=r.attributes,n=e.getAttributes(),a=t.defaultAttributeValues;for(var o in n){var s=n[o];if(s>=0){var l=i[o];if(void 0!==l){var u=l.normalized,c=l.itemSize,h=y.get(l);if(void 0===h)continue;var g=h.buffer,b=h.type,v=h.bytesPerElement;if(l.isInterleavedBufferAttribute){var A=l.data,T=A.stride,C=l.offset;A&&A.isInstancedInterleavedBuffer?(m.enableAttributeAndDivisor(s,A.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=A.meshPerAttribute*A.count)):m.enableAttribute(s),d.bindBuffer(34962,g),d.vertexAttribPointer(s,c,b,u,T*v,C*v)}else l.isInstancedBufferAttribute?(m.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)):m.enableAttribute(s),d.bindBuffer(34962,g),d.vertexAttribPointer(s,c,b,u,0,0)}else if(void 0!==a){var S=a[o];if(void 0!==S)switch(S.length){case 2:d.vertexAttrib2fv(s,S);break;case 3:d.vertexAttrib3fv(s,S);break;case 4:d.vertexAttrib4fv(s,S);break;default:d.vertexAttrib1fv(s,S)}}}}m.disableUnusedAttributes()}(i,s,r),null!==c&&d.bindBuffer(34963,u.buffer));var v=1/0;null!==c?v=c.count:void 0!==h&&(v=h.count);var T=r.drawRange.start*g,C=r.drawRange.count*g,S=null!==a?a.start*g:0,E=null!==a?a.count*g:1/0,w=Math.max(T,S),O=Math.min(v,T+C,S+E)-1,I=Math.max(0,O-w+1);if(0!==I){if(n.isMesh)if(!0===i.wireframe)m.setLineWidth(i.wireframeLinewidth*tt()),b.setMode(1);else switch(n.drawMode){case wi:b.setMode(4);break;case ki:b.setMode(5);break;case xi:b.setMode(6)}else if(n.isLine){var _=i.linewidth;void 0===_&&(_=1),m.setLineWidth(_*tt()),n.isLineSegments?b.setMode(1):n.isLineLoop?b.setMode(2):b.setMode(3)}else n.isPoints?b.setMode(0):n.isSprite&&b.setMode(4);r&&r.isInstancedBufferGeometry?r.maxInstancedCount>0&&b.renderInstances(r,w,I):b.render(w,I)}},this.compile=function(t,e){(h=E.get(t,e)).init(),t.traverse(function(t){t.isLight&&(h.pushLight(t),t.castShadow&&h.pushShadow(t))}),h.setupLights(e),t.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var r=0;r<e.material.length;r++)pt(e.material[r],t.fog,e);else pt(e.material,t.fog,e)})};var ut=null;var ct=new _n;function ht(t,e,r,i){for(var n=0,a=t.length;n<a;n++){var o=t[n],s=o.object,l=o.geometry,u=void 0===i?o.material:i,c=o.group;if(r.isArrayCamera){B=r;for(var d=r.cameras,p=0,f=d.length;p<f;p++){var g=d[p];if(s.layers.test(g.layers)){if("viewport"in g)m.viewport(G.copy(g.viewport));else{var b=g.bounds,v=b.x*z,y=b.y*W,A=b.z*z,T=b.w*W;m.viewport(G.set(v,y,A,T).multiplyScalar(V))}h.setupLights(g),dt(s,e,g,l,u,c)}}}else B=null,dt(s,e,r,l,u,c)}}function dt(t,e,r,i,n,a){if(t.onBeforeRender(I,e,r,i,n,a),h=E.get(e,B||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){m.setMaterial(n);var o=ft(r,e.fog,n,t);D.geometry=null,D.program=null,D.wireframe=!1,function(t,e){t.render(function(t){I.renderBufferImmediate(t,e)})}(t,o)}else I.renderBufferDirect(r,e.fog,i,n,t,a);t.onAfterRender(I,e,r,i,n,a),h=E.get(e,B||r)}function pt(t,e,r){var i=b.get(t),n=h.state.lights,a=h.state.shadowsArray,o=i.lightsHash,s=n.state.hash,l=C.getParameters(t,n.state,a,e,Z.numPlanes,Z.numIntersection,r),u=C.getProgramCode(t,l),c=i.program,d=!0;if(void 0===c)t.addEventListener("dispose",st);else if(c.code!==u)lt(t);else if(o.stateID!==s.stateID||o.directionalLength!==s.directionalLength||o.pointLength!==s.pointLength||o.spotLength!==s.spotLength||o.rectAreaLength!==s.rectAreaLength||o.hemiLength!==s.hemiLength||o.shadowsLength!==s.shadowsLength)o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,d=!1;else{if(void 0!==l.shaderID)return;d=!1}if(d){if(l.shaderID){var p=In[l.shaderID];i.shader={name:t.type,uniforms:An(p.uniforms),vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}}else i.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(i.shader,I),u=C.getProgramCode(t,l),c=C.acquireProgram(t,i.shader,l,u),i.program=c,t.program=c}var f=c.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var m=0;m<I.maxMorphTargets;m++)f["morphTarget"+m]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(m=0;m<I.maxMorphNormals;m++)f["morphNormal"+m]>=0&&t.numSupportedMorphNormals++}var g=i.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(i.numClippingPlanes=Z.numPlanes,i.numIntersection=Z.numIntersection,g.clippingPlanes=Z.uniform),i.fog=e,void 0===o&&(i.lightsHash=o={}),o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,t.lights&&(g.ambientLightColor.value=n.state.ambient,g.lightProbe.value=n.state.probe,g.directionalLights.value=n.state.directional,g.spotLights.value=n.state.spot,g.rectAreaLights.value=n.state.rectArea,g.pointLights.value=n.state.point,g.hemisphereLights.value=n.state.hemi,g.directionalShadowMap.value=n.state.directionalShadowMap,g.directionalShadowMatrix.value=n.state.directionalShadowMatrix,g.spotShadowMap.value=n.state.spotShadowMap,g.spotShadowMatrix.value=n.state.spotShadowMatrix,g.pointShadowMap.value=n.state.pointShadowMap,g.pointShadowMatrix.value=n.state.pointShadowMatrix);var v=i.program.getUniforms(),y=Do.seqWithValue(v.seq,g);i.uniformsList=y}function ft(t,e,r,i){v.resetTextureUnits();var n=b.get(r),a=h.state.lights,o=n.lightsHash,s=a.state.hash;if(K&&(Q||t!==N)){var l=t===N&&r.id===F;Z.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,t,n,l)}!1===r.needsUpdate&&(void 0===n.program?r.needsUpdate=!0:r.fog&&n.fog!==e?r.needsUpdate=!0:(!r.lights||o.stateID===s.stateID&&o.directionalLength===s.directionalLength&&o.pointLength===s.pointLength&&o.spotLength===s.spotLength&&o.rectAreaLength===s.rectAreaLength&&o.hemiLength===s.hemiLength&&o.shadowsLength===s.shadowsLength)&&(void 0===n.numClippingPlanes||n.numClippingPlanes===Z.numPlanes&&n.numIntersection===Z.numIntersection)||(r.needsUpdate=!0)),r.needsUpdate&&(pt(r,e,i),r.needsUpdate=!1);var u,c,p=!1,g=!1,y=!1,A=n.program,T=A.getUniforms(),C=n.shader.uniforms;if(m.useProgram(A.program)&&(p=!0,g=!0,y=!0),r.id!==F&&(F=r.id,g=!0),p||N!==t){if(T.setValue(d,"projectionMatrix",t.projectionMatrix),f.logarithmicDepthBuffer&&T.setValue(d,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),N!==t&&(N=t,g=!0,y=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var S=T.map.cameraPosition;void 0!==S&&S.setValue(d,$.setFromMatrixPosition(t.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&T.setValue(d,"viewMatrix",t.matrixWorldInverse)}if(r.skinning){T.setOptional(d,i,"bindMatrix"),T.setOptional(d,i,"bindMatrixInverse");var E=i.skeleton;if(E){var w=E.bones;if(f.floatVertexTextures){if(void 0===E.boneTexture){var k=Math.sqrt(4*w.length);k=Ui.ceilPowerOfTwo(k),k=Math.max(k,4);var x=new Float32Array(k*k*4);x.set(E.boneMatrices);var M=new pn(x,k,k,Ur,Lr);M.needsUpdate=!0,E.boneMatrices=x,E.boneTexture=M,E.boneTextureSize=k}T.setValue(d,"boneTexture",E.boneTexture,v),T.setValue(d,"boneTextureSize",E.boneTextureSize)}else T.setOptional(d,E,"boneMatrices")}}return g&&(T.setValue(d,"toneMappingExposure",I.toneMappingExposure),T.setValue(d,"toneMappingWhitePoint",I.toneMappingWhitePoint),r.lights&&(c=y,(u=C).ambientLightColor.needsUpdate=c,u.lightProbe.needsUpdate=c,u.directionalLights.needsUpdate=c,u.pointLights.needsUpdate=c,u.spotLights.needsUpdate=c,u.rectAreaLights.needsUpdate=c,u.hemisphereLights.needsUpdate=c),e&&r.fog&&function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(C,e),r.isMeshBasicMaterial?mt(C,r):r.isMeshLambertMaterial?(mt(C,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(C,r)):r.isMeshPhongMaterial?(mt(C,r),r.isMeshToonMaterial?function(t,e){gt(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(C,r):gt(C,r)):r.isMeshStandardMaterial?(mt(C,r),r.isMeshPhysicalMaterial?function(t,e){bt(t,e),t.reflectivity.value=e.reflectivity,t.clearCoat.value=e.clearCoat,t.clearCoatRoughness.value=e.clearCoatRoughness}(C,r):bt(C,r)):r.isMeshMatcapMaterial?(mt(C,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===be&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===be&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(C,r)):r.isMeshDepthMaterial?(mt(C,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(C,r)):r.isMeshDistanceMaterial?(mt(C,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(C,r)):r.isMeshNormalMaterial?(mt(C,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===be&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===be&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(C,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(C,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(C,r)):r.isPointsMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*V,t.scale.value=.5*W,t.map.value=e.map,null!==e.map&&(!0===e.map.matrixAutoUpdate&&e.map.updateMatrix(),t.uvTransform.value.copy(e.map.matrix))}(C,r):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,t.map.value=e.map,null!==e.map&&(!0===e.map.matrixAutoUpdate&&e.map.updateMatrix(),t.uvTransform.value.copy(e.map.matrix))}(C,r):r.isShadowMaterial&&(C.color.value.copy(r.color),C.opacity.value=r.opacity),void 0!==C.ltc_1&&(C.ltc_1.value=On.LTC_1),void 0!==C.ltc_2&&(C.ltc_2.value=On.LTC_2),Do.upload(d,n.uniformsList,C,v)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Do.upload(d,n.uniformsList,C,v),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&T.setValue(d,"center",i.center),T.setValue(d,"modelViewMatrix",i.modelViewMatrix),T.setValue(d,"normalMatrix",i.normalMatrix),T.setValue(d,"modelMatrix",i.matrixWorld),A}function mt(t,e){var r;t.opacity.value=e.opacity,e.color&&t.diffuse.value.copy(e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=b.get(e.envMap).__maxMipLevel),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?r=e.map:e.specularMap?r=e.specularMap:e.displacementMap?r=e.displacementMap:e.normalMap?r=e.normalMap:e.bumpMap?r=e.bumpMap:e.roughnessMap?r=e.roughnessMap:e.metalnessMap?r=e.metalnessMap:e.alphaMap?r=e.alphaMap:e.emissiveMap&&(r=e.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}function gt(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===be&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===be&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function bt(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===be&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===be&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}ct.setAnimationLoop(function(t){it.isPresenting()||ut&&ut(t)}),"undefined"!=typeof window&&ct.setContext(window),this.setAnimationLoop=function(t){ut=t,it.setAnimationLoop(t),ct.start()},this.render=function(t,e){var r,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),e&&e.isCamera){if(!_){D.geometry=null,D.program=null,D.wireframe=!1,F=-1,N=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),it.enabled&&(e=it.getCamera(e)),(h=E.get(t,e)).init(),t.onBeforeRender(I,t,e,r||P),J.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),q.setFromMatrix(J),Q=this.localClippingEnabled,K=Z.init(this.clippingPlanes,Q,e),(c=S.get(t,e)).init(),function t(e,r,i,n){if(!1===e.visible)return;var a=e.layers.test(r.layers);if(a)if(e.isGroup)i=e.renderOrder;else if(e.isLight)h.pushLight(e),e.castShadow&&h.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||q.intersectsSprite(e)){n&&$.setFromMatrixPosition(e.matrixWorld).applyMatrix4(J);var o=T.update(e),s=e.material;s.visible&&c.push(e,o,s,i,$.z,null)}}else if(e.isImmediateRenderObject)n&&$.setFromMatrixPosition(e.matrixWorld).applyMatrix4(J),c.push(e,null,e.material,i,$.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||q.intersectsObject(e))){n&&$.setFromMatrixPosition(e.matrixWorld).applyMatrix4(J);var o=T.update(e),s=e.material;if(Array.isArray(s))for(var l=o.groups,u=0,d=l.length;u<d;u++){var p=l[u],f=s[p.materialIndex];f&&f.visible&&c.push(e,o,f,i,$.z,p)}else s.visible&&c.push(e,o,s,i,$.z,null)}var m=e.children;for(var u=0,d=m.length;u<d;u++)t(m[u],r,i,n)}(t,e,0,I.sortObjects),!0===I.sortObjects&&c.sort(),K&&Z.beginShadows();var n=h.state.shadowsArray;nt.render(n,t,e),h.setupLights(e),K&&Z.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),w.render(c,t,e,i);var a=c.opaque,o=c.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;a.length&&ht(a,t,e,s),o.length&&ht(o,t,e,s)}else a.length&&ht(a,t,e),o.length&&ht(o,t,e);t.onAfterRender(I,t,e),null!==P&&(v.updateRenderTargetMipmap(P),v.updateMultisampleRenderTarget(P)),m.buffers.depth.setTest(!0),m.buffers.depth.setMask(!0),m.buffers.color.setMask(!0),m.setPolygonOffset(!1),it.enabled&&it.submitFrame(),c=null,h=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){L=t},this.getRenderTarget=function(){return P},this.setRenderTarget=function(t,e,r){P=t,t&&void 0===b.get(t).__webglFramebuffer&&v.setupRenderTarget(t);var i=L,n=!1;if(t){var a=b.get(t).__webglFramebuffer;t.isWebGLRenderTargetCube?(i=a[e||0],n=!0):i=t.isWebGLMultisampleRenderTarget?b.get(t).__webglMultisampledFramebuffer:a,G.copy(t.viewport),U.copy(t.scissor),H=t.scissorTest}else G.copy(Y).multiplyScalar(V),U.copy(j).multiplyScalar(V),H=X;if(R!==i&&(d.bindFramebuffer(36160,i),R=i),m.viewport(G),m.scissor(U),m.setScissorTest(H),n){var o=b.get(t.texture);d.framebufferTexture2D(36160,36064,34069+(e||0),o.__webglTexture,r||0)}},this.readRenderTargetPixels=function(t,e,r,i,n,a){if(t&&t.isWebGLRenderTarget){var o=b.get(t).__webglFramebuffer;if(o){var s=!1;o!==R&&(d.bindFramebuffer(36160,o),s=!0);try{var l=t.texture,u=l.format,c=l.type;if(u!==Ur&&O.convert(u)!==d.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===kr||O.convert(c)===d.getParameter(35738)||c===Lr&&(f.isWebGL2||p.get("OES_texture_float")||p.get("WEBGL_color_buffer_float"))||c===Pr&&(f.isWebGL2?p.get("EXT_color_buffer_float"):p.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===d.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&r>=0&&r<=t.height-n&&d.readPixels(e,r,i,n,O.convert(u),O.convert(c),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&d.bindFramebuffer(36160,R)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,r){var i=e.image.width,n=e.image.height,a=O.convert(e.format);v.setTexture2D(e,0),d.copyTexImage2D(3553,r||0,a,t.x,t.y,i,n,0)},this.copyTextureToTexture=function(t,e,r,i){var n=e.image.width,a=e.image.height,o=O.convert(r.format),s=O.convert(r.type);v.setTexture2D(r,0),e.isDataTexture?d.texSubImage2D(3553,i||0,t.x,t.y,n,a,o,s,e.image.data):d.texSubImage2D(3553,i||0,t.x,t.y,o,s,e.image)}}function xs(t,e){this.name="",this.color=new xn(t),this.density=void 0!==e?e:25e-5}function Ms(t,e,r){this.name="",this.color=new xn(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3}function Os(){Hn.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Is(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function _s(t,e,r,i){this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===i}function Ls(t){ha.call(this),this.type="SpriteMaterial",this.color=new xn(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(t)}function Ps(t){if(Hn.call(this),this.type="Sprite",void 0===ms){ms=new aa;var e=new Is(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);ms.setIndex([0,1,2,0,2,3]),ms.addAttribute("position",new _s(e,3,0,!1)),ms.addAttribute("uv",new _s(e,2,3,!1))}this.geometry=ms,this.material=void 0!==t?t:new Ls,this.center=new Hi(.5,.5)}function Rs(){Hn.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Fs(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Ia.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new vn,this.bindMatrixInverse=new vn}function Ds(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new vn)}}function Ns(){Hn.call(this),this.type="Bone"}function Bs(t){ha.call(this),this.type="LineBasicMaterial",this.color=new xn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function Gs(t,e,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Hn.call(this),this.type="Line",this.geometry=void 0!==t?t:new aa,this.material=void 0!==e?e:new Bs({color:16777215*Math.random()})}function Us(t,e){Gs.call(this,t,e),this.type="LineSegments"}function Hs(t,e){Gs.call(this,t,e),this.type="LineLoop"}function zs(t){ha.call(this),this.type="PointsMaterial",this.color=new xn(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function Ws(t,e){Hn.call(this),this.type="Points",this.geometry=void 0!==t?t:new aa,this.material=void 0!==e?e:new zs({color:16777215*Math.random()})}function Vs(t,e,r,i,n,a,o,s,l){ln.call(this,t,e,r,i,n,a,o,s,l),this.format=void 0!==o?o:Gr,this.minFilter=void 0!==a?a:Sr,this.magFilter=void 0!==n?n:Sr,this.generateMipmaps=!1}function Ys(t,e,r,i,n,a,o,s,l,u,c,h){ln.call(this,null,a,o,s,l,u,i,n,c,h),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function js(t,e,r,i,n,a,o,s,l){ln.call(this,t,e,r,i,n,a,o,s,l),this.needsUpdate=!0}function Xs(t,e,r,i,n,a,o,s,l,u){if((u=void 0!==u?u:Vr)!==Vr&&u!==Yr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===Vr&&(r=Or),void 0===r&&u===Yr&&(r=Nr),ln.call(this,null,i,n,a,o,s,u,r,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:Ar,this.minFilter=void 0!==s?s:Ar,this.flipY=!1,this.generateMipmaps=!1}function qs(t){aa.call(this),this.type="WireframeGeometry";var e,r,i,n,a,o,s,l,u,c,h=[],d=[0,0],p={},f=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,i=m.length;e<i;e++){var g=m[e];for(r=0;r<3;r++)s=g[f[r]],l=g[f[(r+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[u=d[0]+","+d[1]]&&(p[u]={index1:d[0],index2:d[1]})}for(u in p)o=p[u],c=t.vertices[o.index1],h.push(c.x,c.y,c.z),c=t.vertices[o.index2],h.push(c.x,c.y,c.z)}else if(t&&t.isBufferGeometry){var b,v,y,A,T,C,S;if(c=new Wi,null!==t.index){for(b=t.attributes.position,v=t.index,0===(y=t.groups).length&&(y=[{start:0,count:v.count,materialIndex:0}]),n=0,a=y.length;n<a;++n)for(e=T=(A=y[n]).start,i=T+A.count;e<i;e+=3)for(r=0;r<3;r++)s=v.getX(e+r),l=v.getX(e+(r+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[u=d[0]+","+d[1]]&&(p[u]={index1:d[0],index2:d[1]});for(u in p)o=p[u],c.fromBufferAttribute(b,o.index1),h.push(c.x,c.y,c.z),c.fromBufferAttribute(b,o.index2),h.push(c.x,c.y,c.z)}else for(e=0,i=(b=t.attributes.position).count/3;e<i;e++)for(r=0;r<3;r++)C=3*e+r,c.fromBufferAttribute(b,C),h.push(c.x,c.y,c.z),S=3*e+(r+1)%3,c.fromBufferAttribute(b,S),h.push(c.x,c.y,c.z)}this.addAttribute("position",new ta(h,3))}function Zs(t,e,r){Yn.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new Ks(t,e,r)),this.mergeVertices()}function Ks(t,e,r){aa.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var i,n,a=[],o=[],s=[],l=[],u=new Wi,c=new Wi,h=new Wi,d=new Wi,p=new Wi;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var f=e+1;for(i=0;i<=r;i++){var m=i/r;for(n=0;n<=e;n++){var g=n/e;t(g,m,c),o.push(c.x,c.y,c.z),g-1e-5>=0?(t(g-1e-5,m,h),d.subVectors(c,h)):(t(g+1e-5,m,h),d.subVectors(h,c)),m-1e-5>=0?(t(g,m-1e-5,h),p.subVectors(c,h)):(t(g,m+1e-5,h),p.subVectors(h,c)),u.crossVectors(d,p).normalize(),s.push(u.x,u.y,u.z),l.push(g,m)}}for(i=0;i<r;i++)for(n=0;n<e;n++){var b=i*f+n,v=i*f+n+1,y=(i+1)*f+n+1,A=(i+1)*f+n;a.push(b,v,A),a.push(v,y,A)}this.setIndex(a),this.addAttribute("position",new ta(o,3)),this.addAttribute("normal",new ta(s,3)),this.addAttribute("uv",new ta(l,2))}function Qs(t,e,r,i){Yn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:i},this.fromBufferGeometry(new Js(t,e,r,i)),this.mergeVertices()}function Js(t,e,r,i){aa.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:i},r=r||1;var n=[],a=[];function o(t,e,r,i){var n,a,o=Math.pow(2,i),l=[];for(n=0;n<=o;n++){l[n]=[];var u=t.clone().lerp(r,n/o),c=e.clone().lerp(r,n/o),h=o-n;for(a=0;a<=h;a++)l[n][a]=0===a&&n===o?u:u.clone().lerp(c,a/h)}for(n=0;n<o;n++)for(a=0;a<2*(o-n)-1;a++){var d=Math.floor(a/2);a%2==0?(s(l[n][d+1]),s(l[n+1][d]),s(l[n][d])):(s(l[n][d+1]),s(l[n+1][d+1]),s(l[n+1][d]))}}function s(t){n.push(t.x,t.y,t.z)}function l(e,r){var i=3*e;r.x=t[i+0],r.y=t[i+1],r.z=t[i+2]}function u(t,e,r,i){i<0&&1===t.x&&(a[e]=t.x-1),0===r.x&&0===r.z&&(a[e]=i/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){for(var r=new Wi,i=new Wi,n=new Wi,a=0;a<e.length;a+=3)l(e[a+0],r),l(e[a+1],i),l(e[a+2],n),o(r,i,n,t)}(i=i||0),function(t){for(var e=new Wi,r=0;r<n.length;r+=3)e.x=n[r+0],e.y=n[r+1],e.z=n[r+2],e.normalize().multiplyScalar(t),n[r+0]=e.x,n[r+1]=e.y,n[r+2]=e.z}(r),function(){for(var t=new Wi,e=0;e<n.length;e+=3){t.x=n[e+0],t.y=n[e+1],t.z=n[e+2];var r=c(t)/2/Math.PI+.5,i=(o=t,Math.atan2(-o.y,Math.sqrt(o.x*o.x+o.z*o.z))/Math.PI+.5);a.push(r,1-i)}var o;(function(){for(var t=new Wi,e=new Wi,r=new Wi,i=new Wi,o=new Hi,s=new Hi,l=new Hi,h=0,d=0;h<n.length;h+=9,d+=6){t.set(n[h+0],n[h+1],n[h+2]),e.set(n[h+3],n[h+4],n[h+5]),r.set(n[h+6],n[h+7],n[h+8]),o.set(a[d+0],a[d+1]),s.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),i.copy(t).add(e).add(r).divideScalar(3);var p=c(i);u(o,d+0,t,p),u(s,d+2,e,p),u(l,d+4,r,p)}})(),function(){for(var t=0;t<a.length;t+=6){var e=a[t+0],r=a[t+2],i=a[t+4],n=Math.max(e,r,i),o=Math.min(e,r,i);n>.9&&o<.1&&(e<.2&&(a[t+0]+=1),r<.2&&(a[t+2]+=1),i<.2&&(a[t+4]+=1))}}()}(),this.addAttribute("position",new ta(n,3)),this.addAttribute("normal",new ta(n.slice(),3)),this.addAttribute("uv",new ta(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function $s(t,e){Yn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new tl(t,e)),this.mergeVertices()}function tl(t,e){Js.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function el(t,e){Yn.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new rl(t,e)),this.mergeVertices()}function rl(t,e){Js.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function il(t,e){Yn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new nl(t,e)),this.mergeVertices()}function nl(t,e){var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];Js.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function al(t,e){Yn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new ol(t,e)),this.mergeVertices()}function ol(t,e){var r=(1+Math.sqrt(5))/2,i=1/r,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i];Js.call(this,n,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function sl(t,e,r,i,n,a){Yn.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:i,closed:n},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new ll(t,e,r,i,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function ll(t,e,r,i,n){aa.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:i,closed:n},e=e||64,r=r||1,i=i||8,n=n||!1;var a=t.computeFrenetFrames(e,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,l=new Wi,u=new Wi,c=new Hi,h=new Wi,d=[],p=[],f=[],m=[];function g(n){h=t.getPointAt(n/e,h);var o=a.normals[n],c=a.binormals[n];for(s=0;s<=i;s++){var f=s/i*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);u.x=g*o.x+m*c.x,u.y=g*o.y+m*c.y,u.z=g*o.z+m*c.z,u.normalize(),p.push(u.x,u.y,u.z),l.x=h.x+r*u.x,l.y=h.y+r*u.y,l.z=h.z+r*u.z,d.push(l.x,l.y,l.z)}}!function(){for(o=0;o<e;o++)g(o);g(!1===n?e:0),function(){for(o=0;o<=e;o++)for(s=0;s<=i;s++)c.x=o/e,c.y=s/i,f.push(c.x,c.y)}(),function(){for(s=1;s<=e;s++)for(o=1;o<=i;o++){var t=(i+1)*(s-1)+(o-1),r=(i+1)*s+(o-1),n=(i+1)*s+o,a=(i+1)*(s-1)+o;m.push(t,r,a),m.push(r,n,a)}}()}(),this.setIndex(m),this.addAttribute("position",new ta(d,3)),this.addAttribute("normal",new ta(p,3)),this.addAttribute("uv",new ta(f,2))}function ul(t,e,r,i,n,a,o){Yn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:i,p:n,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new cl(t,e,r,i,n,a)),this.mergeVertices()}function cl(t,e,r,i,n,a){aa.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:i,p:n,q:a},t=t||1,e=e||.4,r=Math.floor(r)||64,i=Math.floor(i)||8,n=n||2,a=a||3;var o,s,l=[],u=[],c=[],h=[],d=new Wi,p=new Wi,f=new Wi,m=new Wi,g=new Wi,b=new Wi,v=new Wi;for(o=0;o<=r;++o){var y=o/r*n*Math.PI*2;for(x(y,n,a,t,f),x(y+.01,n,a,t,m),b.subVectors(m,f),v.addVectors(m,f),g.crossVectors(b,v),v.crossVectors(g,b),g.normalize(),v.normalize(),s=0;s<=i;++s){var A=s/i*Math.PI*2,T=-e*Math.cos(A),C=e*Math.sin(A);d.x=f.x+(T*v.x+C*g.x),d.y=f.y+(T*v.y+C*g.y),d.z=f.z+(T*v.z+C*g.z),u.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),c.push(p.x,p.y,p.z),h.push(o/r),h.push(s/i)}}for(s=1;s<=r;s++)for(o=1;o<=i;o++){var S=(i+1)*(s-1)+(o-1),E=(i+1)*s+(o-1),w=(i+1)*s+o,k=(i+1)*(s-1)+o;l.push(S,E,k),l.push(E,w,k)}function x(t,e,r,i,n){var a=Math.cos(t),o=Math.sin(t),s=r/e*t,l=Math.cos(s);n.x=i*(2+l)*.5*a,n.y=i*(2+l)*o*.5,n.z=i*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new ta(u,3)),this.addAttribute("normal",new ta(c,3)),this.addAttribute("uv",new ta(h,2))}function hl(t,e,r,i,n){Yn.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:i,arc:n},this.fromBufferGeometry(new dl(t,e,r,i,n)),this.mergeVertices()}function dl(t,e,r,i,n){aa.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:i,arc:n},t=t||1,e=e||.4,r=Math.floor(r)||8,i=Math.floor(i)||6,n=n||2*Math.PI;var a,o,s=[],l=[],u=[],c=[],h=new Wi,d=new Wi,p=new Wi;for(a=0;a<=r;a++)for(o=0;o<=i;o++){var f=o/i*n,m=a/r*Math.PI*2;d.x=(t+e*Math.cos(m))*Math.cos(f),d.y=(t+e*Math.cos(m))*Math.sin(f),d.z=e*Math.sin(m),l.push(d.x,d.y,d.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),p.subVectors(d,h).normalize(),u.push(p.x,p.y,p.z),c.push(o/i),c.push(a/r)}for(a=1;a<=r;a++)for(o=1;o<=i;o++){var g=(i+1)*a+o-1,b=(i+1)*(a-1)+o-1,v=(i+1)*(a-1)+o,y=(i+1)*a+o;s.push(g,b,y),s.push(b,v,y)}this.setIndex(s),this.addAttribute("position",new ta(l,3)),this.addAttribute("normal",new ta(u,3)),this.addAttribute("uv",new ta(c,2))}Object.assign(xs.prototype,{isFogExp2:!0,clone:function(){return new xs(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Ms.prototype,{isFog:!0,clone:function(){return new Ms(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Os.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Os,isScene:!0,copy:function(t,e){return Hn.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=Hn.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Is.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Is.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==t?t.length/this.stride:0,this.array=t,this},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var i=0,n=this.stride;i<n;i++)this.array[t+i]=e.array[r+i];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),Object.defineProperties(_s.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(_s.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=i,this},setXYZW:function(t,e,r,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=i,this.data.array[t+3]=n,this}}),Ls.prototype=Object.create(ha.prototype),Ls.prototype.constructor=Ls,Ls.prototype.isSpriteMaterial=!0,Ls.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this},Ps.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Ps,isSprite:!0,raycast:function(){var t=new Wi,e=new Wi,r=new Wi,i=new Hi,n=new Hi,a=new vn,o=new Wi,s=new Wi,l=new Wi,u=new Hi,c=new Hi,h=new Hi;function d(t,e,r,o,s,l){i.subVectors(t,r).addScalar(.5).multiply(o),void 0!==s?(n.x=l*i.x-s*i.y,n.y=s*i.x+l*i.y):n.copy(i),t.copy(e),t.x+=n.x,t.y+=n.y,t.applyMatrix4(a)}return function(i,n){e.setFromMatrixScale(this.matrixWorld),a.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),r.setFromMatrixPosition(this.modelViewMatrix);var p,f,m=this.material.rotation;0!==m&&(f=Math.cos(m),p=Math.sin(m));var g=this.center;d(o.set(-.5,-.5,0),r,g,e,p,f),d(s.set(.5,-.5,0),r,g,e,p,f),d(l.set(.5,.5,0),r,g,e,p,f),u.set(0,0),c.set(1,0),h.set(1,1);var b=i.ray.intersectTriangle(o,s,l,!1,t);if(null!==b||(d(s.set(-.5,.5,0),r,g,e,p,f),c.set(0,1),null!==(b=i.ray.intersectTriangle(o,l,s,!1,t)))){var v=i.ray.origin.distanceTo(t);v<i.near||v>i.far||n.push({distance:v,point:t.clone(),uv:Ma.getUV(t,o,s,l,u,c,h,new Hi),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return Hn.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}}),Rs.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Rs,isLOD:!0,copy:function(t){Hn.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,i=e.length;r<i;r++){var n=e[r];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,i=0;i<r.length&&!(e<r[i].distance);i++);return r.splice(i,0,{distance:e,object:t}),this.add(t),this},getObjectForDistance:function(t){for(var e=this.levels,r=1,i=e.length;r<i&&!(t<e[r].distance);r++);return e[r-1].object},raycast:(gs=new Wi,function(t,e){gs.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(gs);this.getObjectForDistance(r).raycast(t,e)}),update:function(){var t=new Wi,e=new Wi;return function(r){var i=this.levels;if(i.length>1){t.setFromMatrixPosition(r.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var n=t.distanceTo(e);i[0].object.visible=!0;for(var a=1,o=i.length;a<o&&n>=i[a].distance;a++)i[a-1].object.visible=!1,i[a].object.visible=!0;for(;a<o;a++)i[a].object.visible=!1}}}(),toJSON:function(t){var e=Hn.prototype.toJSON.call(this,t);e.object.levels=[];for(var r=this.levels,i=0,n=r.length;i<n;i++){var a=r[i];e.object.levels.push({object:a.object.uuid,distance:a.distance})}return e}}),Fs.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Fs,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new un,e=this.geometry.attributes.skinWeight,r=0,i=e.count;r<i;r++){t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.w=e.getW(r);var n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(r,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){Ia.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(Ds.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new vn;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:(bs=new vn,vs=new vn,function(){for(var t=this.bones,e=this.boneInverses,r=this.boneMatrices,i=this.boneTexture,n=0,a=t.length;n<a;n++){var o=t[n]?t[n].matrixWorld:vs;bs.multiplyMatrices(o,e[n]),bs.toArray(r,16*n)}void 0!==i&&(i.needsUpdate=!0)}),clone:function(){return new Ds(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var i=this.bones[e];if(i.name===t)return i}}}),Ns.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Ns,isBone:!0}),Bs.prototype=Object.create(ha.prototype),Bs.prototype.constructor=Bs,Bs.prototype.isLineBasicMaterial=!0,Bs.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},Gs.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Gs,isLine:!0,computeLineDistances:(ys=new Wi,As=new Wi,function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,r=[0],i=1,n=e.count;i<n;i++)ys.fromBufferAttribute(e,i-1),As.fromBufferAttribute(e,i),r[i]=r[i-1],r[i]+=ys.distanceTo(As);t.addAttribute("lineDistance",new ta(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var a=t.vertices;for((r=t.lineDistances)[0]=0,i=1,n=a.length;i<n;i++)r[i]=r[i-1],r[i]+=a[i-1].distanceTo(a[i])}return this}),raycast:function(){var t=new vn,e=new xa,r=new mn;return function(i,n){var a=i.linePrecision,o=this.geometry,s=this.matrixWorld;if(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=a,!1!==i.ray.intersectsSphere(r)){t.getInverse(s),e.copy(i.ray).applyMatrix4(t);var l=a/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,c=new Wi,h=new Wi,d=new Wi,p=new Wi,f=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var m=o.index,g=o.attributes.position.array;if(null!==m)for(var b=m.array,v=0,y=b.length-1;v<y;v+=f){var A=b[v],T=b[v+1];if(c.fromArray(g,3*A),h.fromArray(g,3*T),!(e.distanceSqToSegment(c,h,p,d)>u))p.applyMatrix4(this.matrixWorld),(E=i.ray.origin.distanceTo(p))<i.near||E>i.far||n.push({distance:E,point:d.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}else for(v=0,y=g.length/3-1;v<y;v+=f){if(c.fromArray(g,3*v),h.fromArray(g,3*v+3),!(e.distanceSqToSegment(c,h,p,d)>u))p.applyMatrix4(this.matrixWorld),(E=i.ray.origin.distanceTo(p))<i.near||E>i.far||n.push({distance:E,point:d.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else if(o.isGeometry){var C=o.vertices,S=C.length;for(v=0;v<S-1;v+=f){var E;if(!(e.distanceSqToSegment(C[v],C[v+1],p,d)>u))p.applyMatrix4(this.matrixWorld),(E=i.ray.origin.distanceTo(p))<i.near||E>i.far||n.push({distance:E,point:d.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Us.prototype=Object.assign(Object.create(Gs.prototype),{constructor:Us,isLineSegments:!0,computeLineDistances:function(){var t=new Wi,e=new Wi;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var i=r.attributes.position,n=[],a=0,o=i.count;a<o;a+=2)t.fromBufferAttribute(i,a),e.fromBufferAttribute(i,a+1),n[a]=0===a?0:n[a-1],n[a+1]=n[a]+t.distanceTo(e);r.addAttribute("lineDistance",new ta(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;for(n=r.lineDistances,a=0,o=s.length;a<o;a+=2)t.copy(s[a]),e.copy(s[a+1]),n[a]=0===a?0:n[a-1],n[a+1]=n[a]+t.distanceTo(e)}return this}}()}),Hs.prototype=Object.assign(Object.create(Gs.prototype),{constructor:Hs,isLineLoop:!0}),zs.prototype=Object.create(ha.prototype),zs.prototype.constructor=zs,zs.prototype.isPointsMaterial=!0,zs.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this},Ws.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Ws,isPoints:!0,raycast:function(){var t=new vn,e=new xa,r=new mn;return function(i,n){var a=this,o=this.geometry,s=this.matrixWorld,l=i.params.Points.threshold;if(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=l,!1!==i.ray.intersectsSphere(r)){t.getInverse(s),e.copy(i.ray).applyMatrix4(t);var u=l/((this.scale.x+this.scale.y+this.scale.z)/3),c=u*u,h=new Wi,d=new Wi;if(o.isBufferGeometry){var p=o.index,f=o.attributes.position.array;if(null!==p)for(var m=p.array,g=0,b=m.length;g<b;g++){var v=m[g];h.fromArray(f,3*v),T(h,v)}else{g=0;for(var y=f.length/3;g<y;g++)h.fromArray(f,3*g),T(h,g)}}else{var A=o.vertices;for(g=0,y=A.length;g<y;g++)T(A[g],g)}}function T(t,r){var o=e.distanceSqToPoint(t);if(o<c){e.closestPointToPoint(t,d),d.applyMatrix4(s);var l=i.ray.origin.distanceTo(d);if(l<i.near||l>i.far)return;n.push({distance:l,distanceToRay:Math.sqrt(o),point:d.clone(),index:r,face:null,object:a})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Vs.prototype=Object.assign(Object.create(ln.prototype),{constructor:Vs,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Ys.prototype=Object.create(ln.prototype),Ys.prototype.constructor=Ys,Ys.prototype.isCompressedTexture=!0,js.prototype=Object.create(ln.prototype),js.prototype.constructor=js,js.prototype.isCanvasTexture=!0,Xs.prototype=Object.create(ln.prototype),Xs.prototype.constructor=Xs,Xs.prototype.isDepthTexture=!0,qs.prototype=Object.create(aa.prototype),qs.prototype.constructor=qs,Zs.prototype=Object.create(Yn.prototype),Zs.prototype.constructor=Zs,Ks.prototype=Object.create(aa.prototype),Ks.prototype.constructor=Ks,Qs.prototype=Object.create(Yn.prototype),Qs.prototype.constructor=Qs,Js.prototype=Object.create(aa.prototype),Js.prototype.constructor=Js,$s.prototype=Object.create(Yn.prototype),$s.prototype.constructor=$s,tl.prototype=Object.create(Js.prototype),tl.prototype.constructor=tl,el.prototype=Object.create(Yn.prototype),el.prototype.constructor=el,rl.prototype=Object.create(Js.prototype),rl.prototype.constructor=rl,il.prototype=Object.create(Yn.prototype),il.prototype.constructor=il,nl.prototype=Object.create(Js.prototype),nl.prototype.constructor=nl,al.prototype=Object.create(Yn.prototype),al.prototype.constructor=al,ol.prototype=Object.create(Js.prototype),ol.prototype.constructor=ol,sl.prototype=Object.create(Yn.prototype),sl.prototype.constructor=sl,ll.prototype=Object.create(aa.prototype),ll.prototype.constructor=ll,ll.prototype.toJSON=function(){var t=aa.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},ul.prototype=Object.create(Yn.prototype),ul.prototype.constructor=ul,cl.prototype=Object.create(aa.prototype),cl.prototype.constructor=cl,hl.prototype=Object.create(Yn.prototype),hl.prototype.constructor=hl,dl.prototype=Object.create(aa.prototype),dl.prototype.constructor=dl;var pl=function(t,e,r){r=r||2;var i,n,a,o,s,l,u,c=e&&e.length,h=c?e[0]*r:t.length,d=fl(t,0,h,r,!0),p=[];if(!d)return p;if(c&&(d=function(t,e,r,i){var n,a,o,s,l,u=[];for(n=0,a=e.length;n<a;n++)o=e[n]*i,s=n<a-1?e[n+1]*i:t.length,(l=fl(t,o,s,i,!1))===l.next&&(l.steiner=!0),u.push(El(l));for(u.sort(Tl),n=0;n<u.length;n++)Cl(u[n],r),r=ml(r,r.next);return r}(t,e,d,r)),t.length>80*r){i=a=t[0],n=o=t[1];for(var f=r;f<h;f+=r)(s=t[f])<i&&(i=s),(l=t[f+1])<n&&(n=l),s>a&&(a=s),l>o&&(o=l);u=0!==(u=Math.max(a-i,o-n))?1/u:0}return gl(d,p,r,i,n,u),p};function fl(t,e,r,i,n){var a,o;if(n===function(t,e,r,i){for(var n=0,a=e,o=r-i;a<r;a+=i)n+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return n}(t,e,r,i)>0)for(a=e;a<r;a+=i)o=Ll(a,t[a],t[a+1],o);else for(a=r-i;a>=e;a-=i)o=Ll(a,t[a],t[a+1],o);return o&&Ml(o,o.next)&&(Pl(o),o=o.next),o}function ml(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!Ml(i,i.next)&&0!==xl(i.prev,i,i.next))i=i.next;else{if(Pl(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function gl(t,e,r,i,n,a,o){if(t){!o&&a&&function(t,e,r,i){var n=t;do{null===n.z&&(n.z=Sl(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,a,o,s,l,u=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,i=r,s=0,e=0;e<u&&(s++,i=i.nextZ);e++);for(l=u;s>0||l>0&&i;)0!==s&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,l--),a?a.nextZ=n:t=n,n.prevZ=a,a=n;r=i}a.nextZ=null,u*=2}while(o>1)}(n)}(t,i,n,a);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,a?vl(t,i,n,a):bl(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),Pl(t),t=l.next,u=l.next;else if((t=l)===u){o?1===o?gl(t=yl(t,e,r),e,r,i,n,a,2):2===o&&Al(t,e,r,i,n,a):gl(ml(t),e,r,i,n,a,1);break}}}function bl(t){var e=t.prev,r=t,i=t.next;if(xl(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(wl(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&xl(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function vl(t,e,r,i){var n=t.prev,a=t,o=t.next;if(xl(n,a,o)>=0)return!1;for(var s=n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,l=n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,u=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,c=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,h=Sl(s,l,e,r,i),d=Sl(u,c,e,r,i),p=t.nextZ;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&wl(n.x,n.y,a.x,a.y,o.x,o.y,p.x,p.y)&&xl(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&wl(n.x,n.y,a.x,a.y,o.x,o.y,p.x,p.y)&&xl(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function yl(t,e,r){var i=t;do{var n=i.prev,a=i.next.next;!Ml(n,a)&&Ol(n,i,i.next,a)&&Il(n,a)&&Il(a,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(a.i/r),Pl(i),Pl(i.next),i=t=a),i=i.next}while(i!==t);return i}function Al(t,e,r,i,n,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&kl(o,s)){var l=_l(o,s);return o=ml(o,o.next),l=ml(l,l.next),gl(o,e,r,i,n,a),void gl(l,e,r,i,n,a)}s=s.next}o=o.next}while(o!==t)}function Tl(t,e){return t.x-e.x}function Cl(t,e){if(e=function(t,e){var r,i=e,n=t.x,a=t.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>o){if(o=s,s===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===o)return r.prev;var l,u=r,c=r.x,h=r.y,d=1/0;i=r.next;for(;i!==u;)n>=i.x&&i.x>=c&&n!==i.x&&wl(a<h?n:o,a,c,h,a<h?o:n,a,i.x,i.y)&&((l=Math.abs(a-i.y)/(n-i.x))<d||l===d&&i.x>r.x)&&Il(i,t)&&(r=i,d=l),i=i.next;return r}(t,e)){var r=_l(e,t);ml(r,r.next)}}function Sl(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function El(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function wl(t,e,r,i,n,a,o,s){return(n-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(n-o)*(i-s)>=0}function kl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Ol(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&Il(t,e)&&Il(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)}function xl(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ml(t,e){return t.x===e.x&&t.y===e.y}function Ol(t,e,r,i){return!!(Ml(t,e)&&Ml(r,i)||Ml(t,i)&&Ml(r,e))||xl(t,e,r)>0!=xl(t,e,i)>0&&xl(r,i,t)>0!=xl(r,i,e)>0}function Il(t,e){return xl(t.prev,t,t.next)<0?xl(t,e,t.next)>=0&&xl(t,t.prev,e)>=0:xl(t,e,t.prev)<0||xl(t,t.next,e)<0}function _l(t,e){var r=new Rl(t.i,t.x,t.y),i=new Rl(e.i,e.x,e.y),n=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function Ll(t,e,r,i){var n=new Rl(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Pl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Rl(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Fl={area:function(t){for(var e=t.length,r=0,i=e-1,n=0;n<e;i=n++)r+=t[i].x*t[n].y-t[n].x*t[i].y;return.5*r},isClockWise:function(t){return Fl.area(t)<0},triangulateShape:function(t,e){var r=[],i=[],n=[];Dl(t),Nl(r,t);var a=t.length;e.forEach(Dl);for(var o=0;o<e.length;o++)i.push(a),a+=e[o].length,Nl(r,e[o]);var s=pl(r,i);for(o=0;o<s.length;o+=3)n.push(s.slice(o,o+3));return n}};function Dl(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Nl(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function Bl(t,e){Yn.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Gl(t,e)),this.mergeVertices()}function Gl(t,e){aa.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var r=this,i=[],n=[],a=0,o=t.length;a<o;a++){s(t[a])}function s(t){var a=[],o=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:100,u=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:c-2,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3,f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:Ul;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);var g,b,v,y,A,T,C,S,E=!1;f&&(g=f.getSpacedPoints(s),E=!0,u=!1,b=f.computeFrenetFrames(s,!1),v=new Wi,y=new Wi,A=new Wi),u||(p=0,c=0,h=0,d=0);var w=t.extractPoints(o),k=w.shape,x=w.holes;if(!Fl.isClockWise(k))for(k=k.reverse(),C=0,S=x.length;C<S;C++)T=x[C],Fl.isClockWise(T)&&(x[C]=T.reverse());var M=Fl.triangulateShape(k,x),O=k;for(C=0,S=x.length;C<S;C++)T=x[C],k=k.concat(T);function I(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}var _,L,P,R,F,D,N=k.length,B=M.length;function G(t,e,r){var i,n,a,o=t.x-e.x,s=t.y-e.y,l=r.x-t.x,u=r.y-t.y,c=o*o+s*s,h=o*u-s*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),p=Math.sqrt(l*l+u*u),f=e.x-s/d,m=e.y+o/d,g=((r.x-u/p-f)*u-(r.y+l/p-m)*l)/(o*u-s*l),b=(i=f+o*g-t.x)*i+(n=m+s*g-t.y)*n;if(b<=2)return new Hi(i,n);a=Math.sqrt(b/2)}else{var v=!1;o>Number.EPSILON?l>Number.EPSILON&&(v=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(v=!0):Math.sign(s)===Math.sign(u)&&(v=!0),v?(i=-s,n=o,a=Math.sqrt(c)):(i=o,n=s,a=Math.sqrt(c/2))}return new Hi(i/a,n/a)}for(var U=[],H=0,z=O.length,W=z-1,V=H+1;H<z;H++,W++,V++)W===z&&(W=0),V===z&&(V=0),U[H]=G(O[H],O[W],O[V]);var Y,j,X=[],q=U.concat();for(C=0,S=x.length;C<S;C++){for(T=x[C],Y=[],H=0,W=(z=T.length)-1,V=H+1;H<z;H++,W++,V++)W===z&&(W=0),V===z&&(V=0),Y[H]=G(T[H],T[W],T[V]);X.push(Y),q=q.concat(Y)}for(_=0;_<p;_++){for(P=_/p,R=c*Math.cos(P*Math.PI/2),L=h*Math.sin(P*Math.PI/2)+d,H=0,z=O.length;H<z;H++)K((F=I(O[H],U[H],L)).x,F.y,-R);for(C=0,S=x.length;C<S;C++)for(T=x[C],Y=X[C],H=0,z=T.length;H<z;H++)K((F=I(T[H],Y[H],L)).x,F.y,-R)}for(L=h+d,H=0;H<N;H++)F=u?I(k[H],q[H],L):k[H],E?(y.copy(b.normals[0]).multiplyScalar(F.x),v.copy(b.binormals[0]).multiplyScalar(F.y),A.copy(g[0]).add(y).add(v),K(A.x,A.y,A.z)):K(F.x,F.y,0);for(j=1;j<=s;j++)for(H=0;H<N;H++)F=u?I(k[H],q[H],L):k[H],E?(y.copy(b.normals[j]).multiplyScalar(F.x),v.copy(b.binormals[j]).multiplyScalar(F.y),A.copy(g[j]).add(y).add(v),K(A.x,A.y,A.z)):K(F.x,F.y,l/s*j);for(_=p-1;_>=0;_--){for(P=_/p,R=c*Math.cos(P*Math.PI/2),L=h*Math.sin(P*Math.PI/2)+d,H=0,z=O.length;H<z;H++)K((F=I(O[H],U[H],L)).x,F.y,l+R);for(C=0,S=x.length;C<S;C++)for(T=x[C],Y=X[C],H=0,z=T.length;H<z;H++)F=I(T[H],Y[H],L),E?K(F.x,F.y+g[s-1].y,g[s-1].x+R):K(F.x,F.y,l+R)}function Z(t,e){var r,i;for(H=t.length;--H>=0;){r=H,(i=H-1)<0&&(i=t.length-1);var n=0,a=s+2*p;for(n=0;n<a;n++){var o=N*n,l=N*(n+1);J(e+r+o,e+i+o,e+i+l,e+r+l)}}}function K(t,e,r){a.push(t),a.push(e),a.push(r)}function Q(t,e,n){$(t),$(e),$(n);var a=i.length/3,o=m.generateTopUV(r,i,a-3,a-2,a-1);tt(o[0]),tt(o[1]),tt(o[2])}function J(t,e,n,a){$(t),$(e),$(a),$(e),$(n),$(a);var o=i.length/3,s=m.generateSideWallUV(r,i,o-6,o-3,o-2,o-1);tt(s[0]),tt(s[1]),tt(s[3]),tt(s[1]),tt(s[2]),tt(s[3])}function $(t){i.push(a[3*t+0]),i.push(a[3*t+1]),i.push(a[3*t+2])}function tt(t){n.push(t.x),n.push(t.y)}!function(){var t=i.length/3;if(u){var e=0,n=N*e;for(H=0;H<B;H++)Q((D=M[H])[2]+n,D[1]+n,D[0]+n);for(n=N*(e=s+2*p),H=0;H<B;H++)Q((D=M[H])[0]+n,D[1]+n,D[2]+n)}else{for(H=0;H<B;H++)Q((D=M[H])[2],D[1],D[0]);for(H=0;H<B;H++)Q((D=M[H])[0]+N*s,D[1]+N*s,D[2]+N*s)}r.addGroup(t,i.length/3-t,0)}(),function(){var t=i.length/3,e=0;for(Z(O,e),e+=O.length,C=0,S=x.length;C<S;C++)Z(T=x[C],e),e+=T.length;r.addGroup(t,i.length/3-t,1)}()}this.addAttribute("position",new ta(i,3)),this.addAttribute("uv",new ta(n,2)),this.computeVertexNormals()}Bl.prototype=Object.create(Yn.prototype),Bl.prototype.constructor=Bl,Bl.prototype.toJSON=function(){var t=Yn.prototype.toJSON.call(this);return Hl(this.parameters.shapes,this.parameters.options,t)},Gl.prototype=Object.create(aa.prototype),Gl.prototype.constructor=Gl,Gl.prototype.toJSON=function(){var t=aa.prototype.toJSON.call(this);return Hl(this.parameters.shapes,this.parameters.options,t)};var Ul={generateTopUV:function(t,e,r,i,n){var a=e[3*r],o=e[3*r+1],s=e[3*i],l=e[3*i+1],u=e[3*n],c=e[3*n+1];return[new Hi(a,o),new Hi(s,l),new Hi(u,c)]},generateSideWallUV:function(t,e,r,i,n,a){var o=e[3*r],s=e[3*r+1],l=e[3*r+2],u=e[3*i],c=e[3*i+1],h=e[3*i+2],d=e[3*n],p=e[3*n+1],f=e[3*n+2],m=e[3*a],g=e[3*a+1],b=e[3*a+2];return Math.abs(s-c)<.01?[new Hi(o,1-l),new Hi(u,1-h),new Hi(d,1-f),new Hi(m,1-b)]:[new Hi(s,1-l),new Hi(c,1-h),new Hi(p,1-f),new Hi(g,1-b)]}};function Hl(t,e,r){if(r.shapes=[],Array.isArray(t))for(var i=0,n=t.length;i<n;i++){var a=t[i];r.shapes.push(a.uuid)}else r.shapes.push(t.uuid);return void 0!==e.extrudePath&&(r.options.extrudePath=e.extrudePath.toJSON()),r}function zl(t,e){Yn.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Wl(t,e)),this.mergeVertices()}function Wl(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Yn;var i=r.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),Gl.call(this,i,e),this.type="TextBufferGeometry"}function Vl(t,e,r,i,n,a,o){Yn.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Yl(t,e,r,i,n,a,o)),this.mergeVertices()}function Yl(t,e,r,i,n,a,o){aa.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var s,l,u=(a=void 0!==a?a:0)+(o=void 0!==o?o:Math.PI),c=0,h=[],d=new Wi,p=new Wi,f=[],m=[],g=[],b=[];for(l=0;l<=r;l++){var v=[],y=l/r,A=0==l?.5/e:l==r?-.5/e:0;for(s=0;s<=e;s++){var T=s/e;d.x=-t*Math.cos(i+T*n)*Math.sin(a+y*o),d.y=t*Math.cos(a+y*o),d.z=t*Math.sin(i+T*n)*Math.sin(a+y*o),m.push(d.x,d.y,d.z),p.copy(d).normalize(),g.push(p.x,p.y,p.z),b.push(T+A,1-y),v.push(c++)}h.push(v)}for(l=0;l<r;l++)for(s=0;s<e;s++){var C=h[l][s+1],S=h[l][s],E=h[l+1][s],w=h[l+1][s+1];(0!==l||a>0)&&f.push(C,S,w),(l!==r-1||u<Math.PI)&&f.push(S,E,w)}this.setIndex(f),this.addAttribute("position",new ta(m,3)),this.addAttribute("normal",new ta(g,3)),this.addAttribute("uv",new ta(b,2))}function jl(t,e,r,i,n,a){Yn.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},this.fromBufferGeometry(new Xl(t,e,r,i,n,a)),this.mergeVertices()}function Xl(t,e,r,i,n,a){aa.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},t=t||.5,e=e||1,n=void 0!==n?n:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var o,s,l,u=[],c=[],h=[],d=[],p=t,f=(e-t)/(i=void 0!==i?Math.max(1,i):1),m=new Wi,g=new Hi;for(s=0;s<=i;s++){for(l=0;l<=r;l++)o=n+l/r*a,m.x=p*Math.cos(o),m.y=p*Math.sin(o),c.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/e+1)/2,g.y=(m.y/e+1)/2,d.push(g.x,g.y);p+=f}for(s=0;s<i;s++){var b=s*(r+1);for(l=0;l<r;l++){var v=o=l+b,y=o+r+1,A=o+r+2,T=o+1;u.push(v,y,T),u.push(y,A,T)}}this.setIndex(u),this.addAttribute("position",new ta(c,3)),this.addAttribute("normal",new ta(h,3)),this.addAttribute("uv",new ta(d,2))}function ql(t,e,r,i){Yn.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:i},this.fromBufferGeometry(new Zl(t,e,r,i)),this.mergeVertices()}function Zl(t,e,r,i){aa.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:i},e=Math.floor(e)||12,r=r||0,i=i||2*Math.PI,i=Ui.clamp(i,0,2*Math.PI);var n,a,o,s=[],l=[],u=[],c=1/e,h=new Wi,d=new Hi;for(a=0;a<=e;a++){var p=r+a*c*i,f=Math.sin(p),m=Math.cos(p);for(o=0;o<=t.length-1;o++)h.x=t[o].x*f,h.y=t[o].y,h.z=t[o].x*m,l.push(h.x,h.y,h.z),d.x=a/e,d.y=o/(t.length-1),u.push(d.x,d.y)}for(a=0;a<e;a++)for(o=0;o<t.length-1;o++){var g=n=o+a*t.length,b=n+t.length,v=n+t.length+1,y=n+1;s.push(g,b,y),s.push(b,v,y)}if(this.setIndex(s),this.addAttribute("position",new ta(l,3)),this.addAttribute("uv",new ta(u,2)),this.computeVertexNormals(),i===2*Math.PI){var A=this.attributes.normal.array,T=new Wi,C=new Wi,S=new Wi;for(n=e*t.length*3,a=0,o=0;a<t.length;a++,o+=3)T.x=A[o+0],T.y=A[o+1],T.z=A[o+2],C.x=A[n+o+0],C.y=A[n+o+1],C.z=A[n+o+2],S.addVectors(T,C).normalize(),A[o+0]=A[n+o+0]=S.x,A[o+1]=A[n+o+1]=S.y,A[o+2]=A[n+o+2]=S.z}}function Kl(t,e){Yn.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Ql(t,e)),this.mergeVertices()}function Ql(t,e){aa.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],i=[],n=[],a=[],o=0,s=0;if(!1===Array.isArray(t))u(t);else for(var l=0;l<t.length;l++)u(t[l]),this.addGroup(o,s,l),o+=s,s=0;function u(t){var o,l,u,c=i.length/3,h=t.extractPoints(e),d=h.shape,p=h.holes;for(!1===Fl.isClockWise(d)&&(d=d.reverse()),o=0,l=p.length;o<l;o++)u=p[o],!0===Fl.isClockWise(u)&&(p[o]=u.reverse());var f=Fl.triangulateShape(d,p);for(o=0,l=p.length;o<l;o++)u=p[o],d=d.concat(u);for(o=0,l=d.length;o<l;o++){var m=d[o];i.push(m.x,m.y,0),n.push(0,0,1),a.push(m.x,m.y)}for(o=0,l=f.length;o<l;o++){var g=f[o],b=g[0]+c,v=g[1]+c,y=g[2]+c;r.push(b,v,y),s+=3}}this.setIndex(r),this.addAttribute("position",new ta(i,3)),this.addAttribute("normal",new ta(n,3)),this.addAttribute("uv",new ta(a,2))}function Jl(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,i=t.length;r<i;r++){var n=t[r];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}function $l(t,e){aa.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var r,i,n,a,o=[],s=Math.cos(Ui.DEG2RAD*e),l=[0,0],u={},c=["a","b","c"];t.isBufferGeometry?(a=new Yn).fromBufferGeometry(t):a=t.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,d=a.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],g=0;g<3;g++)r=m[c[g]],i=m[c[(g+1)%3]],l[0]=Math.min(r,i),l[1]=Math.max(r,i),void 0===u[n=l[0]+","+l[1]]?u[n]={index1:l[0],index2:l[1],face1:p,face2:void 0}:u[n].face2=p;for(n in u){var b=u[n];if(void 0===b.face2||d[b.face1].normal.dot(d[b.face2].normal)<=s){var v=h[b.index1];o.push(v.x,v.y,v.z),v=h[b.index2],o.push(v.x,v.y,v.z)}}this.addAttribute("position",new ta(o,3))}function tu(t,e,r,i,n,a,o,s){Yn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new eu(t,e,r,i,n,a,o,s)),this.mergeVertices()}function eu(t,e,r,i,n,a,o,s){aa.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s};var l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,i=Math.floor(i)||8,n=Math.floor(n)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var u=[],c=[],h=[],d=[],p=0,f=[],m=r/2,g=0;function b(r){var n,a,f,b=new Hi,v=new Wi,y=0,A=!0===r?t:e,T=!0===r?1:-1;for(a=p,n=1;n<=i;n++)c.push(0,m*T,0),h.push(0,T,0),d.push(.5,.5),p++;for(f=p,n=0;n<=i;n++){var C=n/i*s+o,S=Math.cos(C),E=Math.sin(C);v.x=A*E,v.y=m*T,v.z=A*S,c.push(v.x,v.y,v.z),h.push(0,T,0),b.x=.5*S+.5,b.y=.5*E*T+.5,d.push(b.x,b.y),p++}for(n=0;n<i;n++){var w=a+n,k=f+n;!0===r?u.push(k,k+1,w):u.push(k+1,k,w),y+=3}l.addGroup(g,y,!0===r?1:2),g+=y}!function(){var a,b,v=new Wi,y=new Wi,A=0,T=(e-t)/r;for(b=0;b<=n;b++){var C=[],S=b/n,E=S*(e-t)+t;for(a=0;a<=i;a++){var w=a/i,k=w*s+o,x=Math.sin(k),M=Math.cos(k);y.x=E*x,y.y=-S*r+m,y.z=E*M,c.push(y.x,y.y,y.z),v.set(x,T,M).normalize(),h.push(v.x,v.y,v.z),d.push(w,1-S),C.push(p++)}f.push(C)}for(a=0;a<i;a++)for(b=0;b<n;b++){var O=f[b][a],I=f[b+1][a],_=f[b+1][a+1],L=f[b][a+1];u.push(O,I,L),u.push(I,_,L),A+=6}l.addGroup(g,A,0),g+=A}(),!1===a&&(t>0&&b(!0),e>0&&b(!1)),this.setIndex(u),this.addAttribute("position",new ta(c,3)),this.addAttribute("normal",new ta(h,3)),this.addAttribute("uv",new ta(d,2))}function ru(t,e,r,i,n,a,o){tu.call(this,0,t,e,r,i,n,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:o}}function iu(t,e,r,i,n,a,o){eu.call(this,0,t,e,r,i,n,a,o),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:o}}function nu(t,e,r,i){Yn.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new au(t,e,r,i)),this.mergeVertices()}function au(t,e,r,i){aa.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:i},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var n,a,o=[],s=[],l=[],u=[],c=new Wi,h=new Hi;for(s.push(0,0,0),l.push(0,0,1),u.push(.5,.5),a=0,n=3;a<=e;a++,n+=3){var d=r+a/e*i;c.x=t*Math.cos(d),c.y=t*Math.sin(d),s.push(c.x,c.y,c.z),l.push(0,0,1),h.x=(s[n]/t+1)/2,h.y=(s[n+1]/t+1)/2,u.push(h.x,h.y)}for(n=1;n<=e;n++)o.push(n,n+1,0);this.setIndex(o),this.addAttribute("position",new ta(s,3)),this.addAttribute("normal",new ta(l,3)),this.addAttribute("uv",new ta(u,2))}zl.prototype=Object.create(Yn.prototype),zl.prototype.constructor=zl,Wl.prototype=Object.create(Gl.prototype),Wl.prototype.constructor=Wl,Vl.prototype=Object.create(Yn.prototype),Vl.prototype.constructor=Vl,Yl.prototype=Object.create(aa.prototype),Yl.prototype.constructor=Yl,jl.prototype=Object.create(Yn.prototype),jl.prototype.constructor=jl,Xl.prototype=Object.create(aa.prototype),Xl.prototype.constructor=Xl,ql.prototype=Object.create(Yn.prototype),ql.prototype.constructor=ql,Zl.prototype=Object.create(aa.prototype),Zl.prototype.constructor=Zl,Kl.prototype=Object.create(Yn.prototype),Kl.prototype.constructor=Kl,Kl.prototype.toJSON=function(){var t=Yn.prototype.toJSON.call(this);return Jl(this.parameters.shapes,t)},Ql.prototype=Object.create(aa.prototype),Ql.prototype.constructor=Ql,Ql.prototype.toJSON=function(){var t=aa.prototype.toJSON.call(this);return Jl(this.parameters.shapes,t)},$l.prototype=Object.create(aa.prototype),$l.prototype.constructor=$l,tu.prototype=Object.create(Yn.prototype),tu.prototype.constructor=tu,eu.prototype=Object.create(aa.prototype),eu.prototype.constructor=eu,ru.prototype=Object.create(tu.prototype),ru.prototype.constructor=ru,iu.prototype=Object.create(eu.prototype),iu.prototype.constructor=iu,nu.prototype=Object.create(Yn.prototype),nu.prototype.constructor=nu,au.prototype=Object.create(aa.prototype),au.prototype.constructor=au;var ou=Object.freeze({WireframeGeometry:qs,ParametricGeometry:Zs,ParametricBufferGeometry:Ks,TetrahedronGeometry:$s,TetrahedronBufferGeometry:tl,OctahedronGeometry:el,OctahedronBufferGeometry:rl,IcosahedronGeometry:il,IcosahedronBufferGeometry:nl,DodecahedronGeometry:al,DodecahedronBufferGeometry:ol,PolyhedronGeometry:Qs,PolyhedronBufferGeometry:Js,TubeGeometry:sl,TubeBufferGeometry:ll,TorusKnotGeometry:ul,TorusKnotBufferGeometry:cl,TorusGeometry:hl,TorusBufferGeometry:dl,TextGeometry:zl,TextBufferGeometry:Wl,SphereGeometry:Vl,SphereBufferGeometry:Yl,RingGeometry:jl,RingBufferGeometry:Xl,PlaneGeometry:la,PlaneBufferGeometry:ua,LatheGeometry:ql,LatheBufferGeometry:Zl,ShapeGeometry:Kl,ShapeBufferGeometry:Ql,ExtrudeGeometry:Bl,ExtrudeBufferGeometry:Gl,EdgesGeometry:$l,ConeGeometry:ru,ConeBufferGeometry:iu,CylinderGeometry:tu,CylinderBufferGeometry:eu,CircleGeometry:nu,CircleBufferGeometry:au,BoxGeometry:oa,BoxBufferGeometry:sa});function su(t){ha.call(this),this.type="ShadowMaterial",this.color=new xn(0),this.transparent=!0,this.setValues(t)}function lu(t){ka.call(this,t),this.type="RawShaderMaterial"}function uu(t){ha.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new xn(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Bi,this.normalScale=new Hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function cu(t){uu.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function hu(t){ha.call(this),this.type="MeshPhongMaterial",this.color=new xn(16777215),this.specular=new xn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Bi,this.normalScale=new Hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=tr,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function du(t){hu.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function pu(t){ha.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Bi,this.normalScale=new Hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function fu(t){ha.call(this),this.type="MeshLambertMaterial",this.color=new xn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=tr,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function mu(t){ha.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new xn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Bi,this.normalScale=new Hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(t)}function gu(t){Bs.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}su.prototype=Object.create(ha.prototype),su.prototype.constructor=su,su.prototype.isShadowMaterial=!0,su.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.color.copy(t.color),this},lu.prototype=Object.create(ka.prototype),lu.prototype.constructor=lu,lu.prototype.isRawShaderMaterial=!0,uu.prototype=Object.create(ha.prototype),uu.prototype.constructor=uu,uu.prototype.isMeshStandardMaterial=!0,uu.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},cu.prototype=Object.create(uu.prototype),cu.prototype.constructor=cu,cu.prototype.isMeshPhysicalMaterial=!0,cu.prototype.copy=function(t){return uu.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},hu.prototype=Object.create(ha.prototype),hu.prototype.constructor=hu,hu.prototype.isMeshPhongMaterial=!0,hu.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},du.prototype=Object.create(hu.prototype),du.prototype.constructor=du,du.prototype.isMeshToonMaterial=!0,du.prototype.copy=function(t){return hu.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},pu.prototype=Object.create(ha.prototype),pu.prototype.constructor=pu,pu.prototype.isMeshNormalMaterial=!0,pu.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},fu.prototype=Object.create(ha.prototype),fu.prototype.constructor=fu,fu.prototype.isMeshLambertMaterial=!0,fu.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},mu.prototype=Object.create(ha.prototype),mu.prototype.constructor=mu,mu.prototype.isMeshMatcapMaterial=!0,mu.prototype.copy=function(t){return ha.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},gu.prototype=Object.create(Bs.prototype),gu.prototype.constructor=gu,gu.prototype.isLineDashedMaterial=!0,gu.prototype.copy=function(t){return Bs.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var bu=Object.freeze({ShadowMaterial:su,SpriteMaterial:Ls,RawShaderMaterial:lu,ShaderMaterial:ka,PointsMaterial:zs,MeshPhysicalMaterial:cu,MeshStandardMaterial:uu,MeshPhongMaterial:hu,MeshToonMaterial:du,MeshNormalMaterial:pu,MeshLambertMaterial:fu,MeshDepthMaterial:as,MeshDistanceMaterial:os,MeshBasicMaterial:Oa,MeshMatcapMaterial:mu,LineDashedMaterial:gu,LineBasicMaterial:Bs,Material:ha}),vu={arraySlice:function(t,e,r){return vu.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),i=0;i!==e;++i)r[i]=i;return r.sort(function(e,r){return t[e]-t[r]}),r},sortedArray:function(t,e,r){for(var i=t.length,n=new t.constructor(i),a=0,o=0;o!==i;++a)for(var s=r[a]*e,l=0;l!==e;++l)n[o++]=t[s+l];return n},flattenJSON:function(t,e,r,i){for(var n=1,a=t[0];void 0!==a&&void 0===a[i];)a=t[n++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(e.push(a.time),r.push.apply(r,o)),a=t[n++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(e.push(a.time),o.toArray(r,r.length)),a=t[n++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(e.push(a.time),r.push(o)),a=t[n++]}while(void 0!==a)}}};function yu(t,e,r,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function Au(t,e,r,i){yu.call(this,t,e,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Tu(t,e,r,i){yu.call(this,t,e,r,i)}function Cu(t,e,r,i){yu.call(this,t,e,r,i)}function Su(t,e,r,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=vu.convertArray(e,this.TimeBufferType),this.values=vu.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function Eu(t,e,r){Su.call(this,t,e,r)}function wu(t,e,r,i){Su.call(this,t,e,r,i)}function ku(t,e,r,i){Su.call(this,t,e,r,i)}function xu(t,e,r,i){yu.call(this,t,e,r,i)}function Mu(t,e,r,i){Su.call(this,t,e,r,i)}function Ou(t,e,r,i){Su.call(this,t,e,r,i)}function Iu(t,e,r,i){Su.call(this,t,e,r,i)}function _u(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=Ui.generateUUID(),this.duration<0&&this.resetDuration()}function Lu(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ku;case"vector":case"vector2":case"vector3":case"vector4":return Iu;case"color":return wu;case"quaternion":return Mu;case"bool":case"boolean":return Eu;case"string":return Ou}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var r=[],i=[];vu.flattenJSON(t.keys,r,i,"value"),t.times=r,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(yu.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,i=e[r],n=e[r-1];t:{e:{var a;r:{i:if(!(t<i)){for(var o=r+2;;){if(void 0===i){if(t<n)break i;return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,t,n)}if(r===o)break;if(n=i,t<(i=e[++r]))break e}a=e.length;break r}if(t>=n)break t;var s=e[1];t<s&&(r=2,n=s);for(o=r-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(r===o)break;if(i=n,t>=(n=e[--r-1]))break e}a=r,r=0}for(;r<a;){var l=r+a>>>1;t<e[l]?a=l:r=l+1}if(i=e[r],void 0===(n=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,n,t)}this._cachedIndex=r,this.intervalChanged_(r,n,i)}return this.interpolate_(r,n,t,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=t*i,a=0;a!==i;++a)e[a]=r[n+a];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(yu.prototype,{beforeStart_:yu.prototype.copySampleValue_,afterEnd_:yu.prototype.copySampleValue_}),Au.prototype=Object.assign(Object.create(yu.prototype),{constructor:Au,DefaultSettings_:{endingStart:Ci,endingEnd:Ci},intervalChanged_:function(t,e,r){var i=this.parameterPositions,n=t-2,a=t+1,o=i[n],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case Si:n=t,o=2*e-r;break;case Ei:o=e+i[n=i.length-2]-i[n+1];break;default:n=t,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case Si:a=t,s=2*r-e;break;case Ei:a=1,s=r+i[1]-i[0];break;default:a=t-1,s=e}var l=.5*(r-e),u=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(s-r),this._offsetPrev=n*u,this._offsetNext=a*u},interpolate_:function(t,e,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(r-e)/(i-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,b=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f,A=0;A!==o;++A)n[A]=g*a[u+A]+b*a[l+A]+v*a[s+A]+y*a[c+A];return n}}),Tu.prototype=Object.assign(Object.create(yu.prototype),{constructor:Tu,interpolate_:function(t,e,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,u=(r-e)/(i-e),c=1-u,h=0;h!==o;++h)n[h]=a[l+h]*c+a[s+h]*u;return n}}),Cu.prototype=Object.assign(Object.create(yu.prototype),{constructor:Cu,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(Su,{toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:vu.convertArray(t.times,Array),values:vu.convertArray(t.values,Array)};var i=t.getInterpolation();i!==t.DefaultInterpolation&&(e.interpolation=i)}return e.type=t.ValueTypeName,e}}),Object.assign(Su.prototype,{constructor:Su,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Ai,InterpolantFactoryMethodDiscrete:function(t){return new Cu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Tu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Au(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case yi:e=this.InterpolantFactoryMethodDiscrete;break;case Ai:e=this.InterpolantFactoryMethodLinear;break;case Ti:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return yi;case this.InterpolantFactoryMethodLinear:return Ai;case this.InterpolantFactoryMethodSmooth:return Ti}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,i=e.length;r!==i;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,i=e.length;r!==i;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,i=r.length,n=0,a=i-1;n!==i&&r[n]<t;)++n;for(;-1!==a&&r[a]>e;)--a;if(++a,0!==n||a!==i){n>=a&&(n=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=vu.arraySlice(r,n,a),this.values=vu.arraySlice(this.values,n*o,a*o)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,i=this.values,n=r.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var a=null,o=0;o!==n;o++){var s=r[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),t=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),t=!1;break}a=s}if(void 0!==i&&vu.isTypedArray(i)){o=0;for(var l=i.length;o!==l;++o){var u=i[o];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,u),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,r=this.getValueSize(),i=this.getInterpolation()===Ti,n=1,a=t.length-1,o=1;o<a;++o){var s=!1,l=t[o];if(l!==t[o+1]&&(1!==o||l!==l[0]))if(i)s=!0;else for(var u=o*r,c=u-r,h=u+r,d=0;d!==r;++d){var p=e[u+d];if(p!==e[c+d]||p!==e[h+d]){s=!0;break}}if(s){if(o!==n){t[n]=t[o];var f=o*r,m=n*r;for(d=0;d!==r;++d)e[m+d]=e[f+d]}++n}}if(a>0){t[n]=t[a];for(f=a*r,m=n*r,d=0;d!==r;++d)e[m+d]=e[f+d];++n}return n!==t.length&&(this.times=vu.arraySlice(t,0,n),this.values=vu.arraySlice(e,0,n*r)),this},clone:function(){var t=vu.arraySlice(this.times,0),e=vu.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}),Eu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Eu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:yi,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),wu.prototype=Object.assign(Object.create(Su.prototype),{constructor:wu,ValueTypeName:"color"}),ku.prototype=Object.assign(Object.create(Su.prototype),{constructor:ku,ValueTypeName:"number"}),xu.prototype=Object.assign(Object.create(yu.prototype),{constructor:xu,interpolate_:function(t,e,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=(r-e)/(i-e),u=s+o;s!==u;s+=4)zi.slerpFlat(n,0,a,s-o,a,s,l);return n}}),Mu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Mu,ValueTypeName:"quaternion",DefaultInterpolation:Ai,InterpolantFactoryMethodLinear:function(t){return new xu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Ou.prototype=Object.assign(Object.create(Su.prototype),{constructor:Ou,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:yi,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Iu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Iu,ValueTypeName:"vector"}),Object.assign(_u,{parse:function(t){for(var e=[],r=t.tracks,i=1/(t.fps||1),n=0,a=r.length;n!==a;++n)e.push(Lu(r[n]).scale(i));return new _u(t.name,t.duration,e)},toJSON:function(t){for(var e=[],r=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid},n=0,a=r.length;n!==a;++n)e.push(Su.toJSON(r[n]));return i},CreateFromMorphTargetSequence:function(t,e,r,i){for(var n=e.length,a=[],o=0;o<n;o++){var s=[],l=[];s.push((o+n-1)%n,o,(o+1)%n),l.push(0,1,0);var u=vu.getKeyframeOrder(s);s=vu.sortedArray(s,1,u),l=vu.sortedArray(l,1,u),i||0!==s[0]||(s.push(n),l.push(l[0])),a.push(new ku(".morphTargetInfluences["+e[o].name+"]",s,l).scale(1/r))}return new _u(t,-1,a)},findByName:function(t,e){var r=t;if(!Array.isArray(t)){var i=t;r=i.geometry&&i.geometry.animations||i.animations}for(var n=0;n<r.length;n++)if(r[n].name===e)return r[n];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var i={},n=/^([\w-]*?)([\d]+)$/,a=0,o=t.length;a<o;a++){var s=t[a],l=s.name.match(n);if(l&&l.length>1){var u=i[h=l[1]];u||(i[h]=u=[]),u.push(s)}}var c=[];for(var h in i)c.push(_u.CreateFromMorphTargetSequence(h,i[h],e,r));return c},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,i,n){if(0!==r.length){var a=[],o=[];vu.flattenJSON(r,a,o,i),0!==a.length&&n.push(new t(e,a,o))}},i=[],n=t.name||"default",a=t.length||-1,o=t.fps||30,s=t.hierarchy||[],l=0;l<s.length;l++){var u=s[l].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var c={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var d=0;d<u[h].morphTargets.length;d++)c[u[h].morphTargets[d]]=-1;for(var p in c){var f=[],m=[];for(d=0;d!==u[h].morphTargets.length;++d){var g=u[h];f.push(g.time),m.push(g.morphTarget===p?1:0)}i.push(new ku(".morphTargetInfluence["+p+"]",f,m))}a=c.length*(o||1)}else{var b=".bones["+e[l].name+"]";r(Iu,b+".position",u,"pos",i),r(Mu,b+".quaternion",u,"rot",i),r(Iu,b+".scale",u,"scl",i)}}return 0===i.length?null:new _u(n,a,i)}}),Object.assign(_u.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new _u(this.name,this.duration,t)}});var Pu={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Ru(t,e,r){var i=this,n=!1,a=0,o=0,s=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){o++,!1===n&&void 0!==i.onStart&&i.onStart(t,a,o),n=!0},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,o),a===o&&(n=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this}}var Fu=new Ru,Du={};function Nu(t){this.manager=void 0!==t?t:Fu}function Bu(t){this.manager=void 0!==t?t:Fu}function Gu(t){this.manager=void 0!==t?t:Fu,this._parser=null}function Uu(t){this.manager=void 0!==t?t:Fu,this._parser=null}function Hu(t){this.manager=void 0!==t?t:Fu}function zu(t){this.manager=void 0!==t?t:Fu}function Wu(t){this.manager=void 0!==t?t:Fu}function Vu(){this.type="Curve",this.arcLengthDivisions=200}function Yu(t,e,r,i,n,a,o,s){Vu.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=i||1,this.aStartAngle=n||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function ju(t,e,r,i,n,a){Yu.call(this,t,e,r,r,i,n,a),this.type="ArcCurve"}function Xu(){var t=0,e=0,r=0,i=0;function n(n,a,o,s){t=n,e=o,r=-3*n+3*a-2*o-s,i=2*n-2*a+o+s}return{initCatmullRom:function(t,e,r,i,a){n(e,r,a*(r-t),a*(i-e))},initNonuniformCatmullRom:function(t,e,r,i,a,o,s){var l=(e-t)/a-(r-t)/(a+o)+(r-e)/o,u=(r-e)/o-(i-e)/(o+s)+(i-r)/s;n(e,r,l*=o,u*=o)},calc:function(n){var a=n*n;return t+e*n+r*a+i*(a*n)}}}Object.assign(Nu.prototype,{load:function(t,e,r,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=Pu.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;if(void 0===Du[t]){var o=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],l=!!o[2],u=o[3];u=decodeURIComponent(u),l&&(u=atob(u));try{var c,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),p=0;p<u.length;p++)d[p]=u.charCodeAt(p);c="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;c=f.parseFromString(u,s);break;case"json":c=JSON.parse(u);break;default:c=u}setTimeout(function(){e&&e(c),n.manager.itemEnd(t)},0)}catch(e){setTimeout(function(){i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)},0)}}else{Du[t]=[],Du[t].push({onLoad:e,onProgress:r,onError:i});var m=new XMLHttpRequest;for(var g in m.open("GET",t,!0),m.addEventListener("load",function(e){var r=this.response;Pu.add(t,r);var i=Du[t];if(delete Du[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var a=0,o=i.length;a<o;a++){(s=i[a]).onLoad&&s.onLoad(r)}n.manager.itemEnd(t)}else{for(a=0,o=i.length;a<o;a++){var s;(s=i[a]).onError&&s.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)}},!1),m.addEventListener("progress",function(e){for(var r=Du[t],i=0,n=r.length;i<n;i++){var a=r[i];a.onProgress&&a.onProgress(e)}},!1),m.addEventListener("error",function(e){var r=Du[t];delete Du[t];for(var i=0,a=r.length;i<a;i++){var o=r[i];o.onError&&o.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)},!1),m.addEventListener("abort",function(e){var r=Du[t];delete Du[t];for(var i=0,a=r.length;i<a;i++){var o=r[i];o.onError&&o.onError(e)}n.manager.itemError(t),n.manager.itemEnd(t)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return n.manager.itemStart(t),m}Du[t].push({onLoad:e,onProgress:r,onError:i})},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(Bu.prototype,{load:function(t,e,r,i){var n=this,a=new Nu(n.manager);a.setPath(n.path),a.load(t,function(t){e(n.parse(JSON.parse(t)))},r,i)},parse:function(t){for(var e=[],r=0;r<t.length;r++){var i=_u.parse(t[r]);e.push(i)}return e},setPath:function(t){return this.path=t,this}}),Object.assign(Gu.prototype,{load:function(t,e,r,i){var n=this,a=[],o=new Ys;o.image=a;var s=new Nu(this.manager);function l(l){s.load(t[l],function(t){var r=n._parser(t,!0);a[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(u+=1)&&(1===r.mipmapCount&&(o.minFilter=Sr),o.format=r.format,o.needsUpdate=!0,e&&e(o))},r,i)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var u=0,c=0,h=t.length;c<h;++c)l(c);else s.load(t,function(t){var r=n._parser(t,!0);if(r.isCubemap)for(var i=r.mipmaps.length/r.mipmapCount,s=0;s<i;s++){a[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)a[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),a[s].format=r.format,a[s].width=r.width,a[s].height=r.height}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=Sr),o.format=r.format,o.needsUpdate=!0,e&&e(o)},r,i);return o},setPath:function(t){return this.path=t,this}}),Object.assign(Uu.prototype,{load:function(t,e,r,i){var n=this,a=new pn,o=new Nu(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(t,function(t){var r=n._parser(t);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:vr,a.wrapT=void 0!==r.wrapT?r.wrapT:vr,a.magFilter=void 0!==r.magFilter?r.magFilter:Sr,a.minFilter=void 0!==r.minFilter?r.minFilter:wr,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps),1===r.mipmapCount&&(a.minFilter=Sr),a.needsUpdate=!0,e&&e(a,r))},r,i),a},setPath:function(t){return this.path=t,this}}),Object.assign(Hu.prototype,{crossOrigin:"anonymous",load:function(t,e,r,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=Pu.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),Pu.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(e){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(t),o.src=t,o},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(zu.prototype,{crossOrigin:"anonymous",load:function(t,e,r,i){var n=new za,a=new Hu(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(r){a.load(t[r],function(t){n.images[r]=t,6===++o&&(n.needsUpdate=!0,e&&e(n))},void 0,i)}for(var l=0;l<t.length;++l)s(l);return n},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Wu.prototype,{crossOrigin:"anonymous",load:function(t,e,r,i){var n=new ln,a=new Hu(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(r){n.image=r;var i=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);n.format=i?Gr:Ur,n.needsUpdate=!0,void 0!==e&&e(n)},r,i),n},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Vu.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var r=this.getUtoTmapping(t);return this.getPoint(r,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,i=[],n=this.getPoint(0),a=0;for(i.push(0),r=1;r<=t;r++)a+=(e=this.getPoint(r/t)).distanceTo(n),i.push(a),n=e;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r,i=this.getLengths(),n=0,a=i.length;r=e||t*i[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=i[n=Math.floor(s+(l-s)/2)]-r)<0)s=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(i[n=l]===r)return n/(a-1);var u=i[n];return(n+(r-u)/(i[n+1]-u))/(a-1)},getTangent:function(t){var e=t-1e-4,r=t+1e-4;e<0&&(e=0),r>1&&(r=1);var i=this.getPoint(e);return this.getPoint(r).clone().sub(i).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var r,i,n,a=new Wi,o=[],s=[],l=[],u=new Wi,c=new vn;for(r=0;r<=t;r++)i=r/t,o[r]=this.getTangentAt(i),o[r].normalize();s[0]=new Wi,l[0]=new Wi;var h=Number.MAX_VALUE,d=Math.abs(o[0].x),p=Math.abs(o[0].y),f=Math.abs(o[0].z);for(d<=h&&(h=d,a.set(1,0,0)),p<=h&&(h=p,a.set(0,1,0)),f<=h&&a.set(0,0,1),u.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],u),l[0].crossVectors(o[0],s[0]),r=1;r<=t;r++)s[r]=s[r-1].clone(),l[r]=l[r-1].clone(),u.crossVectors(o[r-1],o[r]),u.length()>Number.EPSILON&&(u.normalize(),n=Math.acos(Ui.clamp(o[r-1].dot(o[r]),-1,1)),s[r].applyMatrix4(c.makeRotationAxis(u,n))),l[r].crossVectors(o[r],s[r]);if(!0===e)for(n=Math.acos(Ui.clamp(s[0].dot(s[t]),-1,1)),n/=t,o[0].dot(u.crossVectors(s[0],s[t]))>0&&(n=-n),r=1;r<=t;r++)s[r].applyMatrix4(c.makeRotationAxis(o[r],n*r)),l[r].crossVectors(o[r],s[r]);return{tangents:o,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Yu.prototype=Object.create(Vu.prototype),Yu.prototype.constructor=Yu,Yu.prototype.isEllipseCurve=!0,Yu.prototype.getPoint=function(t,e){for(var r=e||new Hi,i=2*Math.PI,n=this.aEndAngle-this.aStartAngle,a=Math.abs(n)<Number.EPSILON;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(n=a?0:i),!0!==this.aClockwise||a||(n===i?n=-i:n-=i);var o=this.aStartAngle+t*n,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*u-d*c+this.aX,l=h*c+d*u+this.aY}return r.set(s,l)},Yu.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Yu.prototype.toJSON=function(){var t=Vu.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Yu.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ju.prototype=Object.create(Yu.prototype),ju.prototype.constructor=ju,ju.prototype.isArcCurve=!0;var qu=new Wi,Zu=new Xu,Ku=new Xu,Qu=new Xu;function Ju(t,e,r,i){Vu.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=i||.5}function $u(t,e,r,i,n){var a=.5*(i-e),o=.5*(n-r),s=t*t;return(2*r-2*i+a+o)*(t*s)+(-3*r+3*i-2*a-o)*s+a*t+r}function tc(t,e,r,i){return function(t,e){var r=1-t;return r*r*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,r)+function(t,e){return t*t*e}(t,i)}function ec(t,e,r,i,n){return function(t,e){var r=1-t;return r*r*r*e}(t,e)+function(t,e){var r=1-t;return 3*r*r*t*e}(t,r)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,n)}function rc(t,e,r,i){Vu.call(this),this.type="CubicBezierCurve",this.v0=t||new Hi,this.v1=e||new Hi,this.v2=r||new Hi,this.v3=i||new Hi}function ic(t,e,r,i){Vu.call(this),this.type="CubicBezierCurve3",this.v0=t||new Wi,this.v1=e||new Wi,this.v2=r||new Wi,this.v3=i||new Wi}function nc(t,e){Vu.call(this),this.type="LineCurve",this.v1=t||new Hi,this.v2=e||new Hi}function ac(t,e){Vu.call(this),this.type="LineCurve3",this.v1=t||new Wi,this.v2=e||new Wi}function oc(t,e,r){Vu.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Hi,this.v1=e||new Hi,this.v2=r||new Hi}function sc(t,e,r){Vu.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Wi,this.v1=e||new Wi,this.v2=r||new Wi}function lc(t){Vu.call(this),this.type="SplineCurve",this.points=t||[]}Ju.prototype=Object.create(Vu.prototype),Ju.prototype.constructor=Ju,Ju.prototype.isCatmullRomCurve3=!0,Ju.prototype.getPoint=function(t,e){var r,i,n,a,o=e||new Wi,s=this.points,l=s.length,u=(l-(this.closed?0:1))*t,c=Math.floor(u),h=u-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/l)+1)*l:0===h&&c===l-1&&(c=l-2,h=1),this.closed||c>0?r=s[(c-1)%l]:(qu.subVectors(s[0],s[1]).add(s[0]),r=qu),i=s[c%l],n=s[(c+1)%l],this.closed||c+2<l?a=s[(c+2)%l]:(qu.subVectors(s[l-1],s[l-2]).add(s[l-1]),a=qu),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(r.distanceToSquared(i),d),f=Math.pow(i.distanceToSquared(n),d),m=Math.pow(n.distanceToSquared(a),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),Zu.initNonuniformCatmullRom(r.x,i.x,n.x,a.x,p,f,m),Ku.initNonuniformCatmullRom(r.y,i.y,n.y,a.y,p,f,m),Qu.initNonuniformCatmullRom(r.z,i.z,n.z,a.z,p,f,m)}else"catmullrom"===this.curveType&&(Zu.initCatmullRom(r.x,i.x,n.x,a.x,this.tension),Ku.initCatmullRom(r.y,i.y,n.y,a.y,this.tension),Qu.initCatmullRom(r.z,i.z,n.z,a.z,this.tension));return o.set(Zu.calc(h),Ku.calc(h),Qu.calc(h)),o},Ju.prototype.copy=function(t){Vu.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Ju.prototype.toJSON=function(){var t=Vu.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++){var i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Ju.prototype.fromJSON=function(t){Vu.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var i=t.points[e];this.points.push((new Wi).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},rc.prototype=Object.create(Vu.prototype),rc.prototype.constructor=rc,rc.prototype.isCubicBezierCurve=!0,rc.prototype.getPoint=function(t,e){var r=e||new Hi,i=this.v0,n=this.v1,a=this.v2,o=this.v3;return r.set(ec(t,i.x,n.x,a.x,o.x),ec(t,i.y,n.y,a.y,o.y)),r},rc.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},rc.prototype.toJSON=function(){var t=Vu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},rc.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},ic.prototype=Object.create(Vu.prototype),ic.prototype.constructor=ic,ic.prototype.isCubicBezierCurve3=!0,ic.prototype.getPoint=function(t,e){var r=e||new Wi,i=this.v0,n=this.v1,a=this.v2,o=this.v3;return r.set(ec(t,i.x,n.x,a.x,o.x),ec(t,i.y,n.y,a.y,o.y),ec(t,i.z,n.z,a.z,o.z)),r},ic.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},ic.prototype.toJSON=function(){var t=Vu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},ic.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},nc.prototype=Object.create(Vu.prototype),nc.prototype.constructor=nc,nc.prototype.isLineCurve=!0,nc.prototype.getPoint=function(t,e){var r=e||new Hi;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},nc.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},nc.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},nc.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},nc.prototype.toJSON=function(){var t=Vu.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},nc.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},ac.prototype=Object.create(Vu.prototype),ac.prototype.constructor=ac,ac.prototype.isLineCurve3=!0,ac.prototype.getPoint=function(t,e){var r=e||new Wi;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},ac.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},ac.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ac.prototype.toJSON=function(){var t=Vu.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ac.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},oc.prototype=Object.create(Vu.prototype),oc.prototype.constructor=oc,oc.prototype.isQuadraticBezierCurve=!0,oc.prototype.getPoint=function(t,e){var r=e||new Hi,i=this.v0,n=this.v1,a=this.v2;return r.set(tc(t,i.x,n.x,a.x),tc(t,i.y,n.y,a.y)),r},oc.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},oc.prototype.toJSON=function(){var t=Vu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},oc.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},sc.prototype=Object.create(Vu.prototype),sc.prototype.constructor=sc,sc.prototype.isQuadraticBezierCurve3=!0,sc.prototype.getPoint=function(t,e){var r=e||new Wi,i=this.v0,n=this.v1,a=this.v2;return r.set(tc(t,i.x,n.x,a.x),tc(t,i.y,n.y,a.y),tc(t,i.z,n.z,a.z)),r},sc.prototype.copy=function(t){return Vu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},sc.prototype.toJSON=function(){var t=Vu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},sc.prototype.fromJSON=function(t){return Vu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},lc.prototype=Object.create(Vu.prototype),lc.prototype.constructor=lc,lc.prototype.isSplineCurve=!0,lc.prototype.getPoint=function(t,e){var r=e||new Hi,i=this.points,n=(i.length-1)*t,a=Math.floor(n),o=n-a,s=i[0===a?a:a-1],l=i[a],u=i[a>i.length-2?i.length-1:a+1],c=i[a>i.length-3?i.length-1:a+2];return r.set($u(o,s.x,l.x,u.x,c.x),$u(o,s.y,l.y,u.y,c.y)),r},lc.prototype.copy=function(t){Vu.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var i=t.points[e];this.points.push(i.clone())}return this},lc.prototype.toJSON=function(){var t=Vu.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++){var i=this.points[e];t.points.push(i.toArray())}return t},lc.prototype.fromJSON=function(t){Vu.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var i=t.points[e];this.points.push((new Hi).fromArray(i))}return this};var uc=Object.freeze({ArcCurve:ju,CatmullRomCurve3:Ju,CubicBezierCurve:rc,CubicBezierCurve3:ic,EllipseCurve:Yu,LineCurve:nc,LineCurve3:ac,QuadraticBezierCurve:oc,QuadraticBezierCurve3:sc,SplineCurve:lc});function cc(){Vu.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function hc(t){cc.call(this),this.type="Path",this.currentPoint=new Hi,t&&this.setFromPoints(t)}function dc(t){hc.call(this,t),this.uuid=Ui.generateUUID(),this.type="Shape",this.holes=[]}function pc(t,e){Hn.call(this),this.type="Light",this.color=new xn(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function fc(t,e,r){pc.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Hn.DefaultUp),this.updateMatrix(),this.groundColor=new xn(e)}function mc(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Hi(512,512),this.map=null,this.matrix=new vn}function gc(){mc.call(this,new ps(50,1,.5,500))}function bc(t,e,r,i,n,a){pc.call(this,t,e),this.type="SpotLight",this.position.copy(Hn.DefaultUp),this.updateMatrix(),this.target=new Hn,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==a?a:1,this.shadow=new gc}function vc(t,e,r,i){pc.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1,this.shadow=new mc(new ps(90,1,.5,500))}function yc(t,e,r,i,n,a){ds.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==r?r:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==n?n:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function Ac(){mc.call(this,new yc(-5,5,5,-5,.5,500))}function Tc(t,e){pc.call(this,t,e),this.type="DirectionalLight",this.position.copy(Hn.DefaultUp),this.updateMatrix(),this.target=new Hn,this.shadow=new Ac}function Cc(t,e){pc.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Sc(t,e,r,i){pc.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==i?i:10}function Ec(t){this.manager=void 0!==t?t:Fu,this.textures={}}cc.prototype=Object.assign(Object.create(Vu.prototype),{constructor:cc,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new nc(e,t))},getPoint:function(t){for(var e=t*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=e){var n=r[i]-e,a=this.curves[i],o=a.getLength(),s=0===o?0:1-n/o;return a.getPointAt(s)}i++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,i=this.curves.length;r<i;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],i=0,n=this.curves;i<n.length;i++)for(var a=n[i],o=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),l=0;l<s.length;l++){var u=s[l];e&&e.equals(u)||(r.push(u),e=u)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){Vu.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=Vu.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++){var i=this.curves[e];t.curves.push(i.toJSON())}return t},fromJSON:function(t){Vu.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var i=t.curves[e];this.curves.push((new uc[i.type]).fromJSON(i))}return this}}),hc.prototype=Object.assign(Object.create(cc.prototype),{constructor:hc,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var r=new nc(this.currentPoint.clone(),new Hi(t,e));this.curves.push(r),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,r,i){var n=new oc(this.currentPoint.clone(),new Hi(t,e),new Hi(r,i));this.curves.push(n),this.currentPoint.set(r,i)},bezierCurveTo:function(t,e,r,i,n,a){var o=new rc(this.currentPoint.clone(),new Hi(t,e),new Hi(r,i),new Hi(n,a));this.curves.push(o),this.currentPoint.set(n,a)},splineThru:function(t){var e=new lc([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,r,i,n,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(t+o,e+s,r,i,n,a)},absarc:function(t,e,r,i,n,a){this.absellipse(t,e,r,r,i,n,a)},ellipse:function(t,e,r,i,n,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;this.absellipse(t+l,e+u,r,i,n,a,o,s)},absellipse:function(t,e,r,i,n,a,o,s){var l=new Yu(t,e,r,i,n,a,o,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);this.currentPoint.copy(c)},copy:function(t){return cc.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=cc.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return cc.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),dc.prototype=Object.assign(Object.create(hc.prototype),{constructor:dc,getPointsHoles:function(t){for(var e=[],r=0,i=this.holes.length;r<i;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){hc.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var i=t.holes[e];this.holes.push(i.clone())}return this},toJSON:function(){var t=hc.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++){var i=this.holes[e];t.holes.push(i.toJSON())}return t},fromJSON:function(t){hc.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var i=t.holes[e];this.holes.push((new hc).fromJSON(i))}return this}}),pc.prototype=Object.assign(Object.create(Hn.prototype),{constructor:pc,isLight:!0,copy:function(t){return Hn.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=Hn.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),fc.prototype=Object.assign(Object.create(pc.prototype),{constructor:fc,isHemisphereLight:!0,copy:function(t){return pc.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(mc.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),gc.prototype=Object.assign(Object.create(mc.prototype),{constructor:gc,isSpotLightShadow:!0,update:function(t){var e=this.camera,r=2*Ui.RAD2DEG*t.angle,i=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;r===e.fov&&i===e.aspect&&n===e.far||(e.fov=r,e.aspect=i,e.far=n,e.updateProjectionMatrix())}}),bc.prototype=Object.assign(Object.create(pc.prototype),{constructor:bc,isSpotLight:!0,copy:function(t){return pc.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),vc.prototype=Object.assign(Object.create(pc.prototype),{constructor:vc,isPointLight:!0,copy:function(t){return pc.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),yc.prototype=Object.assign(Object.create(ds.prototype),{constructor:yc,isOrthographicCamera:!0,copy:function(t,e){return ds.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,i,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=r-t,a=r+t,o=i+e,s=i-e;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;a=(n+=c*(this.view.offsetX/l))+c*(this.view.width/l),s=(o-=h*(this.view.offsetY/u))-h*(this.view.height/u)}this.projectionMatrix.makeOrthographic(n,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=Hn.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Ac.prototype=Object.assign(Object.create(mc.prototype),{constructor:Ac}),Tc.prototype=Object.assign(Object.create(pc.prototype),{constructor:Tc,isDirectionalLight:!0,copy:function(t){return pc.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Cc.prototype=Object.assign(Object.create(pc.prototype),{constructor:Cc,isAmbientLight:!0}),Sc.prototype=Object.assign(Object.create(pc.prototype),{constructor:Sc,isRectAreaLight:!0,copy:function(t){return pc.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=pc.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign(Ec.prototype,{load:function(t,e,r,i){var n=this,a=new Nu(n.manager);a.setPath(n.path),a.load(t,function(t){e(n.parse(JSON.parse(t)))},r,i)},parse:function(t){var e=this.textures;function r(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var i=new bu[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearCoat&&(i.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(i.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.vertexColors&&(i.vertexColors=t.vertexColors),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.uniforms)for(var n in t.uniforms){var a=t.uniforms[n];switch(i.uniforms[n]={},a.type){case"t":i.uniforms[n].value=r(a.value);break;case"c":i.uniforms[n].value=(new xn).setHex(a.value);break;case"v2":i.uniforms[n].value=(new Hi).fromArray(a.value);break;case"v3":i.uniforms[n].value=(new Wi).fromArray(a.value);break;case"v4":i.uniforms[n].value=(new un).fromArray(a.value);break;case"m3":i.uniforms[n].value=(new Vi).fromArray(a.value);case"m4":i.uniforms[n].value=(new vn).fromArray(a.value);break;default:i.uniforms[n].value=a.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var o in t.extensions)i.extensions[o]=t.extensions[o];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=r(t.map)),void 0!==t.matcap&&(i.matcap=r(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=r(t.alphaMap),i.transparent=!0),void 0!==t.bumpMap&&(i.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=r(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){var s=t.normalScale;!1===Array.isArray(s)&&(s=[s,s]),i.normalScale=(new Hi).fromArray(s)}return void 0!==t.displacementMap&&(i.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=r(t.specularMap)),void 0!==t.envMap&&(i.envMap=r(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.lightMap&&(i.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=r(t.gradientMap)),i},setPath:function(t){return this.path=t,this},setTextures:function(t){return this.textures=t,this}});var wc={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",r=0,i=t.length;r<i;r++)e+=String.fromCharCode(t[r]);return decodeURIComponent(escape(e))},extractUrlBase:function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function kc(t){this.manager=void 0!==t?t:Fu}Object.assign(kc.prototype,{load:function(t,e,r,i){var n=this,a=new Nu(n.manager);a.setPath(n.path),a.load(t,function(t){e(n.parse(JSON.parse(t)))},r,i)},parse:function(t){var e=new aa,r=t.data.index;if(void 0!==r){var i=new xc[r.type](r.array);e.setIndex(new jn(i,1))}var n=t.data.attributes;for(var a in n){var o=n[a],s=new jn(i=new xc[o.type](o.array),o.itemSize,o.normalized);void 0!==o.name&&(s.name=o.name),e.addAttribute(a,s)}var l=t.data.morphAttributes;if(l)for(var a in l){for(var u=l[a],c=[],h=0,d=u.length;h<d;h++){o=u[h],s=new jn(i=new xc[o.type](o.array),o.itemSize,o.normalized);void 0!==o.name&&(s.name=o.name),c.push(s)}e.morphAttributes[a]=c}var p=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==p){h=0;for(var f=p.length;h!==f;++h){var m=p[h];e.addGroup(m.start,m.count,m.materialIndex)}}var g=t.data.boundingSphere;if(void 0!==g){var b=new Wi;void 0!==g.center&&b.fromArray(g.center),e.boundingSphere=new mn(b,g.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e},setPath:function(t){return this.path=t,this}});var xc={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Mc(t){this.manager=void 0!==t?t:Fu,this.resourcePath=""}Object.assign(Mc.prototype,{crossOrigin:"anonymous",load:function(t,e,r,i){var n=this,a=void 0===this.path?wc.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;var o=new Nu(n.manager);o.setPath(this.path),o.load(t,function(r){var a=null;try{a=JSON.parse(r)}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?n.parse(a,e):console.error("THREE.ObjectLoader: Can't load "+t)},r,i)},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setCrossOrigin:function(t){return this.crossOrigin=t,this},parse:function(t,e){var r=this.parseShape(t.shapes),i=this.parseGeometries(t.geometries,r),n=this.parseImages(t.images,function(){void 0!==e&&e(s)}),a=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,a),s=this.parseObject(t.object,i,o);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){var e={};if(void 0!==t)for(var r=0,i=t.length;r<i;r++){var n=(new dc).fromJSON(t[r]);e[n.uuid]=n}return e},parseGeometries:function(t,e){var r={};if(void 0!==t)for(var i=new kc,n=0,a=t.length;n<a;n++){var o,s=t[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new ou[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new ou[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new ou[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new ou[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new ou[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new ou[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new ou[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new ou[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new ou[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new ou[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new ou[s.type]((new uc[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new ou[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new ou[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],u=0,c=s.shapes.length;u<c;u++){var h=e[s.shapes[u]];l.push(h)}o=new ou[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],u=0,c=s.shapes.length;u<c;u++){h=e[s.shapes[u]];l.push(h)}var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new uc[d.type]).fromJSON(d)),o=new ou[s.type](l,s.options);break;case"BufferGeometry":o=i.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)o=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),r[s.uuid]=o}return r},parseMaterials:function(t,e){var r={},i={};if(void 0!==t){var n=new Ec;n.setTextures(e);for(var a=0,o=t.length;a<o;a++){var s=t[a];if("MultiMaterial"===s.type){for(var l=[],u=0;u<s.materials.length;u++){var c=s.materials[u];void 0===r[c.uuid]&&(r[c.uuid]=n.parse(c)),l.push(r[c.uuid])}i[s.uuid]=l}else void 0===r[s.uuid]&&(r[s.uuid]=n.parse(s)),i[s.uuid]=r[s.uuid]}}return i},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r],n=_u.parse(i);void 0!==i.uuid&&(n.uuid=i.uuid),e.push(n)}return e},parseImages:function(t,e){var r=this,i={};function n(t){return r.manager.itemStart(t),a.load(t,function(){r.manager.itemEnd(t)},void 0,function(){r.manager.itemError(t),r.manager.itemEnd(t)})}if(void 0!==t&&t.length>0){var a=new Hu(new Ru(e));a.setCrossOrigin(this.crossOrigin);for(var o=0,s=t.length;o<s;o++){var l=t[o],u=l.url;if(Array.isArray(u)){i[l.uuid]=[];for(var c=0,h=u.length;c<h;c++){var d=u[c],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:r.resourcePath+d;i[l.uuid].push(n(p))}}else{p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.resourcePath+l.url;i[l.uuid]=n(p)}}}return i},parseTextures:function(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var i={};if(void 0!==t)for(var n=0,a=t.length;n<a;n++){var o,s=t[n];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(e[s.image])?new za(e[s.image]):new ln(e[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=r(s.mapping,Rc)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=r(s.wrap[0],Fc),o.wrapT=r(s.wrap[1],Fc)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=r(s.minFilter,Dc)),void 0!==s.magFilter&&(o.magFilter=r(s.magFilter,Dc)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),i[s.uuid]=o}return i},parseObject:function(t,e,r){var i;function n(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function a(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],i=0,n=t.length;i<n;i++){var a=t[i];void 0===r[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),e.push(r[a])}return e}return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),r[t]}}switch(t.type){case"Scene":i=new Os,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new xn(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new Ms(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new xs(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new ps(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new yc(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new Cc(t.color,t.intensity);break;case"DirectionalLight":i=new Tc(t.color,t.intensity);break;case"PointLight":i=new vc(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new Sc(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new bc(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new fc(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=n(t.geometry),s=a(t.material);i=o.bones&&o.bones.length>0?new Fs(o,s):new Ia(o,s),void 0!==t.drawMode&&i.setDrawMode(t.drawMode);break;case"LOD":i=new Rs;break;case"Line":i=new Gs(n(t.geometry),a(t.material),t.mode);break;case"LineLoop":i=new Hs(n(t.geometry),a(t.material));break;case"LineSegments":i=new Us(n(t.geometry),a(t.material));break;case"PointCloud":case"Points":i=new Ws(n(t.geometry),a(t.material));break;case"Sprite":i=new Ps(a(t.material));break;case"Group":i=new hs;break;default:i=new Hn}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children)for(var l=t.children,u=0;u<l.length;u++)i.add(this.parseObject(l[u],e,r));if("LOD"===t.type)for(var c=t.levels,h=0;h<c.length;h++){var d=c[h],p=i.getObjectByProperty("uuid",d.object);void 0!==p&&i.addLevel(p,d.distance)}return i}});var Oc,Ic,_c,Lc,Pc,Rc={UVMapping:ur,CubeReflectionMapping:cr,CubeRefractionMapping:hr,EquirectangularReflectionMapping:dr,EquirectangularRefractionMapping:pr,SphericalReflectionMapping:fr,CubeUVReflectionMapping:mr,CubeUVRefractionMapping:gr},Fc={RepeatWrapping:br,ClampToEdgeWrapping:vr,MirroredRepeatWrapping:yr},Dc={NearestFilter:Ar,NearestMipMapNearestFilter:Tr,NearestMipMapLinearFilter:Cr,LinearFilter:Sr,LinearMipMapNearestFilter:Er,LinearMipMapLinearFilter:wr};function Nc(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==t?t:Fu,this.options=void 0}function Bc(){this.type="ShapePath",this.color=new xn,this.subPaths=[],this.currentPath=null}function Gc(t){this.type="Font",this.data=t}function Uc(t,e,r,i,n){var a=n.glyphs[t]||n.glyphs["?"];if(a){var o,s,l,u,c,h,d,p,f=new Bc;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,b=m.length;g<b;){switch(m[g++]){case"m":o=m[g++]*e+r,s=m[g++]*e+i,f.moveTo(o,s);break;case"l":o=m[g++]*e+r,s=m[g++]*e+i,f.lineTo(o,s);break;case"q":l=m[g++]*e+r,u=m[g++]*e+i,c=m[g++]*e+r,h=m[g++]*e+i,f.quadraticCurveTo(c,h,l,u);break;case"b":l=m[g++]*e+r,u=m[g++]*e+i,c=m[g++]*e+r,h=m[g++]*e+i,d=m[g++]*e+r,p=m[g++]*e+i,f.bezierCurveTo(c,h,d,p,l,u)}}return{offsetX:a.ha*e,path:f}}}function Hc(t){this.manager=void 0!==t?t:Fu}function zc(){}Nc.prototype={constructor:Nc,setOptions:function(t){return this.options=t,this},load:function(t,e,r,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=Pu.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;fetch(t).then(function(t){return t.blob()}).then(function(t){return void 0===n.options?createImageBitmap(t):createImageBitmap(t,n.options)}).then(function(r){Pu.add(t,r),e&&e(r),n.manager.itemEnd(t)}).catch(function(e){i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}),n.manager.itemStart(t)},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}},Object.assign(Bc.prototype,{moveTo:function(t,e){this.currentPath=new hc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,r,i){this.currentPath.quadraticCurveTo(t,e,r,i)},bezierCurveTo:function(t,e,r,i,n,a){this.currentPath.bezierCurveTo(t,e,r,i,n,a)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function r(t){for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r],a=new dc;a.curves=n.curves,e.push(a)}return e}function i(t,e){for(var r=e.length,i=!1,n=r-1,a=0;a<r;n=a++){var o=e[n],s=e[a],l=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=e[a],l=-l,s=e[n],u=-u),t.y<o.y||t.y>s.y)continue;if(t.y===o.y){if(t.x===o.x)return!0}else{var c=u*(t.x-o.x)-l*(t.y-o.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(t.y!==o.y)continue;if(s.x<=t.x&&t.x<=o.x||o.x<=t.x&&t.x<=s.x)return!0}}return i}var n=Fl.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===e)return r(a);var o,s,l,u=[];if(1===a.length)return s=a[0],(l=new dc).curves=s.curves,u.push(l),u;var c=!n(a[0].getPoints());c=t?!c:c;var h,d,p=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var b=0,v=a.length;b<v;b++)o=n(h=(s=a[b]).getPoints()),(o=t?!o:o)?(!c&&f[g]&&g++,f[g]={s:new dc,p:h},f[g].s.curves=s.curves,c&&g++,m[g]=[]):m[g].push({h:s,p:h[0]});if(!f[0])return r(a);if(f.length>1){for(var y=!1,A=[],T=0,C=f.length;T<C;T++)p[T]=[];for(T=0,C=f.length;T<C;T++)for(var S=m[T],E=0;E<S.length;E++){for(var w=S[E],k=!0,x=0;x<f.length;x++)i(w.p,f[x].p)&&(T!==x&&A.push({froms:T,tos:x,hole:E}),k?(k=!1,p[x].push(w)):y=!0);k&&p[T].push(w)}A.length>0&&(y||(m=p))}b=0;for(var M=f.length;b<M;b++){l=f[b].s,u.push(l);for(var O=0,I=(d=m[b]).length;O<I;O++)l.holes.push(d[O].h)}return u}}),Object.assign(Gc.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);for(var r=[],i=function(t,e,r){for(var i=Array.from?Array.from(t):String(t).split(""),n=e/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*n,o=[],s=0,l=0,u=0;u<i.length;u++){var c=i[u];if("\n"===c)s=0,l-=a;else{var h=Uc(c,n,s,l,r);s+=h.offsetX,o.push(h.path)}}return o}(t,e,this.data),n=0,a=i.length;n<a;n++)Array.prototype.push.apply(r,i[n].toShapes());return r}}),Object.assign(Hc.prototype,{load:function(t,e,r,i){var n=this,a=new Nu(this.manager);a.setPath(this.path),a.load(t,function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var i=n.parse(r);e&&e(i)},r,i)},parse:function(t){return new Gc(t)},setPath:function(t){return this.path=t,this}}),zc.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,r=0,i=e.length;r<i;r+=2){var n=e[r],a=e[r+1];if(n.test(t))return a}return null}},Object.assign(zc.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,r){for(var i=[],n=0;n<t.length;++n)i[n]=this.createMaterial(t[n],e,r);return i},createMaterial:(Oc={NoBlending:Ee,NormalBlending:we,AdditiveBlending:ke,SubtractiveBlending:xe,MultiplyBlending:Me,CustomBlending:Oe},Ic=new xn,_c=new Wu,Lc=new Ec,function(t,e,r){var i={};function n(t,n,a,o,s){var l,u=e+t,c=zc.Handlers.get(u);null!==c?l=c.load(u):(_c.setCrossOrigin(r),l=_c.load(u)),void 0!==n&&(l.repeat.fromArray(n),1!==n[0]&&(l.wrapS=br),1!==n[1]&&(l.wrapT=br)),void 0!==a&&l.offset.fromArray(a),void 0!==o&&("repeat"===o[0]&&(l.wrapS=br),"mirror"===o[0]&&(l.wrapS=yr),"repeat"===o[1]&&(l.wrapT=br),"mirror"===o[1]&&(l.wrapT=yr)),void 0!==s&&(l.anisotropy=s);var h=Ui.generateUUID();return i[h]=l,h}var a={uuid:Ui.generateUUID(),type:"MeshLambertMaterial"};for(var o in t){var s=t[o];switch(o){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":a.name=s;break;case"blending":a.blending=Oc[s];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",o,"is no longer supported.");break;case"colorDiffuse":a.color=Ic.fromArray(s).getHex();break;case"colorSpecular":a.specular=Ic.fromArray(s).getHex();break;case"colorEmissive":a.emissive=Ic.fromArray(s).getHex();break;case"specularCoef":a.shininess=s;break;case"shading":"basic"===s.toLowerCase()&&(a.type="MeshBasicMaterial"),"phong"===s.toLowerCase()&&(a.type="MeshPhongMaterial"),"standard"===s.toLowerCase()&&(a.type="MeshStandardMaterial");break;case"mapDiffuse":a.map=n(s,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":a.emissiveMap=n(s,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":a.lightMap=n(s,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":a.aoMap=n(s,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":a.bumpMap=n(s,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":a.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":a.normalMap=n(s,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":a.normalScale=s;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":a.specularMap=n(s,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":a.metalnessMap=n(s,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":a.roughnessMap=n(s,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":a.alphaMap=n(s,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":a.side=be;break;case"doubleSided":a.side=ve;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),a.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":a[o]=s;break;case"vertexColors":!0===s&&(a.vertexColors=Se),"face"===s&&(a.vertexColors=Ce);break;default:console.error("THREE.Loader.createMaterial: Unsupported",o,s)}}return"MeshBasicMaterial"===a.type&&delete a.emissive,"MeshPhongMaterial"!==a.type&&delete a.specular,a.opacity<1&&(a.transparent=!0),Lc.setTextures(i),Lc.parse(a)})});var Wc={getContext:function(){return void 0===Pc&&(Pc=new(window.AudioContext||window.webkitAudioContext)),Pc},setContext:function(t){Pc=t}};function Vc(t){this.manager=void 0!==t?t:Fu}function Yc(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Wi)}function jc(t,e){pc.call(this,void 0,e),this.sh=void 0!==t?t:new Yc}function Xc(t,e,r){jc.call(this,void 0,r);var i=(new xn).set(t),n=(new xn).set(e),a=new Wi(i.r,i.g,i.b),o=new Wi(n.r,n.g,n.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}function qc(t,e){jc.call(this,void 0,e);var r=(new xn).set(t);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}function Zc(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ps,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ps,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}Object.assign(Vc.prototype,{load:function(t,e,r,i){var n=new Nu(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.load(t,function(t){var r=t.slice(0);Wc.getContext().decodeAudioData(r,function(t){e(t)})},r,i)},setPath:function(t){return this.path=t,this}}),Object.assign(Yc.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var r=t.x,i=t.y,n=t.z,a=this.coefficients;return e=.282095*a[0],e+=.488603*a[1]*i,e+=.488603*a[2]*n,e+=.488603*a[3]*r,e+=1.092548*a[4]*(r*i),e+=1.092548*a[5]*(i*n),e+=.315392*a[6]*(3*n*n-1),e+=1.092548*a[7]*(r*n),e+=.546274*a[8]*(r*r-i*i)},getIrradianceAt:function(t,e){var r=t.x,i=t.y,n=t.z,a=this.coefficients;return e=.886227*a[0],e+=2*a[1]*.511664*i,e+=2*a[2]*.511664*n,e+=2*a[3]*.511664*r,e+=2*a[4]*.429043*r*i,e+=2*a[5]*.429043*i*n,e+=a[6]*(.743125*n*n-.247708),e+=2*a[7]*.429043*r*n,e+=.429043*a[8]*(r*r-i*i)},add:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},scale:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],e);return this},equals:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t){for(var e=this.coefficients,r=0;r<9;r++)e[r].fromArray(t,3*r);return this},toArray:function(){for(var t=[],e=this.coefficients,r=0;r<9;r++)e[r].toArray(t,3*r);return t}}),Object.assign(Yc,{getBasisAt:function(t,e){var r=t.x,i=t.y,n=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*n,e[3]=.488603*r,e[4]=1.092548*r*i,e[5]=1.092548*i*n,e[6]=.315392*(3*n*n-1),e[7]=1.092548*r*n,e[8]=.546274*(r*r-i*i)}}),jc.prototype=Object.assign(Object.create(pc.prototype),{constructor:jc,isLightProbe:!0,copy:function(t){return pc.prototype.copy.call(this,t),this.sh.copy(t.sh),this.intensity=t.intensity,this},toJSON:function(t){return pc.prototype.toJSON.call(this,t)}}),Xc.prototype=Object.assign(Object.create(jc.prototype),{constructor:Xc,isHemisphereLightProbe:!0,copy:function(t){return jc.prototype.copy.call(this,t),this},toJSON:function(t){return jc.prototype.toJSON.call(this,t)}}),qc.prototype=Object.assign(Object.create(jc.prototype),{constructor:qc,isAmbientLightProbe:!0,copy:function(t){return jc.prototype.copy.call(this,t),this},toJSON:function(t){return jc.prototype.toJSON.call(this,t)}}),Object.assign(Zc.prototype,{update:function(){var t,e,r,i,n,a,o,s,l=new vn,u=new vn;return function(c){if(t!==this||e!==c.focus||r!==c.fov||i!==c.aspect*this.aspect||n!==c.near||a!==c.far||o!==c.zoom||s!==this.eyeSep){t=this,e=c.focus,r=c.fov,i=c.aspect*this.aspect,n=c.near,a=c.far,o=c.zoom;var h,d,p=c.projectionMatrix.clone(),f=(s=this.eyeSep/2)*n/e,m=n*Math.tan(Ui.DEG2RAD*r*.5)/o;u.elements[12]=-s,l.elements[12]=s,h=-m*i+f,d=m*i+f,p.elements[0]=2*n/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraL.projectionMatrix.copy(p),h=-m*i-f,d=m*i-f,p.elements[0]=2*n/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(u),this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(l)}}()});var Kc=90,Qc=1;function Jc(t,e,r,i){Hn.call(this),this.type="CubeCamera";var n=new ps(Kc,Qc,t,e);n.up.set(0,-1,0),n.lookAt(new Wi(1,0,0)),this.add(n);var a=new ps(Kc,Qc,t,e);a.up.set(0,-1,0),a.lookAt(new Wi(-1,0,0)),this.add(a);var o=new ps(Kc,Qc,t,e);o.up.set(0,0,1),o.lookAt(new Wi(0,1,0)),this.add(o);var s=new ps(Kc,Qc,t,e);s.up.set(0,0,-1),s.lookAt(new Wi(0,-1,0)),this.add(s);var l=new ps(Kc,Qc,t,e);l.up.set(0,-1,0),l.lookAt(new Wi(0,0,1)),this.add(l);var u=new ps(Kc,Qc,t,e);u.up.set(0,-1,0),u.lookAt(new Wi(0,0,-1)),this.add(u),i=i||{format:Gr,magFilter:Sr,minFilter:Sr},this.renderTarget=new dn(r,r,i),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var r=t.getRenderTarget(),i=this.renderTarget,c=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,a),t.setRenderTarget(i,2),t.render(e,o),t.setRenderTarget(i,3),t.render(e,s),t.setRenderTarget(i,4),t.render(e,l),i.texture.generateMipmaps=c,t.setRenderTarget(i,5),t.render(e,u),t.setRenderTarget(r)},this.clear=function(t,e,r,i){for(var n=t.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)t.setRenderTarget(a,o),t.clear(e,r,i);t.setRenderTarget(n)}}function $c(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function th(){Hn.call(this),this.type="AudioListener",this.context=Wc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function eh(t){Hn.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function rh(t){eh.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function ih(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function nh(t,e,r){this.binding=t,this.valueSize=r;var i,n=Float64Array;switch(e){case"quaternion":i=this._slerp;break;case"string":case"bool":n=Array,i=this._select;break;default:i=this._lerp}this.buffer=new n(4*r),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Jc.prototype=Object.create(Hn.prototype),Jc.prototype.constructor=Jc,Object.assign($c.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),th.prototype=Object.assign(Object.create(Hn.prototype),{constructor:th,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(){var t=new Wi,e=new zi,r=new Wi,i=new Wi,n=new $c;return function(a){Hn.prototype.updateMatrixWorld.call(this,a);var o=this.context.listener,s=this.up;if(this.timeDelta=n.getDelta(),this.matrixWorld.decompose(t,e,r),i.set(0,0,-1).applyQuaternion(e),o.positionX){var l=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(t.x,l),o.positionY.linearRampToValueAtTime(t.y,l),o.positionZ.linearRampToValueAtTime(t.z,l),o.forwardX.linearRampToValueAtTime(i.x,l),o.forwardY.linearRampToValueAtTime(i.y,l),o.forwardZ.linearRampToValueAtTime(i.z,l),o.upX.linearRampToValueAtTime(s.x,l),o.upY.linearRampToValueAtTime(s.y,l),o.upZ.linearRampToValueAtTime(s.z,l)}else o.setPosition(t.x,t.y,t.z),o.setOrientation(i.x,i.y,i.z,s.x,s.y,s.z)}}()}),eh.prototype=Object.assign(Object.create(Hn.prototype),{constructor:eh,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}),rh.prototype=Object.assign(Object.create(eh.prototype),{constructor:rh,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(){var t=new Wi,e=new zi,r=new Wi,i=new Wi;return function(n){if(Hn.prototype.updateMatrixWorld.call(this,n),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(t,e,r),i.set(0,0,1).applyQuaternion(e);var a=this.panner;if(a.positionX){var o=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(t.x,o),a.positionY.linearRampToValueAtTime(t.y,o),a.positionZ.linearRampToValueAtTime(t.z,o),a.orientationX.linearRampToValueAtTime(i.x,o),a.orientationY.linearRampToValueAtTime(i.y,o),a.orientationZ.linearRampToValueAtTime(i.z,o)}else a.setPosition(t.x,t.y,t.z),a.setOrientation(i.x,i.y,i.z)}}}()}),Object.assign(ih.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Object.assign(nh.prototype,{accumulate:function(t,e){var r=this.buffer,i=this.valueSize,n=t*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)r[n+o]=r[o];a=e}else{var s=e/(a+=e);this._mixBufferRegion(r,n,0,s,i)}this.cumulativeWeight=a},apply:function(t){var e=this.valueSize,r=this.buffer,i=t*e+e,n=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,n<1){var o=3*e;this._mixBufferRegion(r,i,o,1-n,e)}for(var s=e,l=e+e;s!==l;++s)if(r[s]!==r[s+e]){a.setValue(r,i);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,r=this.valueSize,i=3*r;t.getValue(e,i);for(var n=r,a=i;n!==a;++n)e[n]=e[i+n%r];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,r,i,n){if(i>=.5)for(var a=0;a!==n;++a)t[e+a]=t[r+a]},_slerp:function(t,e,r,i){zi.slerpFlat(t,e,t,e,t,r,i)},_lerp:function(t,e,r,i,n){for(var a=1-i,o=0;o!==n;++o){var s=e+o;t[s]=t[s]*a+t[r+o]*i}}});var ah,oh,sh,lh,uh,ch,hh,dh,ph,fh,mh,gh,bh,vh,yh;function Ah(t,e,r){var i=r||Th.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}function Th(t,e,r){this.path=e,this.parsedPath=r||Th.parseTrackName(e),this.node=Th.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function Ch(){this.uuid=Ui.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}function Sh(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null;for(var i=e.tracks,n=i.length,a=new Array(n),o={endingStart:Ci,endingEnd:Ci},s=0;s!==n;++s){var l=i[s].createInterpolant(null);a[s]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=bi,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Eh(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function wh(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function kh(){aa.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function xh(t,e,r){Is.call(this,t,e),this.meshPerAttribute=r||1}function Mh(t,e,r,i){"number"==typeof r&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),jn.call(this,t,e,r),this.meshPerAttribute=i||1}function Oh(t,e,r,i){this.ray=new xa(t,e),this.near=r||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Ih(t,e){return t.distance-e.distance}function _h(t,e,r,i){if(!1!==t.visible&&(t.raycast(e,r),!0===i))for(var n=t.children,a=0,o=n.length;a<o;a++)_h(n[a],e,r,!0)}function Lh(t,e,r){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==r?r:0,this}function Ph(t,e,r){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==r?r:0,this}function Rh(t,e){this.min=void 0!==t?t:new Hi(1/0,1/0),this.max=void 0!==e?e:new Hi(-1/0,-1/0)}function Fh(t,e){this.start=void 0!==t?t:new Wi,this.end=void 0!==e?e:new Wi}function Dh(t){Hn.call(this),this.material=t,this.render=function(){}}function Nh(t,e,r,i){this.object=t,this.size=void 0!==e?e:1;var n=void 0!==r?r:16711680,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=3*s.faces.length:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);var l=new aa,u=new ta(2*o*3,3);l.addAttribute("position",u),Us.call(this,l,new Bs({color:n,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function Bh(t,e){Hn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var r=new aa,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,a=1;n<32;n++,a++){var o=n/32*Math.PI*2,s=a/32*Math.PI*2;i.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new ta(i,3));var l=new Bs({fog:!1});this.cone=new Us(r,l),this.add(this.cone),this.update()}function Gh(t){for(var e=function t(e){var r=[];e&&e.isBone&&r.push(e);for(var i=0;i<e.children.length;i++)r.push.apply(r,t(e.children[i]));return r}(t),r=new aa,i=[],n=[],a=new xn(0,0,1),o=new xn(0,1,0),s=0;s<e.length;s++){var l=e[s];l.parent&&l.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(a.r,a.g,a.b),n.push(o.r,o.g,o.b))}r.addAttribute("position",new ta(i,3)),r.addAttribute("color",new ta(n,3));var u=new Bs({vertexColors:Se,depthTest:!1,depthWrite:!1,transparent:!0});Us.call(this,r,u),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Uh(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r;var i=new Yl(e,4,2),n=new Oa({wireframe:!0,fog:!1});Ia.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Hh(t,e){this.type="RectAreaLightHelper",this.light=t,this.color=e;var r=new aa;r.addAttribute("position",new ta([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere();var i=new Bs({fog:!1});Gs.call(this,r,i);var n=new aa;n.addAttribute("position",new ta([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new Ia(n,new Oa({side:be,fog:!1}))),this.update()}function zh(t,e,r){Hn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var i=new rl(e);i.rotateY(.5*Math.PI),this.material=new Oa({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=Se);var n=i.getAttribute("position"),a=new Float32Array(3*n.count);i.addAttribute("color",new jn(a,3)),this.add(new Ia(i,this.material)),this.update()}function Wh(t,e){this.lightProbe=t,this.size=e;var r={GAMMA_OUTPUT:""},i=new ka({defines:r,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),n=new Yl(1,32,16);Ia.call(this,n,i),this.onBeforeRender()}function Vh(t,e,r,i){t=t||10,e=e||10,r=new xn(void 0!==r?r:4473924),i=new xn(void 0!==i?i:8947848);for(var n=e/2,a=t/e,o=t/2,s=[],l=[],u=0,c=0,h=-o;u<=e;u++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var d=u===n?r:i;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}var p=new aa;p.addAttribute("position",new ta(s,3)),p.addAttribute("color",new ta(l,3));var f=new Bs({vertexColors:Se});Us.call(this,p,f)}function Yh(t,e,r,i,n,a){t=t||10,e=e||16,r=r||8,i=i||64,n=new xn(void 0!==n?n:4473924),a=new xn(void 0!==a?a:8947848);var o,s,l,u,c,h,d,p=[],f=[];for(u=0;u<=e;u++)l=u/e*(2*Math.PI),o=Math.sin(l)*t,s=Math.cos(l)*t,p.push(0,0,0),p.push(o,0,s),d=1&u?n:a,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(u=0;u<=r;u++)for(d=1&u?n:a,h=t-t/r*u,c=0;c<i;c++)l=c/i*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,p.push(o,0,s),f.push(d.r,d.g,d.b),l=(c+1)/i*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,p.push(o,0,s),f.push(d.r,d.g,d.b);var m=new aa;m.addAttribute("position",new ta(p,3)),m.addAttribute("color",new ta(f,3));var g=new Bs({vertexColors:Se});Us.call(this,m,g)}function jh(t,e,r,i){this.audio=t,this.range=e||1,this.divisionsInnerAngle=r||16,this.divisionsOuterAngle=i||2;var n=new aa,a=this.divisionsInnerAngle+2*this.divisionsOuterAngle,o=new Float32Array(3*(3*a+3));n.addAttribute("position",new jn(o,3));var s=new Bs({color:65280}),l=new Bs({color:16776960});Gs.call(this,n,[l,s]),this.update()}function Xh(t,e,r,i){this.object=t,this.size=void 0!==e?e:1;var n=void 0!==r?r:16776960,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new aa,u=new ta(2*o*3,3);l.addAttribute("position",u),Us.call(this,l,new Bs({color:n,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function qh(t,e,r){Hn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1);var i=new aa;i.addAttribute("position",new ta([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var n=new Bs({fog:!1});this.lightPlane=new Gs(i,n),this.add(this.lightPlane),(i=new aa).addAttribute("position",new ta([0,0,0,0,0,1],3)),this.targetLine=new Gs(i,n),this.add(this.targetLine),this.update()}function Zh(t){var e=new aa,r=new Bs({color:16777215,vertexColors:Ce}),i=[],n=[],a={},o=new xn(16755200),s=new xn(16711680),l=new xn(43775),u=new xn(16777215),c=new xn(3355443);function h(t,e,r){d(t,r),d(e,r)}function d(t,e){i.push(0,0,0),n.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(i.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",u),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),e.addAttribute("position",new ta(i,3)),e.addAttribute("color",new ta(n,3)),Us.call(this,e,r),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function Kh(t,e){this.object=t,void 0===e&&(e=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),n=new aa;n.setIndex(new jn(r,1)),n.addAttribute("position",new jn(i,3)),Us.call(this,n,new Bs({color:e})),this.matrixAutoUpdate=!1,this.update()}function Qh(t,e){this.type="Box3Helper",this.box=t;var r=void 0!==e?e:16776960,i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new aa;n.setIndex(new jn(i,1)),n.addAttribute("position",new ta([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Us.call(this,n,new Bs({color:r})),this.geometry.computeBoundingSphere()}function Jh(t,e,r){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var i=void 0!==r?r:16776960,n=new aa;n.addAttribute("position",new ta([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),Gs.call(this,n,new Bs({color:i}));var a=new aa;a.addAttribute("position",new ta([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new Ia(a,new Oa({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}function $h(t,e,r,i,n,a){Hn.call(this),void 0===t&&(t=new Wi(0,0,1)),void 0===e&&(e=new Wi(0,0,0)),void 0===r&&(r=1),void 0===i&&(i=16776960),void 0===n&&(n=.2*r),void 0===a&&(a=.2*n),void 0===gh&&((gh=new aa).addAttribute("position",new ta([0,0,0,0,1,0],3)),(bh=new eu(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Gs(gh,new Bs({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ia(bh,new Oa({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,n,a)}function td(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new aa;r.addAttribute("position",new ta(e,3)),r.addAttribute("color",new ta([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new Bs({vertexColors:Se});Us.call(this,r,i)}function ed(t,e,r,i,n,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Pn(t,e,r,n,a,o)}Object.assign(Ah.prototype,{getValue:function(t,e){this.bind();var r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(Th,{Composite:Ah,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new Th.Composite(t,e,r):new Th(t,e,r)},sanitizeNodeName:(ph=new RegExp("[\\[\\]\\.:\\/]","g"),function(t){return t.replace(/\s/g,"_").replace(ph,"")}),parseTrackName:(ah="[^\\[\\]\\.:\\/]",oh="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",sh=/((?:WC+[\/:])*)/.source.replace("WC",ah),lh=/(WCOD+)?/.source.replace("WCOD",oh),uh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ah),ch=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ah),hh=new RegExp("^"+sh+lh+uh+ch+"$"),dh=["material","materials","bones"],function(t){var e=hh.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var n=r.nodeName.substring(i+1);-1!==dh.indexOf(n)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=n)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var i=function(t){for(var r=0;r<t.length;r++){var n=t[r];if(n.name===e||n.uuid===e)return n;var a=i(n.children);if(a)return a}return null},n=i(t.children);if(n)return n}return null}}),Object.assign(Th.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)t[e++]=r[i]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=t[e++]},function(t,e){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,i=e.propertyName,n=e.propertyIndex;if(t||(t=Th.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var a=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var o=0;o<t.length;o++)if(t[o].name===a){a=o;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==a){if(void 0===t[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[a]}}var s=t[i];if(void 0!==s){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(t.geometry.morphAttributes.position[o].name===n){n=o;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(t.geometry.morphTargets[o].name===n){n=o;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Th.prototype,{_getValue_unbound:Th.prototype.getValue,_setValue_unbound:Th.prototype.setValue}),Object.assign(Ch.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],d=h.uuid,p=i[d];if(void 0===p){p=e++,i[d]=p,t.push(h);for(var f=0,m=s;f!==m;++f)o[f].push(new Th(h,n[f],a[f]))}else if(p<r){l=t[p];var g=--r,b=t[g];i[b.uuid]=p,t[p]=b,i[d]=g,t[g]=h;for(f=0,m=s;f!==m;++f){var v=o[f],y=v[g],A=v[p];v[p]=y,void 0===A&&(A=new Th(h,n[f],a[f])),v[g]=A}}else t[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,n=i.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,u=r[l];if(void 0!==u&&u>=e){var c=e++,h=t[c];r[h.uuid]=u,t[u]=h,r[l]=c,t[c]=s;for(var d=0,p=n;d!==p;++d){var f=i[d],m=f[c],g=f[u];f[u]=m,f[c]=g}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,a=n.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o].uuid,u=i[l];if(void 0!==u)if(delete i[l],u<r){var c=--r,h=t[c],d=t[b=--e];i[h.uuid]=u,t[u]=h,i[d.uuid]=c,t[c]=d,t.pop();for(var p=0,f=a;p!==f;++p){var m=(v=n[p])[c],g=v[b];v[u]=m,v[c]=g,v.pop()}}else{var b;i[(d=t[b=--e]).uuid]=u,t[u]=d,t.pop();for(p=0,f=a;p!==f;++p){var v;(v=n[p])[u]=v[b],v.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,i=r[t],n=this._bindings;if(void 0!==i)return n[i];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);i=n.length,r[t]=i,a.push(t),o.push(e),n.push(c);for(var h=u,d=s.length;h!==d;++h){var p=s[h];c[h]=new Th(p,t,e)}return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){var i=this._paths,n=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=r,a[r]=s,a.pop(),n[r]=n[o],n.pop(),i[r]=i[o],i.pop()}}}),Object.assign(Sh.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var i=this._clip.duration,n=t._clip.duration,a=n/i,o=i/n;t.warp(1,a,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var i=this._mixer,n=i.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=n,s[1]=n+r,l[0]=t/o,l[1]=e/o,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,i){if(this.enabled){var n=this._startTime;if(null!==n){var a=(t-n)*r;if(a<0||0===r)return;this._startTime=null,e=r*a}e*=this._updateTimeScale(t);var o=this._updateTime(e),s=this._updateWeight(t);if(s>0)for(var l=this._interpolants,u=this._propertyBindings,c=0,h=l.length;c!==h;++c)l[c].evaluate(o),u[c].accumulate(i,s)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var i=r.evaluate(t)[0];e*=i,t>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,r=this._clip.duration,i=this.loop,n=this._loopCount,a=i===vi;if(0===t)return-1===n?e:a&&1==(1&n)?r-e:e;if(i===gi){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===n&&(t>=0?(n=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),e>=r||e<0){var o=Math.floor(e/r);e-=r*o,n+=Math.abs(o);var s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var l=t<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}if(a&&1==(1&n))return this.time=e,r-e}return this.time=e,e},_setEndings:function(t,e,r){var i=this._interpolantSettings;r?(i.endingStart=Si,i.endingEnd=Si):(i.endingStart=t?this.zeroSlopeAtStart?Si:Ci:Ei,i.endingEnd=e?this.zeroSlopeAtEnd?Si:Ci:Ei)},_scheduleFading:function(t,e,r){var i=this._mixer,n=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=n,s[0]=e,o[1]=n+t,s[1]=r,this}}),Eh.prototype=Object.assign(Object.create(ee.prototype),{constructor:Eh,_bindAction:function(t,e){var r=t._localRoot||this._root,i=t._clip.tracks,n=i.length,a=t._propertyBindings,o=t._interpolants,s=r.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==n;++c){var h=i[c],d=h.name,p=u[d];if(void 0!==p)a[c]=p;else{if(void 0!==(p=a[c])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=e&&e._propertyBindings[c].binding.parsedPath;++(p=new nh(Th.create(r,d,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),a[c]=p}o[c].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,i=this._actionsByClip[r];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,r,e)}for(var n=t._propertyBindings,a=0,o=n.length;a!==o;++a){var s=n[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,i=e.length;r!==i;++r){var n=e[r];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var i=this._actions,n=this._actionsByClip,a=n[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=a;else{var o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=i.length,i.push(t),a.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],i=t._cacheIndex;r._cacheIndex=i,e[i]=r,e.pop(),t._cacheIndex=null;var n=t._clip.uuid,a=this._actionsByClip,o=a[n],s=o.knownActions,l=s[s.length-1],u=t._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete a[n],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,i=e.length;r!==i;++r){var n=e[r];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,i=this._nActiveActions++,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=r,e[r]=n},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,i=--this._nActiveActions,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=r,e[r]=n},_addInactiveBinding:function(t,e,r){var i=this._bindingsByRootAndName,n=i[e],a=this._bindings;void 0===n&&(n={},i[e]=n),n[r]=t,t._cacheIndex=a.length,a.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,i=r.rootNode.uuid,n=r.path,a=this._bindingsByRootAndName,o=a[i],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete o[n];t:{for(var u in o)break t;delete a[i]}},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,i=this._nActiveBindings++,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=r,e[r]=n},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,i=--this._nActiveBindings,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=r,e[r]=n},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new Tu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,i=--this._nActiveControlInterpolants,n=e[i];t.__cacheIndex=i,e[i]=t,n.__cacheIndex=r,e[r]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,i=r.uuid,n="string"==typeof t?_u.findByName(r,t):t,a=null!==n?n.uuid:t,o=this._actionsByClip[a],s=null;if(void 0!==o){var l=o.actionByRoot[i];if(void 0!==l)return l;s=o.knownActions[0],null===n&&(n=s._clip)}if(null===n)return null;var u=new Sh(this,n,e);return this._bindAction(u,s),this._addInactiveAction(u,a,i),u},existingAction:function(t,e){var r=e||this._root,i=r.uuid,n="string"==typeof t?_u.findByName(r,t):t,a=n?n.uuid:t,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,r=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==e;++n)t[n].reset();for(n=0;n!==i;++n)r[n].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,r=this._nActiveActions,i=this.time+=t,n=Math.sign(t),a=this._accuIndex^=1,o=0;o!==r;++o){e[o]._update(i,t,n,a)}var s=this._bindings,l=this._nActiveBindings;for(o=0;o!==l;++o)s[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,i=this._actionsByClip,n=i[r];if(void 0!==n){for(var a=n.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var u=l._cacheIndex,c=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,e[u]=c,e.pop(),this._removeInactiveBindingsForAction(l)}delete i[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var i in r){var n=r[i].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var a=this._bindingsByRootAndName[e];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),wh.prototype.clone=function(){return new wh(void 0===this.value.clone?this.value:this.value.clone())},kh.prototype=Object.assign(Object.create(aa.prototype),{constructor:kh,isInstancedBufferGeometry:!0,copy:function(t){return aa.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),xh.prototype=Object.assign(Object.create(Is.prototype),{constructor:xh,isInstancedInterleavedBuffer:!0,copy:function(t){return Is.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Mh.prototype=Object.assign(Object.create(jn.prototype),{constructor:Mh,isInstancedBufferAttribute:!0,copy:function(t){return jn.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(Oh.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){var i=r||[];return _h(t,this,i,e),i.sort(Ih),i},intersectObjects:function(t,e,r){var i=r||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,a=t.length;n<a;n++)_h(t[n],this,i,e);return i.sort(Ih),i}}),Object.assign(Lh.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+e*e+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(Ui.clamp(e/this.radius,-1,1))),this}}),Object.assign(Ph.prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=e,this}}),Object.assign(Rh.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Hi;return function(e,r){var i=t.copy(r).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Hi),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Hi),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Hi),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Hi),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Hi;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(Fh.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Wi),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Wi),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Wi),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(fh=new Wi,mh=new Wi,function(t,e){fh.subVectors(t,this.start),mh.subVectors(this.end,this.start);var r=mh.dot(mh),i=mh.dot(fh)/r;return e&&(i=Ui.clamp(i,0,1)),i}),closestPointToPoint:function(t,e,r){var i=this.closestPointToPointParameter(t,e);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Wi),this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Dh.prototype=Object.create(Hn.prototype),Dh.prototype.constructor=Dh,Dh.prototype.isImmediateRenderObject=!0,Nh.prototype=Object.create(Us.prototype),Nh.prototype.constructor=Nh,Nh.prototype.update=function(){var t=new Wi,e=new Wi,r=new Vi;return function(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var s=o.vertices,l=o.faces,u=0,c=0,h=l.length;c<h;c++)for(var d=l[c],p=0,f=d.vertexNormals.length;p<f;p++){var m=s[d[i[p]]],g=d.vertexNormals[p];t.copy(m).applyMatrix4(n),e.copy(g).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),a.setXYZ(u,t.x,t.y,t.z),u+=1,a.setXYZ(u,e.x,e.y,e.z),u+=1}else if(o&&o.isBufferGeometry){var b=o.attributes.position,v=o.attributes.normal;for(u=0,p=0,f=b.count;p<f;p++)t.set(b.getX(p),b.getY(p),b.getZ(p)).applyMatrix4(n),e.set(v.getX(p),v.getY(p),v.getZ(p)),e.applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),a.setXYZ(u,t.x,t.y,t.z),u+=1,a.setXYZ(u,e.x,e.y,e.z),u+=1}a.needsUpdate=!0}}(),Bh.prototype=Object.create(Hn.prototype),Bh.prototype.constructor=Bh,Bh.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Bh.prototype.update=function(){var t=new Wi;return function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,r=e*Math.tan(this.light.angle);this.cone.scale.set(r,r,e),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),Gh.prototype=Object.create(Us.prototype),Gh.prototype.constructor=Gh,Gh.prototype.updateMatrixWorld=function(){var t=new Wi,e=new vn,r=new vn;return function(i){var n=this.bones,a=this.geometry,o=a.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<n.length;s++){var u=n[s];u.parent&&u.parent.isBone&&(e.multiplyMatrices(r,u.matrixWorld),t.setFromMatrixPosition(e),o.setXYZ(l,t.x,t.y,t.z),e.multiplyMatrices(r,u.parent.matrixWorld),t.setFromMatrixPosition(e),o.setXYZ(l+1,t.x,t.y,t.z),l+=2)}a.getAttribute("position").needsUpdate=!0,Hn.prototype.updateMatrixWorld.call(this,i)}}(),Uh.prototype=Object.create(Ia.prototype),Uh.prototype.constructor=Uh,Uh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Uh.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},Hh.prototype=Object.create(Gs.prototype),Hh.prototype.constructor=Hh,Hh.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var t=this.material.color,e=Math.max(t.r,t.g,t.b);e>1&&t.multiplyScalar(1/e),this.children[0].material.color.copy(this.material.color)}},Hh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},zh.prototype=Object.create(Hn.prototype),zh.prototype.constructor=zh,zh.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},zh.prototype.update=function(){var t=new Wi,e=new xn,r=new xn;return function(){var i=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var n=i.geometry.getAttribute("color");e.copy(this.light.color),r.copy(this.light.groundColor);for(var a=0,o=n.count;a<o;a++){var s=a<o/2?e:r;n.setXYZ(a,s.r,s.g,s.b)}n.needsUpdate=!0}i.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),Wh.prototype=Object.create(Ia.prototype),Wh.prototype.constructor=Wh,Wh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Wh.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},Vh.prototype=Object.assign(Object.create(Us.prototype),{constructor:Vh,copy:function(t){return Us.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),Yh.prototype=Object.create(Us.prototype),Yh.prototype.constructor=Yh,jh.prototype=Object.create(Gs.prototype),jh.prototype.constructor=jh,jh.prototype.update=function(){var t,e,r=this.audio,i=this.range,n=this.divisionsInnerAngle,a=this.divisionsOuterAngle,o=Ui.degToRad(r.panner.coneInnerAngle),s=Ui.degToRad(r.panner.coneOuterAngle),l=o/2,u=s/2,c=0,h=0,d=this.geometry,p=d.attributes.position;function f(r,n,a,o){var s=(n-r)/a;for(p.setXYZ(c,0,0,0),h++,t=r;t<n;t+=s)e=c+h,p.setXYZ(e,Math.sin(t)*i,0,Math.cos(t)*i),p.setXYZ(e+1,Math.sin(Math.min(t+s,n))*i,0,Math.cos(Math.min(t+s,n))*i),p.setXYZ(e+2,0,0,0),h+=3;d.addGroup(c,h,o),c+=h,h=0}d.clearGroups(),f(-u,-l,a,0),f(-l,l,n,1),f(l,u,a,0),p.needsUpdate=!0,o===s&&(this.material[0].visible=!1)},jh.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()},Xh.prototype=Object.create(Us.prototype),Xh.prototype.constructor=Xh,Xh.prototype.update=function(){var t=new Wi,e=new Wi,r=new Vi;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var i=this.object.matrixWorld,n=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,l=0,u=0,c=s.length;u<c;u++){var h=s[u],d=h.normal;t.copy(o[h.a]).add(o[h.b]).add(o[h.c]).divideScalar(3).applyMatrix4(i),e.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(t),n.setXYZ(l,t.x,t.y,t.z),l+=1,n.setXYZ(l,e.x,e.y,e.z),l+=1}n.needsUpdate=!0}}(),qh.prototype=Object.create(Hn.prototype),qh.prototype.constructor=qh,qh.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},qh.prototype.update=function(){var t=new Wi,e=new Wi,r=new Wi;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(e,t),this.lightPlane.lookAt(e),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(e),this.targetLine.scale.z=r.length()}}(),Zh.prototype=Object.create(Us.prototype),Zh.prototype.constructor=Zh,Zh.prototype.update=function(){var t,e,r=new Wi,i=new ds;function n(n,a,o,s){r.set(a,o,s).unproject(i);var l=e[n];if(void 0!==l)for(var u=t.getAttribute("position"),c=0,h=l.length;c<h;c++)u.setXYZ(l[c],r.x,r.y,r.z)}return function(){t=this.geometry,e=this.pointMap;i.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),n("c",0,0,-1),n("t",0,0,1),n("n1",-1,-1,-1),n("n2",1,-1,-1),n("n3",-1,1,-1),n("n4",1,1,-1),n("f1",-1,-1,1),n("f2",1,-1,1),n("f3",-1,1,1),n("f4",1,1,1),n("u1",.7,1.1,-1),n("u2",-.7,1.1,-1),n("u3",0,2,-1),n("cf1",-1,0,1),n("cf2",1,0,1),n("cf3",0,-1,1),n("cf4",0,1,1),n("cn1",-1,0,-1),n("cn2",1,0,-1),n("cn3",0,-1,-1),n("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),Kh.prototype=Object.create(Us.prototype),Kh.prototype.constructor=Kh,Kh.prototype.update=function(){var t=new fn;return function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){var r=t.min,i=t.max,n=this.geometry.attributes.position,a=n.array;a[0]=i.x,a[1]=i.y,a[2]=i.z,a[3]=r.x,a[4]=i.y,a[5]=i.z,a[6]=r.x,a[7]=r.y,a[8]=i.z,a[9]=i.x,a[10]=r.y,a[11]=i.z,a[12]=i.x,a[13]=i.y,a[14]=r.z,a[15]=r.x,a[16]=i.y,a[17]=r.z,a[18]=r.x,a[19]=r.y,a[20]=r.z,a[21]=i.x,a[22]=r.y,a[23]=r.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Kh.prototype.setFromObject=function(t){return this.object=t,this.update(),this},Kh.prototype.copy=function(t){return Us.prototype.copy.call(this,t),this.object=t.object,this},Kh.prototype.clone=function(){return(new this.constructor).copy(this)},Qh.prototype=Object.create(Us.prototype),Qh.prototype.constructor=Qh,Qh.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),Hn.prototype.updateMatrixWorld.call(this,t))},Jh.prototype=Object.create(Gs.prototype),Jh.prototype.constructor=Jh,Jh.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?be:ge,this.lookAt(this.plane.normal),Hn.prototype.updateMatrixWorld.call(this,t)},$h.prototype=Object.create(Hn.prototype),$h.prototype.constructor=$h,$h.prototype.setDirection=(yh=new Wi,function(t){t.y>.99999?this.quaternion.set(0,0,0,1):t.y<-.99999?this.quaternion.set(1,0,0,0):(yh.set(t.z,0,-t.x).normalize(),vh=Math.acos(t.y),this.quaternion.setFromAxisAngle(yh,vh))}),$h.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},$h.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},$h.prototype.copy=function(t){return Hn.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},$h.prototype.clone=function(){return(new this.constructor).copy(this)},td.prototype=Object.create(Us.prototype),td.prototype.constructor=td;var rd=0,id=1;function nd(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function ad(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function od(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ws(t,e)}function sd(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Ps(t)}function ld(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ws(t,e)}function ud(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new zs(t)}function cd(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new zs(t)}function hd(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new zs(t)}function dd(t,e,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Wi(t,e,r)}function pd(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new jn(t,e).setDynamic(!0)}function fd(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Xn(t,e)}function md(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new qn(t,e)}function gd(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Zn(t,e)}function bd(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Kn(t,e)}function vd(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Qn(t,e)}function yd(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Jn(t,e)}function Ad(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new $n(t,e)}function Td(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new ta(t,e)}function Cd(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new ea(t,e)}function Sd(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ju.call(this,t),this.type="catmullrom",this.closed=!0}function Ed(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ju.call(this,t),this.type="catmullrom"}function wd(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Ju.call(this,t),this.type="catmullrom"}function kd(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new td(t)}function xd(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Kh(t,e)}function Md(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Us(new $l(t.geometry),new Bs({color:void 0!==e?e:16777215}))}function Od(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Us(new qs(t.geometry),new Bs({color:void 0!==e?e:16777215}))}function Id(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Nu(t)}function _d(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Uu(t)}Vu.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Vu.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(cc.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new Yn,r=0,i=t.length;r<i;r++){var n=t[r];e.vertices.push(new Wi(n.x,n.y,n.z||0))}return e}}),Object.assign(hc.prototype,{fromPoints:function(t){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Sd.prototype=Object.create(Ju.prototype),Ed.prototype=Object.create(Ju.prototype),wd.prototype=Object.create(Ju.prototype),Object.assign(wd.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Vh.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Gh.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(zc.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),wc.extractUrlBase(t)}}),Object.assign(Mc.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(Rh.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(fn.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Fh.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Ui,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Ui.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Ui.ceilPowerOfTwo(t)}}),Object.assign(Vi.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(vn.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return void 0===t&&(t=new Wi),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,r,i,n,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,r,n,a)}}),gn.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},zi.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(xa.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Ma.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Ma,{barycoordFromPoint:function(t,e,r,i,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ma.getBarycoord(t,e,r,i,n)},normal:function(t,e,r,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ma.getNormal(t,e,r,i)}}),Object.assign(dc.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Bl(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Kl(this,t)}}),Object.assign(Hi.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Wi.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(un.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Yn.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(Hn.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(Hn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Rs.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ds.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Fs.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Vu.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),ps.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(pc.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(jn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(aa.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(aa.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(Gl.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(wh.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(ha.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new xn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===ye}}}),Object.defineProperties(hu.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ka.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(ks.prototype,{clearTarget:function(t,e,r,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,r,i)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")}}),Object.defineProperties(ks.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ss.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(dn.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(cn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Es.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),eh.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new Vc).load(t,function(t){e.setBuffer(t)}),this},ih.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Jc.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};var Ld={merge:function(t,e,r){var i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),i=e.matrix,e=e.geometry),t.merge(e,i,r)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function Pd(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function Rd(){console.error("THREE.CanvasRenderer has been removed")}function Fd(){console.error("THREE.JSONLoader has been removed.")}on.crossOrigin=void 0,on.loadTexture=function(t,e,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new Wu;n.setCrossOrigin(this.crossOrigin);var a=n.load(t,r,void 0,i);return e&&(a.mapping=e),a},on.loadTextureCube=function(t,e,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new zu;n.setCrossOrigin(this.crossOrigin);var a=n.load(t,r,void 0,i);return e&&(a.mapping=e),a},on.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},on.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Dd={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function Nd(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Bd=function(t,e){return(Bd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Gd(t,e){function r(){this.constructor=t}Bd(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Ud=function(){function t(){this.red=0,this.green=0,this.blue=0,this.opacity=1}return t.of=function(e,r,i){var n=new t;return n.blue=i,n.red=e,n.green=r,n},t.parseRGB=function(e){if(null==e||""===e||"none"===e)return t.NULL;var r=new t;e=e.replace(/ /g,"");var i=Wd.parseParamList(e);if(1==i.length){var n=i[0].replace("#","");r.texture=n}else r.red=parseInt(i[0]),r.green=parseInt(i[1]),r.blue=parseInt(i[2]),r.opacity=4==i.length?parseFloat(i[3]):1;return r},t.prototype.toInt=function(){return 65536*this.red+256*this.green+this.blue},t.prototype.toThreeColor=function(){return new xn(this.toInt())},t.prototype.getId=function(){return null!=this.texture?this.texture:"rgba("+this.red+","+this.green+","+this.blue+","+this.opacity+")"},t.prototype.isTexture=function(){return null!=this.texture},t.prototype.isTransparent=function(){return 1!==this.opacity},t.prototype.cacheMaterial=function(e){(this.isTexture()||t.materials.size<100)&&(t.cache[this.getId()]=e,t.materials.set(e,!0))},t.prototype.createTextureMaterial=function(){var e=this,r="assets/3d/textures/"+t.textureFiles[this.texture],i="assets/3d/normals/"+t.textureFiles[this.texture],n=new Wu,a=n.load(r),o=n.load(i,function(t){s.normalMap=t},function(){},function(t){console.log("Color: Normal map not found:",e.texture)});a.wrapS=a.wrapT=br,o.wrapS=o.wrapT=br;var s=new hu({map:a,depthTest:!0});return s},t.prototype.createColorMaterial=function(){var t=Wd.createDefaultMaterial();return this.setupColorMaterial(t),t},t.prototype.setupColorMaterial=function(t){return t.color=this.toThreeColor(),t.transparent=this.isTransparent(),t.opacity=this.opacity,t},t.prototype.getMaterial=function(){var e=t.cache[this.getId()];return null==e&&(e=this.isTexture()?this.createTextureMaterial():this.createColorMaterial(),this.cacheMaterial(e)),e},t.prototype.applyToMaterial=function(t){var e=!this.isNull();e&&(Wd.disposeMaterial(t.material),t.material=this.getMaterial()),t.visible!=e&&(t.visible=e)},t.prototype.isNull=function(){return this===t.NULL},t.textureFiles=[],t.cache=[],t.materials=new Map,t.GRAY=t.of(128,128,128),t.BLACK=t.of(0,0,0),t.SIENNA=t.of(160,82,45),t.WHITE=t.of(255,255,255),t.NULL=new t,t._init=(t.textureFiles.brickRedTexture="brick-red.jpg",t.textureFiles.brickWhiteTexture="brick-white.jpg",t.textureFiles.concreteTexture="concrete.jpg",t.textureFiles.earthTexture="earth.jpg",t.textureFiles.floorCarpetTexture="floor-carpet.jpg",t.textureFiles.floorLinoTexture="floor-lino.jpg",t.textureFiles.floorMetalTexture="floor-metal.jpg",t.textureFiles.floorWoodTexture="floor-wood.jpg",t.textureFiles.grassTexture="grass.jpg",t.textureFiles.gravelTexture="gravel.jpg",t.textureFiles.roofCeramicTexture="roof-ceramic.jpg",t.textureFiles.roofMetalTexture="roof-metal.jpg",t.textureFiles.sandTexture="sand.jpg",t.textureFiles.snowTexture="snow.jpg",t.textureFiles.tarmacTexture="tarmac.jpg",void(t.textureFiles.waterTexture="water.jpg")),t}(),Hd=function(){function t(t){this._planes=t}return t.of=function(e){return new t(e)},Object.defineProperty(t.prototype,"planes",{get:function(){return this._planes},enumerable:!0,configurable:!0}),t.prototype.contains=function(t){return 0!=(this.planes&t)},t.prototype.intersection=function(e){return new t(this.planes&e)},t.prototype.getFaceCount=function(){for(var e=0,r=t.PLANE_ARRAY,i=0;i<r.length;i++)this.contains(r[i])&&(e+=2);return this.contains(t.DOUBLE_SIDE)&&(e*=2),e},t.TOP=1,t.BOTTOM=2,t.LEFT=4,t.RIGHT=8,t.BACK=16,t.FRONT=32,t.DOUBLE_SIDE=1024,t.SIDES=t.TOP|t.BOTTOM|t.LEFT|t.RIGHT,t.ALL=t.TOP|t.BOTTOM|t.LEFT|t.RIGHT|t.FRONT|t.BACK,t.PLANE_ARRAY=[t.TOP,t.BOTTOM,t.LEFT,t.RIGHT,t.FRONT,t.BACK],t.top=t.of(t.TOP),t.all=t.of(t.ALL),t.sides=t.of(t.SIDES),t.none=t.of(0),t}(),zd=function(){function t(){this.l1=new Wi,this.l2=new Wi,this.r1=new Wi,this.r2=new Wi,this.l1t=new Wi,this.l2t=new Wi,this.r1t=new Wi,this.r2t=new Wi,this.leftNormal=new Wi,this.rightNormal=new Wi,this.backNormal=new Wi,this.frontNormal=new Wi,this.topNormal=new Wi,this.bottomNormal=new Wi,this.UVS=[new Hi(0,0),new Hi(1,0),new Hi(1,1),new Hi(0,1)],this.LEFT=[this.l1,this.l2,this.l2t,this.l1t],this.RIGHT=[this.r1,this.r1t,this.r2t,this.r2],this.BACK=[this.l1,this.l1t,this.r1t,this.r1],this.FRONT=[this.r2,this.r2t,this.l2t,this.l2],this.BOTTOM=[this.l2,this.l1,this.r1,this.r2],this.TOP=[this.l1t,this.l2t,this.r2t,this.r1t],this.LEFT_NORMALS=[new Wi,new Wi,new Wi,new Wi],this.RIGHT_NORMALS=[new Wi,new Wi,new Wi,new Wi],this.BACK_NORMALS=[new Wi,new Wi,new Wi,new Wi],this.FRONT_NORMALS=[new Wi,new Wi,new Wi,new Wi],this.BOTTOM_NORMALS=[new Wi,new Wi,new Wi,new Wi],this.TOP_NORMALS=[new Wi,new Wi,new Wi,new Wi],this.VERTICES=this.BOTTOM.concat(this.TOP)}return Object.defineProperty(t,"BOX",{get:function(){return this._box||(this._box=new t),this._box},enumerable:!0,configurable:!0}),t.prototype.getNormal=function(t,e,r){return Wd.isZeroDouble(t.distanceTo(e))?r:Wd.getNormal(t,e)},t.prototype.addPlanes=function(e,r,i){void 0===r&&(r=Hd.all);var n=0;return r.contains(Hd.LEFT)&&(n+=t.addSideVerts(e,r,this.LEFT,this.leftNormals,null!=i?i+n:null)),r.contains(Hd.RIGHT)&&(n+=t.addSideVerts(e,r,this.RIGHT,this.rightNormals,null!=i?i+n:null)),r.contains(Hd.TOP)&&(n+=t.addSideVerts(e,r,this.TOP,this.topNormals,null!=i?i+n:null)),r.contains(Hd.BOTTOM)&&(n+=t.addSideVerts(e,r,this.BOTTOM,this.bottomNormals,null!=i?i+n:null)),r.contains(Hd.BACK)&&(n+=t.addSideVerts(e,r,this.BACK,this.backNormals,null!=i?i+n:null)),r.contains(Hd.FRONT)&&(n+=t.addSideVerts(e,r,this.FRONT,this.frontNormals,null!=i?i+n:null)),n},t.prototype.setupStraitSegment=function(t,e,r,i){var n=this;Wd.getLeftNormal(t,e,this.leftNormal),this.rightNormal.copy(this.leftNormal),this.rightNormal.multiplyScalar(-1),Wd.getNormal(t,e,this.frontNormal),Wd.getNormal(e,t,this.backNormal),this.BACK.forEach(function(e){return e.copy(t)}),this.FRONT.forEach(function(t){return t.copy(e)}),this.LEFT.forEach(function(t){return Wd.translateScaled(t,n.leftNormal,i)}),this.RIGHT.forEach(function(t){return Wd.translateScaled(t,n.leftNormal,-i)}),this.TOP.forEach(function(t){return t.z+=r}),this.topNormal.set(0,0,1),this.bottomNormal.set(0,0,-1),this.setSingleNormals()},t.prototype.setSingleNormals=function(){this.topNormals=[this.topNormal],this.bottomNormals=[this.bottomNormal],this.leftNormals=[this.leftNormal],this.rightNormals=[this.rightNormal],this.frontNormals=[this.frontNormal],this.backNormals=[this.backNormal]},t.prototype.setupTrianglePrism=function(t,e,r,i){this.r1.copy(r),this.r2.copy(r),this.l1.copy(t),this.l2.copy(e),this.updateTopPlane(i),this.topNormal.set(0,0,1),this.bottomNormal.set(0,0,-1),Wd.getNormal(t,r,this.rightNormal),Wd.getLeftNormal(r,t,this.backNormal),Wd.getLeftNormal(e,r,this.frontNormal),this.setSingleNormals(),Wd.getNormal(r,t,this.LEFT_NORMALS[0]),Wd.getNormal(r,e,this.LEFT_NORMALS[1]),Wd.getNormal(r,e,this.LEFT_NORMALS[2]),Wd.getNormal(r,t,this.LEFT_NORMALS[3]),this.leftNormals=this.LEFT_NORMALS},t.prototype.setupPrism=function(t,e,r,i,n,a){this.r1.copy(r),this.r2.copy(i),this.l1.copy(t),this.l2.copy(e),this.updateTopPlane(0),this.TOP.forEach(function(t){return Wd.translateScaled(t,n,a)}),this.topNormal.copy(n),this.bottomNormal.copy(this.topNormal).multiplyScalar(-1);var o=Wd.getNormal(r,t),s=Wd.getNormal(i,e);this.backNormal.crossVectors(n,o),this.frontNormal.crossVectors(s,n),this.setSingleNormals(),Wd.getNormal(r,t,this.LEFT_NORMALS[0]),Wd.getNormal(i,e,this.LEFT_NORMALS[1]),Wd.getNormal(i,e,this.LEFT_NORMALS[2]),Wd.getNormal(r,t,this.LEFT_NORMALS[3]),this.leftNormals=this.LEFT_NORMALS,Wd.getNormal(t,r,this.RIGHT_NORMALS[0]),Wd.getNormal(t,r,this.RIGHT_NORMALS[1]),Wd.getNormal(e,i,this.RIGHT_NORMALS[2]),Wd.getNormal(e,i,this.RIGHT_NORMALS[3]),this.rightNormals=this.RIGHT_NORMALS},t.prototype.setupBox=function(t,e,r,i,n){var a=this;Wd.getLeftNormal(t,e,this.leftNormal),0==this.leftNormal.length()&&null!=n&&this.leftNormal.copy(n),this.rightNormal.copy(this.leftNormal).multiplyScalar(-1),Wd.getNormal(t,e,this.frontNormal),Wd.getNormal(e,t,this.backNormal),this.topNormal.crossVectors(this.rightNormal,this.frontNormal),this.bottomNormal.copy(this.topNormal).multiplyScalar(-1),this.setSingleNormals(),this.BACK.forEach(function(e){return e.copy(t)}),this.FRONT.forEach(function(t){return t.copy(e)}),this.LEFT.forEach(function(t){return Wd.translateScaled(t,a.leftNormal,r/2)}),this.RIGHT.forEach(function(t){return Wd.translateScaled(t,a.leftNormal,-r/2)}),this.TOP.forEach(function(t){return Wd.translateScaled(t,a.topNormal,i/2)}),this.BOTTOM.forEach(function(t){return Wd.translateScaled(t,a.topNormal,-i/2)})},t.prototype.setupParallel=function(t,e,r,i,n,a){var o=this;this.rightNormal.copy(e),this.frontNormal.copy(r),this.topNormal.crossVectors(e,r),this.leftNormal.copy(this.rightNormal).multiplyScalar(-1),this.backNormal.copy(this.frontNormal).multiplyScalar(-1),this.bottomNormal.copy(this.topNormal).multiplyScalar(-1),this.setSingleNormals(),this.VERTICES.forEach(function(e){return e.copy(t)}),this.LEFT.forEach(function(t){return Wd.translateScaled(t,o.leftNormal,i/2)}),this.RIGHT.forEach(function(t){return Wd.translateScaled(t,o.rightNormal,i/2)}),this.BACK.forEach(function(t){return Wd.translateScaled(t,o.backNormal,a/2)}),this.FRONT.forEach(function(t){return Wd.translateScaled(t,o.frontNormal,a/2)}),this.TOP.forEach(function(t){return Wd.translateScaled(t,o.topNormal,n/2)}),this.BOTTOM.forEach(function(t){return Wd.translateScaled(t,o.bottomNormal,n/2)})},t.prototype.updateTopPlane=function(t){this.l1t.copy(this.l1),this.l2t.copy(this.l2),this.r1t.copy(this.r1),this.r2t.copy(this.r2),this.TOP.forEach(function(e){return e.z+=t})},t.prototype.setupArc=function(t,e,r,i,n,a,o,s,l,u,c){var h=this,d=Math.cos(a),p=Math.sin(a),f=Math.cos(a+o),m=Math.sin(a+o),g=o>0,b=g?this.r1:this.l1,v=g?this.r2:this.l2,y=g?this.l1:this.r1,A=g?this.l2:this.r2,T=this.backNormal,C=this.frontNormal;b.set(t*d+s,e*p+l,u),v.set(t*f+s,e*m+l,c),y.set(r*d+s,i*p+l,u),A.set(r*f+s,i*m+l,c),this.updateTopPlane(n),this.topNormal.set(0,0,1),this.bottomNormal.set(0,0,-1),Wd.getLeftNormal(y,b,T),Wd.getLeftNormal(v,A,C),this.setSingleNormals(),Wd.getNormal(y,b,this.LEFT_NORMALS[0]),Wd.getNormal(A,v,this.LEFT_NORMALS[1]),Wd.getNormal(A,v,this.LEFT_NORMALS[2]),Wd.getNormal(y,b,this.LEFT_NORMALS[3]),this.leftNormals=this.LEFT_NORMALS,Wd.getNormal(b,y,this.RIGHT_NORMALS[0]),Wd.getNormal(b,y,this.RIGHT_NORMALS[1]),Wd.getNormal(v,A,this.RIGHT_NORMALS[2]),Wd.getNormal(v,A,this.RIGHT_NORMALS[3]),this.rightNormals=this.RIGHT_NORMALS,this.TOP_NORMALS.forEach(function(t){return t.copy(h.topNormal)}),this.topNormals=this.TOP_NORMALS,this.BOTTOM_NORMALS.forEach(function(t){return t.copy(h.bottomNormal)}),this.bottomNormals=this.BOTTOM_NORMALS},t.prototype.updateTopNormals=function(t,e){var r=Wd.getNormal(t,e),i=Wd.getLeftNormal(t,e);r.cross(i),this.topNormal.copy(r),this.bottomNormal.copy(this.topNormal),this.bottomNormal.multiplyScalar(-1)},t.addSideVerts=function(e,r,i,n,a){var o=r.contains(Hd.DOUBLE_SIDE),s=t.addVerts(e,i,n,!1,a);return o&&(s+=t.addVerts(e,i,n,!0,null!=a?a+s:null)),s},t.addVerts=function(t,e,r,i,n){var a,o,s;void 0===i&&(i=!1);var l=e.length>3,u=i?-1:1;if(null==r||1==r.length){var c=null!=r?r[0].clone():Wd.getPlaneNormal(new Wi,e);c.multiplyScalar(u),o=c,s=c.clone()}else{var h=r[0].clone(),d=r[1].clone(),p=r[2].clone();if((o=[h,p,d]).forEach(function(t){return t.multiplyScalar(u)}),l){var f=r[3].clone();s=[h,f,p],f.multiplyScalar(u)}}if(null!=n){var m=t.faces[n],g=i?m.a-2:m.a;m.normal=o,l&&(t.faces[n+1].normal=s);for(var b=0;b<e.length;b++)t.vertices[g+b].copy(e[b])}else{var v=g=t.vertices.length,y=g+2;i&&(v=(a=[y,v])[0],y=a[1]),t.faces.push(new Pn(v,y,g+1,o)),l&&t.faces.push(new Pn(v,g+3,y,s)),e.forEach(function(e){return t.vertices.push(e.clone())})}return l?2:1},t.prototype.pushFaces=function(t,e){var r=new Pn(e,e+3,e+2),i=new Pn(e,e+2,e+1);t.push(r,i)},t.prototype.createGeometry=function(t){var e=new Yn;return this.addPlanes(e,t),Wd.calculateTextureUVS(e),e},t}(),Wd=function(){function t(){}return t.getSharedMaterial=function(){return null==t.SHARED_MATERIAL&&(t.SHARED_MATERIAL=new fu),t.SHARED_MATERIAL},t.getSharedGeometry=function(){return null==t.SHARED_GEOMETRY&&(t.SHARED_GEOMETRY=new aa),t.SHARED_GEOMETRY},t.getSpecularColor=function(){return null==t.SPECULAR_COLOR&&(t.SPECULAR_COLOR=new xn(1118481)),t.SPECULAR_COLOR},t.createDefaultMaterial=function(){return new hu({shininess:50})},t.createMesh=function(){return new Ia(t.getSharedGeometry(),t.getSharedMaterial())},t.applyMatrix=function(t,e){t.matrix=new vn,t.applyMatrix(e)},t.applyTransform=function(e,r,i){t.applyMatrix(e,t.parseMatrix(r,i))},t.parseParamList=function(t){return t.replace(/[^()]+\(([^()]+)\)/,function(t,e){return e}).split(",")},t.parseMatrix=function(t,e){var r=new vn;return t.replace(/ /g,"").replace(/matrix\(([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+)\)/,function(t,i,n,a,o,s,l){var u=Number.parseFloat(i),c=Number.parseFloat(n),h=Number.parseFloat(a),d=Number.parseFloat(o),p=Number.parseFloat(s),f=-Number.parseFloat(l);return r.set(u,c,0,p,h,d,0,f,0,0,1,e,0,0,0,1),""}),r},t.setCell=function(t,e,r,i){t.elements[4*e+r]=i},t.getAttributeValue=function(t,e){var r=t.att.indexOf(e);return r<0?null:t.val[r]},t.getShapeType=function(e){return t.getAttributeValue(e,"shape-type")},t.cross2D=function(t,e,r){var i=e.x-t.x,n=r.x-t.x,a=e.y-t.y;return i*(r.y-t.y)-a*n},t.dot2D=function(t,e,r){return(e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y)},t.isRightOriented=function(e,r,i){return t.cross2D(e,r,i)>0},t.isZeroDouble=function(t){return Math.abs(t)<1e-6},t.greaterDouble=function(e,r){return!t.isZeroDouble(Math.abs(e-r))&&e>r},t.greaterEqualsDouble=function(e,r){return t.equalsDouble(e,r)||e>r},t.equalsDouble=function(e,r){return t.isZeroDouble(Math.abs(e-r))},t.getNormal=function(e,r,i){return null==i&&(i=new Wi),i.set(r.x,r.y,r.z),i.sub(e),t.normalize(i)},t.normalize=function(e){return t.isZeroDouble(e.length())?e.set(0,0,0):e.normalize(),e},t.getPlaneNormal=function(e,r){var i=r[0],n=r[1],a=r[2],o=t.getNormal(n,i),s=t.getNormal(a,i);if(e.crossVectors(o,s),r.length>3&&t.isZeroDouble(e.length())){var l=r[3];t.getNormal(a,l,o),t.getNormal(n,l,s),e.crossVectors(o,s)}return e},t.getLeftNormal=function(e,r,i){return null==i&&(i=new Wi),i.set(-(r.y-e.y),r.x-e.x,0),t.normalize(i)},t.getTranslated=function(e,r,i){return t.translateScaled(e.clone(),r,i)},t.translateScaled=function(t,e,r){return t.x+=e.x*r,t.y+=e.y*r,t.z+=e.z*r,t},t.getPointOnLine=function(e,r,i,n){void 0===n&&(n=!1);var a=n?i:i*e.distanceTo(r);return t.translateScaled(e.clone(),t.getNormal(e,r),a)},t.setSum=function(t,e,r){return t.copy(e),t.add(r),t},t.crossProduct=function(t,e,r,i,n,a){return(r-t)*(a-e)-(i-e)*(n-t)},t.genUVS=function(e,r,i,n,a){r.forEach(function(r){var o=[];a.push(o);var s,l,u=e[r.a],c=e[r.b],h=e[r.c],d=[u,c,h];if(u.x==c.x&&u.y==c.y?(s=h.x-u.x,l=h.y-u.y):(u.x==h.x&&u.y==h.y||c.x==h.x&&c.y==h.y)&&(s=c.x-u.x,l=c.y-u.y),null!=s)for(var p=Math.hypot(s,l),f=(s/=p)*i,m=(l/=p)*n,g=0;g<d.length;g++){var b=(d[g].x-u.x)*f+(d[g].y-u.y)*m,v=(d[g].z-u.z)*n;o.push(new Hi(b,v))}else{var y=t.crossProduct(u.x,u.y,c.x,c.y,h.x,h.y)>0?n:-n;for(g=0;g<d.length;g++){b=d[g].x*i,v=d[g].y*y;o.push(new Hi(b,v))}}})},t.calculateTextureUVS=function(e){var r=e.faceVertexUvs[0];e.computeFaceNormals();t.genUVS(e.vertices,e.faces,8/256,8/256,r)},t.getFaceCount=function(e,r,i,n,a,o,s){void 0===r&&(r=t.TAU),void 0===i&&(i=0),void 0===n&&(n=3),void 0===a&&(a=4),void 0===o&&(o=32),void 0===s&&(s=!1);var l=Math.hypot(r*e,i)/n,u=Math.ceil(l);return s&&(u=4*Math.ceil(l/4)),u=Math.min(o,Math.max(a,u))},t.disposeMesh=function(e){null!=e&&(t.disposeMaterial(e.material),t.disposeGeometry(e.geometry))},t.disposeGeometry=function(e){null!=e&&e!==t.getSharedGeometry()&&e.dispose()},t.disposeMaterial=function(e){[].concat(e).forEach(function(e){return t.disposeSingleMaterial(e)})},t.disposeSingleMaterial=function(e){null!=e&&(Ud.materials.get(e)||e===t.getSharedMaterial()||e.dispose())},t.wipeObject3D=function(e){var r=[];e.traverse(function(t){return r.push(t)}),r.forEach(function(e){return t.wipeObject(e)})},t.wipeObject=function(t){for(var e in t){var r=Object.getOwnPropertyDescriptor(t,e);r&&r.writable&&"children"!=e&&"parent"!=e&&delete t[e]}},t.getDistincColor=function(t){var e=new Ud;e.opacity=t.opacity;var r=Math.round((t.red+t.green+t.blue)/3);return r=(r+87)%256,e.red=r,e.green=r,e.blue=r,e},t.round=function(t,e){var r=Math.pow(10,e);return Math.round(t*r)/r},t.getPointOnSpere=function(e,r){var i=Math.abs(e);e<0&&(r+=Math.PI),(i%=t.TAU)>Math.PI&&(i=t.TAU-i,r+=Math.PI);var n=new Lh(1,i,r%=t.TAU);n.makeSafe();var a=(new Wi).setFromSpherical(n);return new Wi(a.z,a.x,a.y)},t.createDefaultLight=function(t){void 0===t&&(t=.4);var e=new hs;e.position.set(0,0,500);var r=new Tc(16777215,t);r.position.set(0,1e3,0),e.add(r);var i=new Tc(16777215,t);i.position.set(0,-1e3,0),e.add(i);var n=new Tc(16777215,t);n.position.set(1e3,0,0),e.add(n);var a=new Tc(16777215,t);return a.position.set(-1e3,0,0),e.add(a),e},t.addBulks=function(e,r,i){for(var n=0;n<r.length/2;n++){var a=r[2*n],o=r[2*n+1];zd.BOX.setupBox(a,o,i,i,t.LEFT),zd.BOX.addPlanes(e)}},t.getSize=function(e,r,i){if(null==e)return[0,0];if(r+=1,e instanceof Ia&&(i+=1),e.children.length>0)for(var n=0;n<e.children.length;n++){var a=t.getSize(e.children[n],0,0);r+=a[0],i+=a[1]}return[r,i]},t.hash=function(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return e>>>0},t.debugServer=!1,t.debugInfo=!1,t.imageCache=[],t.TAU=2*Math.PI,t.LEFT=new Wi(0,-1,0),t.RIGHT=new Wi(0,1,0),t.FRONT=new Wi(1,0,0),t.DX=[-1,1,1,-1],t.DY=[1,1,-1,-1],t}(),Vd=function(){return function(t){var e;this.x=0,this.y=0,this.horizontalAngle=0,this.verticalAngle=0,e=t.split(":").map(Number),this.x=e[0],this.y=e[1],this.horizontalAngle=e[2],this.verticalAngle=e[3]}}(),Yd=function(){function t(t){this._visible=!0,this._x=0,this._y=0,this._z=0,this._rotation=0,this._rotationX=0,this._rotationY=0,this._scaleX=1,this._scaleY=1,this._scaleZ=1,this.id=t.id}return Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible=e,this.setDirty3D(t.DIRTY_3D_VISIBILITY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleX",{get:function(){return this._scaleX},set:function(e){this._scaleX=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleY",{get:function(){return this._scaleY},set:function(e){this._scaleY=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleZ",{get:function(){return this._scaleZ},set:function(e){this._scaleZ=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationX",{get:function(){return this._rotationX},set:function(e){this._rotationX=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setDirty3D(t.DIRTY_3D_TRANSFORM)},enumerable:!0,configurable:!0}),t.prototype.create3D=function(){this.element=new Hn,this.element.name=this.constructor.name+":"+this.id},t.prototype.updateParameters=function(t){for(var e=0;e<t.att.length;e++)this.updateParameter(t.att[e],t.val[e])},t.prototype.updateParameter=function(e,r){if("pos"===e){var i=r.split(":");this.x=parseFloat(i[0]),this.y=-parseFloat(i[1]),this.rotation=-parseFloat(i[2])}if("scale"===e){i=r.split(":");this.scaleX=parseFloat(i[0]),this.scaleY=parseFloat(i[1])}if("3d-rot"===e){i=r.split(":");this.rotationX=parseFloat(i[0]),this.rotationY=parseFloat(i[1])}"3d-z"==e&&(this.z=parseFloat(r)),"3d-scale-z"==e&&(this.scaleZ=parseFloat(r)),"visibility"==e&&(this.visible="inherit"==r),"3d-slope"===e&&(this.slope=new Vd(r),this.setDirty3D(t.DIRTY_3D_TRANSFORM))},t.prototype.setRotationMatrix=function(){t.mZ.makeRotationAxis(t.oZ,this.rotation);var e=0,r=0,i=0,n=0,a=0,o=0,s=0,l=0,u=0;if(0==this.rotationY)a=u=Math.cos(this.rotationX),l=-(o=Math.sin(this.rotationX)),e=1,r=i=n=s=0;else if(0==this.rotationX)e=u=Math.cos(this.rotationY),s=-(i=Math.sin(this.rotationY)),a=1,r=n=o=l=0;else{var c=Math.cos(this.rotationX),h=Math.sin(this.rotationX),d=Math.cos(this.rotationY),p=Math.sin(this.rotationY);e=d,r=0,i=p,n=h*-p,a=c,o=h*d,s=c*-p,l=-h,u=c*d}t.mXY.set(e,r,i,0,n,a,o,0,s,l,u,0,0,0,0,1);var f=t.mZ.multiply(t.mXY);this.element.setRotationFromMatrix(f),this.element.updateMatrixWorld(!1)},t.prototype.transformSlope=function(t){var e=t.horizontalAngle,r=t.verticalAngle,i=t.x,n=t.y,a=Math.abs(Math.cos(e))>Math.abs(Math.sin(e)),o=new vn;o.set(1,0,0,i,0,1,0,-n,0,0,1,0,0,0,0,1);var s=new vn;s.set(1,0,0,-i,0,1,0,n,0,0,1,0,0,0,0,1);var l=new vn,u=Math.cos(r),c=Math.sin(r),h=0==u?1:1/u,d=a?h:1,p=a?1:h;l.set(d,0,0,0,0,p,0,0,0,0,1,0,0,0,0,1);var f=new vn;return f.identity(),a?(Wd.setCell(f,0,0,u),Wd.setCell(f,0,2,c),Wd.setCell(f,2,0,-c)):(Wd.setCell(f,1,1,u),Wd.setCell(f,1,2,-c),Wd.setCell(f,2,1,c)),Wd.setCell(f,2,2,u),o.multiply(f).multiply(l).multiply(s)},t.prototype.update3D=function(){if(this.isDirty3DSet(t.DIRTY_3D_TRANSFORM)&&(0==this.rotationX&&0==this.rotationY?this.element.rotation.set(this.rotationX,this.rotationY,this.rotation):this.setRotationMatrix(),this.element.position.set(this.x,this.y,this.z),this.element.scale.set(this.scaleX,this.scaleY,this.scaleZ),null!=this.slope)){this.element.updateMatrixWorld(!0);var e=this.transformSlope(this.slope),r=this.element.matrix.clone(),i=(new vn).getInverse(r);this.element.applyMatrix(i),this.element.applyMatrix(e),this.element.applyMatrix(r)}this.isDirty3DSet(t.DIRTY_3D_VISIBILITY)&&(this.element.visible=this.visible)},t.prototype.updateElement=function(t){this.updateParameters(t);try{this.update3D()}catch(t){console.error("ShapeBase3D:",this.id,t)}this.dirtyState3D=0},t.prototype.isDirty3DSet=function(t){return(this.dirtyState3D&t)===t},t.prototype.setDirty3D=function(t){this.dirtyState3D|=t},t.prototype.dispose=function(){var t=this.element.parent;null!=t&&t.remove(this.element),null!=this.element&&(this.element.traverse(function(t){t instanceof Ia&&Wd.disposeMesh(t)}),Wd.wipeObject3D(this.element)),Wd.wipeObject(this)},t.prototype.createMesh=function(t){void 0===t&&(t=!1);var e=Wd.createMesh();return t&&(e.material=Wd.createDefaultMaterial()),this.element.add(e),e},t.mZ=new vn,t.mXY=new vn,t.oZ=new Wi(0,0,1),t.DIRTY_3D_NOT_CREATED=1,t.DIRTY_3D_VISIBILITY=2,t.DIRTY_3D_OWNER=4,t.DIRTY_3D_TRANSFORM=8,t.DIRTY_3D_VERTICAL_ROTATION=16,t.DIRTY_3D_FONT=32,t.DIRTY_3D_TEXT=64,t.DIRTY_3D_COLOR=128,t.DIRTY_3D_LINE_COLOR=256,t.DIRTY_3D_FILL_COLOR=512,t.DIRTY_3D_SHAPE=1024,t.DIRTY_3D_IMAGE=2048,t.DIRTY_3D_REFERENCE=4096,t.DIRTY_3D_CAMERA=8192,t.DIRTY_3D_CLIP_DISTANCE=16384,t}(),jd=window,Xd=i;jd.THREE||(jd.THREE=Xd);var qd=jd.THREE,Zd=function(t,e){var r,i,n,a,o;this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.target=new Wi,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:oe.LEFT,ZOOM:oe.MIDDLE,PAN:oe.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),d=h.NONE},this.update=(r=new Wi,i=(new zi).setFromUnitVectors(t.up,new Wi(0,1,0)),n=i.clone().inverse(),a=new Wi,o=new zi,function(){var t=s.object.position;return r.copy(t).sub(s.target),r.applyQuaternion(i),f.setFromVector3(r),s.autoRotate&&d===h.NONE&&O(2*Math.PI/60/60*s.autoRotateSpeed),f.theta+=m.theta,f.phi+=m.phi,f.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,f.theta)),f.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=g,f.radius=Math.max(s.minDistance,Math.min(s.maxDistance,f.radius)),s.target.add(b),r.setFromSpherical(f),r.applyQuaternion(n),t.copy(s.target).add(r),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor):m.set(0,0,0),g=1,b.set(0,0,0),!!(v||a.distanceToSquared(s.object.position)>p||8*(1-o.dot(s.object.quaternion))>p)&&(s.dispatchEvent(l),a.copy(s.object.position),o.copy(s.object.quaternion),v=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",Y,!1),s.domElement.removeEventListener("mousedown",N,!1),s.domElement.removeEventListener("wheel",U,!1),s.domElement.removeEventListener("touchstart",z,!1),s.domElement.removeEventListener("touchend",V,!1),s.domElement.removeEventListener("touchmove",W,!1),document.removeEventListener("mousemove",B,!1),document.removeEventListener("mouseup",G,!1),window.removeEventListener("keydown",H,!1)};var s=this,l={type:"change"},u={type:"start"},c={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},d=h.NONE,p=1e-6,f=new Lh,m=new Lh,g=1,b=new Wi,v=!1,y=new Hi,A=new Hi,T=new Hi,C=new Hi,S=new Hi,E=new Hi,w=new Hi,k=new Hi,x=new Hi;function M(){return Math.pow(.95,s.zoomSpeed)}function O(t){m.theta-=t}function I(t){m.phi-=t}var _,L=(_=new Wi,function(t,e){_.setFromMatrixColumn(e,0),_.multiplyScalar(-t),b.add(_)}),P=function(){var t=new Wi;return function(e,r){t.setFromMatrixColumn(r,1),t.multiplyScalar(e),t.z=0,b.add(t)}}(),R=function(){var t=new Wi;return function(e,r){var i=s.domElement===document?s.domElement.body:s.domElement;if(s.object instanceof ps){var n=s.object.position;t.copy(n).sub(s.target);var a=t.length();a*=Math.tan(s.object.fov/2*Math.PI/180),L(2*e*a/i.clientHeight,s.object.matrix),P(2*r*a/i.clientHeight,s.object.matrix)}else s.object instanceof yc?(L(e*(s.object.right-s.object.left)/s.object.zoom/i.clientWidth,s.object.matrix),P(r*(s.object.top-s.object.bottom)/s.object.zoom/i.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function F(t){s.object instanceof ps?g/=t:s.object instanceof yc?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*t)),s.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function D(t){s.object instanceof ps?g*=t:s.object instanceof yc?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/t)),s.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function N(t){if(!1!==s.enabled){if(t.preventDefault(),t.button===s.mouseButtons.ORBIT||t.button===oe.LEFT&&t.altKey){if(!1===s.enableRotate)return;!function(t){y.set(t.clientX,t.clientY)}(t),d=h.ROTATE}else if(t.button===s.mouseButtons.ZOOM){if(!1===s.enableZoom)return;!function(t){w.set(t.clientX,t.clientY)}(t),d=h.DOLLY}else if(t.button===s.mouseButtons.PAN){if(!1===s.enablePan)return;!function(t){C.set(t.clientX,t.clientY)}(t),d=h.PAN}d!==h.NONE&&(document.addEventListener("mousemove",B,!1),document.addEventListener("mouseup",G,!1),s.dispatchEvent(u))}}function B(t){if(!1!==s.enabled)if(t.preventDefault(),d===h.ROTATE){if(!1===s.enableRotate)return;!function(t){A.set(t.clientX,t.clientY),T.subVectors(A,y);var e=s.domElement===document?s.domElement.body:s.domElement;O(2*Math.PI*T.x/e.clientWidth*s.rotateSpeed),I(2*Math.PI*T.y/e.clientHeight*s.rotateSpeed),y.copy(A),s.update()}(t)}else if(d===h.DOLLY){if(!1===s.enableZoom)return;!function(t){k.set(t.clientX,t.clientY),x.subVectors(k,w),x.y>0?F(M()):x.y<0&&D(M()),w.copy(k),s.update()}(t)}else if(d===h.PAN){if(!1===s.enablePan)return;!function(t){S.set(t.clientX,t.clientY),E.subVectors(S,C),R(E.x,E.y),C.copy(S),s.update()}(t)}}function G(t){!1!==s.enabled&&(document.removeEventListener("mousemove",B,!1),document.removeEventListener("mouseup",G,!1),s.dispatchEvent(c),d=h.NONE)}function U(t){t.ctrlKey||!1===s.enabled||!1===s.enableZoom||d!==h.NONE&&d!==h.ROTATE||(t.preventDefault(),t.stopPropagation(),function(t){t.deltaY<0?D(M()):t.deltaY>0&&F(M()),s.update()}(t),s.dispatchEvent(u),s.dispatchEvent(c))}function H(t){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(t){switch(t.keyCode){case s.keys.UP:R(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:R(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:R(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:R(-s.keyPanSpeed,0),s.update()}}(t)}function z(t){if(!1!==s.enabled){switch(t.touches.length){case 1:if(!1===s.enableRotate)return;!function(t){y.set(t.touches[0].pageX,t.touches[0].pageY)}(t),d=h.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);w.set(0,i)}(t),d=h.TOUCH_DOLLY;break;case 3:if(!1===s.enablePan)return;!function(t){C.set(t.touches[0].pageX,t.touches[0].pageY)}(t),d=h.TOUCH_PAN;break;default:d=h.NONE}d!==h.NONE&&s.dispatchEvent(u)}}function W(t){if(!1!==s.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===s.enableRotate)return;if(d!==h.TOUCH_ROTATE)return;!function(t){A.set(t.touches[0].pageX,t.touches[0].pageY),T.subVectors(A,y);var e=s.domElement===document?s.domElement.body:s.domElement;O(2*Math.PI*T.x/e.clientWidth*s.rotateSpeed),I(2*Math.PI*T.y/e.clientHeight*s.rotateSpeed),y.copy(A),s.update()}(t);break;case 2:if(!1===s.enableZoom)return;if(d!==h.TOUCH_DOLLY)return;!function(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);k.set(0,i),x.subVectors(k,w),x.y>0?D(M()):x.y<0&&F(M()),w.copy(k),s.update()}(t);break;case 3:if(!1===s.enablePan)return;if(d!==h.TOUCH_PAN)return;!function(t){S.set(t.touches[0].pageX,t.touches[0].pageY),E.subVectors(S,C),R(E.x,E.y),C.copy(S),s.update()}(t);break;default:d=h.NONE}}function V(t){!1!==s.enabled&&(s.dispatchEvent(c),d=h.NONE)}function Y(t){t.preventDefault()}s.domElement.addEventListener("contextmenu",Y,!1),s.domElement.addEventListener("mousedown",N,!1),s.domElement.addEventListener("wheel",U,!1),s.domElement.addEventListener("touchstart",z,!1),s.domElement.addEventListener("touchend",V,!1),s.domElement.addEventListener("touchmove",W,!1),window.addEventListener("keydown",H,!1),this.update()};(Zd.prototype=Object.create(qd.EventDispatcher.prototype)).constructor=Zd,Object.defineProperties(Zd.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}});var Kd=function(t){function e(r){var i=t.call(this,r)||this;return i.farClippingDistance=4e4,i.showStats=!1,i.active=!0,i.controlsActive=!0,i.renderActive=!0,i.smoothFrame=0,i.smootCamera=!0,i.transitionTimeout=-1,i.navigationMode=e.NAVIGATION_FULL,i.cameraX=0,i.cameraY=0,i.cameraZ=0,i.cameraRotX=0,i.cameraRotZ=0,i.cameraPositionInit=!1,i.backgroundColor=e.DEFAULT_COLOR,i.look=new Wi,i.times=new Array(20).fill(0),i.timesCnt=0,i.runCallback=function(){return i.run()},i}return Gd(e,t),e.prototype.showCamera=function(){this.cameraDebug&&this.scene.remove(this.cameraDebug),this.cameraDebug=new Hn,this.scene.add(this.cameraDebug);var t=new Bs({color:255}),e=new Yn,r=this.camera.position.clone();e.vertices.push(r,this.look);var i=new Gs(e,t),n=new Ia(new Vl(2,10,10),new hu({color:16755404}));n.position.copy(r),this.cameraDebug.add(n),this.cameraDebug.add(i)},e.prototype.create3D=function(){this.createCamera()},e.prototype.updateParameter=function(t,e){if("3d-camera"===t){var r=e.split(",").map(Number);this.cameraX=r[0],this.cameraY=r[1],this.cameraZ=r[2],this.cameraRotX=r[3],this.cameraRotZ=r[4],this.cameraY=-this.cameraY,this.cameraRotX=Math.PI/2+this.cameraRotX,this.cameraRotZ=-this.cameraRotZ,this.setDirty3D(Yd.DIRTY_3D_CAMERA)}"3d-camera-smooth"===t&&(this.smootCamera="true"===e,this.setDirty3D(Yd.DIRTY_3D_CAMERA)),"3d-transition-timeout"===t&&(this.transitionTimeout=parseFloat(e),this.setDirty3D(Yd.DIRTY_3D_CAMERA)),"3d-far-clipping-distance"===t&&(this.farClippingDistance=parseFloat(e),this.setDirty3D(Yd.DIRTY_3D_CLIP_DISTANCE)),"3d-navigation-mode"===t&&(this.navigationMode=e)},e.prototype.update3D=function(){if(this.isDirty3DSet(Yd.DIRTY_3D_CAMERA)){this.transitionTimeout>0?this.smoothFrame=Math.round(this.transitionTimeout/1e3*30):this.smoothFrame=this.cameraPositionInit&&this.smootCamera?30:1,this.transitionTimeout=-1}this.isDirty3DSet(Yd.DIRTY_3D_CLIP_DISTANCE)&&null!=this.camera&&(this.camera.far=this.farClippingDistance,this.camera.updateProjectionMatrix())},e.prototype.updateCameraSmooth=function(t){var e=new Wi(this.cameraX,this.cameraY,this.cameraZ),r=new Wi,i=Wd.getPointOnSpere(this.cameraRotX,this.cameraRotZ),n=Math.abs(i.z),a=n>.001?Math.abs(e.z)/n:100;i.multiplyScalar(a);var o=new Wi;this.camera.getWorldDirection(o);var s=new Wi;s.copy(this.camera.position),Wd.translateScaled(s,o,a),r.copy(e),r.add(i);var l=Wd.getNormal(s,r),u=s.distanceTo(r);r.copy(s),Wd.translateScaled(r,l,u/t);var c=Wd.getNormal(this.camera.position,e),h=this.camera.position.distanceTo(e);e.copy(this.camera.position),Wd.translateScaled(e,c,h/t),this.camera.position.copy(e),this.controls&&this.controls.target.copy(r),this.camera.lookAt(r),this.camera.updateProjectionMatrix(),this.cameraPositionInit=!0},e.prototype.updateCamera=function(){this.camera.position.set(this.cameraX,this.cameraY,this.cameraZ);var t=new Lh(1,this.cameraRotX,this.cameraRotZ);t.makeSafe();var e=(new Wi).setFromSpherical(t),r=new Wi(e.z,e.x,e.y),i=Math.abs(r.z),n=i>.001?this.camera.position.z/i:100;r.multiplyScalar(n),this.look.copy(this.camera.position),this.look.add(r),this.controls&&this.controls.target.copy(this.look),this.camera.lookAt(this.look),this.camera.updateProjectionMatrix()},e.prototype.dispose=function(){this.active=!1},e.prototype.setup=function(t,e){return this.scene=t.scene,this.backgroundColor=t.backgroundColor,this._canvas=e,this.layerManager=t.layerManager,this},Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),e.prototype.init=function(){var t=this;window.cwindow=this,window.showStats=function(){t.showStats=!0,t.createStats()},this.width=this._canvas.offsetWidth,this.height=this._canvas.offsetHeight,this.renderer=new ks({antialias:!0,canvas:this._canvas,logarithmicDepthBuffer:!1}),this.renderer.setSize(this.width,this.height),this.renderer.setClearColor(this.backgroundColor,1),this.createCamera(),this.scene.add(this.camera),this.createOrbitControls(),this.showStats&&this.createStats(),this.run()},e.prototype.createCamera=function(){if(null==this.camera){this.camera=new ps(45,this.width/this.height,.3,this.farClippingDistance);var t=this.camera;t.position.set(150,-400,350),t.rotation.set(.85,.17,0),t.up.set(0,0,1)}},e.prototype.createStats=function(){this.stats=new Stats;var t=this.stats;t.domElement.style.position="absolute",t.domElement.style.top="0px",t.domElement.style.right="0px",t.domElement.style.zIndex=(parseInt(this._canvas.style.zIndex)+10).toString(),this.statsInfoElement=document.createElement("p"),this.statsInfoElement.style.fontFamily="Helvetica, Arial, sans-serif",this.statsInfoElement.style.fontSize="9px;",t.domElement.appendChild(this.statsInfoElement),this._canvas.parentElement.appendChild(t.domElement)},e.prototype.updateStats=function(){this.stats.update(),this.statsInfoElement.textContent=this.getPerformanceInfo()},e.prototype.updateSize=function(){var t=this._canvas.offsetWidth,e=this._canvas.offsetHeight;if(this.width!=t||this.height!=e){this.width=t,this.height=e;var r=this.camera;r.aspect=t/e,r.updateProjectionMatrix(),this.renderer.setSize(t,e)}},e.prototype.createOrbitControls=function(){var t=new Zd(this.camera,this.renderer.domElement);this.controls=t,t.enableDamping=!0,t.dampingFactor=.7,t.rotateSpeed=.7,t.autoRotate=!1,t.autoRotateSpeed=2,t.mouseButtons={ORBIT:oe.MIDDLE,PAN:oe.LEFT,ZOOM:-1},t.enablePan=!0,t.enableZoom=!0,t.enableKeys=this.navigationMode==e.NAVIGATION_FULL,t.enableRotate=this.navigationMode!=e.NAVIGATION_NONE,this.navigationMode!=e.NAVIGATION_ROTATION_ONLY&&this.navigationMode!=e.NAVIGATION_NONE||(t.enablePan=!1,t.enableZoom=!1),this.navigationMode==e.NAVIGATION_ABOVE_ZERO&&(t.maxPolarAngle=Math.PI/2),this.navigationMode==e.NAVIGATION_ROTATION_ONLY&&(t.mouseButtons={ORBIT:oe.LEFT,PAN:-1,ZOOM:-1})},e.prototype.render=function(){this.renderer.render(this.scene,this.camera)},e.prototype.run=function(){var t=this,e=window.performance.now();if(this.active){if(this.stats&&this.updateStats(),0!=this.smoothFrame&&(this.updateCameraSmooth(this.smoothFrame),this.smoothFrame--),this.renderActive){var r=this.layerManager.layers;0==r.size?this.render():(this.renderer.autoClear=!0,this.camera.layers.set(0),this.render(),this.renderer.autoClear=!1,r.forEach(function(e){t.camera.layers.set(e),t.render()}),this.renderer.autoClear=!0,this.camera.layers.set(0))}this.times[this.timesCnt]=window.performance.now()-e,this.timesCnt=(this.timesCnt+1)%this.times.length,window.requestAnimationFrame(this.runCallback)}},e.prototype.getRendererInfo=function(){var t=this.renderer.info;return"Renderer info: Geometries:"+t.memory.geometries+", Textures: "+t.memory.textures+", Programs: "+t.programs.length},e.prototype.getPerformanceInfo=function(){for(var t=this.times,e=0,r=0;r<t.length;r++)e+=t[r];e/=t.length;var i=Math.min(60,1e3/e);return"T:"+(e=Math.round(e))+" ms, fps:"+(i=Math.round(i))},e.prototype.getCameraData=function(){var t=this.camera.position.x,e=-this.camera.position.y,r=this.camera.position.z,i=new Wi;this.camera.getWorldDirection(i);var n=180*-Math.atan2(i.y,i.x)/Math.PI,a=[t,e,r,180*-Math.asin(i.z)/Math.PI,n];return"Camera:"+(a=a.map(function(t){return Wd.round(t,2)})).join(",")},e.NAVIGATION_FULL="WINDOW_3D_NAVIGATION_FULL",e.NAVIGATION_NONE="WINDOW_3D_NAVIGATION_NONE",e.NAVIGATION_ABOVE_ZERO="WINDOW_3D_NAVIGATION_LIMITED_TO_Z_ABOVE_ZERO",e.NAVIGATION_ROTATION_ONLY="WINDOW_3D_NAVIGATION_ROTATION_ONLY",e.DEFAULT_COLOR=new xn(11184810),e}(Yd),Qd=function(t){function e(e){var r=t.call(this,e)||this;return r._zHeight=0,r}return Gd(e,t),Object.defineProperty(e.prototype,"lineMesh",{get:function(){return null==this._lineMesh&&(this._lineMesh=this.createMesh()),this._lineMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineColor",{get:function(){return this._lineColor},set:function(t){this._lineColor=t,this.setDirty3D(Yd.DIRTY_3D_LINE_COLOR)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zHeight",{get:function(){return this._zHeight},set:function(t){this._zHeight=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.create3D=function(){t.prototype.create3D.call(this)},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"stroke"!==e&&"color"!==e||(this.lineColor="none"===r?null:Ud.parseRGB(r)),"stroke-width"===e&&(this.lineWidth=parseFloat(r)),"3d-z-height"!==e&&"zHeight"!==e||(this.zHeight=parseFloat(r))},e.prototype.update3D=function(){t.prototype.update3D.call(this),null!=this.lineColor&&this.isDirty3DSet(Yd.DIRTY_3D_LINE_COLOR)&&this.lineColor.applyToMaterial(this.lineMesh)},e.prototype.dispose=function(){null!=this._lineMesh&&(this.element.remove(this.lineMesh),Wd.disposeMesh(this.lineMesh),this._lineMesh=null),this.lineColor=null,t.prototype.dispose.call(this)},e}(Yd),Jd=function(t){function e(e){return t.call(this,e)||this}return Gd(e,t),Object.defineProperty(e.prototype,"fillMesh",{get:function(){return null==this._fillMesh&&(this._fillMesh=this.createMesh()),this._fillMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillColor",{get:function(){return this._fillColor},set:function(t){this._fillColor=t,this.setDirty3D(Yd.DIRTY_3D_FILL_COLOR)},enumerable:!0,configurable:!0}),e.prototype.create3D=function(){t.prototype.create3D.call(this)},e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"fill"===e)switch(r){case"none":this.fillColor=null;break;case"solid":case"hatching":this.fillColor=this.lineColor;break;default:this.fillColor=Ud.parseRGB(r)}},e.prototype.update3D=function(){t.prototype.update3D.call(this),null!=this.fillColor&&this.isDirty3DSet(Yd.DIRTY_3D_FILL_COLOR)&&this.fillColor.applyToMaterial(this.fillMesh)},e.prototype.dispose=function(){null!=this._fillMesh&&(this.element.remove(this.fillMesh),Wd.disposeMesh(this.fillMesh),this._fillMesh=null),this.fillColor=null,t.prototype.dispose.call(this)},e}(Qd),$d=function(){function t(){}return t.prototype.fillPlanes=function(t,e,r,i){},t.prototype.getPoints=function(){return[]},t.prototype.getEnd=function(){return null},t.prototype.getStart=function(){return null},t.prototype.getCap=function(t,e,r){return[]},t.prototype.shiftZ=function(t){},t.prototype.translate=function(t,e,r){},t.prototype.length=function(){return 0},t.prototype.getPoint=function(t){return this.getStart()},t.prototype.getNormal=function(t){return new Wi(1,0,0)},t.prototype.getShifted=function(t){return this},t.prototype.getCut=function(t,e){return this},t.prototype.clone=function(){return this},t}(),tp=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.x=0,e.y=0,e.z1=0,e.z2=0,e.rx=0,e.ry=0,e.startAngle=0,e.arcAngle=-Wd.TAU,e.autoFacecount=!0,e.faceCount=30,e}return Gd(e,t),Object.defineProperty(e,"ARC",{get:function(){return this._arc||(this._arc=new e),this._arc},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.x=this.y=this.z2=this.z1=this.rx=this.ry=this.startAngle=0,this.arcAngle=-Wd.TAU,this.autoFacecount=!0,this.faceCount=30},e.prototype.setup=function(t){this.x=this.y=this.z1=0,this.rx=t.rx,this.ry=t.ry,this.arcAngle=t.arcAngle,this.startAngle=t.startAngle,this.z2=t.dz},e.prototype.fillPlanes=function(t,e,r,i){this.addPlanes(t,e,!1,r,i)},e.prototype.addPlanes=function(t,e,r,i,n){var a=e.intersection(Hd.SIDES),o=e.intersection(Hd.BACK),s=e.intersection(Hd.FRONT);Wd.isZeroDouble(Math.abs(this.arcAngle)-Wd.TAU)&&(s=o=Hd.none);var l=this.autoFacecount?Wd.getFaceCount(Math.max(this.rx,this.ry)+n,this.arcAngle,this.z1-this.z2,3,4,32,!1):this.faceCount,u=this.arcAngle/l,c=(this.z2-this.z1)/l,h=this.rx+n,d=this.rx-n,p=this.ry+n,f=this.ry-n;d=Math.max(0,d),f=Math.max(0,f),r&&(h=d,p=f,d=0,f=0);for(var m=0;m<l;m++){var g=this.z1+c*m,b=g+c,v=this.startAngle+u*m;zd.BOX.setupArc(h,p,d,f,i,v,u,this.x,this.y,g,b),zd.BOX.addPlanes(t,a),0==m&&zd.BOX.addPlanes(t,o),m==l-1&&zd.BOX.addPlanes(t,s)}},e.prototype.getPoints=function(){var t=[];if(!Wd.isZeroDouble(this.rx*this.arcAngle))for(var e=this.faceCount,r=0;r<e;r++){var i=r/e,n=this.getRelativePoint(i);t.push(n)}return t},e.prototype.getRelativePoint=function(t){var e=this.startAngle+t*this.arcAngle;return new Wi(this.rx*Math.cos(e)+this.x,this.ry*Math.sin(e)+this.y,this.z1+t*(this.z2-this.z1))},e.prototype.getPoint=function(t){var e=this.length();return this.getRelativePoint(t/e)},e.prototype.getNormal=function(t){var e=this.length(),r=t,i=t+.001;i>e&&(r=(i=e)-.001);var n=this.getPoint(r),a=this.getPoint(i);return Wd.getNormal(n,a)},e.prototype.getArcPoint=function(t,e){return new Wi(this.rx*Math.cos(t)+this.x,this.ry*Math.sin(t)+this.y,e)},e.prototype.getEnd=function(){return this.getArcPoint(this.startAngle+this.arcAngle,this.z2)},e.prototype.getStart=function(){return this.getArcPoint(this.startAngle,this.z1)},e.prototype.shiftZ=function(t){this.z1+=t,this.z2+=t},e.prototype.translate=function(t,e,r){this.x+=t,this.y+=e,this.z1+=r,this.z2+=r},e.prototype.getCap=function(t,e,r){var i=this.z2-this.z1,n=.001*this.arcAngle,a=this.startAngle,o=this.z1;t||(a=this.startAngle+.999*this.arcAngle,o=this.z1+.999*i);var s=o+.001*i,l=this.rx+r,u=this.rx-r,c=this.ry+r,h=this.ry-r;u=Math.max(0,u),h=Math.max(0,h),zd.BOX.setupArc(l,c,u,h,e,a,n,this.x,this.y,o,s);var d=zd.BOX;return t?[d.backNormal.clone(),d.l1.clone(),d.r1.clone()]:[d.frontNormal.clone(),d.l2.clone(),d.r2.clone()]},e.prototype.length=function(){var t=(this.rx+this.ry)/2*Math.abs(this.arcAngle);return Math.hypot(t,this.z2-this.z1)},e.prototype.clone=function(){var t=new e;for(var r in t)t[r]=this[r];return t},e.prototype.getShifted=function(t){this.arcAngle>0&&(t*=-1);var e=this.clone();return e.rx=Math.max(0,e.rx+t),e.ry=Math.max(0,e.ry+t),e},e.prototype.getCut=function(t,e){var r=this.length();t>=r?(e=0,t=r):t+e>r&&(e=r-t);var i=this.clone();if(!Wd.isZeroDouble(r)){var n=t/r,a=e/r,o=this.z2-this.z1;i.z1=this.z1+n*o,i.z2=this.z1+(n+a)*o,i.startAngle+=this.arcAngle*n,i.arcAngle=this.arcAngle*a}return i},e}($d),ep=function(t){function e(e){var r=t.call(this,e)||this;return r._rx=0,r._ry=0,r._dz=0,r._startAngle=0,r._arcAngle=0,r}return Gd(e,t),Object.defineProperty(e.prototype,"dz",{get:function(){return this._dz},set:function(t){this._dz=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startAngle",{get:function(){return this._startAngle},set:function(t){this._startAngle=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arcAngle",{get:function(){return this._arcAngle},set:function(t){this._arcAngle=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rx",{get:function(){return this._rx},set:function(t){this._rx=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ry",{get:function(){return this._ry},set:function(t){this._ry=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"3d-dz"===e&&(this.dz=parseFloat(r)),"3d-arc"===e){var i=[];r.split(",").forEach(function(t){return i.push(parseFloat(t))}),this.rx=i[0],this.ry=i[1],this.startAngle=i[2],this.arcAngle=i[3],Math.abs(this.arcAngle)>Wd.TAU+1e-10&&(this.arcAngle=this.arcAngle%Wd.TAU)}},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var e=Hd.of(Hd.ALL);if(null!=this.lineColor){var r=new Yn;this.lineMesh.geometry=r,this.lineMesh.matrixWorldNeedsUpdate=!0,tp.ARC.setup(this),tp.ARC.addPlanes(r,e,!1,this.zHeight,this.lineWidth/2),Wd.calculateTextureUVS(r)}if(null!=this.fillColor){var i=new Yn;this.fillMesh.geometry=i,this.fillMesh.matrixWorldNeedsUpdate=!0,tp.ARC.setup(this),tp.ARC.addPlanes(i,e,!0,this.zHeight,this.lineWidth/2),Wd.calculateTextureUVS(i)}}},e}(Jd),rp=function(t){function e(){return t.call(this)||this}return Gd(e,t),e.prototype.setup=function(t,e){return this.start=t,this.end=e,this},e.prototype.fillPlanes=function(t,e,r,i){zd.BOX.setupStraitSegment(this.start,this.end,r,i),zd.BOX.addPlanes(t,e)},e.prototype.fillCylinder=function(t,e,r){e.setup(this.start,this.end,e.radius),e.fillPlanes(t,r)},e.prototype.getPoints=function(){var t=[];return t.push(this.start.clone()),t},e.prototype.getCap=function(t,e,r){var i=zd.BOX;return zd.BOX.setupStraitSegment(this.start,this.end,e,r),t?[i.backNormal.clone(),i.l1.clone(),i.r1.clone()]:[i.frontNormal.clone(),i.l2.clone(),i.r2.clone()]},e.prototype.getEnd=function(){return this.end.clone()},e.prototype.getStart=function(){return this.start.clone()},e.prototype.shiftZ=function(t){this.start.z+=t,this.end.z+=t},e.prototype.translate=function(t,e,r){this.start.x+=t,this.start.y+=e,this.start.z+=r,this.end.x+=t,this.end.y+=e,this.end.z+=r},e.prototype.length=function(){return this.start.distanceTo(this.end)},e.prototype.getPoint=function(t){var e=Wd.getNormal(this.start,this.end),r=new Wi;return r.copy(this.start),Wd.translateScaled(r,e,t)},e.prototype.getNormal=function(t){return Wd.getNormal(this.start,this.end)},e.prototype.clone=function(){var t=new e,r=this.start.clone(),i=this.end.clone();return t.setup(r,i),t},e.prototype.getShifted=function(t){var e=this.clone(),r=Wd.getLeftNormal(this.start,this.end);return Wd.translateScaled(e.start,r,t),Wd.translateScaled(e.end,r,t),e},e.prototype.getCut=function(t,r){t=Math.max(0,t);var i=this.length(),n=Math.min(t,i),a=Math.min(t+r,i),o=new e;return o.setup(this.getPoint(n),this.getPoint(a)),o},e}($d),ip=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.joinType=1,e.closed=!1,e.planes=Hd.all,e.zHeight=0,e.halfWidth=0,e.segments=[],e.dzFill=0,e.continuous=!0,e}return Gd(e,t),e.prototype.fillPlanes=function(t){var r=this.planes,i=r.intersection(Hd.SIDES),n=this.segments.length;if(0!=n){for(var a=0;a<n;a++){this.segments[a].fillPlanes(t,i,this.zHeight,this.halfWidth)}r.contains(Hd.BACK)&&this.segments[0].fillPlanes(t,r.intersection(Hd.BACK),this.zHeight,this.halfWidth),r.contains(Hd.FRONT)&&this.segments[n-1].fillPlanes(t,r.intersection(Hd.FRONT),this.zHeight,this.halfWidth);var o=0;this.joinType!=e.JOIN_NONE&&this.continuous&&(o=this.closed?n:n-1);for(a=0;a<o;a++){var s=this.segments[a],l=this.segments[(a+1)%n];this.addJoin(s,l,t)}}},e.prototype.parseSegments=function(t){var e=this;return this.segments=[],t.split(":").forEach(function(t){var r=Wd.parseParamList(t).map(Number),i=null;if(6==r.length){var n=new rp;i=n,n.start=new Wi(r[0],r[1],r[2]),n.end=new Wi(r[3],r[4],r[5])}else{var a=new tp;i=a,a.x=r[0],a.y=r[1],a.rx=a.ry=r[2],a.z1=r[3],a.z2=r[4],a.startAngle=r[5],a.arcAngle=r[6]}e.segments.push(i)}),this},e.prototype.addJoin=function(t,e,r){var i=t.getCap(!1,this.zHeight,this.halfWidth),n=(i[0],i[1]),a=i[2],o=e.getCap(!0,this.zHeight,this.halfWidth),s=(o[0],o[1]),l=o[2],u=new Wi;u.copy(n),u.add(a),u.multiplyScalar(.5),Wd.isRightOriented(u,a,l)?zd.BOX.setupTrianglePrism(l,a,u,this.zHeight):zd.BOX.setupTrianglePrism(n,s,u,this.zHeight),zd.BOX.addPlanes(r,Hd.sides)},e.prototype.fillInner=function(t){if(this.planes.contains(Hd.SIDES)){var e=[];this.segments.forEach(function(t){return e.push.apply(e,t.getPoints())});var r=null;if(!this.closed){var i=this.segments[this.segments.length-1].getEnd(),n=this.segments[0].getStart();r=(new rp).setup(i,n),e.push(i)}for(var a=e.length,o=0,s=0;s<a;s++){var l=e[s];o+=((v=e[(s+1)%a]).x-l.x)*(v.y+l.y)}o=-o;for(var u=new Set,c=new Wi,h=new Wi,d=new Wi,p=!0,f=[];e.length>2;){a=e.length,u.clear();var m=p?a-2:a-1,g=!1;for(s=0;s<a&&!g;s++){var b=s+m,v=(l=e[b%a],e[(b+1)%a]),y=e[(b+2)%a];if(!u.has(l)){var A=Wd.cross2D(l,v,y);c.crossVectors(Wd.getNormal(l,v,h),Wd.getNormal(l,y,d)),Wd.isZeroDouble(c.length())?Wd.dot2D(l,v,y)<=0&&(u.add(l),p=!p):Math.sign(A)==Math.sign(o)&&this.isTriangleEmpty(e,l,v,y)&&(u.add(v),o>0?f.push([l,v,y]):f.push([l,y,v]),p=!p,g=!0)}}if(u.forEach(function(t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}),a==e.length){console.error("CurverLine: ERROR: n = ",a);break}}var T=this.dzFill,C=this.zHeight+T,S=0;if(this.planes.contains(Hd.TOP))for(var E=0,w=f;E<w.length;E++){var k=w[E];for(s=0;s<k.length;s++){(I=k[s].clone()).z+=C,t.vertices.push(I)}var x=new Pn(3*S,3*S+1,3*S+2,_=Wd.getPlaneNormal(new Wi,k));t.faces.push(x),S++}if(this.planes.contains(Hd.BOTTOM))for(var M=0,O=f;M<O.length;M++){for(k=O[M],s=0;s<k.length;s++){var I;(I=k[s].clone()).z-=T,t.vertices.push(I)}var _;(_=Wd.getPlaneNormal(new Wi,k)).multiplyScalar(-1);x=new Pn(3*S,3*S+2,3*S+1,_);t.faces.push(x),S++}var L=this.planes.intersection(Hd.LEFT|Hd.RIGHT);this.segments.forEach(function(e){return e.fillPlanes(t,L,C,0)}),null!=r&&r.fillPlanes(t,L,C,0)}},e.prototype.isTriangleEmpty=function(t,e,r,i){for(var n=0,a=t;n<a.length;n++){var o=a[n];if(o!=e&&o!=r&&o!=i&&this.triangleContains(e,r,i,o))return!1}return!0},e.prototype.triangleContains=function(t,e,r,i){var n=Wd.cross2D(t,e,i),a=Wd.cross2D(e,r,i),o=Wd.cross2D(r,t,i);return n>=0&&a>=0&&o>=0||n<=0&&a<=0&&o<=0},e.prototype.length=function(){var t=0;return this.segments.forEach(function(e){return t+=e.length()}),t},e.prototype.getPoint=function(t){for(var e=0,r=0;r<this.segments.length;r++){var i=this.segments[r],n=i.length();if(e+n>=t)return i.getPoint(t-e);e+=n}return this.getEnd()},e.prototype.getEnd=function(){return this.segments[this.segments.length-1].getEnd()},e.prototype.getNormal=function(t){for(var e=0,r=0;r<this.segments.length;r++){var i=this.segments[r],n=i.length();if(e+n>=t)return i.getNormal(t-e);e+=n}var a=this.segments[this.segments.length-1];return a.getNormal(a.length())},e.prototype.getHeadLength=function(t){for(var e=0,r=0;r<t;r++)e+=this.segments[r].length();return e},e.prototype.findSegment=function(t){for(var e=0,r=0;r<this.segments.length;r++){var i=this.segments[r].length();if(e+i>=t)return r;e+=i}return this.segments.length-1},e.prototype.shiftZ=function(t){this.segments.forEach(function(e){return e.shiftZ(t)})},e.prototype.translate=function(t,e,r){this.segments.forEach(function(i){return i.translate(t,e,r)})},e.prototype.clone=function(){var t=new e;for(var r in t)t[r]=this[r];return t},e.prototype.cloneSegments=function(t){var e=this;this.segments=[],t.segments.forEach(function(t){return e.segments.push(t.clone())})},e.prototype.getShifted=function(t){var e=this.clone();return e.segments=[],this.segments.forEach(function(r){return e.segments.push(r.getShifted(t))}),e},e.prototype.getCut=function(t,e){var r=this.clone();r.segments=[];var i=this.length();if(0==this.segments.length||Wd.greaterEqualsDouble(t,i))return r;for(var n=Math.min(i,t+e),a=0,o=!1,s=this.segments.length-1,l=0,u=0;u<this.segments.length;u++){var c=this.segments[u],h=l+c.length();Wd.greaterDouble(h,t)&&!o&&(a=u,o=!0),Wd.greaterDouble(n,l)&&(s=u),l+=c.length()}var d=0;for(u=a;u<=s;u++)d+=this.segments[u].length();var p=0;for(u=0;u<=a-1;u++)p+=this.segments[u].length();var f=t-p,m=this.segments[s].length()-(p+d-n);for(u=a;u<=s;u++)r.segments.push(this.segments[u].clone());var g=r.segments.length;if(g>0){var b=r.segments[g-1];r.segments[g-1]=b.getCut(0,m);var v=r.segments[0];r.segments[0]=v.getCut(f,v.length()-f)}return r},e.JOIN_NONE=0,e.JOIN_MITER=1,e.JOIN_BEVEL=2,e}($d),np=function(){function t(){this.faceCount=30,this.radius=0,this.startAngle=0,this.start=new Wi,this.end=new Wi,this.direction=new Wi,this.directionOposite=new Wi,this.v=new Wi,this.u=new Wi,this.u1=new Wi,this.v1=new Wi,this.l1=new Wi,this.l2=new Wi,this.r1=new Wi,this.r2=new Wi,this.normalLeft1=new Wi,this.normalRight1=new Wi,this.normalLeft2=new Wi,this.normalRight2=new Wi}return t.prototype.setup=function(t,e,r){this.radius=r,this.start.copy(t),this.end.copy(e),Wd.getNormal(this.start,this.end,this.direction);var i=this.u,n=this.v,a=this.u1,o=this.v1,s=this.direction,l=this.directionOposite;if(Wd.isZeroDouble(this.direction.length()))i.set(0,0,0),n.copy(i),a.copy(i),o.copy(i);else{l.copy(s),l.multiplyScalar(-1);var u=Math.acos(s.z),c=Math.atan2(s.y,s.x),h=Math.cos(c),d=Math.cos(u),p=Math.sin(c),f=Math.sin(u);i.set(h*d,p*d,-f),n.set(-p,h,0),a.copy(i),o.copy(n)}},t.prototype.setupTorSegment=function(t,e,r,i){this.radius=i,this.start.copy(t),this.end.copy(e),Wd.getNormal(this.start,this.end,this.direction),this.directionOposite.copy(this.direction),this.directionOposite.multiplyScalar(-1),Wd.getNormal(this.start,r,this.u),Wd.getNormal(this.end,r,this.u1),this.v.crossVectors(this.direction,this.u),Wd.normalize(this.v),this.v1.crossVectors(this.direction,this.u1),Wd.normalize(this.v1)},t.calcRadiusVector=function(t,e,r,i){var n=Math.cos(i),a=Math.sin(i);return t.set(n*e.x+a*r.x,n*e.y+a*r.y,n*e.z+a*r.z),t},t.prototype.fillPlanes=function(e,r){var i=this;void 0===r&&(r=Hd.all);for(var n=this.u,a=this.v,o=this.u1,s=this.v1,l=this.normalRight1,u=this.normalRight2,c=this.normalLeft1,h=this.normalLeft2,d=0,p=Wd.TAU/this.faceCount,f=0;f<this.faceCount;f++){var m=this.startAngle+d;t.calcRadiusVector(c,n,a,m),t.calcRadiusVector(h,o,s,m),t.calcRadiusVector(l,n,a,m+p),t.calcRadiusVector(u,o,s,m+p),this.l1.copy(this.start),this.r1.copy(this.start),this.l2.copy(this.end),this.r2.copy(this.end),Wd.translateScaled(this.l1,c,this.radius),Wd.translateScaled(this.l2,h,this.radius),Wd.translateScaled(this.r1,l,this.radius),Wd.translateScaled(this.r2,u,this.radius),d+=p,r.contains(Hd.SIDES)&&(zd.addVerts(e,[this.l1,this.l2,this.r2,this.r1],[this.normalLeft1,h,this.normalRight2,this.normalRight1]),r.contains(Hd.DOUBLE_SIDE)&&([this.normalLeft1,this.normalLeft2,this.normalRight2,this.normalRight1].forEach(function(t){return t.multiplyScalar(-i.radius)}),zd.addVerts(e,[this.l2,this.l1,this.r1,this.r2],[this.normalLeft2,this.normalLeft1,this.normalRight1,this.normalRight2]))),r.contains(Hd.BACK)&&zd.addVerts(e,[this.start,this.l1,this.r1],[this.directionOposite]),r.contains(Hd.FRONT)&&zd.addVerts(e,[this.end,this.r2,this.l2],[this.direction])}},t}(),ap=function(){return function(t){this.index=0,this.offset=0,this.fraction=0,this.density=5;var e=t.split(" ");this.index=parseFloat(e[0]),this.offset=parseFloat(e[1]),this.fraction=parseFloat(e[2]);var r=e[3];this.color=null!=r&&"none"!=r?Ud.parseRGB(r):null,e.length>=5&&(this.density=parseFloat(e[4]))}}(),op=function(){function t(){this.updateBatches=!0,this.newbatches=0,this.batches=[]}return t.prototype.create3D=function(t){this.batchGroup=new hs,t.add(this.batchGroup)},t.prototype.updateParameter=function(t,e){"batch"===t&&this.batches.push(new ap(e)),"newbatches"===t&&(this.updateBatches=!0,this.newbatches=parseInt(e))},t.prototype.update3D=function(){var t=this;this.updateBatches&&(this.batchGroup.children.forEach(function(t){return Wd.disposeMesh(t)}),this.batchGroup.children=[],this.updateBatches=!1),this.batches.length>0&&(this.batches.forEach(function(e){if(null!=e.color){var r=new Yn,i=Wd.createMesh();i.geometry=r,t.batchGroup.add(i),e.color.applyToMaterial(i),t.updateBatch(e,r)}}),this.batches=[])},t.prototype.updateBatch=function(t,e){},t}(),sp=function(t){function e(r){var i=t.call(this,r)||this;return i.type=e.CONVEYOR_TYPE_BELT,i.width=0,i.color=Ud.GRAY,i.stripeColor=Ud.GRAY,i.offset=0,i.offsetChanged=!0,i.cellSize=-1,i.gapSize=-1,i.standsZ=0,i.standsEnabled=!1,i.batchHelper=new op,i.curve=new ip,i.cylinder=new np,i.testSpeeed=.1,i.testN=5e5,i.stripeGeometry=null,i.cylinders=[],i.setDirty3D(Yd.DIRTY_3D_LINE_COLOR),i}return Gd(e,t),e.prototype.create3D=function(){var e=this;t.prototype.create3D.call(this),this.lineMesh=this.createMesh(),this.stripeMesh=this.createMesh(),this.frameMesh=this.createMesh(),this.standsMesh=this.createMesh(),this.batchHelper.create3D(this.element),this.batchHelper.updateBatch=function(t,r){var i=e.curve.length(),n=e.batchCurve.getCut(t.offset*i,t.fraction*i);n.planes=Hd.all,n.zHeight=t.density,n.fillPlanes(r)}},e.prototype.testAnimate=function(){var t=this,e=function(){t.testN>0&&(t.testN--,t.offset+=t.testSpeeed,t.offsetChanged=!0,t.update3D(),setTimeout(e,16))};e()},e.prototype.updateParameter=function(e,r){var i;t.prototype.updateParameter.call(this,e,r),this.batchHelper.updateParameter(e,r),"color"!==e&&"stroke"!==e||(this.color="none"===r?null:Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_LINE_COLOR)),"width"!==e&&"stroke-width"!==e||(this.width=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-d"==e&&(this.curve.parseSegments(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-type"==e&&(this.type=r,this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-offset"===e&&(this.offset=parseFloat(r),this.offsetChanged=!0),"stroke-dasharray"===e&&(i=r.split(" ").map(function(t){return parseFloat(t)}),this.gapSize=i[0],this.cellSize=i[1]),"3d-stands-z"===e&&(this.standsZ=parseInt(r),this.standsEnabled=!0,this.setDirty3D(Yd.DIRTY_3D_SHAPE))},e.prototype.createStands=function(t,e,r,i){var n=this.standsMesh.geometry,a=this.curve.length(),o=0;this.standsEnabled&&(i?e=a/((o=Math.max(2,Math.round(a/e)+1))-1):o=Math.floor(a/e)+2);for(var s=0;s<o;s++){var l=s*e,u=this.curve.getPoint(l),c=this.curve.getNormal(l).clone(),h=new Wi(0,0,1);c.set(-c.y,c.x,0),c.normalize();var d=(new Wi).copy(u),p=(new Wi).copy(u);Wd.translateScaled(d,c,t),Wd.translateScaled(p,c,-t);var f=u.z-this.standsZ;f>0&&(Wd.translateScaled(d,h,-f/2),Wd.translateScaled(p,h,-f/2),zd.BOX.setupParallel(d,c,h,r,r,f),zd.BOX.addPlanes(n),zd.BOX.setupParallel(p,c,h,r,r,f),zd.BOX.addPlanes(n),i&&(Wd.translateScaled(d,c,r/2),Wd.translateScaled(p,c,-r/2),d.z+=f/2,p.z+=f/2,zd.BOX.setupStraitSegment(p,d,r,r/2),zd.BOX.addPlanes(n)))}},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),null!=this.color){switch(this.isDirty3DSet(Yd.DIRTY_3D_LINE_COLOR)&&(this.stripeColor=Wd.getDistincColor(this.color),this.color.applyToMaterial(this.lineMesh),this.stripeColor.applyToMaterial(this.stripeMesh),this.stripeColor.applyToMaterial(this.frameMesh),Ud.GRAY.applyToMaterial(this.standsMesh)),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)&&(this.batchCurve=this.curve.clone(),this.batchCurve.cloneSegments(this.curve),this.batchCurve.halfWidth=.6*this.width/2,this.batchCurve.zHeight=5,this.batchCurve.planes=Hd.all,this.lineMesh.geometry=new Yn,this.frameMesh.geometry=new Yn,this.standsMesh.geometry=new Yn),this.type){case e.CONVEYOR_TYPE_BELT:case e.CONVEYOR_TYPE_CELL:case e.CONVEYOR_TYPE_ROLLER:this.updateFlatConveyor();break;case e.CONVEYOR_TYPE_MONORAIL:this.updateMonorailConveyor()}this.batchHelper.update3D()}},e.prototype.updateMonorailConveyor=function(){var t,e=this.width/6,r=2*e,i=1.2*r;if(this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var n=this.lineMesh.geometry,a=e/6,o=a,s=1.5*e-2*o;this.curve.shiftZ(i+0),this.curve.zHeight=o,this.curve.halfWidth=e/2,this.curve.fillPlanes(n),this.curve.shiftZ(o),this.curve.zHeight=s,this.curve.halfWidth=a/2,this.curve.fillPlanes(n),this.curve.shiftZ(s),this.curve.zHeight=o,this.curve.halfWidth=e/2,this.curve.fillPlanes(n);var l=this.width/2;this.createStands(l,4*this.width,this.width/20,!0),this.curve.shiftZ(-s-o)}if(this.offsetChanged){this.offsetChanged=!1,Wd.disposeGeometry(this.stripeMesh.geometry);var u=new Yn;this.stripeMesh.geometry=u;var c=1.5*e,h=this.width,d=this.curve.length();h=this.gapSize+this.cellSize,2*(c=this.gapSize/3);for(var p=Math.floor(this.curve.length()/h)+1,f=(Math.max(0,this.gapSize/2),new Wi),m=new Wi,g=new Wi,b=new Wi,v=new Wi,y=new Wi,A=new Wi,T=.4*i,C=e/4,S=new Wi,E=0;E<p;E++){var w=this.offset%h-h/2+E*h;if(w<=d-c/2){var k=this.curve.getPoint(w),x=this.curve.getNormal(w);S.set(0,0,1),Wd.translateScaled(S,x,.001),Wd.normalize(S),t=[-x.y,x.x],x.x=t[0],x.y=t[1],f.copy(k),m.copy(k),v.copy(k),Wd.translateScaled(f,x,-r/2),Wd.translateScaled(m,x,r/2),g.copy(f),b.copy(m),Wd.translateScaled(g,S,-i),Wd.translateScaled(b,S,-i),Wd.translateScaled(f,S,-T),Wd.translateScaled(m,S,-T),Wd.translateScaled(v,S,-T),y.copy(f),A.copy(m),Wd.translateScaled(y,x,-C/2),Wd.translateScaled(A,x,C/2),Wd.addBulks(u,[k,v,y,A,f,g,m,b],C)}}}},e.prototype.updateFlatConveyor=function(){var t=this.lineMesh.geometry,r=this.frameMesh.geometry,i=this.type!=e.CONVEYOR_TYPE_ROLLER,n=this.type==e.CONVEYOR_TYPE_ROLLER,a=this.curve.length(),o=this.width/8,s=o/10,l=this.width/2,u=n?1.5*o:this.width,c=Math.max(Math.round(a/u)+1,2),h=u*(n?4:2),d=Math.max(Math.round(a/h)+1,2),p=this.cylinder;if(p.faceCount=8,this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){this.curve.shiftZ(-o/2),this.rollerCurve=this.curve.clone(),this.rollerCurve.cloneSegments(this.curve);for(var f=new Wi,m=new Wi,g=0;g<c;g++){var b=g==c-1?a:g*u,v=this.curve.getPoint(b);(U=this.curve.getNormal(b).clone()).set(-U.y,U.x,0),U.normalize(),f.copy(v),m.copy(v),Wd.translateScaled(f,U,l),Wd.translateScaled(m,U,-l),p.setup(f,m,o/2),p.fillPlanes(t,Hd.all)}if(this.createStands(l,2*this.width,this.width/20,!1),!i){this.curve.shiftZ(-this.curve.zHeight/2-s/2),this.curve.zHeight=s,this.curve.halfWidth=s/2;var y=this.curve.getShifted(l),A=this.curve.getShifted(-l);y.fillPlanes(r),A.fillPlanes(r),this.curve.shiftZ(this.curve.zHeight/2+s/2)}i&&(this.curve.shiftZ(o/2-s),this.curve.halfWidth=this.width/2,this.curve.zHeight=s,this.curve.fillPlanes(t),this.curve.shiftZ(-o+s),this.curve.fillPlanes(t),this.curve.shiftZ(o-s)),Wd.calculateTextureUVS(t)}if(this.offsetChanged&&!window.cancelOffset){this.offsetChanged=!1;var T=!0;if(null==this.stripeGeometry){Wd.disposeGeometry(this.stripeMesh.geometry);var C=new Yn;this.stripeMesh.geometry=C,this.stripeGeometry=C,T=!1}var S=0,E=void 0,w=Hd.all.getFaceCount();if(i){var k=this.width/2+.1,x=this.width/2,M=2*s,O=s+.1;if(this.type==e.CONVEYOR_TYPE_CELL)x=this.gapSize+this.cellSize,O=2*(M=this.gapSize/3);S=Math.floor(this.curve.length()/x)+1;var I=Math.max(0,this.gapSize/2);for(g=0;g<S;g++){E=T?g*w:null,(b=this.offset%x+I+g*x)<=a?this.drawStroke(b,M,O,k,E):this.drawStroke(a,0,0,0,E)}}var _=o/2,L=.8*o,P=(f=new Wi,m=new Wi,new Wi),R=_*Wd.TAU,F=-(this.offset%R)/R*Wd.TAU,D=Hd.of(Hd.FRONT|Hd.BACK),N=D.getFaceCount(),B=new Wi;for(g=0;g<d;g++){b=g==d-1?a:g*h;var G=this.cylinders[g];if(null==G){var U;v=this.rollerCurve.getPoint(b);(U=this.rollerCurve.getNormal(b).clone()).set(-U.y,U.x,0),U.normalize(),f.copy(v),m.copy(v),Wd.translateScaled(f,U,l),Wd.translateScaled(m,U,-l),(G=new np).setup(f,m,_),this.cylinders[g]=G}var H=G.direction;B.copy(G.start),Wd.translateScaled(B,H,l),np.calcRadiusVector(P,G.u,G.v,F),E=T?g*N+S*w:null,zd.BOX.setupParallel(B,P,H,L,L/10,this.width+L/20),zd.BOX.addPlanes(this.stripeGeometry,D,E)}this.stripeGeometry.verticesNeedUpdate=!0,this.stripeGeometry.normalsNeedUpdate=!0}},e.prototype.drawStroke=function(t,e,r,i,n){var a=this.curve.getPoint(t),o=this.curve.getNormal(t),s=a.clone();Wd.translateScaled(s,o,e),zd.BOX.setupStraitSegment(a,s,r,i),zd.BOX.addPlanes(this.stripeGeometry,Hd.all,n)},e.CONVEYOR_TYPE_BELT="CONVEYOR_TYPE_BELT",e.CONVEYOR_TYPE_ROLLER="CONVEYOR_TYPE_ROLLER",e.CONVEYOR_TYPE_CELL="CONVEYOR_TYPE_CELL",e.CONVEYOR_TYPE_MONORAIL="CONVEYOR_TYPE_MONORAIL",e}(Yd),lp=function(){function t(){}return t.group="g",t.replicated="use",t.circle="circle",t.ellipse="ellipse",t.image="image",t.line="line",t.rect="rect",t.polygon="polygon",t.polyline="polyline",t.stopLine="MarkupStopLine",t.road="MarkupRoad",t.busStop="MarkupBusStop",t.parkingLot="MarkupParkingLot",t.intersection="MarkupIntersection",t.conveyorPath="MarkupConveyorPath",t.conveyorStation="MarkupConveyorStation",t.conveyorCustomStation="MarkupConveyorCustomStation",t.conveyorTurntable="MarkupConveyorTurntable",t.conveyorTurnStation="MarkupConveyorTurnStation",t.conveyorTransferTable="MarkupConveyorTransferTable",t.conveyorSplit="MarkupConveyorSplitMerge",t.palletRack="MarkupPalletRack",t.escalator="MarkupEscalatorGroup",t.serviceWithLines="MarkupServiceWithLines",t.towerCrane="MarkupTowerCrane",t.lift="MarkupLift",t.pathConveyor="MarkupPathConveyor",t.pathDashline="MarkupPathDashline",t.pathLine="MarkupPathLine",t.pathRailroad="MarkupPathRailroad",t.pathRoad="MarkupPathRoad",t.pathWall="MarkupPathWall",t.pipe="MarkupPipe",t.bulkConveyorBelt="MarkupBulkConveyorBelt",t.storageTank="MarkupStorageTank",t.pointNode="MarkupPointNode",t.polygonalNode="MarkupPolygonalNode",t.rectangularNode="MarkupRectangularNode",t.circularWall="MarkupCircularWall",t.rectangularWall="MarkupRectangularWall",t.shapeArc="ShapeArc",t.shapeImage="ShapeImage",t.shapeModelElementsGroup="ShapeModelElementsGroup",t.shapeText="ShapeText",t.light3D="Light3D",t.window3D="Window3D",t}(),up=function(t){function e(e){var r=t.call(this,e)||this;return r.markingCurve=new ip,r.fillingCurve=new ip,r.type="",r.radius=0,r.type=Wd.getShapeType(e),r.type!==lp.pathRailroad&&r.type!==lp.pathRoad&&r.type!==lp.pathConveyor||(r.lineColor=Ud.GRAY),r}return Gd(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"3d-d"!==e&&"3d-marking"!==e||(this.markingCurve.parseSegments(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-area"===e&&(this.fillingCurve.parseSegments(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-line-width"===e&&(this.lineWidth=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"radius"===e&&(this.radius=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var e=this.zHeight;this.fillingCurve.halfWidth=0,this.fillingCurve.zHeight=e,this.fillingCurve.shiftZ(-e),this.type===lp.conveyorStation&&(this.fillingCurve.dzFill=.01);var r=null;null!=this.fillColor&&(r=new Yn,this.fillMesh.geometry=r,this.fillingCurve.fillInner(r));var i=null;if(null!=this.lineColor&&0!=this.radius){var n=e+.2,a=e+.1;i=new Yn,this.lineMesh.geometry=i;var o=new tp;o.autoFacecount=!1,o.faceCount=40,o.shiftZ(-e),o.rx=o.ry=this.radius;o.addPlanes(i,Hd.all,!1,n,.5),null!=r&&o.addPlanes(r,Hd.all,!0,a,0)}this.type===lp.conveyorStation&&(this.lineWidth=1),null!=this.lineColor&&this.lineWidth>0&&(null==i&&(i=new Yn,this.lineMesh.geometry=i),this.markingCurve.halfWidth=this.lineWidth/2,this.markingCurve.zHeight=this.zHeight+.1,this.markingCurve.shiftZ(-e),this.markingCurve.closed=!0,this.markingCurve.fillPlanes(i)),null!=i&&Wd.calculateTextureUVS(i),null!=r&&Wd.calculateTextureUVS(r)}},e}(Jd),cp=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bigRadius=0,e.arcAngle=0,e}return Gd(e,t),e.prototype.setupPipe=function(t,e,r){return this.start=t,this.end=e,this.center=r,this.n1=Wd.getNormal(r,t),this.n2=Wd.getNormal(r,e),this.arcAngle=Math.acos(this.n1.dot(this.n2)),this.bigRadius=t.distanceTo(r),this.vertical=(new Wi).crossVectors(this.n1,this.n2),Wd.normalize(this.vertical),this.n1Ort=(new Wi).crossVectors(this.vertical,this.n1),Wd.normalize(this.n1Ort),this},e.prototype.fillCylinder=function(t,e,r){for(var i=0;i<20;i++){var n=this.torVector(i/20),a=this.torVector((i+1)/20),o=this.center.clone().add(n),s=this.center.clone().add(a);e.setupTorSegment(o,s,this.center,e.radius),e.fillPlanes(t,r)}e.startAngle=0},e.prototype.torVector=function(t){var e=np.calcRadiusVector(new Wi,this.n1,this.n1Ort,t*this.arcAngle);return e.multiplyScalar(this.bigRadius),e},e.prototype.length=function(){return this.bigRadius*this.arcAngle},e.prototype.getRatio=function(t){t=Math.max(0,t);var e=this.length();return 0==e?0:Math.min(1,t/e)},e.prototype.getPoint=function(t){var e=this.getRatio(t);return this.center.clone().add(this.torVector(e))},e.prototype.getNormal=function(t){var e=this.getRatio(t),r=this.torVector(e),i=(new Wi).crossVectors(r,this.vertical);return Wd.normalize(i)},e.prototype.clone=function(){var t=new e,r=this.start.clone(),i=this.end.clone(),n=this.center.clone();return t.setupPipe(r,i,n),t},e.prototype.getCut=function(t,r){var i=this.length(),n=Math.min(t,i),a=Math.min(t+r,i),o=new e;return o.setupPipe(this.getPoint(n),this.getPoint(a),this.center.clone()),o},e}(rp),hp=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.roundness=10,e.smallFaceCount=20,e}return Gd(e,t),e.prototype.parseSegments=function(t){var e=[];return t.split(":").forEach(function(t){var r=Wd.parseParamList(t).map(Number);if(6==r.length){var i=new rp;i.start=new Wi(r[0],r[1],r[2]),i.end=new Wi(r[3],r[4],r[5]),e.push(i)}}),this.convertSegments(e)},e.prototype.setupSegments=function(t){for(var e=[],r=t.length,i=0;i<r-1;i++){var n=t[i],a=t[i+1];e.push((new rp).setup(n,a))}return this.convertSegments(e)},e.prototype.convertSegments=function(t){var e=t.length;if(e<=1)return this.segments=t,this;for(var r=t[0].start,i=1;i<e;i++){var n=t[i-1],a=t[i],o=n.start,s=n.end,l=a.end,u=s.distanceTo(l),c=s.distanceTo(o),h=Math.min(c/2,Math.min(u/2,this.roundness)),d=Wd.getNormal(s,o),p=Wd.getNormal(s,l),f=d.dot(p);d.multiplyScalar(h),p.multiplyScalar(h);var m=new Wi;if(m.crossVectors(d,p),Wd.isZeroDouble(m.length()))Wd.isZeroDouble(u)||(this.segments.push((new rp).setup(r,s)),r=s);else{var g=.5*Math.acos(f),b=h/Math.cos(g);if(b<500){var v=s.clone();v.add(d);var y=s.clone().add(p),A=d.clone().add(p);Wd.normalize(A),A.multiplyScalar(b);var T=s.clone();T.add(A),this.segments.push((new rp).setup(r,v)),this.segments.push((new cp).setupPipe(v,y,T)),r=y}else this.segments.push((new rp).setup(r,s)),r=s}i==e-1&&this.segments.push((new rp).setup(r,l))}return this},e.prototype.fillPlanes=function(t){var e=this.segments.length;if(0!=e){var r=this.planes,i=new np;i.radius=this.halfWidth,i.faceCount=this.smallFaceCount;for(var n=0;n<e;n++){this.segments[n].fillCylinder(t,i,r)}}},e.prototype.clone=function(){var t=new e;for(var r in t)t[r]=this[r];return t},e}(ip),dp=function(){function t(t){this.crane=t}return t.prototype.createAnimation=function(){},t.prototype.createTroley=function(t,e,r){var i=new Yn;this.crane.trolleyMesh.geometry=i,Ud.GRAY.applyToMaterial(this.crane.trolleyMesh);var n=new Wi(-t,0,r),a=new Wi(t,0,r);zd.BOX.setupStraitSegment(n,a,e,t),zd.BOX.addPlanes(i)},t.prototype.createHook=function(){var t=this.crane.hookSize,e=new Yn;this.crane.hookBlockMesh.geometry=e,this.crane.craneColor.applyToMaterial(this.crane.hookBlockMesh);var r=new Wi(-t/2,0,0),i=new Wi(t/2,0,0);zd.BOX.setupStraitSegment(r,i,2*t,t/6),zd.BOX.TOP.forEach(function(t){return t.x*=2}),zd.BOX.addPlanes(e);var n=Ud.GRAY,a=new Yn;this.crane.hookMesh.geometry=a,n.applyToMaterial(this.crane.hookMesh);var o=new hp,s=t/1.5,l=[new Wi(0,0,s),new Wi(0,0,0),new Wi(-s,0,-s),new Wi(0,0,-2*s),new Wi(s/1.1,0,-s/1.1),new Wi(s/1.1,0,-s/1.1)];o.setupSegments(l),o.halfWidth=s/8,o.roundness=s,o.fillPlanes(a)},t}(),pp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Gd(e,t),e.prototype.createAnimation=function(){var t=this.crane.halfWidth-this.crane.beamBig/2,e=t/5;this.createMast(),this.createBase(),this.createJib(),this.createTroley(t,e,-e),this.createCabin(),this.createHook()},e.prototype.createMast=function(){var t=this.crane.halfWidth,e=this.crane.beamBig,r=this.crane.beamSmall,i=this.crane.cabinColor.isNull()?2*t:2*this.crane.cabinWidth,n=this.crane.height-i-e,a=new Yn;this.crane.mastMesh.geometry=a,this.crane.craneColor.applyToMaterial(this.crane.mastMesh);for(var o=Wd.DX,s=Wd.DY,l=new Wi(0,0,0),u=new Wi(0,0,n),c=0;c<o.length;c++){var h=o[c]*t,d=s[c]*t;l.set(h,d,0),u.copy(l),u.z=n,zd.BOX.setupBox(l,u,e,e,Wd.LEFT),zd.BOX.addPlanes(a,Hd.all)}var p=2*t,f=Math.round(n/p);p=n/f;for(var m=[],g=0;g<f;g++)for(c=0;c<o.length;c++){var b=o[c]*t,v=s[c]*t,y=g*p,A=g%2==0?1:3,T=o[(c+A)%4]*t,C=s[(c+A)%4]*t,S=y+p;m.push(new Wi(b,v,y)),m.push(new Wi(T,C,S)),m.push(new Wi(b,v,y)),m.push(new Wi(T,C,y))}Wd.addBulks(a,m,r);var E=new Wi(0,0,n);zd.BOX.setupParallel(E,Wd.RIGHT,Wd.FRONT,2*t,e,2*t),zd.BOX.addPlanes(a);var w=new np;w.setup(E,new Wi(0,0,this.crane.height),t),w.fillPlanes(a)},e.prototype.createJib=function(){var t=new Yn;this.crane.jibMesh.geometry=t,this.crane.craneColor.applyToMaterial(this.crane.jibMesh);var e=this.crane.jibLength+this.crane.halfWidth,r=e/2;this.crane.type===mp.TYPE_BIG?(this.addJibPart(t,-r,-this.crane.halfWidth),this.addJibPart(t,this.crane.halfWidth,e),this.addJibTop(t)):this.addJibPart(t,-r,e),this.addJibBox(t)},e.prototype.addJibBox=function(t){var e=this.crane.height,r=this.crane.halfWidth,i=this.crane.halfWidth;zd.BOX.setupParallel(new Wi(0,0,e-r/2),Wd.RIGHT,Wd.FRONT,2*i,r,2*i),zd.BOX.addPlanes(t)},e.prototype.addJibTop=function(t){var e=this.crane.height,r=this.crane.beamSmall,i=Wd.DX,n=Wd.DY,a=this.crane.halfWidth,o=new Wi,s=new Wi,l=9*a;o.set(0,0,e+l);for(var u=0;u<4;u++)s.set(i[u]*a,n[u]*a,e),zd.BOX.setupBox(o,s,r,r),zd.BOX.addPlanes(t);var c=this.crane.jibLength,h=c/2,d=1.5*this.crane.halfWidth,p=[new Wi(-h/2,0,e+d),o,new Wi(c/3,0,e+d),o,new Wi(2*c/3,0,e+d),o];Wd.addBulks(t,p,2*this.crane.cableRadius);for(var f=l/8,m=[],g=0;g<8;g++)for(u=0;u<i.length;u++){var b=1-g/8,v=1-(g+1)/8,y=i[u]*a*b,A=n[u]*a*b,T=e+g*f,C=g%2==0?1:3,S=i[(u+C)%4]*a*v,E=n[(u+C)%4]*a*v,w=T+f;m.push(new Wi(y,A,T)),m.push(new Wi(S,E,w))}Wd.addBulks(t,m,r/2)},e.prototype.addJibPart=function(t,e,r){var i=this.crane.halfWidth,n=this.crane.beamBig,a=this.crane.beamSmall,o=Wd.DX,s=Wd.DY,l=this.crane.height,u=new Wi(0,0,0),c=new Wi(0,0,0),h=r-e,d=2*i,p=Math.round(h/d);d=h/p;var f=1.5*i;u.set(e,i,l),c.set(r,i,l),zd.BOX.setupBox(u,c,n,n),zd.BOX.addPlanes(t),u.set(e,-i,l),c.set(r,-i,l),zd.BOX.setupBox(u,c,n,n),zd.BOX.addPlanes(t),u.set(e+d/2,0,l+f),c.set(r-d/2,0,l+f),zd.BOX.setupBox(u,c,n,n),zd.BOX.addPlanes(t);for(var m=new Wi,g=new Wi,b=0;b<p;b++){var v=e+d/2+b*d;m.set(v,0,l+f);for(var y=0;y<4;y++)g.set(v+o[y]*d/2,s[y]*i,l),zd.BOX.setupBox(m,g,a,a),zd.BOX.addPlanes(t,Hd.all)}for(b=0;b<p+1;b++){v=e+b*d;u.set(v,i,l),c.set(v,-i,l),zd.BOX.setupBox(u,c,a,a),zd.BOX.addPlanes(t,Hd.all)}},e.prototype.createCabin=function(){var t=this.crane.cabinWidth,e=t/2,r=1.6*t,i=1.9*t,n=2*t,a=t/20;this.crane.cabinMesh.position.set(-i/2,1.1*-(this.crane.halfWidth+e),this.crane.height-n),this.crane.element.remove(this.crane.cabinMesh);var o=new Yn;this.crane.cabinMesh.geometry=o,this.crane.cabinColor.applyToMaterial(this.crane.cabinMesh);var s=new Wi(r/2,0,0),l=new Wi(0,0,0),u=new Wi(0,0,n),c=new Wi(0,-e,n/2),h=new Wi(0,e,n/2),d=new Wi(r,0,0),p=new Wi(i,0,n),f=Wd.getPointOnLine(d,p,.5),m=Wd.getPointOnLine(d,p,.5);f.y=-e,m.y=e;var g=new zd;g.setupStraitSegment(l,d,n,e),g.l2t.x=i,g.r2t.x=i,g.addPlanes(o,Hd.of(Hd.TOP|Hd.BACK|Hd.BOTTOM|Hd.DOUBLE_SIDE));var b=new zd;b.setupStraitSegment(l,s,n,e),b.addPlanes(o,Hd.of(Hd.LEFT|Hd.RIGHT|Hd.DOUBLE_SIDE)),zd.BOX.setupBox(l,d,t+a,a,Wd.LEFT),zd.BOX.addPlanes(o),zd.BOX.setupBox(u,p,t+a,a,Wd.LEFT),zd.BOX.addPlanes(o);var v=[];v.push((new rp).setup(c,f)),v.push((new rp).setup(h,m)),v.push((new rp).setup(f,m)),v.push((new rp).setup(g.r2,g.r2t)),v.push((new rp).setup(g.l2,g.l2t)),v.forEach(function(t){zd.BOX.setupBox(t.start,t.end,a,a,Wd.LEFT),zd.BOX.addPlanes(o)})},e.prototype.createBase=function(){var t=new Yn;Ud.GRAY.applyToMaterial(this.crane.baseMesh),this.crane.baseMesh.geometry=t;for(var e=4*this.crane.halfWidth,r=e/8,i=new Wi,n=0;n<3;n++)i.set(0,0,1.2*r*n+r/2),zd.BOX.setupParallel(i,Wd.RIGHT,Wd.FRONT,e,r,e),zd.BOX.addPlanes(t)},e}(dp),fp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Gd(e,t),e.prototype.createAnimation=function(){this.crane.cabinMesh.visible=!1;var t=e.COEF_WIDTH*this.crane.halfWidth+this.crane.beamBig,r=2*t;this.createRoundMast(),this.createRoundBase(),this.createRailJib(),this.createTroley(t,r,-r/2),this.createHook()},e.prototype.createRoundBase=function(){var t=new Yn;Ud.GRAY.applyToMaterial(this.crane.baseMesh),this.crane.baseMesh.geometry=t;var e=2*this.crane.halfWidth,r=e/8,i=new Wi,n=new Wi(0,0,r),a=new np;a.setup(i,n,e),a.fillPlanes(t)},e.prototype.createRoundMast=function(){var t=new Yn;this.crane.craneColor.applyToMaterial(this.crane.mastMesh),this.crane.mastMesh.geometry=t;var r=this.crane.jibLength/5,i=new Wi,n=new Wi(0,0,this.crane.height+r),a=new np;a.setup(i,n,this.crane.halfWidth),a.fillPlanes(t),i.set(0,0,this.crane.height),n.set(0,0,this.crane.height+e.COEF_HEIGHT*this.crane.halfWidth),a.setup(i,n,this.crane.halfWidth+2*this.crane.beamBig),a.fillPlanes(t),n.set(0,0,this.crane.height+r-2*this.crane.beamBig),i.copy(n),i.z-=3*this.crane.beamBig,a.setup(i,n,this.crane.halfWidth+2*this.crane.beamBig),a.fillPlanes(t)},e.prototype.createRailJib=function(){var t=new Yn;this.crane.jibMesh.geometry=t,this.crane.craneColor.applyToMaterial(this.crane.jibMesh);var r=this.crane.jibLength+this.crane.halfWidth,i=r,n=e.COEF_WIDTH*this.crane.halfWidth,a=e.COEF_HEIGHT*this.crane.halfWidth,o=this.crane.beamBig,s=this.crane.height,l=new Wi(0,0,0),u=new Wi(0,0,0);l.set(0,0,s),u.set(i,0,s),zd.BOX.setupStraitSegment(l,u,o,n),zd.BOX.addPlanes(t),zd.BOX.setupStraitSegment(l,u,a,o/2),zd.BOX.addPlanes(t);var c=s+a-o;l.set(0,0,c),u.set(i,0,c),zd.BOX.setupStraitSegment(l,u,o,n),zd.BOX.addPlanes(t);var h=this.crane.jibLength/5;l.set(0,0,s+h-o),u.set(r/2,0,c),zd.BOX.setupBox(l,u,2*o,2*o),zd.BOX.addPlanes(t)},e.COEF_WIDTH=.6,e.COEF_HEIGHT=1.8,e}(dp),mp=function(t){function e(r){var i=t.call(this,r)||this;return i.craneColor=Ud.of(191,181,0),i.cabinColor=Ud.GRAY,i.type=e.TYPE_BIG,i.height=170,i.jibLength=110,i.halfWidth=10,i.hookSize=2,i.beamBig=1,i.beamSmall=.5,i.cableRadius=.1,i.cabinWidth=1.2*i.halfWidth,i.toPixels=10,i.jibAngle=0,i.hookOffset=i.jibLength/2,i.hookHeight=i.height/2,i.cableUpdated=!1,i}return Gd(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.mastMesh=this.createMesh(),this.jibMesh=this.createMesh(),this.hookMesh=this.createMesh(),this.hookBlockMesh=this.createMesh(),this.cableMesh=this.createMesh(),this.cabinMesh=this.createMesh(),this.trolleyMesh=this.createMesh(),this.baseMesh=this.createMesh(),this.jibMesh.add(this.cabinMesh),this.jibMesh.add(this.trolleyMesh),this.trolleyMesh.add(this.cableMesh),this.trolleyMesh.add(this.hookMesh),this.hookMesh.add(this.hookBlockMesh)},e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"jib-length"===e&&(this.jibLength=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"crane-height"===e&&(this.height=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"cabin-width"===e&&(this.cabinWidth=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"crane-width"===e&&(this.halfWidth=parseFloat(r)/2,this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"crane-color"===e&&(this.craneColor=Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"cabin-color"===e&&(this.cabinColor=Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-to-pixels"===e&&(this.toPixels=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"jib-angle"===e&&(this.jibAngle=-parseFloat(r)),"caret-distance"===e&&(this.hookOffset=parseFloat(r)),"hook-z"===e){var i=this.height-parseFloat(r);i!=this.hookHeight&&(this.hookHeight=i,this.cableUpdated=!1)}"3d-type"==e&&(this.type=r,this.setDirty3D(Yd.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var r=null;switch(this.type){case e.TYPE_BIG:case e.TYPE_MEDIUM:r=new pp(this);break;case e.TYPE_JIB:r=new fp(this)}this.hookSize=this.halfWidth/2,this.beamBig=this.halfWidth/8,this.beamSmall=this.beamBig/2,this.cableRadius=this.beamSmall/2,this.hookOffset=this.jibLength/2,this.hookHeight=this.height/2,r.createAnimation()}this.cableUpdated||this.updateCables(),this.jibMesh.rotation.z=this.jibAngle,this.trolleyMesh.position.set(this.hookOffset,0,this.height),this.hookMesh.position.set(0,0,-this.hookHeight)},e.prototype.testAnimate=function(){var t=this,e=0,r=400,i=.4,n=.5,a=.004,o=function(){e>10||(r>0?(r--,(t.hookHeight<30||t.hookHeight>t.height-20)&&(n*=-1),t.hookHeight+=n,t.cableUpdated=!1,t.updateCables(),t.hookMesh.position.z=-t.hookHeight,setTimeout(o,15)):(e++,r=400,Math.random()>.5&&(a*=-1),l()))},s=function(){r>100?(r--,t.trolleyMesh.position.x+=i,(t.trolleyMesh.position.x<20||t.trolleyMesh.position.x>100)&&(i*=-1),setTimeout(s,15)):o()},l=function(){r>200?(r--,t.jibMesh.rotation.z+=a,setTimeout(l,15)):s()};l()},e.prototype.updateCables=function(){var t=this.hookSize;Ud.GRAY.applyToMaterial(this.cableMesh),null==this.cable&&(this.cable=new np,this.cable.faceCount=4);var e=new Yn;this.cableMesh.geometry=e;var r=this.cable,i=new Wi(-t/2,0,0),n=new Wi(-t/2,0,-this.hookHeight);r.setup(i,n,this.cableRadius),r.fillPlanes(e),n.x+=t,i.x+=t,r.setup(i,n,this.cableRadius),r.fillPlanes(e),this.cableUpdated=!0},e.TYPE_BIG="JIB_CRANE_CAT_HEAD",e.TYPE_MEDIUM="JIB_CRANE_FLAT_TOP",e.TYPE_JIB="JIB_CRANE_INDUSTRIAL",e}(Yd),gp=function(t){function e(e){var r=t.call(this,e)||this;return r.number=0,r.length=100,r.width=20,r.leftBalustradeWidth=15,r.rightBalustradeWidth=15,r.internalBalustradeWidth=10,r.lowerLandingLength=15,r.upperLandingLength=15,r.solidBalustrade=!0,r.dimensionsCompleted=null,r.angle=.524,r.offsets=[],r.offsetChanged=!0,r.toPixels=10,r.uppperLevelZ=0,r.handholdWidth=0,r.handholdHeight=0,r.escalatorHeight=0,r.stepWidth=5,r.stairsCount=0,r.stairLength=0,r.stairHeight=0,r.start=new Wi,r.low=new Wi,r.high=new Wi,r.end=new Wi,r}return Gd(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.handholdMesh=this.createMesh(),this.sideMesh=this.createMesh(),this.balustradeMesh=this.createMesh(),this.stairMesh=this.createMesh()},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"number-of-escalators"===e&&(this.number=parseInt(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"length"===e&&(this.length=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"width"===e&&(this.width=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"left-balustrade-width"===e&&(this.leftBalustradeWidth=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"right-balustrade-width"===e&&(this.rightBalustradeWidth=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"internal-balustrade-width"===e&&(this.internalBalustradeWidth=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"lower-landing-length"===e&&(this.lowerLandingLength=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"upper-landing-length"===e&&(this.upperLandingLength=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"balustrade-color"===e&&(this.balustradeColor=Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"solid-balustrade"===e&&(this.solidBalustrade="true"==r,this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-angle"===e&&(this.angle=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"offsets"===e&&(this.offsets=r.split(" ").map(function(t){return parseFloat(t)}),this.offsetChanged=!0),"step-width"===e&&(this.stepWidth=parseFloat(r)),"3d-to-pixels"===e&&(this.toPixels=parseFloat(r))},e.prototype.update3D=function(){if((t.prototype.update3D.call(this),this.escalatorHeight=.9*this.toPixels,this.handholdWidth=.1*this.toPixels,this.handholdHeight=this.handholdWidth/3,this.uppperLevelZ=Math.tan(this.angle)*this.length,this.stairsCount=Math.floor(this.length/this.stepWidth),this.stairLength=this.length/this.stairsCount,this.stairHeight=this.uppperLevelZ/this.stairsCount,this.isDirty3DSet(Yd.DIRTY_3D_SHAPE))&&(Ud.BLACK.applyToMaterial(this.handholdMesh),Ud.GRAY.applyToMaterial(this.stairMesh),null!=this.balustradeColor&&this.balustradeColor.applyToMaterial(this.balustradeMesh),this.handholdMesh.geometry=new Yn,this.balustradeMesh.geometry=new Yn,this.solidBalustrade&&null!=this.balustradeColor)){var e=this.leftBalustradeWidth/2,r=this.width+this.internalBalustradeWidth,i=-((this.number-1)*r+this.width+this.rightBalustradeWidth/2);this.addSide(e,this.leftBalustradeWidth),this.addSide(i,this.rightBalustradeWidth);for(var n=0;n<this.number-1;n++){var a=-(n*r+this.width+this.internalBalustradeWidth/2);this.addSide(a,this.internalBalustradeWidth)}}this.offsetChanged&&(Wd.disposeGeometry(this.stairMesh.geometry),this.stairMesh.geometry=new Yn);for(n=0;n<this.number;n++)this.addEscalator(n);this.offsetChanged=!1},e.prototype.addHalfCircle=function(t,e,r,i,n,a,o,s){for(var l=new Wi,u=new Wi,c=Math.PI/20,h=e.clone(),d=e.clone(),p=e.clone(),f=e.clone(),m=[h,d,p,f],g=0;g<20;g++)m.forEach(function(t){return t.copy(e)}),np.calcRadiusVector(u,r,i,c*g),np.calcRadiusVector(l,r,i,c*(g+1)),Wd.translateScaled(h,u,a),Wd.translateScaled(d,l,a),Wd.translateScaled(p,u,o),Wd.translateScaled(f,l,o),m.forEach(function(t){return Wd.translateScaled(t,n,-s/2)}),zd.BOX.setupPrism(h,d,p,f,n,s),zd.BOX.addPlanes(t,Hd.sides)},e.prototype.addPart=function(t){var e=this.handholdMesh.geometry;this.setPoints(t,0);var r=new ip;r.segments=[(new rp).setup(this.start.clone(),this.low.clone()),(new rp).setup(this.low.clone(),this.high.clone()),(new rp).setup(this.high.clone(),this.end.clone())],r.halfWidth=this.handholdWidth/2,r.zHeight=this.handholdHeight,r.planes=Hd.all,r.fillPlanes(e),r.shiftZ(this.escalatorHeight-this.handholdHeight),r.fillPlanes(e);this.escalatorHeight,this.handholdHeight;var i=this.handholdWidth/3;r.translate(0,0,-this.escalatorHeight+2*this.handholdHeight),r.halfWidth=i/2,this.setPoints(t,this.escalatorHeight/2);var n=new Wi(0,0,1),a=new Wi(-1,0,0),o=new Wi(0,-1,0),s=this.handholdWidth,l=this.escalatorHeight/2-this.handholdHeight,u=this.escalatorHeight/2;this.addHalfCircle(e,this.start,n,a,o,l,u,s),a.negate(),o.negate(),this.addHalfCircle(e,this.end,n,a,o,l,u,s),this.addSide(t,i)},e.prototype.addSide=function(t,e){var r=this.balustradeMesh.geometry;this.setPoints(t,0);var i=new ip;i.segments=[(new rp).setup(this.start.clone(),this.low.clone()),(new rp).setup(this.low.clone(),this.high.clone()),(new rp).setup(this.high.clone(),this.end.clone())],i.halfWidth=this.handholdWidth/2,i.planes=Hd.sides;var n=this.escalatorHeight-2*this.handholdHeight;i.translate(0,0,this.handholdHeight),i.halfWidth=e/2,i.zHeight=n,i.fillPlanes(r),this.setPoints(t,this.escalatorHeight/2);var a=new Wi(0,0,1),o=new Wi(-1,0,0),s=new Wi(0,-1,0),l=(this.handholdWidth,this.escalatorHeight/2-this.handholdHeight);this.escalatorHeight;this.addHalfCircle(r,this.start,a,o,s,0,l,e),o.negate(),s.negate(),this.addHalfCircle(r,this.end,a,o,s,0,l,e)},e.prototype.setPoints=function(t,e){this.start.set(0,t,e),this.low.set(this.lowerLandingLength,t,e),this.high.set(this.lowerLandingLength+this.length,t,this.uppperLevelZ+e),this.end.set(this.lowerLandingLength+this.length+this.upperLandingLength,t,this.uppperLevelZ+e)},e.prototype.addStairs=function(t,e){var r=this.stairMesh.geometry,i=(this.width-this.handholdWidth)/2;(e%=this.stairLength)<0&&(e+=this.stairLength);var n=this.low.x+e,a=e/this.stairLength*this.stairHeight,o=this.stairHeight-a,s=.11+a,l=new Wi,u=new Wi;l.set(n-this.stairLength,t,.11),u.set(n,t,.11);var c=zd.BOX;zd.BOX.setupStraitSegment(l,u,a,i);var h=Hd.of(Hd.FRONT|Hd.BOTTOM|Hd.DOUBLE_SIDE),d=Hd.of(Hd.BACK|Hd.TOP|Hd.DOUBLE_SIDE);c.addPlanes(r,h);for(var p=0;p<this.stairsCount;p++){var f=s+.1+p*this.stairHeight,m=p==this.stairsCount-1?o:this.stairHeight;l.set(n+this.stairLength*p,t,f),u.set(n+this.stairLength*(p+1),t,f),c.setupStraitSegment(l,u,m,i),this.uppperLevelZ>0?c.addPlanes(r,h):c.addPlanes(r,d)}this.setPoints(t,.11);var g=Hd.of(Hd.BOTTOM|Hd.DOUBLE_SIDE);c.setupStraitSegment(this.start,this.low,this.stairHeight,i),c.addPlanes(r,g),this.high.x=this.high.x+e,c.setupStraitSegment(this.high,this.end,this.stairHeight,i),c.addPlanes(r,g),Wd.calculateTextureUVS(r)},e.prototype.addEscalator=function(t){var e=-t*(this.width+this.internalBalustradeWidth),r=e-this.width,i=e-this.width/2;this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)&&(this.addPart(e),this.addPart(r)),this.offsetChanged&&(this.addStairs(i,this.offsets[t]),this.addBottom(i))},e.prototype.addBottom=function(t){this.setPoints(t,0);var e=this.stairMesh.geometry,r=Math.sign(this.uppperLevelZ)*this.stairLength*2,i=this.width,n=this.low.x,a=this.high.x,o=new Wi(n,t,-.01),s=new Wi(n+r,t,-.01),l=new Wi(a,t,-.01+this.uppperLevelZ),u=new Wi(a+r,t,-.01+this.uppperLevelZ),c=new Wi(0,-1,0);[o,l,s,u].forEach(function(t){return Wd.translateScaled(t,c,-i/2)}),zd.BOX.setupPrism(o,l,s,u,c,i),zd.BOX.addPlanes(e,Hd.of(Hd.BOTTOM|Hd.TOP|Hd.BACK|Hd.RIGHT|Hd.DOUBLE_SIDE))},e}(Yd),bp=function(t){function e(e){var r=t.call(this,e)||this;return r.toPixels=10,r.fences=[],r}return Gd(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this)},e.prototype.updateParameter=function(e,r){var i=this;if(t.prototype.updateParameter.call(this,e,r),"3d-queue"===e&&(r.split("|").forEach(function(t){for(var e=[],r=t.split(":"),n=1;n<r.length;n++){var a=Wd.parseParamList(r[n]).map(Number),o=new Wi(a[0],a[1],a[2]);if(e.push(o),n==r.length-1){var s=new Wi(a[3],a[4],a[5]);e.push(s)}}i.fences.push(e)}),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"queue"===e){var n=r.split(":"),a=n[n.length-1];this.fenceColor=Ud.parseRGB(a)}"3d-to-pixels"===e&&(this.toPixels=parseFloat(r))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var e=new rp,r=new tp;r.autoFacecount=!1,r.faceCount=25;var i=new Yn,n=new Yn,a=.1*this.toPixels,o=1*this.toPixels,s=.04*this.toPixels,l=.01*this.toPixels,u=.15*this.toPixels,c=o-1.2*a;this.fences.forEach(function(t){for(var h=t.length,d=0;d<h-1;d++)e.setup(t[d].clone(),t[d+1].clone()),e.shiftZ(c),e.fillPlanes(i,Hd.all,a,a/20);for(d=0;d<h;d++){var p=s,f=u,m=t[d];r.x=m.x,r.y=m.y,r.rx=r.ry=p,r.z1=r.z2=m.z,r.addPlanes(n,Hd.all,!0,o,0),r.rx=r.ry=f,r.addPlanes(n,Hd.all,!0,l,0)}}),this.standsMesh=this.createMesh(),this.ribbonMesh=this.createMesh(),this.ribbonMesh.geometry=i,this.fenceColor.applyToMaterial(this.ribbonMesh),this.standsMesh.geometry=n,Ud.GRAY.applyToMaterial(this.standsMesh)}},e}(Yd),vp=function(t){function e(e){var r=t.call(this,e)||this;return r._children=[],r}return Gd(e,t),e.prototype.create3D=function(){this.element=new hs,this.element.name=this.constructor.name+":"+this.id},Object.defineProperty(e.prototype,"children",{get:function(){return this._children},set:function(t){this._children=t},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r)},e.prototype.add=function(t){this._children.push(t),t.parent=this,this.element.add(t.element)},e.prototype.remove=function(t){var e=this._children.indexOf(t);e>-1&&(this._children.splice(e,1),this.element.remove(t.element),t.parent=null)},e.prototype.dispose=function(){this.children.forEach(function(t){return t.dispose()}),this.children=[],t.prototype.dispose.call(this)},e}(Yd),yp=function(t){function e(e){var r=t.call(this,e)||this;return r.global=!1,r.enabled=!0,r.attenuationConst=0,r.attenuationLinear=0,r.attenuationQuad=0,r.cutoffAngle=0,r.dropoffRate=0,r.lightRotationX=0,r.lightRotationZ=0,r.type="",r.type=Wd.getAttributeValue(e,"3d-type"),r}return Gd(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.createLight()},e.prototype.createLight=function(){switch(this.type){case e.DIRECTIONAL:this.light=new Tc;break;case e.POINT:case e.POINT_STREET:this.light=new vc;break;case e.SPOT:case e.SPOT_CAR:this.light=new bc;break;case e.AMBIENT:this.light=new Cc;break;case e.AMBIENT_DAY:case e.AMBIENT_MOON:this.lightGroup=Wd.createDefaultLight()}null!=this.light&&this.element.add(this.light),null!=this.lightGroup&&this.element.add(this.lightGroup),(this.light instanceof bc||this.light instanceof Tc)&&(this.target=this.light.target,this.element.add(this.target)),this.element.name=this.constructor.name+":"+this.type+":"+this.id,this.enabled&&(window.light=this,window.lighte=this.element.children[0])},e.prototype.updateParameter=function(e,r){var i;if("pos"===e){var n=r.split(":");return this.x=parseFloat(n[0]),this.y=-parseFloat(n[1]),void(this.lightRotationZ=-parseFloat(n[2]))}if("3d-rot"===e){n=r.split(":");return this.lightRotationX=parseFloat(n[0]),void this.setDirty3D(Yd.DIRTY_3D_TRANSFORM)}t.prototype.updateParameter.call(this,e,r),"3d-diffuse"===e&&(this.diffuse="none"===r?null:Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_COLOR)),"3d-specular"===e&&(this.specular="none"===r?null:Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_COLOR)),"3d-ambient"===e&&(this.ambient="none"===r?null:Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_COLOR)),"3d-global"===e&&(this.global="true"===r,this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"enabled"===e&&(this.visible="true"===r,this.setDirty3D(Yd.DIRTY_3D_VISIBILITY)),"3d-attenuation"===e&&(i=r.split(":").map(function(t){return parseFloat(t)}),this.attenuationConst=i[0],this.attenuationLinear=i[1],this.attenuationQuad=i[2],this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-cutoff-angle"===e&&(this.cutoffAngle=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-dropoff-rate"===e&&(this.dropoffRate=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-type"===e&&(this.type=r,this.setDirty3D(Yd.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){var e=this;if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_TRANSFORM)&&null!=this.target){var r=this.lightRotationX,i=this.lightRotationZ,n=Wd.getPointOnSpere(r+Math.PI/2,i);n.multiplyScalar(50),this.target.position.set(0,0,0),this.target.position.add(n)}if(this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){if(null!=this.light&&(this.light.intensity=1),this.light instanceof bc){var a=this.light;a.angle=this.cutoffAngle,a.penumbra=this.dropoffRate,this.applyAttenuation(this.light)}this.light instanceof vc&&this.applyAttenuation(this.light)}this.isDirty3DSet(Yd.DIRTY_3D_COLOR)&&(null!=this.light?this.light.color=this.getColor():null!=this.lightGroup&&this.lightGroup.children.forEach(function(t){t.color=e.getColor()}))},e.prototype.getColor=function(){return(null!=this.diffuse?this.diffuse:Ud.BLACK).toThreeColor()},e.prototype.applyAttenuation=function(t){t.intensity=6.25/(this.attenuationConst+6.25);var e=Math.min(this.attenuationLinear,.5);0==this.attenuationLinear?(t.decay=1,t.distance=0):(t.distance=1e4*(.5-e)+100,t.decay=50*Math.sqrt(1-(e-.5)*(e-.5)/.25))},e.prototype.dispose=function(){this.target,t.prototype.dispose.call(this)},e.DIRECTIONAL="Light3DDirectional",e.POINT="Light3DPoint",e.POINT_STREET="StreetLight",e.AMBIENT="Light3DAmbient",e.AMBIENT_DAY="Daylight",e.AMBIENT_MOON="Moonlight",e.SPOT="Light3DSpot",e.SPOT_CAR="CarHeadlight",e}(Yd),Ap=function(t){function e(e){return t.call(this,e)||this}return Gd(e,t),Object.defineProperty(e.prototype,"dy",{get:function(){return this._dy},set:function(t){this._dy=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dx",{get:function(){return this._dx},set:function(t){this._dx=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dz",{get:function(){return this._dz},set:function(t){this._dz=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"x2"===e&&(this.dx=Number.parseFloat(r)),"y2"===e&&(this.dy=-Number.parseFloat(r)),"3d-dz"===e&&(this.dz=Number.parseFloat(r))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var e=new dc,r=new Wi(0,0,0),i=new Wi(this.dx,this.dy,this.dz),n=new Wi(i.x-r.x,i.y-r.y,0).normalize(),a=new Wi(-n.y,n.x,0),o=this.lineWidth/2;e.moveTo(r.x-o*a.x,r.y-o*a.y),e.lineTo(r.x+o*a.x,r.y+o*a.y),e.lineTo(i.x+o*a.x,i.y+o*a.y),e.lineTo(i.x-o*a.x,i.y-o*a.y),zd.BOX.setupStraitSegment(r,i,this.zHeight,this.lineWidth/2),Wd.disposeGeometry(this.lineMesh.geometry),this.lineMesh.geometry=zd.BOX.createGeometry(Hd.all)}},e.prototype.geom=function(){var t=new Wi(0,0,0),e=new Wi(this.dx,this.dy,this.dz),r=Wd.getLeftNormal(t,e),i=this.lineWidth/2,n=new Yn;n.vertices.push(Wd.getTranslated(t,r,i)),n.vertices.push(Wd.getTranslated(e,r,i)),n.vertices.push(Wd.getTranslated(e,r,-i)),n.vertices.push(Wd.getTranslated(t,r,-i));var a=new Pn(0,3,1),o=new Pn(1,3,2);return n.faces.push(a,o),n.computeFaceNormals(),n.computeVertexNormals(),n},e}(Qd),Tp=window,Cp=i;Tp.THREE||(Tp.THREE=Cp);var Sp=Tp.THREE,Ep=function(t){this.manager=void 0!==t?t:Fu};Ep.prototype={constructor:Ep,crossOrigin:"Anonymous",load:function(t,e,r,i){var n=this,a=void 0===n.path?wc.extractUrlBase(t):n.path,o=new Nu(n.manager);o.setPath(n.path),o.load(t,function(t){e(n.parse(t,a))},r,i)},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},options:{set convertUpAxis(t){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(t){return this.crossOrigin=t,this},parse:function(t,e){function r(t,e){for(var r=[],i=t.childNodes,n=0,a=i.length;n<a;n++){var o=i[n];o.nodeName===e&&r.push(o)}return r}function i(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),i=0,n=e.length;i<n;i++)r[i]=e[i];return r}function n(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),i=0,n=e.length;i<n;i++)r[i]=parseFloat(e[i]);return r}function a(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),r=new Array(e.length),i=0,n=e.length;i<n;i++)r[i]=parseInt(e[i]);return r}function o(t){return t.substring(1)}function s(t){return 0===Object.keys(t).length}function l(t){return void 0!==t&&!0===t.hasAttribute("meter")?parseFloat(t.getAttribute("meter")):1}function u(t){return void 0!==t?t.textContent:"Y_UP"}function c(t,e,i,n){var a=r(t,e)[0];if(void 0!==a)for(var o=r(a,i),s=0;s<o.length;s++)n(o[s])}function h(t,e){for(var r in t){t[r].build=e(t[r])}}function d(t,e){return void 0!==t.build?t.build:(t.build=e(t),t.build)}function p(t){for(var e={inputs:{}},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var a=o(n.getAttribute("source")),s=n.getAttribute("semantic");e.inputs[s]=a}}return e}function f(t){var e={},r=t.getAttribute("target").split("/"),i=r.shift(),n=r.shift(),a=-1!==n.indexOf("("),s=-1!==n.indexOf(".");if(s)r=n.split("."),n=r.shift(),e.member=r.shift();else if(a){var l=n.split("(");n=l.shift();for(var u=0;u<l.length;u++)l[u]=parseInt(l[u].replace(/\)/,""));e.indices=l}return e.id=i,e.sid=n,e.arraySyntax=a,e.memberSyntax=s,e.sampler=o(t.getAttribute("source")),e}function m(t){var e=[],r=t.channels,i=t.samplers,n=t.sources;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a],s=i[o.sampler],l=s.inputs.INPUT,u=s.inputs.OUTPUT;T(b(o,n[l],n[u]),e)}return e}function g(t){return d(jt.animations[t],m)}function b(t,e,r){var i,n,a,o,s,l,u=jt.nodes[t.id],c=Ft(u.id),h=u.transforms[t.sid],d=u.matrix.clone().transpose(),p={};switch(h){case"matrix":for(a=0,o=e.array.length;a<o;a++)if(i=e.array[a],n=a*r.stride,void 0===p[i]&&(p[i]={}),!0===t.arraySyntax){var f=r.array[n],m=t.indices[0]+4*t.indices[1];p[i][m]=f}else for(s=0,l=r.stride;s<l;s++)p[i][s]=r.array[n+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var g=function(t,e){var r=[];for(var i in t)r.push({time:parseFloat(i),value:t[i]});r.sort(function(t,e){return t.time-e.time});for(var n=0;n<16;n++)C(r,n,e.elements[n]);return r}(p,d);return{name:c.uuid,keyframes:g}}var v=new Wi,y=new Wi,A=new zi;function T(t,e){for(var r=t.keyframes,i=t.name,n=[],a=[],o=[],s=[],l=0,u=r.length;l<u;l++){var c=r[l],h=c.time,d=c.value;Et.fromArray(d).transpose(),Et.decompose(v,A,y),n.push(h),a.push(v.x,v.y,v.z),o.push(A.x,A.y,A.z,A.w),s.push(y.x,y.y,y.z)}return a.length>0&&e.push(new Iu(i+".position",n,a,null)),o.length>0&&e.push(new Mu(i+".quaternion",n,o,null)),s.length>0&&e.push(new Iu(i+".scale",n,s,null)),e}function C(t,e,r){var i,n,a,o=!0;for(n=0,a=t.length;n<a;n++)void 0===(i=t[n]).value[e]?i.value[e]=null:o=!1;if(!0===o)for(n=0,a=t.length;n<a;n++)(i=t[n]).value[e]=r;else!function(t,e){for(var r,i,n=0,a=t.length;n<a;n++){var o=t[n];if(null===o.value[e]){if(r=S(t,n,e),i=E(t,n,e),null===r){o.value[e]=i.value[e];continue}if(null===i){o.value[e]=r.value[e];continue}w(o,r,i,e)}}}(t,e)}function S(t,e,r){for(;e>=0;){var i=t[e];if(null!==i.value[r])return i;e--}return null}function E(t,e,r){for(;e<t.length;){var i=t[e];if(null!==i.value[r])return i;e++}return null}function w(t,e,r,i){r.time-e.time!=0?t.value[i]=(t.time-e.time)*(r.value[i]-e.value[i])/(r.time-e.time)+e.value[i]:t.value[i]=e.value[i]}function k(t){for(var e=[],r=t.name,i=t.end-t.start||-1,n=t.animations,a=0,o=n.length;a<o;a++)for(var s=g(n[a]),l=0,u=s.length;l<u;l++)e.push(s[l]);return new _u(r,i,e)}function x(t){return d(jt.clips[t],k)}function M(t){for(var e={sources:{}},r=0,i=t.childNodes.length;r<i;r++){var a=t.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=n(a.textContent);break;case"source":var o=a.getAttribute("id");e.sources[o]=nt(a);break;case"joints":e.joints=O(a);break;case"vertex_weights":e.vertexWeights=I(a)}}return e}function O(t){for(var e={inputs:{}},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var a=n.getAttribute("semantic"),s=o(n.getAttribute("source"));e.inputs[a]=s}}return e}function I(t){for(var e={inputs:{}},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var s=n.getAttribute("semantic"),l=o(n.getAttribute("source")),u=parseInt(n.getAttribute("offset"));e.inputs[s]={id:l,offset:u};break;case"vcount":e.vcount=a(n.textContent);break;case"v":e.v=a(n.textContent)}}return e}function _(t){var e={id:t.id},r=jt.geometries[e.id];return void 0!==t.skin&&(e.skin=function(t){var e,r,i,n={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},a=t.sources,o=t.vertexWeights,s=o.vcount,l=o.v,u=o.inputs.JOINT.offset,c=o.inputs.WEIGHT.offset,h=t.sources[t.joints.inputs.JOINT],d=t.sources[t.joints.inputs.INV_BIND_MATRIX],p=a[o.inputs.WEIGHT.id].array,f=0;for(e=0,i=s.length;e<i;e++){var m=s[e],g=[];for(r=0;r<m;r++){var b=l[f+u],v=l[f+c],y=p[v];g.push({index:b,weight:y}),f+=2}for(g.sort(S),r=0;r<4;r++){var A=g[r];void 0!==A?(n.indices.array.push(A.index),n.weights.array.push(A.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}t.bindShapeMatrix?n.bindMatrix=(new vn).fromArray(t.bindShapeMatrix).transpose():n.bindMatrix=(new vn).identity();for(e=0,i=h.array.length;e<i;e++){var T=h.array[e],C=(new vn).fromArray(d.array,e*d.stride).transpose();n.joints.push({name:T,boneInverse:C})}return n;function S(t,e){return e.weight-t.weight}}(t.skin),r.sources.skinIndices=e.skin.indices,r.sources.skinWeights=e.skin.weights),e}function L(t){return void 0!==t.build?t.build:t.init_from}function P(t){var e=jt.images[t];return void 0!==e?d(e,L):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",t),null)}function R(t){for(var e={surfaces:{},samplers:{}},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"newparam":F(n,e);break;case"technique":e.technique=B(n);break;case"extra":e.extra=V(n)}}return e}function F(t,e){for(var r=t.getAttribute("sid"),i=0,n=t.childNodes.length;i<n;i++){var a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"surface":e.surfaces[r]=D(a);break;case"sampler2D":e.samplers[r]=N(a)}}}function D(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"init_from":e.init_from=n.textContent}}return e}function N(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"source":e.source=n.textContent}}return e}function B(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=n.nodeName,e.parameters=G(n)}}return e}function G(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":e[n.nodeName]=U(n);break;case"transparent":e[n.nodeName]={opaque:n.getAttribute("opaque"),data:U(n)}}}return e}function U(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var a=t.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":e[a.nodeName]=n(a.textContent);break;case"float":e[a.nodeName]=parseFloat(a.textContent);break;case"texture":e[a.nodeName]={id:a.getAttribute("texture"),extra:H(a)}}}return e}function H(t){for(var e={technique:{}},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"extra":z(n,e)}}return e}function z(t,e){for(var r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":W(n,e)}}}function W(t,e){for(var r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?e.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?e.technique[n.nodeName]=0:e.technique[n.nodeName]=parseInt(n.textContent)}}}function V(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":e.technique=Y(n)}}return e}function Y(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"double_sided":e[n.nodeName]=parseInt(n.textContent)}}return e}function j(t){return t}function X(t){var e,r,i=(e=t.url,d(jt.effects[e],j)),n=i.profile.technique,a=i.profile.extra;switch(n.type){case"phong":case"blinn":r=new hu;break;case"lambert":r=new fu;break;default:r=new Oa}function o(t){var e=i.profile.samplers[t.id],r=null;void 0!==e?r=P(i.profile.surfaces[e.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=P(t.id));if(null!==r){var n=function(t){var e,r=t.slice(2+(t.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase()){case"tga":e=Ut;break;default:e=zt}return e}(r);if(void 0!==n){var a=n.load(r),o=t.extra;if(void 0!==o&&void 0!==o.technique&&!1===s(o.technique)){var l=o.technique;a.wrapS=l.wrapU?br:vr,a.wrapT=l.wrapV?br:vr,a.offset.set(l.offsetU||0,l.offsetV||0),a.repeat.set(l.repeatU||1,l.repeatV||1)}else a.wrapS=br,a.wrapT=br;return a}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}r.name=t.name;var l=n.parameters;for(var u in l){var c=l[u];switch(u){case"diffuse":c.color&&r.color.fromArray(c.color),c.texture&&(r.map=o(c.texture));break;case"specular":c.color&&r.specular&&r.specular.fromArray(c.color),c.texture&&(r.specularMap=o(c.texture));break;case"bump":c.texture&&(r.normalMap=o(c.texture));break;case"ambient":c.texture&&(r.lightMap=o(c.texture));break;case"shininess":c.float&&r.shininess&&(r.shininess=c.float);break;case"emission":c.color&&r.emissive&&r.emissive.fromArray(c.color),c.texture&&(r.emissiveMap=o(c.texture))}}var h=l.transparent,p=l.transparency;if(void 0===p&&h&&(p={float:1}),void 0===h&&p&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&p)if(h.data.texture)r.transparent=!0;else{var f=h.data.color;switch(h.opaque){case"A_ONE":r.opacity=f[3]*p.float;break;case"RGB_ZERO":r.opacity=1-f[0]*p.float;break;case"A_ZERO":r.opacity=1-f[3]*p.float;break;case"RGB_ONE":r.opacity=f[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==a&&void 0!==a.technique&&1===a.technique.double_sided&&(r.side=ve),r}function q(t){return d(jt.materials[t],X)}function Z(t){for(var e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];switch(r.nodeName){case"technique_common":return K(r)}}return{}}function K(t){for(var e={},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];switch(i.nodeName){case"perspective":case"orthographic":e.technique=i.nodeName,e.parameters=Q(i)}}return e}function Q(t){for(var e={},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];switch(i.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[i.nodeName]=parseFloat(i.textContent)}}return e}function J(t){var e;switch(t.optics.technique){case"perspective":e=new ps(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":var r=t.optics.parameters.ymag,i=t.optics.parameters.xmag,n=t.optics.parameters.aspect_ratio;i=void 0===i?r*n:i,r=void 0===r?i/n:r,e=new yc(-(i*=.5),i,r*=.5,-r,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new ps}return e.name=t.name,e}function $(t){var e=jt.cameras[t];return void 0!==e?d(e,J):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null)}function tt(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=n.nodeName,e.parameters=et(n)}}return e}function et(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var a=t.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":var o=n(a.textContent);e.color=(new xn).fromArray(o);break;case"falloff_angle":e.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":var s=parseFloat(a.textContent);e.distance=s?Math.sqrt(1/s):0}}return e}function rt(t){var e;switch(t.technique){case"directional":e=new Tc;break;case"point":e=new vc;break;case"spot":e=new bc;break;case"ambient":e=new Cc}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function it(t){var e=jt.lights[t];return void 0!==e?d(e,rt):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",t),null)}function nt(t){for(var e={array:[],stride:3},a=0;a<t.childNodes.length;a++){var o=t.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"float_array":e.array=n(o.textContent);break;case"Name_array":e.array=i(o.textContent);break;case"technique_common":var s=r(o,"accessor")[0];void 0!==s&&(e.stride=parseInt(s.getAttribute("stride")))}}return e}function at(t){for(var e={},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];1===i.nodeType&&(e[i.getAttribute("semantic")]=o(i.getAttribute("source")))}return e}function ot(t){for(var e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var s=o(n.getAttribute("source")),l=n.getAttribute("semantic"),u=parseInt(n.getAttribute("offset")),c=parseInt(n.getAttribute("set")),h=c>0?l+c:l;e.inputs[h]={id:s,offset:u},e.stride=Math.max(e.stride,u+1),"TEXCOORD"===l&&(e.hasUV=!0);break;case"vcount":e.vcount=a(n.textContent);break;case"p":e.p=a(n.textContent)}}return e}function st(t){for(var e=0,r=0,i=t.length;r<i;r++){!0===t[r].hasUV&&e++}e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function lt(t){var e={},r=t.sources,i=t.vertices,n=t.primitives;if(0===n.length)return{};var a=function(t){for(var e={},r=0;r<t.length;r++){var i=t[r];void 0===e[i.type]&&(e[i.type]=[]),e[i.type].push(i)}return e}(n);for(var o in a){var s=a[o];st(s),e[o]=ut(s,r,i)}return e}function ut(t,e,r){for(var i={},n={array:[],stride:0},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},u=[],c=4,h=[],d=4,p=new aa,f=[],m=0,g=0;g<t.length;g++){var b=t[g],v=b.inputs,y=0;switch(b.type){case"lines":case"linestrips":y=2*b.count;break;case"triangles":y=3*b.count;break;case"polylist":for(var A=0;A<b.count;A++){var T=b.vcount[A];switch(T){case 3:y+=3;break;case 4:y+=6;break;default:y+=3*(T-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",b.type)}for(var C in p.addGroup(m,y,g),m+=y,b.material&&f.push(b.material),v){var S=v[C];switch(C){case"VERTEX":for(var E in r){var w=r[E];switch(E){case"POSITION":var k=n.array.length;if(ct(b,e[w],S.offset,n.array),n.stride=e[w].stride,e.skinWeights&&e.skinIndices&&(ct(b,e.skinIndices,S.offset,u),ct(b,e.skinWeights,S.offset,h)),!1===b.hasUV&&!0===t.uvsNeedsFix){y=(n.array.length-k)/n.stride;for(var x=0;x<y;x++)o.array.push(0,0)}break;case"NORMAL":ct(b,e[w],S.offset,a.array),a.stride=e[w].stride;break;case"COLOR":ct(b,e[w],S.offset,l.array),l.stride=e[w].stride;break;case"TEXCOORD":ct(b,e[w],S.offset,o.array),o.stride=e[w].stride;break;case"TEXCOORD1":ct(b,e[w],S.offset,s.array),o.stride=e[w].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',E)}}break;case"NORMAL":ct(b,e[S.id],S.offset,a.array),a.stride=e[S.id].stride;break;case"COLOR":ct(b,e[S.id],S.offset,l.array),l.stride=e[S.id].stride;break;case"TEXCOORD":ct(b,e[S.id],S.offset,o.array),o.stride=e[S.id].stride;break;case"TEXCOORD1":ct(b,e[S.id],S.offset,s.array),s.stride=e[S.id].stride}}}return n.array.length>0&&p.addAttribute("position",new ta(n.array,n.stride)),a.array.length>0&&p.addAttribute("normal",new ta(a.array,a.stride)),l.array.length>0&&p.addAttribute("color",new ta(l.array,l.stride)),o.array.length>0&&p.addAttribute("uv",new ta(o.array,o.stride)),s.array.length>0&&p.addAttribute("uv2",new ta(s.array,s.stride)),u.length>0&&p.addAttribute("skinIndex",new ta(u,c)),h.length>0&&p.addAttribute("skinWeight",new ta(h,d)),i.data=p,i.type=t[0].type,i.materialKeys=f,i}function ct(t,e,r,i){var n=t.p,a=t.stride,o=t.vcount;function s(t){for(var e=n[t+r]*u,a=e+u;e<a;e++)i.push(l[e])}var l=e.array,u=e.stride;if(void 0!==t.vcount)for(var c=0,h=0,d=o.length;h<d;h++){var p=o[h];if(4===p){var f=c+0*a,m=c+1*a,g=c+2*a,b=c+3*a;s(f),s(m),s(b),s(m),s(g),s(b)}else if(3===p)m=c+1*a,g=c+2*a,s(f=c+0*a),s(m),s(g);else if(p>4)for(var v=1,y=p-2;v<=y;v++)m=c+a*v,g=c+a*(v+1),s(f=c+0*a),s(m),s(g);c+=a*p}else for(h=0,d=n.length;h<d;h+=a)s(h)}function ht(t){return d(jt.geometries[t],lt)}function dt(t){return void 0!==t.build?t.build:t}function pt(t,e){for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"joint":e.joints[i.getAttribute("sid")]=ft(i);break;case"link":e.links.push(gt(i))}}}function ft(t){for(var e,r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"prismatic":case"revolute":e=mt(i,null)}}return e}function mt(t,e){e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new Wi,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"axis":var a=n(i.textContent);e.axis.fromArray(a);break;case"limits":var o=i.getElementsByTagName("max")[0],s=i.getElementsByTagName("min")[0];e.limits.max=parseFloat(o.textContent),e.limits.min=parseFloat(s.textContent)}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function gt(t){for(var e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"attachment_full":e.attachments.push(bt(i));break;case"matrix":case"translate":case"rotate":e.transforms.push(vt(i))}}return e}function bt(t){for(var e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"link":e.links.push(gt(i));break;case"matrix":case"translate":case"rotate":e.transforms.push(vt(i))}}return e}function vt(t){var e={type:t.nodeName},r=n(t.textContent);switch(e.type){case"matrix":e.obj=new vn,e.obj.fromArray(r).transpose();break;case"translate":e.obj=new Wi,e.obj.fromArray(r);break;case"rotate":e.obj=new Wi,e.obj.fromArray(r),e.angle=Ui.degToRad(r[3])}return e}function yt(t,e){for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":At(i,e)}}}function At(t,e){for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"inertia":e.inertia=n(i.textContent);break;case"mass":e.mass=n(i.textContent)[0]}}}function Tt(t){for(var e={target:t.getAttribute("target").split("/").pop()},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"axis":var n=i.getElementsByTagName("param")[0];e.axis=n.textContent;var a=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=a.substr(0,a.length-1)}}return e}function Ct(t){return void 0!==t.build?t.build:t}function St(t){for(var e=[],r=Bt.querySelector('[id="'+t.id+'"]'),i=0;i<r.childNodes.length;i++){var a=r.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"matrix":var o=n(a.textContent),s=(new vn).fromArray(o).transpose();e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:s});break;case"translate":case"scale":o=n(a.textContent);var l=(new Wi).fromArray(o);e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l});break;case"rotate":o=n(a.textContent),l=(new Wi).fromArray(o);var u=Ui.degToRad(o[3]);e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l,angle:u})}}return e}var Et=new vn,wt=new Wi;function kt(t){for(var e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new vn,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"node":e.nodes.push(i.getAttribute("id")),kt(i);break;case"instance_camera":e.instanceCameras.push(o(i.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(xt(i));break;case"instance_light":e.instanceLights.push(o(i.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(xt(i));break;case"instance_node":e.instanceNodes.push(o(i.getAttribute("url")));break;case"matrix":var a=n(i.textContent);e.matrix.multiply(Et.fromArray(a).transpose()),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"translate":a=n(i.textContent),wt.fromArray(a),e.matrix.multiply(Et.makeTranslation(wt.x,wt.y,wt.z)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"rotate":a=n(i.textContent);var s=Ui.degToRad(a[3]);e.matrix.multiply(Et.makeRotationAxis(wt.fromArray(a),s)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"scale":a=n(i.textContent),e.matrix.scale(wt.fromArray(a)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"extra":break;default:console.log(i)}}return Rt(e.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",e.id):jt.nodes[e.id]=e,e}function xt(t){for(var e={id:o(t.getAttribute("url")),materials:{},skeletons:[]},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];switch(i.nodeName){case"bind_material":for(var n=i.getElementsByTagName("instance_material"),a=0;a<n.length;a++){var s=n[a],l=s.getAttribute("symbol"),u=s.getAttribute("target");e.materials[l]=o(u)}break;case"skeleton":e.skeletons.push(o(i.textContent))}}return e}function Mt(t,e){var r,i,n,a,o=[],s=[];for(r=0;r<t.length;r++){var l=t[r];if(Rt(l))Ot(Ft(l),e,o);else if(a=l,void 0!==jt.visualScenes[a]){var u=jt.visualScenes[l].children;for(i=0;i<u.length;i++){var c=u[i];"JOINT"===c.type&&Ot(Ft(c.id),e,o)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",l)}for(r=0;r<e.length;r++)for(i=0;i<o.length;i++)if((n=o[i]).bone.name===e[r].name){s[r]=n,n.processed=!0;break}for(r=0;r<o.length;r++)!1===(n=o[r]).processed&&(s.push(n),n.processed=!0);var h=[],d=[];for(r=0;r<s.length;r++)n=s[r],h.push(n.bone),d.push(n.boneInverse);return new Ds(h,d)}function Ot(t,e,r){t.traverse(function(t){if(!0===t.isBone){for(var i,n=0;n<e.length;n++){var a=e[n];if(a.name===t.name){i=a.boneInverse;break}}void 0===i&&(i=new vn),r.push({bone:t,boneInverse:i,processed:!1})}})}function It(t){for(var e,r=[],i=t.matrix,n=t.nodes,a=t.type,o=t.instanceCameras,s=t.instanceControllers,l=t.instanceLights,u=t.instanceGeometries,c=t.instanceNodes,h=0,p=n.length;h<p;h++)r.push(Ft(n[h]));for(h=0,p=o.length;h<p;h++){var f=$(o[h]);null!==f&&r.push(f.clone())}for(h=0,p=s.length;h<p;h++)for(var m=s[h],g=(e=m.id,d(jt.controllers[e],_)),b=ht(g.id),v=Pt(b,m.materials),y=Mt(m.skeletons,g.skin.joints),A=0,T=v.length;A<T;A++){var C=v[A];C.isSkinnedMesh&&(C.bind(y,g.skin.bindMatrix),C.normalizeSkinWeights()),r.push(C)}for(h=0,p=l.length;h<p;h++){var S=it(l[h]);null!==S&&r.push(S.clone())}for(h=0,p=u.length;h<p;h++)for(A=0,T=(v=Pt(b=ht((m=u[h]).id),m.materials)).length;A<T;A++)r.push(v[A]);for(h=0,p=c.length;h<p;h++)r.push(Ft(c[h]).clone());if(0===n.length&&1===r.length)C=r[0];else for(C="JOINT"===a?new Ns:new hs,h=0;h<r.length;h++)C.add(r[h]);return""===C.name&&(C.name="JOINT"===a?t.sid:t.name),C.matrix.copy(i),C.matrix.decompose(C.position,C.quaternion,C.scale),C}var _t=new Oa({color:16711935});function Lt(t,e){for(var r=[],i=0,n=t.length;i<n;i++){var a=e[t[i]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",t[i]),r.push(_t)):r.push(q(a))}return r}function Pt(t,e){var r=[];for(var i in t){var n=t[i],a=Lt(n.materialKeys,e);0===a.length&&("lines"===i||"linestrips"===i?a.push(new Bs):a.push(new hu));var o=void 0!==n.data.attributes.skinIndex;if(o)for(var s=0,l=a.length;s<l;s++)a[s].skinning=!0;var u,c=1===a.length?a[0]:a;switch(i){case"lines":u=new Us(n.data,c);break;case"linestrips":u=new Gs(n.data,c);break;case"triangles":case"polylist":u=o?new Fs(n.data,c):new Ia(n.data,c)}r.push(u)}return r}function Rt(t){return void 0!==jt.nodes[t]}function Ft(t){return d(jt.nodes[t],It)}function Dt(t){var e=new hs;e.name=t.name;for(var r=t.children,i=0;i<r.length;i++){var n=r[i];e.add(Ft(n.id))}return e}function Nt(t){return d(jt.visualScenes[t],Dt)}if(0===t.length)return{scene:new Os};var Bt=r((new DOMParser).parseFromString(t,"application/xml"),"COLLADA")[0],Gt=Bt.getAttribute("version");console.log("THREE.ColladaLoader: File version",Gt);var Ut,Ht=function(t){return{unit:l(r(t,"unit")[0]),upAxis:u(r(t,"up_axis")[0])}}(r(Bt,"asset")[0]),zt=new Wu(this.manager);zt.setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin),Sp.TGALoader&&(Ut=new Sp.TGALoader(this.manager)).setPath(this.resourcePath||e);var Wt=[],Vt={},Yt=0,jt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};c(Bt,"library_animations","animation",function(t){for(var e={sources:{},samplers:{},channels:{}},r=0,i=t.childNodes.length;r<i;r++){var n,a=t.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"source":n=a.getAttribute("id"),e.sources[n]=nt(a);break;case"sampler":n=a.getAttribute("id"),e.samplers[n]=p(a);break;case"channel":n=a.getAttribute("target"),e.channels[n]=f(a);break;default:console.log(a)}}jt.animations[t.getAttribute("id")]=e}),c(Bt,"library_animation_clips","animation_clip",function(t){for(var e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":e.animations.push(o(n.getAttribute("url")))}}jt.clips[t.getAttribute("id")]=e}),c(Bt,"library_controllers","controller",function(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"skin":e.id=o(n.getAttribute("source")),e.skin=M(n);break;case"morph":e.id=o(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}jt.controllers[t.getAttribute("id")]=e}),c(Bt,"library_images","image",function(t){var e={init_from:r(t,"init_from")[0].textContent};jt.images[t.getAttribute("id")]=e}),c(Bt,"library_effects","effect",function(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":e.profile=R(n)}}jt.effects[t.getAttribute("id")]=e}),c(Bt,"library_materials","material",function(t){for(var e={name:t.getAttribute("name")},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":e.url=o(n.getAttribute("url"))}}jt.materials[t.getAttribute("id")]=e}),c(Bt,"library_cameras","camera",function(t){for(var e={name:t.getAttribute("name")},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"optics":e.optics=Z(n)}}jt.cameras[t.getAttribute("id")]=e}),c(Bt,"library_lights","light",function(t){for(var e={},r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":e=tt(n)}}jt.lights[t.getAttribute("id")]=e}),c(Bt,"library_geometries","geometry",function(t){var e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},i=r(t,"mesh")[0];if(void 0!==i){for(var n=0;n<i.childNodes.length;n++){var a=i.childNodes[n];if(1===a.nodeType){var o=a.getAttribute("id");switch(a.nodeName){case"source":e.sources[o]=nt(a);break;case"vertices":e.vertices=at(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(ot(a));break;default:console.log(a)}}}jt.geometries[t.getAttribute("id")]=e}}),c(Bt,"library_nodes","node",kt),c(Bt,"library_visual_scenes","visual_scene",function(t){var e={name:t.getAttribute("name"),children:[]};!function(t){for(var e=t.getElementsByTagName("node"),r=0;r<e.length;r++){var i=e[r];!1===i.hasAttribute("id")&&i.setAttribute("id","three_default_"+Yt++)}}(t);for(var i=r(t,"node"),n=0;n<i.length;n++)e.children.push(kt(i[n]));jt.visualScenes[t.getAttribute("id")]=e}),c(Bt,"library_kinematics_models","kinematics_model",function(t){for(var e={name:t.getAttribute("name")||"",joints:{},links:[]},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":pt(i,e)}}jt.kinematicsModels[t.getAttribute("id")]=e}),c(Bt,"library_physics_models","physics_model",function(t){for(var e={name:t.getAttribute("name")||"",rigidBodies:{}},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"rigid_body":e.rigidBodies[i.getAttribute("name")]={},yt(i,e.rigidBodies[i.getAttribute("name")])}}jt.physicsModels[t.getAttribute("id")]=e}),c(Bt,"scene","instance_kinematics_scene",function(t){for(var e={bindJointAxis:[]},r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"bind_joint_axis":e.bindJointAxis.push(Tt(i))}}jt.kinematicsScenes[o(t.getAttribute("url"))]=e}),h(jt.animations,m),h(jt.clips,k),h(jt.controllers,_),h(jt.images,L),h(jt.effects,j),h(jt.materials,X),h(jt.cameras,J),h(jt.lights,rt),h(jt.geometries,lt),h(jt.visualScenes,Dt),function(){var t=jt.clips;if(!0===s(t)){if(!1===s(jt.animations)){var e=[];for(var r in jt.animations)for(var i=g(r),n=0,a=i.length;n<a;n++)e.push(i[n]);Wt.push(new _u("default",-1,e))}}else for(r in t)Wt.push(x(r))}(),function(){var t=Object.keys(jt.kinematicsModels)[0],e=Object.keys(jt.kinematicsScenes)[0],r=Object.keys(jt.visualScenes)[0];if(void 0!==t&&void 0!==e){for(var i,n=(i=t,d(jt.kinematicsModels[i],dt)),a=function(t){return d(jt.kinematicsScenes[t],Ct)}(e),o=Nt(r),s=a.bindJointAxis,l={},u=0,c=s.length;u<c;u++){var h=s[u],p=Bt.querySelector('[sid="'+h.target+'"]');if(p){var f=p.parentElement;g(h.jointIndex,f)}}var m=new vn;Vt={joints:n&&n.joints,getJointValue:function(t){var e=l[t];if(e)return e.position;console.warn("THREE.ColladaLoader: Joint "+t+" doesn't exist.")},setJointValue:function(t,e){var r=l[t];if(r){var i=r.joint;if(e>i.limits.max||e<i.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+e+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+").");else if(i.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{var n=r.object,a=i.axis,o=r.transforms;Et.identity();for(var s=0;s<o.length;s++){var u=o[s];if(u.sid&&-1!==u.sid.indexOf(t))switch(i.type){case"revolute":Et.multiply(m.makeRotationAxis(a,Ui.degToRad(e)));break;case"prismatic":Et.multiply(m.makeTranslation(a.x*e,a.y*e,a.z*e));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+i.type)}else switch(u.type){case"matrix":Et.multiply(u.obj);break;case"translate":Et.multiply(m.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":Et.scale(u.obj);break;case"rotate":Et.multiply(m.makeRotationAxis(u.obj,u.angle))}}n.matrix.copy(Et),n.matrix.decompose(n.position,n.quaternion,n.scale),l[t].position=e}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}function g(t,e){var r=e.getAttribute("name"),i=n.joints[t];o.traverse(function(n){n.name===r&&(l[t]={object:n,transforms:St(e),joint:i,position:i.zeroPosition})})}}();var Xt=function(t){return Nt(o(r(t,"instance_visual_scene")[0].getAttribute("url")))}(r(Bt,"scene")[0]);return"Z_UP"===Ht.upAxis&&Xt.quaternion.setFromEuler(new Rn(-Math.PI/2,0,0)),Xt.scale.multiplyScalar(Ht.unit),{animations:Wt,kinematics:Vt,library:jt,scene:Xt}}};var wp=function(){function t(t){this.url=t,this.mergedObjects=new Map,this.listeners=new Map,this.errorCallbacks=new Map,this.loadedObject=null,this.supportMerge=!0,this.errorLoading=!1}return t.getManager=function(e){var r=t.managers[e];return r||(r=new t(e),t.managers[e]=r,r.loadCollada()),r},t.prototype.addListener=function(t){this.listeners.set(t,!0)},t.prototype.removeListener=function(t){this.listeners.delete(t)},t.prototype.addErrorCallback=function(t){this.errorCallbacks.set(t,!0)},t.prototype.removeErrorCallback=function(t){this.errorCallbacks.delete(t)},t.prototype.loadCollada=function(){var t=this.url;this.doLoadCollada(t)},t.copy=function(t,e){e.name=t.name,e.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),e.scale.set(t.scale.x,t.scale.y,t.scale.z),e.position.set(t.position.x,t.position.y,t.position.z),e.matrix.copy(t.matrix)},t.shallowCloneChildren=function(e,r){e.children.forEach(function(e){var i=t.getShallowClone(e);null!=i&&r.add(i)})},t.getShallowClone=function(e){var r=null;return e instanceof hs?r=new hs:e instanceof Ia?r=new Ia(e.geometry,e.material):(r=e.clone()).children=[],null!=r&&(t.shallowCloneChildren(e,r),t.copy(e,r)),r},t.prototype.applyMergedColorMapping=function(t,e){t.traverse(function(t){if(t instanceof Ia){var r=t.userData.colors;if(null!=r){var i=t.geometry;for(var n in e){var a=r[n];if(null!=a){var o=Ud.parseRGB(e[n]),s=i.faces.length;if(!o.isNull())for(var l=a[0];l<a[0]+a[1];l++)l<s&&(i.faces[l].color=o.toThreeColor())}}return i.elementsNeedUpdate=!0,void(i.colorsNeedUpdate=!0)}}})},t.prototype.applyColorMapping=function(e,r){if(null!=e&&!r.isEmpty()){if(e instanceof Ia){var i=this.mergedObjects.get(r.id);if(null==i){var n=t.getShallowClone(this.loadedObject);this.applyColorMapping(n,r),i=t.createMergedObject(n),this.mergedObjects.set(r.id,i)}return e.geometry=i.geometry,void(e.material=i.material)}e.traverse(function(t){if(t instanceof Ia){var e=t.material;if(r.colors.has(e.name)){var i=r.colors.get(e.name);if(null!=i&&!i.isNull()){var n=e.map;if(null!=n){var a=Wd.createDefaultMaterial();a.depthTest=e.depthTest,a.map=n,i.setupColorMaterial(a),t.material=a}else t.material=i.getMaterial()}}}})}},t.prototype.getObject=function(e){if(window.mergeDisabled)return t.getShallowClone(this.loadedObject);if(this.supportMerge){var r=this.mergedObjects.get(e.id);if(null!=r)return t.getShallowClone(r);var i=null;e.isEmpty()||e.isDefault()?i=this.loadedObject:(i=t.getShallowClone(this.loadedObject),this.applyColorMapping(i,e));var n=t.createMergedObject(i);if(null!=n)return this.mergedObjects.set(e.id,n),t.getShallowClone(n);this.supportMerge=!1,console.error("Mesh merge failed:",this.url,this.loadedObject)}var a=t.getShallowClone(this.loadedObject);return this.applyColorMapping(a,e),a},t.prototype.getShallowClone=function(){return t.getShallowClone(this.loadedObject)},t.createMergedObject=function(e){var r=[t.FACE_COLOR_MATERIAL],i=[],n=!0,a=new Yn;if(e.traverse(function(t){if(n)if(t instanceof Ia){var o=new Yn,s=t.geometry;o.fromBufferGeometry(s);for(var l=t;null!=l&&l!=e;)o.applyMatrix(l.matrix),l=l.parent;var u=null,c=[],h=!0,d=!1;if(t.material instanceof Array)h=!1,(c=t.material).forEach(function(t){return r.push(t)});else{if(u=t.material,d=u.opacity<.9999||null!=u.map,null!=u.map)return void(n=!1);d&&r.push(u)}var p=s.getAttribute("color"),f=0;o.faces.forEach(function(t){if(h?(t.color=u.color,t.materialIndex=d?r.length-1:0):(t.color=c[t.materialIndex].color,t.materialIndex=r.length-c.length+t.materialIndex),p)for(var e=0;e<t.vertexColors.length;e++){var i=3*f;t.vertexColors[e]=new xn(p.getX(i),p.getY(i),p.getZ(i))}f++});try{a.merge(o)}catch(t){n=!1,console.error(t),console.error(o,u)}}else if(t instanceof pc){var m=t.clone();i.push(m)}}),!n)return null;var o=new Ia((new aa).fromGeometry(a),1==r.length?t.FACE_COLOR_MATERIAL:r);return i.forEach(function(t){return o.add(t)}),t.copy(e,o),o.name="Merged mesh",o},t.prototype.doLoadCollada=function(t){var e=this;if(null==this.loadedObject&&!this.errorLoading){(new Ep).load(t,function(t){var r=t.scene;r.traverse(function(t){if(t instanceof Ia){var e,r=t.geometry;r.getAttribute("normal")||(r.computeVertexNormals(),(e=t.material).flatShading=!1,e.needsUpdate=!0),r.getAttribute("color")&&((e=t.material).vertexColors=Ce),t.material instanceof hu&&((e=t.material).transparent=1!=e.opacity,e.shininess=10,e.specular=Wd.getSpecularColor())}}),e.loadedObject=r,e.listeners.forEach(function(t,r){return r.call(e.loadedObject)})},function(t){},function(t){console.error("Object3DManger: Error loading collada: "+e.url),e.errorLoading=!0,e.errorCallbacks.forEach(function(t,e){e.call(null)})})}},t.FACE_COLOR_MATERIAL=new hu({vertexColors:Ce}),t.managers=[],t}(),kp=function(){function t(){this.id=t.EMPTY_ID,this.colors=new Map}return t.prototype.parse=function(e){this.colors.clear();var r=JSON.parse(e);for(var i in r)this.colors.set(i,Ud.parseRGB(r[i]));this.id=t.EMPTY_ID,this.isEmpty()||this.isDefault()||(this.id=Wd.hash(e))},t.prototype.hasTransparent=function(){var t=!1;return this.colors.forEach(function(e,r){e.isTransparent()&&(t=!0)}),t},t.prototype.isEmpty=function(){return 0==this.colors.size},t.prototype.isDefault=function(){var t=!0;return this.colors.forEach(function(e,r){e.isNull()||(t=!1)}),t},t.EMPTY_ID=Wd.hash("{}"),t}(),xp=function(t){function e(r){var i=t.call(this,r)||this;return i._hrefPath="",i._fileName="",i._width=0,i._height=0,i._axisOrder="",i.scalingFactor=1,i.baseScale2D=1,i.baseScale2DSet=!1,i.x3d=!1,i.pos3dSet=!1,i.pos3dX=0,i.pos3dY=0,i.colorMapping=new kp,i.affectedBySceneLights=!1,i.internalLights=e.LIGHTS_OFF,i.layer=0,i.errorLoading=!1,i.loaded=!1,i.replicatedCallbacks=[],i.errorCallback=function(){i.errorLoading=!0,i.createBox(),i.manager.removeErrorCallback(i.errorCallback)},i.x3d=lp.image===Wd.getShapeType(r),i}return Gd(e,t),Object.defineProperty(e.prototype,"axisOrder",{get:function(){return this._axisOrder},set:function(t){this._axisOrder=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hrefPath",{get:function(){return this._hrefPath},set:function(t){this._hrefPath=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fileName",{get:function(){return this._fileName},set:function(t){this._fileName=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.create3D=function(){t.prototype.create3D.call(this);var r=new hs;r.name="Rotation group",this.rotationGroup=r,this.element.add(r),null==e.textureLoader&&(e.textureLoader=new Wu)},e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"width"===e&&(this.width=parseFloat(r)),"height"===e&&(this.height=parseFloat(r)),"href-path"!==e&&"add"!==e||(this.hrefPath=r),"3d-axis-order"===e&&(this.axisOrder=r),"3d-scaling-factor"===e&&(this.scalingFactor=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_TRANSFORM)),"3d-file-name"===e&&(this.fileName=r),"3d-pos"===e){var i=r.split(":");this.pos3dX=parseFloat(i[0]),this.pos3dY=-parseFloat(i[1]),this.pos3dSet=!0,this.setDirty3D(Yd.DIRTY_3D_TRANSFORM)}"3d-custom-colors"===e&&(this.colorMapping.parse(r),this.setDirty3D(Yd.DIRTY_3D_COLOR)),"3d-base-scale-2d"===e&&(this.baseScale2D=parseFloat(r),this.baseScale2DSet=!0),"3d-affected-by-scene-lights"===e&&(this.affectedBySceneLights="true"===r),"3d-internal-lights"===e&&(this.internalLights=r)},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_TRANSFORM)&&this.pos3dSet&&!this.errorLoading&&(this.element.position.set(this.pos3dX,this.pos3dY,this.z),this.applyScale()),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){switch(this.applyScale(),this.rotationGroup.children=[],this._axisOrder){case"OBJECT_3D_YZX_AXIS_ORDER":this.rotationGroup.rotation.set(Math.PI/2,-3*Math.PI/2,0);break;case"OBJECT_3D_XYZ_AXIS_ORDER":this.rotationGroup.rotation.set(0,0,0);break;case"OBJECT_3D_ZXY_AXIS_ORDER":this.rotationGroup.rotation.set(-Math.PI/2,0,-Math.PI/2)}if(this.x3d){this.pos3dSet||this.rotationGroup.position.set(this.width/2,-this.height/2,0);var e="";if(this.fileName)e=this.fileName.replace(/.x3d$/,".dae");else e=this.hrefPath.match("(.*?)/(x3d_.+?)\\.x3d")[2].replace(/_/,"/");if(e="./"+e.replace(/\\/g,"/"),Wd.debugServer){var r=e.split("/");e=r[r.length-1];this.loadCollada("assets/3d/dae/"+e)}else{var i=this.getResource(e);this.loadCollada(i)}return}this.createImage(0)}else this.isDirty3DSet(Yd.DIRTY_3D_COLOR)&&this.manager.applyColorMapping(this.loadedObject,this.colorMapping)},e.prototype.applyScale=function(){if(this.baseScale2DSet){var t=this.scalingFactor,e=this.baseScale2D;this.element.scale.set(t*e*this.scaleX,t*e*this.scaleY,t*this.scaleZ)}else{var r=this.scaleZ*this.scalingFactor;this.element.scale.set(r,r,r)}},e.prototype.getInternalResource=function(t){var e=this.networkManager;return e.getJarResourceURL?e.getJarResourceURL(t):e.getInternalResource(t)},e.prototype.getResource=function(t){var e=this.networkManager;return e.getResourceURL?e.getResourceURL(t):e.getRestRoot()+"resources?path="+t},e.prototype.createBox=function(){this.element.position.set(this.x,this.y,this.z),this.element.scale.set(1,1,1);var t=Math.min(this.width,this.height),e=.5+Math.random()/2;null==this.cubeMesh&&(this.cubeMesh=this.createMesh(!0));var r=new oa(this.width,this.height,t);this.cubeMesh.geometry=r,this.cubeMesh.position.set(this.width/2,-this.height/2,t/2),this.createImage(t+e)},e.prototype.createImage=function(t){var r=null;Wd.debugServer?r="assets/3d/images/"+this.hrefPath:this.networkManager&&(r=this.getInternalResource(this.hrefPath)),null==this.imageMesh&&(this.imageMesh=this.createMesh());var i=new la(this.width,this.height);this.imageMesh.geometry=i,this.imageMesh.position.set(this.width/2,-this.height/2,t);var n=Wd.imageCache[r];if(null==n){var a=e.textureLoader.load(r),o=new hu({map:a,depthTest:!0,transparent:!0});a.wrapS=vr,a.wrapT=vr,a.format=Ur,this.imageMesh.material=o,Wd.imageCache[r]=o,Ud.materials.set(o,!0)}else this.imageMesh.material=n},e.prototype.removeLights=function(){var t=[];this.loadedObject.traverse(function(e){e instanceof pc&&t.push(e)}),t.forEach(function(t){return t.parent.remove(t)})},e.prototype.setLayer=function(t){this.loadedObject.traverse(function(e){return e.layers.set(t)})},e.prototype.loadCallback=function(){var t=this;(this.loadedObject=this.manager.getObject(this.colorMapping),this.internalLights==e.LIGHTS_OFF)?this.removeLights():(!this.affectedBySceneLights||this.internalLights==e.LIGHTS_INSIDE)&&(this.layer=this.layerManager.add(this.affectedBySceneLights),this.loadedObject.traverse(function(e){return e.layers.set(t.layer)}));this.rotationGroup.add(this.loadedObject),this.replicatedCallbacks.forEach(function(t){return t.call(null)}),this.loaded=!0},e.prototype.loadCollada=function(t){var e=this;this.errorLoading=!1;var r=wp.getManager(t);if(this.manager=r,r.loadedObject)this.loadCallback();else{var i=function(t){null!=e.manager&&(e.loadCallback(),r.removeListener(i))};r.addListener(i)}return r.errorLoading?(this.errorLoading=!0,this.createBox()):r.addErrorCallback(this.errorCallback),this.rotationGroup},e.prototype.dispose=function(){null!=this.manager&&this.manager.removeErrorCallback(this.errorCallback),null!=this.imageMesh&&(this.rotationGroup.remove(this.imageMesh),Wd.disposeMesh(this.imageMesh),this.imageMesh=null),null!=this.cubeMesh&&(this.rotationGroup.remove(this.cubeMesh),Wd.disposeMesh(this.cubeMesh),this.cubeMesh=null),this.manager=null;var t=this.element.parent;null!=t&&t.remove(this.element),Wd.wipeObject(this)},e.LIGHTS_OFF="LIGHTS_OFF",e.LIGHTS_INSIDE="LIGHTS_INSIDE",e.LIGHTS_GLOBAL="LIGHTS_GLOBAL",e}(Yd),Mp=function(t){function e(e){var r=t.call(this,e)||this;return r._rx=0,r._ry=0,r}return Gd(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"rx"===e&&(this.rx=Number.parseFloat(r)),"ry"===e&&(this.ry=Number.parseFloat(r)),"r"===e&&(this.rx=this.ry=Number.parseFloat(r)),"cx"===e&&(this.x=Number.parseFloat(r)),"cy"===e&&(this.y=-Number.parseFloat(r))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var e=tp.ARC;e.rx=this.rx,e.ry=this.ry,e.x=e.y=e.z1=e.z2=e.startAngle=0,e.arcAngle=-Wd.TAU;var r=this.lineWidth/2,i=Hd.all;if(null!=this.lineColor){var n=new Yn;Wd.disposeGeometry(this.lineMesh.geometry),e.addPlanes(n,i,!1,this.zHeight,r),this.lineMesh.geometry=n,this.lineMesh.matrixWorldNeedsUpdate=!0,Wd.calculateTextureUVS(n)}if(null!=this.fillColor){null==this.lineColor&&(r=0);var a=new Yn;Wd.disposeGeometry(this.fillMesh.geometry),e.addPlanes(a,i,!0,this.zHeight,r),this.fillMesh.geometry=a,this.fillMesh.matrixWorldNeedsUpdate=!0,Wd.calculateTextureUVS(a)}}},Object.defineProperty(e.prototype,"rx",{get:function(){return this._rx},set:function(t){this._rx=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ry",{get:function(){return this._ry},set:function(t){this._ry=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e}(Jd),Op=function(t){function e(e){var r=t.call(this,e)||this;return r.levelHeight=20,r.nLevels=1,r.nPositions=5,r.cellWidth=10,r.nRacks=1,r.nDeep=1,r.length=1,r.depth=1,r.aisleDepth=1,r.depthR=1,r.cellsBetweenLegs=2,r.colorToCells=new Map,r.faceIndex=[],r.center=new Wi,r}return Gd(e,t),Object.defineProperty(e.prototype,"cellsMesh",{get:function(){if(null==this._cellsMesh){var t=new Yn,e=new hu({vertexColors:Ce}),r=new hu({vertexColors:Ce});r.opacity=0,r.transparent=!0,this._cellsMesh=new Ia(t,[e,r]),this.element.add(this._cellsMesh)}return this._cellsMesh},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){var i;if(t.prototype.updateParameter.call(this,e,r),"rack-data"===e&&(i=r.split(" ").map(function(t){return parseFloat(t)}),this.nRacks=i[0],this.nPositions=i[1],this.length=i[2],this.depth=i[3],this.cellWidth=i[4],this.aisleDepth=i[5],this.depthR=i[6],this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-n-levels"===e&&(this.nLevels=parseInt(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-n-deep"===e&&(this.nDeep=parseInt(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-level-height"===e&&(this.levelHeight=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-cells-between-legs"===e&&(this.cellsBetweenLegs=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-cells"===e){var n=r.split(":"),a=n[1].split(",").map(parseFloat);this.colorToCells.set(n[0],a)}},e.prototype.createCell=function(t){var e=this.cellsMesh.geometry;this.faceIndex[t]=e.faces.length;var r=this.nRacks*this.nDeep*this.nPositions,i=this.nDeep*this.nPositions,n=Math.floor(t/r);t%=r;var a=Math.floor(t/i);t%=i;var o=Math.floor(t/this.nDeep),s=t%this.nDeep,l=.8*this.cellWidth,u=.7*this.levelHeight,c=0==a?this.depth:this.depthR,h=c/this.nDeep;c=.8*c/this.nDeep;var d=0==a?0:this.depth/2+this.aisleDepth+this.depthR/2,p=this.cellWidth/2+o*this.cellWidth,f=-this.depth/2-d+(h/2+h*(s-this.nDeep/2)),m=u/2+this.levelHeight*n;this.center.set(p,f,m),zd.BOX.setupParallel(this.center,Wd.RIGHT,Wd.FRONT,c,u,l),zd.BOX.addPlanes(e)},e.prototype.setColor=function(t,e){var r=Ud.parseRGB(e),i=this.cellsMesh.geometry;null==this.faceIndex[t]&&this.createCell(t);for(var n=this.faceIndex[t],a=r.toThreeColor(),o=0;o<12;o++)i.faces[n+o].materialIndex=r.isNull()?1:0,i.faces[n+o].color=a;i.elementsNeedUpdate=!0},e.prototype.createCells=function(){for(var t=new Yn,e=.8*this.cellWidth,r=.7*this.levelHeight,i=new Wi,n=0;n<this.nLevels;n++)for(var a=r/2+this.levelHeight*n,o=0;o<this.nRacks;o++){var s=0==o?this.depth:this.depthR;s*=.8;for(var l=0==o?0:this.depth/2+this.aisleDepth+this.depthR/2,u=-this.depth/2-l,c=0;c<this.nPositions;c++){var h=this.cellWidth/2+c*this.cellWidth;i.set(h,u,a),zd.BOX.setupParallel(i,Wd.RIGHT,Wd.FRONT,s,r,e),zd.BOX.addPlanes(t)}}this.cellsMesh.geometry=t,Ud.GRAY.applyToMaterial(this.cellsMesh)},e.prototype.update3D=function(){var e=this;if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){Wd.disposeGeometry(this.lineMesh.geometry),Wd.disposeGeometry(this.fillMesh.geometry);for(var r=this.nPositions*this.cellWidth,i=this.depth,n=this.depthR,a=0,o=new Yn,s=new Yn,l=-i/2,u=-(n/2+this.aisleDepth+i),c=0;c<this.nLevels;c++){var h=new oa(r,i,.1);h.translate(r/2,l,a),s.merge(h),2==this.nRacks&&((h=new oa(r,n,.1)).translate(r/2,u,a),s.merge(h));for(var d=0;d<this.nPositions+1;d++){var p=this.cellWidth*d;if((b=new oa(.5,i,.5)).translate(p,l,a),o.merge(b),2==this.nRacks){var f=new oa(.5,n,.5);f.translate(p,u,a),o.merge(f)}}a+=this.levelHeight}if(this.nLevels>1&&this.cellsBetweenLegs>0){var m=this.levelHeight*(this.nLevels-1),g=[0,i];2==this.nRacks&&(g.push(i+this.aisleDepth),g.push(i+this.aisleDepth+n));for(c=0;c<this.nPositions+1;c++)for(d=0;d<g.length;d++){var b;p=this.cellWidth*c;if(c%this.cellsBetweenLegs==0||c==this.nPositions)(b=new oa(1,1,m)).translate(p,-g[d],m/2),o.merge(b)}}this.fillMesh.geometry=s,this.lineMesh.geometry=o}null!=this.colorToCells&&this.colorToCells.size>0&&(this.colorToCells.forEach(function(t,r){t.forEach(function(t){return e.setColor(t,r)})}),this.colorToCells.clear())},e}(Jd),Ip=function(t){function e(e){var r=t.call(this,e)||this;r.curve=new ip,r.type="";var i=Wd.getShapeType(e);return i!==lp.pathRailroad&&i!==lp.pathRoad&&i!==lp.pathConveyor||(r.lineColor=Ud.GRAY),r.type=i,r}return Gd(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"3d-d"==e&&(this.curve.parseSegments(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){if(this.curve.halfWidth=this.lineWidth/2,this.curve.zHeight=this.zHeight,this.type===lp.pathConveyor){var e=this.lineWidth/6;this.curve.zHeight=e,this.curve.segments.forEach(function(t){return t.shiftZ(-e)})}if(null!=this.lineColor){var r=new Yn;Wd.disposeGeometry(this.lineMesh.geometry),this.lineMesh.geometry=r,this.lineMesh.matrixWorldNeedsUpdate=!0,this.curve.fillPlanes(r),Wd.calculateTextureUVS(r)}if(null!=this.fillColor){var i=new Yn;Wd.disposeGeometry(this.fillMesh.geometry),this.fillMesh.geometry=i,this.fillMesh.matrixWorldNeedsUpdate=!0,this.curve.fillInner(i),Wd.calculateTextureUVS(i)}}},e}(Jd),_p=function(t){function e(e){var r=t.call(this,e)||this;return r.curve=new ip,r.width=0,r}return Gd(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.roadMesh=this.createMesh(),this.markingMesh=this.createMesh()},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"width"!==e&&"stroke-width"!==e||(this.width=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-d"==e&&(this.curve.parseSegments(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var e=new Yn;this.roadMesh.geometry=e,Ud.GRAY.applyToMaterial(this.roadMesh);var r=new Yn;this.markingMesh.geometry=r,Ud.WHITE.applyToMaterial(this.markingMesh);var i=this.width/2;this.curve.zHeight=.01,this.curve.halfWidth=i,this.curve.fillPlanes(e);var n=this.curve.length(),a=i/20,o=20*a,s=o+10*a,l=Math.floor(n/s);this.curve.shiftZ(.01),this.curve.halfWidth=a,this.curve.zHeight=.1,this.curve.planes=Hd.top;for(var u=0;u<l;u++){var c=s/2+s*u;this.curve.getCut(c,o).fillPlanes(r)}}},e}(Yd),Lp=function(t){function e(e){var r=t.call(this,e)||this;return r.curve=new hp,r.segmentsStr="",r.batchHelper=new op,r.diameter=0,r.offset=-1,r}return Gd(e,t),e.prototype.create3D=function(){var e=this;t.prototype.create3D.call(this),this.lineMesh=this.createMesh(),this.markMesh=this.createMesh(),this.batchHelper.create3D(this.element),this.batchHelper.updateBatch=function(t,r){var i=e.curve.length(),n=e.curve.getCut(t.offset*i,t.fraction*i);n.halfWidth-=.3,n.planes=Hd.all,n.fillPlanes(r)}},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),this.batchHelper.updateParameter(e,r),"color"===e&&(this.color=Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_LINE_COLOR)),"width"===e&&(this.diameter=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-d"==e&&(this.segmentsStr=r,this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"phase"===e&&(this.offset=parseFloat(r))},e.prototype.update3D=function(){t.prototype.update3D.call(this),null!=this.color&&this.isDirty3DSet(Yd.DIRTY_3D_LINE_COLOR)&&this.color.applyToMaterial(this.lineMesh);var e=this.diameter/2;if(this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){if(this.curve.halfWidth=e,this.curve.zHeight=this.diameter,this.curve.planes=Hd.sides,this.curve.roundness=2*this.diameter,this.curve.smallFaceCount=Wd.getFaceCount(e),this.curve.parseSegments(this.segmentsStr),null!=this.color){var r=new Yn;this.lineMesh.geometry=r,this.lineMesh.matrixWorldNeedsUpdate=!0,this.curve.fillPlanes(r),Wd.calculateTextureUVS(r)}var i=Ud.of(0,0,0);i.opacity=.3,i.applyToMaterial(this.markMesh)}this.offset>=0&&this.updateRings(e),this.batchHelper.update3D()},e.prototype.updateRings=function(t){Wd.disposeGeometry(this.markMesh.geometry);var e=new Yn;this.markMesh.geometry=e;var r=this.curve.length(),i=Math.floor(r/12),n=new np;n.faceCount=this.curve.smallFaceCount,n.radius=t+.2;for(var a=this.offset/12*12,o=0;o<i;o++){var s=a%12+6+12*o,l=this.curve.getPoint(s),u=this.curve.getNormal(s).clone(),c=l.clone(),h=l.clone();Wd.translateScaled(c,u,-.5),Wd.translateScaled(h,u,.5),n.setup(c,h,n.radius),n.fillPlanes(e,Hd.sides)}},e}(Yd),Pp=function(t){function e(e){var r=t.call(this,e)||this;return r.radius=0,r.lineWidth=1,r.connectors=new Array,r.shapeZ=0,r.drawCircle=!1,r}return Gd(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.lineMesh=this.createMesh()},e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"fill"===e&&(this.color=Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_LINE_COLOR)),"radius"===e&&(this.radius=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-connector"===e){var i=(new ip).parseSegments(r);this.connectors.push(i),this.setDirty3D(Yd.DIRTY_3D_SHAPE)}"3d-shape-z"===e&&(this.shapeZ=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"draw-circle"===e&&(this.drawCircle=!0,this.setDirty3D(Yd.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){var e=this;if(t.prototype.update3D.call(this),null!=this.color&&this.isDirty3DSet(Yd.DIRTY_3D_LINE_COLOR)&&this.color.applyToMaterial(this.lineMesh),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var r=new Yn;if(0!=this.radius){var i=tp.ARC;i.reset(),i.x=0,i.y=0,i.z1=i.z2=0,i.rx=i.ry=this.radius,i.autoFacecount=!1,i.addPlanes(r,Hd.all,!1,0,this.lineWidth/2),this.drawCircle||i.addPlanes(r,Hd.all,!0,0,this.lineWidth/2)}this.connectors.forEach(function(t){t.halfWidth=e.lineWidth/2,t.zHeight=0,t.translate(-e.x,-e.y,-e.shapeZ),t.fillPlanes(r)}),Wd.disposeGeometry(this.lineMesh.geometry),this.lineMesh.matrixWorldNeedsUpdate=!0,Wd.calculateTextureUVS(r),this.lineMesh.geometry=r}},e}(Yd),Rp=function(t){function e(e){var r=t.call(this,e)||this;r.curve=new ip,r._points=[],r._pointsZ=[],r.closed=!1;var i=Wd.getShapeType(e);return i!=lp.polygon&&i!=lp.polygonalNode&&i!=lp.conveyorCustomStation||(r.closed=!0),i==lp.conveyorCustomStation&&(r.lineWidth=.5),r}return Gd(e,t),Object.defineProperty(e.prototype,"points",{get:function(){return this._points},set:function(t){this._points=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointsZ",{get:function(){return this._pointsZ},set:function(t){this._pointsZ=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closed",{get:function(){return this._closed},set:function(t){this._closed=t},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"points"===e){var i=[];r.split(" ").forEach(function(t,e){if(t){var r=t.split(","),n=r[0],a=r[1],o=Number.parseFloat(n),s=Number.parseFloat(a);i.push(new Hi(o,-s))}}),this.points=i}if("3d-points-z"===e){var n=[];r.split(" ").forEach(function(t){""!=t&&n.push(parseFloat(t))}),this.pointsZ=n}},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){this.curve.segments=[];var e=this.points.length,r=this.closed?e:e-1;this.pointsZ.length!=e&&(0!=this.pointsZ.length&&console.error("Polyline3D: z coordinates mismatch: ",this.id,this.points,this.pointsZ),this.pointsZ=new Array(e).fill(0));for(var i=0;i<r;i++){var n=this.points[i%e],a=this.points[(i+1)%e],o=this._pointsZ[i%e],s=this._pointsZ[(i+1)%e],l=new Wi(n.x,n.y,o),u=new Wi(a.x,a.y,s);this.curve.segments.push((new rp).setup(l,u))}if(this.curve.zHeight=this.zHeight,this.curve.halfWidth=this.lineWidth/2,this.curve.closed=this.closed,this.curve.dzFill=-.0095,null!=this.lineColor){Wd.disposeGeometry(this.lineMesh.geometry);var c=new Yn;this.lineMesh.geometry=c,this.lineMesh.matrixWorldNeedsUpdate=!0,this.curve.fillPlanes(c),Wd.calculateTextureUVS(c)}if(null!=this.fillColor){Wd.disposeGeometry(this.fillMesh.geometry);var h=new Yn;this.fillMesh.geometry=h,this.fillMesh.matrixWorldNeedsUpdate=!0,this.curve.fillInner(h),Wd.calculateTextureUVS(h)}}},e}(Jd),Fp=function(t){function e(e){var r=t.call(this,e)||this;return r.curve=new ip,r.width=0,r}return Gd(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.railMesh=this.createMesh(),this.tieMesh=this.createMesh()},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"width"!==e&&"stroke-width"!==e||(this.width=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-d"==e&&(this.curve.parseSegments(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var e=this.width/2,r=e/2,i=r/12,n=r+i,a=3*i,o=e/20,s=o,l=4*o,u=e,c=Math.floor(this.curve.length()/u);this.curve.zHeight=a,this.curve.halfWidth=i;var h=this.curve.getShifted(-n),d=this.curve.getShifted(n),p=new Yn;h.fillPlanes(p),d.fillPlanes(p),this.railMesh.geometry=p,Ud.GRAY.applyToMaterial(this.railMesh);var f=new Yn;this.tieMesh.geometry=f,Ud.SIENNA.applyToMaterial(this.tieMesh);for(var m=0;m<c;m++){var g=u/2+m*u,b=this.curve.getPoint(g),v=this.curve.getNormal(g),y=b.clone();Wd.translateScaled(y,v,l),zd.BOX.setupStraitSegment(b,y,s,e),zd.BOX.addPlanes(f,Hd.all)}}},e}(Yd),Dp=function(t){function e(e){var r=t.call(this,e)||this;return r._width=0,r._height=0,r}return Gd(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"width"==e&&(this.width=Number.parseFloat(r)),"height"==e&&(this.height=Number.parseFloat(r))},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var e=this.width,r=this.height,i=null==this.lineColor?0:this.lineWidth/2,n=[new Hi(-i,i),new Hi(e+i,i),new Hi(e+i,-r-i),new Hi(-i,-r-i)],a=[new Hi(i,-i),new Hi(i,-r+i),new Hi(e-i,-r+i),new Hi(e-i,-i)],o=new dc(n);o.holes=[new hc(a)];var s=new dc(a),l={steps:2,depth:Math.max(this.zHeight,.01),bevelEnabled:!1};if(null!=this.lineColor){Wd.disposeGeometry(this.lineMesh.geometry);var u=new Bl(o,l);this.lineMesh.geometry=u,this.lineMesh.matrixWorldNeedsUpdate=!0,u.faceVertexUvs[0].forEach(function(t){return t.forEach(function(t){return t.multiplyScalar(.05)})})}if(null!=this.fillColor&&e/2>i&&r/2>i){Wd.disposeGeometry(this.fillMesh.geometry);var c=new Bl(s,l);this.fillMesh.geometry=c,this.fillMesh.matrixWorldNeedsUpdate=!0,c.faceVertexUvs[0].forEach(function(t){return t.forEach(function(t){return t.multiplyScalar(.05)})})}}},e}(Jd),Np=function(t){function e(e){var r=t.call(this,e)||this;return r.originId="",r.setup=!1,r.copied=!1,r}return Gd(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"href"===e&&(this.originId=r.substring(1))},e.prototype.findObject3D=function(t,e){var r=this;t instanceof xp?e.push(t):t instanceof vp&&t.children.forEach(function(t){return r.findObject3D(t,e)})},e.prototype.update3D=function(){var e=this;if(!this.setup&&null!=this.animation){this.origin=this.animation.shapes.get(this.originId);var r=[];if(this.findObject3D(this.origin,r),r.length>0){var i=0,n=function(){++i==r.length&&e.doShallowCopy()};r.forEach(function(t){t.loaded||t.errorLoading?n():t.replicatedCallbacks.push(n)})}else this.doShallowCopy();this.setup=!0}t.prototype.update3D.call(this)},e.prototype.doShallowCopy=function(){if(!this.copied){var t=new Hn;wp.shallowCloneChildren(this.origin.element,t),wp.copy(this.origin.element,t),this.element.add(t),this.copied=!0}},e}(Yd),Bp=function(t){function e(e){var r=t.call(this,e)||this;return r.laneWidth=0,r.medianWidth=0,r.delimiterWidth=0,r.lanes=[],r.delimiters=[],r.median=new ip,r}return Gd(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"lane-color"===e&&(this.laneColor=Ud.parseRGB(r)),"lane-width"===e&&(this.laneWidth=parseFloat(r)),"3d-forward-lane"!==e&&"3d-backward-lane"!==e||this.lanes.push((new ip).parseSegments(r)),"lane-delimiter-color"===e&&(this.delimiterColor=Ud.parseRGB(r)),"lane-delimiter-width"===e&&(this.delimiterWidth=parseFloat(r)),"3d-lane-delimiter"===e&&this.delimiters.push((new ip).parseSegments(r)),"median-color"===e&&(this.medianColor=Ud.parseRGB(r)),"median-width"===e&&(this.medianWidth=parseFloat(r)),"3d-median"===e&&this.median.parseSegments(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)},e.prototype.create3D=function(){t.prototype.create3D.call(this),this.laneMesh=this.createMesh(),this.delimiterMesh=this.createMesh(),this.medianMesh=this.createMesh()},e.prototype.update3D=function(){var e=this;if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){if(null!=this.laneColor){this.laneColor.applyToMaterial(this.laneMesh);var r=new Yn;this.laneMesh.geometry=r,this.laneMesh.matrixWorldNeedsUpdate=!0,this.lanes.forEach(function(t){t.halfWidth=e.laneWidth/2,t.zHeight=0,t.fillPlanes(r),Wd.calculateTextureUVS(r)})}if(null!=this.delimiterColor){this.delimiterColor.applyToMaterial(this.delimiterMesh);var i=new Yn;this.delimiterMesh.geometry=i,this.delimiterMesh.matrixWorldNeedsUpdate=!0,this.delimiters.forEach(function(t){t.halfWidth=e.delimiterWidth/2,t.zHeight=.1,t.continuous=!1,t.fillPlanes(i),Wd.calculateTextureUVS(i)})}if(null!=this.medianColor){this.medianColor.applyToMaterial(this.medianMesh);var n=new Yn;this.medianMesh.geometry=n,this.medianMesh.matrixWorldNeedsUpdate=!0,this.median.halfWidth=this.medianWidth/2,this.median.zHeight=.1,this.median.continuous=!1,this.median.fillPlanes(n),Wd.calculateTextureUVS(n)}}},e}(Yd),Gp=function(t){function e(e){var r=t.call(this,e)||this;return r.markingCurve=new ip,r.fillingCurve=new ip,r.type="",r.type=Wd.getShapeType(e),r}return Gd(e,t),e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"3d-d"!==e&&"3d-marking"!==e||(this.markingCurve.parseSegments(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-area"===e&&(this.fillingCurve.parseSegments(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-line-width"===e&&(this.lineWidth=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){if(this.markingCurve.halfWidth=this.lineWidth/2,this.markingCurve.zHeight=this.zHeight+.1,this.markingCurve.continuous=!1,this.fillingCurve.halfWidth=0,this.fillingCurve.zHeight=this.zHeight,this.type===lp.conveyorStation&&(this.fillingCurve.dzFill=.01),null!=this.lineColor){var e=new Yn;this.lineMesh.geometry=e,this.lineMesh.matrixWorldNeedsUpdate=!0,this.markingCurve.fillPlanes(e),Wd.calculateTextureUVS(e)}if(null!=this.fillColor){var r=new Yn;this.fillMesh.geometry=r,this.fillMesh.matrixWorldNeedsUpdate=!0,this.fillingCurve.fillInner(r),Wd.calculateTextureUVS(r)}}},e}(Jd),Up=function(t){function e(e){var r=t.call(this,e)||this;return r.progress=0,r.radius=0,r._zHeight=0,r.batchHelper=new op,r.cylinder=new np,r.p1=new Wi,r.p2=new Wi,r}return Gd(e,t),Object.defineProperty(e.prototype,"zHeight",{get:function(){return this._zHeight},set:function(t){this._zHeight=t,this.setDirty3D(Yd.DIRTY_3D_SHAPE)},enumerable:!0,configurable:!0}),e.prototype.create3D=function(){var e=this;t.prototype.create3D.call(this),this.lineMesh=this.createMesh(),this.progressMesh=this.createMesh(),this.progressColor=Ud.of(0,0,0),this.progressColor.opacity=.4,this.batchHelper.create3D(this.element),this.batchHelper.updateBatch=function(t,r){var i=Math.max(.01,e.zHeight*t.offset),n=i+Math.max(0,e.zHeight*t.fraction-.2),a=e.radius-.5;e.p1.set(0,0,i),e.p2.set(0,0,n),e.cylinder.setup(e.p1,e.p2,a),e.cylinder.fillPlanes(r,Hd.all)}},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),this.batchHelper.updateParameter(e,r),"color"===e&&(this.color=Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_LINE_COLOR)),"radius"===e&&(this.radius=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-z-height"===e&&(this.zHeight=parseFloat(r)),"progress"===e&&(this.progress=parseFloat(r))},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),null!=this.color&&this.isDirty3DSet(Yd.DIRTY_3D_LINE_COLOR)&&this.color.applyToMaterial(this.lineMesh),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){this.cylinder.faceCount=Wd.getFaceCount(this.radius);var e={depth:this.zHeight,bevelEnabled:!1},r=this.radius,i=new Yu(0,0,r,r,0,2*Math.PI,!1,0);if(null!=this.color){var n=new Bl(new dc(i.getPoints(100)),e);this.lineMesh.geometry=n,this.lineMesh.matrixWorldNeedsUpdate=!0,n.faceVertexUvs[0].forEach(function(t){return t.forEach(function(t){return t.multiplyScalar(.05)})})}}if(0==this.progress)this.progressMesh.geometry=Wd.getSharedGeometry();else{var a=tp.ARC,o=new Yn,s=this.radius/20;a.x=a.y=0,a.z1=a.z2=this.zHeight+.1,a.rx=a.ry=this.radius-s,a.startAngle=Wd.TAU/4,a.arcAngle=-Wd.TAU*this.progress,a.fillPlanes(o,Hd.top,0,s),Wd.disposeGeometry(this.progressMesh.geometry),this.progressMesh.geometry=o,this.progressColor.applyToMaterial(this.progressMesh),this.progress=0}this.batchHelper.update3D()},e}(Yd),Hp=function(t){function e(e){var r=t.call(this,e)||this;return r.lineHeight=0,r}return Gd(e,t),e.prototype.create3D=function(){t.prototype.create3D.call(this),this.mesh=this.createMesh()},e.prototype.updateParameter=function(e,r){t.prototype.updateParameter.call(this,e,r),"fill"===e&&(this.fillColor=r,this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"text-content"===e&&(this.text=r,this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"font"===e&&(this.font=r,this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"text-anchor"===e&&(this.textAnchor=r,this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"line-height"===e&&(this.lineHeight=Math.round(parseFloat(r)),this.setDirty3D(Yd.DIRTY_3D_SHAPE))},e.prototype.nextPower=function(t){for(var e=1;t>e;)e*=2;return e},e.prototype.update3D=function(){if(t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)){var e=document.createElement("canvas");e.width=200,e.height=200;var r=e.getContext("2d");r.fillStyle=this.fillColor,r.font=this.font,r.textBaseline="top";for(var i=.01,n=this.text.split(/\r\n/),a=n.length,o=0;o<a;o++){var s=r.measureText(n[o]);i=Math.max(i,s.width)}var l=i,u=this.lineHeight*a,c=64/this.lineHeight,h=this.nextPower(c*l),d=this.nextPower(c*u);e.width=h,e.height=d,(r=e.getContext("2d")).fillStyle=this.fillColor,r.font=this.font,r.textBaseline="top";var p=0;"middle"===this.textAnchor&&(r.textAlign="center",p=l/2),"end"===this.textAnchor&&(r.textAlign="end",p=l),r.scale(h/l,d/u);for(o=0;o<a;o++)r.fillText(n[o],p,0+o*this.lineHeight);var f=new hu;f.map=new ln(e),f.transparent=!0,f.map.needsUpdate=!0;var m=new la(l,u);this.mesh.geometry=m,this.mesh.material=f,this.mesh.position.set(l/2-p,-u/2,0)}},e}(Yd),zp=function(t){function e(r){var i=t.call(this,r)||this;return i.width=50,i.height=50,i.zHeight=100,i.platformHeight=10,i.platformZ=50,i.platformVisible=!0,i.type=e.PLATFORM_ROLLER,i.platformColor=Ud.GRAY,i.frameColor=Ud.SIENNA,i}return Gd(e,t),e.prototype.testAnimate=function(){var t=this,e=.3,r=1e4,i=function(){r>0&&(r--,(t.platformMesh.position.z>t.zHeight||t.platformMesh.position.z<0)&&(e*=-1),t.platformMesh.position.z+=e,setTimeout(i,16))};i()},e.prototype.create3D=function(){t.prototype.create3D.call(this),this.platformMesh=this.createMesh(),this.frameMesh=this.createMesh(),this.platformInnerMesh=this.createMesh(),this.platformMesh.add(this.platformInnerMesh)},e.prototype.updateParameter=function(e,r){if(t.prototype.updateParameter.call(this,e,r),"width"===e&&(this.width=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"height"===e&&(this.height=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-z-height"===e&&(this.zHeight=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"fill"===e&&(this.platformColor=Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"stroke"===e&&(this.frameColor=Ud.parseRGB(r),this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-type"===e&&(this.type=r,this.setDirty3D(Yd.DIRTY_3D_SHAPE)),"3d-platform-visible"===e){var i="true"==r;this.platformVisible!=i&&(this.platformVisible=i,this.setDirty3D(Yd.DIRTY_3D_VISIBILITY))}"3d-platform-z"===e&&(this.platformZ=parseFloat(r),this.setDirty3D(Yd.DIRTY_3D_VISIBILITY))},e.prototype.update3D=function(){t.prototype.update3D.call(this),this.isDirty3DSet(Yd.DIRTY_3D_SHAPE)&&(this.createFrame(),this.createPlatform()),this.isDirty3DSet(Yd.DIRTY_3D_VISIBILITY)&&(this.platformMesh.visible=this.platformVisible),this.platformMesh.position.z=this.platformZ},e.prototype.createPlatform=function(){switch(this.platformHeight=this.width/8,this.platformMesh.geometry=new Yn,this.platformColor.applyToMaterial(this.platformMesh),this.platformInnerMesh.geometry=new Yn,this.frameColor.applyToMaterial(this.platformInnerMesh),this.type){case e.PLATFORM_FLAT:this.createFlatPlatform(this.platformHeight);break;case e.PLATFORM_ROLLER:this.createRollerPlatform(this.platformHeight)}},e.prototype.createRollerPlatform=function(t){var e=-t/2,r=1.3*t,i=Math.round(this.height/r)+1;i=Math.max(2,i);var n=this.height/(i-1),a=new np;a.faceCount=8;for(var o=new Wi,s=new Wi,l=0;l<i;l++){var u=-this.height/2+n*l;o.set(-this.width/2,u,e),s.set(this.width/2,u,e),a.setup(o,s,t/2),a.fillPlanes(this.platformMesh.geometry)}var c=[],h=Wd.DX,d=Wd.DY;for(l=0;l<4;l++){var p=(l+1)%4,f=this.width/2*h[p];u=this.height/2*d[p];c.push(new Wi(f,u,e))}var m=.5*t;Wd.addBulks(this.platformInnerMesh.geometry,c,m)},e.prototype.createFlatPlatform=function(t){var e=new Wi(0,0,-t/2);zd.BOX.setupParallel(e,Wd.RIGHT,Wd.FRONT,this.height,t,this.width),zd.BOX.addPlanes(this.platformMesh.geometry);var r=1.005*this.width,i=.5*t,n=1.005*this.height;zd.BOX.setupParallel(e,Wd.RIGHT,Wd.FRONT,n,i,r),zd.BOX.addPlanes(this.platformInnerMesh.geometry)},e.prototype.createFrame=function(){var t=new Yn;this.frameMesh.geometry=t,this.frameColor.applyToMaterial(this.frameMesh);var e=this.width/30,r=this.width+e,i=this.height+e,n=Wd.DX,a=Wd.DY,o=[],s=[0];if(0!=this.zHeight){for(var l=0;l<4;l++){var u=r/2*n[l],c=i/2*a[l],h=new Wi(u,c,0),d=new Wi(u,c,this.zHeight);o.push(h,d)}s.push(this.zHeight)}var p=function(t){var e=r/2*n[t],l=i/2*a[t],u=(t+1)%4,c=r/2*n[u],h=i/2*a[u];s.forEach(function(t){var r=new Wi(e,l,t),i=new Wi(c,h,t);o.push(r,i)})};for(l=0;l<4;l++)p(l);Wd.addBulks(t,o,e)},e.PLATFORM_FLAT="LIFT_PLATFORM_FLAT",e.PLATFORM_ROLLER="LIFT_PLATFORM_ROLLER",e}(Yd),Wp=function(){function t(t){this.world=t,this.lastFrameNumber=-1,this.requestInterval=500,this.frameInterval=40,this.frameDelayInput=document.getElementById("frameDelay"),this.requestDelayInput=document.getElementById("requestDelay"),this.loopInfo=document.getElementById("loopInfo"),this.requestInfo=document.getElementById("requestInfo"),this.requestHandle=0,this.frameLoopHandle=0,this.shapes=new Map,this.frameBuffer=[],this.lastTime=new Date,this.lastRender=new Date,this.rootGroup=t.rootGroup}return t.prototype.doRequest=function(t){var e=this,r="http://10.0.103.56:4567/http/update?fullFrame="+t;window.fetch(r).then(function(t){return t.json()}).then(function(r){var i=r.frames;if(i.forEach(function(t){return e.frameBuffer.push(t)}),console.log(i.length),e.requestInfo){var n=new Date;e.requestInfo.textContent="Last request ("+t+"):  "+n+":"+n.getMilliseconds()+" "}})},t.prototype.startLoopRequest=function(){var t=this;this.requestDelayInput&&(this.requestInterval=Number.parseFloat(this.requestDelayInput.value)),this.doRequest(!1),this.requestHandle=window.setTimeout(function(){return t.startLoopRequest()},this.requestInterval)},t.prototype.stopLoopRequest=function(){window.clearTimeout(this.requestHandle)},t.prototype.requestFullFrame=function(){this.doRequest(!0)},t.prototype.applyCommand=function(t){switch(t.cmd){case"C":this.create3DElement(t);break;case"U":this.updateElement(t);break;case"D":this.deleteElement(t.id)}},t.prototype.applyFrame=function(t){var e=this;this.lastFrameNumber=t.number,t.commands.forEach(function(t){e.applyCommand(t)})},t.prototype.gotoFrame=function(t){for(var e=0;e<=t;e++)this.applyFrame(this.frameBuffer[e])},t.prototype.frameLoop=function(){var t=this,e=new Date,r=e.valueOf()-this.lastTime.valueOf();if(this.lastTime=e,this.frameDelayInput&&(this.frameInterval=Number.parseFloat(this.frameDelayInput.value)),this.loopInfo&&(this.loopInfo.textContent=e+":"+r),this.frameBuffer.length>0){var i=this.frameBuffer.shift();this.applyFrame(i)}this.frameLoopHandle=setTimeout(function(){return t.frameLoop()},this.frameInterval)},t.prototype.stopFrameLoop=function(){window.clearTimeout(this.frameLoopHandle)},t.prototype.create3DElement=function(t){var e=null,r=Wd.getShapeType(t),i=Wd.getAttributeValue(t,"owner-id"),n=Wd.getAttributeValue(t,"draw-mode");if(r===lp.window3D&&(i=null,n="3D",this.world.canvases3d.forEach(function(r){"canvas3d-1"==r.canvas.id&&((e=r).id=t.id,n="2D")})),"3D"===n||"2D3D"===n)switch(r){case lp.ellipse:case lp.circle:case lp.circularWall:e=new Mp(t);break;case lp.rect:case lp.rectangularNode:case lp.rectangularWall:e=new Dp(t);break;case lp.line:e=new Ap(t);break;case lp.polyline:case lp.polygon:case lp.conveyorCustomStation:case lp.polygonalNode:e=new Rp(t);break;case lp.group:case lp.shapeModelElementsGroup:e=new vp(t);break;case lp.image:case lp.shapeImage:var a=new xp(t);a.networkManager=this.world.networkManager,a.layerManager=this.world.layerManager,e=a;break;case lp.shapeArc:e=new ep(t);break;case lp.shapeText:e=new Hp(t);break;case lp.pathLine:case lp.pathDashline:case lp.pathWall:e=new Ip(t);break;case lp.pathRailroad:e=new Fp(t);break;case lp.pathRoad:e=new _p(t);break;case lp.pointNode:e=new Pp(t);break;case lp.road:e=new Bp(t);break;case lp.parkingLot:case lp.stopLine:case lp.busStop:case lp.intersection:e=new Gp(t);break;case lp.conveyorStation:case lp.conveyorTurntable:case lp.conveyorTurnStation:case lp.conveyorTransferTable:case lp.conveyorSplit:e=new up(t);break;case lp.serviceWithLines:e=new bp(t);break;case lp.window3D:e=new Kd(t);break;case lp.pipe:e=new Lp(t);break;case lp.storageTank:e=new Up(t);break;case lp.bulkConveyorBelt:case lp.pathConveyor:case lp.conveyorPath:e=new sp(t);break;case lp.palletRack:e=new Op(t);break;case lp.escalator:e=new gp(t);break;case lp.light3D:var o=new yp(t);null!=o.type&&(o.scene=this.world.scene,e=o,this.world.defaultLights.visible=!1);break;case lp.replicated:var s=new Np(t);s.animation=this,e=s;break;case lp.towerCrane:e=new mp(t);break;case lp.lift:e=new zp(t)}if(null!=e)if(e.create3D(),e.updateElement(t),this.shapes.set(t.id,e),i&&"null"!=i){var l=this.shapes.get(i);l instanceof vp?l.add(e):console.log("Group "+i+" not found")}else null!=e.element&&this.rootGroup.add(e.element);return e},t.prototype.updateElement=function(t){if(this.shapes){var e=this.shapes.get(t.id);null!=e&&e.updateElement(t)}},t.prototype.deleteElement=function(t){var e=this,r=this.shapes.get(t);null!=r&&(r instanceof vp&&r.children.slice(0).forEach(function(t){e.deleteElement(t.id)}),null!=r.parent&&r.parent.remove(r),this.shapes.delete(t),r.dispose())},t.prototype.cleanRoot=function(){var t=this,e=[];this.shapes.forEach(function(t,r){null!=t.parent||t instanceof Kd||(e.push(r),console.log("AnimationClient: Root group to remove:",r))}),e.forEach(function(e){return t.deleteElement(e)});for(var r=this.rootGroup.children.length,i=0;i<r;i++){var n=this.rootGroup.children[0];this.rootGroup.remove(n),Wd.wipeObject3D(n)}this.shapes.clear(),this.world.defaultLights.visible=!0},t.prototype.cleanAll=function(){this.cleanRoot(),this.frameBuffer=[],this.lastFrameNumber=-1},t.prototype.printTreeId=function(t){window.ptree="",this.printTree(this.shapes.get(t+""))},t.prototype.printElements=function(){this.shapes.forEach(function(t,e){return console.log(e+": "+t.constructor.name,t)})},t.prototype.printTree=function(t,e){var r=this;void 0===e&&(e="");var i=e+t.constructor.name+": "+t.id;window.ptree+=i+"\n",t instanceof vp&&t.children.forEach(function(t){r.printTree(t,e+"\t")})},t.prototype.getShapesInfo=function(){var t=Wd.getSize(this.world.rootGroup,0,0),e=t[0],r=t[1],i="Shapes: "+this.shapes.size+" (Elements: "+e+", Meshes: "+r+" )\n",n=new Map,a=new Map,o=new Map;return this.shapes.forEach(function(t,e){var r=t.constructor.name,i=n.get(r),s=Wd.getSize(t.element,0,0),l=s[0],u=s[1];n.set(r,null==i?1:i+1);var c=a.get(r);a.set(r,null==c?l:c+l);var h=o.get(r);o.set(r,null==h?u:h+u)}),n.forEach(function(t,e){i+=e+" : "+t+" ("+a.get(e)+", "+o.get(e)+")\n"}),i},t.prototype.findElements=function(t){var e=[];return this.shapes.forEach(function(r){null==r.element?console.log(r.id,r):r.element.name.match(t)&&e.push(r.element)}),e},t}(),Vp=function(){function t(t){this.world=t,this.lastId=0,this.layers=new Set}return t.prototype.add=function(t){var e=this;return this.lastId++,this.layers.add(this.lastId),t&&this.iterateLights(function(t){return t.layers.enable(e.lastId)}),this.lastId},t.prototype.reset=function(){this.lastId=0,this.layers.clear()},t.prototype.remove=function(t){this.layers.delete(t),this.iterateLights(function(e){return e.layers.disable(t)})},t.prototype.iterateLights=function(t){this.world.ambientLight.traverse(t),this.world.defaultLights.traverse(t),this.world.animation.shapes.forEach(function(e,r){e instanceof yp&&e.element.traverse(t)})},t}(),Yp=function(){function t(){this.canvases3d=[],this.active=!1,this.initialized=!1,this.backgroundColor=Kd.DEFAULT_COLOR,this.gridColor=null,this.skybox=""}return t.getWorld=function(){return null==t._world&&(t._world=new t),t._world},t.prototype.activate=function(){ee&&(this.init(),this.active=!0)},t.prototype.deactivate=function(){this.clean(),this.active=!1},t.prototype.updateGrid=function(){var t=this.gridColor;if(null!=this.grid&&(this.scene.remove(this.grid),this.grid=null),null!=t){var e=new Vh(5e3,50,t,t);e.rotation.x=Math.PI/2,this.scene.add(e),this.grid=e}},t.prototype.init=function(){if(this.initialized)this.clean();else{if(this.layerManager=new Vp(this),this.scene=new Os,this.rootGroup=new hs,this.rootGroup.name="Root Group",this.scene.add(this.rootGroup),this.defaultLights=Wd.createDefaultLight(),this.ambientLight=new Cc(5263440),this.defaultLights.name="Lights",Wd.debugServer){this.gridColor=new xn(6710886);var t=new td(200);this.scene.add(t),window.lights=this.defaultLights,window.ambientLight=this.ambientLight}if(this.scene.add(this.ambientLight),this.scene.add(this.defaultLights),""!=this.skybox){var e=(new zu).setPath("assets/3d/skyboxes/"+this.skybox+"/").load(["xn.jpg","xp.jpg","yp.jpg","yn.jpg","zp.jpg","zn.jpg"]);this.scene.background=e}this.animation=new Wp(this),this.initialized=!0}this.updateGrid()},t.prototype.createCanvas3D=function(t,e){if(this.initialized){var r=this.animation.shapes.get(t),i=void 0;return i=r instanceof Kd?r:new Kd({cmd:"C",id:t,att:[],val:[]}),0==this.canvases3d.length&&Wd.debugInfo&&(i.showStats=!0,window.Object3DManager=wp),i.setup(this,e),i.init(),this.canvases3d.push(i),i}console.warn("Wordl3d.createCanvas: not initialized")},t.prototype.clean=function(){this.initialized&&(this.canvases3d.forEach(function(t){return t.dispose()}),this.canvases3d=[],this.animation.cleanRoot(),this.cleanCache(),this.layerManager.reset())},t.prototype.cleanCache=function(){for(var t in Wd.imageCache)Wd.imageCache[t].dispose();Wd.imageCache=[];for(var e=0,r=Ud.cache;e<r.length;e++){t=r[e];Ud.cache[t].dispose()}Ud.cache=[],Ud.materials.clear()},t.prototype.updateCanvasSize=function(t,e){this.canvases3d.forEach(function(r){r.canvas===t&&(r.updateSize(),r.renderActive=e)})},t.prototype.applyFrame=function(e,r){if(void 0===r&&(r=!1),e.fullFrame||r){for(var i=!1,n=0,a=e.commands;n<a.length;n++){var o=a[n];if("C"===o.cmd&&"Window3D"===Wd.getShapeType(o)){i=!0;break}if("N"===o.cmd){for(var s=t.DEFAULT_COLOR,l=null,u="",c=0;c<o.att.length;c++){var h=o.att[c],d=o.val[c];null!=d&&"none"!=d&&("3d-background-color"===h&&(s=Ud.parseRGB(d).toThreeColor()),"3d-grid-color"===h&&(l=Ud.parseRGB(d).toThreeColor()),"3d-skybox"===h&&(u=d))}this.backgroundColor=s,this.gridColor=l,this.skybox=u}}i?this.activate():this.deactivate()}this.active&&this.animation.applyFrame(e)},t.prototype.gotoFrame=function(t){t==this.animation.lastFrameNumber+1?this.animation.applyFrame(this.animation.frameBuffer[t]):(this.animation.cleanRoot(),this.canvases3d.forEach(function(t){return t.active=!1}),this.animation.gotoFrame(t),this.canvases3d.forEach(function(t){return t.active=!0}))},t.prototype.getInfo=function(){for(var t=0,e=0,r=0;r<wp.managers.length;r++){var i=wp.managers[r];t+=i.listeners.size,e+=i.errorCallbacks.size}var n=Ud.materials.size;console.log("Object3DManager: listeners: "+t+", ErrorCallbacks: "+e+", Colors: "+n)},t.DEFAULT_COLOR=new xn(11184810),t}(),jp=function(){function t(){}return t.create=function(t){var e=Zt.createSvgElement("rect"),r=Zt.createCanvas(t,"canvas-group-3d");return e.setAttribute("stroke","none"),e.setAttribute("fill","gray"),Yp.getWorld().createCanvas3D(t,r),e},t.update=function(e,r,i){for(var n=e,a=document.getElementById(e.id+"canvas"),o=0;o<r.length;o++)switch(r[o]){case"width":case"height":n.setAttribute(r[o],i[o]),t.syncCanvas3DPosition(a);break;default:hf.filterAndSetAttribute(e,r[o],i[o]),"pos"!=r[o]&&"scale"!=r[o]||t.syncCanvas3DPosition(a)}},t.syncCanvas3DPosition=function(t){var e=parseInt(t.id),r=document.getElementById(e.toString());if(null!=r.getAttribute("height")&&null!=r.getAttribute("width")){var i=r.getBoundingClientRect(),n=t.parentNode.getBoundingClientRect(),a=i.left-n.left,o=i.top-n.top;t.style.left=a+"px",t.style.top=o+"px";var s=Math.round(i.width),l=Math.round(i.height);if((s!=t.width||l!=t.height)&&(t.width=s,t.height=l,t.style.width=s+"px",t.style.height=l+"px",!Yp.getWorld().active)){var u=t.getContext("2d");u.fillStyle="rgba(255,0,0,0.2)",u.fillRect(0,0,t.width,t.height)}Yp.getWorld().updateCanvasSize(t,!0)}},t.syncAllCanvas3DPositions=function(){for(var e=document.getElementById("canvas-group-3d").children,r=0,i=[].slice.call(e);r<i.length;r++){var n=i[r];n instanceof HTMLCanvasElement&&t.syncCanvas3DPosition(n)}},t}(),Xp=function(){function t(t){var e=this;this.client=t,this.onWindowResizeEventClosure=function(t){return e.applyNavigationSettings()},this.onSVGPointingEventClosure=function(t){return e.onSVGPointingEvent(t)}}return t.prototype.initSVGNavigation=function(){window.addEventListener("resize",this.onWindowResizeEventClosure,!1),w.addFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.oncontextmenu=function(){return!1},t.addEventListener("mousedown",this.onSVGPointingEventClosure),t.addEventListener("mousemove",this.onSVGPointingEventClosure),t.addEventListener("mouseup",this.onSVGPointingEventClosure),t.addEventListener("mouseout",this.onSVGPointingEventClosure),t.addEventListener("wheel",this.onSVGPointingEventClosure),t.addEventListener("touchstart",this.onSVGPointingEventClosure),t.addEventListener("touchmove",this.onSVGPointingEventClosure),t.addEventListener("touchend",this.onSVGPointingEventClosure),this.buttonDown=0,this.prevPtrCoords=[],this.presentationCoords=[0,0],this.zoom=1},t.prototype.clearSVGNavigation=function(){if(this.client.svg){window.removeEventListener("resize",this.onWindowResizeEventClosure),w.removeFullScreenListener(this.onWindowResizeEventClosure);var t=this.client.svg.parentNode;t.removeEventListener("mousedown",this.onSVGPointingEventClosure),t.removeEventListener("mousemove",this.onSVGPointingEventClosure),t.removeEventListener("mouseup",this.onSVGPointingEventClosure),t.removeEventListener("mouseout",this.onSVGPointingEventClosure),t.removeEventListener("wheel",this.onSVGPointingEventClosure),t.removeEventListener("touchstart",this.onSVGPointingEventClosure),t.removeEventListener("touchmove",this.onSVGPointingEventClosure),t.removeEventListener("touchend",this.onSVGPointingEventClosure)}},t.prototype.onSVGPointingEvent=function(e){if(e.target instanceof HTMLCanvasElement&&"canvas-group-3d"==e.target.parentElement.id)return;e.stopPropagation();var r=Kt.offsetPage(this.client.svg);if(e.type.startsWith("mouse")||"wheel"==e.type){var i=e,n=i.pageX-r.left,a=i.pageY-r.top;switch(i.type){case"mousedown":this.buttonDown=i.which,this.prevPtrCoords=[n,a],1==this.buttonDown||this.buttonDown;break;case"mousemove":if(1==this.buttonDown)i.preventDefault();else if(3==this.buttonDown){var o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];this.applyPanning(o,s),this.prevPtrCoords=[n,a]}break;case"mouseup":case"mouseout":if(this.client.svg.parentNode.contains(i.relatedTarget))return;var l=this.buttonDown;if(this.buttonDown=0,1==l){o=n-this.prevPtrCoords[0],s=a-this.prevPtrCoords[1];Math.abs(o)<=t.clickTolerance&&Math.abs(s)<=t.clickTolerance&&this.onPresentationClick(i,n,a)}this.prevPtrCoords=[];break;case"wheel":var u=e;u.altKey?this.onWheelZooming(0<u.deltaY,n,a):(e.preventDefault(),0<u.deltaY?this.applyPanning(0,-50):this.applyPanning(0,50))}}else if(e.type.startsWith("touch")){var c=e,h=void 0,d=void 0,p=void 0,f=void 0;switch(c.touches.length>0&&(h=c.touches[0].pageX-r.left,d=c.touches[0].pageY-r.top),c.touches.length>1&&(p=c.touches[1].pageX-r.left,f=c.touches[1].pageY-r.top),c.type){case"touchstart":this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchmove":if(c.preventDefault(),c.touches.length>1&&4==this.prevPtrCoords.length){var m=(h+p)/2,g=(d+f)/2,b=Math.hypot(this.prevPtrCoords[2]-this.prevPtrCoords[0],this.prevPtrCoords[3]-this.prevPtrCoords[1]),v=Math.hypot(p-h,f-d)/b*this.zoom;v=Math.max(v,t.zooms[0]),v=Math.min(v,t.zooms[t.zooms.length-1]),this.applyZoom(v,m,g)}else if(this.prevPtrCoords.length>=2){o=h-this.prevPtrCoords[0],s=d-this.prevPtrCoords[1];if(4==this.prevPtrCoords.length){var y=Math.hypot(o,s),A=h-this.prevPtrCoords[2],T=d-this.prevPtrCoords[3];Math.hypot(A,T)<y&&(o=A,s=T)}this.applyPanning(o,s)}this.prevPtrCoords=c.touches.length>1?[h,d,p,f]:[h,d];break;case"touchend":this.prevPtrCoords=[]}}},t.prototype.applyPresentationTransform=function(){var t=this.client.frameDrawing.navigationSettings;if(!t.zoomAndPanningEnabled){var e=this.zoom,r=this.presentationCoords[0],i=this.presentationCoords[1],n=this.client.svg.getBoundingClientRect(),a=n.width,o=n.height;e=Math.max(e,a/t.width),e=Math.max(e,o/t.height),r=Math.min(r,-t.x*e),r=Math.max(r,a-(t.x+t.width)*e),i=Math.min(i,-t.y*e),i=Math.max(i,o-(t.y+t.height)*e),this.presentationCoords=[r,i],this.zoom=e}var s="translate("+Kt.fixedPrecision(this.presentationCoords[0],1)+","+Kt.fixedPrecision(this.presentationCoords[1],1)+") scale("+Kt.reducePrecision(this.zoom)+")";s!=this.client.presentation.getAttribute("transform")&&(this.client.presentation.setAttribute("transform",s),jp.syncAllCanvas3DPositions())},t.prototype.applyZoom=function(t,e,r){if(t!=this.zoom){var i=this.client.frameDrawing.navigationSettings;if(!i.zoomAndPanningEnabled){var n=this.client.svg,a=n.getBoundingClientRect(),o=a.width,s=a.height,l=i.width,u=i.height,c=n.parentNode.getBoundingClientRect(),h=c.width,d=c.height;if((t=l/u>h/d?Math.max(t,h/l):Math.max(t,d/u))==this.zoom)return;var p=Math.min(l*t,h),f=Math.min(u*t,d),m=!1;if(p!=o&&(n.setAttribute("width",p.toString()),m=!0),f!=s&&(n.setAttribute("height",f.toString()),m=!0),m){var g=document.getElementById("canvas-group-3d");g.style.width=p+"px",g.style.height=f+"px"}}var b=t/this.zoom,v=e-(e-this.presentationCoords[0])*b,y=r-(r-this.presentationCoords[1])*b;this.presentationCoords=[v,y],this.zoom=t,this.applyPresentationTransform()}},t.prototype.applyPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform()},t.prototype.navigateTo=function(t,e,r){this.zoom=r,this.presentationCoords=[-t*this.zoom,-e*this.zoom],this.applyPresentationTransform()},t.prototype.onWheelZooming=function(e,r,i){var n=this.zoom;if(e){for(var a=t.zooms.length-1;a>=0;a--)if(t.zooms[a]<this.zoom){n=t.zooms[a];break}}else for(a=0;a<t.zooms.length;a++)if(this.zoom<t.zooms[a]){n=t.zooms[a];break}this.applyZoom(n,r,i)},t.prototype.onPresentationClick=function(t,e,r){var i=e-this.presentationCoords[0],n=r-this.presentationCoords[1];i/=this.zoom,n/=this.zoom,this.client.frameDrawing.onUserClick(t.target,i,n)},t.prototype.applyNavigationSettings=function(){var t,e,r,i=this.client.svg,n=this.client.frameDrawing.navigationSettings,a=n.width,o=n.height,s=n.zoomAndPanningEnabled,l=n.width/n.height,u=i.parentNode.getBoundingClientRect(),c=u.width,h=u.height,d=c/h,p=n.x,f=n.y;l>d?(r=c/a,t=c,s?f-=((e=h)/r-o)/2:e=c/l):(r=h/o,s?p-=((t=c)/r-a)/2:t=h*l,e=h),Kt.setMultipleAttributes(i,["width","height"],[t,e]);var m=document.getElementById("canvas-group-3d");m.style.width=t+"px",m.style.height=e+"px",this.navigateTo(p,f,r)},t.clickTolerance=1,t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t}(),qp=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return Zt.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return Zt.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return Zt.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)hf.filterAndSetAttribute(e,r[n],i[n]);t.updateGISMarkupPosition(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=Zt.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=Kt.getFloatAttribute(t,"lon"),n=Kt.getFloatAttribute(t,"lat"),a=Zp.lonLatToXY(r,i,n);Kt.setMultipleAttributes(t,["cx","cy"],[a[0],a[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var o=t.getAttribute("lonlatpoints"),s=Zp.lonLatPointsToXYPoints(r,o);t.setAttribute("points",s)}},t}(),Zp=function(){function t(t){this.frameDrawing=t}return t.prototype.createShapeGISMap=function(){var t=this,e=Zt.cloneElementWithId("shape-gis-map"),r=function(e){return t.onGISEvent(e)};e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r);var i=Zt.findChildOfType(e,"map").firstElementChild;return Zt.findChildOfType(i,"agents").addEventListener("click",function(e){return t.onGISAgentLayerClick(e)}),e},t.prototype.updateShapeGISMap=function(t,e,r){for(var i=Zt.findChildOfType(t,"background"),n=Zt.findChildOfType(t,"map"),a=Zt.findChildOfType(t,"shadow"),o=Zt.findChildOfType(t,"border"),s=0;s<e.length;s++)switch(e[s]){case"width":case"height":i.setAttribute(e[s],r[s]),n.setAttribute(e[s],r[s]),a.setAttribute(e[s],r[s]),o.setAttribute(e[s],r[s]);break;case"size-completed":t.getAttribute("zoom")&&this.redrawGISMap(t);break;case"background-color":i.setAttribute("fill",r[s]);break;case"border-color":o.setAttribute("stroke",r[s]);break;case"map-completed":this.redrawGISMap(t);break;default:hf.filterAndSetAttribute(t,e[s],r[s])}},t.prototype.redrawGISMap=function(e){this.redrawGISTiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.prototype.redrawGISTiles=function(e){var r=Zt.findChildOfType(e,"background"),i=Kt.getFloatAttribute(r,"width"),n=Kt.getFloatAttribute(r,"height"),a=t.minGISZoom(i,n),o=Zt.findChildOfType(e,"map").firstElementChild;o.setAttribute("transform","translate(0,0)");var s=Kt.getIntAttribute(e,"zoom"),l=Kt.getFloatAttribute(e,"center-lon"),u=Kt.getFloatAttribute(e,"center-lat");s<a&&(s=a,e.setAttribute("zoom",s.toString()));var c,h=Math.pow(2,s),d=t.latToTileYFloat(u,s),p=n/2/t.tileImageSize;d-p<0?c=p:h<d+p&&(c=h-p),c&&(u=t.tileYToLat(c,s),e.setAttribute("center-lat",u.toString()));var f=Zt.findChildOfType(o,"tiles");Zt.removeAllChildren(f),this.updateGISTiles(f,s,u,l,0,0,i,n,h)},t.prototype.updateGISTiles=function(e,r,i,n,a,o,s,l,u){for(var c=t.lonToTileXInt(n,r),h=t.latToTileYInt(i,r),d=a+s/2-t.lonToXOffsetWithinTile(n,r),p=o+l/2-t.latToYOffsetWithinTile(i,r);d>0;)d-=t.tileImageSize,c--;for(;p>0;)p-=t.tileImageSize,h--;c=Kt.modulo(c,u),h=Kt.modulo(h,u);for(var f=[],m=Zt.childElements(e),g=0;g<m.length;g++)f.push(m[g]);for(var b=c,v=d;v<s;v+=t.tileImageSize){for(var y=h,A=p;A<l;A+=t.tileImageSize){var T=r+"/"+b+"/"+y,C=null;for(g=0;g<f.length;g++)if(f[g].getAttribute("tileid")==T){C=f[g];break}null==C&&(C=this.addGISTile(e,r,b,y)),C.setAttribute("x",(v-a).toString()),C.setAttribute("y",(A-o).toString()),y=Kt.modulo(y+1,u)}b=Kt.modulo(b+1,u)}},t.prototype.addGISTile=function(e,r,i,n){var a=Zt.findParentOfType(e,"ShapeGISMap"),o=this.tileURL(a,r,i,n),s=Zt.createSvgElement("image");return s.setAttribute("width",t.tileImageSize.toString()),s.setAttribute("height",t.tileImageSize.toString()),s.setAttributeNS(Zt.xlinkns,"href",o),s.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(s),s},t.redrawGISMarkup=function(t){for(var e=Zt.findChildOfType(t,"map").firstElementChild,r=Zt.findChildOfType(e,"markup"),i=Zt.childElements(r),n=0;n<i.length;n++)qp.updateGISMarkupPosition(i[n])},t.redrawGISAgents=function(e){for(var r=Zt.findChildOfType(e,"map").firstElementChild,i=Zt.findChildOfType(r,"agents"),n=Zt.childElements(i),a=0;a<n.length;a++)t.updateGISObjectScale(n[a]),"hidden"!=n[a].getAttribute("visibility")&&t.updateGISObjectPosition(n[a])},t.updateGISObjectPosition=function(e){var r=Zt.findParentOfType(e,"ShapeGISMap"),i=Kt.getFloatAttribute(e,"lon"),n=Kt.getFloatAttribute(e,"lat"),a=Kt.getFloatAttribute(e,"heading"),o=t.lonLatToXY(r,i,n),s="translate("+o[0]+","+o[1]+") rotate("+a+")",l=e.getAttribute("scale");l&&(s+=" scale("+l+")"),e.setAttribute("transform",s)},t.updateGISObjectScale=function(e){var r=Zt.findParentOfType(e,"ShapeGISMap"),i=Kt.getIntAttribute(e,"fixed-scale-zoom");if(i){var n=Kt.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var a=1;if(Kt.getIntAttribute(e,"real-scale-zoom")<=n){var o=Kt.getFloatAttribute(e,"pixels-per-meter"),s=Kt.getFloatAttribute(e,"lat");a=t.pixelsPerGISMeter(n,s)/o}e.setAttribute("scale",a.toString())}},t.prototype.panGIS=function(e,r,i){var n=Zt.findChildOfType(e,"map").firstElementChild,a=Kt.parseTranslateTransform(n.getAttribute("transform")),o=a[0]+r,s=a[1]+i,l=Kt.getIntAttribute(e,"zoom"),u=Math.pow(2,l),c=Kt.getFloatAttribute(e,"center-lon"),h=Kt.getFloatAttribute(e,"center-lat"),d=t.latToTileYFloat(h,l),p=Zt.findChildOfType(e,"background"),f=Kt.getFloatAttribute(p,"width"),m=Kt.getFloatAttribute(p,"height"),g=m/2/t.tileImageSize;d-g-s/t.tileImageSize<0?s=(d-g)*t.tileImageSize:u<d+g-s/t.tileImageSize&&(s=(d+g-u)*t.tileImageSize),o=t.normalizedGISX(o,l),o=Math.round(o),s=Math.round(s),n.setAttribute("transform","translate("+o+","+s+")");var b=Zt.findChildOfType(n,"tiles");this.updateGISTiles(b,l,h,c,o,s,f,m,u)},t.prototype.zoomOutGIS=function(e,r,i){var n=Zt.findChildOfType(e,"background"),a=Kt.getFloatAttribute(n,"width"),o=Kt.getFloatAttribute(n,"height"),s=Kt.getIntAttribute(e,"zoom");t.minGISZoom(a,o)<s&&this.setGISZoom(e,r,i,s-1)},t.prototype.zoomInGIS=function(t,e,r){var i=Kt.getIntAttribute(t,"zoom");i<19&&this.setGISZoom(t,e,r,i+1)},t.prototype.setGISZoom=function(e,r,i,n){var a=Zt.findChildOfType(e,"background"),o=Kt.getFloatAttribute(a,"width"),s=Kt.getFloatAttribute(a,"height"),l=Zt.findChildOfType(e,"map").firstElementChild,u=Kt.parseTranslateTransform(l.getAttribute("transform")),c=t.xyToLonLat(e,r-u[0],i-u[1]),h=t.lonToTileXFloat(c[0],n),d=t.latToTileYFloat(c[1],n),p=Math.pow(2,n);h=Kt.remainderPositive(h-(r-o/2)/t.tileImageSize,p),d=Kt.remainderPositive(d-(i-s/2)/t.tileImageSize,p);var f=t.tileXToLon(h,n),m=t.tileYToLat(d,n);Kt.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,f,m]),this.redrawGISMap(e)},t.prototype.onGISClick=function(e,r,i){var n=Zt.findChildOfType(e,"map").firstElementChild,a=Kt.parseTranslateTransform(n.getAttribute("transform")),o=t.xyToLonLat(e,r-a[0],i-a[1]);this.frameDrawing.client.network.postUserAction(e.id,o[0]+" "+o[1])},t.prototype.onGISEvent=function(e){var r=e.currentTarget;if("true"==r.getAttribute("navigation-enabled")){var i=Zt.findChildOfType(r,"background"),n=Kt.getFloatAttribute(i,"width"),a=Kt.getFloatAttribute(i,"height"),o=i.getBoundingClientRect(),s=o.width/n,l=o.height/a,u=Kt.offsetPage(i);if(e.type.startsWith("mouse")||"wheel"==e.type){var c=e,h=(c.pageX-u.left)/s,d=(c.pageY-u.top)/l;switch(e.type){case"mousedown":t.buttonDown=c.which,1==t.buttonDown&&(e.stopPropagation(),t.prevPtrCoords=[h,d]);break;case"mousemove":if(1==t.buttonDown){e.stopPropagation(),e.preventDefault();var p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];t.prevPtrCoords=[h,d],this.panGIS(r,p,f)}break;case"mouseup":case"mouseout":if(r.contains(c.relatedTarget))return;if(1==t.buttonDown){e.stopPropagation();p=h-t.prevPtrCoords[0],f=d-t.prevPtrCoords[1];Math.abs(p)<=Xp.clickTolerance&&Math.abs(f)<=Xp.clickTolerance&&this.onGISClick(r,h,d)}t.buttonDown=0;break;case"wheel":if(!c.altKey&&!c.ctrlKey){var m=e;e.stopPropagation(),e.preventDefault(),0<m.deltaY?this.zoomOutGIS(r,h,d):this.zoomInGIS(r,h,d)}}}else if(e.type.startsWith("touch")){var g=e;if(g.touches.length>2)return;var b=void 0,v=void 0,y=void 0,A=void 0;switch(g.touches.length>0&&(b=(g.touches[0].pageX-u.left)/s,v=(g.touches[0].pageY-u.top)/l),g.touches.length>1&&(y=(g.touches[1].pageX-u.left)/s,A=(g.touches[1].pageY-u.top)/l),e.type){case"touchstart":e.stopPropagation(),t.prevPtrCoords=g.touches.length>1?[b,v,y,A]:[b,v];break;case"touchmove":if(e.stopPropagation(),e.preventDefault(),g.touches.length>1&&4==t.prevPtrCoords.length){var T=(b+y)/2,C=(v+A)/2,S=Math.hypot(t.prevPtrCoords[2]-t.prevPtrCoords[0],t.prevPtrCoords[3]-t.prevPtrCoords[1]),E=Math.hypot(y-b,A-v);(E<.8*S||1.2*S<E)&&(E<S?this.zoomOutGIS(r,T,C):this.zoomInGIS(r,T,C),t.prevPtrCoords=[b,v,y,A])}else if(t.prevPtrCoords.length>=2){p=b-t.prevPtrCoords[0],f=v-t.prevPtrCoords[1];if(4==t.prevPtrCoords.length){var w=Math.hypot(p,f),k=b-t.prevPtrCoords[2],x=v-t.prevPtrCoords[3];Math.hypot(k,x)<w&&(p=k,f=x)}this.panGIS(r,p,f),t.prevPtrCoords=g.touches.length>1?[b,v,y,A]:[b,v]}else t.prevPtrCoords=g.touches.length>1?[b,v,y,A]:[b,v];break;case"touchend":e.stopPropagation(),t.prevPtrCoords=[]}}}},t.prototype.onGISAgentLayerClick=function(t){t.stopPropagation(),t.preventDefault();for(var e=t.currentTarget,r=t.target;r.parentNode!=e;)r=r.parentNode;this.frameDrawing.client.network.postUserAction(r.id,"0 0")},t.xyToLonLat=function(e,r,i){var n=Zt.findChildOfType(e,"background"),a=Kt.getFloatAttribute(n,"width"),o=Kt.getFloatAttribute(n,"height"),s=Kt.getIntAttribute(e,"zoom"),l=Math.pow(2,s),u=t.lonToTileXFloat(Kt.getFloatAttribute(e,"center-lon"),s),c=t.latToTileYFloat(Kt.getFloatAttribute(e,"center-lat"),s),h=(r-a/2)/t.tileImageSize,d=(i-o/2)/t.tileImageSize,p=Kt.remainderPositive(u+h,l),f=Kt.remainderPositive(c+d,l);return[t.tileXToLon(p,s),t.tileYToLat(f,s)]},t.lonLatToXY=function(e,r,i){var n=Zt.findChildOfType(e,"background"),a=Kt.getFloatAttribute(n,"width"),o=Kt.getFloatAttribute(n,"height"),s=Kt.getIntAttribute(e,"zoom"),l=t.lonToTileXFloat(Kt.getFloatAttribute(e,"center-lon"),s),u=t.latToTileYFloat(Kt.getFloatAttribute(e,"center-lat"),s),c=t.lonToTileXFloat(r,s),h=t.latToTileYFloat(i,s);return[a/2+(c-l)*t.tileImageSize,o/2+(h-u)*t.tileImageSize]},t.lonLatPointsToXYPoints=function(e,r){var i=Zt.findChildOfType(e,"background"),n=Kt.getFloatAttribute(i,"width"),a=Kt.getFloatAttribute(i,"height"),o=Kt.getIntAttribute(e,"zoom"),s=t.lonToTileXFloat(Kt.getFloatAttribute(e,"center-lon"),o),l=t.latToTileYFloat(Kt.getFloatAttribute(e,"center-lat"),o),u=void 0,c=void 0,h="";r=Kt.splitSkipEmpty(r," ");for(var d=0;d<r.length;d++){var p=r[d].split(","),f=t.lonToTileXFloat(parseFloat(p[0]),o),m=t.latToTileYFloat(parseFloat(p[1]),o),g=n/2+(f-s)*t.tileImageSize,b=a/2+(m-l)*t.tileImageSize;null!=u&&Math.abs(g-u)<t.gisTolerance&&Math.abs(b-c)<t.gisTolerance||(h+=(g=Kt.reducePrecision(g))+","+(b=Kt.reducePrecision(b))+" ",u=g,c=b)}return h},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.prototype.tileURL=function(e,r,i,n){var a;switch(e.getAttribute("tile-url-provider-type")){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":a=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":a=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":a=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":a=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":a=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":a=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":a=Kt.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}return a[Math.floor(Math.random()*a.length)].replace("[zoom]",r.toString()).replace("[x]",i.toString()).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=Kt.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=Kt.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(Kt.byteArrayToString(n))},t.buttonDown=0,t.prevPtrCoords=[0,0],t.gisTolerance=2,t.tileImageSize=256,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),Kp=function(){function t(){}return t.createMarkupPipe=function(t){var e=Zt.cloneElementWithId("markup-pipe"),r=t+"basepath";Zt.findChildOfType(e,"basepath").firstElementChild.id=r;var i=Zt.findChildOfType(e,"pipe"),n=Zt.findChildOfType(e,"inner-pipe"),a=Zt.findChildOfType(e,"bubbles"),o="#"+r;return i.setAttributeNS(Zt.xlinkns,"href",o),n.setAttributeNS(Zt.xlinkns,"href",o),a.setAttributeNS(Zt.xlinkns,"href",o),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=Zt.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=Zt.findChildOfType(t,"batches"),s=Zt.findChildOfType(t,"bubbles"),l=0;l<e.length;l++)switch(e[l]){case"phase":s.setAttribute("stroke-dashoffset",(12-parseFloat(r[l])).toString());break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=Zt.childElements(o)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=o.childElementCount,m=p;m<f;m++)Zt.removeElement(o,o.lastElementChild);for(m=f;m<p;m++)d=Zt.createUseElement(a),o.appendChild(d);break;case"d":var g=parseFloat(Zt.findChildOfType(t,"pipe").getAttribute("stroke-width")),b=Kt.roundPathCorners(r[l],2*g,!1);n.setAttribute("d",b);break;case"width":var v=parseFloat(r[l]);Zt.findChildOfType(t,"pipe").setAttribute("stroke-width",v.toString()),Zt.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*v).toString()),o.setAttribute("stroke-width",(.6*v).toString());var y=Math.min(5,.2*v);s.setAttribute("stroke-width",y.toString()),s.setAttribute("stroke-dasharray",y+","+(12-y));break;case"color":Zt.findChildOfType(t,"pipe").setAttribute("stroke",r[l]);break;case"inner-color":Zt.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[l]);break;default:hf.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupStorageTank=function(){return Zt.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=Zt.findChildOfType(t,"square"),n=Zt.findChildOfType(t,"batches"),a=parseFloat(i.getAttribute("width")),o=0;o<e.length;o++)switch(e[o]){case"batch":var s=r[o].split(" "),l=parseFloat(s[1])*a,u=parseFloat(s[2])*a,c=Zt.childElements(n)[parseInt(s[0])];Kt.setMultipleAttributes(c,["y","height","fill"],[a/2-l-u,u,s[3]]);break;case"newbatches":for(var h=parseInt(r[o]),d=n.childElementCount,p=h;p<d;p++)Zt.removeElement(n,n.lastElementChild);for(p=d;p<h;p++)c=Zt.createSvgElement("rect"),Kt.setMultipleAttributes(c,["stroke","width","x"],["none",a,-a/2]),n.appendChild(c);break;case"progress":var f=parseFloat(r[o])*Math.PI*2,m=parseFloat(Zt.findChildOfType(t,"circle").getAttribute("r"))-2,g=m*Math.sin(f),b=-m*Math.cos(f),v="M 0 "+-m+" ";v+="A "+m+" "+m+" 0 "+(f>Math.PI?"1":"0")+" 1 "+g+" "+b,Zt.findChildOfType(t,"arc").setAttribute("d",v);break;case"radius":Zt.findChildOfType(t,"circle").setAttribute("r",r[o]),a=Math.max(10,2*parseFloat(r[o])/Math.sqrt(2)-8),Kt.setMultipleAttributes(i,["width","height","x","y"],[a,a,-a/2,-a/2]);break;case"color":Zt.findChildOfType(t,"circle").setAttribute("fill",r[o]);break;case"stroke-color":Zt.findChildOfType(t,"circle").setAttribute("stroke",r[o]),Zt.findChildOfType(t,"square").setAttribute("stroke",r[o]);break;default:hf.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupBulkConveyorBelt=function(t){var e=Zt.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";Zt.findChildOfType(e,"basepath").firstElementChild.id=r;var i=Zt.findChildOfType(e,"belt"),n=Zt.findChildOfType(e,"belt-sections"),a="#"+r;return i.setAttributeNS(Zt.xlinkns,"href",a),n.setAttributeNS(Zt.xlinkns,"href",a),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=Zt.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=Zt.findChildOfType(t,"belt-sections"),s=Zt.findChildOfType(t,"batches"),l=0;l<e.length;l++)switch(e[l]){case"phase":o.setAttribute("stroke-dashoffset",r[l]);break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=Zt.childElements(s)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var p=parseInt(r[l]),f=s.childElementCount,m=p;m<f;m++)Zt.removeElement(s,s.lastElementChild);for(m=f;m<p;m++)d=Zt.createUseElement(a),s.appendChild(d);break;case"d":n.setAttribute("d",r[l]);break;case"width":var g=r[l];Zt.findChildOfType(t,"belt").setAttribute("stroke-width",g),o.setAttribute("stroke-width",g),o.setAttribute("stroke-dasharray","2, 10"),s.setAttribute("stroke-width",(.4*parseFloat(g)).toString());break;case"color":Zt.findChildOfType(t,"belt").setAttribute("stroke",r[l]);break;case"sections-color":o.setAttribute("stroke",r[l]);break;default:hf.filterAndSetAttribute(t,e[l],r[l])}},t}(),Qp=function(){function t(){}return t.createMarkupPath=function(t,e){var r=Zt.cloneElementWithId("markup-path"),i=e+"basepath";Zt.findChildOfType(r,"basepath").firstElementChild.id=i;var n=Zt.findChildOfType(r,"paths"),a=1;"MarkupPathRoad"==t&&(a=2),"MarkupPathRailroad"==t&&(a=4);for(var o=0;o<a;o++){var s=Zt.createUseElement(i);n.appendChild(s)}var l=Zt.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),l.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),Zt.childElements(n)[1].setAttribute("stroke","black"),Zt.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=Zt.findChildOfType(t,"basepath").firstElementChild,a=Zt.findChildOfType(t,"paths"),o=a.firstElementChild,s=Zt.findChildOfType(t,"arrows"),l=0;l<e.length;l++)switch(e[l]){case"d":n.setAttribute("d",r[l]);break;case"bidirectional":Zt.removeAllChildren(s),"false"==r[l]&&Kt.addPathArrows(n,"arrowhead",1.7,s,50,100);break;case"stroke-width":var u=parseFloat(r[l]);switch(i){case"MarkupPathLine":o.setAttribute("stroke-width",u.toString());break;case"MarkupPathDashline":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",4*u+" "+u);break;case"MarkupPathConveyor":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",u/2+" "+u/10);break;case"MarkupPathRoad":o.setAttribute("stroke-width",u.toString());var c=a.lastElementChild;c.setAttribute("stroke-width",(u/12).toString()),c.setAttribute("stroke-dasharray",u/2+" "+u/5);break;case"MarkupPathRailroad":var h=u/10+" "+u/2.5;o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",h),Zt.childElements(a)[1].setAttribute("stroke-width",(u/2+u/12).toString()),Zt.childElements(a)[2].setAttribute("stroke-width",(u/2).toString());var d=a.lastElementChild;d.setAttribute("stroke-width",(u/2).toString()),d.setAttribute("stroke-dasharray",h)}break;case"stroke":o.setAttribute("stroke",r[l]),u=parseFloat(o.getAttribute("stroke-width")),s.setAttribute("stroke",u>4?"white":r[l]);break;default:hf.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupAreaNode=function(t){var e,r=Zt.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=Zt.createSvgElement("rect");break;case"MarkupPolygonalNode":e=Zt.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:hf.filterAndSetAttribute(i,e[n],r[n])}},t.createMarkupPalletRack=function(){return Zt.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"stroke":n.setAttribute(e[a],r[a]);break;case"fill":i.setAttribute(e[a],r[a]);break;case"rack-data":Zt.removeAllChildren(i),Zt.removeAllChildren(n);var o=r[a].split(" "),s=parseInt(o[0]),l=parseInt(o[1]),u=parseFloat(o[2]),c=parseFloat(o[3]),h=parseFloat(o[4]),d=void 0,p=void 0,f=void 0;s>1&&(d=parseFloat(o[5]),p=parseFloat(o[6]),f=c+d);var m=Zt.createSvgElement("rect");if(m.setAttribute("width",u.toString()),m.setAttribute("height",c.toString()),i.appendChild(m),s>1){var g=Zt.createSvgElement("rect");g.setAttribute("width",u.toString()),g.setAttribute("height",p.toString()),g.setAttribute("transform","translate( 0 "+f+")"),i.appendChild(g)}for(var b=h,v=0;v<l-1;v++){var y=Zt.createSvgElement("line");Kt.setMultipleAttributes(y,["x1","x2","y1","y2"],[b,b,"0",c]),n.appendChild(y),b+=h}if(s>1){var A=f+p;b=h;for(v=0;v<l-1;v++){y=Zt.createSvgElement("line");Kt.setMultipleAttributes(y,["x1","x2","y1","y2"],[b,b,f,A]),n.appendChild(y),b+=h}}break;default:hf.filterAndSetAttribute(t,e[a],r[a])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),Jp=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=Zt.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=Zt.createSvgElement("path");break;case"MarkupCircularWall":r=Zt.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=Zt.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:hf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupTargetLine=function(){return Zt.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=Zt.findChildOfType(e,"polyline"),a=Zt.findChildOfType(e,"serif-start"),o=Zt.findChildOfType(e,"serif-end"),s=0;s<r.length;s++)switch(r[s]){case"color":e.setAttribute("stroke",i[s]);break;case"points":n.setAttribute(r[s],i[s]);var l=i[s].split(" "),u=l.length;l[u-1].includes(",")||u--,t.setSerif(l[0],l[1],a),t.setSerif(l[u-1],l[u-2],o);break;default:hf.filterAndSetAttribute(e,r[s],i[s])}},t.createMarkupPathway=function(){return Zt.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=Zt.findChildOfType(t,"polygon"),n=Zt.findChildOfType(t,"polyline"),a=Zt.findChildOfType(t,"ties"),o=0;o<e.length;o++)switch(e[o]){case"color":a.setAttribute("stroke",r[o]);break;case"points":var s=r[o].split(" "),l="",u="",c="";Zt.removeAllChildren(a);for(var h=0;h<s.length;h++){var d=Kt.splitToFloats(s[h],",");if(4==d.length){l+=d[0]+","+d[1]+" ",u=d[2]+","+d[3]+" "+u,c+=(d[0]+d[2])/2+","+(d[1]+d[3])/2+" ";var p=Zt.createSvgElement("line");Kt.setMultipleAttributes(p,["x1","y1","x2","y2"],[d[0],d[1],d[2],d[3]]),a.appendChild(p)}}i.setAttribute("points",l+u),n.setAttribute("points",c);break;default:hf.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupPedFlowStatistics=function(){return Zt.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=Zt.findChildOfType(t,"line"),n=Zt.findChildOfType(t,"serif-end"),a=Zt.findChildOfType(t,"direction"),o=Zt.findChildOfType(t,"arrow-right"),s=Zt.findChildOfType(t,"arrow-left"),l=0;l<e.length;l++)switch(e[l]){case"color":t.setAttribute("stroke",r[l]);break;case"length":i.setAttribute("x2",r[l]),n.setAttribute("x1",r[l]),n.setAttribute("x2",r[l]);var u=parseInt(r[l])/2;a.setAttribute("x1",u.toString()),a.setAttribute("x2",u.toString()),o.setAttribute("transform","translate("+u+" 13) rotate(90)"),s.setAttribute("transform","translate("+u+" -13) rotate(-90)");break;case"direction":switch(o.setAttribute("visibility","inherit"),s.setAttribute("visibility","inherit"),r[l]){case"right":s.setAttribute("visibility","hidden");break;case"left":o.setAttribute("visibility","hidden")}break;default:hf.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupServiceWithLines=function(){return Zt.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=Zt.findChildOfType(e,"queues"),a=Zt.findChildOfType(e,"services"),o=Zt.findChildOfType(e,"reverse-queues"),s=Zt.findChildOfType(e,"area"),l=0;l<r.length;l++)switch(r[l]){case"queue-color":n.setAttribute("stroke",i[l]);break;case"reverse-queue-color":o.setAttribute("stroke",i[l]);break;case"service-color":a.setAttribute("stroke",i[l]);break;case"clear-all-queues":Zt.removeAllChildren(n),Zt.removeAllChildren(o);break;case"queue":t.addQueue(n,i[l]);break;case"reverse-queue":t.addQueue(o,i[l]);break;case"clear-services":Zt.removeAllChildren(a);break;case"service":t.addService(a,i[l]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":s.setAttribute(r[l],i[l]);break;case"pos":case"scale":var u=hf.posOrScaleToTransform(s,r[l],i[l]);s.setAttribute("transform",u);break;default:hf.filterAndSetAttribute(e,r[l],i[l])}},t.createMarkupServiceWithArea=function(){return Zt.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=Zt.findChildOfType(e,"services"),a=0;a<r.length;a++)switch(r[a]){case"service-color":n.setAttribute("stroke",i[a]);break;case"clear-services":Zt.removeAllChildren(n);break;case"service":t.addService(n,i[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":case"pos":case"scale":break;default:hf.filterAndSetAttribute(e,r[a],i[a])}},t.createMarkupEscalatorGroup=function(){return Zt.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=Zt.findChildOfType(t,"background"),n=Zt.findChildOfType(t,"escalators"),a=0;a<e.length;a++)switch(e[a]){case"balustrade-color":i.setAttribute("fill",r[a]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[a]?"inherit":"hidden");break;case"dimensions-completed":var o=Kt.getIntAttribute(t,"number-of-escalators"),s=Kt.getFloatAttribute(t,"width"),l=Kt.getFloatAttribute(t,"length"),u=Kt.getFloatAttribute(t,"left-balustrade-width"),c=Kt.getFloatAttribute(t,"right-balustrade-width"),h=Kt.getFloatAttribute(t,"internal-balustrade-width"),d=Kt.getFloatAttribute(t,"lower-landing-length"),p=u+c+o*s+(o-1)*h,f=d+l+Kt.getFloatAttribute(t,"upper-landing-length");Kt.setMultipleAttributes(i,["y","width","height"],[-u,f,p]);for(var m=0;m<o;m++){var g=m*(s+h),b=Zt.cloneElementWithId("escalator"),v=Zt.findChildOfType(b,"background");Kt.setMultipleAttributes(v,["y","width","height"],[g,f,s]);var y=Zt.findChildOfType(b,"handrail-left"),A=Zt.findChildOfType(b,"handrail-right");Kt.setMultipleAttributes(y,["x2","y1","y2"],[f,g,g]),Kt.setMultipleAttributes(A,["x2","y1","y2"],[f,g+s,g+s]);var T=Zt.findChildOfType(b,"lower-landing-end"),C=Zt.findChildOfType(b,"upper-landing-end");Kt.setMultipleAttributes(T,["x1","x2","y1","y2"],[d,d,g,g+s]),Kt.setMultipleAttributes(C,["x1","x2","y1","y2"],[d+l,d+l,g,g+s]);var S=Zt.findChildOfType(b,"stairs");Kt.setMultipleAttributes(S,["x1","x2","y1","y2","stroke-width"],[d,d+l,g+s/2,g+s/2,s]),n.appendChild(b)}break;case"offsets":var E=Kt.splitToFloats(r[a]," "),w=Zt.childElements(n);for(m=0;m<w.length;m++)Zt.findChildOfType(w[m],"stairs").setAttribute("stroke-dashoffset",(-E[m]).toString());break;default:hf.filterAndSetAttribute(t,e[a],r[a])}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(n[0])-a,l=parseFloat(n[1])-o,u=Math.hypot(s,l),c=3*l/u,h=3*s/u;Kt.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+c,a-c,o-h,o+h])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(Kt.getSubAttribute(i,"x")),a=parseFloat(Kt.getSubAttribute(i,"y")),o=Kt.radiansToDegrees(parseFloat(Kt.getSubAttribute(i,"orientation")));if("point"==Kt.getSubAttribute(i,"type")){(r=Zt.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+a+")");var s=Zt.createUseElement("arrowhead-small");s.setAttribute("transform","translate("+(n-11)+" "+a+") rotate("+o+" 11 0)"),t.appendChild(s)}else{(r=Zt.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+a+") rotate("+o+")");var l=r.firstElementChild.nextElementSibling,u=parseFloat(Kt.getSubAttribute(i,"length"));if(l.setAttribute("x2",u),"true"==Kt.getSubAttribute(i,"bidirectional")){var c=r.lastElementChild;c.setAttribute("visibility","inherit"),c.setAttribute("transform","translate("+(u+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=Kt.splitSkipEmpty(e,"|"),i=Kt.getSubAttribute(r,"queue-path"),n=Zt.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),Kt.addPathArrows(n,"arrowhead-small",.7,t,50,100);var a=Kt.getSubAttribute(r,"fence-color");if(a)for(var o=[Kt.getSubAttribute(r,"fence-path-left"),Kt.getSubAttribute(r,"fence-path-right")],s=0;s<o.length;s++){var l=Zt.createSvgElement("path");Kt.setMultipleAttributes(l,["d","stroke","stroke-width","stroke-dasharray"],[o[s],a,"2","none"]),t.appendChild(l)}},t}(),$p=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return Zt.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:hf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return Zt.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)hf.filterAndSetAttribute(t,e[i],r[i])},t}(),tf=function(){function t(){}return t.createMarkupIntersection=function(){return Zt.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=Zt.findChildOfType(t,"lane-connectors"),a=0;a<e.length;a++)switch(e[a]){case"fill":case"d":i.setAttribute(e[a],r[a]);break;case"lane-connector":var o=Zt.createSvgElement("g"),s=Zt.createSvgElement("path");s.setAttribute("d",r[a]),o.appendChild(s),Kt.addPathArrows(s,"arrowhead-tiny",.5,o,20,40),n.appendChild(o);break;case"lane-connector-colors":for(var l=Kt.splitSkipEmpty(r[a]," "),u=Zt.childElements(n),c=0;c<u.length;c++)u[c].setAttribute("stroke",l[c]);break;default:hf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupRoad=function(){return Zt.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=Zt.findChildOfType(e,"lanes"),a=Zt.findChildOfType(e,"delimiters"),o=Zt.findChildOfType(e,"median"),s=0;s<r.length;s++)switch(r[s]){case"lane-width":n.setAttribute("stroke-width",i[s]);break;case"lane-color":n.setAttribute("stroke",i[s]);break;case"forward-lane":case"backward-lane":var l=Zt.createSvgElement("path");l.setAttribute("d",i[s]),n.appendChild(l);break;case"lane-delimiter-color":a.setAttribute("stroke",i[s]);break;case"lane-delimiter-width":case"lane-delimiter-style":a.setAttribute(r[s],i[s]);break;case"lane-delimiter":var u=Kt.getFloatAttribute(a,"lane-delimiter-width"),c=a.getAttribute("lane-delimiter-style");t.addDelimiter(a,u,c,i[s],n.getAttribute("stroke"));break;case"median-color":o.setAttribute("stroke",i[s]);break;case"median-width":case"median-style":o.setAttribute(r[s],i[s]);break;case"median":u=Kt.getFloatAttribute(o,"median-width"),c=o.getAttribute("median-style"),t.addDelimiter(o,u,c,i[s],n.getAttribute("stroke"));break;default:hf.filterAndSetAttribute(e,r[s],i[s])}},t.addDelimiter=function(t,e,r,i,n){var a=r.includes("DASHED"),o=r.includes("DOUBLE"),s=Zt.createSvgElement("path");if(s.setAttribute("d",i),s.setAttribute("stroke-width",(o?3*e:e).toString()),a&&s.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(s),o){var l=Zt.createSvgElement("path");Kt.setMultipleAttributes(l,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(l)}},t.createMarkupStopLine=function(){return Zt.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:hf.filterAndSetAttribute(t,e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return Zt.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:hf.filterAndSetAttribute(t,e[a],r[a])}},t}(),ef=function(){function t(t,e){this.frameDrawing=t,this.control=e}return t.createControlList=function(e){var r=Zt.cloneElementWithId("control-list"),i=function(e){return t.onControlListMouseEvent(e)};r.addEventListener("mouseover",i),r.addEventListener("mouseout",i),r.addEventListener("wheel",i);var n=Zt.findChildOfType(r,"svg"),a=Zt.findChildOfType(n,"scrollbargroup"),o=function(e){return t.onControlListScrollbarMouseEvent(e)};return a.addEventListener("mouseout",o),a.addEventListener("mousedown",o),a.addEventListener("mouseup",o),a.addEventListener("mousemove",o),a.addEventListener("click",o),e&&t.onGotFocus(r),r.setAttribute("always-focused",e.toString()),r},t.prototype.updateControlList=function(e,r,i){for(var n=Zt.findChildOfType(e,"svg"),a=Zt.findChildOfType(e,"border"),o=Zt.findChildOfType(n,"background"),s=Zt.findChildOfType(n,"itemgroup"),l=(Zt.findChildOfType(n,"scrollbargroup"),0);l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);for(var u="true"==i[l],c=Zt.childElements(s),h=0;h<c.length;h++)t.updateControlListItemLook(c[h],!1,!1);a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"text-array":Zt.removeAllChildren(s),s.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var d=Kt.splitSkipEmpty(i[l],"\n"),p=0,f=0;for(h=0;h<d.length;h++){var m=Zt.cloneElementWithId("list-item");Zt.findChildOfType(m,"background").setAttribute("fill",o.getAttribute("fill")),(A=Zt.findChildOfType(m,"text")).firstChild.textContent=d[h],e.hasAttribute("text-color")&&A.setAttribute("fill",e.getAttribute("text-color")),s.appendChild(m);var g=A.getBBox();p<g.width&&(p=g.width),f<g.height&&(f=g.height)}c=Zt.childElements(s);var b=Math.max(p+4,Kt.getFloatAttribute(n,"width")),v=Math.max(20,1.35*f);e.setAttribute("item-height",v.toString());for(h=0;h<c.length;h++)this.setupControlListItem(c[h],v*h,b,v,f);t.updateControlListScrollbar(e);break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":e.setAttribute(r[l],i[l]);break;case"font-style":e.style.font=i[l];break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[l],i[l]);break;case"value":var y=Kt.splitSkipEmpty(i[l],"\n");c=Zt.childElements(s),e.setAttribute("last-clicked","0");for(h=0;h<c.length;h++){m=c[h];var A=Zt.findChildOfType(m,"text"),T=y.indexOf(A.firstChild.textContent)>=0;m.setAttribute("selected",T),t.updateControlListItemLook(m,!1,!1),T&&e.setAttribute("last-clicked",h.toString())}break;default:hf.filterAndSetAttribute(e,r[l],i[l])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=Zt.findChildOfType(t,"svg"),i=Zt.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*Kt.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled"))switch(e.type){case"mouseover":t.onGotFocus(r);break;case"mouseout":if(r.contains(e.relatedTarget))return;t.onLostFocus(r);break;case"wheel":e.altKey||e.ctrlKey||(e.stopPropagation(),e.preventDefault(),t.scrollControlList(r,e.deltaY<0?1:-1))}},t.onGotFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=Zt.findChildOfType(e,"border"),i=Zt.findChildOfType(e,"svg"),n=Zt.findChildOfType(i,"itemgroup"),a=Zt.findChildOfType(i,"scrollbargroup"),o=Zt.childElements(n);if("control-border-hover"!=r.getAttribute("class")){r.setAttribute("class","control-border-hover"),a.setAttribute("class","control-opaque1");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!0,!1)}}},t.onLostFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=Zt.findChildOfType(e,"border"),i=Zt.findChildOfType(e,"svg"),n=Zt.findChildOfType(i,"itemgroup"),a=Zt.findChildOfType(i,"scrollbargroup"),o=Zt.childElements(n);r.setAttribute("class","control-border"),a.setAttribute("class","control-opaque0");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!1,!1)}},t.scrollControlList=function(t,e){var r=Zt.findChildOfType(t,"svg"),i=Zt.findChildOfType(r,"itemgroup"),n=i.childElementCount;if(0!=n){var a=Kt.getFloatAttribute(r,"height"),o=Kt.getFloatAttribute(t,"item-height"),s=n*o,l=i.getAttribute("transform"),u=Kt.parseTranslateTransform(l)[1];u+=e*o,u=Math.max(-s+a,u),u=Math.min(u,0),u=Math.round(u),i.setAttribute("transform","translate(0,"+u+")");var c=Zt.findChildOfType(r,"scrollbargroup"),h=Zt.findChildOfType(c,"handle"),d=Kt.getFloatAttribute(h,"height"),p=(a/2-u)/s,f=Math.max(2,a*p-d/2);f=Math.min(a-d-2,f),h.setAttribute("y",f.toString())}},t.prototype.setupControlListItem=function(t,e,r,i,n){var a=this,o=Zt.findChildOfType(t,"background"),s=Zt.findChildOfType(t,"text");t.setAttribute("transform","translate(0,"+e+")"),Kt.setMultipleAttributes(o,["width","height"],[r,i]),Kt.setMultipleAttributes(s,["x","y"],[2,i/2+.3*n]);var l=function(t){return a.onControlListItemMouseEvent(t)};t.addEventListener("mouseover",l),t.addEventListener("mouseout",l),t.addEventListener("click",l)},t.prototype.onControlListItemMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))switch(e.type){case"mouseover":t.updateControlListItemLook(r,!0,!0);break;case"mouseout":t.updateControlListItemLook(r,!0,!1);break;case"click":e.stopPropagation(),e.preventDefault();var a="true"==n.getAttribute("multiple"),o=Zt.childElements(i),s=Kt.indexInParent(r),l="true"==r.getAttribute("selected");if(a)if(e.ctrlKey)r.setAttribute("selected",String(!l)),t.updateControlListItemLook(r,!0,!0);else if(e.shiftKey){var u=Kt.getIntAttribute(n,"last-clicked");for(c=0;c<o.length;c++)l=u<=s?u<=c&&c<=s:s<=c&&c<=u,o[c].setAttribute("selected",l),t.updateControlListItemLook(o[c],!0,c==s)}else for(c=0;c<o.length;c++)o[c].setAttribute("selected",c==s),t.updateControlListItemLook(o[c],!0,c==s);else{l=!e.ctrlKey||!l;for(var c=0;c<o.length;c++)o[c].setAttribute("selected",c==s&&l),t.updateControlListItemLook(o[c],!0,c==s)}n.setAttribute("last-clicked",s.toString());var h="";for(c=0;c<o.length;c++){if("true"==o[c].getAttribute("selected"))h+=Zt.findChildOfType(o[c],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,h)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=Zt.findChildOfType(t,"background"),a=Zt.findChildOfType(t,"text"),o="true"==i.getAttribute("enabled"),s="true"==t.getAttribute("selected");if(!o)return n.setAttribute("class",s?"control-background-selected-disabled":""),void a.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",s?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",s?"control-list-background-selected-hover":""),a.setAttribute("class",s?"control-text-selected-hover":"")):(n.setAttribute("class",s?"control-list-background-selected":""),a.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=Zt.findChildOfType(e,"svg"),i=Zt.findChildOfType(r,"scrollbargroup"),n=Zt.findChildOfType(i,"scrollbar"),a=Zt.findChildOfType(i,"handle"),o=Kt.getFloatAttribute(r,"width"),s=Kt.getFloatAttribute(r,"height"),l=o-Kt.getFloatAttribute(n,"width");n.setAttribute("x",l.toString()),n.setAttribute("height",s.toString()),a.setAttribute("x",(l+2).toString()),a.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=Zt.findChildOfType(t,"svg"),i=Zt.findChildOfType(r,"scrollbargroup"),n=(Zt.findChildOfType(i,"scrollbar"),Zt.findChildOfType(i,"handle")),a=Kt.getFloatAttribute(r,"height"),o=Zt.findChildOfType(r,"itemgroup").childElementCount,s=0;e=o>0&&a<(s=o*Kt.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e&&n.setAttribute("height",Math.max(a*(a/s)-4,7).toString())},t.onControlListScrollbarMouseEvent=function(e){var r=e.currentTarget,i=r.parentNode.parentNode;if("false"!=i.getAttribute("enabled")){var n=Zt.findChildOfType(r,"scrollbar"),a=Kt.getFloatAttribute(n,"height"),o=n.getBoundingClientRect().height/a,s=Kt.offsetPage(n),l=(e.pageY-s.top)/o,u=Zt.findChildOfType(r,"handle"),c=Kt.getFloatAttribute(u,"y");switch(e.type){case"mouseout":case"mouseup":t.controlListScrollbarButtonDown=0;break;case"mousedown":1==e.which&&e.target==u&&(e.stopPropagation(),t.controlListScrollbarButtonDown=1,t.controlListScrollbarMousePos=l);break;case"mousemove":if(1==t.controlListScrollbarButtonDown){e.stopPropagation();var h=l-t.controlListScrollbarMousePos,d=Zt.findChildOfType(i,"svg"),p=Zt.findChildOfType(d,"itemgroup").childElementCount,f=Kt.getFloatAttribute(i,"item-height"),m=h*(p*f/a)/f;t.scrollControlList(i,-m),t.controlListScrollbarMousePos=l}break;case"click":if(e.stopPropagation(),e.preventDefault(),e.target==n){m=Math.floor(a/Kt.getFloatAttribute(i,"item-height"));t.scrollControlList(i,l<c?m:-m)}}}},t.controlListScrollbarButtonDown=0,t}(),rf=function(){function t(t){this.frameDrawing=t,this.controlList=new ef(t,this)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return Qt.createUnsupportedObject("File chooser is not supported in the Cloud mode");case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":t.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":Qt.updateUnsupportedObject(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=Zt.cloneElementWithId("control-button");return new m(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=Zt.findChildOfType(e,"background"),a=Zt.findChildOfType(e,"text"),o=0;o<r.length;o++)switch(r[o]){case"enabled":e.setAttribute(r[o],i[o]);var s="true"==i[o];n.setAttribute("class",s?"control-background":"control-background-disabled"),a.setAttribute("class",s?"control-button-text":"control-text-disabled");break;case"text":a.firstChild.textContent=i[o];break;case"background-color":break;case"text-color":a.setAttribute("fill",i[o]);break;case"font-style":a.style.font=i[o],t.centerControlText(a,n,!0,!0);break;case"width":case"height":var l=parseFloat(i[o])-2;n.setAttribute(r[o],l.toString()),t.centerControlText(a,n,!0,!0);break;default:hf.filterAndSetAttribute(e,r[o],i[o])}},t.onButtonOver=function(t){var e=Zt.findChildOfType(t,"background"),r=Zt.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=Zt.findChildOfType(t,"background"),r=Zt.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=Zt.findChildOfType(t,"background"),r=Zt.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.onControlAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=Zt.cloneElementWithId("control-checkbox");return new m(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=Zt.findChildOfType(e,"background"),a=Zt.findChildOfType(e,"box"),o=Zt.findChildOfType(e,"check"),s=Zt.findChildOfType(e,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-checkbox-box":"control-checkbox-box-disabled"),o.setAttribute("class",u?"control-checkbox-check":"control-checkbox-check-disabled"),s.setAttribute("class",u?"":"control-text-disabled");break;case"text":s.firstChild.textContent=i[l];break;case"background-color":n.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":s.style.font=i[l],t.centerControlText(s,n,!1,!0);break;case"width":n.setAttribute(r[l],i[l]);break;case"height":n.setAttribute(r[l],i[l]);var c=parseFloat(i[l]);a.setAttribute("y",(c/2-8).toString()),o.setAttribute("transform","translate(0,"+(c/2-8)+")"),t.centerControlText(s,n,!1,!0);break;case"value":o.setAttribute("visibility","true"==i[l]?"inherit":"hidden");break;default:hf.filterAndSetAttribute(e,r[l],i[l])}},t.onCheckboxOver=function(t){var e=Zt.findChildOfType(t,"box"),r=Zt.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=Zt.findChildOfType(t,"box"),r=Zt.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=Zt.findChildOfType(t,"box"),r=Zt.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=Zt.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.onControlAction(t.id,r)},t.prototype.createSlider=function(){var t=this,e=Zt.cloneElementWithId("control-slider"),r=function(e){return t.onSliderEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("mouseup",r),e.addEventListener("mousemove",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r),e},t.updateSlider=function(e,r,i){for(var n=Zt.findChildOfType(e,"sensor"),a=Zt.findChildOfType(e,"background"),o=Zt.findChildOfType(e,"line"),s=Zt.findChildOfType(e,"progress"),l=Zt.findChildOfType(e,"handle"),u=(Zt.findChildOfType(e,"value"),0);u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];o.setAttribute("class",c?"control-background":"control-background-disabled"),s.setAttribute("class",c?"control-slider-progress":"control-background-selected-disabled"),l.setAttribute("class",c?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":a.setAttribute("fill",i[u]);break;case"width":case"height":a.setAttribute(r[u],i[u]);break;case"vertical":e.setAttribute(r[u],i[u]);var h=Kt.getFloatAttribute(a,"width"),d=Kt.getFloatAttribute(a,"height");Kt.setMultipleAttributes(n,["x","y","width","height"],[String(-1e3),String(-1e3),String(h+2e3),String(d+2e3)]);var p=void 0,f=void 0,m=void 0,g=void 0,b=void 0,v=void 0,y=void 0,A=void 0,T=void 0,C=void 0;"false"==i[u]?(b=p=0,v=f=d/2-2,m=h,y=0,A=g=4,T=0,C=d/2):(b=p=h/2-2,f=0,v=d,y=m=4,g=d,A=0,T=h/2,C=d),Kt.setMultipleAttributes(o,["x","y","width","height"],[p,f,m,g]),Kt.setMultipleAttributes(s,["x","y","width","height"],[b,v,y,A]),Kt.setMultipleAttributes(l,["cx","cy"],[T,C]);break;case"value":var S=Kt.getFloatAttribute(e,"min"),E=Kt.getFloatAttribute(e,"max");h=Kt.getFloatAttribute(a,"width"),d=Kt.getFloatAttribute(a,"height");var w="true"==e.getAttribute("vertical")?d:h,k=(parseFloat(i[u])-S)/(E-S)*w;t.setSliderHandlePosition(e,k);break;default:hf.filterAndSetAttribute(e,r[u],i[u])}},t.prototype.onSliderEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=Zt.findChildOfType(r,"background"),n=Zt.findChildOfType(r,"progress"),a=Kt.getFloatAttribute(i,"width"),o=Kt.getFloatAttribute(i,"height"),s=i.getBoundingClientRect(),l=s.width/a,u=s.height/o,c=Kt.offsetPage(i),h="true"==r.getAttribute("vertical");if(e.type.startsWith("mouse")||"wheel"==e.type){var d=e,p=(d.pageX-c.left)/l,f=(d.pageY-c.top)/u,m=h?o-f:p;switch(e.type){case"mouseover":e.stopPropagation(),t.onSliderOver(r);break;case"mouseout":if(r.contains(d.relatedTarget))return;1==t.sliderButtonDown&&(t.setSliderHandlePosition(r,m),this.confirmSliderValue(r)),t.sliderButtonDown=0,t.onSliderOut(r);break;case"mousedown":t.sliderButtonDown=d.which,1==t.sliderButtonDown&&(e.stopPropagation(),t.onSliderHandleGrabbed(r,m));break;case"mousemove":1==t.sliderButtonDown&&(e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m));break;case"mouseup":1==t.sliderButtonDown&&(e.stopPropagation(),this.onSliderHandleReleased(r)),t.sliderButtonDown=0;break;case"wheel":if(!d.altKey&&!d.ctrlKey){var g=e;e.stopPropagation(),e.preventDefault();var b=Kt.getFloatAttribute(n,h?"height":"width");t.setSliderHandlePosition(r,b+(g.deltaY<0?1:-1)),this.confirmSliderValue(r)}}}else if(e.type.startsWith("touch")){var v=e;if(v.touches.length>1)return void this.onSliderHandleReleased(r);var y="touchend"==e.type?v.changedTouches[0]:v.touches[0];p=void 0,f=void 0;p=(y.pageX-c.left)/l,f=(y.pageY-c.top)/u;m=h?o-f:p;switch(e.type){case"touchstart":e.stopPropagation(),t.onSliderOver(r),t.onSliderHandleGrabbed(r,m);break;case"touchmove":e.stopPropagation(),e.preventDefault(),t.setSliderHandlePosition(r,m);break;case"touchend":e.stopPropagation(),this.onSliderHandleReleased(r),t.onSliderOut(r)}}}},t.onSliderOver=function(e){var r=Zt.findChildOfType(e,"line"),i=Zt.findChildOfType(e,"progress"),n=Zt.findChildOfType(e,"handle"),a=Zt.findChildOfType(e,"value");r.setAttribute("class","control-slider-line-hover"),i.setAttribute("class","control-fill-color-transition"),n.setAttribute("class",1==t.sliderButtonDown?"control-slider-handle-pressed":"control-slider-handle-hover"),a.setAttribute("class","control-opaque1")},t.onSliderOut=function(t){var e=Zt.findChildOfType(t,"sensor"),r=Zt.findChildOfType(t,"line"),i=Zt.findChildOfType(t,"progress"),n=Zt.findChildOfType(t,"handle"),a=Zt.findChildOfType(t,"value");e.setAttribute("visibility","hidden"),r.setAttribute("class","control-background"),i.setAttribute("class","control-slider-progress"),n.setAttribute("r","8"),n.setAttribute("class","control-slider-handle"),a.setAttribute("class","control-opaque0")},t.onSliderHandleGrabbed=function(e,r){var i=Zt.findChildOfType(e,"sensor"),n=Zt.findChildOfType(e,"handle");Zt.bringElementToFront(e),n.setAttribute("r","7"),n.setAttribute("class","control-slider-handle-pressed"),i.setAttribute("visibility","inherit"),t.setSliderHandlePosition(e,r)},t.prototype.onSliderHandleReleased=function(t){var e=Zt.findChildOfType(t,"sensor"),r=Zt.findChildOfType(t,"handle");r.setAttribute("r","8"),r.setAttribute("class","control-slider-handle-hover"),e.setAttribute("visibility","hidden"),this.confirmSliderValue(t)},t.setSliderHandlePosition=function(t,e){var r=Zt.findChildOfType(t,"background"),i=Zt.findChildOfType(t,"progress"),n=Zt.findChildOfType(t,"handle"),a=Zt.findChildOfType(t,"value"),o=Kt.getFloatAttribute(r,"width"),s=Kt.getFloatAttribute(r,"height"),l="true"==t.getAttribute("vertical"),u=l?s:o;e=Math.min(u,Math.max(e,0));var c,h=Kt.getFloatAttribute(t,"min"),d=Kt.getFloatAttribute(t,"max"),p=Kt.getFloatAttribute(t,"step");c=p>0?h+Math.round(e/u*(d-h)/p)*p:h+e/u*(d-h),e=((c=Math.min(c,d))-h)/(d-h)*u,l?(i.setAttribute("y",(u-e).toString()),i.setAttribute("height",e.toString()),n.setAttribute("cy",(u-e).toString())):(i.setAttribute("width",e.toString()),n.setAttribute("cx",e.toString()));var f=a.firstElementChild,m=a.lastElementChild;m.firstChild.textContent=Kt.formatNumber(c,void 0);var g=m.getComputedTextLength()+10;f.setAttribute("width",g.toString()),f.setAttribute("x",(5-g).toString());var b=l?o/2-9:e-14,v=l?s-e-15-10:s/2-15-4;a.setAttribute("transform","translate("+b+","+v+")"),t.setAttribute("current-value",c)},t.prototype.confirmSliderValue=function(t){var e=Kt.getFloatAttribute(t,"current-value");e!=Kt.getFloatAttribute(t,"last-value")&&(this.frameDrawing.onControlAction(t.id,e),t.setAttribute("last-value",e.toString()))},t.createRadioButtonGroup=function(){return Zt.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"enabled":e.setAttribute(r[a],i[a]);for(var o="true"==i[a],s=Zt.childElements(e),l=0;l<s.length;l++){var u=s[l],c=Zt.findChildOfType(u,"circle"),h=Zt.findChildOfType(u,"check"),d=Zt.findChildOfType(u,"text");c.setAttribute("class",o?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),h.setAttribute("class",o?"control-radiobutton-check":"control-text-disabled"),d.setAttribute("class",o?"":"control-text-disabled")}break;case"text-array":var p=i[a].split("\n"),f=function(r){var i=Zt.cloneElementWithId("radio-button"),a=Zt.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var o=Zt.findChildOfType(i,"text");o.firstChild.textContent=p[r],e.hasAttribute("text-color")&&o.setAttribute("fill",e.getAttribute("text-color")),new m(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(l=0;l<p.length;l++)f(l);break;case"background-color":case"text-color":e.setAttribute(r[a],i[a]);break;case"font-style":e.style.font=i[a];break;case"width":case"height":e.setAttribute(r[a],i[a]);break;case"vertical":var g=Kt.getFloatAttribute(e,"width"),b=Kt.getFloatAttribute(e,"height"),v=0;s=Zt.childElements(e);for(l=0;l<s.length;l++){u=s[l];var y=Zt.findChildOfType(u,"background"),A=(d=Zt.findChildOfType(u,"text")).getBBox();if("true"==i[a]){var T=Math.max(25,1.5*A.height);u.setAttribute("transform","translate(0,"+T*l+")"),Kt.setMultipleAttributes(y,["width","height"],[g,T])}else{var C=20+A.width+10;u.setAttribute("transform","translate("+v+",0)"),Kt.setMultipleAttributes(y,["width","height"],[C,b]),v+=C}t.centerRadioButton(u)}break;case"value":var S=parseInt(i[a]);s=Zt.childElements(e);for(l=0;l<s.length;l++){u=s[l];(h=Zt.findChildOfType(u,"check")).setAttribute("visibility",S==l?"inherit":"hidden")}break;default:hf.filterAndSetAttribute(e,r[a],i[a])}},t.onRadioButtonOver=function(t){var e=Zt.findChildOfType(t,"circle"),r=Zt.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=Zt.findChildOfType(t,"circle"),r=Zt.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=Zt.findChildOfType(t,"circle"),r=Zt.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=Zt.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=Zt.childElements(r),n=0;n<i.length;n++){var a=i[n];Zt.findChildOfType(a,"check").setAttribute("visibility",a==t?"inherit":"hidden"),a==t&&(e=n)}this.frameDrawing.onControlAction(r.id,e)}},t.centerRadioButton=function(e){var r=Zt.findChildOfType(e,"background"),i=Zt.findChildOfType(e,"circle"),n=Zt.findChildOfType(e,"check"),a=Zt.findChildOfType(e,"text"),o=Kt.getFloatAttribute(r,"height");i.setAttribute("cy",(o/2).toString()),n.setAttribute("cy",(o/2).toString()),t.centerControlText(a,r,!1,!0)},t.createListBox=function(){return ef.createControlList(!1)},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var t=this,e=Zt.cloneElementWithId("control-combobox"),r=function(e){return t.onComboBoxEvent(e)};e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("click",r);var i=ef.createControlList(!0);return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),e.appendChild(i),e},t.prototype.updateComboBox=function(e,r,i){for(var n=Zt.findChildOfType(e,"svg"),a=Zt.findChildOfType(e,"border"),o=Zt.findChildOfType(e,"dropdown"),s=Zt.findChildOfType(n,"background"),l=Zt.findChildOfType(n,"text"),u=Zt.findChildOfType(n,"arrowback"),c=Zt.findChildOfType(n,"arrow"),h=0;h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var d="true"==i[h];l.setAttribute("class",d?"":"control-text-disabled"),a.setAttribute("class",d?"control-border":"control-border-disabled"),d||o.setAttribute("visibility","hidden"),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-array":var p=Kt.splitSkipEmpty(i[h],"\n"),f=p.length>0?p[0]:"";l.firstChild.textContent=f,this.controlList.updateControlList(o,[r[h]],[i[h]]),this.controlList.adjustControlListHeightToItems(o,5),this.controlList.updateControlList(o,["value"],[f]);break;case"background-color":s.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-color":l.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"font-style":e.style.font=i[h],t.centerControlText(l,s,!1,!0),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"width":case"height":var m=parseFloat(i[h]);if(n.setAttribute(r[h],i[h]),s.setAttribute(r[h],i[h]),a.setAttribute(r[h],i[h]),"width"==r[h])u.setAttribute("x",(m-20).toString()),this.controlList.updateControlList(o,[r[h]],[i[h]]);else{t.centerControlText(l,s,!1,!0),u.setAttribute("height",m.toString()),o.setAttribute("transform","translate(0,"+i[h]+")");var g=5*parseFloat(i[h]);this.controlList.updateControlList(o,["height"],[g.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var b=Kt.getFloatAttribute(n,"width")-10,v=Kt.getFloatAttribute(n,"height")/2;c.setAttribute("transform","translate("+b+","+v+")")}break;case"editable":e.setAttribute(r[h],i[h]);break;case"value":l.firstChild.textContent=i[h],this.controlList.updateControlList(o,[r[h]],[i[h]]);break;default:hf.filterAndSetAttribute(e,r[h],i[h])}},t.prototype.onComboBoxEvent=function(t){var e=t.currentTarget;if("false"!=e.getAttribute("enabled")){var r=Zt.findChildOfType(e,"svg"),i=Zt.findChildOfType(e,"border"),n=Zt.findChildOfType(e,"dropdown"),a=Zt.findChildOfType(r,"background"),o=Zt.findChildOfType(r,"text"),s=Zt.findChildOfType(r,"arrowback"),l=Zt.findChildOfType(r,"arrow"),u="true"==e.getAttribute("editable");switch(t.type){case"mouseover":i.setAttribute("class","control-border-hover"),s.setAttribute("class","control-combobox-arrow-background-hover"),l.setAttribute("class","control-fill-color-transition");break;case"mouseout":if(e.contains(t.relatedTarget))return;i.setAttribute("class","control-border"),s.setAttribute("class","control-fill-transparent-transition"),l.setAttribute("class","control-fill-transparent-transition"),n.setAttribute("visibility","hidden");break;case"mousedown":1!=t.which||!u||t.target!=a&&t.target!=o||(t.stopPropagation(),this.displayTextInputForSVG(e,"left"));break;case"click":if(!u||t.target==s||t.target==l){t.stopPropagation(),t.preventDefault(),Zt.bringElementToFront(e);var c="inherit"==n.getAttribute("visibility");n.setAttribute("visibility",c?"hidden":"inherit")}}}},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=Zt.findChildOfType(t,"svg"),i=Zt.findChildOfType(t,"dropdown"),n=Zt.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var a=e.split("\n")[0];n.firstChild.textContent=a,this.frameDrawing.onControlAction(t.id,a)},t.prototype.createTextField=function(){var e=this,r=Zt.cloneElementWithId("control-textfield");return new m(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r)},function(t){return e.onTextFieldDown(r)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=Zt.findChildOfType(e,"svg"),a=Zt.findChildOfType(e,"border"),o=Zt.findChildOfType(n,"background"),s=Zt.findChildOfType(n,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];s.setAttribute("class",u?"":"control-text-disabled"),a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":e.style.font=i[l],t.centerControlText(s,o,!1,!0);break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),"width"==r[l]&&s.setAttribute("x",(parseFloat(i[l])-2).toString()),t.centerControlText(s,o,!1,!0);break;case"value":s.firstChild.textContent=i[l];break;default:hf.filterAndSetAttribute(e,r[l],i[l])}},t.onTextFieldOver=function(t){Zt.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){Zt.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t){this.displayTextInputForSVG(t,"right")},t.createProgressBar=function(){return Zt.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,a=Zt.findChildOfType(n,"background"),o=Zt.findChildOfType(n,"progress"),s=Zt.findChildOfType(n,"text"),l=Zt.findChildOfType(n,"border"),u=0;u<r.length;u++)switch(r[u]){case"background-color":a.setAttribute("fill",i[u]);break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":e.style.font=i[u],t.centerControlText(s,a,!1,!0);break;case"width":case"height":e.setAttribute(r[u],i[u]);break;case"vertical":var c="true"==i[u],h=e.getAttribute(c?"height":"width"),d=e.getAttribute(c?"width":"height");a.setAttribute("width",h),a.setAttribute("height",d),o.setAttribute("height",d),t.centerControlText(s,a,!0,!0),l.setAttribute("width",h),l.setAttribute("height",d),c&&n.setAttribute("transform","translate(0,"+h+") rotate(-90)");break;case"text":s.firstChild.textContent="null"==i[u]?"":i[u];break;case"value":var p=Kt.getFloatAttribute(a,"width");"null"==i[u]?(o.setAttribute("class","control-progressbar-indeterminate"),o.setAttribute("width",p.toString())):(o.setAttribute("class","control-slider-progress"),o.setAttribute("width",(parseFloat(i[u])*p).toString()));break;default:hf.filterAndSetAttribute(e,r[u],i[u])}},t.prototype.displayTextInputForSVG=function(t,e){var r=this,i=Zt.findChildOfType(t,"svg"),n=Zt.findChildOfType(i,"text"),a=document.getElementById("text-input-for-svg-container");a.style.display="block";var o=i.getBoundingClientRect(),s=Kt.getFloatAttribute(i,"width"),l=Kt.getFloatAttribute(i,"height"),u=o.width/s,c=a.firstElementChild;c.style.left=o.left+"px",c.style.top=o.top+"px",c.style.width=s+"px",c.style.height=l+"px",c.style.transform="scale("+u+")",c.style.font=t.style.font,c.style.textAlign=e,c.value=n.firstChild.textContent,a.setAttribute("control-id",t.id);var h=function(t){return r.onTextInputForSVGEvent(t)};a.onmousedown=h,a.onwheel=h,a.onkeypress=h,a.ontouchstart=h,window.setTimeout(function(){c.focus(),c.select()},0)},t.prototype.onTextInputForSVGEvent=function(t){var e=t.currentTarget,r=e.firstElementChild,i=e.getAttribute("control-id"),n=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=r&&(n=!0);break;case"wheel":n=!0;break;case"keypress":"Enter"==t.code&&(n=!0)}n&&(e.style.display="none",this.onTextInputForSVGChanged(i,r.value))},t.prototype.onTextInputForSVGChanged=function(t,e){var r=document.getElementById(t),i=Zt.findChildOfType(r,"svg");if(Zt.findChildOfType(i,"text").firstChild.textContent=e,this.frameDrawing.onControlAction(t,e),"ControlComboBox"==r.getAttribute("type")){var n=Zt.findChildOfType(r,"dropdown");this.controlList.updateControlList(n,["value"],[e])}},t.centerControlText=function(t,e,r,i){var n=Kt.getFloatAttribute(e,"width"),a=Kt.getFloatAttribute(e,"height"),o=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*o.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.onControlAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t.sliderButtonDown=0,t}(),nf=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){for(var e=Zt.findChildOfType(t,"picture"),r=Zt.findChildOfType(t,"pictureback"),i=Zt.childElements(Zt.findChildOfType(t,"legend")),n=i.length,a="true"==t.getAttribute("show-pdf"),o="true"==t.getAttribute("show-cdf"),s="true"==t.getAttribute("show-mean"),l=(Kt.getFloatAttribute(r,"x"),Kt.getFloatAttribute(r,"y")),u=(Kt.getFloatAttribute(r,"width"),Kt.getFloatAttribute(r,"height")),c=0;c<n;c++){var h=Zt.createSvgElement("g");if(a){var d=Zt.createSvgElement("g");h.appendChild(d)}if(o){var p=Zt.createSvgElement("polyline");Kt.setMultipleAttributes(p,["fill","stroke-width","stroke"],["none",i[c].getAttribute("cdf-line-width"),i[c].getAttribute("cdf-color")]),h.appendChild(p)}if(s){var f=Zt.createSvgElement("line");Kt.setMultipleAttributes(f,["stroke-width","stroke","y1","y2"],[i[c].getAttribute("cdf-line-width"),i[c].getAttribute("mean-color"),l.toString(),(l+u).toString()]),h.appendChild(f)}e.appendChild(h),cf.addClickTapHandlerToChartItem(h)}},t.prototype.draw=function(t,e){for(var r=Zt.findChildOfType(t,"pictureback"),i=Zt.findChildOfType(t,"picture"),n=Zt.findChildOfType(t,"grid"),a=Zt.childElements(Zt.findChildOfType(t,"legend")),o="true"==t.getAttribute("show-pdf"),s="true"==t.getAttribute("show-cdf"),l="true"==t.getAttribute("show-mean"),u=Kt.getFloatAttribute(t,"bar-width"),c=Kt.getFloatAttribute(r,"x"),h=Kt.getFloatAttribute(r,"y"),d=Kt.getFloatAttribute(r,"width"),p=Kt.getFloatAttribute(r,"height"),f=Kt.splitSkipEmpty(e," "),m=f.length,g=1/0,b=-1/0,v=1/0,y=-1/0,A=[],T=[],C=[],S=[],E=[],w=[],k=[],x=[],M=[],O=0;O<m;O++)if("empty"!=f[O]){f[O]=Kt.splitSkipEmpty(f[O],":"),A[O]="true"==f[O][0],T[O]="true"==f[O][1],C[O]=parseFloat(f[O][2]),S[O]=parseFloat(f[O][3]),E[O]=parseFloat(f[O][4]),w[O]=parseInt(f[O][5]),k[O]=parseInt(f[O][6]),x[O]=Kt.splitToFloats(f[O][7],"|");for(var I=0;I<x[O].length;I++)x[O][I]<v&&(v=x[O][I]),y<x[O][I]&&(y=x[O][I]);A[O]&&(M[O]=Kt.splitToFloats(f[O][8],"|")),C[O]<g&&(g=C[O]),b<S[O]&&(b=S[O])}g==1/0&&(g=0,b=0),v==1/0&&(v=0,y=1),this.chartScaleAndGrid.recalcChartScale(t,g,b,!1,!1),this.chartScaleAndGrid.recalcChartScale(t,0,y,!0,!1);var _=Kt.getFloatAttribute(n,"min-x"),L=Kt.getFloatAttribute(n,"max-x"),P=Kt.getFloatAttribute(n,"min-y"),R=Kt.getFloatAttribute(n,"max-y"),F=d/(L-_),D=p/(R-P),N=Zt.childElements(i);for(O=0;O<m;O++)if("empty"!=f[O]){"hidden"==N[O].getAttribute("visibility")&&N[O].setAttribute("visibility","inherit");var B=x[O].length,G=(S[O]-C[O])/B,U=a[O].getAttribute("original-color"),H=void 0,z=void 0;if(T[O]&&(H=a[O].getAttribute("low-color"),z=a[O].getAttribute("high-color")),o){var W=N[O].firstElementChild,V=u*G*F,Y=G*(1-u)/2;for(I=0;I<B;I++){var j=c+(C[O]+I*G+Y-_)*F,X=h+(R-x[O][I])*D,q=x[O][I]*D,Z=Zt.childElements(W)[I];Z?Z.setAttribute("visibility","inherit"):(Z=Zt.createSvgElement("rect"),W.appendChild(Z)),Kt.setMultipleAttributes(Z,["x","y","width","height"],[Kt.reducePrecision(j),Kt.reducePrecision(X),Kt.reducePrecision(V),Kt.reducePrecision(q)]),A[O]&&T[O]&&I<w[O]?Z.setAttribute("fill",H):A[O]&&T[O]&&k[O]<I?Z.setAttribute("fill",z):Z.setAttribute("fill",U)}var K=Zt.childElements(W);for(I=B;I<K.length;I++)K[I].setAttribute("visibility","hidden")}if(s){var Q=o?N[O].firstElementChild.nextElementSibling:N[O].firstElementChild,J="";if(J+=c+(C[O]-_)*F+" "+(h+p)+" ",A[O])for(I=0;I<B;I++){J+=Kt.reducePrecision(c+(C[O]+(I+1)*G-_)*F)+","+Kt.reducePrecision(h+(1-M[O][I])*p)+" "}Q.setAttribute("points",J)}if(l){var $=N[O].lastElementChild,tt=c+(E[O]-_)*F;$.setAttribute("x1",tt),$.setAttribute("x2",tt)}if("NONE"!=t.getAttribute("leg-pos")){var et=Zt.findChildOfType(a[O],"value");et.firstChild.textContent=Kt.formatNumber(E[O],void 0),et.setAttribute("fill",a[O].getAttribute("mean-color"))}}else N[O].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&cf.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=Zt.findChildOfType(t,"picture"),a=Zt.childElements(n),o=Zt.childElements(a[e]),s=0;s<o.length;s++)o[s].setAttribute("visibility",r?"hidden":"inherit")},t}(),af=function(){function t(t){this.frameDrawing=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),a=Zt.findChildOfType(t,"grid"),o=Zt.findChildOfType(t,"pictureback"),s=Zt.findChildOfType(t,e?"pictureborderh":"pictureborderw"),l=a.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=l){var u=Kt.getFloatAttribute(o,"x"),c=Kt.getFloatAttribute(o,"y"),h=Kt.getFloatAttribute(o,"width"),d=Kt.getFloatAttribute(o,"height"),p="GRID_DEFAULT"==l,f="ChartBar"==r||"ChartStack"==r,m=t.getAttribute("bar-dir");e?f&&(!f||"NORTH"!=m&&"SOUTH"!=m)||Kt.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c,u,c+d]:[u+h,c,u+h,c+d]):f&&(!f||"EAST"!=m&&"WEST"!=m)||Kt.setMultipleAttributes(s,["x1","y1","x2","y2"],p?[u,c+d,u+h,c+d]:[u,c,u+h,c])}var g=a.getAttribute("grid-line-color");switch(a.setAttribute("grid-line-color",Kt.increaseTransparency(g,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var b=Kt.getFloatAttribute(t,"scale-min-"+i),v=Kt.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(b="ChartStack"==r?0:Math.min(0,b),v=Math.max(0,v)),this.recalcChartScale(t,b,v,e,!0);break;case"SCALE_TIME_WINDOW":v=Math.max(0,Kt.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,v,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var a=Zt.findChildOfType(t,"grid"),o=i?"min-y":"min-x",s=i?"max-y":"max-x";if(e!=Kt.getFloatAttribute(a,o)||r!=Kt.getFloatAttribute(a,s)){var l=e,u=r;if(l==u){if(n)return;l-=1,u+=1}var c=Zt.findChildOfType(t,"pictureback"),h=Kt.getFloatAttribute(c,i?"height":"width"),d=i?25:45,p=(u-l)/Math.floor(h/d),f=Math.pow(10,Math.ceil(Math.log(u-l)/Math.log(10))-1),m=f/5;m<p&&(m=f/2)<p&&(m=f)<p&&(m=2*f)<p&&(m=5*f),n?(l=Math.ceil(l/m)*m,u=Math.floor(u/m)*m):(l=Math.floor(l/m)*m,u=Math.ceil(u/m)*m);var g=n?e:l,b=n?r:u;Kt.setMultipleAttributes(a,[o,s],[g,b]),this.drawChartGrid(t,l,u,m,g,b,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,a,o){var s=t.getAttribute("type"),l=Zt.findChildOfType(t,"grid"),u=l.getAttribute(o?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=u){var c=o?l.lastElementChild:l.firstElementChild,h=Zt.findChildOfType(t,"pictureback"),d=l.getAttribute("grid-text-color"),p=l.getAttribute("grid-line-color"),f=o?"scale-type-y":"scale-type-x",m="SCALE_100_PERCENT"==t.getAttribute(f),g="SCALE_TIME_WINDOW"==t.getAttribute(f)?t.getAttribute("date-format-pattern"):"null",b=Math.round((r-e)/i)+1,v="GRID_DEFAULT"==u,y=!0;if("ChartBar"==s||"ChartStack"==s){var A=t.getAttribute("bar-dir");"SOUTH"!=A&&"WEST"!=A||(y=!1)}for(var T=Kt.getFloatAttribute(h,"x"),C=Kt.getFloatAttribute(h,"y"),S=Kt.getFloatAttribute(h,"width"),E=Kt.getFloatAttribute(h,"height"),w=a-n,k=(o?E:S)/w,x=i*k;c.childElementCount<b;){var M=Zt.cloneElementWithId("grid-item");c.appendChild(M)}for(var O=Zt.childElements(c),I=e,_=o?y?C+(a-e)*k:C+(e-n)*k:y?T+(e-n)*k:T+(a-e)*k,L=0;L<b;L++){var P=o?v?T-4:T:_,R=o?_:v?C+E+4:C+E,F=o?v?T+S:T+S+4:_,D=o?_:v?C:C-4,N=o?v?P-3:F+3:P,B=o?R+3:v?R+11:D-3,G=o?v?"end":"start":"middle";(M=O[L]).setAttribute("visibility","inherit");var U=M.lastElementChild;Kt.setMultipleAttributes(U,["x1","x2","y1","y2","stroke"],[P,F,R,D,p]);var H=M.firstElementChild;Kt.setMultipleAttributes(H,["x","y","text-anchor","fill"],[N,B,G,d]);var z=void 0;z=m?Kt.formatPercent(I):"null"!=g?this.gridFormattedDate(I,w,g):Kt.formatNumber(I,void 0),H.firstChild.textContent=z,I+=i,_+=o?y?-x:+x:y?+x:-x}for(L=b;L<O.length;L++)O[L].setAttribute("visibility","hidden")}},t.prototype.gridFormattedDate=function(t,e,r){var i=Kt.toDate(this.frameDrawing,t),n=Kt.toMilliseconds(this.frameDrawing,e);return n>5*Kt.YEAR?Kt.formatDate(i,"YYYY"):n>5*Kt.MONTH?Kt.formatDate(i,"MMMYYYY"):n>5*Kt.DAY?Kt.formatDate(i,"DDMMM"):n>5*Kt.HOUR?Kt.formatDate(i,"DDMMHH"):n>5*Kt.MINUTE?Kt.formatDate(i,"HHmm"):Kt.formatDate(i,"mmss")},t}(),of=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e,r,i=t.getAttribute("type"),n=Zt.findChildOfType(t,"pictureback"),a=Zt.findChildOfType(t,"picture"),o=Zt.childElements(Zt.findChildOfType(t,"legend")),s=o.length,l=Kt.getFloatAttribute(n,"x"),u=Kt.getFloatAttribute(n,"y"),c=Kt.getFloatAttribute(n,"width"),h=Kt.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var d=t.getAttribute("bar-dir");e="NORTH"==d||"SOUTH"==d;var p=Kt.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?c/s:h/s)*p:(e?c:h)*p}for(var f=0;f<s;f++){var m=void 0,g=o[f].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(m=Zt.createSvgElement("rect")).setAttribute("stroke","none"),m.setAttribute("fill",g);var b=void 0;e?(b=c/s,m.setAttribute("x","ChartBar"==i?l+b*f+(b-r)/2:l+(c-r)/2),m.setAttribute("width",r)):(b=h/s,m.setAttribute("y","ChartBar"==i?u+b*f+(b-r)/2:u+(h-r)/2),m.setAttribute("height",r)),a.appendChild(m);break;case"ChartPie":(m=Zt.createSvgElement("path")).setAttribute("stroke","none"),m.setAttribute("fill",g),a.appendChild(m)}cf.addClickTapHandlerToChartItem(m)}},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=Zt.findChildOfType(t,"pictureback"),n=Zt.findChildOfType(t,"picture"),a=Zt.childElements(n),o=Zt.findChildOfType(t,"grid"),s=Kt.getFloatAttribute(i,"x"),l=Kt.getFloatAttribute(i,"y"),u=Kt.getFloatAttribute(i,"width"),c=Kt.getFloatAttribute(i,"height"),h=Kt.splitSkipEmpty(e," "),d=h.length,p=1/0,f=-1/0,m=!1,g=0,b=0;b<d;b++)h[b]=parseFloat(h[b]),h[b]<p&&(p=h[b]),f<h[b]&&(f=h[b]),h[b]<0&&(m=!0),g+=h[b];var v=!1;if("ChartBar"==r||"ChartStack"==r){var y=t.getAttribute("bar-dir"),A="NORTH"==y||"SOUTH"==y;"ChartBar"==r?(p=Math.min(0,p),f=Math.max(0,f)):(p=0,f=Math.max(0,g));var T=t.getAttribute(A?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=T&&"SCALE_AUTO_FROM_0"!=T||this.chartScaleAndGrid.recalcChartScale(t,p,f,A,!1),v="SCALE_100_PERCENT"==T;var C=Kt.getFloatAttribute(o,A?"min-y":"min-x"),S=Kt.getFloatAttribute(o,A?"max-y":"max-x"),E=(A?c:u)/(S-C),w=0;for(b=0;b<d;b++)if("ChartStack"==r&&(m||0==g)||"ChartBar"==r&&v&&(m||0==g))a[b].setAttribute(A?"height":"width",0);else{var k=v?h[b]/g:h[b],x=Math.abs(k),M=void 0;if("ChartBar"==r)switch(y){case"NORTH":case"WEST":M=k>0?S-k:S;break;case"SOUTH":case"EAST":M=k<0?k-C:-C}else{switch(y){case"NORTH":case"WEST":M=S-(k+w);break;case"SOUTH":case"EAST":M=-C+w}w+=k}x*=E;var O=A?c:u;(M*=E)<0?(x-=-M,M=0):M+x>O&&(x-=M+x-O),x<0&&(x=0),A?(a[b].setAttribute("y",l+M),a[b].setAttribute("height",x)):(a[b].setAttribute("x",s+M),a[b].setAttribute("width",x))}}else{var I=-Math.PI/2;for(b=0;b<d;b++){var _=g<=0||m?0:2*Math.PI*(h[b]/g),L=u/2,P=c/2,R=Kt.sectorData(s+L,l+P,L,P,I,_);a[b].setAttribute("d",R),I+=_}}if(("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&v)&&m?cf.showChartWarning(t,"Neg!"):cf.hideChartWarning(t),"NONE"!=t.getAttribute("leg-pos")){var F=Zt.childElements(Zt.findChildOfType(t,"legend"));for(b=0;b<d;b++){var D=Zt.findChildOfType(F[b],"value"),N=Kt.formatNumber(h[b],void 0);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&v)&&g>0&&!m&&(N+=" ("+Kt.formatPercent(h[b]/g)+")"),D.firstChild.textContent=N,D.setAttribute("fill",h[b]>=0?"royalBlue":"fireBrick")}cf.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){Zt.childElements(Zt.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t}(),sf=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(e){for(var r=e.getAttribute("type"),i=Zt.findChildOfType(e,"picture"),n=Zt.childElements(Zt.findChildOfType(e,"legend")),a=n.length,o=0;o<a;o++){var s=n[o].getAttribute("original-color"),l=Zt.createSvgElement("g");switch(n[o].setAttribute("data","empty"),r){case"ChartPlot":case"ChartTimePlot":if("true"==n[o].getAttribute("draw-line")){var u=Zt.createSvgElement("polyline");if(u.setAttribute("fill","none"),u.setAttribute("stroke",s),u.setAttribute("stroke-width",n[o].getAttribute("line-width")),l.appendChild(u),"ChartTimePlot"==r){var c=Zt.createSvgElement("polyline");c.setAttribute("stroke","none"),c.setAttribute("fill",Kt.increaseTransparency(s,t.timePlotAlpha)),l.appendChild(c)}}if("POINT_NONE"!=n[o].getAttribute("point-style")){var h=Zt.createSvgElement("g");h.setAttribute("fill",s),l.appendChild(h)}break;case"ChartTimeStack":var d=Zt.createSvgElement("polyline");d.setAttribute("stroke-width","1"),d.setAttribute("stroke",s),d.setAttribute("fill","none"),l.appendChild(d);var p=Zt.createSvgElement("polyline");p.setAttribute("stroke","none"),p.setAttribute("fill",Kt.increaseTransparency(s,t.stackChartAlpha)),l.appendChild(p)}i.appendChild(l),cf.addClickTapHandlerToChartItem(l)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=Zt.findChildOfType(e,"pictureback"),a=Zt.findChildOfType(e,"picture"),o=Zt.findChildOfType(e,"grid"),s=Zt.childElements(Zt.findChildOfType(e,"legend")),l=Kt.getFloatAttribute(n,"x"),u=Kt.getFloatAttribute(n,"y"),c=Kt.getFloatAttribute(n,"width"),h=Kt.getFloatAttribute(n,"height"),d=u+h,p=t.mergeData(e,r),f=p.length,m=t.parseDataAndFindMinMax(p),g=m.datasets,b=m.minx,v=m.maxx,y=m.miny,A=m.maxy;if("ChartTimeStack"==i&&y<0)cf.showChartWarning(e,"Neg!");else{cf.hideChartWarning(e),"ChartTimeStack"==i&&(y=0,A=t.prepareChartTimeStackData(g));var T,C=e.getAttribute("scale-type-x"),S=e.getAttribute("scale-type-y"),E="SCALE_100_PERCENT"==S;if("SCALE_AUTO"==C)this.chartScaleAndGrid.recalcChartScale(e,b,v,!1,!1);else if("SCALE_TIME_WINDOW"==C){T=Kt.getFloatAttribute(e,"scale-max-x");var w=void 0;w="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(v,T):Math.max(v,T,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,w-T,w,!1,!0)}"SCALE_AUTO"==S&&this.chartScaleAndGrid.recalcChartScale(e,y,A,!0,!1);for(var k=Kt.getFloatAttribute(o,"min-x"),x=Kt.getFloatAttribute(o,"max-x"),M=Kt.getFloatAttribute(o,"min-y"),O=Kt.getFloatAttribute(o,"max-y"),I=c/(x-k),_=h/(O-M),L=Zt.childElements(a),P="",R=0;R<f;R++){var F=void 0,D=void 0,N=void 0,B=void 0,G=void 0,U=void 0,H=void 0,z=void 0,W=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(F="true"==s[R].getAttribute("draw-line"),D=s[R].getAttribute("point-style"),N="INTERPOLATION_STEP"==s[R].getAttribute("interpolation")),(F||"ChartTimeStack"==i)&&(G=(B=L[R].firstElementChild).nextElementSibling),D&&"POINT_NONE"!=D)switch(U=L[R].lastElementChild,D){case"POINT_CIRCLE":H="plot-point-circle",z=0,W=0;break;case"POINT_SQUARE":H="plot-point-square",z=-1.5,W=-1.5;break;case"POINT_TRIANGLE":H="plot-point-triangle",z=0,W=0}for(var V=void 0,Y=void 0,j="",X="",q=void 0,Z=void 0,K=0,Q=0;Q<g[R].length;Q++){var J=l+(g[R][Q][0]-k)*I,$=void 0;if(E){var tt=g[f-1][Q][1];$=tt<=0?0:g[R][Q][1]/tt}else $=g[R][Q][1];var et=u+(-$+O)*_;if(J<l&&(J=l),l+c<J&&(J=l+c),et<u&&(et=u),u+h<et&&(et=u+h),!(null!=V&&Math.abs(J-V)<cf.chartTolerance&&Math.abs(et-Y)<cf.chartTolerance)){if(J=Kt.reducePrecision(J),et=Kt.reducePrecision(et),0==Q&&(q=J),Z=J,B&&(N&&null!=V&&(j+=J+","+Y+" "),j+=J+","+et+" ",G&&(0==R&&(P=J+","+d+" "+P),X=J+","+et+" "+X)),U){var rt=Zt.childElements(U)[K];rt?rt.setAttribute("visibility","inherit"):(rt=Zt.createUseElement(H),U.appendChild(rt)),rt.setAttribute("x",z+J),rt.setAttribute("y",W+et)}K++,V=J,Y=et}}if(B&&(B.setAttribute("points",j),G))if("ChartTimePlot"==i){var it="";if(""!=j){var nt=u+O*_;nt<u&&(nt=u),u+h<nt&&(nt=u+h),it=Z+","+nt+" "+q+","+nt}G.setAttribute("points",j+it)}else G.setAttribute("points",j+P),P=X;if(U){var at=Zt.childElements(U);for(Q=K;Q<at.length;Q++)at[Q].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var a=e.getAttribute("type"),o=Zt.childElements(Zt.findChildOfType(e,"legend")),s=Zt.childElements(Zt.findChildOfType(e,"picture"));if("ChartTimeStack"==a)s[r].firstElementChild.setAttribute("stroke",n),s[r].lastElementChild.setAttribute("fill",Kt.increaseTransparency(n,t.stackChartAlpha));else{if("true"==o[r].getAttribute("draw-line")){var l=s[r].firstElementChild;l.setAttribute("stroke",n),"ChartTimePlot"==a&&l.nextElementSibling.setAttribute("fill",Kt.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=o[r].getAttribute("point-style")&&s[r].lastElementChild.setAttribute("fill",n)}},t.mergeData=function(e,r){for(var i=Zt.childElements(Zt.findChildOfType(e,"legend")),n=Kt.splitSkipEmpty(r," "),a=n.length,o=[],s=0;s<a;s++){var l=i[s].getAttribute("data"),u=t.mergeDataset(l,n[s]);i[s].setAttribute("data",u),o.push(u)}return o},t.mergeDataset=function(t,e){var r=Kt.splitSkipEmpty(e,"#"),i=parseInt(r[0]),n=parseInt(r[1]),a=r[2];if("empty"==t||0==n)return a;var o=Kt.splitSkipEmpty(t,"|");o.splice(0,i),o.splice(n);var s=o.join("|")+"|";return"empty"==a?s:s+a},t.parseDataAndFindMinMax=function(t){for(var e=t,r=e.length,i=1/0,n=-1/0,a=1/0,o=-1/0,s=0;s<r;s++)if("empty"==e[s])e[s]=[];else{e[s]=Kt.splitSkipEmpty(e[s],"|");for(var l=0;l<e[s].length;l++){e[s][l]=e[s][l].split(":");var u=e[s][l][0]=parseFloat(e[s][l][0]),c=e[s][l][1]=parseFloat(e[s][l][1]);u<i&&(i=u),n<u&&(n=u),c<a&&(a=c),o<c&&(o=c)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,o=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:o}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a].length<=i||t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),lf=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=Zt.findChildOfType(t,"picture"),r=Zt.findChildOfType(t,"pictureback"),i=Kt.getFloatAttribute(r,"x"),n=Kt.getFloatAttribute(r,"y"),a=Kt.getFloatAttribute(r,"width"),o=Kt.getFloatAttribute(r,"height"),s=Zt.cloneElementWithId("normal-text");s.setAttribute("fill","grey"),s.setAttribute("text-anchor","middle"),s.setAttribute("x",(i+a/2).toString()),s.setAttribute("y",(n+o/2+3).toString()),s.firstChild.textContent="Not supported at the moment",e.appendChild(s)},t.draw=function(t,e){},t.setItemLook=function(t,e,r,i){},t}(),uf=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=Zt.findChildOfType(t,"picture"),r=Zt.findChildOfType(t,"pictureback"),i=Kt.getFloatAttribute(r,"x"),n=Kt.getFloatAttribute(r,"y"),a=Kt.getFloatAttribute(r,"height"),o=Zt.childElements(Zt.findChildOfType(t,"legend")),s=o.length,l=a/s,u=l*Kt.getFloatAttribute(t,"bar-width"),c=(l-u)/2;t.setAttribute("rect-height",Kt.reducePrecision(u).toString());for(var h=0;h<s;h++){o[h].setAttribute("data","empty");var d=Zt.createSvgElement("g");d.setAttribute("transform","translate("+i+","+(n+h*l+c)+")"),e.appendChild(d),cf.addClickTapHandlerToChartItem(d)}},t.prototype.draw=function(e,r){for(var i=Zt.findChildOfType(e,"pictureback"),n=Zt.findChildOfType(e,"picture"),a=Zt.findChildOfType(e,"grid"),o=(Kt.getFloatAttribute(i,"x"),Kt.getFloatAttribute(i,"width")),s=sf.mergeData(e,r),l=s.length,u=-1/0,c=0;c<l;c++)if("empty"==s[c])s[c]=[];else{s[c]=Kt.splitSkipEmpty(s[c],"|");for(var h=0;h<s[c].length;h++)s[c][h]=s[c][h].split(":"),s[c][h][0]=parseFloat(s[c][h][0]),s[c][h][1]=parseFloat(s[c][h][1]);var d=s[c][s[c].length-1][0];u<d&&(u=d)}u==1/0&&(u=0);for(c=0;c<l;c++)0!=s[c].length&&s[c][s[c].length-1][0]<u&&s[c].push([u,s[c][s[c].length-1][1]]);var p,f=Kt.getFloatAttribute(e,"scale-max-x");p="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(u,f):Math.max(u,f,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,p-f,p,!1,!0);var m=Kt.getFloatAttribute(a,"min-x"),g=o/(Kt.getFloatAttribute(a,"max-x")-m),b=Zt.childElements(n),v=Kt.getFloatAttribute(e,"rect-height"),y=t.colorMapping(e);for(c=0;c<l;c++){var A=b[c],T=Zt.childElements(A),C=T.length,S=0,E="",w=null;for(h=0;h<s[c].length;h++){var k=s[c][h][0],x=s[c][h][1];if(k<m)w=0,E=y(x);else if(null==w)w=(k-m)*g,E=y(x);else{var M=y(x);if(M!=E||h==s[c].length-1){var O=(k-m)*g,I=void 0;S<C?(I=T[S],S++,I.setAttribute("visibility","inherit")):(I=Zt.createSvgElement("rect"),A.appendChild(I)),Kt.setMultipleAttributes(I,["x","width","height","fill"],[Kt.reducePrecision(w),Kt.reducePrecision(O-w),v,E]),w=O,E=M}}}for(var _=S;_<C;_++)T[_].setAttribute("visibility","hidden")}},t.colorMapping=function(t){var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color");e=Kt.splitSkipEmpty(e," ");for(var i=[],n=[],a=function(t){var r=e[t].split(":"),a=void 0,o=parseFloat(r[1]);switch(r[0]){case"GREATER":a=function(t){return t>o};break;case"GREATER_OR_EQUALS":a=function(t){return t>=o};break;case"LESS":a=function(t){return t<o};break;case"LESS_OR_EQUALS":a=function(t){return t<=o};break;case"EQUALS":a=function(t){return t==o};break;case"NOT_EQUALS":a=function(t){return t!=o}}i[t]=a,n[t]=r[2]},o=0;o<e.length;o++)a(o);return function(t){for(var e=0;e<i.length;e++)if(i[e](t))return n[e];return r}},t.setItemLook=function(t,e,r,i){var n=Zt.findChildOfType(t,"picture");Zt.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),cf=function(){function t(t){this.frameDrawing=t,this.chartScaleAndGrid=new af(t),this.chart1D=new of(t,this.chartScaleAndGrid),this.chart2D=new sf(t,this.chartScaleAndGrid),this.chartHistogram=new nf(t,this.chartScaleAndGrid),this.chartHistogram2D=new lf(t,this.chartScaleAndGrid),this.chartTimeColor=new uf(t,this.chartScaleAndGrid)}return t.create=function(){return Zt.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),a=Zt.findChildOfType(e,"background"),o=Zt.findChildOfType(e,"pictureback"),s=Zt.findChildOfType(e,"pictureselect"),l=Zt.findChildOfType(e,"pictureborderh"),u=Zt.findChildOfType(e,"pictureborderw"),c=Zt.findChildOfType(e,"grid"),h=0;h<r.length;h++)switch(r[h]){case"width":case"height":case"fill":case"stroke":a.setAttribute(r[h],i[h]);break;case"pic-width":case"pic-height":o.setAttribute(r[h].substring(4),i[h]),s.setAttribute(r[h].substring(4),i[h]);break;case"pic-fill":o.setAttribute(r[h].substring(4),i[h]);break;case"pic-stroke":l.setAttribute(r[h].substring(4),i[h]),u.setAttribute(r[h].substring(4),i[h]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":c.setAttribute(r[h],i[h]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":t.addItem(e,i[h]);break;case"items-completed":t.setupLegendItemsLayout(e),t.setupPicture(e);break;case"data":this.drawPicture(e,i[h]);break;default:hf.filterAndSetAttribute(e,r[h],i[h])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=Zt.findChildOfType(e,"background"),n=Zt.findChildOfType(e,"pictureback"),a=Zt.findChildOfType(e,"pictureselect"),o=Zt.findChildOfType(e,"pictureborderh"),s=Zt.findChildOfType(e,"pictureborderw"),l=Zt.findChildOfType(e,"warning"),u=Zt.findChildOfType(e,"legend"),c=e.getAttribute("leg-pos"),h=Kt.getFloatAttribute(i,"width"),d=Kt.getFloatAttribute(i,"height"),p=Kt.getFloatAttribute(e,"pic-offset-x"),f=Kt.getFloatAttribute(e,"pic-offset-y"),m=Kt.getFloatAttribute(n,"width"),g=Kt.getFloatAttribute(n,"height"),b=Kt.getFloatAttribute(e,"leg-size"),v=0,y=0,A=0,T=0;switch(c){case"SOUTH":v=p,y=d-b,A=h-p,T=b;break;case"WEST":p+=b,v=0,y=f,A=b,T=d-f;break;case"EAST":v=h-b,y=f,A=b,T=d-f;break;case"NORTH":f+=b,v=p,y=0,A=h-p,T=b}if(Kt.setMultipleAttributes(n,["x","y"],[p,f]),Kt.setMultipleAttributes(a,["x","y"],[p,f]),Kt.setMultipleAttributes(l,["x","y"],[p+m/2,f+g/2+3]),"NONE"==c?u.setAttribute("visibility","hidden"):(u.setAttribute("transform","translate("+v+","+y+")"),Kt.setMultipleAttributes(u,["width","height"],[A,T])),"ChartPie"==r){var C=m/2,S=g/2,E=Zt.createSvgElement("ellipse");Kt.setMultipleAttributes(E,["cx","cy","rx","ry","stroke","fill","visibility"],[p+C,f+S,C,S,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(E,n);var w=Zt.createSvgElement("ellipse");Kt.setMultipleAttributes(w,["cx","cy","rx","ry","stroke","fill"],[p+C,f+S,C,S,o.getAttribute("stroke"),"none"]),e.insertBefore(w,o),Zt.removeElement(e,o),Zt.removeElement(e,s)}e.onmouseover=function(e){return t.selectChart(e,!0)},e.onmouseout=function(e){return t.selectChart(e,!1)}},t.setupLegendItemsLayout=function(t){for(var e=Zt.findChildOfType(t,"legend"),r=Zt.childElements(e),i=Kt.getFloatAttribute(e,"width"),n=0,a=0,o=0;o<r.length;o++){var s=r[o],l=Zt.findChildOfType(s,"back"),u=Kt.getFloatAttribute(l,"width"),c=Zt.findChildOfType(s,"value"),h=c.getComputedTextLength(),d=Math.max(u,Kt.getFloatAttribute(c,"x")+h);l.setAttribute("width",d.toString()),0<n&&i<n+d&&(n=0,a+=20),s.setAttribute("transform","translate("+n+","+a+")"),n+=d+5}},t.showChartWarning=function(t,e){var r=Zt.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=Zt.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=Zt.findChildOfType(t,"picture"),r=Zt.findChildOfType(t,"legend");Zt.removeAllChildren(r),Zt.removeAllChildren(e)},t.addItem=function(e,r){var i=e.getAttribute("type"),n=Zt.findChildOfType(e,"legend"),a=r.split("\n"),o=a[0],s=a[1],l=Zt.cloneElementWithId("legend-item"),u=Zt.findChildOfType(l,"color"),c=Zt.findChildOfType(l,"name"),h=Zt.findChildOfType(l,"value");u.setAttribute("fill",o),l.setAttribute("original-color",o),c.setAttribute("fill",e.getAttribute("leg-text-color")),c.appendChild(Zt.createTextNode(s)),h.appendChild(Zt.createTextNode("")),n.appendChild(l);var d=c.getComputedTextLength();h.setAttribute("x",(Kt.getFloatAttribute(c,"x")+d+4).toString()),"ChartPlot"==i||"ChartTimePlot"==i?Kt.setMultipleAttributes(l,["draw-line","line-width","interpolation","point-style"],[a[2],a[3],a[4],a[5]]):"ChartHistogram"==i&&Kt.setMultipleAttributes(l,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[a[2],a[3],a[4],a[5],a[6]]),t.addClickTapHandlerToChartItem(l)},t.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":of.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":sf.setup(t);break;case"ChartTimeColor":uf.setup(t);break;case"ChartHistogram":nf.setup(t);break;case"ChartHistogram2D":lf.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":lf.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.selectChart=function(t,e){var r=t.currentTarget;Zt.findChildOfType(r,"pictureselect").setAttribute("visibility",e?"inherit":"hidden")},t.addClickTapHandlerToChartItem=function(e){new m(e,function(r){return t.selectChartItem(e,!0,!1)},function(r){return t.selectChartItem(e,!1,!1)},null,function(r){return t.selectChartItem(e,!0,!0)},function(t){return!1})},t.selectChartItem=function(e,r,i){for(var n=t.getChartShape(e),a=Kt.indexInParent(e),o=Zt.childElements(Zt.findChildOfType(n,"legend")),s=o[a],l="true"==s.getAttribute("selected"),u=!1,c=0;c<o.length;c++)if(c!=a&&"true"==o[c].getAttribute("selected")){u=!0;break}if(i)return l=!l,s.setAttribute("selected",l?"true":"false"),void t.setChartItemLook(n,a,!1,l);if(l||u){if(l)return;t.setChartItemLook(n,a,!r,r)}else{t.setChartItemLook(n,a,!1,r);for(c=0;c<o.length;c++)c!=a&&t.setChartItemLook(n,c,r,!1)}},t.setChartItemLook=function(e,r,i,n){var a=Zt.childElements(Zt.findChildOfType(e,"legend")),o=Zt.findChildOfType(a[r],"back"),s=Zt.findChildOfType(a[r],"color");o.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var l=i?t.colorItemGrayed:a[r].getAttribute("original-color");switch(s.setAttribute("fill",l),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":of.setItemLook(e,r,i,l);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":sf.setItemLook(e,r,i,l);break;case"ChartTimeColor":uf.setItemLook(e,r,i,l);break;case"ChartHistogram":nf.setItemLook(e,r,i,l);break;case"ChartHistogram2D":lf.setItemLook(e,r,i,l)}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),hf=function(){function t(e){this.serverFPS=t.MAX_FPS,this.client=e,this.chart=new cf(this),this.control=new rf(this),this.shapeComposite=new Qt(this),this.shapeGISMap=new Zp(this),this.world3d=Yp.getWorld()}return t.prototype.start=function(){this.frameDrawStartTime=Date.now(),this.catchingUp=!1,this.frameCount=0,this.fpsMeasureStartTime=null,this.actualFPS=0,this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.fullFrame=!1,this.packetFPS=t.MAX_FPS,this.desiredFPS=t.MAX_FPS,this.frameBuffer=[],this.sleepTimeStatistics=new Array(t.SLEEP_TIME_STATISTICS_SIZE),this.sleepTimeStatistics.fill(1e3/t.MAX_FPS),this.startMeasureInterval(),this.startFrameDrawingTimeout(this.desiredFPS),this.world3d.networkManager=this.client.network},t.prototype.stop=function(){this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.frameBuffer=[],this.stopMeasureInterval(),this.stopFrameDrawingTimeout(),this.world3d.deactivate()},t.prototype.startMeasureInterval=function(){var t=this;this.fpsMeasureIntervalId=setInterval(function(){return t.measureFPS()},1e3)},t.prototype.stopMeasureInterval=function(){this.fpsMeasureIntervalId&&(clearInterval(this.fpsMeasureIntervalId),this.fpsMeasureIntervalId=void 0)},t.prototype.startFrameDrawingTimeout=function(t){var e=this;this.frameDrawingTimeoutId=setTimeout(function(){var t=Date.now();e.drawFrame();var r=1e3/e.desiredFPS-(Date.now()-t);r<0&&(r=0),e.sleepTimeStatistics.push(r),e.sleepTimeStatistics.shift(),e.startFrameDrawingTimeout(r)},t)},t.prototype.stopFrameDrawingTimeout=function(){this.frameDrawingTimeoutId&&(clearTimeout(this.frameDrawingTimeoutId),this.frameDrawingTimeoutId=void 0)},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.totalFrameCount=function(){var t=this.frameBuffer.length;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.findOrRequestFullFrame=function(){if(this.fullFrame)console.log("Found a full frame in the local buffer, starting from there");else{for(var t=0;t<this.packetBuffer.length;t++){if(this.packetBuffer[t].fullFrame)return console.log("Found a full frame in the local buffer, starting from there"),void this.packetBuffer.splice(0,t)}this.packetBuffer=[],console.log("Cleared local frame buffer, requesting full frame from the server"),this.client.network.requestAndWaitFullFrame()}},t.prototype.switchToNextFrame=function(){if(0==this.frameBuffer.length){if(0==this.packetBuffer.length)return this.fullFrame=!1,this.packetFPS=t.MAX_FPS,void(this.desiredFPS=t.MAX_FPS);var e=this.packetBuffer.shift();this.frameBuffer=e.frames,this.fullFrame=e.fullFrame,this.packetFPS=e.fps,this.desiredFPS=e.fps,this.updateServerFpsIfNeeded()}return this.frameBuffer.shift()},t.prototype.updateServerFpsIfNeeded=function(){var e=this.actualFPS/this.packetFPS,r=this.measureSleepTime();if(e>=.9&&r>50&&this.serverFPS<t.MAX_FPS)return this.serverFPS++,void this.client.network.postMaxFPS(this.serverFPS);e<.9&&r<50&&this.serverFPS>1&&(this.serverFPS--,e<.7&&this.serverFPS>1&&this.serverFPS--,e<.6&&this.serverFPS>1&&this.serverFPS--,this.client.network.postMaxFPS(this.serverFPS))},t.prototype.measureSleepTime=function(){for(var t=0,e=0;e<this.sleepTimeStatistics.length;e++)t+=this.sleepTimeStatistics[e];return t/=this.sleepTimeStatistics.length},t.prototype.drawFrame=function(){var e=this.switchToNextFrame();if(e){this.client.updateExperimentState(e),this.world3d.applyFrame(e),this.fullFrame&&(this.fullFrame=!1,Zt.removeAllChildren(this.client.presentation)),this.frameDrawStartTime=Date.now(),this.client.svg.suspendRedraw(5e3),this.time=e.time;var r,i,n,a=e.commands;if(a.length>0&&"white"!=this.client.svg.style.backgroundColor&&(this.client.svg.style.backgroundColor="white"),bf.DEBUG_MODE){var o=this.totalFrameCount();this.client.debugger.timeInfo.innerHTML=Kt.formatNumber(this.time,2),this.client.debugger.serverQueueInfo.innerHTML=this.client.network.serverQueue,this.client.debugger.browserQueueInfo.innerHTML=o+":"+this.client.network.packetManager.totalFrameCount(),r=0,i=0,n=0}for(var s=0;s<a.length;s++){var l=a[s],u=void 0,c=l.att,h=l.val,d=void 0;switch(l.cmd){case"C":var p=Kt.getAttributeValue(c,h,"shape-type"),f=Kt.getAttributeValue(c,h,"owner-id"),m=Kt.getAttributeValue(c,h,"add-after");if(Kt.getAttributeValue(c,h,"draw-mode").includes("2D")||(p="Shape3DOnly"),d=this.createShape(p,l.id),"null"==f)this.client.presentation.appendChild(d);else{if(null==(u=document.getElementById(f)))return console.log("Can't find container to add a shape to, container id = "+f,l),void this.findOrRequestFullFrame();if("ShapeGISMap"==u.getAttribute("type")){var g=Zt.findChildOfType(u,"map").firstElementChild;u=p.startsWith("MarkupGIS")?Zt.findChildOfType(g,"markup"):Zt.findChildOfType(g,"agents")}if("null"==m){var b=u.firstElementChild;null==b?u.appendChild(d):u.insertBefore(d,b)}else{if(u.lastElementChild.id==m)u.appendChild(d);else{var v=document.getElementById(m);if(null==v)return console.log("Can't find element to add after, el id = "+m,l),void this.findOrRequestFullFrame();if(!u.contains(v))return console.log("the element to add after not found in group, el id = "+m,l),void this.findOrRequestFullFrame();var y=v.nextElementSibling;u.insertBefore(d,y)}}}this.updateShape(d,c,h),r++;break;case"U":if(null==(d=document.getElementById(l.id)))return console.log("Can't find shape to be updated, shape id = "+l.id,l),void this.findOrRequestFullFrame();this.updateShape(d,c,h),i++;break;case"D":if(null==(d=document.getElementById(l.id)))return console.log("Can't find shape to be deleted, shape id = "+l.id,l),void this.findOrRequestFullFrame();Zt.removeElement(d.parentNode,d),n++;break;case"S":this.applySettings(c,h);break;case"N":this.applyNavigation(c,h);break;case"M":t.showMessage(c,h);break;case"W":t.openURL(c,h);break;default:return void this.client.stopAndAlert("Unknown command: "+l.cmd,null)}}this.client.svg.unsuspendRedrawAll(),this.frameCount++,bf.DEBUG_MODE&&(this.client.debugger.cudCountInfo.innerHTML=r+"/"+i+"/"+n,this.client.debugger.drawTimeInfo.innerHTML=Date.now()-this.frameDrawStartTime,this.client.debugger.shapeCountInfo.innerHTML=qt.elementcount),!this.catchingUp&&this.packetBuffer.length>1?(this.catchingUp=!0,this.desiredFPS=1e3/this.packetFPS*.8):this.catchingUp&&(this.catchingUp=!1,this.desiredFPS=1e3/this.packetFPS)}},t.prototype.createShape=function(t,e){var r;if(Zt.isPrimitiveSVGElement(t))r=Zt.createSvgElement(t);else switch(t){case"Shape3DOnly":r=Zt.cloneElementWithId("3d-only-shape");break;case"ShapeArc":r=Qt.createShapeArc();break;case"ShapeText":r=Qt.createShapeText();break;case"ShapeImage":r=Qt.createShapeImage();break;case"ShapeCanvas":r=Qt.createShapeCanvas(e);break;case"ShapeModelElementsGroup":r=te.create();break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=Qp.createMarkupPath(t,e);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=Qp.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=Qp.createMarkupPalletRack();break;case"MarkupRailwaySwitch":r=$p.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=$p.createMarkupPositionOnTrack();break;case"MarkupPipe":r=Kp.createMarkupPipe(e);break;case"MarkupStorageTank":r=Kp.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=Kp.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=Jp.createMarkupWall(t,e);break;case"MarkupTargetLine":r=Jp.createMarkupTargetLine();break;case"MarkupPathway":r=Jp.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=Jp.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=Jp.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=Jp.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=Jp.createMarkupEscalatorGroup();break;case"MarkupIntersection":r=tf.createMarkupIntersection();break;case"MarkupRoad":r=tf.createMarkupRoad();break;case"MarkupStopLine":r=tf.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=tf.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=qp.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=cf.create();break;case"Window3D":r=jp.create(e);break;default:return this.client.stopAndAlert("Can't create: unknown object type: "+t,void 0),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(e,r,i){var n=e.getAttribute("type");if("Shape3DOnly"!=n)if(Zt.isPrimitiveSVGElement(n))for(var a=0;a<r.length;a++)switch(r[a]){case"href":e.setAttributeNS(Zt.xlinkns,"href",i[a]);break;case"href-path":e.setAttributeNS(Zt.xlinkns,"href",this.client.network.getJarResourceURL(i[a]));break;case"geo":var o=i[a].split("|");e.setAttribute("lon",o[0]),e.setAttribute("lat",o[1]),e.setAttribute("heading",o[2]),Zp.updateGISObjectPosition(e);break;default:t.filterAndSetAttribute(e,r[a],i[a])}else switch(n){case"ShapeArc":Qt.updateShapeArc(e,r,i);break;case"ShapeText":Qt.updateShapeText(e,r,i);break;case"ShapeImage":this.shapeComposite.updateShapeImage(e,r,i);break;case"ShapeCanvas":Qt.updateShapeCanvas(e,r,i);break;case"ShapeModelElementsGroup":te.update(e,r,i);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(e,r,i);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(e,r,i);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":Qp.updateMarkupPath(e,r,i);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":Qp.updateMarkupAreaNode(e,r,i);break;case"MarkupPalletRack":Qp.updateMarkupPalletRack(e,r,i);break;case"MarkupRailwaySwitch":$p.updateMarkupRailwaySwitch(e,r,i);break;case"MarkupPositionOnTrack":$p.updateMarkupPositionOnTrack(e,r,i);break;case"MarkupPipe":Kp.updateMarkupPipe(e,r,i);break;case"MarkupStorageTank":Kp.updateMarkupStorageTank(e,r,i);break;case"MarkupBulkConveyorBelt":Kp.updateMarkupBulkConveyorBelt(e,r,i);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":Jp.updateMarkupWall(e,r,i);break;case"MarkupTargetLine":Jp.updateMarkupTargetLine(e,r,i);break;case"MarkupPathway":Jp.updateMarkupPathway(e,r,i);break;case"MarkupPedFlowStatistics":Jp.updateMarkupPedFlowStatistics(e,r,i);break;case"MarkupServiceWithLines":Jp.updateMarkupServiceWithLines(e,r,i);break;case"MarkupServiceWithArea":Jp.updateMarkupServiceWithArea(e,r,i);break;case"MarkupEscalatorGroup":Jp.updateMarkupEscalatorGroup(e,r,i);break;case"MarkupIntersection":tf.updateMarkupIntersection(e,r,i);break;case"MarkupRoad":tf.updateMarkupRoad(e,r,i);break;case"MarkupStopLine":tf.updateMarkupStopLine(e,r,i);break;case"MarkupBusStop":case"MarkupParkingLot":tf.updateMarkupBusStopOrParkingLot(e,r,i);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":qp.updateGISMarkup(e,r,i);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(e,r,i);break;case"Window3D":jp.update(e,r,i)}},t.filterAndSetAttribute=function(e,r,i){if(!(["shape-type","owner-id","add-after"].indexOf(r)>=0||r.startsWith("3d")))if("pos"==r||"scale"==r){var n=t.posOrScaleToTransform(e,r,i);""==n?e.removeAttribute("transform"):e.setAttribute("transform",n)}else e.setAttribute(r,i)},t.posOrScaleToTransform=function(t,e,r){var i="",n="",a=t.getAttribute("transform"),o=null==a?-1:a.indexOf("scale");if("pos"==e){var s=Kt.splitToFloats(r,":"),l=s[0],u=s[1],c=Kt.radiansToDegrees(s[2]);0==l&&0==u||(i="translate("+l+" "+u+") "),0!=c&&(i+="rotate("+c+") "),n=o>=0?a.substring(o):""}else{var h=Kt.splitToFloats(r,":"),d=h[0],p=h[1];1==d&&1==p||(n="scale("+d+" "+p+")"),i=null==a||0==o?"":o<0?a:a.substring(0,o)}return i+n},t.prototype.measureFPS=function(){var t=Date.now();null!=this.fpsMeasureStartTime&&(this.actualFPS=Math.round(1e3*this.frameCount/(t-this.fpsMeasureStartTime))),bf.DEBUG_MODE&&(this.client.debugger.fpsInfo.innerHTML=this.actualFPS+":"+this.packetFPS),this.fpsMeasureStartTime=t,this.frameCount=0},t.prototype.onControlAction=function(t,e){this.client.network.postUserAction(t,e)},t.prototype.onUserClick=function(t,e,r){Zt.isContainedInElementOfType(t,rf.controlTypes)||Zt.isContainedInElementOfType(t,cf.chartTypes)||Zt.isContainedInElementOfType(t,["Window3D"])||Zt.isContainedInElementOfType(t,["ShapeGISMap"])||this.client.network.postUserAction(0,e+" "+r)},t.prototype.applySettings=function(t,e){for(var r=0;r<t.length;r++)this.modelSettings[Kt.hyphenToCameLCase(t[r])]=e[r];this.modelSettings.startTime=parseInt(this.modelSettings.startTime),this.modelSettings.startDate=parseInt(this.modelSettings.startDate),this.modelSettings.stopTime&&(this.modelSettings.stopTime=parseInt(this.modelSettings.startTime),this.modelSettings.stopDate=parseInt(this.modelSettings.startDate))},t.prototype.applyNavigation=function(t,e){for(var r=0;r<t.length;r++)this.navigationSettings[Kt.hyphenToCameLCase(t[r])]=e[r];this.navigationSettings.x=parseFloat(this.navigationSettings.x),this.navigationSettings.y=parseFloat(this.navigationSettings.y),this.navigationSettings.width=parseFloat(this.navigationSettings.width),this.navigationSettings.height=parseFloat(this.navigationSettings.height),this.navigationSettings.zoomAndPanningEnabled="true"==this.navigationSettings.zoomAndPanningEnabled,this.client.setNavigationSettings(this.navigationSettings.width,this.navigationSettings.height),this.client.navigation.applyNavigationSettings()},t.showMessage=function(t,e){for(var r={},i=0;i<t.length;i++)r[Kt.hyphenToCameLCase(t[i])]=e[i];var n=document.getElementById("svg-message-background"),a=document.getElementById("svg-message-box-title"),o=document.getElementById("svg-message-box-text"),s=document.getElementById("svg-message-box-icon-info"),l=document.getElementById("svg-message-box-icon-error");a.innerText=r.title,o.innerHTML=r.text.replace(/\n/g,"<br>"),r.type.startsWith("error")?(s.style.display="none",l.style.removeProperty("display"),a.classList.remove("svg-message-box-colors-info"),a.classList.add("svg-message-box-colors-error"),""==r.title&&(a.innerHTML="Error")):(s.style.removeProperty("display"),l.style.display="none",a.classList.remove("svg-message-box-colors-error"),a.classList.add("svg-message-box-colors-info"),""==r.title&&(a.innerHTML="Message")),n.style.removeProperty("display")},t.openURL=function(e,r){var i=r[0];i.startsWith("http://")&&i.startsWith("https://")||(i="http://"+i);var n=["message","Open URL","The model asks you to open an external URL:<br><a href="+i+" target = '_blank' onclick = 'document.getElementById( \"svg-message-background\" ).style.display = \"none\"'>"+i+"</a><br><br>The URL will open in a new window"];t.showMessage(["type","title","text"],n)},t.SLEEP_TIME_STATISTICS_SIZE=20,t.MAX_FPS=20,t}(),df=function(){function t(t,e,r){var i=this;this.networkManager=t,this.startTime=Date.now(),this.xhttp=this.networkManager.getAnimationPacket(e,function(){i.stopTime=Date.now(),r(i)})}return t.prototype.requestTime=function(){return this.stopTime?this.stopTime-this.startTime:Date.now()-this.startTime},t.prototype.abort=function(){this.xhttp.abort()},t}(),pf=function(){function t(t){this.paused=!1,this.networkManager=t}return t.prototype.start=function(){this.fullFrame=!0,this.activeRequests=[],this.responseTimeStatistics=new Array(t.REQUEST_STATISTICS_SIZE),this.responseTimeStatistics.fill(mf.MIN_REQUEST_INTERVAL),this.requestInterval=mf.MIN_REQUEST_INTERVAL,this.lastRequestTime=0,this.createRequest(),this.startRequestTimeout()},t.prototype.stop=function(){this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.pause=function(){this.paused=!0,this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.requestFullFrame=function(){console.debug(">> SVG: Request full frame."),this.fullFrame=!0},t.prototype.startRequestTimeout=function(){var t=this;this.requestTimeoutId=setTimeout(function(){t.processRequestTimeout()},this.requestInterval)},t.prototype.processRequestTimeout=function(){this.requestTimeoutId=void 0,this.activeRequests.length<mf.MAX_REQUEST_COUNT&&(this.createRequest(),this.startRequestTimeout())},t.prototype.createRequest=function(){var t=this,e=new df(this.networkManager,this.fullFrame,function(e){return t.processResponse(e)});this.fullFrame=!1,this.activeRequests.push(e),this.lastRequestTime=Date.now()},t.prototype.processResponse=function(t){var e=this.activeRequests.indexOf(t);if(this.activeRequests.splice(e,1),this.addToResponseTimeStatistics(t.requestTime()),void 0!==this.requestTimeoutId||this.paused||(this.createRequest(),this.startRequestTimeout()),4==t.xhttp.readyState&&200==t.xhttp.status){var r=JSON.parse(t.xhttp.responseText);this.networkManager.packetManager.addPacket(r)}},t.prototype.addToResponseTimeStatistics=function(t){this.responseTimeStatistics.push(t),this.responseTimeStatistics.shift(),this.requestInterval=this.calculateRequestInterval(),this.networkManager.RPS=1e3/this.requestInterval},t.prototype.calculateRequestInterval=function(){if(0===this.responseTimeStatistics.length)return mf.MIN_REQUEST_INTERVAL;for(var t=0,e=0;e<this.responseTimeStatistics.length;e++)t+=this.responseTimeStatistics[e];var r=t/this.responseTimeStatistics.length*.5;return r<mf.MIN_REQUEST_INTERVAL?mf.MIN_REQUEST_INTERVAL:r>mf.MAX_REQUEST_INTERVAL?mf.MAX_REQUEST_INTERVAL:r},t.REQUEST_STATISTICS_SIZE=10,t}(),ff=function(){function t(t){this.client=t,this.reset()}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.waitingFullFrame=!1,this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.pause=function(){this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.addPacket=function(t){if(t){var e=t.frames;if(e&&0!==e.length){var r=e[0];if(!(r.number<this.expectedFrameNumber)){if(r.number===this.expectedFrameNumber||t.fullFrame){this.client.network.serverQueue=t.serverQueue;var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),this.cancelWaitExpectedFrameTimeoutIfNeeded(),void(t.fullFrame&&(this.waitingFullFrame=!1))}this.insertToPacketBuffer(t),console.debug(">> SVG: Reordering  or packet loss expectedFrame=",this.expectedFrameNumber),this.startWaitExpectedFrameTimeoutIfNeeded()}}}},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length&&!(this.packetBuffer[0].frames[0].number>=this.expectedFrameNumber)){var t=this.packetBuffer[this.packetBuffer.length-1];if(t.frames[t.frames.length-1].number>=this.expectedFrameNumber)this.packetBuffer=[];else{for(var e=0;e<this.packetBuffer.length&&!(this.packetBuffer[e].frames[0].number>=this.expectedFrameNumber);e++);this.packetBuffer.splice(0,e)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length&&this.packetBuffer[0].frames[0].number===this.expectedFrameNumber){for(var t=this.expectedFrameNumber,e=0;e<this.packetBuffer.length;e++){var r=this.packetBuffer[e].frames;if(r[0].number!==t)break;t=r[r.length-1].number+1}var i=this.packetBuffer.splice(0,e);this.client.frameDrawing.addAllPackets(i),this.expectedFrameNumber=t}},t.prototype.cancelWaitExpectedFrameTimeoutIfNeeded=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startWaitExpectedFrameTimeoutIfNeeded=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,t.client.network.requestFullFrame()},4*this.client.network.RPS*1e3))},t.prototype.waitFullFrame=function(){console.debug(">> SVG: Wait full frame."),this.waitingFullFrame=!0,this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t}(),mf=function(){function t(t){this.client=t,this.packetRequester=new pf(this),this.packetManager=new ff(t)}return t.prototype.start=function(){this.packetManager.reset(),this.packetRequester.start()},t.prototype.stop=function(){this.packetRequester.stop(),this.packetManager.reset()},t.prototype.pause=function(){this.paused=!0,this.packetRequester.pause()},t.prototype.getAnimationPacket=function(t,e){if(!this.paused){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},bf.DEBUG_SPARK_LOCAL?r.open("GET","/http/update?fullFrame="+t+"&time="+Date.now(),!0):r.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+Date.now(),!0),r.send(),r}},t.prototype.postUserAction=function(t,e){if(!this.paused){var r=new XMLHttpRequest;bf.DEBUG_SPARK_LOCAL?r.open("GET","/http/useraction?id="+t+"&value="+encodeURIComponent(e)):r.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),r.send()}},t.prototype.postUserCommand=function(t,e){if(!this.paused){var r=new XMLHttpRequest;r.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),r.send()}},t.prototype.getJarResourceURL=function(t){return this.getResourceURLWithSubpath("internal-resources",t)},t.prototype.getResourceURL=function(t){return this.getResourceURLWithSubpath("resources",t)},t.prototype.getResourceURLWithSubpath=function(t,e){if(!this.paused)return bf.DEBUG_SPARK_LOCAL?"/http/image?path="+e:this.getRestRoot()+t+"?path="+e},t.prototype.getRestRoot=function(){return this.client.svgAnimationInfo.host+"/nodes/"+this.client.svgAnimationInfo.restUrl+"sessions/"+this.client.svgAnimationInfo.sessionUuid+"/"},t.prototype.postMaxFPS=function(t){if(!this.paused){var e=new XMLHttpRequest;bf.DEBUG_SPARK_LOCAL?e.open("POST","http/max-fps"):e.open("POST",this.getRestRoot()+"max-fps"),e.send(t.toString())}},t.prototype.requestFullFrame=function(){this.packetRequester.requestFullFrame()},t.prototype.requestAndWaitFullFrame=function(){this.packetRequester.requestFullFrame(),this.packetManager.waitFullFrame()},t.MIN_REQUEST_INTERVAL=500,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_REQUEST_COUNT=2,t}(),gf=function(){function t(e){var r=this;this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDebugContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDebugContainer.parentElement,this.controlPanel=document.getElementById("control-panel"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDebugTools=document.getElementById("control-panel-button-dev-panel"),this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpInfoState=document.getElementById("control-panel-info-state"),window.addEventListener("resize",function(){return r.adjustControlPanelItemsVisibility()},!1),t.assignActionOnClick(this.cpButtonRun,function(){return r.client.network.postUserCommand("run","")}),t.assignActionOnClick(this.cpButtonPause,function(){return r.client.network.postUserCommand("pause","")}),t.assignActionOnClick(this.cpButtonX1,function(){return r.setSpeed(1)}),t.assignActionOnClick(this.cpButtonSlower,function(){return r.speedUpOrDown(!1)}),t.assignActionOnClick(this.cpButtonFaster,function(){return r.speedUpOrDown(!0)}),t.assignActionOnClick(this.cpButtonVirtual,function(){return r.setSpeed(1/0)}),this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},t.assignActionOnClick(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),w.addFullScreenListener(function(){return r.onFullScreenChange()}),this.cpButtonDebugTools.style.display="none"}return t.prototype.adjustControlPanelItemsVisibility=function(){var t=this.presentationContainer.getBoundingClientRect().width,e=262,r=w.isFullScreenEnabled();this.cpButtonFullScreen.style.removeProperty("display");var i=(t-=e+=r?46:0)>=(e=178);i?(this.cpButtonSlower.style.removeProperty("display"),this.cpInfoScale.style.removeProperty("display"),this.cpButtonFaster.style.removeProperty("display")):(this.cpButtonSlower.style.display="none",this.cpInfoScale.style.display="none",this.cpButtonFaster.style.display="none"),(i=(t-=e)>=(e=46))?this.cpButtonX1.style.removeProperty("display"):this.cpButtonX1.style.display="none",(i=(t-=e)>=(e=46))?this.cpButtonVirtual.style.removeProperty("display"):this.cpButtonVirtual.style.display="none",t-=e},t.prototype.updateExperimentState=function(){this.updateInfoState(),this.updateModelTimeScale(),this.updateRunGroup(),this.updateSpeedGroup()},t.prototype.updateModelTimeScale=function(){this.cpInfoScale.innerText=t.timeScaleToString(this.client.getModelTimeScale())},t.prototype.updateExperimentProgress=function(){var t=this.client.getModelProgress(),e=this.progressBar.firstElementChild,r=100*t;this.progressBar.style.width=t<=0?"0":r+"%",e.innerText=t<0?"progress n/a":Math.round(r)+"%"},t.prototype.updateInfoState=function(){var e=this.client.getModelState(),r=t.modelStateToString(e);this.cpInfoState.innerText=t.modelStateToString(r),this.indicateCpErrorState("ERROR"==e)},t.prototype.indicateCpErrorState=function(t){t?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getModelState()&&this.indicateCpErrorState(!1)},t.prototype.updateRunGroup=function(){var e=this.client.getModelState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e;t.setVisible(this.cpButtonRun,!r),this.setEnabled(this.cpButtonRun,!r&&i),t.setVisible(this.cpButtonPause,r),this.setEnabled(this.cpButtonPause,r)},t.prototype.updateSpeedGroup=function(){var e=this.client.getModelState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e,i=t.stringToTimeScale(this.cpInfoScale.innerText);this.setEnabled(this.cpButtonX1,r&&1!=i),this.setEnabled(this.cpButtonSlower,r&&i>t.speeds[0]),this.setEnabled(this.cpButtonFaster,r&&i!=1/0),this.setEnabled(this.cpButtonVirtual,r&&i!=1/0)},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=f.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r)},t.prototype.setSpeed=function(e){this.cpInfoScale.innerText=t.timeScaleToString(e),this.client.network.postUserCommand("setspeed",e.toString()),this.updateSpeedGroup()},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=w.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed")),this.adjustControlPanelItemsVisibility()},t.prototype.toggleFullScreen=function(){w.toggleFullScreen(this.presentationContainer)},t.modelStateToString=function(t){switch(t){case"INITIALIZE":return"Initializing...";case"IDLE":return"Idle";case"RUNNING":return"Running";case"PAUSED":return"Paused";case"FINISHED":return"Finished.";case"ERROR":return"Error!";case"PLEASE_WAIT":return"Please Wait..."}return t},t.timeScaleToString=function(t){return t<0||t==1/0?"Virtual":t>=1?"x"+t:"x1/"+1/t},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.setVisible=function(t,e){e?t.style.removeProperty("display"):t.style.display="none"},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.assignActionOnClick=function(e,r){e.onclick=function(){t.isEnabled(e)&&r()}},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t}(),bf=function(){function t(){this.windowAdjusted=!1,this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new hf(this),this.navigation=new Xp(this),this.network=new mf(this),this.controlPanel=new gf(this)}return t.prototype.start=function(t){this.svgAnimationInfo=t,this.svg.style.pointerEvents="auto",this.navigation.initSVGNavigation(),this.network.start(),this.frameDrawing.start(),this.modelState="INITIALIZE"},t.prototype.stop=function(t){t?(this.modelState=t.type,this.controlPanel.updateExperimentState()):this.modelState=void 0,this.frameDrawing.stop(),this.navigation.clearSVGNavigation(),this.network.stop(),this.onToggleFullScreen=void 0,this.onResize=void 0,this.onStop=void 0,this.windowAdjusted=!1,Zt.removeAllChildren(this.presentation)},t.prototype.setCallback=function(t,e){switch(t){case"ontogglefullscreen":this.onToggleFullScreen=e;break;case"onstop":this.onStop=e;break;case"onresize":this.onResize=e}},t.prototype.pause=function(){this.network.pause()},t.prototype.stopAndAlert=function(t,e){console.log(t),console.log(e),hf.showMessage(["type","title","text"],["error",t,e]),this.frameDrawing.stop()},t.prototype.updateExperimentState=function(t){t.state!=this.modelState&&(this.modelState=t.state,this.controlPanel.updateExperimentState()),t.progress!=this.modelProgress&&(this.modelProgress=t.progress,this.controlPanel.updateExperimentProgress()),t.time!=this.modelTime&&(this.modelTime=t.time),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.controlPanel.updateModelTimeScale())},t.prototype.updateViewArea=function(){this.navigation.applyNavigationSettings()},t.prototype.getModelTime=function(){return this.modelTime},t.prototype.getModelState=function(){return this.modelState},t.prototype.getModelTimeScale=function(){return this.modelTimeScale},t.prototype.getModelProgress=function(){return this.modelProgress},t.prototype.setNavigationSettings=function(t,e){var r=this;!this.windowAdjusted&&this.onResize&&(this.onResize(t,e+50,function(){r.navigation.applyNavigationSettings(),r.controlPanel.adjustControlPanelItemsVisibility()}),this.windowAdjusted=!0)},t.DEBUG_MODE=!1,t.DEBUG_SPARK_LOCAL=!1,t}(),vf=function(){function t(){}return t.createClient=function(){return new bf},t.createDebugger=function(){return new qt(new bf)},t}(),yf=function(){function t(t,e,r){var i=this;this.networkManager=t,this.startTime=Date.now(),this.xhttp=this.networkManager.getAnimationPacket(e,function(){i.stopTime=Date.now(),r(i)})}return t.prototype.requestTime=function(){return this.stopTime?this.stopTime-this.startTime:Date.now()-this.startTime},t.prototype.abort=function(){this.xhttp.abort()},t}(),Af=function(){function t(t){this.paused=!1,this.networkManager=t}return t.prototype.start=function(){this.fullFrame=!0,this.activeRequests=[],this.responseTimeStatistics=new Array(t.REQUEST_STATISTICS_SIZE),this.responseTimeStatistics.fill(Cf.MIN_REQUEST_INTERVAL),this.requestInterval=Cf.MIN_REQUEST_INTERVAL,this.lastRequestTime=0,this.createRequest(),this.startRequestTimeout()},t.prototype.stop=function(){this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.pause=function(){this.paused=!0,this.requestTimeoutId&&clearTimeout(this.requestTimeoutId)},t.prototype.requestFullFrame=function(){console.debug(">> SVG: Request full frame."),this.fullFrame=!0},t.prototype.startRequestTimeout=function(){var t=this;this.requestTimeoutId=setTimeout(function(){t.processRequestTimeout()},this.requestInterval)},t.prototype.processRequestTimeout=function(){this.requestTimeoutId=void 0,this.activeRequests.length<Cf.MAX_REQUEST_COUNT&&(this.createRequest(),this.startRequestTimeout())},t.prototype.createRequest=function(){var t=this,e=new yf(this.networkManager,this.fullFrame,function(e){return t.processResponse(e)});this.fullFrame=!1,this.activeRequests.push(e),this.lastRequestTime=Date.now()},t.prototype.processResponse=function(t){var e=this.activeRequests.indexOf(t);if(this.activeRequests.splice(e,1),this.addToResponseTimeStatistics(t.requestTime()),void 0!==this.requestTimeoutId||this.paused||(this.createRequest(),this.startRequestTimeout()),4==t.xhttp.readyState&&200==t.xhttp.status){var r=JSON.parse(t.xhttp.responseText);this.networkManager.packetManager.addPacket(r)}},t.prototype.addToResponseTimeStatistics=function(t){this.responseTimeStatistics.push(t),this.responseTimeStatistics.shift(),this.requestInterval=this.calculateRequestInterval(),this.networkManager.RPS=1e3/this.requestInterval},t.prototype.calculateRequestInterval=function(){if(0===this.responseTimeStatistics.length)return Cf.MIN_REQUEST_INTERVAL;for(var t=0,e=0;e<this.responseTimeStatistics.length;e++)t+=this.responseTimeStatistics[e];var r=t/this.responseTimeStatistics.length*.5;return r<Cf.MIN_REQUEST_INTERVAL?Cf.MIN_REQUEST_INTERVAL:r>Cf.MAX_REQUEST_INTERVAL?Cf.MAX_REQUEST_INTERVAL:r},t.REQUEST_STATISTICS_SIZE=10,t}(),Tf=function(){function t(t){this.client=t,this.reset()}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.waitingFullFrame=!1,this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.pause=function(){this.cancelWaitExpectedFrameTimeoutIfNeeded()},t.prototype.addPacket=function(t){if(t){var e=t.frames;if(e&&0!==e.length){var r=e[0];if(!(r.number<this.expectedFrameNumber)){if(r.number===this.expectedFrameNumber||t.fullFrame){this.client.network.serverQueue=t.serverQueue;var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),this.cancelWaitExpectedFrameTimeoutIfNeeded(),void(t.fullFrame&&(this.waitingFullFrame=!1))}this.insertToPacketBuffer(t),console.debug(">> SVG: Reordering  or packet loss expectedFrame=",this.expectedFrameNumber),this.startWaitExpectedFrameTimeoutIfNeeded()}}}},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length&&!(this.packetBuffer[0].frames[0].number>=this.expectedFrameNumber)){var t=this.packetBuffer[this.packetBuffer.length-1];if(t.frames[t.frames.length-1].number>=this.expectedFrameNumber)this.packetBuffer=[];else{for(var e=0;e<this.packetBuffer.length&&!(this.packetBuffer[e].frames[0].number>=this.expectedFrameNumber);e++);this.packetBuffer.splice(0,e)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length&&this.packetBuffer[0].frames[0].number===this.expectedFrameNumber){for(var t=this.expectedFrameNumber,e=0;e<this.packetBuffer.length;e++){var r=this.packetBuffer[e].frames;if(r[0].number!==t)break;t=r[r.length-1].number+1}var i=this.packetBuffer.splice(0,e);this.client.frameDrawing.addAllPackets(i),this.expectedFrameNumber=t}},t.prototype.cancelWaitExpectedFrameTimeoutIfNeeded=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startWaitExpectedFrameTimeoutIfNeeded=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,t.client.network.requestFullFrame()},4*this.client.network.RPS*1e3))},t.prototype.waitFullFrame=function(){console.debug(">> SVG: Wait full frame."),this.waitingFullFrame=!0,this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t}(),Cf=function(){function t(t){this.client=t,this.packetRequester=new Af(this),this.packetManager=new Tf(t)}return t.prototype.start=function(){this.packetManager.reset(),this.packetRequester.start()},t.prototype.stop=function(){this.packetRequester.stop(),this.packetManager.reset()},t.prototype.pause=function(){this.paused=!0,this.packetRequester.pause()},t.prototype.getAnimationPacket=function(t,e){if(!this.paused){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},Qf.DEBUG_SPARK_LOCAL?r.open("GET","/http/update?fullFrame="+t+"&time="+Date.now(),!0):r.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+Date.now(),!0),r.send(),r}},t.prototype.postUserAction=function(t,e){if(!this.paused){var r=new XMLHttpRequest;Qf.DEBUG_SPARK_LOCAL?r.open("GET","/http/useraction?id="+t+"&value="+encodeURIComponent(e)):r.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),r.send()}},t.prototype.postUserCommand=function(t,e){if(!this.paused){var r=new XMLHttpRequest;r.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),r.send()}},t.prototype.getJarResourceURL=function(t){return this.getResourceURLWithSubpath("internal-resources",t)},t.prototype.getResourceURL=function(t){return this.getResourceURLWithSubpath("resources",t)},t.prototype.getResourceURLWithSubpath=function(t,e){if(!this.paused)return Qf.DEBUG_SPARK_LOCAL?"/http/image?path="+e:this.getRestRoot()+t+"?path="+e},t.prototype.getResource=function(t,e){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&e(r)},Qf.DEBUG_SPARK_LOCAL?r.open("GET","/http/resource?path="+t,!0):r.open("GET",this.getRestRoot()+"resources?path="+t,!0),r.send(),r},t.prototype.getRestRoot=function(){return this.client.svgAnimationInfo.host+"/nodes/"+this.client.svgAnimationInfo.restUrl+"sessions/"+this.client.svgAnimationInfo.sessionUuid+"/"},t.prototype.postMaxFPS=function(t){if(!this.paused){var e=new XMLHttpRequest;Qf.DEBUG_SPARK_LOCAL?e.open("POST","http/max-fps"):e.open("POST",this.getRestRoot()+"max-fps"),e.send(t.toString())}},t.prototype.requestFullFrame=function(){this.packetRequester.requestFullFrame()},t.prototype.requestAndWaitFullFrame=function(){this.packetRequester.requestFullFrame(),this.packetManager.waitFullFrame()},t.MIN_REQUEST_INTERVAL=500,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_REQUEST_COUNT=2,t}(),Sf=function(){function t(t){this.frameDrawing=t}return t.createShapeArc=function(){return p.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:qf.filterAndSetAttribute(t,e[a],r[a])}},t.createShapeText=function(){return p.createSvgElement("text")},t.updateShapeText=function(e,r,i){for(var n=0;n<r.length;n++)switch(r[n]){case"text-content":null==i[n]&&(i[n]="");var a=i[n].split("\n"),o=f.getFloatAttribute(e,"first-line-offset"),s=f.getFloatAttribute(e,"line-height");t.drawMultiLineText(e,a,s,o);break;case"font":e.style.font=i[n];break;default:qf.filterAndSetAttribute(e,r[n],i[n])}},t.drawMultiLineText=function(t,e,r,i){var n=t.childElementCount;if(1==e.length&&1==n)t.firstElementChild.firstChild.textContent=e[0];else{for(var a=t.getAttribute("x"),o=null==a?0:parseFloat(a),s=t.getAttribute("y"),l=(null==s?0:parseFloat(s))+i,u=0;u<e.length;u++){var c=p.childElements(t),h=e[u];if(h.endsWith("\r")&&(h=h.substring(0,h.length-1)),c[u])c[u].firstChild.textContent=h;else{var d=p.createSvgElement("tspan");d.setAttribute("x",o.toString()),d.setAttribute("y",(l+u*r).toString());var f=p.createTextNode(h);d.appendChild(f),t.appendChild(d)}}for(;t.childElementCount>e.length;)p.removeElement(t.lastChild)}},t.createShapeImage=function(){return p.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":p.removeAllChildren(t);break;case"add":var n=p.cloneElementWithId("image-item");n.setAttributeNS(p.xlinkns,"href",this.frameDrawing.client.network.getJarResourceURL(r[i])),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var a=parseInt(r[i]),o=t.childNodes,s=0;s<o.length;s++)(n=o[s]).setAttribute("visibility",s==a?"inherit":"hidden");break;case"width":case"height":o=t.childNodes;for(s=0;s<o.length;s++)(n=o[s]).setAttribute(e[i],r[i]);default:qf.filterAndSetAttribute(t,e[i],r[i])}},t.createShapeCanvas=function(t){var e=p.createSvgElement("image");return p.createCanvas(t,"canvas-group"),e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),a=n.getContext("2d"),o=0;o<e.length;o++)switch(e[o]){case"global-composite-operation":a.globalCompositeOperation=r[o];break;case"width":case"height":i.setAttribute(e[o],r[o]),n.setAttribute(e[o],r[o]);break;case"fill-rect":case"clear-rect":var s=r[o].split(" "),l=parseFloat(s[0]),u=parseFloat(s[1]),c=parseFloat(s[2]),h=parseFloat(s[3]);if("clear-rect"==e[o])a.clearRect(l,u,c,h);else{var d=s[4];a.fillStyle=d,a.fillRect(l,u,c,h)}break;case"fill-circle":s=r[o].split(" ");var f=parseFloat(s[0]),m=parseFloat(s[1]),g=parseFloat(s[2]),b=s[3];a.fillStyle=b,a.beginPath(),a.arc(f,m,g,0,2*Math.PI),a.fill();break;case"clear":a.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(p.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;default:qf.filterAndSetAttribute(t,e[o],r[o])}},t.createShapeCAD=function(){return p.cloneElementWithId("shape-cad")},t.prototype.updateShapeCAD=function(t,e,r){for(var i=p.findChildOfType(t,"back"),n=p.findChildOfType(t,"image"),a=0;a<e.length;a++)switch(e[a]){case"width":case"height":i.setAttribute(e[a],r[a]),this.fitCAD(t);break;case"background-color":i.setAttribute("fill",r[a]);break;case"svg":n.setAttributeNS(p.xlinkns,"href",'data:image/svg+xml;utf8,<svg xmlns="'+p.svgns+'" width = "0" height = "\'0"><g transform = "translate(0 0) scale(1)" stroke-width = "0.6">'+r[a]+"</g></svg>");break;case"svg-dimensions":t.setAttribute(e[a],r[a]),this.fitCAD(t);break;case"layer-settings":var o=n.getAttribute("href"),s=o.indexOf("<svg"),l=o.substring(0,s),u=o.substring(s),c=document.createElementNS(p.svgns,"g");c.innerHTML=u;for(var h=c.firstElementChild.firstElementChild,d=0,m=f.splitSkipEmpty(r[a],"|");d<m.length;d++){var g=m[d].split(":"),b=p.findChildWithId(h,g[0]);null!=b&&(b.setAttribute("visibility",g[1]),"none"!=g[2]&&(b.setAttribute("stroke",g[2]),"none"!=b.getAttribute("fill")&&b.setAttribute("fill",g[2])))}u=c.innerHTML,n.setAttributeNS(p.xlinkns,"href",l+u);break;default:qf.filterAndSetAttribute(t,e[a],r[a])}},t.prototype.fitCAD=function(e){var r=p.findChildOfType(e,"back"),i=p.findChildOfType(e,"image"),n=e.getAttribute("svg-dimensions"),a=f.getFloatAttribute(r,"width"),o=f.getFloatAttribute(r,"height");if(null!=a&&null!=o&&null!=n){var s=f.splitToFloats(n," "),l=Math.min(a/s[2],o/s[3]),u="translate("+-s[0]*l+" "+-s[1]*l+") scale("+l+")",c=t.DEFAULT_CAD_STROKE_WIDTH/l/this.frameDrawing.client.navigation.zoom,h=i.getAttribute("href");h=(h=h.replace(/width\s*=\s*"[^"]*"\s*height\s*=\s*"[^"]*"/,'width = "'+a+'" height = "'+o+'"')).replace(/transform\s*=\s*"[^"]*"\s*stroke-width\s*=\s*"[^"]*"/,'transform = "'+u+'" stroke-width = "'+c+'"'),i.setAttributeNS(p.xlinkns,"href",h),f.setMultipleAttributes(i,["width","height"],[a,o])}},t.onCADZoomChange=function(t,e,r){var i=p.findChildOfType(t,"image"),n=i.getAttribute("href");n=n.replace(/stroke-width\s*=\s*"([^"]*)"/,function(t,i){return'stroke-width = "'+parseFloat(i)*e/r+'"'}),i.setAttributeNS(p.xlinkns,"href",n)},t.createShapeSVG=function(){return p.createSvgElement("g")},t.updateShapeSVG=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"svg":t.innerHTML="null"==r[i]?"":r[i];break;default:qf.filterAndSetAttribute(t,e[i],r[i])}},t.createUnsupportedObject=function(t){var e=p.cloneElementWithId("unsupported-object");return p.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=p.findChildOfType(t,"background"),n=p.findChildOfType(t,"text"),a=0;a<e.length;a++)switch(e[a]){case"width":var o=parseFloat(r[a]);i.setAttribute("width",o.toString());var s=n.getBBox();o<s.width&&(n.firstChild.textContent="Not supported",s=n.getBBox()),o<s.width&&(n.firstChild.textContent="N/A",s=n.getBBox()),o<s.width&&(n.firstChild.textContent=""),n.setAttribute("x",(o/2).toString());break;case"height":var l=parseFloat(r[a]);i.setAttribute("height",l.toString()),n.setAttribute("y",(l/2+3).toString());break;default:qf.filterAndSetAttribute(t,e[a],r[a])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeCAD","ShapeSVG","ShapeGISMap"],t.DEFAULT_CAD_STROKE_WIDTH=.6,t}(),Ef=function(){function t(){}return t.createStockIcon=function(t){var e=p.cloneElementWithId("STOCK"),r=p.findChildOfType(e,"back"),i=parseFloat(f.getSubAttribute(t,"width")),n=parseFloat(f.getSubAttribute(t,"height"));f.setMultipleAttributes(r,["x","y","width","height"],[-i/2,-n/2,i,n]);var a=p.findChildOfType(e,"bars").firstElementChild;f.setMultipleAttributes(a,["x","width"],[-i/2+1,i-2]);var o=f.getSubAttribute(t,"color");return null!=o&&(r.setAttribute("stroke",o),a.setAttribute("fill",o)),e},t.createFlowIcon=function(e){for(var r=p.cloneElementWithId("FLOW"),i=p.findChildOfType(r,"basepath"),n=p.findChildOfType(r,"innerpath"),a=p.findChildOfType(r,"animation"),o=p.findChildOfType(r,"arrow"),s=p.findChildOfType(r,"valve"),l=f.getSubAttribute(e,"color"),u=f.getSubAttribute(e,"points"),c=f.splitSkipEmpty(u,";"),h="",d=0;d<c.length;d++){var m=f.splitToFloats(c[d],",");if(h+=0==d?"M ":"L ",h+=m[0]+" "+m[1]+" ",0==d&&"null"==f.getSubAttribute(e,"source")){var g=f.splitToFloats(c[1],","),b=Math.atan2(m[1]-g[1],m[0]-g[0]);t.addFlowCloud(r,!0,m[0],m[1],b,l)}if(d==c.length-1){var v=f.splitToFloats(c[d-1],","),y=(b=Math.atan2(m[1]-v[1],m[0]-v[0]),f.radiansToDegrees(b)),A="translate("+m[0]+","+m[1]+") rotate("+y+")";o.setAttribute("transform",A),"null"==f.getSubAttribute(e,"target")&&t.addFlowCloud(r,!1,m[0],m[1],b,l)}}var T=f.roundPathCorners(h,5,!1);i.setAttribute("d",T),n.setAttribute("d",T),a.setAttribute("d",T);var C=f.getSubAttribute(e,"valve-pos"),S=f.splitToFloats(C,","),E="translate("+S[0]+","+S[1]+") rotate("+f.radiansToDegrees(S[2])+")";return s.setAttribute("transform",E),"true"==f.getSubAttribute(e,"external")&&s.setAttribute("stroke-dasharray","1,1"),null!=l&&(i.setAttribute("stroke",l),o.setAttribute("stroke",l),o.setAttribute("fill",f.changeBrightness(l,2)),s.setAttribute("stroke",l),s.setAttribute("fill",f.changeBrightness(l,2))),r},t.addFlowCloud=function(t,e,r,i,n,a){var o=e?15:35,s=r+o*Math.cos(n),l=i+o*Math.sin(n),u=p.createUseElement("flow-cloud-fill"),c=p.createUseElement("flow-cloud-line");f.setMultipleAttributes(u,["x","y"],[s,l]),f.setMultipleAttributes(c,["x","y"],[s,l]),c.setAttribute("stroke",null==a?"CornflowerBlue":a),t.appendChild(u),t.appendChild(c)},t.createDynamicVariableIcon=function(t){var e,r=(e="true"==f.getSubAttribute(t,"external")?p.cloneElementWithId("DYNAMIC_VARIABLE_EXTERNAL"):"true"==f.getSubAttribute(t,"constant")?p.cloneElementWithId("DYNAMIC_VARIABLE_CONSTANT"):p.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,i=f.getSubAttribute(t,"color");return null!=i&&r.setAttribute("fill",i),e},t.createShadowIconAndInfo=function(t,e,r){var i=f.getSubAttribute(r,"original"),n=kf.getModelPrimitiveByName(t,i);if(null==n)return console.log("Shadow variable could not find its original, name: "+i),p.createUseElement("DEFAULT_MODEL_ELEMENT");var a,o=p.findChildOfType(n,"icon");if("FLOW"==n.getAttribute("type")){var s=(a=p.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,l=p.findChildOfType(o,"valve");s.setAttribute("fill",l.getAttribute("stroke"))}else o.id=n.id+"icon",a=p.createUseElement(o.id);var u=p.findChildOfType(n,"info");u.id=n.id+"info";var c=p.createUseElement(u.id);c.setAttribute("type","info");var h=p.findChildOfType(e,"info"),d=f.getFloatAttribute(h,"x"),m=f.getFloatAttribute(h,"y");p.removeElement(h);var g=f.getFloatAttribute(u,"x"),b=f.getFloatAttribute(u,"y");return f.setMultipleAttributes(c,["x","y"],[-g+d,-b+m]),e.appendChild(c),a},t.createLinkIcon=function(t){var e=p.cloneElementWithId("LINK"),r=p.findChildOfType(e,"path"),i=f.splitToFloats(f.getSubAttribute(t,"start-point"),","),n=f.splitToFloats(f.getSubAttribute(t,"end-point"),","),a=f.getFloatSubAttribute(t,"r");if(null==a)r.setAttribute("d","M "+i[0]+" "+i[1]+" L "+n[0]+" "+n[1]);else{var o=f.getSubAttribute(t,"large"),s=f.getSubAttribute(t,"sweep");r.setAttribute("d","M "+i[0]+" "+i[1]+" A "+a+" "+a+" 0 "+o+" "+s+" "+n[0]+" "+n[1])}var l=r.getTotalLength(),u=p.findChildOfType(e,"arrow"),c=f.pathAngleAt(r,l),h=f.radiansToDegrees(c);u.setAttribute("transform","translate("+n[0]+" "+n[1]+") rotate("+h+")");var d=f.getSubAttribute(t,"color");null!=d&&(r.setAttribute("stroke",d),u.setAttribute("fill",d));var m=f.getSubAttribute(t,"stroke-width");if(null!=m){r.setAttribute("stroke-width",m);var g=1+((E=parseInt(m))-1)/4;u.setAttribute("transform",u.getAttribute("transform")+" scale("+g+")")}var b=f.getSubAttribute(t,"polarity");if(null!=b){var v=p.createSvgElement("text");v.appendChild(p.createTextNode(b));var y=n[0]+8*Math.cos(c-Math.PI/2),A=n[1]+8*Math.sin(c-Math.PI/2)+4;f.setMultipleAttributes(v,["x","y"],[y,A]),f.setMultipleAttributes(v,["fill","text-anchor"],[r.getAttribute("stroke"),"middle"]),e.appendChild(v)}if("true"==f.getSubAttribute(t,"delay")){var T=p.createUseElement("link-delay");T.setAttribute("stroke",null==d?"CornflowerBlue":d);var C=r.getPointAtLength(l/2),S=f.radiansToDegrees(f.pathAngleAt(r,l/2));T.setAttribute("transform","translate("+C.x+" "+C.y+") rotate( "+S+")"),e.appendChild(T)}if("true"==f.getSubAttribute(t,"initial-value")){var E=f.getFloatAttribute(r,"stroke-width");r.setAttribute("stroke-dasharray",4*E+","+1.5*E)}return e},t.createCausalLoopIcon=function(t){var e="true"==f.getSubAttribute(t,"clockwise"),r=p.cloneElementWithId(e?"CAUSAL_LOOP_CW":"CAUSAL_LOOP_CCW"),i=p.findChildOfType(r,"loop"),n=p.findChildOfType(r,"arrow"),a=p.findChildOfType(r,"text"),o=f.getSubAttribute(t,"text");a.firstChild.textContent=o;var s=8*o.length;if(s>18){var l=(s+6)/2;i.setAttribute("d","M0 -"+l+" A "+l+" "+l+" 0 1 "+(e?1:0)+" "+(e?-l:l)+" 0"),n.setAttribute("transform","translate("+(e?-1:1)*(l-12)+" 0)")}var u=f.getSubAttribute(t,"color");return null!=u&&(i.setAttribute("stroke",u),n.setAttribute("fill",u),a.setAttribute("fill",u)),r},t.updateStockState=function(t,e){var r=f.splitToFloats(e,","),i=r.length,n=p.findChildOfType(t,"back"),a=p.findChildOfType(t,"bars");if(a.childElementCount<i){for(var o=a.firstElementChild;a.childElementCount<i;)a.appendChild(p.cloneElement(o));var s=f.getFloatAttribute(n,"width"),l=-s/2+1,u=(s-1)/i-1;do{f.setMultipleAttributes(o,["x","width"],[l,u]),l+=u+1,o=o.nextElementSibling}while(null!=o)}for(var c=1/0,h=-1/0,d=0,m=r;d<m.length;d++){var g=m[d];g<c&&(c=g),h<g&&(h=g)}var b=Math.max(Math.abs(c),Math.abs(h)),v=Math.pow(10,Math.ceil(Math.log10(b)));c<0&&(v*=2),v<=0&&(v=1);for(var y=f.getFloatAttribute(n,"height"),A=a.firstElementChild,T=0;T<i;T++){var C=(y-2)*(r[T]/v),S=void 0;r[T]>=0?S=c>=0?y/2-1-C:-C:(C=-C,S=0),f.setMultipleAttributes(A,["y","height"],[S,C]),A=A.nextElementSibling}},t.updateFlowDirection=function(t,e){var r;r="1"==e?"model-primitive-flow-forward":"-1"==e?"model-primitive-flow-backward":"",p.findChildOfType(t,"animation").setAttribute("class",r)},t}(),wf=function(){function t(){}return t.createStateIcon=function(t){var e=p.cloneElementWithId("STATE"),r=parseFloat(f.getSubAttribute(t,"width")),i=parseFloat(f.getSubAttribute(t,"height"));f.setMultipleAttributes(e,["width","height"],[r,i]);var n=f.getSubAttribute(t,"color"),a="true"==f.getSubAttribute(t,"composite");return e.setAttribute("composite",a?"true":"false"),null!=n?(e.setAttribute("fill",n),e.setAttribute("stroke",f.changeBrightness(n,.8))):a&&(e.setAttribute("fill","none"),e.setAttribute("stroke","Gray")),e.setAttribute("stroke-width",a?"2":"1"),e},t.createFinalStateIcon=function(){return p.cloneElementWithId("FINAL_STATE")},t.createTransitionIcon=function(t){for(var e=p.cloneElementWithId("TRANSITION"),r=p.findChildOfType(e,"path"),i=f.getSubAttribute(t,"points"),n=f.splitSkipEmpty(i,";"),a="",o=0;o<n.length;o++){var s=f.splitToFloats(n[o],",");if(o==n.length-1){var l=f.splitToFloats(n[o-1],","),u=Math.atan2(s[1]-l[1],s[0]-l[0]);s[0]-=Math.round(4*Math.cos(u)),s[1]-=Math.round(4*Math.sin(u));var c=f.radiansToDegrees(u),h="translate("+s[0]+","+s[1]+") rotate("+c+")";p.findChildOfType(e,"arrow").setAttribute("transform",h)}a+=(0==o?"M ":"L ")+s[0]+" "+s[1]+" "}var d=f.roundPathCorners(a,10,!1);r.setAttribute("d",d);var m=f.getSubAttribute(t,"trigger");if(null!=m){var g=p.createUseElement("transition-icon-"+m);g.setAttribute("type","trigger"),g.setAttribute("stroke","Black"),p.findChildOfType(e,"path").setAttribute("d",d);var b=f.getFloatSubAttribute(t,"icon-offset"),v=r.getPointAtLength(b);g.setAttribute("transform","translate("+v.x+","+v.y+")"),e.appendChild(g)}return e},t.createStatePointerIcon=function(t,e){var r=p.cloneElementWithId("STATE_POINTER"),i=p.findChildOfType(r,"line"),n=p.findChildOfType(r,"entry-dash"),a=f.getSubAttribute(t,"dxdy"),o=f.splitToFloats(a,","),s=Math.atan2(o[1],o[0]);o[0]-=Math.round(4*Math.cos(s)),o[1]-=Math.round(4*Math.sin(s)),f.setMultipleAttributes(i,["x2","y2"],[o[0],o[1]]);var l=f.radiansToDegrees(s),u="translate("+o[0]+","+o[1]+") rotate("+l+")";return p.findChildOfType(r,"arrow").setAttribute("transform",u),e?n.setAttribute("transform","rotate("+l+")"):p.removeElement(n),r},t.updateStateState=function(t,e,r){var i="true"==r;if("STATE"==e)if(i)f.setMultipleAttributes(t,["stroke","stroke-width"],["Red",2]);else{var n="true"==t.getAttribute("composite")?2:1,a=t.getAttribute("fill"),o="none"==a?"Gray":f.changeBrightness(a,.8);f.setMultipleAttributes(t,["stroke","stroke-width"],[o,n])}else{var s=p.findChildOfType(t,"outer");n=i?2:1,o=i?"Red":"Black";f.setMultipleAttributes(s,["stroke","stroke-width"],[o,n])}},t.updateTransitionState=function(t,e){var r=p.findChildOfType(t,"path"),i=p.findChildOfType(t,"arrow"),n=p.findChildOfType(t,"trigger"),a="Black";switch(e){case"SCHEDULED":a="Blue";break;case"CURRENT":a="Red"}r.setAttribute("stroke",a),i.setAttribute("fill",a),null!=n&&n.setAttribute("stroke",a)},t}(),kf=function(){function t(t){this.frameDrawing=t}return t.create=function(){return p.cloneElementWithId("shape-model-primitives")},t.prototype.update=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"static-info":for(var o=f.splitSkipEmpty(i[a],"\n"),s=function(r){var i=f.splitSkipEmpty(o[r],"|"),a=f.getSubAttribute(i,"index"),s=f.getSubAttribute(i,"type"),l=f.getSubAttribute(i,"name"),u=f.getSubAttribute(i,"x"),c=f.getSubAttribute(i,"y"),h=p.cloneElementWithId("model-primitive");h.id=e.id+"-"+a,h.setAttribute("type",s),h.setAttribute("transform","translate("+u+","+c+")");var d=p.findChildOfType(h,"label"),g=p.findChildOfType(h,"info");if(d.appendChild(p.createTextNode(l)),"false"==f.getSubAttribute(i,"show-label"))d.setAttribute("visibility","hidden"),g.setAttribute("visibility","hidden");else{var b=parseFloat(f.getSubAttribute(i,"label-dx")),v=parseFloat(f.getSubAttribute(i,"label-dy"));if("FLOW"==s){var y=f.getSubAttribute(i,"valve-pos"),A=f.splitToFloats(y,",");b+=A[0],v+=A[1]}f.setMultipleAttributes(d,["x","y"],[b,v+4]),f.setMultipleAttributes(g,["x","y"],[b,v+4+9]),g.appendChild(p.createTextNode(""))}var T=void 0;switch(s){case"LINK_TO_AGENTS":T=t.createLinkToAgents(i);break;case"CONNECTOR":T=t.createConnectorIcon(i);break;case"STOCK":T=Ef.createStockIcon(i);break;case"FLOW":T=Ef.createFlowIcon(i);break;case"DYNAMIC_VARIABLE":T=Ef.createDynamicVariableIcon(i);break;case"SHADOW":T=Ef.createShadowIconAndInfo(e,h,i);break;case"LINK":T=Ef.createLinkIcon(i);break;case"CAUSAL_LOOP":T=Ef.createCausalLoopIcon(i);break;case"STATE":T=wf.createStateIcon(i);break;case"FINAL_STATE":T=wf.createFinalStateIcon();break;case"TRANSITION":T=wf.createTransitionIcon(i);break;case"STATECHART_ENTRY_POINT":T=wf.createStatePointerIcon(i,!0);break;case"INITIAL_STATE_POINTER":T=wf.createStatePointerIcon(i,!1);break;default:var C=null==document.getElementById(s)?"DEFAULT_MODEL_ELEMENT":s;T=p.createUseElement(C)}T.setAttribute("type","icon"),h.insertBefore(T,d),t.responsiveElements.indexOf(s)>=0&&new m(h,function(t){return n.onModelPrimitiveMouseEvent(h,"mouseover")},function(t){return n.onModelPrimitiveMouseEvent(h,"mouseout")},null,function(t){return n.onModelPrimitiveMouseEvent(h,"click")},null),e.appendChild(h)},l=0;l<o.length;l++)s(l);break;case"update":var u=parseInt(i[a]),c=i[a].slice(i[a].indexOf(" ")+1),h=f.splitSkipEmpty(c,"|"),d=p.findChildWithId(e,e.id+"-"+u),g=p.findChildOfType(d,"icon"),b=d.getAttribute("type");for(l=0;l<h.length;l++){var v=h[l].split(":");switch(v[0]){case"label":case"info":p.findChildOfType(d,v[0]).firstChild.textContent=v[1];break;case"info-flag":var y=p.findChildOfType(d,"info"),A="model-primitive-info";"warning"==v[1]&&(A="model-primitive-info-warning"),y.setAttribute("class",A);break;case"null":var T=b+("true"==v[1]?"_NULL":"");p.changeUseHref(g,T);break;case"link-empty":f.setMultipleAttributes(g,["stroke","fill"],"true"==v[1]?["DarkGray","Gainsboro"]:["SteelBlue","LightBlue"]);break;case"standard-icon":g.setAttribute("visibility","true"==v[1]?"inherit":"hidden");break;case"event-state":p.changeUseHref(g,"EVENT_"+v[1]);break;case"port-state":p.changeUseHref(g,"PORT_"+v[1]);break;case"empty":T=b+("true"==v[1]?"_EMPTY":""),p.changeUseHref(g,T);break;case"stock-state":Ef.updateStockState(g,v[1]);break;case"flow-sign":Ef.updateFlowDirection(g,v[1]);break;case"state-active":wf.updateStateState(g,b,v[1]);break;case"transition-state":wf.updateTransitionState(g,v[1])}}break;default:qf.filterAndSetAttribute(e,r[a],i[a])}},t.createConnectorIcon=function(t){for(var e=p.cloneElementWithId("CONNECTOR"),r=f.getSubAttribute(t,"points"),i=f.splitSkipEmpty(r,";"),n="",a=0;a<i.length;a++){var o=i[a].split(",");if(0==a){n+="M ";var s=p.findChildOfType(e,"start-circle");f.setMultipleAttributes(s,["cx","cy"],o)}else n+="L ";if(n+=o[0]+" "+o[1]+" ",a==i.length-1){var l=p.findChildOfType(e,"end-circle");if(f.setMultipleAttributes(l,["cx","cy"],o),"true"==f.getSubAttribute(t,"sd")){var u=p.createUseElement("connector-arrow"),c=f.splitToFloats(i[a-1],","),h=Math.atan2(parseFloat(o[1])-c[1],parseFloat(o[0])-c[0]),d=f.radiansToDegrees(h),m="translate("+o[0]+","+o[1]+") rotate("+d+")";u.setAttribute("transform",m),e.appendChild(u)}}}var g=f.roundPathCorners(n,5,!1);return p.findChildOfType(e,"path").setAttribute("d",g),e},t.createLinkToAgents=function(t){var e=p.createSvgElement("g"),r=f.getSubAttribute(t,"multi"),i=f.getSubAttribute(t,"uni");return"true"==r&&e.appendChild(p.createUseElement("link-to-agents-multi")),e.appendChild(p.createUseElement("link-to-agents-basic")),"true"==i&&e.appendChild(p.createUseElement("link-to-agents-uni")),e},t.prototype.onModelPrimitiveMouseEvent=function(t,e){var r=p.findChildOfType(t,"icon"),i=p.findChildOfType(t,"label");switch(e){case"mouseover":r.setAttribute("class","clickable-over"),i.setAttribute("font-weight","600");break;case"mouseout":r.removeAttribute("class"),i.setAttribute("font-weight","400");break;case"click":this.frameDrawing.onModelPrimitiveClick(t.id)}},t.getModelPrimitiveByName=function(t,e){for(var r=0,i=p.childElements(t);r<i.length;r++){var n=i[r],a=p.findChildOfType(n,"label");if(null!=a&&a.innerHTML==e)return n}return null},t.responsiveElements=["PARAMETER_STATIC","VARIABLE","CONSTANT","COLLECTION","TABLE_FUNCTION","CUSTOM_DISTRIBUTION","EVENT","SCHEDULE","STATISTICS","DATASET","HISTOGRAM_DATA","HISTOGRAM_2D_DATA","OUTPUT","EXCEL_FILE","TEXT_FILE","DATABASE","LINK_TO_AGENTS","LINK_TO_CONTAINER","STOCK","FLOW","DYNAMIC_VARIABLE","SHADOW","TRAFFIC_LIGHT","EMBEDDED_AGENT_ICON","EMBEDDED_POPULATION_ICON"],t}(),xf=function(){function t(t,e,r,i,n){var a=this;this.dxrejected=0,this.dyrejected=0,this.ondrag=r,this.onup=i,this.cursor=n||"move",this.prevPtrCoords=[Math.round(t),Math.round(e)],this.onDocumentEventClosure=function(t){return a.onDocumentEvent(t)};var o=document.documentElement;o.addEventListener("mousemove",this.onDocumentEventClosure),o.addEventListener("mouseup",this.onDocumentEventClosure),o.addEventListener("touchmove",this.onDocumentEventClosure),o.addEventListener("touchend",this.onDocumentEventClosure)}return t.prototype.onDocumentEvent=function(t){var e,r;if("mousemove"==t.type||"touchmove"==t.type){if("mousemove"==t.type){var i=t;e=Math.round(i.pageX),r=Math.round(i.pageY)}else{var n=t;if(1!=n.touches.length)return void this.stop();e=Math.round(n.touches[0].pageX),r=Math.round(n.touches[0].pageY)}t.stopPropagation(),t.preventDefault();var a=e-this.prevPtrCoords[0],o=r-this.prevPtrCoords[1];if(this.prevPtrCoords=[e,r],null!=this.ondrag){document.documentElement.style.cursor=this.cursor;var s=Math.sign(this.dxrejected),l=Math.sign(this.dyrejected);if(this.dxrejected+=a,this.dyrejected+=o,Math.sign(this.dxrejected)!=s?(a=this.dxrejected,this.dxrejected=0):a=0,Math.sign(this.dyrejected)!=l?(o=this.dyrejected,this.dyrejected=0):o=0,0!=a||0!=o){var u=this.ondrag(t,a,o);u&&(this.dxrejected+=a-Math.round(u[0]),this.dyrejected+=o-Math.round(u[1]))}}}else t.preventDefault(),this.stop(),null!=this.onup&&this.onup(t)},t.prototype.stop=function(){var t=document.documentElement;t.removeEventListener("mousemove",this.onDocumentEventClosure),t.removeEventListener("mouseup",this.onDocumentEventClosure),t.removeEventListener("touchmove",this.onDocumentEventClosure),t.removeEventListener("touchend",this.onDocumentEventClosure),t.style.cursor="auto"},t}(),Mf=function(){function t(){}return t.create=function(t,e,r,i,n,a,o){var s=p.cloneElementWithId("svg-button"),l=s.firstElementChild,u=s.lastElementChild;return u.setAttributeNS(p.xlinkns,"href","#"+t),l.setAttribute("fill",e),u.setAttribute("stroke",r),u.setAttribute("fill",r),new m(s,function(t){l.setAttribute("fill",i),u.setAttribute("stroke",n),u.setAttribute("fill",n)},function(t){l.setAttribute("fill",e),u.setAttribute("stroke",r),u.setAttribute("fill",r)},null,a,o),s},t}(),Of=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){for(var e=p.findChildOfType(t,"picture"),r=p.findChildOfType(t,"pictureback"),i=p.childElements(p.findChildOfType(t,"legend")),n=i.length,a="true"==t.getAttribute("show-pdf"),o="true"==t.getAttribute("show-cdf"),s="true"==t.getAttribute("show-mean"),l=f.getFloatAttribute(r,"height"),u=0;u<n;u++){var c=p.createSvgElement("g");if(a){var h=p.createSvgElement("g");c.appendChild(h)}if(o){var d=p.createSvgElement("polyline");f.setMultipleAttributes(d,["fill","stroke-width","stroke"],["none",i[u].getAttribute("cdf-line-width"),i[u].getAttribute("cdf-color")]),c.appendChild(d)}if(s){var m=p.createSvgElement("line");f.setMultipleAttributes(m,["stroke-width","stroke","y1","y2"],[i[u].getAttribute("cdf-line-width"),i[u].getAttribute("mean-color"),"0",l.toString()]),c.appendChild(m)}e.appendChild(c),Rf.addClickTapHandlerToChartItem(c)}},t.prototype.draw=function(t,e){for(var r=p.findChildOfType(t,"pictureback"),i=p.findChildOfType(t,"picture"),n=p.findChildOfType(t,"grid"),a=p.findChildOfType(t,"legend"),o=p.childElements(a),s="true"==t.getAttribute("show-pdf"),l="true"==t.getAttribute("show-cdf"),u="true"==t.getAttribute("show-mean"),c=f.getFloatAttribute(t,"bar-width"),h=f.getFloatAttribute(r,"width"),d=f.getFloatAttribute(r,"height"),m=f.splitSkipEmpty(e," "),g=m.length,b=1/0,v=-1/0,y=1/0,A=-1/0,T=[],C=[],S=[],E=[],w=[],k=[],x=[],M=[],O=[],I=0;I<g;I++)if(o[I].setAttribute("data",m[I]),"empty"!=m[I]){var _=f.splitSkipEmpty(m[I],":");T[I]="true"==_[0],C[I]="true"==_[1],S[I]=parseFloat(_[2]),E[I]=parseFloat(_[3]),w[I]=parseFloat(_[4]),k[I]=parseInt(_[5]),x[I]=parseInt(_[6]),M[I]=f.splitToFloats(_[7],"|");for(var L=0;L<M[I].length;L++)M[I][L]<y&&(y=M[I][L]),A<M[I][L]&&(A=M[I][L]);T[I]&&(O[I]=f.splitToFloats(_[8],"|")),S[I]<b&&(b=S[I]),v<E[I]&&(v=E[I])}b==1/0&&(b=0,v=0),y==1/0&&(y=0,A=1),this.chartScaleAndGrid.recalcChartScale(t,b,v,!1,!1),this.chartScaleAndGrid.recalcChartScale(t,0,A,!0,!1);var P=f.getFloatAttribute(n,"min-x"),R=f.getFloatAttribute(n,"max-x"),F=f.getFloatAttribute(n,"min-y"),D=f.getFloatAttribute(n,"max-y"),N=h/(R-P),B=d/(D-F),G=p.childElements(i);for(I=0;I<g;I++)if("empty"!=m[I]){"hidden"==G[I].getAttribute("visibility")&&G[I].setAttribute("visibility","inherit");var U=M[I].length,H=(E[I]-S[I])/U,z=o[I].getAttribute("original-color"),W=void 0,V=void 0;if(C[I]&&(W=o[I].getAttribute("low-color"),V=o[I].getAttribute("high-color")),s){var Y=G[I].firstElementChild,j=c*H*N,X=H*(1-c)/2;for(L=0;L<U;L++){var q=(S[I]+L*H+X-P)*N,Z=(D-M[I][L])*B,K=M[I][L]*B,Q=p.childElements(Y)[L];Q?Q.setAttribute("visibility","inherit"):(Q=p.createSvgElement("rect"),Y.appendChild(Q)),f.setMultipleAttributes(Q,["x","y","width","height"],[f.reducePrecision(q),f.reducePrecision(Z),f.reducePrecision(j),f.reducePrecision(K)]),T[I]&&C[I]&&L<k[I]?Q.setAttribute("fill",W):T[I]&&C[I]&&x[I]<L?Q.setAttribute("fill",V):Q.setAttribute("fill",z)}var J=p.childElements(Y);for(L=U;L<J.length;L++)J[L].setAttribute("visibility","hidden")}if(l){var $=s?G[I].firstElementChild.nextElementSibling:G[I].firstElementChild,tt="";if(tt+=(S[I]-P)*N+" "+d+" ",T[I])for(L=0;L<U;L++){tt+=f.reducePrecision((S[I]+(L+1)*H-P)*N)+","+f.reducePrecision((1-O[I][L])*d)+" "}$.setAttribute("points",tt)}if(u){var et=G[I].lastElementChild,rt=(w[I]-P)*N;et.setAttribute("x1",rt),et.setAttribute("x2",rt)}if("NONE"!=t.getAttribute("leg-pos")){var it=p.findChildOfType(o[I],"value");it.firstChild.textContent=f.formatNumber(w[I],2),it.setAttribute("fill",o[I].getAttribute("mean-color"))}}else G[I].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&Rf.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=p.findChildOfType(t,"picture"),a=p.childElements(n),o=p.childElements(a[e]),s=0;s<o.length;s++)o[s].setAttribute("visibility",r?"hidden":"inherit")},t.dataToString=function(t){for(var e=p.findChildOfType(t,"legend"),r=p.childElements(e),i=r.length,n="",a=0;a<i;a++){n+=Rf.getChratItemName(t,a)+"\n";var o=r[a].getAttribute("data");if("empty"==o)n+="no data\n";else{var s="true"==(o=f.splitSkipEmpty(o,":"))[0],l=parseFloat(o[2]),u=parseFloat(o[3]),c=f.splitToFloats(o[7],"|"),h=void 0;s&&(h=f.splitToFloats(o[8],"|")),n+="from\tto\tPDF",s&&(n+="\tCDF"),n+="\n";for(var d=c.length,m=(u-l)/d,g=l,b=0;b<d;b++)n+=g+"\t"+(g+m)+"\t"+c[b],s&&(n+="\t"+h[b]),n+="\n",g+=m}n+="\n"}return n},t}(),If=function(){function t(t){this.frameDrawing=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),a=p.findChildOfType(t,"grid"),o=p.findChildOfType(t,"pictureback"),s=p.findChildOfType(t,e?"pictureborderh":"pictureborderw"),l=a.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=l){var u=f.getFloatAttribute(o,"x"),c=f.getFloatAttribute(o,"y"),h=f.getFloatAttribute(o,"width"),d=f.getFloatAttribute(o,"height"),m="GRID_DEFAULT"==l,g="ChartBar"==r||"ChartStack"==r,b=t.getAttribute("bar-dir");e?g&&(!g||"NORTH"!=b&&"SOUTH"!=b)||f.setMultipleAttributes(s,["x1","y1","x2","y2"],m?[u,c,u,c+d]:[u+h,c,u+h,c+d]):g&&(!g||"EAST"!=b&&"WEST"!=b)||f.setMultipleAttributes(s,["x1","y1","x2","y2"],m?[u,c+d,u+h,c+d]:[u,c,u+h,c])}var v=a.getAttribute("grid-line-color");switch(a.setAttribute("grid-line-color",f.increaseTransparency(v,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var y=f.getFloatAttribute(t,"scale-min-"+i),A=f.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(y="ChartStack"==r?0:Math.min(0,y),A=Math.max(0,A)),this.recalcChartScale(t,y,A,e,!0);break;case"SCALE_TIME_WINDOW":A=Math.max(0,f.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,A,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var a=t.getAttribute("type"),o=p.findChildOfType(t,"grid"),s=i?"min-y":"min-x",l=i?"max-y":"max-x";if(e!=f.getFloatAttribute(o,s)||r!=f.getFloatAttribute(o,l)){var u=e,c=r;if(u==c){if(n)return;u-=1,c+=1,"ChartTimeStack"==a&&u<0&&(u=0)}var h=p.findChildOfType(t,"pictureback"),d=f.getFloatAttribute(h,i?"height":"width"),m=i?25:45,g=(c-u)/Math.floor(d/m),b=Math.pow(10,Math.ceil(Math.log(c-u)/Math.log(10))-1),v=b/5;v<g&&(v=b/2)<g&&(v=b)<g&&(v=2*b)<g&&(v=5*b),n?(u=Math.ceil(u/v)*v,c=Math.floor(c/v)*v):(u=Math.floor(u/v)*v,c=Math.ceil(c/v)*v);var y=n?e:u,A=n?r:c;f.setMultipleAttributes(o,[s,l],[y,A]),this.drawChartGrid(t,u,c,v,y,A,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,a,o){var s=t.getAttribute("type"),l=p.findChildOfType(t,"grid"),u=l.getAttribute(o?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=u){var c=o?l.lastElementChild:l.firstElementChild,h=p.findChildOfType(t,"pictureback"),d=l.getAttribute("grid-text-color"),m=l.getAttribute("grid-line-color"),g=o?"scale-type-y":"scale-type-x",b="SCALE_100_PERCENT"==t.getAttribute(g),v="SCALE_TIME_WINDOW"==t.getAttribute(g)?t.getAttribute("date-format-pattern"):"null",y=Math.round((r-e)/i)+1,A="GRID_DEFAULT"==u,T=!0;if("ChartBar"==s||"ChartStack"==s){var C=t.getAttribute("bar-dir");"SOUTH"!=C&&"WEST"!=C||(T=!1)}for(var S=f.getFloatAttribute(h,"x"),E=f.getFloatAttribute(h,"y"),w=f.getFloatAttribute(h,"width"),k=f.getFloatAttribute(h,"height"),x=a-n,M=(o?k:w)/x,O=i*M;c.childElementCount<y;){var I=p.cloneElementWithId("grid-item");c.appendChild(I)}for(var _=p.childElements(c),L=e,P=o?T?E+(a-e)*M:E+(e-n)*M:T?S+(e-n)*M:S+(a-e)*M,R=0;R<y;R++){var F=o?A?S-4:S:P,D=o?P:A?E+k+4:E+k,N=o?A?S+w:S+w+4:P,B=o?P:A?E:E-4,G=o?A?F-3:N+3:F,U=o?D+3:A?D+11:B-3,H=o?A?"end":"start":"middle";(I=_[R]).setAttribute("visibility","inherit");var z=I.lastElementChild;f.setMultipleAttributes(z,["x1","x2","y1","y2","stroke"],[F,N,D,B,m]);var W=I.firstElementChild;f.setMultipleAttributes(W,["x","y","text-anchor","fill"],[G,U,H,d]);var V=void 0;V=b?f.formatPercent(L):"null"!=v?this.gridFormattedDate(L,x,v):f.formatNumber(L,2),W.firstChild.textContent=V,L+=i,P+=o?T?-O:+O:T?+O:-O}for(R=y;R<_.length;R++)_[R].setAttribute("visibility","hidden")}},t.prototype.gridFormattedDate=function(t,e,r){var i=this.frameDrawing.toDate(t),n=this.frameDrawing.toMilliseconds(e);return n>5*f.YEAR?f.formatDate(i,"YYYY"):n>5*f.MONTH?f.formatDate(i,"MMMYYYY"):n>5*f.DAY?f.formatDate(i,"DDMMM"):n>5*f.HOUR?f.formatDate(i,"DDMMHH"):n>5*f.MINUTE?f.formatDate(i,"HHmm"):f.formatDate(i,"mmss")},t}(),_f=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e,r,i=t.getAttribute("type"),n=p.findChildOfType(t,"pictureback"),a=p.findChildOfType(t,"picture"),o=p.findChildOfType(t,"legend"),s=p.childElements(o),l=s.length,u=f.getFloatAttribute(n,"width"),c=f.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var h=t.getAttribute("bar-dir");e="NORTH"==h||"SOUTH"==h;var d=f.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?u/l:c/l)*d:(e?u:c)*d}for(var m=0;m<l;m++){var g=void 0,b=s[m].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(g=p.createSvgElement("rect")).setAttribute("stroke","none"),g.setAttribute("fill",b);var v=void 0;e?(v=u/l,g.setAttribute("x","ChartBar"==i?v*m+(v-r)/2:(u-r)/2),g.setAttribute("width",r)):(v=c/l,g.setAttribute("y","ChartBar"==i?v*m+(v-r)/2:(c-r)/2),g.setAttribute("height",r)),a.appendChild(g);break;case"ChartPie":(g=p.createSvgElement("path")).setAttribute("stroke","none"),g.setAttribute("fill",b),a.appendChild(g)}Rf.addClickTapHandlerToChartItem(g)}for(m=0;m<l;m++)s[m].setAttribute("data","no data")},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=p.findChildOfType(t,"pictureback"),n=p.findChildOfType(t,"grid"),a=p.findChildOfType(t,"legend"),o=p.findChildOfType(t,"picture"),s=p.childElements(o),l=f.getFloatAttribute(i,"width"),u=f.getFloatAttribute(i,"height"),c=f.splitToFloats(e," "),h=c.length,d=1/0,m=-1/0,g=!1,b=0,v=0;v<h;v++)c[v]<d&&(d=c[v]),m<c[v]&&(m=c[v]),c[v]<0&&(g=!0),b+=c[v];var y=!1;if("ChartBar"==r||"ChartStack"==r){var A=t.getAttribute("bar-dir"),T="NORTH"==A||"SOUTH"==A;"ChartBar"==r?(d=Math.min(0,d),m=Math.max(0,m)):(d=0,m=Math.max(0,b));var C=t.getAttribute(T?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=C&&"SCALE_AUTO_FROM_0"!=C||this.chartScaleAndGrid.recalcChartScale(t,d,m,T,!1),y="SCALE_100_PERCENT"==C;var S=f.getFloatAttribute(n,T?"min-y":"min-x"),E=f.getFloatAttribute(n,T?"max-y":"max-x"),w=(T?u:l)/(E-S),k=0;for(v=0;v<h;v++)if("ChartStack"==r&&(g||0==b)||"ChartBar"==r&&y&&(g||0==b))s[v].setAttribute(T?"height":"width",0);else{var x=y?c[v]/b:c[v],M=Math.abs(x),O=void 0;if("ChartBar"==r)switch(A){case"NORTH":case"WEST":O=x>0?E-x:E;break;case"SOUTH":case"EAST":O=x<0?x-S:-S}else{switch(A){case"NORTH":case"WEST":O=E-(x+k);break;case"SOUTH":case"EAST":O=-S+k}k+=x}M*=w;var I=T?u:l;(O*=w)<0?(M-=-O,O=0):O+M>I&&(M-=O+M-I),M<0&&(M=0),T?(s[v].setAttribute("y",O),s[v].setAttribute("height",M)):(s[v].setAttribute("x",O),s[v].setAttribute("width",M))}}else{var _=-Math.PI/2;for(v=0;v<h;v++){var L=b<=0||g?0:2*Math.PI*(c[v]/b),P=l/2,R=u/2,F=f.sectorData(P,R,P,R,_,L);s[v].setAttribute("d",F),_+=L}}("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&y)&&g?Rf.showChartWarning(t,"Neg!"):Rf.hideChartWarning(t);var D=p.childElements(a);for(v=0;v<h;v++)D[v].setAttribute("data",c[v]);if("NONE"!=t.getAttribute("leg-pos")){for(v=0;v<h;v++){var N=p.findChildOfType(D[v],"value"),B=f.formatNumber(c[v],2);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&y)&&b>0&&!g&&(B+=" ("+f.formatPercent(c[v]/b)+")"),N.firstChild.textContent=B,N.setAttribute("fill",c[v]>=0?"royalBlue":"fireBrick")}Rf.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){p.childElements(p.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t.dataToString=function(t){for(var e=p.findChildOfType(t,"legend"),r=p.childElements(e),i=r.length,n="",a=0;a<i;a++){n+=Rf.getChratItemName(t,a)+"\t"+r[a].getAttribute("data")+"\n"}return n},t}(),Lf=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=p.findChildOfType(t,"picture"),r=p.findChildOfType(t,"pictureback"),i=f.getFloatAttribute(r,"x"),n=f.getFloatAttribute(r,"y"),a=f.getFloatAttribute(r,"width"),o=f.getFloatAttribute(r,"height"),s=p.cloneElementWithId("normal-text");s.setAttribute("fill","grey"),s.setAttribute("text-anchor","middle"),s.setAttribute("x",(i+a/2).toString()),s.setAttribute("y",(n+o/2+3).toString()),s.firstChild.textContent="Not supported at the moment",e.appendChild(s)},t.draw=function(t,e){},t.setItemLook=function(t,e,r,i){},t.dataToString=function(t){return"N/A"},t}(),Pf=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(t){var e=p.findChildOfType(t,"picture"),r=p.findChildOfType(t,"pictureback"),i=f.getFloatAttribute(r,"height"),n=p.childElements(p.findChildOfType(t,"legend")),a=n.length,o=i/a,s=o*f.getFloatAttribute(t,"bar-width"),l=(o-s)/2;t.setAttribute("rect-height",f.reducePrecision(s).toString());for(var u=0;u<a;u++){n[u].setAttribute("data","empty");var c=p.createSvgElement("g");c.setAttribute("transform","translate(0,"+(u*o+l)+")"),e.appendChild(c),Rf.addClickTapHandlerToChartItem(c)}},t.prototype.draw=function(e,r){for(var i=p.findChildOfType(e,"pictureback"),n=p.findChildOfType(e,"picture"),a=p.findChildOfType(e,"grid"),o=f.getFloatAttribute(i,"width"),s=Ff.mergeData(e,r),l=s.length,u=-1/0,c=0;c<l;c++)if("empty"==s[c])s[c]=[];else{s[c]=f.splitSkipEmpty(s[c],"|");for(var h=0;h<s[c].length;h++)s[c][h]=s[c][h].split(":"),s[c][h][0]=parseFloat(s[c][h][0]),s[c][h][1]=parseFloat(s[c][h][1]);var d=s[c][s[c].length-1][0];u<d&&(u=d)}u==1/0&&(u=0);for(c=0;c<l;c++)0!=s[c].length&&s[c][s[c].length-1][0]<u&&s[c].push([u,s[c][s[c].length-1][1]]);var m,g=f.getFloatAttribute(e,"scale-max-x");m="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(u,g):Math.max(u,g,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,m-g,m,!1,!0);var b=f.getFloatAttribute(a,"min-x"),v=o/(f.getFloatAttribute(a,"max-x")-b),y=p.childElements(n),A=f.getFloatAttribute(e,"rect-height"),T=t.colorMapping(e);for(c=0;c<l;c++){var C=y[c],S=p.childElements(C),E=S.length,w=0,k="",x=null;for(h=0;h<s[c].length;h++){var M=s[c][h][0],O=s[c][h][1];if(M<b)x=0,k=T(O);else if(null==x)x=(M-b)*v,k=T(O);else{var I=T(O);if(I!=k||h==s[c].length-1){var _=(M-b)*v,L=void 0;w<E?(L=S[w],w++,L.setAttribute("visibility","inherit")):(L=p.createSvgElement("rect"),C.appendChild(L)),f.setMultipleAttributes(L,["x","width","height","fill"],[f.reducePrecision(x),f.reducePrecision(_-x),A,k]),x=_,k=I}}}for(var P=w;P<E;P++)S[P].setAttribute("visibility","hidden")}},t.colorMapping=function(t){for(var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color"),i=f.splitSkipEmpty(e," "),n=[],a=[],o=function(t){var e=i[t].split(":"),r=void 0,o=parseFloat(e[1]);switch(e[0]){case"GREATER":r=function(t){return t>o};break;case"GREATER_OR_EQUALS":r=function(t){return t>=o};break;case"LESS":r=function(t){return t<o};break;case"LESS_OR_EQUALS":r=function(t){return t<=o};break;case"EQUALS":r=function(t){return t==o};break;case"NOT_EQUALS":r=function(t){return t!=o}}n[t]=r,a[t]=e[2]},s=0;s<i.length;s++)o(s);return function(t){for(var e=0;e<n.length;e++)if(n[e](t))return a[e];return r}},t.setItemLook=function(t,e,r,i){var n=p.findChildOfType(t,"picture");p.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),Rf=function(){function t(t){this.frameDrawing=t,this.chartScaleAndGrid=new If(t),this.chart1D=new _f(t,this.chartScaleAndGrid),this.chart2D=new Ff(t,this.chartScaleAndGrid),this.chartHistogram=new Of(t,this.chartScaleAndGrid),this.chartHistogram2D=new Lf(t,this.chartScaleAndGrid),this.chartTimeColor=new Pf(t,this.chartScaleAndGrid)}return t.create=function(){return p.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),a=p.findChildOfType(e,"background"),o=p.findChildOfType(e,"pictureback"),s=p.findChildOfType(e,"pictureselect"),l=p.findChildOfType(e,"picture"),u=p.findChildOfType(e,"pictureborderh"),c=p.findChildOfType(e,"pictureborderw"),h=p.findChildOfType(e,"grid"),d=0;d<r.length;d++)switch(r[d]){case"width":case"height":case"fill":case"stroke":a.setAttribute(r[d],i[d]);break;case"pic-width":case"pic-height":o.setAttribute(r[d].substring(4),i[d]),s.setAttribute(r[d].substring(4),i[d]),l.setAttribute(r[d].substring(4),i[d]);break;case"pic-fill":o.setAttribute(r[d].substring(4),i[d]);break;case"pic-stroke":u.setAttribute(r[d].substring(4),i[d]),c.setAttribute(r[d].substring(4),i[d]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":h.setAttribute(r[d],i[d]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":t.addItem(e,i[d]);break;case"items-completed":t.setupLegendItemsLayout(e),t.setupPicture(e);break;case"data":this.drawPicture(e,i[d]);break;default:qf.filterAndSetAttribute(e,r[d],i[d])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=p.findChildOfType(e,"background"),n=p.findChildOfType(e,"pictureback"),a=p.findChildOfType(e,"pictureselect"),o=p.findChildOfType(e,"picture"),s=p.findChildOfType(e,"pictureborderh"),l=p.findChildOfType(e,"pictureborderw"),u=p.findChildOfType(e,"warning"),c=p.findChildOfType(e,"legend"),h=p.findChildOfType(e,"controls"),d=e.getAttribute("leg-pos"),m=f.getFloatAttribute(i,"width"),g=f.getFloatAttribute(i,"height"),b=f.getFloatAttribute(e,"pic-offset-x"),v=f.getFloatAttribute(e,"pic-offset-y"),y=f.getFloatAttribute(n,"width"),A=f.getFloatAttribute(n,"height"),T=f.getFloatAttribute(e,"leg-size"),C=0,S=0,E=0,w=0;switch(d){case"SOUTH":C=b,S=g-T,E=m-b,w=T;break;case"WEST":b+=T,C=0,S=v,E=T,w=g-v;break;case"EAST":C=m-T,S=v,E=T,w=g-v;break;case"NORTH":v+=T,C=b,S=0,E=m-b,w=T}if(f.setMultipleAttributes(n,["x","y"],[b,v]),f.setMultipleAttributes(a,["x","y"],[b,v]),f.setMultipleAttributes(o,["x","y"],[b,v]),f.setMultipleAttributes(u,["x","y"],[b+y/2,v+A/2+3]),h.setAttribute("transform","translate("+(b+y)+","+v+")"),"NONE"==d?c.setAttribute("visibility","hidden"):(c.setAttribute("transform","translate("+C+","+S+")"),f.setMultipleAttributes(c,["width","height"],[E,w])),"ChartPie"==r){var k=y/2,x=A/2,M=p.createSvgElement("ellipse");f.setMultipleAttributes(M,["cx","cy","rx","ry","stroke","fill","visibility"],[b+k,v+x,k,x,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(M,n);var O=p.createSvgElement("ellipse");f.setMultipleAttributes(O,["cx","cy","rx","ry","stroke","fill"],[b+k,v+x,k,x,s.getAttribute("stroke"),"none"]),e.insertBefore(O,s),p.removeElement(s),p.removeElement(l)}var I=Mf.create("icon-copy","rgba(220,220,220,0.7)","Black","DimGray","White",function(r){return t.copyToClipboard(e)},null);I.setAttribute("transform","translate(-20,0)"),h.appendChild(I),e.addEventListener("mouseover",function(e){return t.selectChart(e,!0)}),e.addEventListener("mouseout",function(e){return t.selectChart(e,!1)})},t.setupLegendItemsLayout=function(t){for(var e=p.findChildOfType(t,"legend"),r=p.childElements(e),i=f.getFloatAttribute(e,"width"),n=0,a=0,o=0;o<r.length;o++){var s=r[o],l=p.findChildOfType(s,"back"),u=f.getFloatAttribute(l,"width"),c=p.findChildOfType(s,"value"),h=6*c.firstChild.textContent.length,d=Math.max(u,f.getFloatAttribute(c,"x")+h);d>u&&l.setAttribute("width",d.toString()),0<n&&i<n+d&&(n=0,a+=20),s.setAttribute("transform","translate("+n+","+a+")"),n+=d+5}},t.showChartWarning=function(t,e){var r=p.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=p.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=p.findChildOfType(t,"picture"),r=p.findChildOfType(t,"legend");p.removeAllChildren(r),p.removeAllChildren(e)},t.addItem=function(e,r){var i=e.getAttribute("type"),n=p.findChildOfType(e,"legend"),a=r.split("\n"),o=a[0],s=a[1],l=p.cloneElementWithId("legend-item"),u=p.findChildOfType(l,"color"),c=p.findChildOfType(l,"name"),h=p.findChildOfType(l,"value");u.setAttribute("fill",o),l.setAttribute("original-color",o),c.setAttribute("fill",e.getAttribute("leg-text-color")),c.appendChild(p.createTextNode(s)),h.appendChild(p.createTextNode("")),n.appendChild(l);var d=c.getComputedTextLength();h.setAttribute("x",(f.getFloatAttribute(c,"x")+d+4).toString()),"ChartPlot"==i||"ChartTimePlot"==i?f.setMultipleAttributes(l,["draw-line","line-width","interpolation","point-style","fill-under-line"],[a[2],a[3],a[4],a[5],a[6]]):"ChartHistogram"==i&&f.setMultipleAttributes(l,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[a[2],a[3],a[4],a[5],a[6]]),t.addClickTapHandlerToChartItem(l)},t.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":_f.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":Ff.setup(t);break;case"ChartTimeColor":Pf.setup(t);break;case"ChartHistogram":Of.setup(t);break;case"ChartHistogram2D":Lf.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":Lf.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.selectChart=function(t,e){var r=t.currentTarget,i=p.findChildOfType(r,"pictureselect"),n=p.findChildOfType(r,"controls");i.setAttribute("visibility",e?"inherit":"hidden"),n.setAttribute("class",e?"shown-with-transition":"hidden-with-transition")},t.addClickTapHandlerToChartItem=function(e){new m(e,function(r){return t.selectChartItem(e,!0,!1,r)},function(r){return t.selectChartItem(e,!1,!1,r)},null,function(r){return t.selectChartItem(e,!0,!0,r)},null)},t.selectChartItem=function(e,r,i,n){for(var a=t.getChartShape(e),o=f.indexInParent(e),s=p.childElements(p.findChildOfType(a,"legend")),l=s[o],u="true"==l.getAttribute("selected"),c=!1,h=0;h<s.length;h++)if(h!=o&&"true"==s[h].getAttribute("selected")){c=!0;break}if(r&&"legend"!=e.parentNode.getAttribute("type")){var d=n,m=t.getChratItemName(a,o);qf.showTooltip(m,d.clientX,d.clientY,"Black","White")}else qf.hideTooltip();if(i)return u=!u,l.setAttribute("selected",u?"true":"false"),void t.setChartItemLook(a,o,!1,u);if(u||c){if(u)return;t.setChartItemLook(a,o,!r,r)}else{t.setChartItemLook(a,o,!1,r);for(h=0;h<s.length;h++)h!=o&&t.setChartItemLook(a,h,r,!1)}},t.setChartItemLook=function(e,r,i,n){var a=p.childElements(p.findChildOfType(e,"legend")),o=p.findChildOfType(a[r],"back"),s=p.findChildOfType(a[r],"color");o.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var l=i?t.colorItemGrayed:a[r].getAttribute("original-color");switch(s.setAttribute("fill",l),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":_f.setItemLook(e,r,i,l);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":Ff.setItemLook(e,r,i,l);break;case"ChartTimeColor":Pf.setItemLook(e,r,i,l);break;case"ChartHistogram":Of.setItemLook(e,r,i,l);break;case"ChartHistogram2D":Lf.setItemLook(e,r,i,l)}},t.copyToClipboard=function(t){var e;switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":e=_f.dataToString(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":e=Ff.dataToString(t);break;case"ChartHistogram":e=Of.dataToString(t);break;case"ChartHistogram2D":e=Lf.dataToString(t)}f.copyToClipboard(e)},t.datasetToString=function(t,e){return"\t"+t+"\n"+(e=(e=e.replace(/\|/g,"\n")).replace(/:/g,"\t"))},t.datasetsWithSharedXToString=function(t,e){for(var r=e.length,i=e,n=0;n<r;n++)if("empty"==i[n])i[n]=[];else{i[n]=f.splitSkipEmpty(i[n],"|");for(var a=0;a<i[n].length;a++)i[n][a]=i[n][a].split(":")}var o="";for(n=0;n<r;n++)o+="\t"+t[n];o+="\n";var s=new Array(r);for(s.fill(0);;){var l=1/0;for(n=0;n<r;n++)s[n]<e[n].length&&parseFloat(e[n][s[n]][0])<l&&(l=parseFloat(e[n][s[n]][0]));if(l==1/0)return o;o+=l;for(n=0;n<r;n++)o+="\t",s[n]<e[n].length&&parseFloat(e[n][s[n]][0])==l&&(o+=e[n][s[n]][1],s[n]++);o+="\n"}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.getChratItemName=function(t,e){var r=p.findChildOfType(t,"legend"),i=p.childElements(r);return p.findChildOfType(i[e],"name").firstChild.textContent},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),Ff=function(){function t(t,e){this.frameDrawing=t,this.chartScaleAndGrid=e}return t.setup=function(e){for(var r=e.getAttribute("type"),i=p.findChildOfType(e,"picture"),n=p.childElements(p.findChildOfType(e,"legend")),a=n.length,o=0;o<a;o++){var s=n[o].getAttribute("original-color"),l=p.createSvgElement("g");switch(n[o].setAttribute("data","empty"),r){case"ChartPlot":case"ChartTimePlot":if("true"==n[o].getAttribute("draw-line")){var u=p.createSvgElement("polyline");if(u.setAttribute("fill","none"),u.setAttribute("stroke",s),u.setAttribute("stroke-width",n[o].getAttribute("line-width")),l.appendChild(u),"true"==n[o].getAttribute("fill-under-line")){var c=p.createSvgElement("polyline");c.setAttribute("stroke","none"),c.setAttribute("fill",f.increaseTransparency(s,t.timePlotAlpha)),l.appendChild(c)}}if("POINT_NONE"!=n[o].getAttribute("point-style")){var h=p.createSvgElement("g");h.setAttribute("fill",s),l.appendChild(h)}break;case"ChartTimeStack":var d=p.createSvgElement("polyline");d.setAttribute("stroke-width","1"),d.setAttribute("stroke",s),d.setAttribute("fill","none"),l.appendChild(d);var m=p.createSvgElement("polyline");m.setAttribute("stroke","none"),m.setAttribute("fill",f.increaseTransparency(s,t.stackChartAlpha)),l.appendChild(m)}i.appendChild(l),Rf.addClickTapHandlerToChartItem(l)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=p.findChildOfType(e,"pictureback"),a=p.findChildOfType(e,"picture"),o=p.findChildOfType(e,"grid"),s=p.childElements(p.findChildOfType(e,"legend")),l=f.getFloatAttribute(n,"width"),u=f.getFloatAttribute(n,"height"),c=u,h=t.mergeData(e,r),d=h.length,m=t.parseDataAndFindMinMax(h),g=m.datasets,b=m.minx,v=m.maxx,y=m.miny,A=m.maxy;if("ChartTimeStack"==i&&y<0)Rf.showChartWarning(e,"Neg!");else{Rf.hideChartWarning(e),"ChartTimeStack"==i&&(y=0,A=t.prepareChartTimeStackData(g));var T,C=e.getAttribute("scale-type-x"),S=e.getAttribute("scale-type-y"),E="SCALE_100_PERCENT"==S;if("SCALE_AUTO"==C)this.chartScaleAndGrid.recalcChartScale(e,b,v,!1,!1);else if("SCALE_TIME_WINDOW"==C){T=f.getFloatAttribute(e,"scale-max-x");var w=void 0;w="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(v,T):Math.max(v,T,this.frameDrawing.time),this.chartScaleAndGrid.recalcChartScale(e,w-T,w,!1,!0)}"SCALE_AUTO"==S&&this.chartScaleAndGrid.recalcChartScale(e,y,A,!0,!1);for(var k=f.getFloatAttribute(o,"min-x"),x=f.getFloatAttribute(o,"max-x"),M=f.getFloatAttribute(o,"min-y"),O=f.getFloatAttribute(o,"max-y"),I=l/(x-k),_=u/(O-M),L=p.childElements(a),P="",R=0;R<d;R++){var F=void 0,D=void 0,N=void 0,B=void 0,G=void 0,U=void 0,H=void 0,z=void 0,W=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(F="true"==s[R].getAttribute("draw-line"),D=s[R].getAttribute("point-style"),N="INTERPOLATION_STEP"==s[R].getAttribute("interpolation")),(F||"ChartTimeStack"==i)&&(G=(B=L[R].firstElementChild).nextElementSibling),D&&"POINT_NONE"!=D)switch(U=L[R].lastElementChild,D){case"POINT_CIRCLE":H="plot-point-circle",z=0,W=0;break;case"POINT_SQUARE":H="plot-point-square",z=-1.5,W=-1.5;break;case"POINT_TRIANGLE":H="plot-point-triangle",z=0,W=0}for(var V=void 0,Y=void 0,j="",X="",q=void 0,Z=void 0,K=0,Q=0;Q<g[R].length;Q++){var J=(g[R][Q][0]-k)*I,$=void 0;if(E){var tt=g[d-1][Q][1];$=tt<=0?0:g[R][Q][1]/tt}else $=g[R][Q][1];var et=(-$+O)*_;if(J<0&&(J=0),l<J&&(J=l),et<0&&(et=0),u<et&&(et=u),!(null!=V&&Math.abs(J-V)<Rf.chartTolerance&&Math.abs(et-Y)<Rf.chartTolerance)){if(J=f.reducePrecision(J),et=f.reducePrecision(et),0==Q&&(q=J),Z=J,B&&(N&&null!=V&&(j+=J+","+Y+" "),j+=J+","+et+" ",G&&(0==R&&(P=J+","+c+" "+P),X=J+","+et+" "+X)),U){var rt=p.childElements(U)[K];rt?rt.setAttribute("visibility","inherit"):(rt=p.createUseElement(H),U.appendChild(rt)),rt.setAttribute("x",z+J),rt.setAttribute("y",W+et)}K++,V=J,Y=et}}if(B&&(B.setAttribute("points",j),G))if("ChartTimePlot"==i){var it="";if(""!=j){var nt=O*_;nt<0&&(nt=0),u<nt&&(nt=u),it=Z+","+nt+" "+q+","+nt}G.setAttribute("points",j+it)}else G.setAttribute("points",j+P),P=X;if(U){var at=p.childElements(U);for(Q=K;Q<at.length;Q++)at[Q].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var a=e.getAttribute("type"),o=p.childElements(p.findChildOfType(e,"legend")),s=p.childElements(p.findChildOfType(e,"picture"));if("ChartTimeStack"==a)s[r].firstElementChild.setAttribute("stroke",n),s[r].lastElementChild.setAttribute("fill",f.increaseTransparency(n,t.stackChartAlpha));else{if("true"==o[r].getAttribute("draw-line")){var l=s[r].firstElementChild;l.setAttribute("stroke",n);var u=l.nextElementSibling;u&&u.setAttribute("fill",f.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=o[r].getAttribute("point-style")&&s[r].lastElementChild.setAttribute("fill",n)}},t.mergeData=function(e,r){for(var i=p.findChildOfType(e,"legend"),n=p.childElements(i),a=f.splitSkipEmpty(r," "),o=a.length,s=[],l=0;l<o;l++){var u=n[l].getAttribute("data"),c=t.mergeDataset(u,a[l]);n[l].setAttribute("data",c),s.push(c)}return s},t.mergeDataset=function(t,e){var r=f.splitSkipEmpty(e,"#"),i=parseInt(r[0]),n=parseInt(r[1]),a=r[2];if("empty"==t||0==n)return a;var o=f.splitSkipEmpty(t,"|");o.splice(0,i),o.splice(n);var s=o.join("|")+"|";return"empty"==a?s:s+a},t.parseDataAndFindMinMax=function(t){for(var e=t,r=e.length,i=1/0,n=-1/0,a=1/0,o=-1/0,s=0;s<r;s++)if("empty"==e[s])e[s]=[];else{e[s]=f.splitSkipEmpty(e[s],"|");for(var l=0;l<e[s].length;l++){e[s][l]=e[s][l].split(":");var u=e[s][l][0]=parseFloat(e[s][l][0]),c=e[s][l][1]=parseFloat(e[s][l][1]);u<i&&(i=u),n<u&&(n=u),c<a&&(a=c),o<c&&(o=c)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,o=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:o}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a].length<=i||t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.dataToString=function(t){var e=t.getAttribute("type"),r=p.findChildOfType(t,"legend"),i=p.childElements(r),n=i.length;if("ChartPlot"==e){for(var a="",o=0;o<n;o++){var s=Rf.getChratItemName(t,o),l=i[o].getAttribute("data");a+=Rf.datasetToString(s,l)+"\n"}return a}var u=new Array(n);for(l=new Array(n),o=0;o<n;o++)u[o]=Rf.getChratItemName(t,o),l[o]=i[o].getAttribute("data");return Rf.datasetsWithSharedXToString(u,l)},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),Df=function(){function t(t){this.frameDrawing=t}return t.prototype.create=function(){var e=this,r=p.cloneElementWithId("shape-inspect"),i=p.findChildOfType(r,"svg"),n=p.findChildOfType(i,"info"),a=p.findChildOfType(i,"chart"),o=p.findChildOfType(i,"controls"),s=Mf.create("icon-info","Moccasin","DarkRed","Wheat","DarkRed",function(t){p.bringElementToFront(r),n.setAttribute("class","shown-with-transition"),a.setAttribute("class","hidden-with-transition")},null);s.setAttribute("type","show-info"),s.setAttribute("transform","translate(-80,0)"),o.appendChild(s);var l=Mf.create("icon-chart","Ivory","DarkRed","Beige","DarkRed",function(t){p.bringElementToFront(r),n.setAttribute("class","hidden-with-transition"),a.setAttribute("class","shown-with-transition")},null);l.setAttribute("type","show-chart"),l.setAttribute("transform","translate(-60,0)"),o.appendChild(l);var u=Mf.create("icon-copy","LightSalmon","DarkRed","IndianRed","White",function(e){p.bringElementToFront(r),t.copyInspect(r)},null);u.setAttribute("transform","translate(-40,0)"),o.appendChild(u);var c=Mf.create("icon-close","LightSalmon","DarkRed","IndianRed","White",function(t){return e.closeInspct(r)},null);c.setAttribute("transform","translate(-20,0)"),o.appendChild(c);var h=function(e){return t.onInspectEvent(e)};return r.addEventListener("mouseover",h),r.addEventListener("mouseout",h),r.addEventListener("mousedown",h),r.addEventListener("wheel",h),r.addEventListener("touchstart",h),r},t.update=function(e,r,i){for(var n=p.findChildOfType(e,"svg"),a=p.findChildOfType(n,"name-text"),o=p.findChildOfType(n,"info"),s=p.findChildOfType(o,"info-text"),l=0;l<r.length;l++)switch(r[l]){case"name":a.firstChild.textContent=i[l];break;case"info":var u=p.findChildOfType(n,"chart");s.setAttribute("content",i[l]);for(var c=i[l].split("\n"),h=0;h<c.length;h++)c[h]=f.replaceTabsWithSpaces(c[h],8);if(Sf.drawMultiLineText(s,c,12,0),c.length<=2&&null==u){var d=f.getFloatAttribute(n,"height");t.resizeInspect(e,0,60-d)}else t.scrollInfoText(e,0);break;case"dataset-names":var m=f.splitSkipEmpty(i[l]," ");u=p.findChildOfType(n,"chart");var g=p.findChildOfType(u,"plot"),b=m.length;if(0==b){p.removeElement(u);var v=p.findChildOfType(n,"controls"),y=p.findChildOfType(v,"show-info"),A=p.findChildOfType(v,"show-chart");p.removeElement(y),p.removeElement(A)}else{var T=p.findChildOfType(g,"picture");for(h=0;h<b;h++){var C=p.cloneElementWithId("inspect-plot-item");C.setAttribute("name",m[h]);var S=t.plotColors[h%t.plotColors.length];C.setAttribute("stroke",S),T.appendChild(C)}}break;case"data":u=p.findChildOfType(n,"chart"),g=p.findChildOfType(u,"plot");var E=p.findChildOfType(g,"picture"),w=p.childElements(E),k=f.splitSkipEmpty(i[l]," ");b=k.length;var x=[];for(h=0;h<b;h++){var M=w[h].getAttribute("data"),O=Ff.mergeDataset(M,k[h]);w[h].setAttribute("data",O),x.push(O)}var I=Ff.parseDataAndFindMinMax(x),_=I.datasets,L=I.minx,P=I.maxx,R=I.miny,F=I.maxy;t.recalcChartScaleAndDrawGrid(u,L,P,!1,!1),t.recalcChartScaleAndDrawGrid(u,R,F,!0,!1),t.drawPlotLines(u,_);break;default:qf.filterAndSetAttribute(e,r[l],i[l])}},t.recalcChartScaleAndDrawGrid=function(e,r,i,n,a){var o=p.findChildOfType(e,"plot"),s=p.findChildOfType(o,"grid"),l=n?"min-y":"min-x",u=n?"max-y":"max-x",c=r,h=i;c==h&&(c-=1,h+=1);var d=p.findChildOfType(e,"chart-back"),m=f.getFloatAttribute(d,n?"height":"width")-(n?17:10),g=n?25:45,b=(h-c)/Math.floor(m/g),v=Math.pow(10,Math.ceil(Math.log(h-c)/Math.log(10))-1),y=v/5;y<b&&(y=v/2)<b&&(y=v)<b&&(y=2*v)<b&&(y=5*v),c=Math.floor(c/y)*y,h=Math.ceil(h/y)*y,(a||c!=f.getFloatAttribute(s,l)||h!=f.getFloatAttribute(s,u))&&(f.setMultipleAttributes(s,[l,u],[c,h]),t.drawChartGrid(e,c,h,y,n))},t.drawChartGrid=function(t,e,r,i,n){for(var a=p.findChildOfType(t,"plot"),o=p.findChildOfType(a,"grid"),s=n?o.lastElementChild:o.firstElementChild,l=p.findChildOfType(o,"zero-line"),u=p.findChildOfType(t,"chart-back"),c=Math.round((r-e)/i)+1,h=f.getFloatAttribute(u,"width")-10,d=f.getFloatAttribute(u,"height")-17,m=(n?d:h)/(r-e),g=i*m;s.childElementCount<c;){var b=p.cloneElementWithId("inspect-grid-item");s.appendChild(b)}for(var v=p.childElements(s),y=e,A=n?(r-e)*m:0,T=!1,C=0;C<c;C++){var S=n?0:A,E=n?A:d,w=n?h:A,k=n?A:0,x=n?S+1:S,M=n?0==C?E-2:C==c-1?E+8:E-3:E+9,O=n?"start":0==C?"start":C==c-1?"end":"middle";(b=v[C]).setAttribute("visibility","inherit");var I=b.lastElementChild;f.setMultipleAttributes(I,["x1","x2","y1","y2"],[S,w,E,k]),n&&Math.abs(y)<i/10&&(f.setMultipleAttributes(l,["x1","x2","y1","y2"],[S,w,E,k]),T=!0);var _=b.firstElementChild;f.setMultipleAttributes(_,["x","y","text-anchor"],[x,M,O]),_.firstChild.textContent=f.formatNumber(y,2),y+=i,A+=n?-g:+g}for(C=c;C<v.length;C++)v[C].setAttribute("visibility","hidden");n&&l.setAttribute("visibility",T?"inherit":"hidden")},t.drawPlotLines=function(t,e){for(var r=p.findChildOfType(t,"plot"),i=p.findChildOfType(t,"chart-back"),n=p.findChildOfType(r,"picture"),a=p.findChildOfType(r,"grid"),o=f.getFloatAttribute(i,"width")-10,s=f.getFloatAttribute(i,"height")-17,l=f.getFloatAttribute(a,"min-x"),u=f.getFloatAttribute(a,"max-x"),c=f.getFloatAttribute(a,"min-y"),h=f.getFloatAttribute(a,"max-y"),d=o/(u-l),m=s/(h-c),g=p.childElements(n),b=g.length,v=0;v<b;v++){for(var y=void 0,A=void 0,T="",C=0;C<e[v].length;C++){var S=0+(e[v][C][0]-l)*d,E=0+(-e[v][C][1]+h)*m;S<0&&(S=0),0+o<S&&(S=0+o),E<0&&(E=0),0+s<E&&(E=0+s),null!=y&&Math.abs(S-y)<Rf.chartTolerance&&Math.abs(E-A)<Rf.chartTolerance||(T+=(S=f.reducePrecision(S))+","+(E=f.reducePrecision(E))+" ",0,y=S,A=E)}g[v].setAttribute("points",T)}},t.redrawChart=function(e){var r=p.findChildOfType(e,"plot");if(null!=r){for(var i=p.findChildOfType(r,"picture"),n=p.childElements(i),a=n.length,o=[],s=0;s<a;s++){var l=n[s].getAttribute("data");o.push(l)}var u=Ff.parseDataAndFindMinMax(o),c=u.datasets,h=u.minx,d=u.maxx,f=u.miny,m=u.maxy;t.recalcChartScaleAndDrawGrid(e,h,d,!1,!0),t.recalcChartScaleAndDrawGrid(e,f,m,!0,!0),t.drawPlotLines(e,c)}},t.onInspectEvent=function(e){var r=e.currentTarget,i=e.target,n=p.findChildOfType(r,"svg"),a=p.findChildOfType(n,"info"),o=p.findChildOfType(a,"info-back"),s="inherit"==p.findChildOfType(a,"scrollbar").getAttribute("visibility");if(e instanceof MouseEvent){var l=e;switch(e.type){case"mouseover":e.stopPropagation(),t.onInspectMouseOver(r,e);break;case"mouseout":t.onInspectMouseOut(r,l);break;case"mousedown":1==l.which&&(l.stopPropagation(),l.preventDefault(),t.onInspectMouseDown(r,l));break;case"wheel":if(!l.altKey&&!l.ctrlKey&&i==o&&s){var u=e;e.stopPropagation(),e.preventDefault(),t.scrollInfoText(r,u.deltaY<0?36:-36)}}}else if(f.touchEventExists()&&e instanceof TouchEvent){var c=e;if(c.touches.length>1)return;switch(c.type){case"touchstart":c.stopPropagation(),c.preventDefault(),t.onInspectMouseOver(r,c),t.onInspectMouseDown(r,c)}}},t.onInspectMouseOver=function(e,r){if(!(t.resizing||t.moving||t.scrolling)){var i=p.findChildOfType(e,"svg"),n=p.findChildOfType(i,"name-back"),a=p.findChildOfType(i,"controls"),o=p.findChildOfType(a,"resize"),s=p.findChildOfType(i,"chart"),l=null==s?null:p.findChildOfType(s,"plot"),u=null==l?null:p.findChildOfType(l,"picture"),c=r.target;if(c==o)o.setAttribute("fill","IndianRed"),o.style.cursor="nw-resize";else if(c==n)n.setAttribute("fill","rgb(197,163,120)"),n.style.cursor="move";else if(c.parentNode==u){var h=void 0,d=void 0;if(r instanceof MouseEvent){var m=r;h=m.clientX,d=m.clientY}else{var g=r;h=g.touches[0].clientX,d=g.touches[0].clientY}var b=c.getAttribute("name"),v=f.removeTransparency(c.getAttribute("stroke"));qf.showTooltip(b,h,d,v,"White")}a.setAttribute("class","shown-with-transition")}},t.onInspectMouseOut=function(e,r){if(!(t.resizing||t.moving||t.scrolling)){var i=p.findChildOfType(e,"svg"),n=p.findChildOfType(i,"name-back"),a=p.findChildOfType(i,"controls"),o=p.findChildOfType(a,"resize"),s=r.target;s==o?o.setAttribute("fill","LightSalmon"):s==n&&n.setAttribute("fill","BurlyWood"),qf.hideTooltip(),r instanceof MouseEvent&&!e.contains(r.relatedTarget)&&a.setAttribute("class","hidden-with-transition")}},t.onInspectMouseDown=function(e,r){var i=p.findChildOfType(e,"svg"),n=p.findChildOfType(i,"info"),a=p.findChildOfType(i,"name-back"),o=p.findChildOfType(i,"controls"),s=p.findChildOfType(n,"info-back"),l=p.findChildOfType(n,"scrollbar"),u=p.findChildOfType(o,"resize"),c="inherit"==l.getAttribute("visibility"),h=f.getFloatAttribute(a,"height"),d=a.getBoundingClientRect().height/h;p.bringElementToFront(e);var m=r.target;if(m==u||m==a||m==s&&c){m==u?t.resizing=!0:m==a?t.moving=!0:m==s&&c&&(t.scrolling=!0);var g=void 0,b=void 0;if(r instanceof MouseEvent){var v=r;g=v.pageX,b=v.pageY}else{var y=r;g=y.touches[0].pageX,b=y.touches[0].pageY}new xf(g,b,function(r,i,n){i/=d,n/=d,t.resizing?t.resizeInspect(e,i,n):t.moving?t.moveInspect(e,i,n):t.scrolling&&t.scrollInfoText(e,n)},function(r){t.resizing=!1,t.moving=!1,t.scrolling=!1,t.onInspectMouseOut(e,r)},t.resizing?"nw-resize":t.scrolling?"ns-resize":"move")}},t.resizeInspect=function(e,r,i){var n=p.findChildOfType(e,"svg-shadow"),a=p.findChildOfType(e,"svg"),o=p.findChildOfType(a,"info"),s=p.findChildOfType(a,"chart"),l=p.findChildOfType(a,"name-back"),u=p.findChildOfType(a,"controls"),c=p.findChildOfType(o,"info-back"),h=p.findChildOfType(o,"scrollbar"),d=p.findChildOfType(u,"resize"),m=null==s?null:p.findChildOfType(s,"chart-back"),g=f.getFloatAttribute(l,"height"),b=Math.max(100,f.getFloatAttribute(a,"width")+r),v=Math.max(60,f.getFloatAttribute(a,"height")+i);f.setMultipleAttributes(n,["width","height"],[b,v]),f.setMultipleAttributes(a,["width","height"],[b,v]),f.setMultipleAttributes(c,["width","height"],[b,v-g]),null!=m&&f.setMultipleAttributes(m,["width","height"],[b,v-g]),l.setAttribute("width",b.toString()),h.setAttribute("x",(b-10).toString()),u.setAttribute("transform","translate("+b+")"),d.setAttribute("transform","translate(0,"+v+")"),t.scrollInfoText(e,0),null!=s&&t.redrawChart(s),t.updateArrow(e)},t.moveInspect=function(e,r,i){var n=p.findChildOfType(e,"svg-shadow"),a=p.findChildOfType(e,"svg"),o=f.getFloatAttribute(a,"x")+r,s=f.getFloatAttribute(a,"y")+i;f.setMultipleAttributes(n,["x","y"],[o,s]),f.setMultipleAttributes(a,["x","y"],[o,s]),t.updateArrow(e)},t.updateArrow=function(t){var e,r,i=p.findChildOfType(t,"arrow"),n=p.findChildOfType(t,"svg"),a=f.getFloatAttribute(n,"x"),o=f.getFloatAttribute(n,"y"),s=f.getFloatAttribute(n,"width"),l=f.getFloatAttribute(n,"height"),u=s/2,c=l/2;a>=0&&o>=0?(e=a+5,r=o+5):a>=0&&o<0&&o+l>=0?(e=a+5,r=(o+c)/c*5):a>=0&&o+l<0?(e=a+5,r=o+l-5):a<0&&a+s>=0&&o+l<0?(e=(a+u)/u*5,r=o+l-5):a+s<0&&o+l<0?(e=a+s-5,r=o+l-5):a+s<0&&o<0&&o+l>=0?(e=a+s-5,r=(o+c)/c*5):a+s<0&&o>=0?(e=a+s-5,r=o+5):a<0&&a+s>=0&&o>=0?(e=(a+u)/u*5,r=o+5):(e=0,r=0);var h=f.radiansToDegrees(Math.atan2(r,e)),d=Math.sqrt(e*e+r*r)/10;i.setAttribute("transform","rotate("+h+") scale("+d+",1)")},t.scrollInfoText=function(t,e){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"info"),n=p.findChildOfType(i,"info-back"),a=p.findChildOfType(i,"info-text"),o=p.findChildOfType(i,"scrollbar"),s=f.getFloatAttribute(n,"height"),l=12*(a.childElementCount+1),u=f.getFloatAttribute(a,"y"),c=u+e;if(c=Math.max(12+s-l,c),(c=Math.min(12,c))!=u){a.setAttribute("y",c.toString());for(var h=p.childElements(a),d=0;d<h.length;d++)h[d].setAttribute("y",(c+12*d).toString())}if(l>s){var m=s-14;o.setAttribute("visibility","inherit"),o.setAttribute("y",(4+m*(12-c)/l).toString()),o.setAttribute("height",(m*s/l+6).toString())}else o.setAttribute("visibility","hidden")},t.copyInspect=function(t){var e,r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"info"),n=p.findChildOfType(r,"chart"),a=p.findChildOfType(i,"info-text"),o=null==n?null:p.findChildOfType(n,"plot"),s=null==o?null:p.findChildOfType(o,"picture");if(null==n||"hidden-with-transition"==n.getAttribute("class"))e=a.getAttribute("content");else{for(var l=p.childElements(s),u=new Array(l.length),c=new Array(l.length),h=0;h<l.length;h++)u[h]=l[h].getAttribute("name"),c[h]=l[h].getAttribute("data");e=Rf.datasetsWithSharedXToString(u,c)}f.copyToClipboard(e)},t.prototype.closeInspct=function(t){var e=p.findChildOfType(t,"svg"),r=p.findChildOfType(e,"info"),i=p.findChildOfType(e,"chart"),n=p.findChildOfType(e,"controls");r.removeAttribute("class"),null!=i&&i.removeAttribute("class"),n.removeAttribute("class"),t.setAttribute("visibility","hidden"),this.frameDrawing.onControlAction(t.id,"0 0")},t.plotColors=["rgba(106,90,205,0.6)","rgba(178,34,34,0.6)","rgba(25,25,112,0.6)","rgba(0,128,128,0.6)","rgba(85,107,47,0.6)","rgba(70,130,180,0.6)","rgba(65,105,225,0.6)"],t.resizing=!1,t.moving=!1,t.scrolling=!1,t}(),Nf=function(){function t(t,e,r,i,n,a,o,s){var l=this;this.prevTouchZoomDistance=0,this.element=t,this.xyrefelement=e,this.ondrag=r,this.onwheel=i,this.ontouchzoomstart=n,this.ontouchzoom=a,this.ignore=o,this.wheelignore=s,this.onEventClosure=function(t){return l.onEvent(t)},this.element.addEventListener("mousedown",this.onEventClosure),this.element.addEventListener("wheel",this.onEventClosure),this.element.addEventListener("touchstart",this.onEventClosure),this.element.addEventListener("touchmove",this.onEventClosure),this.element.addEventListener("touchend",this.onEventClosure)}return t.prototype.onEvent=function(t){if(null==this.ignore||!this.ignore(t)){var e=f.offsetPage(this.xyrefelement);if(t instanceof MouseEvent){var r=t;switch(r.type){case"mousedown":null!=this.ondrag&&1==r.which&&(r.stopPropagation(),r.preventDefault(),this.onDragStart(r.pageX,r.pageY));break;case"wheel":if(null!=this.onwheel){var i=r;if(null==this.wheelignore||!this.wheelignore(i)){i.stopPropagation(),i.preventDefault();var n=i.pageX-e.left,a=i.pageY-e.top;this.onwheel(i,n,a)}}}}else if(f.touchEventExists()&&t instanceof TouchEvent){var o=t,s=void 0,l=void 0,u=void 0,c=void 0;switch(o.touches.length>0&&(s=o.touches[0].pageX-e.left,l=o.touches[0].pageY-e.top),o.touches.length>1&&(u=o.touches[1].pageX-e.left,c=o.touches[1].pageY-e.top),o.type){case"touchstart":o.stopPropagation(),1==o.touches.length?null!=this.ondrag&&this.onDragStart(o.touches[0].pageX,o.touches[0].pageY):(this.prevTouchZoomDistance=Math.hypot(u-s,c-l),null!=this.ontouchzoomstart&&this.ontouchzoomstart(o,this.prevTouchZoomDistance));break;case"touchmove":if(null!=this.ontouchzoom&&o.touches.length>1){o.stopPropagation(),o.preventDefault(),null!=this.dragHandler&&(this.dragHandler.stop(),this.dragHandler=null);var h=Math.hypot(u-s,c-l);if(this.prevTouchZoomDistance>0){var d=(s+u)/2,p=(l+c)/2,m=h/this.prevTouchZoomDistance;this.ontouchzoom(o,d,p,m)}this.prevTouchZoomDistance=h}break;case"touchend":this.prevTouchZoomDistance=0}}}},t.prototype.stop=function(){this.element.removeEventListener("mousedown",this.onEventClosure),this.element.removeEventListener("wheel",this.onEventClosure),this.element.removeEventListener("touchstart",this.onEventClosure),this.element.removeEventListener("touchmove",this.onEventClosure),this.element.removeEventListener("touchend",this.onEventClosure),null!=this.dragHandler&&(this.dragHandler.stop(),this.dragHandler=null)},t.prototype.onDragStart=function(t,e){var r=this;null!=this.dragHandler&&this.dragHandler.stop(),this.dragHandler=new xf(t,e,function(t,e,i){return r.ondrag(t,e,i,r.element)},null,null)},t}(),Bf=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return p.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return p.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return p.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)qf.filterAndSetAttribute(e,r[n],i[n]);t.updateGISMarkupPosition(e),Gf.adjustGISPositionX(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=p.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=f.getFloatAttribute(t,"lon"),n=f.getFloatAttribute(t,"lat"),a=Gf.lonLatToXY(r,i,n);f.setMultipleAttributes(t,["cx","cy"],[a[0],a[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var o=t.getAttribute("lonlatpoints"),s=Gf.lonLatPointsToXYPoints(r,o);t.setAttribute("points",s)}},t}(),Gf=function(){function t(t){this.initialTouchZoomDistance=0,this.currentTouchZoomDistance=0,this.accumulatedZoomWheelDelta=0,this.frameDrawing=t}return t.prototype.createShapeGISMap=function(){var e=this,r=p.cloneElementWithId("shape-gis-map"),i=p.findChildOfType(r,"background");return new Nf(r,i,function(e,r,i,n){return t.onDrag(e,r,i,n)},function(t,r,i){return e.onWheel(t,r,i)},function(t,r){return e.onTouchZoomStart(t,r)},function(t,r,i,n){return e.onTouchZoom(t,r,i,n)},function(e){return t.eventIgnoreCondition(e)},function(e){return t.wheelIgnoreCondition(e)}),r},t.prototype.updateShapeGISMap=function(e,r,i){for(var n=p.findChildOfType(e,"background"),a=p.findChildOfType(e,"map"),o=p.findChildOfType(e,"shadow"),s=p.findChildOfType(e,"border"),l=p.findChildOfType(a,"layers"),u=p.findChildOfType(l,"shapefiles"),c=function(l){switch(r[l]){case"width":case"height":n.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),s.setAttribute(r[l],i[l]);break;case"size-completed":e.getAttribute("zoom")&&t.redrawGISMap(e);break;case"background-color":n.setAttribute("fill",i[l]);break;case"border-color":s.setAttribute("stroke",i[l]);break;case"map-completed":t.redrawGISMap(e);break;case"shapefile":var c=p.createSvgElement("g");c.setAttribute("type","shapefile"),c.setAttribute("name",i[l]),u.appendChild(c),h.frameDrawing.client.network.getResource(i[l],function(e){t.onShapefileLoaded(e,c)});break;case"shapefiles-properties":for(var d=p.childElements(u),m=f.splitSkipEmpty(i[l]," "),g=0;g<d.length;g++)f.setMultipleAttributes(d[g],["visibility","stroke","fill"],m[g].split("|"));break;default:qf.filterAndSetAttribute(e,r[l],i[l])}},h=this,d=0;d<r.length;d++)c(d)},t.redrawGISMap=function(e){t.redrawGISTiles(e),t.redrawGISShapefiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.redrawGISTiles=function(e){var r=p.findChildOfType(e,"background"),i=f.getFloatAttribute(r,"width"),n=f.getFloatAttribute(r,"height"),a=t.minGISZoom(i,n),o=p.findChildOfType(e,"map"),s=p.findChildOfType(o,"layers");s.setAttribute("transform","translate(0,0)");var l=f.getIntAttribute(e,"zoom"),u=f.getFloatAttribute(e,"center-lon"),c=f.getFloatAttribute(e,"center-lat");l<a&&(l=a,e.setAttribute("zoom",l.toString()));var h,d=Math.pow(2,l),m=t.latToTileYFloat(c,l),g=n/2/t.tileImageSize;m-g<0?h=g:d<m+g&&(h=d-g),h&&(c=t.tileYToLat(h,l),e.setAttribute("center-lat",c.toString()));var b=p.findChildOfType(s,"tiles");p.removeAllChildren(b),t.updateGISTiles(b,l,c,u,0,0,i,n,d)},t.updateGISTiles=function(e,r,i,n,a,o,s,l,u){if("false"!=p.findParentOfType(e,"ShapeGISMap").getAttribute("show-tiles")){for(var c=t.lonToTileXInt(n,r),h=t.latToTileYInt(i,r),d=a+s/2-t.lonToXOffsetWithinTile(n,r),m=o+l/2-t.latToYOffsetWithinTile(i,r);d>0;)d-=t.tileImageSize,c--;for(;m>0;)m-=t.tileImageSize,h--;c=f.modulo(c,u),h=f.modulo(h,u);for(var g=[],b=p.childElements(e),v=0;v<b.length;v++)g.push(b[v]);for(var y=c,A=d;A<s;A+=t.tileImageSize){for(var T=h,C=m;C<l;C+=t.tileImageSize){var S=r+"/"+y+"/"+T,E=null;for(v=0;v<g.length;v++)if(g[v].getAttribute("tileid")==S){E=g[v];break}null==E&&(E=t.addGISTile(e,r,y,T)),E.setAttribute("x",(A-a).toString()),E.setAttribute("y",(C-o).toString()),T=f.modulo(T+1,u)}y=f.modulo(y+1,u)}}},t.addGISTile=function(e,r,i,n){var a=p.findParentOfType(e,"ShapeGISMap"),o=t.tileURL(a,r,i,n),s=p.createSvgElement("image");return s.setAttribute("width",t.tileImageSize.toString()),s.setAttribute("height",t.tileImageSize.toString()),s.setAttributeNS(p.xlinkns,"href",o),s.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(s),s},t.onShapefileLoaded=function(e,r){document.body.contains(r)&&(r.innerHTML=e.responseText,t.redrawGISShapefile(r),t.adjustX(r,!0))},t.redrawGISShapefiles=function(e){for(var r=p.findChildOfType(e,"map"),i=p.findChildOfType(r,"layers"),n=p.findChildOfType(i,"shapefiles"),a=p.childElements(n),o=0;o<a.length;o++)t.redrawGISShapefile(a[o]),t.adjustX(a[o],!0)},t.redrawGISShapefile=function(e){for(var r=p.findParentOfType(e,"ShapeGISMap"),i=p.childElements(e),n=0;n<i.length;n++){var a=i[n],o=a.getAttribute("lonlatpoints");switch(a.tagName){case"circle":var s=f.splitToFloats(o,","),l=t.lonLatToXY(r,s[0],s[1]);f.setMultipleAttributes(a,["cx","cy"],[l[0],l[1]]);break;case"polyline":case"polygon":var u=t.lonLatPointsToXYPoints(r,o);a.setAttribute("points",u)}}},t.redrawGISMarkup=function(e){for(var r=p.findChildOfType(e,"map"),i=p.findChildOfType(r,"layers"),n=p.findChildOfType(i,"markup"),a=p.childElements(n),o=0;o<a.length;o++)Bf.updateGISMarkupPosition(a[o]);t.adjustX(n,!0)},t.redrawGISAgents=function(e){for(var r=p.findChildOfType(e,"map"),i=p.findChildOfType(r,"layers"),n=p.findChildOfType(i,"agents"),a=p.childElements(n),o=0;o<a.length;o++)t.updateGISAgentScale(a[o]),"hidden"!=a[o].getAttribute("visibility")&&t.updateGISAgentPosition(a[o]);t.adjustX(n,!0)},t.updateGISAgentPosition=function(e){var r=p.findParentOfType(e,"ShapeGISMap"),i=f.getFloatAttribute(e,"lon"),n=f.getFloatAttribute(e,"lat"),a=f.getFloatAttribute(e,"heading"),o=t.lonLatToXY(r,i,n),s="translate("+o[0]+","+o[1]+") rotate("+a+")",l=e.getAttribute("scale");l&&(s+=" scale("+l+")"),e.setAttribute("transform",s)},t.updateGISAgentScale=function(e){var r=p.findParentOfType(e,"ShapeGISMap"),i=f.getIntAttribute(e,"fixed-scale-zoom");if(i){var n=f.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var a=1;if(f.getIntAttribute(e,"real-scale-zoom")<=n){var o=f.getFloatAttribute(e,"pixels-per-meter"),s=f.getFloatAttribute(e,"lat");a=t.pixelsPerGISMeter(n,s)/o}e.setAttribute("scale",a.toString())}},t.adjustGISPositionX=function(e){t.adjustX(e,!1)},t.adjustX=function(e,r){var i=p.findParentOfType(e,"ShapeGISMap"),n=p.findChildOfType(i,"map"),a=p.findChildOfType(n,"layers"),o=t.svgSize(i),s=f.getIntAttribute(i,"zoom"),l=Math.pow(2,s)*t.tileImageSize,u=f.getFloatAttribute(i,"center-lon"),c=f.parseTransform(a.getAttribute("transform"))[0];if(r)for(var h=p.childElements(e),d=0;d<h.length;d++)t.adjustShapeX(h[d],o[0],u,s,c,l);else t.adjustShapeX(e,o[0],u,s,c,l)},t.adjustShapeX=function(e,r,i,n,a,o){var s=0,l=0,u=0,c=1,h=1;if("hidden"!=e.getAttribute("visibility")){var d;if("circle"==e.tagName)d=f.getFloatAttribute(e,"cx");else if("g"==e.tagName){var p=f.parseTransform(e.getAttribute("transform"));s=p[0],l=p[1],u=p[2],c=p[3],h=p[4],d=s}else{var m=f.getFloatAttribute(e,"minlon"),g=f.getFloatAttribute(e,"maxlon");if(null==m||null==g)return;d=(t.lonToXFast(m,r,i,n)+t.lonToXFast(g,r,i,n))/2}d+=a;var b=Math.abs(d-r/2),v=Math.abs(d+o-r/2),y=Math.abs(d-o-r/2),A=0;v<b?A=o:y<b&&(A=-o);var T=f.constructTransform(s+A,l,u,c,h);null==T?e.removeAttribute("transform"):e.setAttribute("transform",T)}},t.panGIS=function(e,r,i){var n=p.findChildOfType(e,"map"),a=p.findChildOfType(n,"layers"),o=f.parseTransform(a.getAttribute("transform")),s=o[0]+r,l=o[1]+i,u=f.getIntAttribute(e,"zoom"),c=Math.pow(2,u),h=f.getFloatAttribute(e,"center-lon"),d=f.getFloatAttribute(e,"center-lat"),m=t.latToTileYFloat(d,u),g=t.svgSize(e),b=g[1]/2/t.tileImageSize;m-b-l/t.tileImageSize<0?l=(m-b)*t.tileImageSize:c<m+b-l/t.tileImageSize&&(l=(m+b-c)*t.tileImageSize),s=t.normalizedGISX(s,u),s=Math.round(s),l=Math.round(l),a.setAttribute("transform","translate("+s+","+l+")");var v=p.findChildOfType(a,"tiles");t.updateGISTiles(v,u,d,h,s,l,g[0],g[1],c);for(var y=p.findChildOfType(a,"shapefiles"),A=p.childElements(y),T=0;T<A.length;T++)t.adjustX(A[T],!0);var C=p.findChildOfType(a,"markup");t.adjustX(C,!0);var S=p.findChildOfType(a,"agents");t.adjustX(S,!0)},t.zoomGIS=function(e,r,i,n){var a,o=f.getIntAttribute(e,"zoom");if((r=Math.round(r))>0)a=Math.min(o+r,19);else{var s=p.findChildOfType(e,"background"),l=f.getFloatAttribute(s,"width"),u=f.getFloatAttribute(s,"height");a=Math.max(o+r,t.minGISZoom(l,u))}t.setGISZoom(e,i,n,a)},t.setGISZoom=function(e,r,i,n){var a=p.findChildOfType(e,"background"),o=f.getFloatAttribute(a,"width"),s=f.getFloatAttribute(a,"height"),l=p.findChildOfType(e,"map"),u=p.findChildOfType(l,"layers"),c=f.parseTransform(u.getAttribute("transform")),h=t.xyToLonLat(e,r-c[0],i-c[1]),d=t.lonToTileXFloat(h[0],n),m=t.latToTileYFloat(h[1],n),g=Math.pow(2,n);d=f.remainderPositive(d-(r-o/2)/t.tileImageSize,g),m=f.remainderPositive(m-(i-s/2)/t.tileImageSize,g);var b=t.tileXToLon(d,n),v=t.tileYToLat(m,n);f.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,b,v]),t.redrawGISMap(e)},t.eventIgnoreCondition=function(t){return"true"!=t.currentTarget.getAttribute("navigation-enabled")||!!(f.touchEventExists()&&t instanceof TouchEvent&&t.touches.length>2)},t.onDrag=function(e,r,i,n){var a=n,o=t.svgScale(a);t.panGIS(a,r/o[0],i/o[1])},t.wheelIgnoreCondition=function(t){return t.altKey||t.ctrlKey},t.prototype.onWheel=function(e,r,i){var n=this,a=e.currentTarget,o=t.svgScale(a);r/=o[0],i/=o[1],clearTimeout(this.delayedZoomTimeout),this.accumulatedZoomWheelDelta+=e.deltaY<0?1:-1,this.delayedZoomTimeout=setTimeout(function(){n.delayedWheelZoom(a,r,i)},t.zoomDelay)},t.prototype.onTouchZoomStart=function(t,e){this.initialTouchZoomDistance=e,this.currentTouchZoomDistance=e},t.prototype.onTouchZoom=function(e,r,i,n){var a=e.currentTarget,o=t.svgScale(a);r/=o[0],i/=o[1],this.currentTouchZoomDistance*=n;var s=this.currentTouchZoomDistance/this.initialTouchZoomDistance;(s<.8||1.2<s)&&(t.zoomGIS(a,s<1?-1:1,r,i),this.initialTouchZoomDistance=this.currentTouchZoomDistance)},t.prototype.delayedWheelZoom=function(e,r,i){0!=this.accumulatedZoomWheelDelta&&(t.zoomGIS(e,this.accumulatedZoomWheelDelta,r,i),this.accumulatedZoomWheelDelta=0)},t.eventToLonLat=function(e,r){var i=p.findChildOfType(e,"background"),n=f.offsetPage(i),a=t.svgScale(e),o=m.eventPageXY(r),s=(o[0]-n.left)/a[0],l=(o[1]-n.top)/a[1],u=p.findChildOfType(e,"map").firstElementChild,c=f.parseTransform(u.getAttribute("transform"));return t.xyToLonLat(e,s-c[0],l-c[1])},t.xyToLonLat=function(e,r,i){var n=t.svgSize(e),a=f.getIntAttribute(e,"zoom"),o=Math.pow(2,a),s=t.lonToTileXFloat(f.getFloatAttribute(e,"center-lon"),a),l=t.latToTileYFloat(f.getFloatAttribute(e,"center-lat"),a),u=(r-n[0]/2)/t.tileImageSize,c=(i-n[1]/2)/t.tileImageSize,h=f.remainderPositive(s+u,o),d=f.remainderPositive(l+c,o);return[t.tileXToLon(h,a),t.tileYToLat(d,a)]},t.lonLatToXY=function(e,r,i){var n=t.svgSize(e),a=f.getIntAttribute(e,"zoom"),o=t.lonToTileXFloat(f.getFloatAttribute(e,"center-lon"),a),s=t.latToTileYFloat(f.getFloatAttribute(e,"center-lat"),a),l=t.lonToTileXFloat(r,a),u=t.latToTileYFloat(i,a);return[n[0]/2+(l-o)*t.tileImageSize,n[1]/2+(u-s)*t.tileImageSize]},t.lonToXFast=function(e,r,i,n){var a=t.lonToTileXFloat(i,n);return r/2+(t.lonToTileXFloat(e,n)-a)*t.tileImageSize},t.lonLatPointsToXYPoints=function(e,r){for(var i=t.svgSize(e),n=f.getIntAttribute(e,"zoom"),a=t.lonToTileXFloat(f.getFloatAttribute(e,"center-lon"),n),o=t.latToTileYFloat(f.getFloatAttribute(e,"center-lat"),n),s=void 0,l=void 0,u="",c=f.splitSkipEmpty(r," "),h=0;h<c.length;h++){var d=c[h].split(","),p=t.lonToTileXFloat(parseFloat(d[0]),n),m=t.latToTileYFloat(parseFloat(d[1]),n),g=i[0]/2+(p-a)*t.tileImageSize,b=i[1]/2+(m-o)*t.tileImageSize;null!=s&&Math.abs(g-s)<t.gisTolerance&&Math.abs(b-l)<t.gisTolerance||(u+=(g=f.reducePrecision(g))+","+(b=f.reducePrecision(b))+" ",s=g,l=b)}return u},t.svgSize=function(t){var e=p.findChildOfType(t,"background");return[f.getFloatAttribute(e,"width"),f.getFloatAttribute(e,"height")]},t.svgScale=function(e){var r=p.findChildOfType(e,"background"),i=t.svgSize(e),n=r.getBoundingClientRect();return[n.width/i[0],n.height/i[1]]},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return t<-85.05?Math.pow(2,e):t>85.05?0:(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.tileURL=function(e,r,i,n){var a;switch(e.getAttribute("tile-url-provider-type")){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":a=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":a=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":a=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":a=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":a=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":a=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":a=f.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}return a[Math.floor(Math.random()*a.length)].replace("[zoom]",r.toString()).replace("[x]",i.toString()).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=f.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=f.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(f.byteArrayToString(n))},t.gisTolerance=2,t.tileImageSize=256,t.zoomDelay=50,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),Uf=function(){function t(){}return t.createMarkupPipe=function(t){var e=p.cloneElementWithId("markup-pipe"),r=t+"basepath";p.findChildOfType(e,"basepath").firstElementChild.id=r;var i=p.findChildOfType(e,"pipe"),n=p.findChildOfType(e,"inner-pipe"),a=p.findChildOfType(e,"bubbles"),o="#"+r;return i.setAttributeNS(p.xlinkns,"href",o),n.setAttributeNS(p.xlinkns,"href",o),a.setAttributeNS(p.xlinkns,"href",o),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=p.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=p.findChildOfType(t,"batches"),s=p.findChildOfType(t,"bubbles"),l=0;l<e.length;l++)switch(e[l]){case"phase":s.setAttribute("stroke-dashoffset",(12-parseFloat(r[l])).toString());break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=p.childElements(o)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var m=parseInt(r[l]),g=o.childElementCount,b=m;b<g;b++)p.removeElement(o.lastElementChild);for(b=g;b<m;b++)d=p.createUseElement(a),o.appendChild(d);break;case"d":var v=parseFloat(p.findChildOfType(t,"pipe").getAttribute("stroke-width")),y=f.roundPathCorners(r[l],2*v,!1);n.setAttribute("d",y);break;case"width":var A=parseFloat(r[l]);p.findChildOfType(t,"pipe").setAttribute("stroke-width",A.toString()),p.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*A).toString()),o.setAttribute("stroke-width",(.6*A).toString());var T=Math.min(5,.2*A);s.setAttribute("stroke-width",T.toString()),s.setAttribute("stroke-dasharray",T+","+(12-T));break;case"color":p.findChildOfType(t,"pipe").setAttribute("stroke",r[l]);break;case"inner-color":p.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[l]);break;default:qf.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupStorageTank=function(){return p.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=p.findChildOfType(t,"square"),n=p.findChildOfType(t,"batches"),a=parseFloat(i.getAttribute("width")),o=0;o<e.length;o++)switch(e[o]){case"batch":var s=r[o].split(" "),l=parseFloat(s[1])*a,u=parseFloat(s[2])*a,c=p.childElements(n)[parseInt(s[0])];f.setMultipleAttributes(c,["y","height","fill"],[a/2-l-u,u,s[3]]);break;case"newbatches":for(var h=parseInt(r[o]),d=n.childElementCount,m=h;m<d;m++)p.removeElement(n.lastElementChild);for(m=d;m<h;m++)c=p.createSvgElement("rect"),f.setMultipleAttributes(c,["stroke","width","x"],["none",a,-a/2]),n.appendChild(c);break;case"progress":var g=parseFloat(r[o])*Math.PI*2,b=parseFloat(p.findChildOfType(t,"circle").getAttribute("r"))-2,v=b*Math.sin(g),y=-b*Math.cos(g),A="M 0 "+-b+" ";A+="A "+b+" "+b+" 0 "+(g>Math.PI?"1":"0")+" 1 "+v+" "+y,p.findChildOfType(t,"arc").setAttribute("d",A);break;case"radius":p.findChildOfType(t,"circle").setAttribute("r",r[o]),a=Math.max(10,2*parseFloat(r[o])/Math.sqrt(2)-8),f.setMultipleAttributes(i,["width","height","x","y"],[a,a,-a/2,-a/2]);break;case"color":p.findChildOfType(t,"circle").setAttribute("fill",r[o]);break;case"stroke-color":p.findChildOfType(t,"circle").setAttribute("stroke",r[o]),p.findChildOfType(t,"square").setAttribute("stroke",r[o]);break;default:qf.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupBulkConveyorBelt=function(t){var e=p.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";p.findChildOfType(e,"basepath").firstElementChild.id=r;var i=p.findChildOfType(e,"belt"),n=p.findChildOfType(e,"belt-sections"),a="#"+r;return i.setAttributeNS(p.xlinkns,"href",a),n.setAttributeNS(p.xlinkns,"href",a),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=p.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=p.findChildOfType(t,"belt-sections"),s=p.findChildOfType(t,"batches"),l=0;l<e.length;l++)switch(e[l]){case"phase":o.setAttribute("stroke-dashoffset",r[l]);break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=p.childElements(s)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var f=parseInt(r[l]),m=s.childElementCount,g=f;g<m;g++)p.removeElement(s.lastElementChild);for(g=m;g<f;g++)d=p.createUseElement(a),s.appendChild(d);break;case"d":n.setAttribute("d",r[l]);break;case"width":var b=r[l];p.findChildOfType(t,"belt").setAttribute("stroke-width",b),o.setAttribute("stroke-width",b),o.setAttribute("stroke-dasharray","2, 10"),s.setAttribute("stroke-width",(.4*parseFloat(b)).toString());break;case"color":p.findChildOfType(t,"belt").setAttribute("stroke",r[l]);break;case"sections-color":o.setAttribute("stroke",r[l]);break;default:qf.filterAndSetAttribute(t,e[l],r[l])}},t}(),Hf=function(){function t(){}return t.createMarkupPath=function(t,e){var r=p.cloneElementWithId("markup-path"),i=e+"basepath";p.findChildOfType(r,"basepath").firstElementChild.id=i;var n=p.findChildOfType(r,"paths"),a=1;"MarkupPathRoad"==t&&(a=2),"MarkupPathRailroad"==t&&(a=4);for(var o=0;o<a;o++){var s=p.createUseElement(i);n.appendChild(s)}var l=p.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),l.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),p.childElements(n)[1].setAttribute("stroke","black"),p.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=p.findChildOfType(t,"basepath").firstElementChild,a=p.findChildOfType(t,"paths"),o=a.firstElementChild,s=p.findChildOfType(t,"arrows"),l=0;l<e.length;l++)switch(e[l]){case"d":n.setAttribute("d",r[l]);break;case"bidirectional":p.removeAllChildren(s),"false"==r[l]&&f.addPathArrows(n,"arrowhead",1.7,s,50,100);break;case"stroke-width":var u=parseFloat(r[l]);switch(i){case"MarkupPathLine":o.setAttribute("stroke-width",u.toString());break;case"MarkupPathDashline":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",4*u+" "+u);break;case"MarkupPathConveyor":o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",u/2+" "+u/10);break;case"MarkupPathRoad":o.setAttribute("stroke-width",u.toString());var c=a.lastElementChild;c.setAttribute("stroke-width",(u/12).toString()),c.setAttribute("stroke-dasharray",u/2+" "+u/5);break;case"MarkupPathRailroad":var h=u/10+" "+u/2.5;o.setAttribute("stroke-width",u.toString()),o.setAttribute("stroke-dasharray",h),p.childElements(a)[1].setAttribute("stroke-width",(u/2+u/12).toString()),p.childElements(a)[2].setAttribute("stroke-width",(u/2).toString());var d=a.lastElementChild;d.setAttribute("stroke-width",(u/2).toString()),d.setAttribute("stroke-dasharray",h)}break;case"stroke":o.setAttribute("stroke",r[l]),u=parseFloat(o.getAttribute("stroke-width")),s.setAttribute("stroke",u>4?"white":r[l]);break;default:qf.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupAreaNode=function(t){var e,r=p.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=p.createSvgElement("rect");break;case"MarkupPolygonalNode":e=p.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:qf.filterAndSetAttribute(i,e[n],r[n])}},t.createMarkupPalletRack=function(){return p.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"stroke":n.setAttribute(e[a],r[a]);break;case"fill":i.setAttribute(e[a],r[a]);break;case"rack-data":p.removeAllChildren(i),p.removeAllChildren(n);var o=r[a].split(" "),s=parseInt(o[0]),l=parseInt(o[1]),u=parseFloat(o[2]),c=parseFloat(o[3]),h=parseFloat(o[4]),d=void 0,m=void 0,g=void 0;s>1&&(d=parseFloat(o[5]),m=parseFloat(o[6]),g=c+d);var b=p.createSvgElement("rect");if(b.setAttribute("width",u.toString()),b.setAttribute("height",c.toString()),i.appendChild(b),s>1){var v=p.createSvgElement("rect");v.setAttribute("width",u.toString()),v.setAttribute("height",m.toString()),v.setAttribute("transform","translate( 0 "+g+")"),i.appendChild(v)}for(var y=h,A=0;A<l-1;A++){var T=p.createSvgElement("line");f.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,"0",c]),n.appendChild(T),y+=h}if(s>1){var C=g+m;y=h;for(A=0;A<l-1;A++){T=p.createSvgElement("line");f.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,g,C]),n.appendChild(T),y+=h}}break;default:qf.filterAndSetAttribute(t,e[a],r[a])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),zf=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=p.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=p.createSvgElement("path");break;case"MarkupCircularWall":r=p.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=p.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:qf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupTargetLine=function(){return p.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=p.findChildOfType(e,"polyline"),a=p.findChildOfType(e,"serif-start"),o=p.findChildOfType(e,"serif-end"),s=0;s<r.length;s++)switch(r[s]){case"color":e.setAttribute("stroke",i[s]);break;case"points":n.setAttribute(r[s],i[s]);var l=i[s].split(" "),u=l.length;l[u-1].includes(",")||u--,t.setSerif(l[0],l[1],a),t.setSerif(l[u-1],l[u-2],o);break;default:qf.filterAndSetAttribute(e,r[s],i[s])}},t.createMarkupPathway=function(){return p.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=p.findChildOfType(t,"polygon"),n=p.findChildOfType(t,"polyline"),a=p.findChildOfType(t,"ties"),o=0;o<e.length;o++)switch(e[o]){case"color":a.setAttribute("stroke",r[o]);break;case"points":var s=r[o].split(" "),l="",u="",c="";p.removeAllChildren(a);for(var h=0;h<s.length;h++){var d=f.splitToFloats(s[h],",");if(4==d.length){l+=d[0]+","+d[1]+" ",u=d[2]+","+d[3]+" "+u,c+=(d[0]+d[2])/2+","+(d[1]+d[3])/2+" ";var m=p.createSvgElement("line");f.setMultipleAttributes(m,["x1","y1","x2","y2"],[d[0],d[1],d[2],d[3]]),a.appendChild(m)}}i.setAttribute("points",l+u),n.setAttribute("points",c);break;default:qf.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupPedFlowStatistics=function(){return p.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=p.findChildOfType(t,"line"),n=p.findChildOfType(t,"serif-end"),a=p.findChildOfType(t,"direction"),o=p.findChildOfType(t,"arrow-right"),s=p.findChildOfType(t,"arrow-left"),l=0;l<e.length;l++)switch(e[l]){case"color":t.setAttribute("stroke",r[l]);break;case"length":i.setAttribute("x2",r[l]),n.setAttribute("x1",r[l]),n.setAttribute("x2",r[l]);var u=parseInt(r[l])/2;a.setAttribute("x1",u.toString()),a.setAttribute("x2",u.toString()),o.setAttribute("transform","translate("+u+" 13) rotate(90)"),s.setAttribute("transform","translate("+u+" -13) rotate(-90)");break;case"direction":switch(o.setAttribute("visibility","inherit"),s.setAttribute("visibility","inherit"),r[l]){case"right":s.setAttribute("visibility","hidden");break;case"left":o.setAttribute("visibility","hidden")}break;default:qf.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupServiceWithLines=function(){return p.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=p.findChildOfType(e,"queues"),a=p.findChildOfType(e,"services"),o=p.findChildOfType(e,"reverse-queues"),s=p.findChildOfType(e,"area"),l=0;l<r.length;l++)switch(r[l]){case"queue-color":n.setAttribute("stroke",i[l]);break;case"reverse-queue-color":o.setAttribute("stroke",i[l]);break;case"service-color":a.setAttribute("stroke",i[l]);break;case"clear-all-queues":p.removeAllChildren(n),p.removeAllChildren(o);break;case"queue":t.addQueue(n,i[l]);break;case"reverse-queue":t.addQueue(o,i[l]);break;case"clear-services":p.removeAllChildren(a);break;case"service":t.addService(a,i[l]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":s.setAttribute(r[l],i[l]);break;case"pos":case"scale":var u=f.posOrScaleToTransform(s,r[l],i[l]);f.applyTransformAttribute(s,u);break;default:qf.filterAndSetAttribute(e,r[l],i[l])}},t.createMarkupServiceWithArea=function(){return p.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=p.findChildOfType(e,"services"),a=0;a<r.length;a++)switch(r[a]){case"service-color":n.setAttribute("stroke",i[a]);break;case"clear-services":p.removeAllChildren(n);break;case"service":t.addService(n,i[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":case"pos":case"scale":break;default:qf.filterAndSetAttribute(e,r[a],i[a])}},t.createMarkupEscalatorGroup=function(){return p.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=p.findChildOfType(t,"background"),n=p.findChildOfType(t,"escalators"),a=0;a<e.length;a++)switch(e[a]){case"balustrade-color":i.setAttribute("fill",r[a]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[a]?"inherit":"hidden");break;case"dimensions-completed":var o=f.getIntAttribute(t,"number-of-escalators"),s=f.getFloatAttribute(t,"width"),l=f.getFloatAttribute(t,"length"),u=f.getFloatAttribute(t,"left-balustrade-width"),c=f.getFloatAttribute(t,"right-balustrade-width"),h=f.getFloatAttribute(t,"internal-balustrade-width"),d=f.getFloatAttribute(t,"lower-landing-length"),m=u+c+o*s+(o-1)*h,g=d+l+f.getFloatAttribute(t,"upper-landing-length");f.setMultipleAttributes(i,["y","width","height"],[-u,g,m]);for(var b=0;b<o;b++){var v=b*(s+h),y=p.cloneElementWithId("escalator"),A=p.findChildOfType(y,"background");f.setMultipleAttributes(A,["y","width","height"],[v,g,s]);var T=p.findChildOfType(y,"handrail-left"),C=p.findChildOfType(y,"handrail-right");f.setMultipleAttributes(T,["x2","y1","y2"],[g,v,v]),f.setMultipleAttributes(C,["x2","y1","y2"],[g,v+s,v+s]);var S=p.findChildOfType(y,"lower-landing-end"),E=p.findChildOfType(y,"upper-landing-end");f.setMultipleAttributes(S,["x1","x2","y1","y2"],[d,d,v,v+s]),f.setMultipleAttributes(E,["x1","x2","y1","y2"],[d+l,d+l,v,v+s]);var w=p.findChildOfType(y,"stairs");f.setMultipleAttributes(w,["x1","x2","y1","y2","stroke-width"],[d,d+l,v+s/2,v+s/2,s]),n.appendChild(y)}break;case"offsets":var k=f.splitToFloats(r[a]," "),x=p.childElements(n);for(b=0;b<x.length;b++)p.findChildOfType(x[b],"stairs").setAttribute("stroke-dashoffset",(-k[b]).toString());break;default:qf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupDensityMap=function(){for(var t=p.cloneElementWithId("markup-density-map"),e=p.findChildOfType(t,"grid");e.childElementCount<7;)e.appendChild(p.cloneElementWithId("grid-item"));return t},t.updateMarkupDensityMap=function(e,r,i){for(var n=p.findChildOfType(e,"colors"),a=p.findChildOfType(e,"frame"),o=0;o<r.length;o++)switch(r[o]){case"width":case"height":a.setAttribute(r[o],i[o]),t.redrawMarkupDensityMap(e);break;case"critical-density":e.setAttribute(r[o],i[o]),t.redrawMarkupDensityMap(e);break;case"colors":var s=f.splitSkipEmpty(i[o]," ");p.removeAllChildren(n);for(var l=0,u=s;l<u.length;l++){var c=u[l],h=p.createSvgElement("rect");h.setAttribute("fill",c),n.appendChild(h)}t.redrawMarkupDensityMap(e);break;default:qf.filterAndSetAttribute(e,r[o],i[o])}},t.redrawMarkupDensityMap=function(t){var e=p.findChildOfType(t,"colors"),r=p.findChildOfType(t,"frame"),i=p.findChildOfType(t,"grid"),n=f.getFloatAttribute(r,"width"),a=f.getFloatAttribute(r,"height"),o=f.getFloatAttribute(t,"critical-density");if(null!=n&&null!=a&&null!=o){for(var s=a,l=0,u=o/6,c=a/6,h=p.childElements(i),d=0;d<7;d++){var m=h[d],g=m.lastElementChild;f.setMultipleAttributes(g,["x1","y1","x2","y2","stroke"],[n+4,s,0,s,"black"]);var b=m.firstElementChild;f.setMultipleAttributes(b,["x","y","text-anchor","fill"],[n+7,s+3,"start","black"]),b.firstChild.textContent=f.formatNumber(l,2),l+=u,s-=c}var v=e.childElementCount;if(v>0){s=a-(c=a/v);var y=p.childElements(e);for(d=0;d<v;d++)f.setMultipleAttributes(y[d],["y","width","height"],[s,n,c]),s-=c}}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(n[0])-a,l=parseFloat(n[1])-o,u=Math.hypot(s,l),c=3*l/u,h=3*s/u;f.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+c,a-c,o-h,o+h])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(f.getSubAttribute(i,"x")),a=parseFloat(f.getSubAttribute(i,"y")),o=f.radiansToDegrees(parseFloat(f.getSubAttribute(i,"orientation")));if("point"==f.getSubAttribute(i,"type")){(r=p.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+a+")");var s=p.createUseElement("arrowhead-small");s.setAttribute("transform","translate("+(n-11)+" "+a+") rotate("+o+" 11 0)"),t.appendChild(s)}else{(r=p.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+a+") rotate("+o+")");var l=r.firstElementChild.nextElementSibling,u=parseFloat(f.getSubAttribute(i,"length"));if(l.setAttribute("x2",u),"true"==f.getSubAttribute(i,"bidirectional")){var c=r.lastElementChild;c.setAttribute("visibility","inherit"),c.setAttribute("transform","translate("+(u+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=f.splitSkipEmpty(e,"|"),i=f.getSubAttribute(r,"queue-path"),n=p.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),f.addPathArrows(n,"arrowhead-small",.7,t,50,100);var a=f.getSubAttribute(r,"fence-color");if(a)for(var o=[f.getSubAttribute(r,"fence-path-left"),f.getSubAttribute(r,"fence-path-right")],s=0;s<o.length;s++){var l=p.createSvgElement("path");f.setMultipleAttributes(l,["d","stroke","stroke-width","stroke-dasharray"],[o[s],a,"2","none"]),t.appendChild(l)}},t}(),Wf=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return p.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:qf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return p.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)qf.filterAndSetAttribute(t,e[i],r[i])},t}(),Vf=function(){function t(){}return t.createMarkupIntersection=function(){return p.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=p.findChildOfType(t,"lane-connectors"),a=0;a<e.length;a++)switch(e[a]){case"fill":case"d":i.setAttribute(e[a],r[a]);break;case"lane-connector":var o=p.createSvgElement("g"),s=p.createSvgElement("path");s.setAttribute("d",r[a]),o.appendChild(s),f.addPathArrows(s,"arrowhead-tiny",.5,o,20,40),n.appendChild(o);break;case"lane-connector-colors":for(var l=f.splitSkipEmpty(r[a]," "),u=p.childElements(n),c=0;c<u.length;c++)u[c].setAttribute("stroke",l[c]);break;default:qf.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupRoad=function(){return p.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=p.findChildOfType(e,"lanes"),a=p.findChildOfType(e,"delimiters"),o=p.findChildOfType(e,"median"),s=0;s<r.length;s++)switch(r[s]){case"lane-width":n.setAttribute("stroke-width",i[s]);break;case"lane-color":n.setAttribute("stroke",i[s]);break;case"forward-lane":case"backward-lane":var l=p.createSvgElement("path");l.setAttribute("d",i[s]),n.appendChild(l);break;case"lane-delimiter-color":a.setAttribute("stroke",i[s]);break;case"lane-delimiter-width":case"lane-delimiter-style":a.setAttribute(r[s],i[s]);break;case"lane-delimiter":var u=f.getFloatAttribute(a,"lane-delimiter-width"),c=a.getAttribute("lane-delimiter-style");t.addDelimiter(a,u,c,i[s],n.getAttribute("stroke"));break;case"median-color":o.setAttribute("stroke",i[s]);break;case"median-width":case"median-style":o.setAttribute(r[s],i[s]);break;case"median":u=f.getFloatAttribute(o,"median-width"),c=o.getAttribute("median-style"),t.addDelimiter(o,u,c,i[s],n.getAttribute("stroke"));break;default:qf.filterAndSetAttribute(e,r[s],i[s])}},t.addDelimiter=function(t,e,r,i,n){var a=r.includes("DASHED"),o=r.includes("DOUBLE"),s=p.createSvgElement("path");if(s.setAttribute("d",i),s.setAttribute("stroke-width",(o?3*e:e).toString()),a&&s.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(s),o){var l=p.createSvgElement("path");f.setMultipleAttributes(l,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(l)}},t.createMarkupStopLine=function(){return p.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:qf.filterAndSetAttribute(t,e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return p.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:qf.filterAndSetAttribute(t,e[a],r[a])}},t}(),Yf=function(){function t(t){this.control=t}return t.createControlList=function(e){var r=p.cloneElementWithId("control-list");r.setAttribute("always-focused",e.toString());var i=function(e){return t.onControlListMouseEvent(e)};return r.addEventListener("mouseover",i),r.addEventListener("mouseout",i),r.addEventListener("mousedown",i),r.addEventListener("wheel",i),r.addEventListener("touchstart",i),r},t.prototype.updateControlList=function(e,r,i){for(var n=p.findChildOfType(e,"svg"),a=p.findChildOfType(e,"border"),o=p.findChildOfType(n,"background"),s=p.findChildOfType(n,"itemgroup"),l=p.findChildOfType(n,"scrollbargroup"),u="true"==e.getAttribute("always-focused"),c=0;c<r.length;c++)switch(r[c]){case"enabled":e.setAttribute(r[c],i[c]);for(var h="true"==i[c],d=p.childElements(s),m=0;m<d.length;m++)t.updateControlListItemLook(d[m],u,!1);l.setAttribute("class",u?"control-opaque1":"control-opaque0");var g=void 0;g=h?u?"control-border-hover":"control-border":"control-border-disabled",a.setAttribute("class",g);break;case"text-array":p.removeAllChildren(s),s.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var b=f.splitSkipEmpty(i[c],"\n"),v=0,y=0;for(m=0;m<b.length;m++){var A=p.cloneElementWithId("list-item");p.findChildOfType(A,"background").setAttribute("fill",o.getAttribute("fill")),(w=p.findChildOfType(A,"text")).firstChild.textContent=b[m],e.hasAttribute("text-color")&&w.setAttribute("fill",e.getAttribute("text-color")),s.appendChild(A);var T=w.getBBox();v<T.width&&(v=T.width),y<T.height&&(y=T.height)}d=p.childElements(s);var C=Math.max(v+4,f.getFloatAttribute(n,"width")),S=Math.max(20,1.35*y);e.setAttribute("item-height",S.toString());for(m=0;m<d.length;m++)this.setupControlListItem(d[m],S*m,C,S,y);t.updateControlListScrollbar(e);break;case"background-color":o.setAttribute("fill",i[c]);break;case"text-color":e.setAttribute(r[c],i[c]);break;case"font-style":e.style.font=i[c];break;case"width":case"height":n.setAttribute(r[c],i[c]),o.setAttribute(r[c],i[c]),a.setAttribute(r[c],i[c]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[c],i[c]);break;case"value":var E=f.splitSkipEmpty(i[c],"\n");d=p.childElements(s),e.setAttribute("last-clicked","0");for(m=0;m<d.length;m++){A=d[m];var w=p.findChildOfType(A,"text"),k=E.indexOf(w.firstChild.textContent)>=0;A.setAttribute("selected",k),t.updateControlListItemLook(A,u,!1),k&&e.setAttribute("last-clicked",m.toString())}break;default:qf.filterAndSetAttribute(e,r[c],i[c])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*f.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=p.findChildOfType(r,"svg"),n=p.findChildOfType(i,"scrollbargroup"),a=p.findChildOfType(n,"handle");if(e instanceof MouseEvent){var o=e;switch(o.type){case"mouseover":t.onGotFocus(r);break;case"mouseout":r.contains(o.relatedTarget)||t.dragging||t.onLostFocus(r);break;case"mousedown":if(1!=o.which||o.target!=a)return;o.stopPropagation(),o.preventDefault(),t.dragging=!0,new xf(o.pageX,o.pageY,function(e,i,n){var a=t.pageLengthToLines(r,n);t.scrollControlList(r,-a)},function(e){t.dragging=!1,t.onLostFocus(r)},"ns-resize");break;case"wheel":var s=o;s.altKey||s.ctrlKey||(e.stopPropagation(),e.preventDefault(),t.scrollControlList(r,s.deltaY<0?1:-1))}}else if(f.touchEventExists()&&e instanceof TouchEvent){var l=e;if(l.touches.length>1)return;switch(l.type){case"touchstart":if(l.target!=a)return;l.stopPropagation(),l.preventDefault(),t.dragging=!0,t.onGotFocus(r),new xf(l.touches[0].pageX,l.touches[0].pageY,function(e,i,n){var a=t.pageLengthToLines(r,n);t.scrollControlList(r,-a)},function(e){t.dragging=!1},null)}}}},t.onGotFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=p.findChildOfType(e,"border"),i=p.findChildOfType(e,"svg"),n=p.findChildOfType(i,"itemgroup"),a=p.findChildOfType(i,"scrollbargroup"),o=p.childElements(n);if("control-border-hover"!=r.getAttribute("class")){r.setAttribute("class","control-border-hover"),a.setAttribute("class","control-opaque1");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!0,!1)}}},t.onLostFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=p.findChildOfType(e,"border"),i=p.findChildOfType(e,"svg"),n=p.findChildOfType(i,"itemgroup"),a=p.findChildOfType(i,"scrollbargroup"),o=p.childElements(n);r.setAttribute("class","control-border"),a.setAttribute("class","control-opaque0");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!1,!1)}},t.isFocused=function(t){return"control-border-hover"==p.findChildOfType(t,"border").getAttribute("class")},t.scrollControlList=function(t,e){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"itemgroup"),n=i.childElementCount;if(0!=n){var a=f.getFloatAttribute(r,"height"),o=f.getFloatAttribute(t,"item-height"),s=n*o,l=i.getAttribute("transform"),u=f.parseTransform(l)[1];u+=e*o,u=Math.max(-s+a,u),u=Math.min(u,0),u=Math.round(u),i.setAttribute("transform","translate(0,"+u+")");var c=p.findChildOfType(r,"scrollbargroup"),h=p.findChildOfType(c,"handle"),d=f.getFloatAttribute(h,"height"),m=(a/2-u)/s,g=Math.max(2,a*m-d/2);g=Math.min(a-d-2,g),h.setAttribute("y",g.toString())}},t.prototype.setupControlListItem=function(e,r,i,n,a){var o=this,s=p.findChildOfType(e,"background"),l=p.findChildOfType(e,"text");e.setAttribute("transform","translate(0,"+r+")"),f.setMultipleAttributes(s,["width","height"],[i,n]),f.setMultipleAttributes(l,["x","y"],[2,n/2+.3*a]),new m(e,function(r){r instanceof MouseEvent&&t.updateControlListItemLook(e,!0,!0)},function(r){r instanceof MouseEvent&&t.updateControlListItemLook(e,!0,!1)},null,function(t){return o.onControlListItemClickTap(e,t)},null)},t.prototype.onControlListItemClickTap=function(e,r){var i=e.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))if(f.touchEventExists()&&r instanceof TouchEvent&&!t.isFocused(n))t.onGotFocus(n);else{var a=r instanceof MouseEvent&&r.ctrlKey||f.touchEventExists()&&r instanceof TouchEvent,o=r instanceof MouseEvent&&r.shiftKey,s="true"==n.getAttribute("multiple"),l=p.childElements(i),u=f.indexInParent(e),c="true"==e.getAttribute("selected");if(s)if(a)e.setAttribute("selected",String(!c)),t.updateControlListItemLook(e,!0,!0);else if(o){var h=f.getIntAttribute(n,"last-clicked");for(d=0;d<l.length;d++)c=h<=u?h<=d&&d<=u:u<=d&&d<=h,l[d].setAttribute("selected",c),t.updateControlListItemLook(l[d],!0,d==u)}else for(d=0;d<l.length;d++)l[d].setAttribute("selected",d==u),t.updateControlListItemLook(l[d],!0,d==u);else{c=!a||!c;for(var d=0;d<l.length;d++)l[d].setAttribute("selected",d==u&&c),t.updateControlListItemLook(l[d],!0,d==u)}n.setAttribute("last-clicked",u.toString());var m="";for(d=0;d<l.length;d++){if("true"==l[d].getAttribute("selected"))m+=p.findChildOfType(l[d],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,m),f.touchEventExists()&&r instanceof TouchEvent&&t.onLostFocus(n)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=p.findChildOfType(t,"background"),a=p.findChildOfType(t,"text"),o="true"==i.getAttribute("enabled"),s="true"==t.getAttribute("selected");if(!o)return n.setAttribute("class",s?"control-background-selected-disabled":""),void a.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",s?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",s?"control-list-background-selected-hover":""),a.setAttribute("class",s?"control-text-selected-hover":"")):(n.setAttribute("class",s?"control-list-background-selected":""),a.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=p.findChildOfType(e,"svg"),i=p.findChildOfType(r,"scrollbargroup"),n=p.findChildOfType(i,"scrollbar"),a=p.findChildOfType(i,"handle"),o=f.getFloatAttribute(r,"width"),s=f.getFloatAttribute(r,"height"),l=o-f.getFloatAttribute(n,"width");n.setAttribute("x",l.toString()),n.setAttribute("height",s.toString()),a.setAttribute("x",(l+2).toString()),a.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"scrollbargroup"),n=(p.findChildOfType(i,"scrollbar"),p.findChildOfType(i,"handle")),a=f.getFloatAttribute(r,"height"),o=p.findChildOfType(r,"itemgroup").childElementCount,s=0;e=o>0&&a<(s=o*f.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e&&n.setAttribute("height",Math.max(a*(a/s)-4,7).toString())},t.pageLengthToLines=function(t,e){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"scrollbargroup"),n=p.findChildOfType(i,"scrollbar"),a=f.getFloatAttribute(n,"height"),o=e/(n.getBoundingClientRect().height/a),s=p.findChildOfType(r,"itemgroup").childElementCount,l=f.getFloatAttribute(t,"item-height");return o*(s*l/a)/l},t.dragging=!1,t}(),jf=function(){function t(t){var e=this;this.onTextInputForSVGEventClosure=function(t){return e.onTextInputForSVGEvent(t)},this.frameDrawing=t,this.controlList=new Yf(this);var r=document.getElementById("text-input-for-svg-container");r.onmousedown=this.onTextInputForSVGEventClosure,r.onwheel=this.onTextInputForSVGEventClosure,r.onkeydown=this.onTextInputForSVGEventClosure,r.ontouchstart=this.onTextInputForSVGEventClosure,window.addEventListener("resize",this.onTextInputForSVGEventClosure,!1),w.addFullScreenListener(this.onTextInputForSVGEventClosure)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return Sf.createUnsupportedObject("File chooser is not supported in the Cloud mode");case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":t.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":Sf.updateUnsupportedObject(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=p.cloneElementWithId("control-button");return new m(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=p.findChildOfType(e,"background"),a=p.findChildOfType(e,"text"),o=0;o<r.length;o++)switch(r[o]){case"enabled":e.setAttribute(r[o],i[o]);var s="true"==i[o];n.setAttribute("class",s?"control-background":"control-background-disabled"),a.setAttribute("class",s?"control-button-text":"control-text-disabled");break;case"text":a.firstChild.textContent=i[o];break;case"background-color":break;case"text-color":a.setAttribute("fill",i[o]);break;case"font-style":a.style.font=i[o],t.centerControlText(a,n,!0,!0);break;case"width":case"height":var l=parseFloat(i[o])-2;n.setAttribute(r[o],l.toString()),t.centerControlText(a,n,!0,!0);break;default:qf.filterAndSetAttribute(e,r[o],i[o])}},t.onButtonOver=function(t){var e=p.findChildOfType(t,"background"),r=p.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=p.findChildOfType(t,"background"),r=p.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=p.findChildOfType(t,"background"),r=p.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.onControlAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=p.cloneElementWithId("control-checkbox");return new m(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=p.findChildOfType(e,"background"),a=p.findChildOfType(e,"box"),o=p.findChildOfType(e,"check"),s=p.findChildOfType(e,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-checkbox-box":"control-checkbox-box-disabled"),o.setAttribute("class",u?"control-checkbox-check":"control-checkbox-check-disabled"),s.setAttribute("class",u?"":"control-text-disabled");break;case"text":s.firstChild.textContent=i[l];break;case"background-color":n.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":s.style.font=i[l],t.centerControlText(s,n,!1,!0);break;case"width":n.setAttribute(r[l],i[l]);break;case"height":n.setAttribute(r[l],i[l]);var c=parseFloat(i[l]);a.setAttribute("y",(c/2-8).toString()),o.setAttribute("transform","translate(0,"+(c/2-8)+")"),t.centerControlText(s,n,!1,!0);break;case"value":o.setAttribute("visibility","true"==i[l]?"inherit":"hidden");break;default:qf.filterAndSetAttribute(e,r[l],i[l])}},t.onCheckboxOver=function(t){var e=p.findChildOfType(t,"box"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=p.findChildOfType(t,"box"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=p.findChildOfType(t,"box"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=p.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.onControlAction(t.id,r)},t.prototype.createSlider=function(){var t=this,e=p.cloneElementWithId("control-slider"),r=function(e){return t.onSliderEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e},t.updateSlider=function(e,r,i){for(var n=p.findChildOfType(e,"background"),a=p.findChildOfType(e,"line"),o=p.findChildOfType(e,"progress"),s=p.findChildOfType(e,"handle"),l=(p.findChildOfType(e,"value"),0);l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-background":"control-background-disabled"),o.setAttribute("class",u?"control-slider-progress":"control-background-selected-disabled"),s.setAttribute("class",u?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":n.setAttribute("fill",i[l]);break;case"width":case"height":n.setAttribute(r[l],i[l]);break;case"vertical":e.setAttribute(r[l],i[l]);var c=f.getFloatAttribute(n,"width"),h=f.getFloatAttribute(n,"height"),d=void 0,m=void 0,g=void 0,b=void 0,v=void 0,y=void 0,A=void 0,T=void 0,C=void 0,S=void 0;"false"==i[l]?(v=d=0,y=m=h/2-2,g=c,A=0,T=b=4,C=0,S=h/2):(v=d=c/2-2,m=0,y=h,A=g=4,b=h,T=0,C=c/2,S=h),f.setMultipleAttributes(a,["x","y","width","height"],[d,m,g,b]),f.setMultipleAttributes(o,["x","y","width","height"],[v,y,A,T]),f.setMultipleAttributes(s,["cx","cy"],[C,S]);break;case"value":var E=f.getFloatAttribute(e,"min"),w=f.getFloatAttribute(e,"max");c=f.getFloatAttribute(n,"width"),h=f.getFloatAttribute(n,"height");var k="true"==e.getAttribute("vertical")?h:c,x=(parseFloat(i[l])-E)/(w-E)*k;t.setSliderHandlePosition(e,x);break;default:qf.filterAndSetAttribute(e,r[l],i[l])}},t.prototype.onSliderEvent=function(e){var r=this,i=e.currentTarget;if("false"!=i.getAttribute("enabled")){var n=p.findChildOfType(i,"background"),a=p.findChildOfType(i,"progress"),o=f.getFloatAttribute(n,"width"),s=f.getFloatAttribute(n,"height"),l=n.getBoundingClientRect(),u=l.width/o,c=l.height/s,h=f.offsetPage(n),d="true"==i.getAttribute("vertical");if(e instanceof MouseEvent){var m=e,g=(m.pageX-h.left)/u,b=(m.pageY-h.top)/c,v=d?s-b:g;switch(m.type){case"mouseover":t.onSliderOver(i);break;case"mouseout":i.contains(m.relatedTarget)||t.sliderDragging||t.onSliderOut(i);break;case"mousedown":if(1!=m.which)return;m.stopPropagation(),m.preventDefault(),t.sliderDragging=!0,t.onSliderHandleGrabbed(i,v),new xf(m.pageX,m.pageY,function(e,r,n){var o=f.getFloatAttribute(a,d?"height":"width");t.setSliderHandlePosition(i,o+(d?-n/c:r/u))},function(e){t.sliderDragging=!1,r.onSliderHandleReleased(i),t.onSliderOut(i)},d?"ns-resize":"ew-resize");break;case"wheel":var y=m;if(!m.altKey&&!m.ctrlKey){e.stopPropagation(),e.preventDefault();var A=f.getFloatAttribute(a,d?"height":"width");t.setSliderHandlePosition(i,A+(y.deltaY<0?1:-1)),this.confirmSliderValue(i)}}}else if(f.touchEventExists()&&e instanceof TouchEvent){var T=e;if(T.touches.length>1)return this.onSliderHandleReleased(i),void t.onSliderOut(i);g=void 0,b=void 0;g=(T.touches[0].pageX-h.left)/u,b=(T.touches[0].pageY-h.top)/c;v=d?s-b:g;switch(e.type){case"touchstart":T.stopPropagation(),T.preventDefault(),t.sliderDragging=!0,t.onSliderOver(i),t.onSliderHandleGrabbed(i,v),new xf(T.touches[0].pageX,T.touches[0].pageY,function(e,r,n){var o=f.getFloatAttribute(a,d?"height":"width");t.setSliderHandlePosition(i,o+(d?-n/c:r/u))},function(e){t.sliderDragging=!1,r.onSliderHandleReleased(i),t.onSliderOut(i)},null)}}}},t.onSliderOver=function(e){var r=p.findChildOfType(e,"line"),i=p.findChildOfType(e,"progress"),n=p.findChildOfType(e,"handle"),a=p.findChildOfType(e,"value");r.setAttribute("class","control-slider-line-hover"),i.setAttribute("class","control-fill-color-transition"),n.setAttribute("class",t.sliderDragging?"control-slider-handle-pressed":"control-slider-handle-hover"),a.setAttribute("class","control-opaque1")},t.onSliderOut=function(t){var e=p.findChildOfType(t,"line"),r=p.findChildOfType(t,"progress"),i=p.findChildOfType(t,"handle"),n=p.findChildOfType(t,"value");e.setAttribute("class","control-background"),r.setAttribute("class","control-slider-progress"),i.setAttribute("r","8"),i.setAttribute("class","control-slider-handle"),n.setAttribute("class","control-opaque0")},t.onSliderHandleGrabbed=function(e,r){var i=p.findChildOfType(e,"handle");i.setAttribute("r","7"),i.setAttribute("class","control-slider-handle-pressed"),t.setSliderHandlePosition(e,r)},t.prototype.onSliderHandleReleased=function(t){var e=p.findChildOfType(t,"handle");e.setAttribute("r","8"),e.setAttribute("class","control-slider-handle-hover"),this.confirmSliderValue(t)},t.setSliderHandlePosition=function(t,e){var r=p.findChildOfType(t,"background"),i=p.findChildOfType(t,"progress"),n=p.findChildOfType(t,"handle"),a=p.findChildOfType(t,"value"),o=f.getFloatAttribute(r,"width"),s=f.getFloatAttribute(r,"height"),l="true"==t.getAttribute("vertical"),u=l?s:o;e=Math.min(u,Math.max(e,0));var c,h=f.getFloatAttribute(t,"min"),d=f.getFloatAttribute(t,"max"),m=f.getFloatAttribute(t,"step");c=m>0?h+Math.round(e/u*(d-h)/m)*m:h+e/u*(d-h),e=((c=Math.min(c,d))-h)/(d-h)*u,l?(i.setAttribute("y",(u-e).toString()),i.setAttribute("height",e.toString()),n.setAttribute("cy",(u-e).toString())):(i.setAttribute("width",e.toString()),n.setAttribute("cx",e.toString()));var g=a.firstElementChild,b=a.lastElementChild;b.firstChild.textContent=f.formatNumber(c,2);var v=b.getComputedTextLength()+10;g.setAttribute("width",v.toString()),g.setAttribute("x",(5-v).toString());var y=l?o/2-9:e-14,A=l?s-e-15-10:s/2-15-4;a.setAttribute("transform","translate("+y+","+A+")"),t.setAttribute("current-value",c)},t.prototype.confirmSliderValue=function(t){var e=f.getFloatAttribute(t,"current-value");e!=f.getFloatAttribute(t,"last-value")&&(this.frameDrawing.onControlAction(t.id,e),t.setAttribute("last-value",e.toString()))},t.createRadioButtonGroup=function(){return p.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"enabled":e.setAttribute(r[a],i[a]);for(var o="true"==i[a],s=p.childElements(e),l=0;l<s.length;l++){var u=s[l],c=p.findChildOfType(u,"circle"),h=p.findChildOfType(u,"check"),d=p.findChildOfType(u,"text");c.setAttribute("class",o?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),h.setAttribute("class",o?"control-radiobutton-check":"control-text-disabled"),d.setAttribute("class",o?"":"control-text-disabled")}break;case"text-array":var g=i[a].split("\n"),b=function(r){var i=p.cloneElementWithId("radio-button"),a=p.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var o=p.findChildOfType(i,"text");o.firstChild.textContent=g[r],e.hasAttribute("text-color")&&o.setAttribute("fill",e.getAttribute("text-color")),new m(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(l=0;l<g.length;l++)b(l);break;case"background-color":case"text-color":e.setAttribute(r[a],i[a]);break;case"font-style":e.style.font=i[a];break;case"width":case"height":e.setAttribute(r[a],i[a]);break;case"vertical":var v=f.getFloatAttribute(e,"width"),y=f.getFloatAttribute(e,"height"),A=0;s=p.childElements(e);for(l=0;l<s.length;l++){u=s[l];var T=p.findChildOfType(u,"background"),C=(d=p.findChildOfType(u,"text")).getBBox();if("true"==i[a]){var S=Math.max(25,1.5*C.height);u.setAttribute("transform","translate(0,"+S*l+")"),f.setMultipleAttributes(T,["width","height"],[v,S])}else{var E=20+C.width+10;u.setAttribute("transform","translate("+A+",0)"),f.setMultipleAttributes(T,["width","height"],[E,y]),A+=E}t.centerRadioButton(u)}break;case"value":var w=parseInt(i[a]);s=p.childElements(e);for(l=0;l<s.length;l++){u=s[l];(h=p.findChildOfType(u,"check")).setAttribute("visibility",w==l?"inherit":"hidden")}break;default:qf.filterAndSetAttribute(e,r[a],i[a])}},t.onRadioButtonOver=function(t){var e=p.findChildOfType(t,"circle"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=p.findChildOfType(t,"circle"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=p.findChildOfType(t,"circle"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=p.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=p.childElements(r),n=0;n<i.length;n++){var a=i[n];p.findChildOfType(a,"check").setAttribute("visibility",a==t?"inherit":"hidden"),a==t&&(e=n)}this.frameDrawing.onControlAction(r.id,e)}},t.centerRadioButton=function(e){var r=p.findChildOfType(e,"background"),i=p.findChildOfType(e,"circle"),n=p.findChildOfType(e,"check"),a=p.findChildOfType(e,"text"),o=f.getFloatAttribute(r,"height");i.setAttribute("cy",(o/2).toString()),n.setAttribute("cy",(o/2).toString()),t.centerControlText(a,r,!1,!0)},t.createListBox=function(){return Yf.createControlList(!1)},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var e=this,r=p.cloneElementWithId("control-combobox");new m(r,function(t){return e.onComboBoxEvent(r,"over",t)},function(t){return e.onComboBoxEvent(r,"out",t)},function(t){return e.onComboBoxEvent(r,"down",t)},function(t){return e.onComboBoxEvent(r,"click",t)},function(e){return t.isDisabled(r)});var i=Yf.createControlList(!0);return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),r.appendChild(i),r},t.prototype.updateComboBox=function(e,r,i){for(var n=p.findChildOfType(e,"svg"),a=p.findChildOfType(e,"border"),o=p.findChildOfType(e,"dropdown"),s=p.findChildOfType(n,"background"),l=p.findChildOfType(n,"text"),u=p.findChildOfType(n,"arrowback"),c=p.findChildOfType(n,"arrow"),h=0;h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var d="true"==i[h];l.setAttribute("class",d?"":"control-text-disabled"),a.setAttribute("class",d?"control-border":"control-border-disabled"),d||o.setAttribute("visibility","hidden"),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-array":var m=f.splitSkipEmpty(i[h],"\n"),g=m.length>0?m[0]:"";l.firstChild.textContent=g,this.controlList.updateControlList(o,[r[h]],[i[h]]),this.controlList.adjustControlListHeightToItems(o,5),this.controlList.updateControlList(o,["value"],[g]);break;case"background-color":s.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-color":l.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"font-style":e.style.font=i[h],t.centerControlText(l,s,!1,!0),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"width":case"height":var b=parseFloat(i[h]);if(n.setAttribute(r[h],i[h]),s.setAttribute(r[h],i[h]),a.setAttribute(r[h],i[h]),"width"==r[h])u.setAttribute("x",(b-20).toString()),this.controlList.updateControlList(o,[r[h]],[i[h]]);else{t.centerControlText(l,s,!1,!0),u.setAttribute("height",b.toString()),o.setAttribute("transform","translate(0,"+i[h]+")");var v=5*parseFloat(i[h]);this.controlList.updateControlList(o,["height"],[v.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var y=f.getFloatAttribute(n,"width")-10,A=f.getFloatAttribute(n,"height")/2;c.setAttribute("transform","translate("+y+","+A+")")}break;case"editable":e.setAttribute(r[h],i[h]);break;case"value":l.firstChild.textContent=i[h],this.controlList.updateControlList(o,[r[h]],[i[h]]);break;default:qf.filterAndSetAttribute(e,r[h],i[h])}},t.prototype.onComboBoxEvent=function(t,e,r){var i=p.findChildOfType(t,"svg"),n=p.findChildOfType(t,"border"),a=p.findChildOfType(t,"dropdown"),o=p.findChildOfType(i,"background"),s=p.findChildOfType(i,"text"),l=p.findChildOfType(i,"arrowback"),u=p.findChildOfType(i,"arrow"),c="true"==t.getAttribute("editable");switch(e){case"over":r instanceof MouseEvent&&(n.setAttribute("class","control-border-hover"),l.setAttribute("class","control-combobox-arrow-background-hover"),u.setAttribute("class","control-fill-color-transition"));break;case"out":r instanceof MouseEvent&&(n.setAttribute("class","control-border"),l.setAttribute("class","control-fill-transparent-transition"),u.setAttribute("class","control-fill-transparent-transition"),a.setAttribute("visibility","hidden"));break;case"down":!c||r.target!=o&&r.target!=s||this.displayTextInputForSVG(t,"left");break;case"click":if(c&&r.target!=l&&r.target!=u)this.displayTextInputForSVG(t,"left");else{r.stopPropagation(),r.preventDefault(),p.bringElementToFront(t);var h="inherit"==a.getAttribute("visibility");a.setAttribute("visibility",h?"hidden":"inherit")}}},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(t,"dropdown"),n=p.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var a=e.split("\n")[0];n.firstChild.textContent=a,this.frameDrawing.onControlAction(t.id,a)},t.prototype.createTextField=function(){var e=this,r=p.cloneElementWithId("control-textfield");return new m(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r)},function(t){return e.onTextFieldDown(r)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=p.findChildOfType(e,"svg"),a=p.findChildOfType(e,"border"),o=p.findChildOfType(n,"background"),s=p.findChildOfType(n,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];s.setAttribute("class",u?"":"control-text-disabled"),a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":e.style.font=i[l],t.centerControlText(s,o,!1,!0);break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),"width"==r[l]&&s.setAttribute("x",(parseFloat(i[l])-2).toString()),t.centerControlText(s,o,!1,!0);break;case"value":s.firstChild.textContent=i[l];break;default:qf.filterAndSetAttribute(e,r[l],i[l])}},t.onTextFieldOver=function(t){p.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){p.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t){this.displayTextInputForSVG(t,"right")},t.createProgressBar=function(){return p.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,a=p.findChildOfType(n,"background"),o=p.findChildOfType(n,"progress"),s=p.findChildOfType(n,"text"),l=p.findChildOfType(n,"border"),u=0;u<r.length;u++)switch(r[u]){case"background-color":a.setAttribute("fill",i[u]);break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":e.style.font=i[u],t.centerControlText(s,a,!1,!0);break;case"width":case"height":e.setAttribute(r[u],i[u]);break;case"vertical":var c="true"==i[u],h=e.getAttribute(c?"height":"width"),d=e.getAttribute(c?"width":"height");a.setAttribute("width",h),a.setAttribute("height",d),o.setAttribute("height",d),t.centerControlText(s,a,!0,!0),l.setAttribute("width",h),l.setAttribute("height",d),c&&n.setAttribute("transform","translate(0,"+h+") rotate(-90)");break;case"text":s.firstChild.textContent="null"==i[u]?"":i[u];break;case"value":var m=f.getFloatAttribute(a,"width");"null"==i[u]?(o.setAttribute("class","control-progressbar-indeterminate"),o.setAttribute("width",m.toString())):(o.setAttribute("class","control-slider-progress"),o.setAttribute("width",(parseFloat(i[u])*m).toString()));break;default:qf.filterAndSetAttribute(e,r[u],i[u])}},t.prototype.displayTextInputForSVG=function(t,e){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"text"),n=document.getElementById("text-input-for-svg-container");n.style.display="block";var a=r.getBoundingClientRect(),o=f.getFloatAttribute(r,"width"),s=f.getFloatAttribute(r,"height"),l=a.width/o,u=n.firstElementChild;u.style.left=a.left+"px",u.style.top=a.top+"px",u.style.width=o+"px",u.style.height=s+"px",u.style.transform="scale("+l+")",u.style.font=t.style.font,u.style.textAlign=e,u.value=i.firstChild.textContent,n.setAttribute("control-id",t.id),window.setTimeout(function(){u.focus(),u.select()},0)},t.prototype.onTextInputForSVGEvent=function(t){var e=document.getElementById("text-input-for-svg-container"),r=e.firstElementChild,i=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=r?i=!0:t.stopPropagation();break;case"keydown":var n=t;"Enter"!=n.code&&"Escape"!=n.code&&"Tab"!=n.code||(i=!0);break;default:i=!0}if(i){var a=e.getAttribute("control-id");null!=a&&(e.style.display="none",e.removeAttribute("control-id"),this.onTextInputForSVGChanged(a,r.value))}},t.prototype.onTextInputForSVGChanged=function(t,e){var r=document.getElementById(t),i=p.findChildOfType(r,"svg");if(p.findChildOfType(i,"text").firstChild.textContent=e,this.frameDrawing.onControlAction(t,e),"ControlComboBox"==r.getAttribute("type")){var n=p.findChildOfType(r,"dropdown");this.controlList.updateControlList(n,["value"],[e])}},t.centerControlText=function(t,e,r,i){var n=f.getFloatAttribute(e,"width"),a=f.getFloatAttribute(e,"height"),o=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*o.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.onControlAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t.sliderDragging=!1,t}(),Xf=function(){function t(){}return t.create=function(t){var e=p.createSvgElement("rect"),r=p.createCanvas(t,"canvas-group-3d");return e.setAttribute("stroke","none"),e.setAttribute("fill","gray"),Yp.getWorld().createCanvas3D(t,r),e},t.update=function(e,r,i){for(var n=e,a=document.getElementById(e.id+"canvas"),o=0;o<r.length;o++)switch(r[o]){case"width":case"height":n.setAttribute(r[o],i[o]),t.syncCanvas3DPosition(a);break;default:qf.filterAndSetAttribute(e,r[o],i[o]),"pos"==r[o]||"scale"==r[o]?t.syncCanvas3DPosition(a):"visibility"==r[o]&&(a.style.visibility=i[o],t.syncCanvas3DPosition(a))}},t.syncCanvas3DPosition=function(t){var e=parseInt(t.id),r=document.getElementById(e.toString());if(null!=r.getAttribute("height")&&null!=r.getAttribute("width")){var i=r.getBoundingClientRect(),n=t.parentNode.getBoundingClientRect(),a=i.left-n.left,o=i.top-n.top;t.style.left=a+"px",t.style.top=o+"px";var s=Math.round(i.width),l=Math.round(i.height);if((s!=t.width||l!=t.height)&&(t.width=s,t.height=l,t.style.width=s+"px",t.style.height=l+"px",!Yp.getWorld().active)){var u=t.getContext("2d");u.fillStyle="rgba(255,0,0,0.2)",u.fillRect(0,0,t.width,t.height)}var c="inherit"!==t.style.visibility||a>n.width||o>n.height||a+s<0||o+l<0;Yp.getWorld().updateCanvasSize(t,!c)}},t.syncAllCanvas3DPositions=function(){for(var e=document.getElementById("canvas-group-3d").children,r=0,i=[].slice.call(e);r<i.length;r++){var n=i[r];n instanceof HTMLCanvasElement&&t.syncCanvas3DPosition(n)}},t}(),qf=function(){function t(e){this.serverFPS=t.MAX_FPS,this.client=e,this.shapeComposite=new Sf(this),this.shapeGISMap=new Gf(this),this.shapeModelPrimitives=new kf(this),this.chart=new Rf(this),this.control=new jf(this),this.shapeInspect=new Df(this),this.world3d=Yp.getWorld()}return t.prototype.start=function(){this.frameDrawStartTime=Date.now(),this.catchingUp=!1,this.frameCount=0,this.fpsMeasureStartTime=null,this.actualFPS=0,this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.fullFrame=!1,this.packetFPS=t.MAX_FPS,this.desiredFPS=t.MAX_FPS,this.frameBuffer=[],this.sleepTimeStatistics=new Array(t.SLEEP_TIME_STATISTICS_SIZE),this.sleepTimeStatistics.fill(1e3/t.MAX_FPS),this.startMeasureInterval(),this.startFrameDrawingTimeout(this.desiredFPS),this.world3d.networkManager=this.client.network},t.prototype.stop=function(){this.modelSettings={},this.navigationSettings={},this.packetBuffer=[],this.frameBuffer=[],this.stopMeasureInterval(),this.stopFrameDrawingTimeout(),this.world3d.deactivate()},t.prototype.startMeasureInterval=function(){var t=this;this.fpsMeasureIntervalId=setInterval(function(){return t.measureFPS()},1e3)},t.prototype.stopMeasureInterval=function(){this.fpsMeasureIntervalId&&(clearInterval(this.fpsMeasureIntervalId),this.fpsMeasureIntervalId=void 0)},t.prototype.startFrameDrawingTimeout=function(t){var e=this;this.frameDrawingTimeoutId=setTimeout(function(){var t=Date.now();e.drawFrame();var r=1e3/e.desiredFPS-(Date.now()-t);r<0&&(r=0),e.sleepTimeStatistics.push(r),e.sleepTimeStatistics.shift(),e.startFrameDrawingTimeout(r)},t)},t.prototype.stopFrameDrawingTimeout=function(){this.frameDrawingTimeoutId&&(clearTimeout(this.frameDrawingTimeoutId),this.frameDrawingTimeoutId=void 0)},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.totalFrameCount=function(){var t=this.frameBuffer.length;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.findOrRequestFullFrame=function(){if(this.fullFrame)console.log("Found a full frame in the local buffer, starting from there");else{for(var t=0;t<this.packetBuffer.length;t++){if(this.packetBuffer[t].fullFrame)return console.log("Found a full frame in the local buffer, starting from there"),void this.packetBuffer.splice(0,t)}this.packetBuffer=[],console.log("Cleared local frame buffer, requesting full frame from the server"),this.client.network.requestAndWaitFullFrame()}},t.prototype.switchToNextFrame=function(){if(0==this.frameBuffer.length){if(0==this.packetBuffer.length)return this.fullFrame=!1,this.packetFPS=t.MAX_FPS,void(this.desiredFPS=t.MAX_FPS);var e=this.packetBuffer.shift();this.frameBuffer=e.frames,this.fullFrame=e.fullFrame,this.packetFPS=e.fps,this.desiredFPS=e.fps,this.updateServerFpsIfNeeded()}return this.frameBuffer.shift()},t.prototype.updateServerFpsIfNeeded=function(){var e=this.actualFPS/this.packetFPS,r=this.measureSleepTime();if(e>=.9&&r>50&&this.serverFPS<t.MAX_FPS)return this.serverFPS++,void this.client.network.postMaxFPS(this.serverFPS);e<.9&&r<50&&this.serverFPS>1&&(this.serverFPS--,e<.7&&this.serverFPS>1&&this.serverFPS--,e<.6&&this.serverFPS>1&&this.serverFPS--,this.client.network.postMaxFPS(this.serverFPS))},t.prototype.measureSleepTime=function(){for(var t=0,e=0;e<this.sleepTimeStatistics.length;e++)t+=this.sleepTimeStatistics[e];return t/=this.sleepTimeStatistics.length},t.prototype.drawFrame=function(){var e=this,r=this.switchToNextFrame();if(r){this.client.updateExperimentState(r),this.world3d.applyFrame(r),this.fullFrame&&(this.fullFrame=!1,p.removeAllChildren(this.client.presentation)),this.frameDrawStartTime=Date.now(),this.client.svg.suspendRedraw(5e3),this.time=r.time;var i,n,a,o=r.commands;if(o.length>0&&"white"!=this.client.svg.style.backgroundColor&&(this.client.svg.style.backgroundColor="white"),Qf.DEBUG_MODE){var s=this.totalFrameCount();this.client.debugger.timeInfo.innerHTML=f.formatNumber(this.time,2),this.client.debugger.serverQueueInfo.innerHTML=this.client.network.serverQueue,this.client.debugger.browserQueueInfo.innerHTML=s+":"+this.client.network.packetManager.totalFrameCount(),i=0,n=0,a=0}for(var l=function(r){var s,l=o[r],c=void 0,h=l.att,d=l.val;switch(l.cmd){case"C":var g=f.getAttributeValue(h,d,"shape-type"),b=f.getAttributeValue(h,d,"owner-id"),v=f.getAttributeValue(h,d,"add-after"),y=null!=f.getAttributeValue(h,d,"has-click-handler");if(f.getAttributeValue(h,d,"draw-mode").includes("2D")||(g="Shape3DOnly"),s=u.createShape(g,l.id),"null"==b)u.client.presentation.appendChild(s);else{if(null==(c=document.getElementById(b)))return console.log("Can't find container to add a shape to, container id = "+b,l),u.findOrRequestFullFrame(),{value:void 0};if("ShapeGISMap"==c.getAttribute("type")){var A=p.findChildOfType(c,"map").firstElementChild;c=g.startsWith("MarkupGIS")?p.findChildOfType(A,"markup"):p.findChildOfType(A,"agents")}if("null"==v){var T=c.firstElementChild;null==T?c.appendChild(s):c.insertBefore(s,T)}else{if(c.lastElementChild.id==v)c.appendChild(s);else{var C=document.getElementById(v);if(null==C)return console.log("Can't find element to add after, el id = "+v,l),u.findOrRequestFullFrame(),{value:void 0};if(!c.contains(C))return console.log("the element to add after not found in group, el id = "+v,l),u.findOrRequestFullFrame(),{value:void 0};var S=C.nextElementSibling;c.insertBefore(s,S)}}}y&&"ShapeInspect"!=g&&(new m(s,function(e){return t.onClickableShapeOverOut(s,!0)},function(e){return t.onClickableShapeOverOut(s,!1)},null,function(t){return e.onClickableShapeClick(s,t)},null),"ShapeGISMap"!=g&&(s.style.pointerEvents="visible")),u.updateShape(s,h,d),i++;break;case"U":if(null==(s=document.getElementById(l.id)))return console.log("Can't find shape to be updated, shape id = "+l.id,l),u.findOrRequestFullFrame(),{value:void 0};u.updateShape(s,h,d),n++;break;case"D":if(null==(s=document.getElementById(l.id)))return console.log("Can't find shape to be deleted, shape id = "+l.id,l),u.findOrRequestFullFrame(),{value:void 0};p.removeElement(s),a++;break;case"S":u.applySettings(h,d);break;case"N":u.applyNavigation(h,d);break;case"M":t.showMessage(h,d);break;case"W":t.openURL(h,d);break;default:return u.client.stopAndAlert("Unknown command: "+l.cmd,null),{value:void 0}}},u=this,c=0;c<o.length;c++){var h=l(c);if("object"==typeof h)return h.value}this.client.svg.unsuspendRedrawAll(),this.frameCount++,Qf.DEBUG_MODE&&(this.client.debugger.cudCountInfo.innerHTML=i+"/"+n+"/"+a,this.client.debugger.drawTimeInfo.innerHTML=Date.now()-this.frameDrawStartTime,this.client.debugger.shapeCountInfo.innerHTML=p.getElementCount().toString()),!this.catchingUp&&this.packetBuffer.length>1?(this.catchingUp=!0,this.desiredFPS=1e3/this.packetFPS*.8):this.catchingUp&&(this.catchingUp=!1,this.desiredFPS=1e3/this.packetFPS)}},t.prototype.createShape=function(t,e){var r;if(p.isPrimitiveSVGElement(t))r=p.createSvgElement(t);else switch(t){case"Shape3DOnly":r=p.cloneElementWithId("3d-only-shape");break;case"ShapeArc":r=Sf.createShapeArc();break;case"ShapeText":r=Sf.createShapeText();break;case"ShapeImage":r=Sf.createShapeImage();break;case"ShapeCanvas":r=Sf.createShapeCanvas(e);break;case"ShapeCAD":r=Sf.createShapeCAD();break;case"ShapeSVG":r=Sf.createShapeSVG();break;case"ShapeModelPrimitives":r=kf.create();break;case"ShapeInspect":r=this.shapeInspect.create();break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=Hf.createMarkupPath(t,e);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=Hf.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=Hf.createMarkupPalletRack();break;case"MarkupRailwaySwitch":r=Wf.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=Wf.createMarkupPositionOnTrack();break;case"MarkupPipe":r=Uf.createMarkupPipe(e);break;case"MarkupStorageTank":r=Uf.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=Uf.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=zf.createMarkupWall(t,e);break;case"MarkupTargetLine":r=zf.createMarkupTargetLine();break;case"MarkupPathway":r=zf.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=zf.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=zf.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=zf.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=zf.createMarkupEscalatorGroup();break;case"MarkupDensityMap":r=zf.createMarkupDensityMap();break;case"MarkupIntersection":r=Vf.createMarkupIntersection();break;case"MarkupRoad":r=Vf.createMarkupRoad();break;case"MarkupStopLine":r=Vf.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=Vf.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=Bf.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=Rf.create();break;case"Window3D":r=Xf.create(e);break;default:return this.client.stopAndAlert("Can't create: unknown object type: "+t,void 0),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(e,r,i){var n=e.getAttribute("type");if("Shape3DOnly"!=n)if(p.isPrimitiveSVGElement(n))for(var a=0;a<r.length;a++)switch(r[a]){case"href":e.setAttributeNS(p.xlinkns,"href",i[a]);break;case"href-path":e.setAttributeNS(p.xlinkns,"href",this.client.network.getJarResourceURL(i[a]));break;case"geo":var o=i[a].split("|");e.setAttribute("lon",o[0]),e.setAttribute("lat",o[1]),e.setAttribute("heading",o[2]),Gf.updateGISAgentPosition(e),Gf.adjustGISPositionX(e);break;default:t.filterAndSetAttribute(e,r[a],i[a])}else switch(n){case"ShapeArc":Sf.updateShapeArc(e,r,i);break;case"ShapeText":Sf.updateShapeText(e,r,i);break;case"ShapeImage":this.shapeComposite.updateShapeImage(e,r,i);break;case"ShapeCanvas":Sf.updateShapeCanvas(e,r,i);break;case"ShapeCAD":this.shapeComposite.updateShapeCAD(e,r,i);break;case"ShapeSVG":Sf.updateShapeSVG(e,r,i);break;case"ShapeModelPrimitives":this.shapeModelPrimitives.update(e,r,i);break;case"ShapeInspect":Df.update(e,r,i);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(e,r,i);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(e,r,i);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":Hf.updateMarkupPath(e,r,i);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":Hf.updateMarkupAreaNode(e,r,i);break;case"MarkupPalletRack":Hf.updateMarkupPalletRack(e,r,i);break;case"MarkupRailwaySwitch":Wf.updateMarkupRailwaySwitch(e,r,i);break;case"MarkupPositionOnTrack":Wf.updateMarkupPositionOnTrack(e,r,i);break;case"MarkupPipe":Uf.updateMarkupPipe(e,r,i);break;case"MarkupStorageTank":Uf.updateMarkupStorageTank(e,r,i);break;case"MarkupBulkConveyorBelt":Uf.updateMarkupBulkConveyorBelt(e,r,i);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":zf.updateMarkupWall(e,r,i);break;case"MarkupTargetLine":zf.updateMarkupTargetLine(e,r,i);break;case"MarkupPathway":zf.updateMarkupPathway(e,r,i);break;case"MarkupPedFlowStatistics":zf.updateMarkupPedFlowStatistics(e,r,i);break;case"MarkupServiceWithLines":zf.updateMarkupServiceWithLines(e,r,i);break;case"MarkupServiceWithArea":zf.updateMarkupServiceWithArea(e,r,i);break;case"MarkupEscalatorGroup":zf.updateMarkupEscalatorGroup(e,r,i);break;case"MarkupDensityMap":zf.updateMarkupDensityMap(e,r,i);break;case"MarkupIntersection":Vf.updateMarkupIntersection(e,r,i);break;case"MarkupRoad":Vf.updateMarkupRoad(e,r,i);break;case"MarkupStopLine":Vf.updateMarkupStopLine(e,r,i);break;case"MarkupBusStop":case"MarkupParkingLot":Vf.updateMarkupBusStopOrParkingLot(e,r,i);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":Bf.updateGISMarkup(e,r,i);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(e,r,i);break;case"Window3D":Xf.update(e,r,i)}},t.filterAndSetAttribute=function(t,e,r){if(!(["shape-type","owner-id","add-after","has-click-handler"].indexOf(e)>=0||e.startsWith("3d")))if("pos"==e||"scale"==e){var i=f.posOrScaleToTransform(t,e,r);f.applyTransformAttribute(t,i)}else t.setAttribute(e,r)},t.prototype.measureFPS=function(){var t=Date.now();null!=this.fpsMeasureStartTime&&(this.actualFPS=Math.round(1e3*this.frameCount/(t-this.fpsMeasureStartTime))),Qf.DEBUG_MODE&&(this.client.debugger.fpsInfo.innerHTML=this.actualFPS+":"+this.packetFPS),this.fpsMeasureStartTime=t,this.frameCount=0},t.prototype.onControlAction=function(t,e){this.client.network.postUserAction(t,e)},t.prototype.onModelPrimitiveClick=function(t){var e=t.split("-");this.client.network.postUserAction(e[0],e[1])},t.onClickableShapeOverOut=function(t,e){var r=t.getAttribute("type");"ShapeGISMap"!=r&&"ShapeCanvas"!=r&&(e?t.setAttribute("class","clickable-over"):t.removeAttribute("class"))},t.prototype.onClickableShapeClick=function(t,e){var r;if("ShapeGISMap"==t.getAttribute("type"))r=Gf.eventToLonLat(t,e);else{var i=this.client.navigation.eventToXY(e);r=this.client.navigation.XYtoShapeXY(t,i)}this.client.network.postUserAction(t.id,r[0]+" "+r[1])},t.prototype.applySettings=function(t,e){for(var r=0;r<t.length;r++)this.modelSettings[f.hyphenToCameLCase(t[r])]=e[r];this.modelSettings.startTime=parseInt(this.modelSettings.startTime),this.modelSettings.startDate=parseInt(this.modelSettings.startDate),this.modelSettings.stopTime&&(this.modelSettings.stopTime=parseInt(this.modelSettings.startTime),this.modelSettings.stopDate=parseInt(this.modelSettings.startDate))},t.prototype.toDate=function(t){var e=this.modelSettings,r=t-e.startTime;return new Date(e.startDate+this.toMilliseconds(r))},t.prototype.date=function(){return this.toDate(this.time)},t.prototype.toMilliseconds=function(t){switch(this.modelSettings.timeUnit){case"MILLISECOND":return t*f.MILLISECOND;case"SECOND":return t*f.SECOND;case"MINUTE":return t*f.MINUTE;case"HOUR":return t*f.HOUR;case"DAY":return t*f.DAY;case"WEEK":return t*f.WEEK;case"MONTH":return t*f.MONTH;case"YEAR":return t*f.YEAR}},t.prototype.applyNavigation=function(t,e){for(var r=0;r<t.length;r++)this.navigationSettings[f.hyphenToCameLCase(t[r])]=e[r];this.navigationSettings.x=parseFloat(this.navigationSettings.x),this.navigationSettings.y=parseFloat(this.navigationSettings.y),this.navigationSettings.width=parseFloat(this.navigationSettings.width),this.navigationSettings.height=parseFloat(this.navigationSettings.height),this.navigationSettings.zoomAndPanningEnabled="true"==this.navigationSettings.zoomAndPanningEnabled,this.navigationSettings.navigationBackEnabled="true"==this.navigationSettings.navigationBackEnabled,this.client.setNavigationSettings(this.navigationSettings.width,this.navigationSettings.height),this.client.navigation.applyNavigationSettings()},t.showMessage=function(t,e){for(var r={},i=0;i<t.length;i++)r[f.hyphenToCameLCase(t[i])]=e[i];var n=document.getElementById("svg-message-background"),a=document.getElementById("svg-message-box-title"),o=document.getElementById("svg-message-box-text"),s=document.getElementById("svg-message-box-icon-info"),l=document.getElementById("svg-message-box-icon-error");a.innerText=r.title,o.innerHTML=r.text.replace(/\n/g,"<br>"),r.type.startsWith("error")?(s.style.display="none",l.style.removeProperty("display"),a.classList.remove("svg-message-box-colors-info"),a.classList.add("svg-message-box-colors-error"),""==r.title&&(a.innerHTML="Error")):(s.style.removeProperty("display"),l.style.display="none",a.classList.remove("svg-message-box-colors-error"),a.classList.add("svg-message-box-colors-info"),""==r.title&&(a.innerHTML="Message")),n.style.removeProperty("display")},t.openURL=function(e,r){var i=r[0];i.startsWith("http://")&&i.startsWith("https://")||(i="http://"+i);var n=["message","Open URL","The model asks you to open an external URL:<br><a href="+i+" target = '_blank' onclick = 'document.getElementById( \"svg-message-background\" ).style.display = \"none\"'>"+i+"</a><br><br>The URL will open in a new window"];t.showMessage(["type","title","text"],n)},t.showTooltip=function(t,e,r,i,n){var a=document.getElementById("presentation-tooltip");a.innerText=t;var o=a.offsetWidth,s=a.offsetHeight;a.style.left=Math.max(0,e-o-1)+"px",a.style.top=Math.max(0,r-s-1)+"px",a.style.backgroundColor=i,a.style.color=n,a.className="presentation-tooltip-shown"},t.hideTooltip=function(){document.getElementById("presentation-tooltip").className="presentation-tooltip-hidden"},t.SLEEP_TIME_STATISTICS_SIZE=20,t.MAX_FPS=20,t}(),Zf=function(){function t(t){var e=this;this.accumulatedZoomWheelDelta=0,this.client=t,this.onWindowResizeEventClosure=function(t){return e.applyNavigationSettings()}}return t.prototype.initSVGNavigation=function(){var e=this;this.presentationCoords=[0,0],this.zoom=1,window.addEventListener("resize",this.onWindowResizeEventClosure,!1),w.addFullScreenListener(this.onWindowResizeEventClosure);var r=this.client.svgContainer;r.oncontextmenu=function(){return!1},this.dragWheelZoomHandler=new Nf(r,this.client.svg,function(t,r,i,n){return e.onDrag(t,r,i,n)},function(t,r,i){return e.onWheel(t,r,i)},null,function(t,r,i,n){return e.onTouchZoom(t,r,i,n)},function(e){return t.eventIgnoreCondition(e)},function(e){return t.wheelIgnoreCondition(e)})},t.prototype.clearSVGNavigation=function(){window.removeEventListener("resize",this.onWindowResizeEventClosure,!1),w.removeFullScreenListener(this.onWindowResizeEventClosure),null!=this.dragWheelZoomHandler&&(this.dragWheelZoomHandler.stop(),this.dragWheelZoomHandler=null)},t.eventIgnoreCondition=function(t){if(t.target instanceof HTMLCanvasElement&&"canvas-group-3d"==t.target.parentElement.id)return!0;return!1},t.prototype.onDrag=function(t,e,r,i){this.applyPanning(e,r)},t.wheelIgnoreCondition=function(t){return t.altKey},t.prototype.onWheel=function(e,r,i){var n=this;e.ctrlKey?(clearTimeout(this.delayedZoomTimeout),this.accumulatedZoomWheelDelta+=e.deltaY<0?1:-1,this.delayedZoomTimeout=setTimeout(function(){n.delayedWheelZoom(r,i)},t.zoomDelay)):0<e.deltaY?this.applyPanning(0,-50):this.applyPanning(0,50)},t.prototype.onTouchZoom=function(e,r,i,n){var a=n*this.zoom;a=Math.max(a,t.zooms[0]),a=Math.min(a,t.zooms[t.zooms.length-1]),this.applyZoom(a,r,i)},t.prototype.delayedWheelZoom=function(e,r){if(0!=this.accumulatedZoomWheelDelta){var i,n=t.zooms.length,a=!1;if(this.accumulatedZoomWheelDelta<0){for(var o=n-1;o>=0;o--)if(t.zooms[o]<this.zoom){a=!0,i=o+this.accumulatedZoomWheelDelta+1;break}}else for(o=0;o<n;o++)if(this.zoom<t.zooms[o]){a=!0,i=o+this.accumulatedZoomWheelDelta-1;break}a&&(i=Math.min(i,n-1),i=Math.max(0,i),this.applyZoom(t.zooms[i],e,r)),this.accumulatedZoomWheelDelta=0}},t.prototype.applyPresentationTransform=function(){var t=this.client.frameDrawing.navigationSettings;if(!t.zoomAndPanningEnabled){var e=this.zoom,r=this.presentationCoords[0],i=this.presentationCoords[1],n=this.client.svg.getBoundingClientRect(),a=n.width,o=n.height;e=Math.max(e,a/t.width),e=Math.max(e,o/t.height),r=Math.min(r,-t.x*e),r=Math.max(r,a-(t.x+t.width)*e),i=Math.min(i,-t.y*e),i=Math.max(i,o-(t.y+t.height)*e),this.presentationCoords=[r,i],this.zoom=e}var s=f.fixedPrecision(this.presentationCoords[0],1),l=f.fixedPrecision(this.presentationCoords[1],1),u=f.reducePrecision(this.zoom),c="translate("+s+","+l+") scale("+u+")",h=this.client.presentation.getAttribute("transform");if(c!=h){this.client.presentation.setAttribute("transform",c),Xf.syncAllCanvas3DPositions();var d=f.parseTransform(h);u!=d[3]&&this.invokeZoomLsteners(d[3],u)}},t.prototype.applyZoom=function(t,e,r){if(t!=this.zoom){var i=this.client.frameDrawing.navigationSettings;if(!i.zoomAndPanningEnabled){var n=this.client.svg,a=n.getBoundingClientRect(),o=a.width,s=a.height,l=i.width,u=i.height,c=n.parentNode.getBoundingClientRect(),h=c.width,d=c.height;if((t=l/u>h/d?Math.max(t,h/l):Math.max(t,d/u))==this.zoom)return;var p=Math.min(l*t,h),f=Math.min(u*t,d),m=!1;if(p!=o&&(n.setAttribute("width",p.toString()),m=!0),f!=s&&(n.setAttribute("height",f.toString()),m=!0),m){var g=document.getElementById("canvas-group-3d");g.style.width=p+"px",g.style.height=f+"px"}}var b=t/this.zoom,v=e-(e-this.presentationCoords[0])*b,y=r-(r-this.presentationCoords[1])*b;this.presentationCoords=[v,y],this.zoom=t,this.applyPresentationTransform()}},t.prototype.applyPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform()},t.prototype.navigateTo=function(t,e,r){this.zoom=r,this.presentationCoords=[-t*this.zoom,-e*this.zoom],this.applyPresentationTransform()},t.prototype.applyNavigationSettings=function(){var t,e,r,i=this.client.frameDrawing.navigationSettings,n=i.width,a=i.height,o=i.zoomAndPanningEnabled,s=i.width/i.height,l=this.client.svgContainer.getBoundingClientRect(),u=l.width,c=l.height,h=u/c,d=i.x,p=i.y;s>h?(r=u/n,t=u,o?p-=((e=c)/r-a)/2:e=u/s):(r=c/a,o?d-=((t=u)/r-n)/2:t=c*s,e=c),f.setMultipleAttributes(this.client.svg,["width","height"],[t,e]);var m=document.getElementById("canvas-group-3d");m.style.width=t+"px",m.style.height=e+"px",this.navigateTo(d,p,r)},t.prototype.invokeZoomLsteners=function(t,e){for(var r=0,i=this.client.presentation.getElementsByClassName("svg-zoom-listener");r<i.length;r++){var n=i[r];switch(n.getAttribute("type")){case"ShapeCAD":Sf.onCADZoomChange(n,t,e)}}},t.prototype.eventToXY=function(t){var e=f.offsetPage(this.client.svg),r=m.eventPageXY(t),i=r[0]-e.left,n=r[1]-e.top,a=i-this.presentationCoords[0],o=n-this.presentationCoords[1];return[a/=this.zoom,o/=this.zoom]},t.prototype.XYtoShapeXY=function(t,e){if(t==this.client.presentation)return e;var r=this.XYtoShapeXY(t.parentNode,e),i=f.parseTransform(t.getAttribute("transform")),n=r[0]-i[0],a=r[1]-i[1];if(0!=i[2]){var o=Math.sqrt(n*n+a*a),s=Math.atan2(a,n)-i[2];n=o*Math.cos(s),a=o*Math.sin(s)}return[n/i[3],a/i[4]]},t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t.zoomDelay=50,t}(),Kf=function(){function t(e){var r=this;this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDebugContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDebugContainer.parentElement,this.controlPanel=document.getElementById("control-panel"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDebugTools=document.getElementById("control-panel-button-dev-panel"),this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.cpButtonWebsite=document.getElementById("control-panel-button-website"),this.cpButtonTermsOfUse=document.getElementById("control-panel-button-terms-of-use"),this.cpButtonAbout=document.getElementById("control-panel-button-about"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpInfoState=document.getElementById("control-panel-info-state"),window.addEventListener("resize",function(){return r.adjustControlPanelItemsVisibility()},!1),t.assignActionOnClick(this.cpButtonRun,function(){return r.client.network.postUserCommand("run","")}),t.assignActionOnClick(this.cpButtonPause,function(){return r.client.network.postUserCommand("pause","")}),t.assignActionOnClick(this.cpButtonX1,function(){return r.setSpeed(1)}),t.assignActionOnClick(this.cpButtonSlower,function(){return r.speedUpOrDown(!1)}),t.assignActionOnClick(this.cpButtonFaster,function(){return r.speedUpOrDown(!0)}),t.assignActionOnClick(this.cpButtonVirtual,function(){return r.setSpeed(1/0)}),this.cpButtonWebsite.onclick=function(){return window.open("https://www.anylogic.com")},this.cpButtonTermsOfUse.onclick=function(){return window.open("https://www.anylogic.com/downloads/legal-info/")},this.cpButtonAbout.onclick=function(){return window.open("https://www.anylogic.com/features/cloud/")},this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},t.assignActionOnClick(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),w.addFullScreenListener(function(){return r.onFullScreenChange()}),this.cpButtonDebugTools.style.display="none"}return t.prototype.adjustControlPanelItemsVisibility=function(){var t=this.presentationContainer.getBoundingClientRect().width,e=262,r=w.isFullScreenEnabled();this.cpButtonFullScreen.style.removeProperty("display");var i=(t-=e+=r?46:0)>=(e=178);i?(this.cpButtonSlower.style.removeProperty("display"),this.cpInfoScale.style.removeProperty("display"),this.cpButtonFaster.style.removeProperty("display")):(this.cpButtonSlower.style.display="none",this.cpInfoScale.style.display="none",this.cpButtonFaster.style.display="none"),(i=(t-=e)>=(e=46))?this.cpButtonX1.style.removeProperty("display"):this.cpButtonX1.style.display="none",(i=(t-=e)>=(e=46))?this.cpButtonVirtual.style.removeProperty("display"):this.cpButtonVirtual.style.display="none",t-=e},t.prototype.updateExperimentState=function(){this.updateInfoState(),this.updateModelTimeScale(),this.updateRunGroup(),this.updateSpeedGroup()},t.prototype.updateModelTimeScale=function(){this.cpInfoScale.innerText=t.timeScaleToString(this.client.getModelTimeScale())},t.prototype.updateExperimentProgress=function(){var t=this.client.getModelProgress(),e=this.progressBar.firstElementChild,r=100*t;this.progressBar.style.width=t<=0?"0":r+"%",e.innerText=t<0?"progress n/a":Math.round(r)+"%"},t.prototype.updateInfoState=function(){var e=this.client.getModelState(),r=t.modelStateToString(e);this.cpInfoState.innerText=t.modelStateToString(r),this.indicateCpErrorState("ERROR"==e)},t.prototype.indicateCpErrorState=function(t){t?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getModelState()&&this.indicateCpErrorState(!1)},t.prototype.updateRunGroup=function(){var e=this.client.getModelState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e;t.setVisible(this.cpButtonRun,!r),this.setEnabled(this.cpButtonRun,!r&&i),t.setVisible(this.cpButtonPause,r),this.setEnabled(this.cpButtonPause,r)},t.prototype.updateSpeedGroup=function(){var e=this.client.getModelState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e,i=t.stringToTimeScale(this.cpInfoScale.innerText);this.setEnabled(this.cpButtonX1,r&&1!=i),this.setEnabled(this.cpButtonSlower,r&&i>t.speeds[0]),this.setEnabled(this.cpButtonFaster,r&&i!=1/0),this.setEnabled(this.cpButtonVirtual,r&&i!=1/0)},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=f.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r)},t.prototype.setSpeed=function(e){this.cpInfoScale.innerText=t.timeScaleToString(e),this.client.network.postUserCommand("setspeed",e.toString()),this.updateSpeedGroup()},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=w.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed")),this.adjustControlPanelItemsVisibility()},t.prototype.toggleFullScreen=function(){w.toggleFullScreen(this.presentationContainer)},t.modelStateToString=function(t){switch(t){case"IDLE":return"Idle";case"RUNNING":return"Running";case"PAUSED":return"Paused";case"FINISHED":return"Finished.";case"ERROR":return"Error!";case"PLEASE_WAIT":return"Please Wait...";case"INITIALIZE":return"Initializing...";case"STOPPED":return"Stopped";case"TIME_LIMIT":return"Time limit";case"TERMINATED":return"Terminated"}return t},t.timeScaleToString=function(t){return t<0||t==1/0?"Virtual":t>=1?"x"+t:"x1/"+1/t},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.setVisible=function(t,e){e?t.style.removeProperty("display"):t.style.display="none"},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.assignActionOnClick=function(e,r){e.onclick=function(){t.isEnabled(e)&&r()}},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t}(),Qf=function(){function t(){this.windowAdjusted=!1,this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new qf(this),this.navigation=new Zf(this),this.network=new Cf(this),this.controlPanel=new Kf(this)}return t.prototype.start=function(t){this.svgAnimationInfo=t,this.navigation.initSVGNavigation(),this.network.start(),this.frameDrawing.start(),this.modelState="INITIALIZE"},t.prototype.stop=function(t){t?(this.modelState=t.type,this.controlPanel.updateExperimentState()):this.modelState=void 0,this.frameDrawing.stop(),this.navigation.clearSVGNavigation(),this.network.stop(),this.onToggleFullScreen=void 0,this.onResize=void 0,this.onStop=void 0,this.windowAdjusted=!1,p.removeAllChildren(this.presentation)},t.prototype.pause=function(){this.network.pause()},t.prototype.setCallback=function(t,e){switch(t){case"ontogglefullscreen":this.onToggleFullScreen=e;break;case"onstop":this.onStop=e;break;case"onresize":this.onResize=e}},t.prototype.stopAndAlert=function(t,e){console.log(t),console.log(e),qf.showMessage(["type","title","text"],["error",t,e]),this.frameDrawing.stop()},t.prototype.updateExperimentState=function(t){t.state!=this.modelState&&(this.modelState=t.state,this.controlPanel.updateExperimentState()),t.progress!=this.modelProgress&&(this.modelProgress=t.progress,this.controlPanel.updateExperimentProgress()),t.time!=this.modelTime&&(this.modelTime=t.time),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.controlPanel.updateModelTimeScale())},t.prototype.getModelTime=function(){return this.modelTime},t.prototype.getModelState=function(){return this.modelState},t.prototype.getModelTimeScale=function(){return this.modelTimeScale},t.prototype.getModelProgress=function(){return this.modelProgress},t.prototype.setNavigationSettings=function(t,e){var r=this;!this.windowAdjusted&&this.onResize&&(this.onResize(t,e+50,function(){r.navigation.applyNavigationSettings(),r.controlPanel.adjustControlPanelItemsVisibility()}),this.windowAdjusted=!0)},t.DEBUG_MODE=!1,t.DEBUG_SPARK_LOCAL=!1,t}(),Jf=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(t){var e=this;p.setDebugMode(),Qf.DEBUG_MODE=!0,Qf.DEBUG_SPARK_LOCAL=t,this.client.debugger=this,this.serverQueueInfo=document.getElementById("dev-panel-info-server-queue"),this.browserQueueInfo=document.getElementById("dev-panel-info-browser-queue"),this.parseTimeInfo=document.getElementById("dev-panel-info-parse-time"),this.shapeCountInfo=document.getElementById("dev-panel-info-shape-count"),this.cudCountInfo=document.getElementById("dev-panel-info-cud-count"),this.drawTimeInfo=document.getElementById("dev-panel-info-draw-time"),this.fpsInfo=document.getElementById("dev-panel-info-fps"),this.timeInfo=document.getElementById("dev-panel-info-time"),t&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return e.onNewModelSelected()})},t.prototype.stop=function(){this.modelSelector&&(this.modelSelector.onchange=void 0)},t.prototype.onNewModelSelected=function(){var t=this;if(null!=this.client.svg&&this.client.stop("TERMINATED"),"NO MODEL SELECTED"!=this.modelSelector.value){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&t.client.start({})},e.open("GET","/http/start?path="+this.modelSelector.value,!0),e.send()}},t}(),$f=function(){function t(){}return t.createClient=function(){return new Qf},t.createDebugger=function(){return new Jf(new Qf)},t}(),tm=function(){function t(t,e){void 0===e&&(e=0),this.array=new Array(t),this.defaultvalue=e,this.reset()}return t.prototype.reset=function(){this.array.fill(this.defaultvalue)},t.prototype.add=function(t){this.array.push(t),this.array.shift()},t.prototype.mean=function(){for(var t=0,e=0,r=this.array;e<r.length;e++){t+=r[e]}return t/this.array.length},t.prototype.linearWeightedAverage=function(t){var e=this.array.length;t||(t=e);for(var r=(t-1)/(e-1),i=1,n=0,a=0,o=0;o<e;o++)n+=i*this.array[o],a+=i,i+=r;return n/a},t}(),em=function(){function t(t){this.client=t}return t.createShapeArc=function(){return p.cloneElementWithId("shape-arc")},t.updateShapeArc=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"data-fill":i.setAttribute("d",r[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":n.setAttribute(e[a],r[a]);break;case"data-stroke":n.setAttribute("d",r[a]);break;default:xm.filterAndSetAttribute(t,e[a],r[a])}},t.createShapeArrowLine=function(){return p.cloneElementWithId("shape-arrow-line")},t.updateShapeArrowLine=function(e,r,i){for(var n=p.findChildOfType(e,"line"),a=0;a<r.length;a++)switch(r[a]){case"x2":case"y2":e.setAttribute(r[a],i[a]),n.setAttribute(r[a],i[a]),"y2"==r[a]&&t.setupBothArrows(e);break;case"stroke-dasharray":n.setAttribute(r[a],i[a]);break;case"stroke-width":case"stroke":e.setAttribute(r[a],i[a]),"stroke"==r[a]&&e.setAttribute("fill",i[a]);break;case"arrow-settings":e.setAttribute(r[a],i[a]),t.setupBothArrows(e);break;default:xm.filterAndSetAttribute(e,r[a],i[a])}},t.setupBothArrows=function(e){var r=e.getAttribute("arrow-settings");if(null!=r){var i=f.splitSkipEmpty(r,":");t.setupArrow(e,!0,i[0],parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3])),t.setupArrow(e,!1,i[4],parseFloat(i[5]),parseFloat(i[6]),parseFloat(i[7]))}},t.setupArrow=function(t,e,r,i,n,a){var o,s,l,u,c=p.findChildOfType(t,"line"),h=p.findChildOfType(t,e?"begin-arrow":"end-arrow"),d=f.getFloatAttribute(t,"x2"),m=f.getFloatAttribute(t,"y2"),g=f.getFloatAttribute(t,"stroke-width"),b=Math.hypot(d,m);if("ARROW_NONE"==r||b<n)return h.setAttribute("visibility","hidden"),void(e?f.setMultipleAttributes(c,["x1","y1"],[0,0]):f.setMultipleAttributes(c,["x2","y2"],[d,m]));h.setAttribute("visibility","inherit"),"ARROW_FILLED"==r?h.removeAttribute("fill"):h.setAttribute("fill","none"),h.setAttribute("points",-a/2+","+n+" 0,0 "+a/2+","+n);var v=e?Math.atan2(m,d)+Math.PI:Math.atan2(m,d);if(i>0)o=i*d,l=i*m,s=e?0:d,u=e?0:m;else{var y=2*g*Math.sqrt(n*n+a*a/4)/(2*a),A=e?0:b;s=o=(A-y)*Math.cos(v),u=l=(A-y)*Math.sin(v)}var T=f.radiansToDegrees(v+Math.PI/2);h.setAttribute("transform","translate("+o+" "+l+") rotate("+T+")"),f.setMultipleAttributes(c,e?["x1","y1"]:["x2","y2"],[s,u])},t.createShapeText=function(){var t=p.createSvgElement("text");return t.setAttribute("class","shape-text"),t},t.updateShapeText=function(e,r,i){for(var n=0;n<r.length;n++)switch(r[n]){case"text-content":null==i[n]&&(i[n]="");var a=i[n].split("\n"),o=f.getFloatAttribute(e,"first-line-offset"),s=f.getFloatAttribute(e,"line-height");t.drawMultiLineText(e,a,s,o);break;case"font":e.style.font=i[n];break;default:xm.filterAndSetAttribute(e,r[n],i[n])}},t.drawMultiLineText=function(t,e,r,i){var n=t.childElementCount;if(1==e.length&&1==n)t.firstElementChild.firstChild.textContent=e[0];else{for(var a=t.getAttribute("x"),o=null==a?0:parseFloat(a),s=t.getAttribute("y"),l=(null==s?0:parseFloat(s))+i,u=0;u<e.length;u++){var c=p.childElements(t),h=e[u];if(h.endsWith("\r")&&(h=h.substring(0,h.length-1)),c[u])c[u].firstChild.textContent=h;else{var d=p.createSvgElement("tspan");d.setAttribute("x",o.toString()),d.setAttribute("y",(l+u*r).toString());var f=p.createTextNode(h);d.appendChild(f),t.appendChild(d)}}for(;t.childElementCount>e.length;)p.removeElement(t.lastChild)}},t.createShapeImage=function(){return p.createSvgElement("g")},t.prototype.updateShapeImage=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"clear":p.removeAllChildren(t);break;case"add":var n=p.cloneElementWithId("image-item");n.setAttributeNS(p.xlinkns,"href",this.client.networkManager.getInternalResource(r[i])),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.appendChild(n);break;case"set":for(var a=parseInt(r[i]),o=t.childNodes,s=0;s<o.length;s++)(n=o[s]).setAttribute("visibility",s==a?"inherit":"hidden");break;case"width":case"height":o=t.childNodes;for(s=0;s<o.length;s++)(n=o[s]).setAttribute(e[i],r[i]);default:xm.filterAndSetAttribute(t,e[i],r[i])}},t.createShapeCanvas=function(t){var e=p.createSvgElement("image");return p.createCanvas(t,"canvas-group"),e},t.updateShapeCanvas=function(t,e,r){for(var i=t,n=document.getElementById(t.id+"canvas"),a=n.getContext("2d"),o=function(o){switch(e[o]){case"global-composite-operation":a.globalCompositeOperation=r[o];break;case"width":case"height":i.setAttribute(e[o],r[o]),n.setAttribute(e[o],r[o]);break;case"fill-rect":case"clear-rect":var s=r[o].split(" "),l=parseFloat(s[0]),u=parseFloat(s[1]),c=parseFloat(s[2]),h=parseFloat(s[3]);if("clear-rect"==e[o])a.clearRect(l,u,c,h);else{var d=s[4];a.fillStyle=d,a.fillRect(l,u,c,h)}break;case"fill-circle":s=r[o].split(" ");var f=parseFloat(s[0]),m=parseFloat(s[1]),g=parseFloat(s[2]),b=s[3];a.fillStyle=b,a.beginPath(),a.arc(f,m,g,0,2*Math.PI),a.fill();break;case"clear":a.clearRect(0,0,n.width,n.height);break;case"update":i.setAttributeNS(p.xlinkns,"href",n.toDataURL("image/x-xbitmap"));break;case"image":var v=new Image;v.onload=function(){var t=n.getContext("2d");t.clearRect(0,0,n.width,n.height),t.drawImage(v,0,0),i.setAttributeNS(p.xlinkns,"href",n.toDataURL("image/x-xbitmap"))},v.src=r[o];break;default:xm.filterAndSetAttribute(t,e[o],r[o])}},s=0;s<e.length;s++)o(s)},t.createShapeCAD=function(){return p.cloneElementWithId("shape-cad")},t.prototype.updateShapeCAD=function(t,e,r){for(var i=p.findChildOfType(t,"back"),n=p.findChildOfType(t,"image"),a=0;a<e.length;a++)switch(e[a]){case"width":case"height":i.setAttribute(e[a],r[a]),this.fitCAD(t);break;case"background-color":i.setAttribute("fill",r[a]);break;case"svg":n.setAttributeNS(p.xlinkns,"href",'data:image/svg+xml;utf8,<svg xmlns="'+p.svgns+'" width = "0" height = "0"><g transform = "translate(0 0) scale(1)" stroke-width = "0.6">'+r[a]+"</g></svg>");break;case"svg-dimensions":t.setAttribute(e[a],r[a]),this.fitCAD(t);break;case"layer-settings":var o=n.getAttribute("href"),s=o.indexOf("<svg"),l=o.substring(0,s),u=o.substring(s),c=document.createElementNS(p.svgns,"g");c.innerHTML=u;for(var h=c.firstElementChild.firstElementChild,d=0,m=f.splitSkipEmpty(r[a],"|");d<m.length;d++){var g=m[d].split(":"),b=p.findChildWithId(h,g[0]);null!=b&&(b.setAttribute("visibility",g[1]),"none"!=g[2]&&(b.setAttribute("stroke",g[2]),"none"!=b.getAttribute("fill")&&b.setAttribute("fill",g[2])))}u=c.innerHTML,n.setAttributeNS(p.xlinkns,"href",l+u);break;default:xm.filterAndSetAttribute(t,e[a],r[a])}},t.prototype.fitCAD=function(e){var r=p.findChildOfType(e,"back"),i=p.findChildOfType(e,"image"),n=e.getAttribute("svg-dimensions"),a=f.getFloatAttribute(r,"width"),o=f.getFloatAttribute(r,"height");if(null!=a&&null!=o&&null!=n){var s=f.splitToFloats(n," "),l=Math.min(a/s[2],o/s[3]),u="translate("+-s[0]*l+" "+-s[1]*l+") scale("+l+")",c=t.DEFAULT_CAD_STROKE_WIDTH/l/this.client.navigation.getZoom(),h=i.getAttribute("href");h=(h=h.replace(/width\s*=\s*"[^"]*"\s*height\s*=\s*"[^"]*"/,'width = "'+a+'" height = "'+o+'"')).replace(/transform\s*=\s*"[^"]*"\s*stroke-width\s*=\s*"[^"]*"/,'transform = "'+u+'" stroke-width = "'+c+'"'),i.setAttributeNS(p.xlinkns,"href",h),f.setMultipleAttributes(i,["width","height"],[a,o])}},t.onCADZoomChange=function(t,e,r){var i=p.findChildOfType(t,"image"),n=i.getAttribute("href");n=n.replace(/stroke-width\s*=\s*"([^"]*)"/,function(t,i){return'stroke-width = "'+parseFloat(i)*e/r+'"'}),i.setAttributeNS(p.xlinkns,"href",n)},t.createShapeScale=function(){return p.cloneElementWithId("shape-scale")},t.updateShapeScale=function(t,e,r){for(var i=p.findChildOfType(t,"background"),n=p.findChildOfType(t,"dashline"),a=p.findChildOfType(t,"start-group"),o=p.findChildOfType(a,"ratio"),s=p.findChildOfType(t,"middle-group"),l=p.findChildOfType(s,"middle-value"),u=p.findChildOfType(t,"end-group"),c=p.findChildOfType(u,"end-value"),h=p.findChildOfType(u,"units"),m=0;m<e.length;m++)switch(e[m]){case"length":i.setAttribute("width",r[m]),n.setAttribute("x2",r[m]),u.setAttribute("transform","translate("+r[m]+")");break;case"units":h.innerHTML=d.msg[r[m]]();break;case"length-in-units":var g=parseFloat(r[m]),b=f.getFloatAttribute(i,"width"),v=b/g,y=f.goodGridStep(g,b,10)*v;n.setAttribute("stroke-dasharray",y+" "+y),o.innerHTML="1"+h.innerHTML+" = "+f.formatNumber(v,2)+d.msg.PIXEL(),c.innerHTML=f.formatNumber(g,2);var A=2*y/v;A<=2/3*g?(s.setAttribute("transform","translate("+2*y+")"),l.innerHTML=f.formatNumber(A,2)+h.innerHTML):s.setAttribute("display","none");break;default:xm.filterAndSetAttribute(t,e[m],r[m])}},t.onScaleZoomChange=function(t,e,r){var i=p.findChildOfType(t,"background"),n=p.findChildOfType(t,"dashline"),a=p.findChildOfType(t,"start-group"),o=p.findChildOfType(t,"middle-group"),s=p.findChildOfType(t,"end-group"),l=e/r,u=f.getFloatAttribute(i,"height")*l,c=f.getFloatAttribute(i,"stroke-width")*l;f.setMultipleAttributes(i,["height","stroke-width"],[u,c]),f.setMultipleAttributes(n,["stroke-width","y1","y2"],[u,u/2,u/2]);var h=f.setTransformScale(a.getAttribute("transform"),1/r);null!=h?a.setAttribute("transform",h):a.removeAttribute("transform"),null!=(h=f.setTransformScale(o.getAttribute("transform"),1/r))?o.setAttribute("transform",h):o.removeAttribute("transform"),null!=(h=f.setTransformScale(s.getAttribute("transform"),1/r))?s.setAttribute("transform",h):s.removeAttribute("transform")},t.createShapeSVG=function(){return p.createSvgElement("g")},t.updateShapeSVG=function(t,e,r){for(var i=0;i<e.length;i++)switch(e[i]){case"svg":t.innerHTML="null"==r[i]?"":r[i];break;default:xm.filterAndSetAttribute(t,e[i],r[i])}},t.createUnsupportedObject=function(t){var e=p.cloneElementWithId("unsupported-object");return p.findChildOfType(e,"text").firstChild.textContent=t,e},t.updateUnsupportedObject=function(t,e,r){for(var i=p.findChildOfType(t,"background"),n=p.findChildOfType(t,"text"),a=0;a<e.length;a++)switch(e[a]){case"width":var o=parseFloat(r[a]);i.setAttribute("width",o.toString());var s=n.getBBox();o<s.width&&(n.firstChild.textContent="Not supported",s=n.getBBox()),o<s.width&&(n.firstChild.textContent="N/A",s=n.getBBox()),o<s.width&&(n.firstChild.textContent=""),n.setAttribute("x",(o/2).toString());break;case"height":var l=parseFloat(r[a]);i.setAttribute("height",l.toString()),n.setAttribute("y",(l/2+3).toString());break;default:xm.filterAndSetAttribute(t,e[a],r[a])}},t.shapeCompositeTypes=["ShapeArc","ShapeText","ShapeImage","ShapeCanvas","ShapeCAD","ShapeGISMap","ShapeScale","ShapeSVG"],t.DEFAULT_CAD_STROKE_WIDTH=.6,t}(),rm=function(){function t(){}return t.createStockIcon=function(t){var e=p.cloneElementWithId("STOCK"),r=p.findChildOfType(e,"back"),i=parseFloat(f.getSubAttribute(t,"width")),n=parseFloat(f.getSubAttribute(t,"height"));f.setMultipleAttributes(r,["x","y","width","height"],[-i/2,-n/2,i,n]);var a=p.findChildOfType(e,"bars").firstElementChild;f.setMultipleAttributes(a,["x","width"],[-i/2+1,i-2]);var o=f.getSubAttribute(t,"color");return null!=o&&(r.setAttribute("stroke",o),a.setAttribute("fill",o)),e},t.createFlowIcon=function(e){for(var r=p.cloneElementWithId("FLOW"),i=p.findChildOfType(r,"basepath"),n=p.findChildOfType(r,"innerpath"),a=p.findChildOfType(r,"animation"),o=p.findChildOfType(r,"arrow"),s=p.findChildOfType(r,"valve"),l=f.getSubAttribute(e,"color"),u=f.getSubAttribute(e,"points"),c=f.splitSkipEmpty(u,";"),h="",d=0;d<c.length;d++){var m=f.splitToFloats(c[d],",");if(h+=0==d?"M ":"L ",h+=m[0]+" "+m[1]+" ",0==d&&"null"==f.getSubAttribute(e,"source")){var g=f.splitToFloats(c[1],","),b=Math.atan2(m[1]-g[1],m[0]-g[0]);t.addFlowCloud(r,!0,m[0],m[1],b,l)}if(d==c.length-1){var v=f.splitToFloats(c[d-1],","),y=(b=Math.atan2(m[1]-v[1],m[0]-v[0]),f.radiansToDegrees(b)),A="translate("+m[0]+","+m[1]+") rotate("+y+")";o.setAttribute("transform",A),"null"==f.getSubAttribute(e,"target")&&t.addFlowCloud(r,!1,m[0],m[1],b,l)}}var T=f.roundPathCorners(h,5,!1);i.setAttribute("d",T),n.setAttribute("d",T),a.setAttribute("d",T);var C=f.getSubAttribute(e,"valve-pos"),S=f.splitToFloats(C,","),E="translate("+S[0]+","+S[1]+") rotate("+f.radiansToDegrees(S[2])+")";return s.setAttribute("transform",E),"true"==f.getSubAttribute(e,"external")&&s.setAttribute("stroke-dasharray","1,1"),null!=l&&(i.setAttribute("stroke",l),o.setAttribute("stroke",l),o.setAttribute("fill",f.changeBrightness(l,2)),s.setAttribute("stroke",l),s.setAttribute("fill",f.changeBrightness(l,2))),r},t.addFlowCloud=function(t,e,r,i,n,a){var o=e?15:35,s=r+o*Math.cos(n),l=i+o*Math.sin(n),u=p.createUseElement("flow-cloud-fill"),c=p.createUseElement("flow-cloud-line");f.setMultipleAttributes(u,["x","y"],[s,l]),f.setMultipleAttributes(c,["x","y"],[s,l]),c.setAttribute("stroke",null==a?"CornflowerBlue":a),t.appendChild(u),t.appendChild(c)},t.createDynamicVariableIcon=function(t){var e,r=(e="true"==f.getSubAttribute(t,"external")?p.cloneElementWithId("DYNAMIC_VARIABLE_EXTERNAL"):"true"==f.getSubAttribute(t,"constant")?p.cloneElementWithId("DYNAMIC_VARIABLE_CONSTANT"):p.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,i=f.getSubAttribute(t,"color");return null!=i&&r.setAttribute("fill",i),e},t.createShadowIconAndInfo=function(t,e,r){var i=f.getSubAttribute(r,"original"),n=nm.getModelPrimitiveByName(t,i);if(null==n)return console.log("Shadow variable could not find its original, name: "+i),p.createUseElement("DEFAULT_MODEL_ELEMENT");var a,o=p.findChildOfType(n,"icon");if("FLOW"==n.getAttribute("type")){var s=(a=p.cloneElementWithId("DYNAMIC_VARIABLE")).firstElementChild,l=p.findChildOfType(o,"valve");s.setAttribute("fill",l.getAttribute("stroke"))}else o.id=n.id+"icon",a=p.createUseElement(o.id);var u=p.findChildOfType(n,"info");u.id=n.id+"info";var c=p.createUseElement(u.id);c.setAttribute("type","info");var h=p.findChildOfType(e,"info"),d=f.getFloatAttribute(h,"x"),m=f.getFloatAttribute(h,"y");p.removeElement(h);var g=f.getFloatAttribute(u,"x"),b=f.getFloatAttribute(u,"y");return f.setMultipleAttributes(c,["x","y"],[-g+d,-b+m]),e.appendChild(c),a},t.createLinkIcon=function(t){var e=p.cloneElementWithId("LINK"),r=p.findChildOfType(e,"path"),i=f.splitToFloats(f.getSubAttribute(t,"start-point"),","),n=f.splitToFloats(f.getSubAttribute(t,"end-point"),","),a=f.getFloatSubAttribute(t,"r");if(null==a)r.setAttribute("d","M "+i[0]+" "+i[1]+" L "+n[0]+" "+n[1]);else{var o=f.getSubAttribute(t,"large"),s=f.getSubAttribute(t,"sweep");r.setAttribute("d","M "+i[0]+" "+i[1]+" A "+a+" "+a+" 0 "+o+" "+s+" "+n[0]+" "+n[1])}var l=r.getTotalLength(),u=p.findChildOfType(e,"arrow"),c=f.pathAngleAt(r,l),h=f.radiansToDegrees(c);u.setAttribute("transform","translate("+n[0]+" "+n[1]+") rotate("+h+")");var d=f.getSubAttribute(t,"color");null!=d&&(r.setAttribute("stroke",d),u.setAttribute("fill",d));var m=f.getSubAttribute(t,"stroke-width");if(null!=m){r.setAttribute("stroke-width",m);var g=1+((E=parseInt(m))-1)/4;u.setAttribute("transform",u.getAttribute("transform")+" scale("+g+")")}var b=f.getSubAttribute(t,"polarity");if(null!=b){var v=p.createSvgElement("text");v.appendChild(p.createTextNode(b));var y=n[0]+8*Math.cos(c-Math.PI/2),A=n[1]+8*Math.sin(c-Math.PI/2)+4;f.setMultipleAttributes(v,["x","y"],[y,A]),f.setMultipleAttributes(v,["fill","text-anchor"],[r.getAttribute("stroke"),"middle"]),e.appendChild(v)}if("true"==f.getSubAttribute(t,"delay")){var T=p.createUseElement("link-delay");T.setAttribute("stroke",null==d?"CornflowerBlue":d);var C=r.getPointAtLength(l/2),S=f.radiansToDegrees(f.pathAngleAt(r,l/2));T.setAttribute("transform","translate("+C.x+" "+C.y+") rotate( "+S+")"),e.appendChild(T)}if("true"==f.getSubAttribute(t,"initial-value")){var E=f.getFloatAttribute(r,"stroke-width");r.setAttribute("stroke-dasharray",4*E+","+1.5*E)}return e},t.createCausalLoopIcon=function(t){var e="true"==f.getSubAttribute(t,"clockwise"),r=p.cloneElementWithId(e?"CAUSAL_LOOP_CW":"CAUSAL_LOOP_CCW"),i=p.findChildOfType(r,"loop"),n=p.findChildOfType(r,"arrow"),a=p.findChildOfType(r,"text"),o=f.getSubAttribute(t,"text");a.firstChild.textContent=o;var s=8*o.length;if(s>18){var l=(s+6)/2;i.setAttribute("d","M0 -"+l+" A "+l+" "+l+" 0 1 "+(e?1:0)+" "+(e?-l:l)+" 0"),n.setAttribute("transform","translate("+(e?-1:1)*(l-12)+" 0)")}var u=f.getSubAttribute(t,"color");return null!=u&&(i.setAttribute("stroke",u),n.setAttribute("fill",u),a.setAttribute("fill",u)),r},t.updateStockState=function(t,e){var r=f.splitToFloats(e,","),i=r.length,n=p.findChildOfType(t,"back"),a=p.findChildOfType(t,"bars");if(a.childElementCount<i){for(var o=a.firstElementChild;a.childElementCount<i;)a.appendChild(p.cloneElement(o));var s=f.getFloatAttribute(n,"width"),l=-s/2+1,u=(s-1)/i-1;do{f.setMultipleAttributes(o,["x","width"],[l,u]),l+=u+1,o=o.nextElementSibling}while(null!=o)}for(var c=1/0,h=-1/0,d=0,m=r;d<m.length;d++){var g=m[d];g<c&&(c=g),h<g&&(h=g)}var b=Math.max(Math.abs(c),Math.abs(h)),v=Math.pow(10,Math.ceil(Math.log10(b)));c<0&&(v*=2),v<=0&&(v=1);for(var y=f.getFloatAttribute(n,"height"),A=a.firstElementChild,T=0;T<i;T++){var C=(y-2)*(r[T]/v),S=void 0;r[T]>=0?S=c>=0?y/2-1-C:-C:(C=-C,S=0),f.setMultipleAttributes(A,["y","height"],[S,C]),A=A.nextElementSibling}},t.updateFlowDirection=function(t,e){var r;r="1"==e?"model-primitive-flow-forward":"-1"==e?"model-primitive-flow-backward":"",p.findChildOfType(t,"animation").setAttribute("class",r)},t}(),im=function(){function t(){}return t.createStateIcon=function(t){var e=p.cloneElementWithId("STATE"),r=parseFloat(f.getSubAttribute(t,"width")),i=parseFloat(f.getSubAttribute(t,"height"));f.setMultipleAttributes(e,["width","height"],[r,i]);var n=f.getSubAttribute(t,"color"),a="true"==f.getSubAttribute(t,"composite");return e.setAttribute("composite",a?"true":"false"),null!=n?(e.setAttribute("fill",n),e.setAttribute("stroke",f.changeBrightness(n,.8))):a&&(e.setAttribute("fill","none"),e.setAttribute("stroke","Gray")),e.setAttribute("stroke-width",a?"2":"1"),e},t.createFinalStateIcon=function(){return p.cloneElementWithId("FINAL_STATE")},t.createTransitionIcon=function(t){for(var e=p.cloneElementWithId("TRANSITION"),r=p.findChildOfType(e,"path"),i=f.getSubAttribute(t,"points"),n=f.splitSkipEmpty(i,";"),a="",o=0;o<n.length;o++){var s=f.splitToFloats(n[o],",");if(o==n.length-1){var l=f.splitToFloats(n[o-1],","),u=Math.atan2(s[1]-l[1],s[0]-l[0]);s[0]-=Math.round(4*Math.cos(u)),s[1]-=Math.round(4*Math.sin(u));var c=f.radiansToDegrees(u),h="translate("+s[0]+","+s[1]+") rotate("+c+")";p.findChildOfType(e,"arrow").setAttribute("transform",h)}a+=(0==o?"M ":"L ")+s[0]+" "+s[1]+" "}var d=f.roundPathCorners(a,10,!1);r.setAttribute("d",d);var m=f.getSubAttribute(t,"trigger");if(null!=m){var g=p.createUseElement("transition-icon-"+m);g.setAttribute("type","trigger"),g.setAttribute("stroke","Black"),p.findChildOfType(e,"path").setAttribute("d",d);var b=f.getFloatSubAttribute(t,"icon-offset"),v=r.getPointAtLength(b);g.setAttribute("transform","translate("+v.x+","+v.y+")"),e.appendChild(g)}return e},t.createStatePointerIcon=function(t,e){var r=p.cloneElementWithId("STATE_POINTER"),i=p.findChildOfType(r,"line"),n=p.findChildOfType(r,"entry-dash"),a=f.getSubAttribute(t,"dxdy"),o=f.splitToFloats(a,","),s=Math.atan2(o[1],o[0]);o[0]-=Math.round(4*Math.cos(s)),o[1]-=Math.round(4*Math.sin(s)),f.setMultipleAttributes(i,["x2","y2"],[o[0],o[1]]);var l=f.radiansToDegrees(s),u="translate("+o[0]+","+o[1]+") rotate("+l+")";return p.findChildOfType(r,"arrow").setAttribute("transform",u),e?n.setAttribute("transform","rotate("+l+")"):p.removeElement(n),r},t.updateStateState=function(t,e,r){var i="true"==r;if("STATE"==e)if(i)f.setMultipleAttributes(t,["stroke","stroke-width"],["Red",2]);else{var n="true"==t.getAttribute("composite")?2:1,a=t.getAttribute("fill"),o="none"==a?"Gray":f.changeBrightness(a,.8);f.setMultipleAttributes(t,["stroke","stroke-width"],[o,n])}else{var s=p.findChildOfType(t,"outer");n=i?2:1,o=i?"Red":"Black";f.setMultipleAttributes(s,["stroke","stroke-width"],[o,n])}},t.updateTransitionState=function(t,e){var r=p.findChildOfType(t,"path"),i=p.findChildOfType(t,"arrow"),n=p.findChildOfType(t,"trigger"),a="Black";switch(e){case"SCHEDULED":a="Blue";break;case"CURRENT":a="Red"}r.setAttribute("stroke",a),i.setAttribute("fill",a),null!=n&&n.setAttribute("stroke",a)},t}(),nm=function(){function t(t){this.frameDrawing=t}return t.create=function(){return p.cloneElementWithId("shape-model-primitives")},t.prototype.update=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"static-info":for(var o=f.splitSkipEmpty(i[a],"\n"),s=function(r){var i=f.splitSkipEmpty(o[r],"|"),a=f.getSubAttribute(i,"index"),s=f.getSubAttribute(i,"type"),l=f.getSubAttribute(i,"name"),u=f.getSubAttribute(i,"x"),c=f.getSubAttribute(i,"y"),h=p.cloneElementWithId("model-primitive");h.id=e.id+"-"+a,h.setAttribute("type",s),h.setAttribute("transform","translate("+u+","+c+")");var d=p.findChildOfType(h,"label"),g=p.findChildOfType(h,"info");if(d.appendChild(p.createTextNode(l)),"false"==f.getSubAttribute(i,"show-label"))d.setAttribute("visibility","hidden"),g.setAttribute("visibility","hidden");else{var b=parseFloat(f.getSubAttribute(i,"label-dx")),v=parseFloat(f.getSubAttribute(i,"label-dy"));if("FLOW"==s){var y=f.getSubAttribute(i,"valve-pos"),A=f.splitToFloats(y,",");b+=A[0],v+=A[1]}f.setMultipleAttributes(d,["x","y"],[b,v+4]),f.setMultipleAttributes(g,["x","y"],[b,v+4+9]),g.appendChild(p.createTextNode(""))}var T=void 0;switch(s){case"LINK_TO_AGENTS":T=t.createLinkToAgents(i);break;case"CONNECTOR":T=t.createConnectorIcon(i);break;case"STOCK":T=rm.createStockIcon(i);break;case"FLOW":T=rm.createFlowIcon(i);break;case"DYNAMIC_VARIABLE":T=rm.createDynamicVariableIcon(i);break;case"SHADOW":T=rm.createShadowIconAndInfo(e,h,i);break;case"LINK":T=rm.createLinkIcon(i);break;case"CAUSAL_LOOP":T=rm.createCausalLoopIcon(i);break;case"STATE":T=im.createStateIcon(i);break;case"FINAL_STATE":T=im.createFinalStateIcon();break;case"TRANSITION":T=im.createTransitionIcon(i);break;case"STATECHART_ENTRY_POINT":T=im.createStatePointerIcon(i,!0);break;case"INITIAL_STATE_POINTER":T=im.createStatePointerIcon(i,!1);break;default:var C=null==document.getElementById(s)?"DEFAULT_MODEL_ELEMENT":s;T=p.createUseElement(C)}T.setAttribute("type","icon"),h.insertBefore(T,d);var S=null;t.dblClickableElements.indexOf(s)>=0&&(S=function(t){return n.onModelPrimitiveMouseEvent(h,"dblclick")}),t.responsiveElements.indexOf(s)>=0&&new m(h,function(t){return n.onModelPrimitiveMouseEvent(h,"mouseover")},function(t){return n.onModelPrimitiveMouseEvent(h,"mouseout")},null,function(t){return n.onModelPrimitiveMouseEvent(h,"click")},null,S),e.appendChild(h)},l=0;l<o.length;l++)s(l);break;case"update":var u=parseInt(i[a]),c=i[a].slice(i[a].indexOf(" ")+1),h=f.splitSkipEmpty(c,"|"),d=p.findChildWithId(e,e.id+"-"+u),g=p.findChildOfType(d,"icon"),b=d.getAttribute("type");for(l=0;l<h.length;l++){var v=h[l].split(":");switch(v[0]){case"label":case"info":p.findChildOfType(d,v[0]).firstChild.textContent=v[1];break;case"info-flag":var y=p.findChildOfType(d,"info"),A="model-primitive-info";"warning"==v[1]&&(A="model-primitive-info-warning"),y.setAttribute("class",A);break;case"null":var T=b+("true"==v[1]?"_NULL":"");p.changeUseHref(g,T);break;case"link-empty":f.setMultipleAttributes(g,["stroke","fill"],"true"==v[1]?["DarkGray","Gainsboro"]:["SteelBlue","LightBlue"]);break;case"standard-icon":g.setAttribute("visibility","true"==v[1]?"inherit":"hidden");break;case"event-state":p.changeUseHref(g,"EVENT_"+v[1]);break;case"port-state":p.changeUseHref(g,"PORT_"+v[1]);break;case"empty":T=b+("true"==v[1]?"_EMPTY":""),p.changeUseHref(g,T);break;case"stock-state":rm.updateStockState(g,v[1]);break;case"flow-sign":rm.updateFlowDirection(g,v[1]);break;case"state-active":im.updateStateState(g,b,v[1]);break;case"transition-state":im.updateTransitionState(g,v[1])}}break;default:xm.filterAndSetAttribute(e,r[a],i[a])}},t.createConnectorIcon=function(t){for(var e=p.cloneElementWithId("CONNECTOR"),r=f.getSubAttribute(t,"points"),i=f.splitSkipEmpty(r,";"),n="",a=0;a<i.length;a++){var o=i[a].split(",");if(0==a){n+="M ";var s=p.findChildOfType(e,"start-circle");f.setMultipleAttributes(s,["cx","cy"],o)}else n+="L ";if(n+=o[0]+" "+o[1]+" ",a==i.length-1){var l=p.findChildOfType(e,"end-circle");if(f.setMultipleAttributes(l,["cx","cy"],o),"true"==f.getSubAttribute(t,"sd")){var u=p.createUseElement("connector-arrow"),c=f.splitToFloats(i[a-1],","),h=Math.atan2(parseFloat(o[1])-c[1],parseFloat(o[0])-c[0]),d=f.radiansToDegrees(h),m="translate("+o[0]+","+o[1]+") rotate("+d+")";u.setAttribute("transform",m),e.appendChild(u)}}}var g=f.roundPathCorners(n,5,!1);return p.findChildOfType(e,"path").setAttribute("d",g),e},t.createLinkToAgents=function(t){var e=p.createSvgElement("g"),r=f.getSubAttribute(t,"multi"),i=f.getSubAttribute(t,"uni");return"true"==r&&e.appendChild(p.createUseElement("link-to-agents-multi")),e.appendChild(p.createUseElement("link-to-agents-basic")),"true"==i&&e.appendChild(p.createUseElement("link-to-agents-uni")),e},t.prototype.onModelPrimitiveMouseEvent=function(t,e){var r=p.findChildOfType(t,"icon"),i=p.findChildOfType(t,"label"),n=t.id.split("-");switch(e){case"mouseover":r.setAttribute("class","clickable-over"),i.setAttribute("font-weight","600");break;case"mouseout":r.removeAttribute("class"),i.setAttribute("font-weight","400");break;case"click":this.frameDrawing.client.postUserAction(n[0],n[1]);break;case"dblclick":this.frameDrawing.client.postUserAction(n[0],n[1]+" dblclick")}},t.getModelPrimitiveByName=function(t,e){for(var r=0,i=p.childElements(t);r<i.length;r++){var n=i[r],a=p.findChildOfType(n,"label");if(null!=a&&a.innerHTML==e)return n}return null},t.responsiveElements=["PARAMETER_STATIC","VARIABLE","CONSTANT","COLLECTION","TABLE_FUNCTION","CUSTOM_DISTRIBUTION","EVENT","SCHEDULE","STATISTICS","DATASET","HISTOGRAM_DATA","HISTOGRAM_2D_DATA","OUTPUT","EXCEL_FILE","TEXT_FILE","DATABASE","LINK_TO_AGENTS","LINK_TO_CONTAINER","STOCK","FLOW","DYNAMIC_VARIABLE","SHADOW","TRAFFIC_LIGHT","EMBEDDED_AGENT_ICON","EMBEDDED_POPULATION_ICON"],t.dblClickableElements=["LINK_TO_AGENTS","LINK_TO_CONTAINER","EMBEDDED_AGENT_ICON","EMBEDDED_POPULATION_ICON"],t}(),am=function(){function t(t){this.chart=t}return t.prototype.setup=function(t){for(var e=p.findChildOfType(t,"picture"),r=p.findChildOfType(t,"pictureback"),i=p.childElements(p.findChildOfType(t,"legend")),n=i.length,a="true"==t.getAttribute("show-pdf"),o="true"==t.getAttribute("show-cdf"),s="true"==t.getAttribute("show-mean"),l=f.getFloatAttribute(r,"height"),u=0;u<n;u++){var c=p.createSvgElement("g");if(a){var h=p.createSvgElement("g");c.appendChild(h)}if(o){var d=p.createSvgElement("polyline");f.setMultipleAttributes(d,["fill","stroke-width","stroke"],["none",i[u].getAttribute("cdf-line-width"),i[u].getAttribute("cdf-color")]),c.appendChild(d)}if(s){var m=p.createSvgElement("line");f.setMultipleAttributes(m,["stroke-width","stroke","y1","y2"],[i[u].getAttribute("cdf-line-width"),i[u].getAttribute("mean-color"),"0",l.toString()]),c.appendChild(m)}e.appendChild(c),this.chart.addClickTapHandlerToChartItem(c)}},t.prototype.draw=function(t,e){for(var r=p.findChildOfType(t,"pictureback"),i=p.findChildOfType(t,"picture"),n=p.findChildOfType(t,"grid"),a=p.findChildOfType(t,"legend"),o=p.childElements(a),s="true"==t.getAttribute("show-pdf"),l="true"==t.getAttribute("show-cdf"),u="true"==t.getAttribute("show-mean"),c=f.getFloatAttribute(t,"bar-width"),h=f.getFloatAttribute(r,"width"),d=f.getFloatAttribute(r,"height"),m=f.splitSkipEmpty(e," "),g=m.length,b=1/0,v=-1/0,y=1/0,A=-1/0,T=[],C=[],S=[],E=[],w=[],k=[],x=[],M=[],O=[],I=0;I<g;I++)if(o[I].setAttribute("data",m[I]),"empty"!=m[I]){var _=f.splitSkipEmpty(m[I],":");T[I]="true"==_[0],C[I]="true"==_[1],S[I]=parseFloat(_[2]),E[I]=parseFloat(_[3]),w[I]=parseFloat(_[4]),k[I]=parseInt(_[5]),x[I]=parseInt(_[6]),M[I]=f.splitToFloats(_[7],"|");for(var L=0;L<M[I].length;L++)M[I][L]<y&&(y=M[I][L]),A<M[I][L]&&(A=M[I][L]);T[I]&&(O[I]=f.splitToFloats(_[8],"|")),S[I]<b&&(b=S[I]),v<E[I]&&(v=E[I])}b==1/0&&(b=0,v=0),y==1/0&&(y=0,A=1),this.chart.chartScaleAndGrid.recalcChartScale(t,b,v,!1,!1),this.chart.chartScaleAndGrid.recalcChartScale(t,0,A,!0,!1);var P=f.getFloatAttribute(n,"min-x"),R=f.getFloatAttribute(n,"max-x"),F=f.getFloatAttribute(n,"min-y"),D=f.getFloatAttribute(n,"max-y"),N=h/(R-P),B=d/(D-F),G=p.childElements(i);for(I=0;I<g;I++)if("empty"!=m[I]){"hidden"==G[I].getAttribute("visibility")&&G[I].setAttribute("visibility","inherit");var U=M[I].length,H=(E[I]-S[I])/U,z=o[I].getAttribute("original-color"),W=void 0,V=void 0;if(C[I]&&(W=o[I].getAttribute("low-color"),V=o[I].getAttribute("high-color")),s){var Y=G[I].firstElementChild,j=c*H*N,X=H*(1-c)/2;for(L=0;L<U;L++){var q=(S[I]+L*H+X-P)*N,Z=(D-M[I][L])*B,K=M[I][L]*B,Q=p.childElements(Y)[L];Q?Q.setAttribute("visibility","inherit"):(Q=p.createSvgElement("rect"),Y.appendChild(Q)),f.setMultipleAttributes(Q,["x","y","width","height"],[f.reducePrecision(q),f.reducePrecision(Z),f.reducePrecision(j),f.reducePrecision(K)]),T[I]&&C[I]&&L<k[I]?Q.setAttribute("fill",W):T[I]&&C[I]&&x[I]<L?Q.setAttribute("fill",V):Q.setAttribute("fill",z)}var J=p.childElements(Y);for(L=U;L<J.length;L++)J[L].setAttribute("visibility","hidden")}if(l){var $=s?G[I].firstElementChild.nextElementSibling:G[I].firstElementChild,tt="";if(tt+=(S[I]-P)*N+" "+d+" ",T[I])for(L=0;L<U;L++){tt+=f.reducePrecision((S[I]+(L+1)*H-P)*N)+","+f.reducePrecision((1-O[I][L])*d)+" "}$.setAttribute("points",tt)}if(u){var et=G[I].lastElementChild,rt=(w[I]-P)*N;et.setAttribute("x1",rt),et.setAttribute("x2",rt)}if("NONE"!=t.getAttribute("leg-pos")){var it=p.findChildOfType(o[I],"value");it.firstChild.textContent=f.formatNumber(w[I],2),it.setAttribute("fill",o[I].getAttribute("mean-color"))}}else G[I].setAttribute("visibility","hidden");"NONE"!=t.getAttribute("leg-pos")&&cm.setupLegendItemsLayout(t)},t.setItemLook=function(t,e,r,i){for(var n=p.findChildOfType(t,"picture"),a=p.childElements(n),o=p.childElements(a[e]),s=0;s<o.length;s++)o[s].setAttribute("visibility",r?"hidden":"inherit")},t.dataToString=function(t){for(var e=p.findChildOfType(t,"legend"),r=p.childElements(e),i=r.length,n="",a=0;a<i;a++){n+=cm.getChratItemName(t,a)+"\n";var o=r[a].getAttribute("data");if("empty"==o)n+="no data\n";else{var s="true"==(o=f.splitSkipEmpty(o,":"))[0],l=parseFloat(o[2]),u=parseFloat(o[3]),c=f.splitToFloats(o[7],"|"),h=void 0;s&&(h=f.splitToFloats(o[8],"|")),n+="from\tto\tPDF",s&&(n+="\tCDF"),n+="\n";for(var d=c.length,m=(u-l)/d,g=l,b=0;b<d;b++)n+=g+"\t"+(g+m)+"\t"+c[b],s&&(n+="\t"+h[b]),n+="\n",g+=m}n+="\n"}return n},t}(),om=function(){function t(t){this.chart=t}return t.prototype.initChartScaleAndGrid=function(t,e){var r=t.getAttribute("type"),i=e?"y":"x",n=t.getAttribute("scale-type-"+i),a=p.findChildOfType(t,"grid"),o=p.findChildOfType(t,"pictureback"),s=p.findChildOfType(t,e?"pictureborderh":"pictureborderw"),l=a.getAttribute(e?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=l){var u=f.getFloatAttribute(o,"x"),c=f.getFloatAttribute(o,"y"),h=f.getFloatAttribute(o,"width"),d=f.getFloatAttribute(o,"height"),m="GRID_DEFAULT"==l,g="ChartBar"==r||"ChartStack"==r,b=t.getAttribute("bar-dir");e?g&&(!g||"NORTH"!=b&&"SOUTH"!=b)||f.setMultipleAttributes(s,["x1","y1","x2","y2"],m?[u,c,u,c+d]:[u+h,c,u+h,c+d]):g&&(!g||"EAST"!=b&&"WEST"!=b)||f.setMultipleAttributes(s,["x1","y1","x2","y2"],m?[u,c+d,u+h,c+d]:[u,c,u+h,c])}var v=a.getAttribute("grid-line-color");switch(a.setAttribute("grid-line-color",f.increaseTransparency(v,.5)),n){case"SCALE_AUTO":this.recalcChartScale(t,-1,1,e,!1);break;case"SCALE_AUTO_FROM_0":this.recalcChartScale(t,0,1,e,!1);break;case"SCALE_FIXED":var y=f.getFloatAttribute(t,"scale-min-"+i),A=f.getFloatAttribute(t,"scale-max-"+i);"ChartBar"!=r&&"ChartStack"!=r||(y="ChartStack"==r?0:Math.min(0,y),A=Math.max(0,A)),this.recalcChartScale(t,y,A,e,!0);break;case"SCALE_TIME_WINDOW":A=Math.max(0,f.getFloatAttribute(t,"scale-max-"+i)),this.recalcChartScale(t,0,A,e,!0);break;case"SCALE_100_PERCENT":this.recalcChartScale(t,0,1,e,!0)}},t.prototype.recalcChartScale=function(t,e,r,i,n){var a=t.getAttribute("type"),o=p.findChildOfType(t,"grid"),s=i?"min-y":"min-x",l=i?"max-y":"max-x";if(e!=f.getFloatAttribute(o,s)||r!=f.getFloatAttribute(o,l)){var u=e,c=r;if(u==c){if(n)return;u-=1,c+=1,"ChartTimeStack"==a&&u<0&&(u=0)}var h=p.findChildOfType(t,"pictureback"),d=f.getFloatAttribute(h,i?"height":"width"),m=i?25:45,g=f.goodGridStep(c-u,d,m);n?(u=Math.ceil(u/g)*g,c=Math.floor(c/g)*g):(u=Math.floor(u/g)*g,c=Math.ceil(c/g)*g);var b=n?e:u,v=n?r:c;f.setMultipleAttributes(o,[s,l],[b,v]),this.drawChartGrid(t,u,c,g,b,v,i)}},t.prototype.drawChartGrid=function(t,e,r,i,n,a,o){var s=t.getAttribute("type"),l=p.findChildOfType(t,"grid"),u=l.getAttribute(o?"grid-pos-y":"grid-pos-x");if("GRID_NONE"!=u){var c=o?l.lastElementChild:l.firstElementChild,h=p.findChildOfType(t,"pictureback"),d=l.getAttribute("grid-text-color"),m=l.getAttribute("grid-line-color"),g=o?"scale-type-y":"scale-type-x",b="SCALE_100_PERCENT"==t.getAttribute(g),v="SCALE_TIME_WINDOW"==t.getAttribute(g)?t.getAttribute("date-format-pattern"):"null",y=Math.round((r-e)/i)+1,A="GRID_DEFAULT"==u,T=!0;if("ChartBar"==s||"ChartStack"==s){var C=t.getAttribute("bar-dir");"SOUTH"!=C&&"WEST"!=C||(T=!1)}for(var S=f.getFloatAttribute(h,"x"),E=f.getFloatAttribute(h,"y"),w=f.getFloatAttribute(h,"width"),k=f.getFloatAttribute(h,"height"),x=(o?k:w)/(a-n),M=i*x;c.childElementCount<y;){var O=p.cloneElementWithId("grid-item");c.appendChild(O)}for(var I=p.childElements(c),_=e,L=o?T?E+(a-e)*x:E+(e-n)*x:T?S+(e-n)*x:S+(a-e)*x,P=0;P<y;P++){var R=o?A?S-4:S:L,F=o?L:A?E+k+4:E+k,D=o?A?S+w:S+w+4:L,N=o?L:A?E:E-4,B=o?A?R-3:D+3:R,G=o?F+3:A?F+11:N-3,U=o?A?"end":"start":"middle";(O=I[P]).setAttribute("visibility","inherit");var H=O.lastElementChild;f.setMultipleAttributes(H,["x1","x2","y1","y2","stroke"],[R,D,F,N,m]);var z=O.firstElementChild;f.setMultipleAttributes(z,["x","y","text-anchor","fill"],[B,G,U,d]);var W=void 0;if(b)W=f.formatPercent(_);else if("null"!=v){var V=this.chart.client.toModelDate(_);(W=f.formatDate(V,v)).length>10&&P%2==1&&(W="")}else W=f.formatNumber(_,2);z.firstChild.textContent=W,_+=i,L+=o?T?-M:+M:T?+M:-M}for(P=y;P<I.length;P++)I[P].setAttribute("visibility","hidden")}},t}(),sm=function(){function t(t){this.chart=t}return t.prototype.setup=function(t){var e,r,i=t.getAttribute("type"),n=p.findChildOfType(t,"pictureback"),a=p.findChildOfType(t,"picture"),o=p.findChildOfType(t,"legend"),s=p.childElements(o),l=s.length,u=f.getFloatAttribute(n,"width"),c=f.getFloatAttribute(n,"height");if("ChartBar"==i||"ChartStack"==i){var h=t.getAttribute("bar-dir");e="NORTH"==h||"SOUTH"==h;var d=f.getFloatAttribute(t,"bar-width");r="ChartBar"==i?(e?u/l:c/l)*d:(e?u:c)*d}for(var m=0;m<l;m++){var g=void 0,b=s[m].getAttribute("original-color");switch(i){case"ChartBar":case"ChartStack":(g=p.createSvgElement("rect")).setAttribute("stroke","none"),g.setAttribute("fill",b);var v=void 0;e?(v=u/l,g.setAttribute("x","ChartBar"==i?v*m+(v-r)/2:(u-r)/2),g.setAttribute("width",r)):(v=c/l,g.setAttribute("y","ChartBar"==i?v*m+(v-r)/2:(c-r)/2),g.setAttribute("height",r)),a.appendChild(g);break;case"ChartPie":(g=p.createSvgElement("path")).setAttribute("stroke","none"),g.setAttribute("fill",b),a.appendChild(g)}this.chart.addClickTapHandlerToChartItem(g)}for(m=0;m<l;m++)s[m].setAttribute("data","no data")},t.prototype.draw=function(t,e){for(var r=t.getAttribute("type"),i=p.findChildOfType(t,"pictureback"),n=p.findChildOfType(t,"grid"),a=p.findChildOfType(t,"legend"),o=p.findChildOfType(t,"picture"),s=p.childElements(o),l=f.getFloatAttribute(i,"width"),u=f.getFloatAttribute(i,"height"),c=f.splitToFloats(e," "),h=c.length,d=1/0,m=-1/0,g=!1,b=0,v=0;v<h;v++)c[v]<d&&(d=c[v]),m<c[v]&&(m=c[v]),c[v]<0&&(g=!0),b+=c[v];var y=!1;if("ChartBar"==r||"ChartStack"==r){var A=t.getAttribute("bar-dir"),T="NORTH"==A||"SOUTH"==A;"ChartBar"==r?(d=Math.min(0,d),m=Math.max(0,m)):(d=0,m=Math.max(0,b));var C=t.getAttribute(T?"scale-type-y":"scale-type-x");"SCALE_AUTO"!=C&&"SCALE_AUTO_FROM_0"!=C||this.chart.chartScaleAndGrid.recalcChartScale(t,d,m,T,!1),y="SCALE_100_PERCENT"==C;var S=f.getFloatAttribute(n,T?"min-y":"min-x"),E=f.getFloatAttribute(n,T?"max-y":"max-x"),w=(T?u:l)/(E-S),k=0;for(v=0;v<h;v++)if("ChartStack"==r&&(g||0==b)||"ChartBar"==r&&y&&(g||0==b))s[v].setAttribute(T?"height":"width",0);else{var x=y?c[v]/b:c[v],M=Math.abs(x),O=void 0;if("ChartBar"==r)switch(A){case"NORTH":case"WEST":O=x>0?E-x:E;break;case"SOUTH":case"EAST":O=x<0?x-S:-S}else{switch(A){case"NORTH":case"WEST":O=E-(x+k);break;case"SOUTH":case"EAST":O=-S+k}k+=x}M*=w;var I=T?u:l;(O*=w)<0?(M-=-O,O=0):O+M>I&&(M-=O+M-I),M<0&&(M=0),T?(s[v].setAttribute("y",O),s[v].setAttribute("height",M)):(s[v].setAttribute("x",O),s[v].setAttribute("width",M))}}else{var _=-Math.PI/2;for(v=0;v<h;v++){var L=b<=0||g?0:2*Math.PI*(c[v]/b),P=l/2,R=u/2,F=f.sectorData(P,R,P,R,_,L);s[v].setAttribute("d",F),_+=L}}("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&y)&&g?cm.showChartWarning(t,"Neg!"):cm.hideChartWarning(t);var D=p.childElements(a);for(v=0;v<h;v++)D[v].setAttribute("data",c[v]);if("NONE"!=t.getAttribute("leg-pos")){for(v=0;v<h;v++){var N=p.findChildOfType(D[v],"value"),B=f.formatNumber(c[v],2);("ChartStack"==r||"ChartPie"==r||"ChartBar"==r&&y)&&b>0&&!g&&(B+=" ("+f.formatPercent(c[v]/b)+")"),N.firstChild.textContent=B,N.setAttribute("fill",c[v]>=0?"royalBlue":"fireBrick")}cm.setupLegendItemsLayout(t)}},t.setItemLook=function(t,e,r,i){p.childElements(p.findChildOfType(t,"picture"))[e].setAttribute("fill",i)},t.dataToString=function(t){for(var e=p.findChildOfType(t,"legend"),r=p.childElements(e),i=r.length,n="",a=0;a<i;a++){n+=cm.getChratItemName(t,a)+"\t"+r[a].getAttribute("data")+"\n"}return n},t}(),lm=function(){function t(t){this.chart=t}return t.prototype.setup=function(t){for(var e=p.findChildOfType(t,"picture"),r=p.childElements(p.findChildOfType(t,"legend")).length,i=0;i<r;i++){var n=p.createSvgElement("g");n.setAttribute("stroke","none"),e.appendChild(n),this.chart.addClickTapHandlerToChartItem(n)}},t.prototype.draw=function(t,e){for(var r=p.findChildOfType(t,"pictureback"),i=p.findChildOfType(t,"picture"),n=p.findChildOfType(t,"grid"),a=p.findChildOfType(t,"legend"),o=p.childElements(a),s=f.getFloatAttribute(r,"width"),l=f.getFloatAttribute(r,"height"),u=f.splitSkipEmpty(e," "),c=u.length,h=1/0,d=-1/0,m=1/0,g=-1/0,b=[],v=[],y=[],A=[],T=[],C=[],S=[],E=0;E<c;E++){o[E].setAttribute("data",u[E]);var w=f.splitSkipEmpty(u[E],":");b[E]=parseFloat(w[0]),v[E]=parseFloat(w[1]),T[E]=parseInt(w[2]),y[E]=parseFloat(w[3]),A[E]=parseFloat(w[4]),C[E]=parseInt(w[5]);var k=f.splitSkipEmpty(w[6],"#");b[E]<h&&(h=b[E]),d<v[E]&&(d=v[E]),y[E]<m&&(m=y[E]),g<A[E]&&(g=A[E]);for(var x=[],M=0;M<T[E];M++)"empty"==k[M]?x[M]="empty":x[M]=f.splitSkipEmpty(k[M],"|");S[E]=x}h==1/0&&(h=-1,d=1),m==1/0&&(m=-1,g=1),this.chart.chartScaleAndGrid.recalcChartScale(t,h,d,!1,!1),this.chart.chartScaleAndGrid.recalcChartScale(t,m,g,!0,!1);var O=f.getFloatAttribute(n,"min-x"),I=f.getFloatAttribute(n,"max-x"),_=f.getFloatAttribute(n,"min-y"),L=s/(I-O),P=l/(f.getFloatAttribute(n,"max-y")-_),R=p.childElements(i);for(E=0;E<c;E++){var F=o[E].getAttribute("original-color");p.removeAllChildren(R[E]);var D=(v[E]-b[E])/T[E]*L,N=(A[E]-y[E])/C[E]*P,B=(b[E]-O)*L;for(M=0;M<T[E];M++){if("empty"!=S[E][M])for(var G=(A[E]-_)*P-N,U=0;U<C[E];U++){var H=S[E][M][U];if(H>0){var z=p.createSvgElement("rect"),W=f.increaseTransparency(F,H);f.setMultipleAttributes(z,["x","y","width","height","fill"],[B,G,D,N,W]),R[E].appendChild(z)}G-=N}B+=D}}},t.setItemLook=function(t,e,r,i){var n=p.findChildOfType(t,"picture");p.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t.dataToString=function(t){for(var e=p.findChildOfType(t,"legend"),r=p.childElements(e),i=r.length,n="",a=0;a<i;a++){n+=cm.getChratItemName(t,a),"true"==t.getAttribute("draw-envelopes")&&(n+=" (envelopes)"),n+="\n";var o=r[a].getAttribute("data"),s=f.splitSkipEmpty(o,":"),l=parseFloat(s[0]),u=parseFloat(s[1]),c=parseInt(s[2]),h=parseFloat(s[3]),d=parseFloat(s[4]),m=parseInt(s[5]),g=f.splitSkipEmpty(s[6],"#"),b=(u-l)/c,v=(d-h)/m;n+="\t";for(var y=0;y<m;y++)n+=f.formatNumber(h+v*y,2)+"\t";n+="\n";for(var A=0;A<c;A++){if(n+=f.formatNumber(l+b*A,2)+"\t","empty"==g[A])for(y=0;y<m;y++)n+="0\t";else n+=g[A].replace(/\|/g,"\t");n+="\n"}n+="\n"}return n},t}(),um=function(){function t(t){this.chart=t}return t.prototype.setup=function(t){var e=p.findChildOfType(t,"picture"),r=p.findChildOfType(t,"pictureback"),i=f.getFloatAttribute(r,"height"),n=p.childElements(p.findChildOfType(t,"legend")),a=n.length,o=i/a,s=o*f.getFloatAttribute(t,"bar-width"),l=(o-s)/2;t.setAttribute("rect-height",f.reducePrecision(s).toString());for(var u=0;u<a;u++){n[u].setAttribute("data","empty");var c=p.createSvgElement("g");c.setAttribute("transform","translate(0,"+(u*o+l)+")"),e.appendChild(c),this.chart.addClickTapHandlerToChartItem(c)}},t.prototype.draw=function(e,r){for(var i=p.findChildOfType(e,"pictureback"),n=p.findChildOfType(e,"picture"),a=p.findChildOfType(e,"grid"),o=f.getFloatAttribute(i,"width"),s=hm.mergeData(e,r),l=s.length,u=-1/0,c=0;c<l;c++)if("empty"==s[c])s[c]=[];else{s[c]=f.splitSkipEmpty(s[c],"|");for(var h=0;h<s[c].length;h++)s[c][h]=s[c][h].split(":"),s[c][h][0]=parseFloat(s[c][h][0]),s[c][h][1]=parseFloat(s[c][h][1]);var d=s[c][s[c].length-1][0];u<d&&(u=d)}u==1/0&&(u=0);for(c=0;c<l;c++)0!=s[c].length&&s[c][s[c].length-1][0]<u&&s[c].push([u,s[c][s[c].length-1][1]]);var m,g=f.getFloatAttribute(e,"scale-max-x");m="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(u,g):Math.max(u,g,this.chart.client.getModelTime()),this.chart.chartScaleAndGrid.recalcChartScale(e,m-g,m,!1,!0);var b=f.getFloatAttribute(a,"min-x"),v=o/(f.getFloatAttribute(a,"max-x")-b),y=p.childElements(n),A=f.getFloatAttribute(e,"rect-height"),T=t.colorMapping(e);for(c=0;c<l;c++){var C=y[c],S=p.childElements(C),E=S.length,w=0,k="",x=null;for(h=0;h<s[c].length;h++){var M=s[c][h][0],O=s[c][h][1];if(M<b)x=0,k=T(O);else if(null==x)x=(M-b)*v,k=T(O);else{var I=T(O);if(I!=k||h==s[c].length-1){var _=(M-b)*v,L=void 0;w<E?(L=S[w],w++,L.setAttribute("visibility","inherit")):(L=p.createSvgElement("rect"),C.appendChild(L)),f.setMultipleAttributes(L,["x","width","height","fill"],[f.reducePrecision(x),f.reducePrecision(_-x),A,k]),x=_,k=I}}}for(var P=w;P<E;P++)S[P].setAttribute("visibility","hidden")}},t.colorMapping=function(t){for(var e=t.getAttribute("color-mapping"),r=t.getAttribute("default-color"),i=f.splitSkipEmpty(e," "),n=[],a=[],o=function(t){var e=i[t].split(":"),r=void 0,o=parseFloat(e[1]);switch(e[0]){case"GREATER":r=function(t){return t>o};break;case"GREATER_OR_EQUALS":r=function(t){return t>=o};break;case"LESS":r=function(t){return t<o};break;case"LESS_OR_EQUALS":r=function(t){return t<=o};break;case"EQUALS":r=function(t){return t==o};break;case"NOT_EQUALS":r=function(t){return t!=o}}n[t]=r,a[t]=e[2]},s=0;s<i.length;s++)o(s);return function(t){for(var e=0;e<n.length;e++)if(n[e](t))return a[e];return r}},t.setItemLook=function(t,e,r,i){var n=p.findChildOfType(t,"picture");p.childElements(n)[e].setAttribute("visibility",r?"hidden":"inherit")},t}(),cm=function(){function t(t){this.client=t,this.chartScaleAndGrid=new om(this),this.chart1D=new sm(this),this.chart2D=new hm(this),this.chartHistogram=new am(this),this.chartHistogram2D=new lm(this),this.chartTimeColor=new um(this)}return t.create=function(){return p.cloneElementWithId("chart")},t.prototype.update=function(e,r,i){for(var n=e.getAttribute("type"),a=p.findChildOfType(e,"background"),o=p.findChildOfType(e,"pictureback"),s=p.findChildOfType(e,"pictureselect"),l=p.findChildOfType(e,"picture"),u=p.findChildOfType(e,"pictureborderh"),c=p.findChildOfType(e,"pictureborderw"),h=p.findChildOfType(e,"grid"),d=0;d<r.length;d++)switch(r[d]){case"width":case"height":case"fill":case"stroke":a.setAttribute(r[d],i[d]);break;case"pic-width":case"pic-height":o.setAttribute(r[d].substring(4),i[d]),s.setAttribute(r[d].substring(4),i[d]),l.setAttribute(r[d].substring(4),i[d]);break;case"pic-fill":o.setAttribute(r[d].substring(4),i[d]);break;case"pic-stroke":u.setAttribute(r[d].substring(4),i[d]),c.setAttribute(r[d].substring(4),i[d]);break;case"layout-completed":t.setupChartLayout(e);break;case"grid-pos-x":case"grid-pos-y":case"grid-line-color":case"grid-text-color":h.setAttribute(r[d],i[d]);break;case"grid-completed":"ChartPie"!=n&&(this.chartScaleAndGrid.initChartScaleAndGrid(e,!0),this.chartScaleAndGrid.initChartScaleAndGrid(e,!1));break;case"clear-items":t.clearItems(e);break;case"item":this.addItem(e,i[d]);break;case"items-completed":t.setupLegendItemsLayout(e),this.setupPicture(e);var f=e.getAttribute("selection");f&&t.setSelection(e,f);break;case"data":this.drawPicture(e,i[d]);break;case"selection":t.setSelection(e,i[d]),e.setAttribute(r[d],i[d]);break;default:xm.filterAndSetAttribute(e,r[d],i[d])}},t.setupChartLayout=function(e){var r=e.getAttribute("type"),i=p.findChildOfType(e,"background"),n=p.findChildOfType(e,"pictureback"),a=p.findChildOfType(e,"pictureselect"),o=p.findChildOfType(e,"picture"),s=p.findChildOfType(e,"pictureborderh"),l=p.findChildOfType(e,"pictureborderw"),u=p.findChildOfType(e,"warning"),c=p.findChildOfType(e,"legend"),h=p.findChildOfType(e,"controls"),d=e.getAttribute("leg-pos"),m=f.getFloatAttribute(i,"width"),g=f.getFloatAttribute(i,"height"),b=f.getFloatAttribute(e,"pic-offset-x"),v=f.getFloatAttribute(e,"pic-offset-y"),y=f.getFloatAttribute(n,"width"),A=f.getFloatAttribute(n,"height"),T=f.getFloatAttribute(e,"leg-size"),C=0,S=0,E=0,w=0;switch(d){case"SOUTH":C=b,S=g-T,E=m-b,w=T;break;case"WEST":b+=T,C=0,S=v,E=T,w=g-v;break;case"EAST":C=m-T,S=v,E=T,w=g-v;break;case"NORTH":v+=T,C=b,S=0,E=m-b,w=T}if(f.setMultipleAttributes(n,["x","y"],[b,v]),f.setMultipleAttributes(a,["x","y"],[b,v]),f.setMultipleAttributes(o,["x","y"],[b,v]),f.setMultipleAttributes(u,["x","y"],[b+y/2,v+A/2+3]),h.setAttribute("transform","translate("+(b+y)+","+v+")"),"NONE"==d?c.setAttribute("visibility","hidden"):(c.setAttribute("transform","translate("+C+","+S+")"),f.setMultipleAttributes(c,["width","height"],[E,w])),"ChartPie"==r){var k=y/2,x=A/2,M=p.createSvgElement("ellipse");f.setMultipleAttributes(M,["cx","cy","rx","ry","stroke","fill","visibility"],[b+k,v+x,k,x,"none",n.getAttribute("fill"),"hidden"]),e.insertBefore(M,n);var O=p.createSvgElement("ellipse");f.setMultipleAttributes(O,["cx","cy","rx","ry","stroke","fill"],[b+k,v+x,k,x,s.getAttribute("stroke"),"none"]),e.insertBefore(O,s),p.removeElement(s),p.removeElement(l)}var I=Mf.create("icon-copy","rgba(220,220,220,0.7)","Black","DimGray","White",function(r){return t.copyToClipboard(e)},null);I.setAttribute("transform","translate(-20,0)"),h.appendChild(I),e.addEventListener("mouseover",function(e){return t.selectChart(e,!0)}),e.addEventListener("mouseout",function(e){return t.selectChart(e,!1)})},t.setupLegendItemsLayout=function(t){for(var e=p.findChildOfType(t,"legend"),r=p.childElements(e),i=f.getFloatAttribute(e,"width"),n=0,a=0,o=0;o<r.length;o++){var s=r[o],l=p.findChildOfType(s,"back"),u=f.getFloatAttribute(l,"width"),c=p.findChildOfType(s,"value"),h=6*c.firstChild.textContent.length,d=Math.max(u,f.getFloatAttribute(c,"x")+h);d>u&&l.setAttribute("width",d.toString()),0<n&&i<n+d&&(n=0,a+=20),s.setAttribute("transform","translate("+n+","+a+")"),n+=d+5}},t.showChartWarning=function(t,e){var r=p.findChildOfType(t,"warning");r.firstChild.textContent=e,r.setAttribute("visibility","inherit")},t.hideChartWarning=function(t){var e=p.findChildOfType(t,"warning");"hidden"!=e.getAttribute("visibility")&&e.setAttribute("visibility","hidden")},t.clearItems=function(t){var e=p.findChildOfType(t,"picture"),r=p.findChildOfType(t,"legend");p.removeAllChildren(r),p.removeAllChildren(e)},t.prototype.addItem=function(t,e){var r=t.getAttribute("type"),i=p.findChildOfType(t,"legend"),n=e.split("\n"),a=n[0],o=n[1],s=p.cloneElementWithId("legend-item"),l=p.findChildOfType(s,"color"),u=p.findChildOfType(s,"name"),c=p.findChildOfType(s,"value");l.setAttribute("fill",a),s.setAttribute("original-color",a),u.setAttribute("fill",t.getAttribute("leg-text-color")),u.appendChild(p.createTextNode(o)),c.appendChild(p.createTextNode("")),i.appendChild(s);var h=u.getComputedTextLength();c.setAttribute("x",(f.getFloatAttribute(u,"x")+h+4).toString()),"ChartPlot"==r||"ChartTimePlot"==r?f.setMultipleAttributes(s,["draw-line","line-width","interpolation","point-style","fill-under-line"],[n[2],n[3],n[4],n[5],n[6]]):"ChartHistogram"==r&&f.setMultipleAttributes(s,["cdf-color","cdf-line-width","mean-color","low-color","high-color"],[n[2],n[3],n[4],n[5],n[6]]),this.addClickTapHandlerToChartItem(s)},t.prototype.setupPicture=function(t){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.setup(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.setup(t);break;case"ChartTimeColor":this.chartTimeColor.setup(t);break;case"ChartHistogram":this.chartHistogram.setup(t);break;case"ChartHistogram2D":this.chartHistogram2D.setup(t)}},t.prototype.drawPicture=function(t,e){switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":this.chart1D.draw(t,e);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":this.chart2D.draw(t,e);break;case"ChartHistogram":this.chartHistogram.draw(t,e);break;case"ChartHistogram2D":this.chartHistogram2D.draw(t,e);break;case"ChartTimeColor":this.chartTimeColor.draw(t,e)}},t.setSelection=function(e,r){var i=f.splitSkipEmpty(r," ").map(function(t){return"true"==t}),n=!1;i.forEach(function(t){n=n||t});for(var a=p.childElements(p.findChildOfType(e,"legend")),o=0;o<a.length;o++){var s=a[o],l=o<i.length&&i[o];s.setAttribute("selected",l?"true":"false"),t.setChartItemLook(e,o,!l&&n,l)}},t.selectChart=function(t,e){var r=t.currentTarget,i=r.getAttribute("type"),n=p.findChildOfType(r,"pictureselect"),a=p.findChildOfType(r,"controls");"ChartPie"!=i&&n.setAttribute("visibility",e?"inherit":"hidden"),a.setAttribute("class",e?"shown-with-transition":"hidden-with-transition")},t.prototype.addClickTapHandlerToChartItem=function(t){var e=this;new m(t,function(r){return e.selectChartItem(t,!0,!1,r)},function(r){return e.selectChartItem(t,!1,!1,r)},null,function(r){return e.selectChartItem(t,!0,!0,r)},null)},t.prototype.selectChartItem=function(e,r,i,n){for(var a=t.getChartShape(e),o=f.indexInParent(e),s=p.childElements(p.findChildOfType(a,"legend")),l=s[o],u="true"==l.getAttribute("selected"),c=!1,h=0;h<s.length;h++)if(h!=o&&"true"==s[h].getAttribute("selected")){c=!0;break}if(r&&"legend"!=e.parentNode.getAttribute("type")){var d=n,m=t.getChratItemName(a,o);this.client.showTooltip(m,d.clientX,d.clientY,"Black","White")}else this.client.hideTooltip();if(i){u=!u,l.setAttribute("selected",u?"true":"false"),t.setChartItemLook(a,o,!1,u);var g="";for(h=0;h<s.length;h++)"true"==s[h].getAttribute("selected")&&(g+=h+" ");this.client.postUserAction(a.id,"setselection "+g)}else if(u||c){if(u)return;t.setChartItemLook(a,o,!r,r)}else{t.setChartItemLook(a,o,!1,r);for(h=0;h<s.length;h++)h!=o&&t.setChartItemLook(a,h,r,!1)}},t.setChartItemLook=function(e,r,i,n){var a=p.childElements(p.findChildOfType(e,"legend")),o=p.findChildOfType(a[r],"back"),s=p.findChildOfType(a[r],"color");o.setAttribute("class",n?"legend-item-background-selected":"legend-item-background");var l=i?t.colorItemGrayed:a[r].getAttribute("original-color");switch(s.setAttribute("fill",l),e.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":sm.setItemLook(e,r,i,l);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":hm.setItemLook(e,r,i,l);break;case"ChartTimeColor":um.setItemLook(e,r,i,l);break;case"ChartHistogram":am.setItemLook(e,r,i,l);break;case"ChartHistogram2D":lm.setItemLook(e,r,i,l)}},t.copyToClipboard=function(t){var e;switch(t.getAttribute("type")){case"ChartBar":case"ChartStack":case"ChartPie":e=sm.dataToString(t);break;case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":e=hm.dataToString(t);break;case"ChartHistogram":e=am.dataToString(t);break;case"ChartHistogram2D":e=lm.dataToString(t)}f.copyToClipboard(e)},t.datasetToString=function(t,e){return"\t"+t+"\n"+(e=(e=e.replace(/\|/g,"\n")).replace(/:/g,"\t"))},t.datasetsWithSharedXToString=function(t,e){for(var r=e.length,i=e,n=0;n<r;n++)if("empty"==i[n])i[n]=[];else{i[n]=f.splitSkipEmpty(i[n],"|");for(var a=0;a<i[n].length;a++)i[n][a]=i[n][a].split(":")}var o="";for(n=0;n<r;n++)o+="\t"+t[n];o+="\n";var s=new Array(r);for(s.fill(0);;){var l=1/0;for(n=0;n<r;n++)s[n]<e[n].length&&parseFloat(e[n][s[n]][0])<l&&(l=parseFloat(e[n][s[n]][0]));if(l==1/0)return o;o+=l;for(n=0;n<r;n++)o+="\t",s[n]<e[n].length&&parseFloat(e[n][s[n]][0])==l&&(o+=e[n][s[n]][1],s[n]++);o+="\n"}},t.getChartShape=function(t){for(var e=t,r=e.getAttribute("type");"picture"!=r&&"legend"!=r;)r=(e=e.parentNode).getAttribute("type");return e.parentNode},t.getChratItemName=function(t,e){var r=p.findChildOfType(t,"legend"),i=p.childElements(r);return p.findChildOfType(i[e],"name").firstChild.textContent},t.chartTypes=["ChartBar","ChartStack","ChartPie","ChartPlot","ChartTimePlot","ChartTimeStack"],t.colorItemGrayed="rgba(128,128,128,0.5)",t.chartTolerance=1,t}(),hm=function(){function t(t){this.chart=t}return t.prototype.setup=function(e){for(var r=e.getAttribute("type"),i=p.findChildOfType(e,"picture"),n=p.childElements(p.findChildOfType(e,"legend")),a=n.length,o=0;o<a;o++){var s=n[o].getAttribute("original-color"),l=p.createSvgElement("g");switch(n[o].setAttribute("data","empty"),r){case"ChartPlot":case"ChartTimePlot":if("true"==n[o].getAttribute("draw-line")){var u=p.createSvgElement("polyline");if(u.setAttribute("fill","none"),u.setAttribute("stroke",s),u.setAttribute("stroke-width",n[o].getAttribute("line-width")),l.appendChild(u),"true"==n[o].getAttribute("fill-under-line")){var c=p.createSvgElement("polyline");c.setAttribute("stroke","none"),c.setAttribute("fill",f.increaseTransparency(s,t.timePlotAlpha)),l.appendChild(c)}}if("POINT_NONE"!=n[o].getAttribute("point-style")){var h=p.createSvgElement("g");h.setAttribute("fill",s),l.appendChild(h)}break;case"ChartTimeStack":var d=p.createSvgElement("polyline");d.setAttribute("stroke-width","1"),d.setAttribute("stroke",s),d.setAttribute("fill","none"),l.appendChild(d);var m=p.createSvgElement("polyline");m.setAttribute("stroke","none"),m.setAttribute("fill",f.increaseTransparency(s,t.stackChartAlpha)),l.appendChild(m)}i.appendChild(l),this.chart.addClickTapHandlerToChartItem(l)}},t.prototype.draw=function(e,r){var i=e.getAttribute("type"),n=p.findChildOfType(e,"pictureback"),a=p.findChildOfType(e,"picture"),o=p.findChildOfType(e,"grid"),s=p.childElements(p.findChildOfType(e,"legend")),l=f.getFloatAttribute(n,"width"),u=f.getFloatAttribute(n,"height"),c=u,h=t.mergeData(e,r),d=h.length,m=t.parseDataAndFindMinMax(h),g=m.datasets,b=m.minx,v=m.maxx,y=m.miny,A=m.maxy;if("ChartTimeStack"==i&&y<0)cm.showChartWarning(e,"Neg!");else{cm.hideChartWarning(e),"ChartTimeStack"==i&&(y=0,A=t.prepareChartTimeStackData(g));var T,C=e.getAttribute("scale-type-x"),S=e.getAttribute("scale-type-y"),E="SCALE_100_PERCENT"==S;if("SCALE_AUTO"==C)this.chart.chartScaleAndGrid.recalcChartScale(e,b,v,!1,!1);else if("SCALE_TIME_WINDOW"==C){T=f.getFloatAttribute(e,"scale-max-x");var w=void 0;w="WINDOW_MOVES_WITH_DATA"==e.getAttribute("time-window-movement-type")?Math.max(v,T):Math.max(v,T,this.chart.client.getModelTime()),this.chart.chartScaleAndGrid.recalcChartScale(e,w-T,w,!1,!0)}"SCALE_AUTO"==S&&this.chart.chartScaleAndGrid.recalcChartScale(e,y,A,!0,!1);for(var k=f.getFloatAttribute(o,"min-x"),x=f.getFloatAttribute(o,"max-x"),M=f.getFloatAttribute(o,"min-y"),O=f.getFloatAttribute(o,"max-y"),I=l/(x-k),_=u/(O-M),L=p.childElements(a),P="",R=0;R<d;R++){var F=void 0,D=void 0,N=void 0,B=void 0,G=void 0,U=void 0,H=void 0,z=void 0,W=void 0;if("ChartPlot"!=i&&"ChartTimePlot"!=i||(F="true"==s[R].getAttribute("draw-line"),D=s[R].getAttribute("point-style"),N="INTERPOLATION_STEP"==s[R].getAttribute("interpolation")),(F||"ChartTimeStack"==i)&&(G=(B=L[R].firstElementChild).nextElementSibling),D&&"POINT_NONE"!=D)switch(U=L[R].lastElementChild,D){case"POINT_CIRCLE":H="plot-point-circle",z=0,W=0;break;case"POINT_SQUARE":H="plot-point-square",z=-1.5,W=-1.5;break;case"POINT_TRIANGLE":H="plot-point-triangle",z=0,W=0}for(var V=void 0,Y=void 0,j="",X="",q=void 0,Z=void 0,K=0,Q=0;Q<g[R].length;Q++){var J=(g[R][Q][0]-k)*I,$=void 0;if(E){var tt=g[d-1][Q][1];$=tt<=0?0:g[R][Q][1]/tt}else $=g[R][Q][1];var et=(-$+O)*_;if(J<0&&(J=0),l<J&&(J=l),et<0&&(et=0),u<et&&(et=u),!(null!=V&&Math.abs(J-V)<cm.chartTolerance&&Math.abs(et-Y)<cm.chartTolerance)){if(J=f.reducePrecision(J),et=f.reducePrecision(et),0==Q&&(q=J),Z=J,B&&(N&&null!=V&&(j+=J+","+Y+" "),j+=J+","+et+" ",G&&(0==R&&(P=J+","+c+" "+P),X=J+","+et+" "+X)),U){var rt=p.childElements(U)[K];rt?rt.setAttribute("visibility","inherit"):(rt=p.createUseElement(H),U.appendChild(rt)),rt.setAttribute("x",z+J),rt.setAttribute("y",W+et)}K++,V=J,Y=et}}if(B&&(B.setAttribute("points",j),G))if("ChartTimePlot"==i){var it="";if(""!=j){var nt=O*_;nt<0&&(nt=0),u<nt&&(nt=u),it=Z+","+nt+" "+q+","+nt}G.setAttribute("points",j+it)}else G.setAttribute("points",j+P),P=X;if(U){var at=p.childElements(U);for(Q=K;Q<at.length;Q++)at[Q].setAttribute("visibility","hidden")}}}},t.setItemLook=function(e,r,i,n){var a=e.getAttribute("type"),o=p.childElements(p.findChildOfType(e,"legend")),s=p.childElements(p.findChildOfType(e,"picture"));if("ChartTimeStack"==a)s[r].firstElementChild.setAttribute("stroke",n),s[r].lastElementChild.setAttribute("fill",f.increaseTransparency(n,t.stackChartAlpha));else{if("true"==o[r].getAttribute("draw-line")){var l=s[r].firstElementChild;l.setAttribute("stroke",n);var u=l.nextElementSibling;u&&u.setAttribute("fill",f.increaseTransparency(n,t.timePlotAlpha))}"POINT_NONE"!=o[r].getAttribute("point-style")&&s[r].lastElementChild.setAttribute("fill",n)}},t.mergeData=function(e,r){for(var i=p.findChildOfType(e,"legend"),n=p.childElements(i),a=f.splitSkipEmpty(r," "),o=a.length,s=[],l=0;l<o;l++){var u=n[l].getAttribute("data"),c=t.mergeDataset(u,a[l]);n[l].setAttribute("data",c),s.push(c)}return s},t.mergeDataset=function(t,e){var r=f.splitSkipEmpty(e,"#"),i=parseInt(r[0]),n=parseInt(r[1]),a=r[2];if("empty"==t||0==n)return a;var o=f.splitSkipEmpty(t,"|");o.splice(0,i),o.splice(n);var s=o.join("|")+"|";return"empty"==a?s:s+a},t.parseDataAndFindMinMax=function(t){for(var e=t,r=e.length,i=1/0,n=-1/0,a=1/0,o=-1/0,s=0;s<r;s++)if("empty"==e[s])e[s]=[];else{e[s]=f.splitSkipEmpty(e[s],"|");for(var l=0;l<e[s].length;l++){e[s][l]=e[s][l].split(":");var u=e[s][l][0]=parseFloat(e[s][l][0]),c=e[s][l][1]=parseFloat(e[s][l][1]);u<i&&(i=u),n<u&&(n=u),c<a&&(a=c),o<c&&(o=c)}}return i==1/0&&(i=0,n=0),a==1/0&&(a=0,o=0),{datasets:e,minx:i,maxx:n,miny:a,maxy:o}},t.prepareChartTimeStackData=function(t){for(var e=t.length,r=-1/0,i=0;;){for(var n=1/0,a=0;a<e;a++)i<t[a].length&&t[a][i][0]<n&&(n=t[a][i][0],a);if(n==1/0)break;for(a=0;a<e;a++)if(t[a].length<=i||t[a][i][0]!=n){var o=0==i?0:t[a][i-1][1];t[a].splice(i,0,[n,o])}i++}if(e>0)for(var s=0;s<t[0].length;s++){var l=0;for(a=0;a<e;a++)t[a][s][1]+=l,r<(l=t[a][s][1])&&(r=l)}return r},t.dataToString=function(t){var e=t.getAttribute("type"),r=p.findChildOfType(t,"legend"),i=p.childElements(r),n=i.length;if("ChartPlot"==e){for(var a="",o=0;o<n;o++){var s=cm.getChratItemName(t,o),l=i[o].getAttribute("data");a+=cm.datasetToString(s,l)+"\n"}return a}var u=new Array(n);for(l=new Array(n),o=0;o<n;o++)u[o]=cm.getChratItemName(t,o),l[o]=i[o].getAttribute("data");return cm.datasetsWithSharedXToString(u,l)},t.stackChartAlpha=.7,t.timePlotAlpha=.3,t}(),dm=function(){function t(t){this.resizing=!1,this.moving=!1,this.scrolling=!1,this.frameDrawing=t}return t.prototype.create=function(){var e=this,r=p.cloneElementWithId("shape-inspect"),i=p.findChildOfType(r,"svg"),n=p.findChildOfType(i,"info"),a=p.findChildOfType(i,"chart"),o=p.findChildOfType(i,"controls"),s=Mf.create("icon-info","Moccasin","DarkRed","Wheat","DarkRed",function(){p.bringElementToFront(r),n.setAttribute("class","shown-with-transition"),a.setAttribute("class","hidden-with-transition")},null);s.setAttribute("type","show-info"),s.setAttribute("transform","translate(-80,0)"),o.appendChild(s);var l=Mf.create("icon-chart","Ivory","DarkRed","Beige","DarkRed",function(){p.bringElementToFront(r),n.setAttribute("class","hidden-with-transition"),a.setAttribute("class","shown-with-transition")},null);l.setAttribute("type","show-chart"),l.setAttribute("transform","translate(-60,0)"),o.appendChild(l);var u=Mf.create("icon-copy","LightSalmon","DarkRed","IndianRed","White",function(){p.bringElementToFront(r),t.copyInspect(r)},null);u.setAttribute("transform","translate(-40,0)"),o.appendChild(u);var c=Mf.create("icon-close","LightSalmon","DarkRed","IndianRed","White",function(){return e.closeInspct(r)},null);c.setAttribute("transform","translate(-20,0)"),o.appendChild(c);var h=function(t){return e.onInspectEvent(t)};return r.addEventListener("mouseover",h),r.addEventListener("mouseout",h),r.addEventListener("mousedown",h),r.addEventListener("wheel",h),r.addEventListener("touchstart",h),r},t.prototype.update=function(e,r,i){for(var n=p.findChildOfType(e,"svg"),a=p.findChildOfType(n,"name-text"),o=p.findChildOfType(n,"info"),s=p.findChildOfType(o,"info-text"),l=0;l<r.length;l++)switch(r[l]){case"name":a.firstChild.textContent=i[l];break;case"info":var u=p.findChildOfType(n,"chart");s.setAttribute("content",i[l]);for(var c=i[l].split("\n"),h=0;h<c.length;h++)c[h]=f.replaceTabsWithSpaces(c[h],8);if(em.drawMultiLineText(s,c,12,0),c.length<=2&&null==u){var d=f.getFloatAttribute(n,"height");t.resizeInspect(e,0,60-d)}else t.scrollInfoText(e,0);break;case"editable-as":s.setAttribute("class","inspect-info-text-editable"),e.setAttribute(r[l],i[l]);break;case"dataset-names":var m=f.splitSkipEmpty(i[l]," ");u=p.findChildOfType(n,"chart");var g=p.findChildOfType(u,"plot"),b=m.length;if(0==b){p.removeElement(u);var v=p.findChildOfType(n,"controls"),y=p.findChildOfType(v,"show-info"),A=p.findChildOfType(v,"show-chart");p.removeElement(y),p.removeElement(A)}else{var T=p.findChildOfType(g,"picture");for(h=0;h<b;h++){var C=p.cloneElementWithId("inspect-plot-item");C.setAttribute("name",m[h]);var S=t.plotColors[h%t.plotColors.length];C.setAttribute("stroke",S),T.appendChild(C)}}break;case"data":u=p.findChildOfType(n,"chart"),g=p.findChildOfType(u,"plot");var E=p.findChildOfType(g,"picture"),w=p.childElements(E),k=f.splitSkipEmpty(i[l]," ");b=k.length;var x=[];for(h=0;h<b;h++){var M=w[h].getAttribute("data"),O=hm.mergeDataset(M,k[h]);w[h].setAttribute("data",O),x.push(O)}var I=hm.parseDataAndFindMinMax(x),_=I.datasets,L=I.minx,P=I.maxx,R=I.miny,F=I.maxy;t.recalcChartScaleAndDrawGrid(u,L,P,!1,!1),t.recalcChartScaleAndDrawGrid(u,R,F,!0,!1),t.drawPlotLines(u,_);break;default:if(xm.filterAndSetAttribute(e,r[l],i[l]),"pos"==r[l]){var D=this.frameDrawing.client.svgContainer.getBoundingClientRect(),N=f.getFloatAttribute(n,"height"),B=n.getBoundingClientRect(),G=B.height/N,U=B.right>D.right?-(B.right-D.right)/G:0,H=B.bottom>D.bottom?-(B.bottom-D.bottom)/G:0;0==U&&0==H||t.moveInspect(e,U,H)}}},t.recalcChartScaleAndDrawGrid=function(e,r,i,n,a){var o=p.findChildOfType(e,"plot"),s=p.findChildOfType(o,"grid"),l=n?"min-y":"min-x",u=n?"max-y":"max-x",c=r,h=i;c==h&&(c-=1,h+=1);var d=p.findChildOfType(e,"chart-back"),m=f.getFloatAttribute(d,n?"height":"width")-(n?17:10),g=n?25:45,b=f.goodGridStep(h-c,m,g);c=Math.floor(c/b)*b,h=Math.ceil(h/b)*b,(a||c!=f.getFloatAttribute(s,l)||h!=f.getFloatAttribute(s,u))&&(f.setMultipleAttributes(s,[l,u],[c,h]),t.drawChartGrid(e,c,h,b,n))},t.drawChartGrid=function(t,e,r,i,n){for(var a=p.findChildOfType(t,"plot"),o=p.findChildOfType(a,"grid"),s=n?o.lastElementChild:o.firstElementChild,l=p.findChildOfType(o,"zero-line"),u=p.findChildOfType(t,"chart-back"),c=Math.round((r-e)/i)+1,h=f.getFloatAttribute(u,"width")-10,d=f.getFloatAttribute(u,"height")-17,m=(n?d:h)/(r-e),g=i*m;s.childElementCount<c;){var b=p.cloneElementWithId("inspect-grid-item");s.appendChild(b)}for(var v=p.childElements(s),y=e,A=n?(r-e)*m:0,T=!1,C=0;C<c;C++){var S=n?0:A,E=n?A:d,w=n?h:A,k=n?A:0,x=n?S+1:S,M=n?0==C?E-2:C==c-1?E+8:E-3:E+9,O=n?"start":0==C?"start":C==c-1?"end":"middle";(b=v[C]).setAttribute("visibility","inherit");var I=b.lastElementChild;f.setMultipleAttributes(I,["x1","x2","y1","y2"],[S,w,E,k]),n&&Math.abs(y)<i/10&&(f.setMultipleAttributes(l,["x1","x2","y1","y2"],[S,w,E,k]),T=!0);var _=b.firstElementChild;f.setMultipleAttributes(_,["x","y","text-anchor"],[x,M,O]),_.firstChild.textContent=f.formatNumber(y,2),y+=i,A+=n?-g:+g}for(C=c;C<v.length;C++)v[C].setAttribute("visibility","hidden");n&&l.setAttribute("visibility",T?"inherit":"hidden")},t.drawPlotLines=function(t,e){for(var r=p.findChildOfType(t,"plot"),i=p.findChildOfType(t,"chart-back"),n=p.findChildOfType(r,"picture"),a=p.findChildOfType(r,"grid"),o=f.getFloatAttribute(i,"width")-10,s=f.getFloatAttribute(i,"height")-17,l=f.getFloatAttribute(a,"min-x"),u=f.getFloatAttribute(a,"max-x"),c=f.getFloatAttribute(a,"min-y"),h=f.getFloatAttribute(a,"max-y"),d=o/(u-l),m=s/(h-c),g=p.childElements(n),b=g.length,v=0;v<b;v++){for(var y=void 0,A=void 0,T="",C=0;C<e[v].length;C++){var S=0+(e[v][C][0]-l)*d,E=0+(-e[v][C][1]+h)*m;S<0&&(S=0),0+o<S&&(S=0+o),E<0&&(E=0),0+s<E&&(E=0+s),null!=y&&Math.abs(S-y)<cm.chartTolerance&&Math.abs(E-A)<cm.chartTolerance||(T+=(S=f.reducePrecision(S))+","+(E=f.reducePrecision(E))+" ",0,y=S,A=E)}g[v].setAttribute("points",T)}},t.redrawChart=function(e){var r=p.findChildOfType(e,"plot");if(null!=r){for(var i=p.findChildOfType(r,"picture"),n=p.childElements(i),a=n.length,o=[],s=0;s<a;s++){var l=n[s].getAttribute("data");o.push(l)}var u=hm.parseDataAndFindMinMax(o),c=u.datasets,h=u.minx,d=u.maxx,f=u.miny,m=u.maxy;t.recalcChartScaleAndDrawGrid(e,h,d,!1,!0),t.recalcChartScaleAndDrawGrid(e,f,m,!0,!0),t.drawPlotLines(e,c)}},t.prototype.onInspectEvent=function(e){var r=e.currentTarget,i=e.target,n=p.findChildOfType(r,"svg"),a=p.findChildOfType(n,"info"),o=p.findChildOfType(a,"info-back"),s="inherit"==p.findChildOfType(a,"scrollbar").getAttribute("visibility");if(e instanceof MouseEvent){var l=e;switch(e.type){case"mouseover":e.stopPropagation(),this.onInspectMouseOver(r,e);break;case"mouseout":this.onInspectMouseOut(r,l);break;case"mousedown":1==l.which&&(l.stopPropagation(),l.preventDefault(),this.onInspectMouseDown(r,l));break;case"wheel":if(!l.altKey&&!l.ctrlKey&&i==o&&s){var u=e;e.stopPropagation(),e.preventDefault(),t.scrollInfoText(r,u.deltaY<0?36:-36)}}}else if(f.touchEventExists()&&e instanceof TouchEvent){var c=e;if(c.touches.length>1)return;switch(c.type){case"touchstart":c.stopPropagation(),c.preventDefault(),this.onInspectMouseOver(r,c),this.onInspectMouseDown(r,c)}}},t.prototype.onInspectMouseOver=function(t,e){if(!(this.resizing||this.moving||this.scrolling)){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"name-back"),n=p.findChildOfType(r,"controls"),a=p.findChildOfType(n,"resize"),o=p.findChildOfType(r,"chart"),s=null==o?null:p.findChildOfType(o,"plot"),l=null==s?null:p.findChildOfType(s,"picture"),u=e.target;if(u==a)a.setAttribute("fill","IndianRed"),a.style.cursor="nw-resize";else if(u==i)i.setAttribute("fill","rgb(197,163,120)"),i.style.cursor="move";else if(u.parentNode==l){var c=void 0,h=void 0;if(e instanceof MouseEvent){var d=e;c=d.clientX,h=d.clientY}else{var m=e;c=m.touches[0].clientX,h=m.touches[0].clientY}var g=u.getAttribute("name"),b=f.removeTransparency(u.getAttribute("stroke"));this.frameDrawing.client.showTooltip(g,c,h,b,"White")}n.setAttribute("class","shown-with-transition")}},t.prototype.onInspectMouseOut=function(t,e){if(!(this.resizing||this.moving||this.scrolling)){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"name-back"),n=p.findChildOfType(r,"controls"),a=p.findChildOfType(n,"resize"),o=e.target;o==a?a.setAttribute("fill","LightSalmon"):o==i&&i.setAttribute("fill","BurlyWood"),this.frameDrawing.client.hideTooltip(),e instanceof MouseEvent&&!t.contains(e.relatedTarget)&&n.setAttribute("class","hidden-with-transition")}},t.prototype.onInspectMouseDown=function(e,r){var i=this,n=p.findChildOfType(e,"svg"),a=p.findChildOfType(n,"info"),o=p.findChildOfType(n,"name-back"),s=p.findChildOfType(n,"controls"),l=p.findChildOfType(a,"info-back"),u=p.findChildOfType(a,"info-text"),c=p.findChildOfType(a,"scrollbar"),h=p.findChildOfType(s,"resize"),d="inherit"==c.getAttribute("visibility"),m=f.getFloatAttribute(o,"height"),g=o.getBoundingClientRect().height/m;p.bringElementToFront(e);var b=r.target;if(b==h||b==o||b==l&&d){b==h?this.resizing=!0:b==o?this.moving=!0:b==l&&d&&(this.scrolling=!0);var v=void 0,y=void 0;if(r instanceof MouseEvent){var A=r;v=A.pageX,y=A.pageY}else{var T=r;v=T.touches[0].pageX,y=T.touches[0].pageY}new xf(v,y,function(r,n,a){var o=n/g,s=a/g;if(i.resizing){var l=t.resizeInspect(e,o,s);return[l[0]*g,l[1]*g]}return i.moving?(t.moveInspect(e,o,s),[n,a]):i.scrolling?[0,t.scrollInfoText(e,s)*g]:void 0},function(t){i.resizing=!1,i.moving=!1,i.scrolling=!1,i.onInspectMouseOut(e,t)},this.resizing?"nw-resize":this.scrolling?"ns-resize":"move")}else u.contains(b)&&this.editInspect(e)},t.resizeInspect=function(e,r,i){var n=p.findChildOfType(e,"svg-shadow"),a=p.findChildOfType(e,"svg"),o=p.findChildOfType(a,"info"),s=p.findChildOfType(a,"chart"),l=p.findChildOfType(a,"name-back"),u=p.findChildOfType(a,"controls"),c=p.findChildOfType(o,"info-back"),h=p.findChildOfType(o,"scrollbar"),d=p.findChildOfType(u,"resize"),m=null==s?null:p.findChildOfType(s,"chart-back"),g=f.getFloatAttribute(l,"height"),b=f.getFloatAttribute(a,"width"),v=f.getFloatAttribute(a,"height"),y=Math.max(100,b+r),A=Math.max(60,v+i);return f.setMultipleAttributes(n,["width","height"],[y,A]),f.setMultipleAttributes(a,["width","height"],[y,A]),f.setMultipleAttributes(c,["width","height"],[y,A-g]),null!=m&&f.setMultipleAttributes(m,["width","height"],[y,A-g]),l.setAttribute("width",y.toString()),h.setAttribute("x",(y-10).toString()),u.setAttribute("transform","translate("+y+")"),d.setAttribute("transform","translate(0,"+A+")"),t.scrollInfoText(e,0),null!=s&&t.redrawChart(s),t.updateArrow(e),[y-b,A-v]},t.moveInspect=function(e,r,i){var n=p.findChildOfType(e,"svg-shadow"),a=p.findChildOfType(e,"svg"),o=f.getFloatAttribute(a,"x")+r,s=f.getFloatAttribute(a,"y")+i;f.setMultipleAttributes(n,["x","y"],[o,s]),f.setMultipleAttributes(a,["x","y"],[o,s]),t.updateArrow(e)},t.updateArrow=function(t){var e,r,i=p.findChildOfType(t,"arrow"),n=p.findChildOfType(t,"svg"),a=f.getFloatAttribute(n,"x"),o=f.getFloatAttribute(n,"y"),s=f.getFloatAttribute(n,"width"),l=f.getFloatAttribute(n,"height"),u=s/2,c=l/2;a>=0&&o>=0?(e=a+5,r=o+5):a>=0&&o<0&&o+l>=0?(e=a+5,r=(o+c)/c*5):a>=0&&o+l<0?(e=a+5,r=o+l-5):a<0&&a+s>=0&&o+l<0?(e=(a+u)/u*5,r=o+l-5):a+s<0&&o+l<0?(e=a+s-5,r=o+l-5):a+s<0&&o<0&&o+l>=0?(e=a+s-5,r=(o+c)/c*5):a+s<0&&o>=0?(e=a+s-5,r=o+5):a<0&&a+s>=0&&o>=0?(e=(a+u)/u*5,r=o+5):(e=0,r=0);var h=f.radiansToDegrees(Math.atan2(r,e)),d=Math.sqrt(e*e+r*r)/10;i.setAttribute("transform","rotate("+h+") scale("+d+",1)")},t.scrollInfoText=function(t,e){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"info"),n=p.findChildOfType(i,"info-back"),a=p.findChildOfType(i,"info-text"),o=p.findChildOfType(i,"scrollbar"),s=f.getFloatAttribute(n,"height"),l=12*(a.childElementCount+1),u=f.getFloatAttribute(a,"y"),c=u+e;if(c=Math.max(12+s-l,c),(c=Math.min(12,c))!=u){a.setAttribute("y",c.toString());for(var h=p.childElements(a),d=0;d<h.length;d++)h[d].setAttribute("y",(c+12*d).toString())}if(l>s){var m=s-14;o.setAttribute("visibility","inherit"),o.setAttribute("y",(4+m*(12-c)/l).toString()),o.setAttribute("height",(m*s/l+6).toString())}else o.setAttribute("visibility","hidden");return c-u},t.copyInspect=function(t){var e,r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"info"),n=p.findChildOfType(r,"chart"),a=p.findChildOfType(i,"info-text"),o=null==n?null:p.findChildOfType(n,"plot"),s=null==o?null:p.findChildOfType(o,"picture");if(null==n||"hidden-with-transition"==n.getAttribute("class"))e=a.getAttribute("content");else{for(var l=p.childElements(s),u=new Array(l.length),c=new Array(l.length),h=0;h<l.length;h++)u[h]=l[h].getAttribute("name"),c[h]=l[h].getAttribute("data");e=cm.datasetsWithSharedXToString(u,c)}f.copyToClipboard(e)},t.prototype.closeInspct=function(t){var e=p.findChildOfType(t,"svg"),r=p.findChildOfType(e,"info"),i=p.findChildOfType(e,"chart"),n=p.findChildOfType(e,"controls");r.removeAttribute("class"),null!=i&&i.removeAttribute("class"),n.removeAttribute("class"),t.setAttribute("visibility","hidden"),this.frameDrawing.client.postUserAction(t.id,"close")},t.prototype.editInspect=function(t){var e=this,r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"info"),n=p.findChildOfType(i,"info-back"),a=p.findChildOfType(i,"info-text"),o=a.getAttribute("content"),s=t.getAttribute("editable-as");"number"==s&&(o=f.parseFloatIgnoreCommas(o).toString()),this.frameDrawing.textInputForSVG.display(o,n,a,"left",function(r){"number"==s&&(r=r.replace(/,/g,"")),e.frameDrawing.client.postUserAction(t.id,"setvalue "+r)},16)},t.plotColors=["rgba(106,90,205,0.6)","rgba(178,34,34,0.6)","rgba(25,25,112,0.6)","rgba(0,128,128,0.6)","rgba(85,107,47,0.6)","rgba(70,130,180,0.6)","rgba(65,105,225,0.6)"],t}(),pm=function(){function t(){}return t.createGISMarkup=function(t){switch(t){case"MarkupGISPoint":return p.cloneElementWithId("markup-gis-point");case"MarkupGISRegion":return p.cloneElementWithId("markup-gis-region");case"MarkupGISRoute":return p.cloneElementWithId("markup-gis-route")}},t.updateGISMarkup=function(e,r,i){for(var n=0;n<r.length;n++)xm.filterAndSetAttribute(e,r[n],i[n]);t.updateGISMarkupPosition(e),fm.adjustGISPositionX(e)},t.updateGISMarkupPosition=function(t){var e=t.getAttribute("type"),r=p.findParentOfType(t,"ShapeGISMap");switch(e){case"MarkupGISPoint":var i=f.getFloatAttribute(t,"lon"),n=f.getFloatAttribute(t,"lat"),a=fm.lonLatToXY(r,i,n);f.setMultipleAttributes(t,["cx","cy"],[a[0],a[1]]);break;case"MarkupGISRegion":case"MarkupGISRoute":var o=t.getAttribute("lonlatpoints"),s=fm.lonLatPointsToXYPoints(r,o);t.setAttribute("points",s)}},t}(),fm=function(){function t(t){this.initialTouchZoomDistance=0,this.currentTouchZoomDistance=0,this.accumulatedZoomWheelDelta=0,this.client=t}return t.prototype.createShapeGISMap=function(){var e=this,r=p.cloneElementWithId("shape-gis-map"),i=p.findChildOfType(r,"background");return new Nf(r,i,function(t,r,i,n){return e.onDrag(t,r,i,n)},function(t,r,i){return e.onWheel(t,r,i)},function(t,r){return e.onTouchZoomStart(t,r)},function(t,r,i,n){return e.onTouchZoom(t,r,i,n)},function(e){return t.eventIgnoreCondition(e)},function(e){return t.wheelIgnoreCondition(e)}),r},t.prototype.updateShapeGISMap=function(e,r,i){for(var n=this,a=p.findChildOfType(e,"background"),o=p.findChildOfType(e,"map"),s=p.findChildOfType(e,"shadow"),l=p.findChildOfType(e,"border"),u=p.findChildOfType(e,"copyright"),c=p.findChildOfType(o,"layers"),h=p.findChildOfType(c,"shapefiles"),d=function(c){switch(r[c]){case"width":case"height":a.setAttribute(r[c],i[c]),o.setAttribute(r[c],i[c]),s.setAttribute(r[c],i[c]),l.setAttribute(r[c],i[c]),"height"==r[c]&&u.setAttribute("y",(parseFloat(i[c])-5).toString());break;case"size-completed":e.getAttribute("zoom")&&m.redrawGISMap(e);break;case"background-color":a.setAttribute("fill",i[c]);break;case"border-color":l.setAttribute("stroke",i[c]);break;case"map-completed":m.redrawGISMap(e);break;case"shapefile":var d=p.createSvgElement("g");d.setAttribute("type","shapefile"),d.setAttribute("name",i[c]),d.setAttribute("pending-commands",""),h.appendChild(d),m.client.networkManager.getResource(i[c],function(t){n.onShapefileLoaded(t,d)});break;case"shapefiles-properties":for(var g=p.childElements(h),b=f.splitSkipEmpty(i[c]," "),v=0;v<g.length;v++)f.setMultipleAttributes(g[v],["visibility","stroke","fill"],b[v].split("|"));break;case"shape-properties":var y=f.splitSkipEmpty(i[c],"|");null!=(d=t.getShapeFileElement(e,y[0])).firstElementChild?t.applyShapeProperties(d,i[c]):d.setAttribute("pending-commands",d.getAttribute("pending-commands")+i[c]+"#");break;case"tile-url-provider-type":e.setAttribute(r[c],i[c]);var A=t.tileProviderCopyright(i[c]);A&&(u.innerHTML=A,u.onclick=function(){return n.client.openURL(t.tileProviderWebsite(i[c]))});break;default:xm.filterAndSetAttribute(e,r[c],i[c])}},m=this,g=0;g<r.length;g++)d(g)},t.prototype.redrawGISMap=function(e){this.redrawGISTiles(e),t.redrawGISShapefiles(e),t.redrawGISMarkup(e),t.redrawGISAgents(e)},t.prototype.redrawGISTiles=function(e){var r=p.findChildOfType(e,"background"),i=f.getFloatAttribute(r,"width"),n=f.getFloatAttribute(r,"height"),a=t.minGISZoom(i,n),o=p.findChildOfType(e,"map"),s=p.findChildOfType(o,"layers");s.setAttribute("transform","translate(0,0)");var l=f.getIntAttribute(e,"zoom"),u=f.getFloatAttribute(e,"center-lon"),c=f.getFloatAttribute(e,"center-lat");l<a&&(l=a,e.setAttribute("zoom",l.toString()));var h,d=Math.pow(2,l),m=t.latToTileYFloat(c,l),g=n/2/t.tileImageSize;m-g<0?h=g:d<m+g&&(h=d-g),h&&(c=t.tileYToLat(h,l),e.setAttribute("center-lat",c.toString()));var b=p.findChildOfType(s,"tiles");p.removeAllChildren(b),this.updateGISTiles(b,l,c,u,0,0,i,n,d)},t.prototype.updateGISTiles=function(e,r,i,n,a,o,s,l,u){if("false"!=p.findParentOfType(e,"ShapeGISMap").getAttribute("show-tiles")){for(var c=t.lonToTileXInt(n,r),h=t.latToTileYInt(i,r),d=a+s/2-t.lonToXOffsetWithinTile(n,r),m=o+l/2-t.latToYOffsetWithinTile(i,r);d>0;)d-=t.tileImageSize,c--;for(;m>0;)m-=t.tileImageSize,h--;c=f.modulo(c,u),h=f.modulo(h,u);for(var g=[],b=p.childElements(e),v=0;v<b.length;v++)g.push(b[v]);for(var y=c,A=d;A<s;A+=t.tileImageSize){for(var T=h,C=m;C<l;C+=t.tileImageSize){var S=r+"/"+y+"/"+T,E=null;for(v=0;v<g.length;v++)if(g[v].getAttribute("tileid")==S){E=g[v];break}null==E&&(E=this.addGISTile(e,r,y,T)),E.setAttribute("x",(A-a).toString()),E.setAttribute("y",(C-o).toString()),T=f.modulo(T+1,u)}y=f.modulo(y+1,u)}}},t.prototype.addGISTile=function(e,r,i,n){var a=p.findParentOfType(e,"ShapeGISMap"),o=this.tileURL(a,r,i,n),s=p.createSvgElement("image");return s.setAttribute("onerror",'this.setAttributeNS( "http://www.w3.org/1999/xlink", "href", "/assets/svg/images/defaulttile.png" )'),s.setAttribute("width",t.tileImageSize.toString()),s.setAttribute("height",t.tileImageSize.toString()),s.setAttributeNS(p.xlinkns,"href",o),s.setAttribute("tileid",r+"/"+i+"/"+n),e.appendChild(s),s},t.getShapeFileElement=function(t,e){for(var r=p.findChildOfType(t,"map"),i=p.findChildOfType(r,"layers"),n=p.findChildOfType(i,"shapefiles"),a=p.childElements(n),o=0;o<a.length;o++){var s=a[o];if(s.getAttribute("name")==e)return s}return null},t.prototype.onShapefileLoaded=function(e,r){if(!this.client.isStoppedAndShouldIgnoreResponses()&&document.body.contains(r)){r.innerHTML=e.responseText,t.redrawGISShapefile(r),t.adjustX(r,!0);var i=r.getAttribute("pending-commands");if(""!=i){for(var n=0,a=f.splitSkipEmpty(i,"#");n<a.length;n++){var o=a[n];t.applyShapeProperties(r,o)}r.setAttribute("pending-commands","")}}},t.redrawGISShapefiles=function(e){for(var r=p.findChildOfType(e,"map"),i=p.findChildOfType(r,"layers"),n=p.findChildOfType(i,"shapefiles"),a=p.childElements(n),o=0;o<a.length;o++)t.redrawGISShapefile(a[o]),t.adjustX(a[o],!0)},t.redrawGISShapefile=function(e){for(var r=p.findParentOfType(e,"ShapeGISMap"),i=p.childElements(e),n=0;n<i.length;n++){var a=i[n],o=a.getAttribute("lonlatpoints");switch(a.tagName){case"circle":var s=f.splitToFloats(o,","),l=t.lonLatToXY(r,s[0],s[1]);f.setMultipleAttributes(a,["cx","cy"],[l[0],l[1]]);break;case"polyline":case"polygon":var u=t.lonLatPointsToXYPoints(r,o);a.setAttribute("points",u);break;case"path":var c=a.getAttribute("dontdraw"),h=t.lonLatPointsToPathData(r,o,c);a.setAttribute("d",h);break;case"g":t.redrawGISShapefile(a)}}},t.applyShapeProperties=function(t,e){for(var r=f.splitSkipEmpty(e,"|"),i=f.splitToInts(r[1],","),n=p.childElements(t),a=0;a<n.length;a++)i.indexOf(a)>=0&&n[a].setAttribute(r[2],r[3])},t.redrawGISMarkup=function(e){for(var r=p.findChildOfType(e,"map"),i=p.findChildOfType(r,"layers"),n=p.findChildOfType(i,"markup"),a=p.childElements(n),o=0;o<a.length;o++)pm.updateGISMarkupPosition(a[o]);t.adjustX(n,!0)},t.redrawGISAgents=function(e){for(var r=p.findChildOfType(e,"map"),i=p.findChildOfType(r,"layers"),n=p.findChildOfType(i,"agents"),a=p.childElements(n),o=0;o<a.length;o++)t.updateGISAgentScale(a[o]),"hidden"!=a[o].getAttribute("visibility")&&t.updateGISAgentPosition(a[o]);t.adjustX(n,!0)},t.updateGISAgentPosition=function(e){var r=p.findParentOfType(e,"ShapeGISMap"),i=f.getFloatAttribute(e,"lon"),n=f.getFloatAttribute(e,"lat"),a=f.getFloatAttribute(e,"heading"),o=t.lonLatToXY(r,i,n),s="translate("+o[0]+","+o[1]+") rotate("+a+")",l=e.getAttribute("scale");l&&(s+=" scale("+l+")"),e.setAttribute("transform",s)},t.updateGISAgentScale=function(e){var r=p.findParentOfType(e,"ShapeGISMap"),i=f.getIntAttribute(e,"fixed-scale-zoom");if(null!=i){var n=f.getIntAttribute(r,"zoom");if(n<i)return void e.setAttribute("visibility","hidden");e.setAttribute("visibility","inherit");var a=1;if(f.getIntAttribute(e,"real-scale-zoom")<=n){var o=f.getFloatAttribute(e,"pixels-per-meter"),s=f.getFloatAttribute(e,"lat");a=t.pixelsPerGISMeter(n,s)/o}e.setAttribute("scale",a.toString())}},t.adjustGISPositionX=function(e){t.adjustX(e,!1)},t.adjustX=function(e,r){var i=p.findParentOfType(e,"ShapeGISMap"),n=p.findChildOfType(i,"map"),a=p.findChildOfType(n,"layers"),o=t.svgSize(i),s=f.getIntAttribute(i,"zoom"),l=Math.pow(2,s)*t.tileImageSize,u=f.getFloatAttribute(i,"center-lon"),c=f.parseTransform(a.getAttribute("transform"))[0];if(r)for(var h=p.childElements(e),d=0;d<h.length;d++)t.adjustShapeX(h[d],o[0],u,s,c,l);else t.adjustShapeX(e,o[0],u,s,c,l)},t.adjustShapeX=function(e,r,i,n,a,o){var s=0,l=0,u=0,c=1,h=1;if("hidden"!=e.getAttribute("visibility")){var d;if("circle"==e.tagName)d=f.getFloatAttribute(e,"cx");else if("g"==e.tagName){var p=f.parseTransform(e.getAttribute("transform"));s=p[0],l=p[1],u=p[2],c=p[3],h=p[4],d=s}else{var m=f.getFloatAttribute(e,"minlon"),g=f.getFloatAttribute(e,"maxlon");if(null==m||null==g)return;d=(t.lonToXFast(m,r,i,n)+t.lonToXFast(g,r,i,n))/2}d+=a;var b=Math.abs(d-r/2),v=Math.abs(d+o-r/2),y=Math.abs(d-o-r/2),A=0;v<b?A=o:y<b&&(A=-o);var T=f.constructTransform(s+A,l,u,c,h);null==T?e.removeAttribute("transform"):e.setAttribute("transform",T)}},t.prototype.panGIS=function(e,r,i){var n=p.findChildOfType(e,"map"),a=p.findChildOfType(n,"layers"),o=f.parseTransform(a.getAttribute("transform")),s=o[0]+r,l=o[1]+i,u=f.getIntAttribute(e,"zoom"),c=Math.pow(2,u),h=f.getFloatAttribute(e,"center-lon"),d=f.getFloatAttribute(e,"center-lat"),m=t.latToTileYFloat(d,u),g=t.svgSize(e),b=g[1]/2/t.tileImageSize;m-b-l/t.tileImageSize<0?l=(m-b)*t.tileImageSize:c<m+b-l/t.tileImageSize&&(l=(m+b-c)*t.tileImageSize),s=t.normalizedGISX(s,u),s=Math.round(s),l=Math.round(l),a.setAttribute("transform","translate("+s+","+l+")");var v=p.findChildOfType(a,"tiles");this.updateGISTiles(v,u,d,h,s,l,g[0],g[1],c);for(var y=p.findChildOfType(a,"shapefiles"),A=p.childElements(y),T=0;T<A.length;T++)t.adjustX(A[T],!0);var C=p.findChildOfType(a,"markup");t.adjustX(C,!0);var S=p.findChildOfType(a,"agents");t.adjustX(S,!0)},t.prototype.zoomGIS=function(e,r,i,n){var a,o=f.getIntAttribute(e,"zoom");if((r=Math.round(r))>0)a=Math.min(o+r,19);else{var s=p.findChildOfType(e,"background"),l=f.getFloatAttribute(s,"width"),u=f.getFloatAttribute(s,"height");a=Math.max(o+r,t.minGISZoom(l,u))}this.setGISZoom(e,i,n,a)},t.prototype.setGISZoom=function(e,r,i,n){var a=p.findChildOfType(e,"background"),o=f.getFloatAttribute(a,"width"),s=f.getFloatAttribute(a,"height"),l=p.findChildOfType(e,"map"),u=p.findChildOfType(l,"layers"),c=f.parseTransform(u.getAttribute("transform")),h=t.xyToLonLat(e,r-c[0],i-c[1]),d=t.lonToTileXFloat(h[0],n),m=t.latToTileYFloat(h[1],n),g=Math.pow(2,n);d=f.remainderPositive(d-(r-o/2)/t.tileImageSize,g),m=f.remainderPositive(m-(i-s/2)/t.tileImageSize,g);var b=t.tileXToLon(d,n),v=t.tileYToLat(m,n);f.setMultipleAttributes(e,["zoom","center-lon","center-lat"],[n,b,v]),this.redrawGISMap(e)},t.eventIgnoreCondition=function(t){return"true"!=t.currentTarget.getAttribute("navigation-enabled")||!!(f.touchEventExists()&&t instanceof TouchEvent&&t.touches.length>2)},t.prototype.onDrag=function(e,r,i,n){var a=n,o=t.svgScale(a);this.panGIS(a,r/o[0],i/o[1])},t.wheelIgnoreCondition=function(t){return t.altKey||t.ctrlKey},t.prototype.onWheel=function(e,r,i){var n=this,a=e.currentTarget,o=t.svgScale(a);r/=o[0],i/=o[1],clearTimeout(this.delayedZoomTimeout),this.accumulatedZoomWheelDelta+=e.deltaY<0?1:-1,this.delayedZoomTimeout=setTimeout(function(){n.delayedWheelZoom(a,r,i)},t.zoomDelay)},t.prototype.onTouchZoomStart=function(t,e){this.initialTouchZoomDistance=e,this.currentTouchZoomDistance=e},t.prototype.onTouchZoom=function(e,r,i,n){var a=e.currentTarget,o=t.svgScale(a);r/=o[0],i/=o[1],this.currentTouchZoomDistance*=n;var s=this.currentTouchZoomDistance/this.initialTouchZoomDistance;(s<.8||1.2<s)&&(this.zoomGIS(a,s<1?-1:1,r,i),this.initialTouchZoomDistance=this.currentTouchZoomDistance)},t.prototype.delayedWheelZoom=function(t,e,r){0!=this.accumulatedZoomWheelDelta&&(this.zoomGIS(t,this.accumulatedZoomWheelDelta,e,r),this.accumulatedZoomWheelDelta=0)},t.eventToLonLat=function(e,r){var i=p.findChildOfType(e,"background"),n=f.offsetPage(i),a=t.svgScale(e),o=m.eventPageXY(r),s=(o[0]-n.left)/a[0],l=(o[1]-n.top)/a[1],u=p.findChildOfType(e,"map").firstElementChild,c=f.parseTransform(u.getAttribute("transform"));return t.xyToLonLat(e,s-c[0],l-c[1])},t.xyToLonLat=function(e,r,i){var n=t.svgSize(e),a=f.getIntAttribute(e,"zoom"),o=Math.pow(2,a),s=t.lonToTileXFloat(f.getFloatAttribute(e,"center-lon"),a),l=t.latToTileYFloat(f.getFloatAttribute(e,"center-lat"),a),u=(r-n[0]/2)/t.tileImageSize,c=(i-n[1]/2)/t.tileImageSize,h=f.remainderPositive(s+u,o),d=f.remainderPositive(l+c,o);return[t.tileXToLon(h,a),t.tileYToLat(d,a)]},t.lonLatToXY=function(e,r,i){var n=t.svgSize(e),a=f.getIntAttribute(e,"zoom"),o=t.lonToTileXFloat(f.getFloatAttribute(e,"center-lon"),a),s=t.latToTileYFloat(f.getFloatAttribute(e,"center-lat"),a),l=t.lonToTileXFloat(r,a),u=t.latToTileYFloat(i,a);return[n[0]/2+(l-o)*t.tileImageSize,n[1]/2+(u-s)*t.tileImageSize]},t.lonToXFast=function(e,r,i,n){var a=t.lonToTileXFloat(i,n);return r/2+(t.lonToTileXFloat(e,n)-a)*t.tileImageSize},t.lonLatPointsToXYPoints=function(e,r){for(var i=t.svgSize(e),n=f.getIntAttribute(e,"zoom"),a=t.lonToTileXFloat(f.getFloatAttribute(e,"center-lon"),n),o=t.latToTileYFloat(f.getFloatAttribute(e,"center-lat"),n),s=void 0,l=void 0,u="",c=f.splitSkipEmpty(r," "),h=0;h<c.length;h++){var d=c[h].split(","),p=t.lonToTileXFloat(parseFloat(d[0]),n),m=t.latToTileYFloat(parseFloat(d[1]),n),g=i[0]/2+(p-a)*t.tileImageSize,b=i[1]/2+(m-o)*t.tileImageSize;null!=s&&Math.abs(g-s)<t.gisTolerance&&Math.abs(b-l)<t.gisTolerance||(u+=(g=f.reducePrecision(g))+","+(b=f.reducePrecision(b))+" ",s=g,l=b)}return u},t.lonLatPointsToPathData=function(e,r,i){for(var n=t.svgSize(e),a=f.getIntAttribute(e,"zoom"),o=t.lonToTileXFloat(f.getFloatAttribute(e,"center-lon"),a),s=t.latToTileYFloat(f.getFloatAttribute(e,"center-lat"),a),l=void 0,u=void 0,c="",h=f.splitSkipEmpty(r," "),d=f.splitToInts(i," "),p=0;p<h.length;p++){var m=d.indexOf(p-1)>=0,g=m||d.indexOf(p)>=0,b=h[p].split(","),v=t.lonToTileXFloat(parseFloat(b[0]),a),y=t.latToTileYFloat(parseFloat(b[1]),a),A=n[0]/2+(v-o)*t.tileImageSize,T=n[1]/2+(y-s)*t.tileImageSize;null!=l&&!g&&Math.abs(A-l)<t.gisTolerance&&Math.abs(T-u)<t.gisTolerance||(c+=(""==c||m?"M":"L")+(A=f.reducePrecision(A))+","+(T=f.reducePrecision(T))+" ",l=A,u=T)}return c+="Z"},t.svgSize=function(t){var e=p.findChildOfType(t,"background");return[f.getFloatAttribute(e,"width"),f.getFloatAttribute(e,"height")]},t.svgScale=function(e){var r=p.findChildOfType(e,"background"),i=t.svgSize(e),n=r.getBoundingClientRect();return[n.width/i[0],n.height/i[1]]},t.minGISZoom=function(e,r){var i=Math.ceil(Math.log2(Math.ceil(e/t.tileImageSize))),n=Math.ceil(Math.log2(Math.ceil(r/t.tileImageSize)));return Math.max(i,n)},t.normalizedGISX=function(e,r){var i=Math.pow(2,r)*t.tileImageSize;return(e%=i)>i/2?e-=i:e<-i/2&&(e+=i),e},t.pixelsPerGISMeter=function(t,e){return 1/(156543.03392*Math.cos(e*Math.PI/180)/Math.pow(2,t))},t.lonToTileXFloat=function(t,e){return(t+180)/360*Math.pow(2,e)},t.latToTileYFloat=function(t,e){return t<-85.05?Math.pow(2,e):t>85.05?0:(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e)},t.lonToTileXInt=function(e,r){return Math.floor(t.lonToTileXFloat(e,r))},t.latToTileYInt=function(e,r){return Math.floor(t.latToTileYFloat(e,r))},t.lonToXOffsetWithinTile=function(e,r){return t.tileImageSize*(t.lonToTileXFloat(e,r)%1)},t.latToYOffsetWithinTile=function(e,r){return t.tileImageSize*(t.latToTileYFloat(e,r)%1)},t.tileXToLon=function(t,e){return t/Math.pow(2,e)*360-180},t.tileYToLat=function(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.prototype.tileURL=function(e,r,i,n){var a=e.getAttribute("tile-url-provider-type");return this.client.runningFromCloud()?t.cloudTileUrl(e,r,i,n,a):t.localTileUrl(e,i,n,r,a)},t.localTileUrl=function(t,e,r,i,n){var a=window.location.origin+"/tiles/"+n+"/"+e+"/"+r+"/"+i;if("CUSTOM"===n){var o=f.splitSkipEmpty(t.getAttribute("custom-tile-url")," ");a+="?url="+encodeURIComponent(o[Math.floor(Math.random()*o.length)])}return a},t.cloudTileUrl=function(e,r,i,n,a){var o;switch(a){case"ANYLOGIC":return"https://cloudtiles.anylogic.com/?key="+t.gisTileKey(r,i,n);case"CLASSIC":o=t.TILE_URL_CLASSIC;break;case"GERMANSTYLE":o=t.TILE_URL_GERMANSTYLE;break;case"LANDSTAT":o=t.TILE_URL_LANDSTAT;break;case"TRANSPORT":o=t.TILE_URL_TRANSPORT;break;case"CYCLEMAP":o=t.TILE_URL_CYCLEMAP;break;case"HUMANITARIAN":o=t.TILE_URL_HUMANITARIAN;break;case"CUSTOM":o=f.splitSkipEmpty(e.getAttribute("custom-tile-url")," ")}var s=o[Math.floor(Math.random()*o.length)];return s=(s=(s=s.replace("[zoom]",r.toString())).replace("[x]",i.toString())).replace("[y]",n.toString())},t.gisTileKey=function(t,e,r){for(var i=f.stringToByteArray("Dke&36&K%7^fsJGf0q6ilfJ3*48"),n=f.stringToByteArray(t+"/"+e+"/"+r+".png"),a=0;a<n.length;a++)n[a]^=i[a%n.length];return btoa(f.byteArrayToString(n))},t.tileProviderCopyright=function(t){switch(t){case"ANYLOGIC":case"CLASSIC":case"GERMANSTYLE":case"TRANSPORT":case"CYCLEMAP":case"HUMANITARIAN":return"&copy; OpenStreetMap contributors";case"LANDSTAT":return"&copy; GIS-Lab &amp; authors";default:return}},t.tileProviderWebsite=function(t){switch(t){case"ANYLOGIC":case"CLASSIC":case"GERMANSTYLE":case"TRANSPORT":case"CYCLEMAP":case"HUMANITARIAN":return"https://www.openstreetmap.org/copyright";case"LANDSTAT":return"http://gis-lab.info/";default:return}},t.gisTolerance=2,t.tileImageSize=256,t.zoomDelay=50,t.TILE_URL_CLASSIC=["https://a.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://b.tile.openstreetmap.org/[zoom]/[x]/[y].png","https://c.tile.openstreetmap.org/[zoom]/[x]/[y].png"],t.TILE_URL_GERMANSTYLE=["http://a.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://b.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://c.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png","http://d.tile.openstreetmap.de/tiles/osmde/[zoom]/[x]/[y].png"],t.TILE_URL_LANDSTAT=["http://irs.gis-lab.info/?layers=landsat&request=GetTile&z=[zoom]&x=[x]&y=[y]"],t.TILE_URL_TRANSPORT=["http://www.openptmap.org/tiles/[zoom]/[x]/[y].png"],t.TILE_URL_CYCLEMAP=["http://a.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://b.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png","http://c.tile.opencyclemap.org/cycle/[zoom]/[x]/[y].png"],t.TILE_URL_HUMANITARIAN=["https://tile-a.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-b.openstreetmap.fr/hot/[zoom]/[x]/[y].png","https://tile-c.openstreetmap.fr/hot/[zoom]/[x]/[y].png"],t}(),mm=function(){function t(){}return t.createMarkupPath=function(t,e){var r=p.cloneElementWithId("markup-path"),i=e+"basepath";p.findChildOfType(r,"basepath").firstElementChild.id=i;var n=p.findChildOfType(r,"paths"),a=1;"MarkupPathRoad"!=t&&"MarkupPathConveyor"!=t||(a=2),"MarkupPathRailroad"==t&&(a=4);for(var o=0;o<a;o++){var s=p.createUseElement(i);n.appendChild(s)}var l=p.findChildOfType(r,"arrows");return"MarkupPathConveyor"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","rgba(255,255,255,0.5)"),l.setAttribute("stroke","white")):"MarkupPathRoad"==t?(n.firstElementChild.setAttribute("stroke","gray"),n.lastElementChild.setAttribute("stroke","white"),l.setAttribute("stroke","white")):"MarkupPathRailroad"==t&&(n.firstElementChild.setAttribute("stroke","gray"),p.childElements(n)[1].setAttribute("stroke","black"),p.childElements(n)[2].setAttribute("stroke","white"),n.lastElementChild.setAttribute("stroke","gray"),l.setAttribute("stroke","black")),r},t.updateMarkupPath=function(t,e,r){for(var i=t.getAttribute("type"),n=p.findChildOfType(t,"basepath").firstElementChild,a=p.findChildOfType(t,"paths"),o=a.firstElementChild,s=a.childElementCount>1?p.childElements(a)[1]:void 0,l=p.findChildOfType(t,"arrows"),u=0;u<e.length;u++)switch(e[u]){case"d":n.setAttribute("d",r[u]);break;case"bidirectional":p.removeAllChildren(l),"false"==r[u]&&f.addPathArrows(n,"arrowhead",1.7,l,50,100);break;case"stroke-width":var c=parseFloat(r[u]);switch(i){case"MarkupPathLine":o.setAttribute("stroke-width",c.toString());break;case"MarkupPathDashline":o.setAttribute("stroke-width",c.toString()),o.setAttribute("stroke-dasharray",4*c+" "+c);break;case"MarkupPathConveyor":o.setAttribute("stroke-width",c.toString()),s.setAttribute("stroke-width",c.toString()),s.setAttribute("stroke-dasharray",c/10+" "+c/2);break;case"MarkupPathRoad":o.setAttribute("stroke-width",c.toString()),s.setAttribute("stroke-width",(c/12).toString()),s.setAttribute("stroke-dasharray",c/2+" "+c/5);break;case"MarkupPathRailroad":var h=c/10+" "+c/2.5;o.setAttribute("stroke-width",c.toString()),o.setAttribute("stroke-dasharray",h),s.setAttribute("stroke-width",(c/2+c/12).toString()),p.childElements(a)[2].setAttribute("stroke-width",(c/2).toString());var d=a.lastElementChild;d.setAttribute("stroke-width",(c/2).toString()),d.setAttribute("stroke-dasharray",h)}break;case"stroke":o.setAttribute("stroke",r[u]),c=parseFloat(o.getAttribute("stroke-width")),l.setAttribute("stroke",c>4?"white":r[u]);break;default:xm.filterAndSetAttribute(t,e[u],r[u])}},t.createMarkupPointNode=function(){return p.cloneElementWithId("markup-point-node")},t.updateMarkupPointNode=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":t.setAttribute("fill",r[a]),t.setAttribute("stroke",r[a]);break;case"draw-circle":i.setAttribute("fill","none"),i.removeAttribute("stroke");break;case"radius":i.setAttribute("r",r[a]);break;case"connector":var o=p.createSvgElement("path");o.setAttribute("d",r[a]),n.appendChild(o);break;case"connectors-transform":n.setAttribute("transform",r[a]);break;default:xm.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupAreaNode=function(t){var e,r=p.cloneElementWithId("markup-area-node");switch(t){case"MarkupRectangularNode":e=p.createSvgElement("rect");break;case"MarkupPolygonalNode":e=p.createSvgElement("polygon")}return r.insertBefore(e,r.firstElementChild),r},t.updateMarkupAreaNode=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke":t.setAttribute(e[n],r[n]);break;default:xm.filterAndSetAttribute(i,e[n],r[n])}},t.createMarkupPalletRack=function(){return p.cloneElementWithId("markup-pallet-rack")},t.updateMarkupPalletRack=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"stroke":n.setAttribute(e[a],r[a]);break;case"fill":i.setAttribute(e[a],r[a]);break;case"rack-data":p.removeAllChildren(i),p.removeAllChildren(n);var o=r[a].split(" "),s=parseInt(o[0]),l=parseInt(o[1]),u=parseFloat(o[2]),c=parseFloat(o[3]),h=parseFloat(o[4]),d=void 0,m=void 0,g=void 0;s>1&&(d=parseFloat(o[5]),m=parseFloat(o[6]),g=c+d);var b=p.createSvgElement("rect");if(b.setAttribute("width",u.toString()),b.setAttribute("height",c.toString()),i.appendChild(b),s>1){var v=p.createSvgElement("rect");v.setAttribute("width",u.toString()),v.setAttribute("height",m.toString()),v.setAttribute("transform","translate( 0 "+g+")"),i.appendChild(v)}for(var y=h,A=0;A<l-1;A++){var T=p.createSvgElement("line");f.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,"0",c]),n.appendChild(T),y+=h}if(s>1){var C=g+m;y=h;for(A=0;A<l-1;A++){T=p.createSvgElement("line");f.setMultipleAttributes(T,["x1","x2","y1","y2"],[y,y,g,C]),n.appendChild(T),y+=h}}break;case"use-color-map":var S=t.firstElementChild;"ShapeCanvas"==S.getAttribute("type")&&t.appendChild(S);break;default:xm.filterAndSetAttribute(t,e[a],r[a])}},t.markupTypes=["MarkupPathLine","MarkupPathDashline","MarkupPathConveyor","MarkupPathRoad","MarkupPathRailroad","MarkupRectangularNode","MarkupPolygonalNode","MarkupQueueArea","MarkupPalletRack","MarkupConveyorPath","MarkupPositionOnConveyor","MarkupConveyorTransferTable","MarkupConveyorTurntable","MarkupConveyorTurnStation","MarkupConveyorStation","MarkupConveyorCustomStation","MarkupRailwaySwitch","MarkupPositionOnTrack","MarkupPipe","MarkupStorageTank","MarkupBulkConveyorBelt","MarkupPathWall","MarkupCircularWall","MarkupRectangularWall","MarkupTargetLine","MarkupPathway","MarkupPedFlowStatistics","MarkupServiceWithLines","MarkupServiceWithArea","MarkupEscalatorGroup","MarkupDensityMap","MarkupIntersection","MarkupRoad","MarkupStopLine","MarkupBusStop","MarkupParkingLot","MarkupGISPoint","MarkupGISRegion","MarkupGISRoute"],t}(),gm=function(){function t(){}return t.createMarkupConveyorPath=function(t){var e=p.cloneElementWithId("markup-conveyor-path"),r=t+"basepath";p.findChildOfType(e,"basepath").firstElementChild.id=r;var i=p.findChildOfType(e,"paths"),n=p.createUseElement(r),a=p.createUseElement(r);return i.appendChild(n),i.appendChild(a),a.setAttribute("stroke","rgba(255,255,255,0.5)"),e},t.updateMarkupConveyorPath=function(t,e,r){for(var i=p.findChildOfType(t,"basepath").firstElementChild,n=p.findChildOfType(t,"paths"),a=n.firstElementChild,o=n.childElementCount>1?p.childElements(n)[1]:void 0,s=p.findChildOfType(t,"arrows"),l=0;l<e.length;l++)switch(e[l]){case"d":i.setAttribute("d",r[l]);break;case"bidirectional":p.removeAllChildren(s),"false"==r[l]&&f.addPathArrows(i,"arrowhead",1.2,s,50,100);break;case"stroke-width":var u=parseFloat(r[l]);n.setAttribute("stroke-width",u.toString());break;case"stroke-dasharray":o.setAttribute("stroke-dasharray",r[l]);break;case"stroke":a.setAttribute("stroke",r[l]),u=parseFloat(n.getAttribute("stroke-width")),s.setAttribute("stroke",u>4?"rgba(255,255,255,0.7)":r[l]);break;case"offset":o.setAttribute("stroke-dashoffset","-"+r[l]);break;default:xm.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupPositionOnConveyor=function(){return p.cloneElementWithId("markup-position-on-conveyor")},t.updateMarkupPositionOnConveyor=function(t,e,r){for(var i=0;i<e.length;i++)xm.filterAndSetAttribute(t,e[i],r[i])},t.createMarkupConveyorNode=function(t){var e=p.cloneElementWithId("markup-conveyor-node");return"MarkupConveyorTransferTable"==t&&p.removeElement(e.lastElementChild),e},t.updateMarkupConveyorNode=function(t,e,r){for(var i=t.getAttribute("type"),n=t.firstElementChild,a=t.lastElementChild,o=0;o<e.length;o++)switch(e[o]){case"area":n.setAttribute("d",r[o]);break;case"radius":a.setAttribute("r",r[o]);break;case"stroke":"MarkupConveyorTurntable"==i&&("none"==r[o]?a.setAttribute("fill","none"):a.removeAttribute("fill"));default:xm.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupConveyorStation=function(){return p.createSvgElement("path")},t.updateMarkupConveyorStation=function(t,e,r){for(var i=0;i<e.length;i++)xm.filterAndSetAttribute(t,e[i],r[i])},t.createMarkupConveyorCustomStation=function(){return p.createSvgElement("polygon")},t.updateMarkupConveyorCustomStation=function(t,e,r){for(var i=0;i<e.length;i++)xm.filterAndSetAttribute(t,e[i],r[i])},t.createMarkupConveyorSplitMerge=function(){var t=p.createSvgElement("path");return t.setAttribute("stroke-width","0.5"),t},t.updateMarkupConveyorSplitMerge=function(t,e,r){for(var i=0;i<e.length;i++)xm.filterAndSetAttribute(t,e[i],r[i])},t.createMarkupTowerCrane=function(){return p.cloneElementWithId("markup-tower-crane")},t.updateMarkupTowerCrane=function(t,e,r){for(var i=p.findChildOfType(t,"crane"),n=p.findChildOfType(i,"tower"),a=p.findChildOfType(i,"jib"),o=p.findChildOfType(i,"caret"),s=0;s<e.length;s++)switch(e[s]){case"jib-length":var l=parseFloat(r[s]),u=Math.max(1,l/40),c=8*u,h=2*u;n.setAttribute("r",h.toString()),f.setMultipleAttributes(a,["stroke-width","x1","x2"],[u,-c,l]),f.setMultipleAttributes(o,["x","y","width","height"],[-u,-u,h,h]);break;case"crane-color":f.setMultipleAttributes(i,["stroke","fill"],[r[s],r[s]]);break;case"jib-angle":var d=parseFloat(r[s]);i.setAttribute("transform","rotate("+f.radiansToDegrees(d)+")");break;case"caret-distance":o.setAttribute("transform","translate("+r[s]+",0)");break;default:xm.filterAndSetAttribute(t,e[s],r[s])}},t.createMarkupLift=function(){return p.cloneElementWithId("markup-lift")},t.updateMarkupLift=function(t,e,r){for(var i=p.findChildOfType(t,"box"),n=p.findChildOfType(t,"door"),a=p.findChildOfType(t,"left"),o=p.findChildOfType(t,"right"),s=p.findChildOfType(t,"left-arrow"),l=p.findChildOfType(t,"right-arrow"),u=0;u<e.length;u++)switch(e[u]){case"width":case"height":i.setAttribute(e[u],r[u]);var c=f.getFloatAttribute(i,"width"),h=f.getFloatAttribute(i,"height");if(null!=c&&null!=h){var d=c/2,m=h/2,g=c/4,b=Math.min(3*g/5,h/4*3/5);f.setMultipleAttributes(i,["x","y"],[-d,-m]),f.setMultipleAttributes(n,["y1","y2"],[-m,m]),b>2.5&&(f.setMultipleAttributes(a,["x1","y1","x2","y2"],[-g,b-m,-g,3*b-m]),f.setMultipleAttributes(o,["x1","y1","x2","y2"],[g,m-3*b,g,m-b])),s.setAttribute("points",-g-b+","+(2*b-m)+" "+-g+","+(b-m)+" "+(-g+b)+","+(2*b-m)),l.setAttribute("points",g-b+","+(m-2*b)+" "+g+","+(m-b)+" "+(g+b)+","+(m-2*b))}break;default:xm.filterAndSetAttribute(t,e[u],r[u])}},t}(),bm=function(){function t(){}return t.createMarkupPipe=function(t){var e=p.cloneElementWithId("markup-pipe"),r=t+"basepath";p.findChildOfType(e,"basepath").firstElementChild.id=r;var i=p.findChildOfType(e,"pipe"),n=p.findChildOfType(e,"inner-pipe"),a=p.findChildOfType(e,"bubbles"),o="#"+r;return i.setAttributeNS(p.xlinkns,"href",o),n.setAttributeNS(p.xlinkns,"href",o),a.setAttributeNS(p.xlinkns,"href",o),e},t.updateMarkupPipe=function(t,e,r){for(var i,n=p.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=p.findChildOfType(t,"batches"),s=p.findChildOfType(t,"bubbles"),l=0;l<e.length;l++)switch(e[l]){case"phase":s.setAttribute("stroke-dashoffset",(12-parseFloat(r[l])).toString());break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=p.childElements(o)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var m=parseInt(r[l]),g=o.childElementCount,b=m;b<g;b++)p.removeElement(o.lastElementChild);for(b=g;b<m;b++)d=p.createUseElement(a),o.appendChild(d);break;case"d":var v=parseFloat(p.findChildOfType(t,"pipe").getAttribute("stroke-width")),y=f.roundPathCorners(r[l],2*v,!1);n.setAttribute("d",y);break;case"width":var A=parseFloat(r[l]);p.findChildOfType(t,"pipe").setAttribute("stroke-width",A.toString()),p.findChildOfType(t,"inner-pipe").setAttribute("stroke-width",(.6*A).toString()),o.setAttribute("stroke-width",(.6*A).toString());var T=Math.min(5,.2*A);s.setAttribute("stroke-width",T.toString()),s.setAttribute("stroke-dasharray",T+","+(12-T));break;case"color":p.findChildOfType(t,"pipe").setAttribute("stroke",r[l]);break;case"inner-color":p.findChildOfType(t,"inner-pipe").setAttribute("stroke",r[l]);break;default:xm.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupStorageTank=function(){return p.cloneElementWithId("markup-storage-tank")},t.updateMarkupStorageTank=function(t,e,r){for(var i=p.findChildOfType(t,"square"),n=p.findChildOfType(t,"batches"),a=parseFloat(i.getAttribute("width")),o=0;o<e.length;o++)switch(e[o]){case"batch":var s=r[o].split(" "),l=parseFloat(s[1])*a,u=parseFloat(s[2])*a,c=p.childElements(n)[parseInt(s[0])];f.setMultipleAttributes(c,["y","height","fill"],[a/2-l-u,u,s[3]]);break;case"newbatches":for(var h=parseInt(r[o]),d=n.childElementCount,m=h;m<d;m++)p.removeElement(n.lastElementChild);for(m=d;m<h;m++)c=p.createSvgElement("rect"),f.setMultipleAttributes(c,["stroke","width","x"],["none",a,-a/2]),n.appendChild(c);break;case"progress":var g=parseFloat(r[o])*Math.PI*2,b=parseFloat(p.findChildOfType(t,"circle").getAttribute("r"))-2,v=b*Math.sin(g),y=-b*Math.cos(g),A="M 0 "+-b+" ";A+="A "+b+" "+b+" 0 "+(g>Math.PI?"1":"0")+" 1 "+v+" "+y,p.findChildOfType(t,"arc").setAttribute("d",A);break;case"radius":p.findChildOfType(t,"circle").setAttribute("r",r[o]),a=Math.max(10,2*parseFloat(r[o])/Math.sqrt(2)-8),f.setMultipleAttributes(i,["width","height","x","y"],[a,a,-a/2,-a/2]);break;case"color":p.findChildOfType(t,"circle").setAttribute("fill",r[o]);break;case"stroke-color":p.findChildOfType(t,"circle").setAttribute("stroke",r[o]),p.findChildOfType(t,"square").setAttribute("stroke",r[o]);break;default:xm.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupBulkConveyorBelt=function(t){var e=p.cloneElementWithId("markup-bulk-conveyor-belt"),r=t+"basepath";p.findChildOfType(e,"basepath").firstElementChild.id=r;var i=p.findChildOfType(e,"belt"),n=p.findChildOfType(e,"belt-sections"),a="#"+r;return i.setAttributeNS(p.xlinkns,"href",a),n.setAttributeNS(p.xlinkns,"href",a),e},t.updateMarkupBulkConveyorBelt=function(t,e,r){for(var i,n=p.findChildOfType(t,"basepath").firstElementChild,a=n.id,o=p.findChildOfType(t,"belt-sections"),s=p.findChildOfType(t,"batches"),l=0;l<e.length;l++)switch(e[l]){case"phase":o.setAttribute("stroke-dashoffset",r[l]);break;case"batch":var u=r[l].split(" ");i||(i=n.getTotalLength());var c=parseFloat(u[1])*i,h=parseFloat(u[2])*i,d=p.childElements(s)[parseInt(u[0])];d.setAttribute("stroke",u[3]),d.setAttribute("stroke-dasharray","0.1,"+c+","+h+","+i);break;case"newbatches":for(var f=parseInt(r[l]),m=s.childElementCount,g=f;g<m;g++)p.removeElement(s.lastElementChild);for(g=m;g<f;g++)d=p.createUseElement(a),s.appendChild(d);break;case"d":n.setAttribute("d",r[l]);break;case"width":var b=r[l];p.findChildOfType(t,"belt").setAttribute("stroke-width",b),o.setAttribute("stroke-width",b),o.setAttribute("stroke-dasharray","2, 10"),s.setAttribute("stroke-width",(.4*parseFloat(b)).toString());break;case"color":p.findChildOfType(t,"belt").setAttribute("stroke",r[l]);break;case"sections-color":o.setAttribute("stroke",r[l]);break;default:xm.filterAndSetAttribute(t,e[l],r[l])}},t}(),vm=function(){function t(){}return t.createMarkupWall=function(t,e){var r,i=p.cloneElementWithId("markup-wall");switch(i.firstElementChild.id=e+"pattern",t){case"MarkupPathWall":r=p.createSvgElement("path");break;case"MarkupCircularWall":r=p.createSvgElement("ellipse");break;case"MarkupRectangularWall":r=p.createSvgElement("rect")}return i.appendChild(r),i},t.updateMarkupWall=function(t,e,r){for(var i="#"+t.firstElementChild.id,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"color":t.setAttribute("stroke",r[a]);break;case"fill":var o=void 0;switch(r[a]){case"solid":o=t.getAttribute("stroke");break;case"hatching":o="url("+i+")";break;case"none":default:o="none"}n.setAttribute(e[a],o);break;case"stroke-width":case"d":case"rx":case"ry":case"width":case"height":n.setAttribute(e[a],r[a]);break;default:xm.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupTargetLine=function(){return p.cloneElementWithId("markup-target-line")},t.updateMarkupTargetLine=function(e,r,i){for(var n=p.findChildOfType(e,"polyline"),a=p.findChildOfType(e,"serif-start"),o=p.findChildOfType(e,"serif-end"),s=0;s<r.length;s++)switch(r[s]){case"color":e.setAttribute("stroke",i[s]);break;case"points":n.setAttribute(r[s],i[s]);var l=i[s].split(" "),u=l.length;l[u-1].includes(",")||u--,t.setSerif(l[0],l[1],a),t.setSerif(l[u-1],l[u-2],o);break;default:xm.filterAndSetAttribute(e,r[s],i[s])}},t.createMarkupPathway=function(){return p.cloneElementWithId("markup-pathway")},t.updateMarkupPathway=function(t,e,r){for(var i=p.findChildOfType(t,"polygon"),n=p.findChildOfType(t,"polyline"),a=p.findChildOfType(t,"ties"),o=0;o<e.length;o++)switch(e[o]){case"color":a.setAttribute("stroke",r[o]);break;case"points":var s=r[o].split(" "),l="",u="",c="";p.removeAllChildren(a);for(var h=0;h<s.length;h++){var d=f.splitToFloats(s[h],",");if(4==d.length){l+=d[0]+","+d[1]+" ",u=d[2]+","+d[3]+" "+u,c+=(d[0]+d[2])/2+","+(d[1]+d[3])/2+" ";var m=p.createSvgElement("line");f.setMultipleAttributes(m,["x1","y1","x2","y2"],[d[0],d[1],d[2],d[3]]),a.appendChild(m)}}i.setAttribute("points",l+u),n.setAttribute("points",c);break;default:xm.filterAndSetAttribute(t,e[o],r[o])}},t.createMarkupPedFlowStatistics=function(){return p.cloneElementWithId("markup-ped-flow-statistics")},t.updateMarkupPedFlowStatistics=function(t,e,r){for(var i=p.findChildOfType(t,"line"),n=p.findChildOfType(t,"serif-end"),a=p.findChildOfType(t,"direction"),o=p.findChildOfType(t,"arrow-right"),s=p.findChildOfType(t,"arrow-left"),l=0;l<e.length;l++)switch(e[l]){case"color":t.setAttribute("stroke",r[l]);break;case"length":i.setAttribute("x2",r[l]),n.setAttribute("x1",r[l]),n.setAttribute("x2",r[l]);var u=parseInt(r[l])/2;a.setAttribute("x1",u.toString()),a.setAttribute("x2",u.toString()),o.setAttribute("transform","translate("+u+" 13) rotate(90)"),s.setAttribute("transform","translate("+u+" -13) rotate(-90)");break;case"direction":switch(o.setAttribute("visibility","inherit"),s.setAttribute("visibility","inherit"),r[l]){case"right":s.setAttribute("visibility","hidden");break;case"left":o.setAttribute("visibility","hidden")}break;default:xm.filterAndSetAttribute(t,e[l],r[l])}},t.createMarkupServiceWithLines=function(){return p.cloneElementWithId("markup-service-with-lines")},t.updateMarkupServiceWithLines=function(e,r,i){for(var n=p.findChildOfType(e,"queues"),a=p.findChildOfType(e,"services"),o=p.findChildOfType(e,"reverse-queues"),s=p.findChildOfType(e,"area"),l=0;l<r.length;l++)switch(r[l]){case"queue-color":n.setAttribute("stroke",i[l]);break;case"reverse-queue-color":o.setAttribute("stroke",i[l]);break;case"service-color":a.setAttribute("stroke",i[l]);break;case"clear-all-queues":p.removeAllChildren(n),p.removeAllChildren(o);break;case"queue":t.addQueue(n,i[l]);break;case"reverse-queue":t.addQueue(o,i[l]);break;case"clear-services":p.removeAllChildren(a);break;case"service":t.addService(a,i[l]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":s.setAttribute(r[l],i[l]);break;case"pos":case"scale":var u=f.posOrScaleToTransform(s,r[l],i[l]);f.applyTransformAttribute(s,u);break;default:xm.filterAndSetAttribute(e,r[l],i[l])}},t.createMarkupServiceWithArea=function(){return p.cloneElementWithId("markup-service-with-area")},t.updateMarkupServiceWithArea=function(e,r,i){for(var n=p.findChildOfType(e,"services"),a=0;a<r.length;a++)switch(r[a]){case"service-color":n.setAttribute("stroke",i[a]);break;case"clear-services":p.removeAllChildren(n);break;case"service":t.addService(n,i[a]);break;case"stroke":case"stroke-width":case"stroke-dasharray":case"fill":case"points":case"pos":case"scale":break;default:xm.filterAndSetAttribute(e,r[a],i[a])}},t.createMarkupEscalatorGroup=function(){return p.cloneElementWithId("markup-escalator-group")},t.updateMarkupEscalatorGroup=function(t,e,r){for(var i=p.findChildOfType(t,"background"),n=p.findChildOfType(t,"escalators"),a=0;a<e.length;a++)switch(e[a]){case"balustrade-color":i.setAttribute("fill",r[a]);break;case"solid-balustrade":i.setAttribute("visibility","true"==r[a]?"inherit":"hidden");break;case"dimensions-completed":var o=f.getIntAttribute(t,"number-of-escalators"),s=f.getFloatAttribute(t,"width"),l=f.getFloatAttribute(t,"length"),u=f.getFloatAttribute(t,"left-balustrade-width"),c=f.getFloatAttribute(t,"right-balustrade-width"),h=f.getFloatAttribute(t,"internal-balustrade-width"),d=f.getFloatAttribute(t,"lower-landing-length"),m=f.getFloatAttribute(t,"upper-landing-length"),g=f.getFloatAttribute(t,"step-width"),b=u+c+o*s+(o-1)*h,v=d+l+m,y="1 "+Math.max(2,g-1);f.setMultipleAttributes(i,["y","width","height"],[-u,v,b]);for(var A=0;A<o;A++){var T=A*(s+h),C=p.cloneElementWithId("escalator"),S=p.findChildOfType(C,"background");f.setMultipleAttributes(S,["y","width","height"],[T,v,s]);var E=p.findChildOfType(C,"handrail-left"),w=p.findChildOfType(C,"handrail-right");f.setMultipleAttributes(E,["x2","y1","y2"],[v,T,T]),f.setMultipleAttributes(w,["x2","y1","y2"],[v,T+s,T+s]);var k=p.findChildOfType(C,"lower-landing-end"),x=p.findChildOfType(C,"upper-landing-end");f.setMultipleAttributes(k,["x1","x2","y1","y2"],[d,d,T,T+s]),f.setMultipleAttributes(x,["x1","x2","y1","y2"],[d+l,d+l,T,T+s]);var M=p.findChildOfType(C,"stairs");f.setMultipleAttributes(M,["x1","x2","y1","y2","stroke-width","stroke-dasharray"],[d,d+l,T+s/2,T+s/2,s,y]),n.appendChild(C)}break;case"offsets":var O=f.splitToFloats(r[a]," "),I=p.childElements(n);for(A=0;A<I.length;A++)p.findChildOfType(I[A],"stairs").setAttribute("stroke-dashoffset",(-O[A]).toString());break;default:xm.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupDensityMap=function(){for(var t=p.cloneElementWithId("markup-density-map"),e=p.findChildOfType(t,"grid");e.childElementCount<7;)e.appendChild(p.cloneElementWithId("grid-item"));return t},t.updateMarkupDensityMap=function(e,r,i){for(var n=p.findChildOfType(e,"colors"),a=p.findChildOfType(e,"frame"),o=0;o<r.length;o++)switch(r[o]){case"width":case"height":a.setAttribute(r[o],i[o]),t.redrawMarkupDensityMap(e);break;case"critical-density":e.setAttribute(r[o],i[o]),t.redrawMarkupDensityMap(e);break;case"colors":var s=f.splitSkipEmpty(i[o]," ");p.removeAllChildren(n);for(var l=0,u=s;l<u.length;l++){var c=u[l],h=p.createSvgElement("rect");h.setAttribute("fill",c),n.appendChild(h)}t.redrawMarkupDensityMap(e);break;default:xm.filterAndSetAttribute(e,r[o],i[o])}},t.redrawMarkupDensityMap=function(t){var e=p.findChildOfType(t,"colors"),r=p.findChildOfType(t,"frame"),i=p.findChildOfType(t,"grid"),n=f.getFloatAttribute(r,"width"),a=f.getFloatAttribute(r,"height"),o=f.getFloatAttribute(t,"critical-density");if(null!=n&&null!=a&&null!=o){for(var s=a,l=0,u=o/6,c=a/6,h=p.childElements(i),d=0;d<7;d++){var m=h[d],g=m.lastElementChild;f.setMultipleAttributes(g,["x1","y1","x2","y2","stroke"],[n+4,s,0,s,"black"]);var b=m.firstElementChild;f.setMultipleAttributes(b,["x","y","text-anchor","fill"],[n+7,s+3,"start","black"]),b.firstChild.textContent=f.formatNumber(l,2),l+=u,s-=c}var v=e.childElementCount;if(v>0){s=a-(c=a/v);var y=p.childElements(e);for(d=0;d<v;d++)f.setMultipleAttributes(y[d],["y","width","height"],[s,n,c]),s-=c}}},t.setSerif=function(t,e,r){var i=t.split(","),n=e.split(","),a=parseFloat(i[0]),o=parseFloat(i[1]),s=parseFloat(n[0])-a,l=parseFloat(n[1])-o,u=Math.hypot(s,l),c=3*l/u,h=3*s/u;f.setMultipleAttributes(r,["x1","x2","y1","y2"],[a+c,a-c,o-h,o+h])},t.addService=function(t,e){var r,i=e.split(" "),n=parseFloat(f.getSubAttribute(i,"x")),a=parseFloat(f.getSubAttribute(i,"y")),o=f.radiansToDegrees(parseFloat(f.getSubAttribute(i,"orientation")));if("point"==f.getSubAttribute(i,"type")){(r=p.createUseElement("service-point")).setAttribute("transform","translate("+n+" "+a+")");var s=p.createUseElement("arrowhead-small");s.setAttribute("transform","translate("+(n-11)+" "+a+") rotate("+o+" 11 0)"),t.appendChild(s)}else{(r=p.cloneElementWithId("service-line")).setAttribute("transform","translate("+n+" "+a+") rotate("+o+")");var l=r.firstElementChild.nextElementSibling,u=parseFloat(f.getSubAttribute(i,"length"));if(l.setAttribute("x2",u),"true"==f.getSubAttribute(i,"bidirectional")){var c=r.lastElementChild;c.setAttribute("visibility","inherit"),c.setAttribute("transform","translate("+(u+3)+" 0) rotate(180)")}}t.appendChild(r)},t.addQueue=function(t,e){var r=f.splitSkipEmpty(e,"|"),i=f.getSubAttribute(r,"queue-path"),n=p.createSvgElement("path");n.setAttribute("d",i),t.appendChild(n),f.addPathArrows(n,"arrowhead-small",.7,t,50,100);var a=f.getSubAttribute(r,"fence-color");if(a)for(var o=[f.getSubAttribute(r,"fence-path-left"),f.getSubAttribute(r,"fence-path-right")],s=0;s<o.length;s++){var l=p.createSvgElement("path");f.setMultipleAttributes(l,["d","stroke","stroke-width","stroke-dasharray"],[o[s],a,"2","none"]),t.appendChild(l)}},t}(),ym=function(){function t(){}return t.createMarkupRailwaySwitch=function(){return p.cloneElementWithId("markup-railway-switch")},t.updateMarkupRailwaySwitch=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"x":i.setAttribute("cx",r[a]),n.setAttribute("x1",r[a]);break;case"y":i.setAttribute("cy",r[a]),n.setAttribute("y1",r[a]);break;case"r":i.setAttribute("r",r[a]);break;case"stroke":i.setAttribute("stroke",r[a]);break;case"stroke-line":n.setAttribute("stroke",r[a]);break;case"x2":n.setAttribute("x2",r[a]);break;case"y2":n.setAttribute("y2",r[a]);break;default:xm.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupPositionOnTrack=function(){return p.cloneElementWithId("markup-position-on-track")},t.updateMarkupPositionOnTrack=function(t,e,r){for(var i=0;i<e.length;i++)xm.filterAndSetAttribute(t,e[i],r[i])},t}(),Am=function(){function t(){}return t.createMarkupIntersection=function(){return p.cloneElementWithId("markup-intersection")},t.updateMarkupIntersection=function(t,e,r){for(var i=t.firstElementChild,n=p.findChildOfType(t,"lane-connectors"),a=0;a<e.length;a++)switch(e[a]){case"fill":case"d":i.setAttribute(e[a],r[a]);break;case"lane-connector":var o=p.createSvgElement("g"),s=p.createSvgElement("path");s.setAttribute("d",r[a]),o.appendChild(s),f.addPathArrows(s,"arrowhead-tiny",.5,o,20,40),n.appendChild(o);break;case"lane-connector-colors":for(var l=f.splitSkipEmpty(r[a]," "),u=p.childElements(n),c=0;c<u.length;c++)u[c].setAttribute("stroke",l[c]);break;default:xm.filterAndSetAttribute(t,e[a],r[a])}},t.createMarkupRoad=function(){return p.cloneElementWithId("markup-road")},t.updateMarkupRoad=function(e,r,i){for(var n=p.findChildOfType(e,"lanes"),a=p.findChildOfType(e,"delimiters"),o=p.findChildOfType(e,"median"),s=0;s<r.length;s++)switch(r[s]){case"lane-width":n.setAttribute("stroke-width",i[s]);break;case"lane-color":n.setAttribute("stroke",i[s]);break;case"forward-lane":case"backward-lane":var l=p.createSvgElement("path");l.setAttribute("d",i[s]),n.appendChild(l);break;case"lane-delimiter-color":a.setAttribute("stroke",i[s]);break;case"lane-delimiter-width":case"lane-delimiter-style":a.setAttribute(r[s],i[s]);break;case"lane-delimiter":var u=f.getFloatAttribute(a,"lane-delimiter-width"),c=a.getAttribute("lane-delimiter-style");t.addDelimiter(a,u,c,i[s],n.getAttribute("stroke"));break;case"median-color":o.setAttribute("stroke",i[s]);break;case"median-width":case"median-style":o.setAttribute(r[s],i[s]);break;case"median":u=f.getFloatAttribute(o,"median-width"),c=o.getAttribute("median-style"),t.addDelimiter(o,u,c,i[s],n.getAttribute("stroke"));break;default:xm.filterAndSetAttribute(e,r[s],i[s])}},t.addDelimiter=function(t,e,r,i,n){var a=r.includes("DASHED"),o=r.includes("DOUBLE"),s=p.createSvgElement("path");if(s.setAttribute("d",i),s.setAttribute("stroke-width",(o?3*e:e).toString()),a&&s.setAttribute("stroke-dasharray",10*e+" "+5*e),t.appendChild(s),o){var l=p.createSvgElement("path");f.setMultipleAttributes(l,["d","stroke-width","stroke"],[i,e,n]),t.appendChild(l)}},t.createMarkupStopLine=function(){return p.cloneElementWithId("markup-stop-line")},t.updateMarkupStopLine=function(t,e,r){for(var i=t.firstElementChild,n=0;n<e.length;n++)switch(e[n]){case"stroke-width":case"stroke":case"d":i.setAttribute(e[n],r[n]);break;default:xm.filterAndSetAttribute(t,e[n],r[n])}},t.createMarkupBusStopOrParkingLot=function(){return p.cloneElementWithId("markup-bus-stop-or-parking-lot")},t.updateMarkupBusStopOrParkingLot=function(t,e,r){for(var i=t.firstElementChild,n=t.lastElementChild,a=0;a<e.length;a++)switch(e[a]){case"fill":i.setAttribute(e[a],r[a]);break;case"area":i.setAttribute("d",r[a]);break;case"stroke-width":case"stroke":n.setAttribute(e[a],r[a]);break;case"marking":n.setAttribute("d",r[a]);break;default:xm.filterAndSetAttribute(t,e[a],r[a])}},t}(),Tm=function(){function t(t){this.sliderDragging=!1,this.control=t}return t.prototype.createSlider=function(){var t=this,e=p.cloneElementWithId("control-slider"),r=function(e){return t.onEvent(e)};return e.addEventListener("mouseover",r),e.addEventListener("mouseout",r),e.addEventListener("mousedown",r),e.addEventListener("wheel",r),e.addEventListener("touchstart",r),e},t.updateSlider=function(e,r,i){for(var n=p.findChildOfType(e,"background"),a=p.findChildOfType(e,"line"),o=p.findChildOfType(e,"progress"),s=p.findChildOfType(e,"handle"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-background":"control-background-disabled"),o.setAttribute("class",u?"control-slider-progress":"control-background-selected-disabled"),s.setAttribute("class",u?"control-slider-handle":"control-slider-handle-disabled");break;case"background-color":n.setAttribute("fill",i[l]);break;case"width":case"height":n.setAttribute(r[l],i[l]);break;case"vertical":e.setAttribute(r[l],i[l]);var c=f.getFloatAttribute(n,"width"),h=f.getFloatAttribute(n,"height"),d=void 0,m=void 0,g=void 0,b=void 0,v=void 0,y=void 0,A=void 0,T=void 0,C=void 0,S=void 0;"false"==i[l]?(v=d=0,y=m=h/2-2,g=c,A=0,T=b=4,C=0,S=h/2):(v=d=c/2-2,m=0,y=h,A=g=4,b=h,T=0,C=c/2,S=h),f.setMultipleAttributes(a,["x","y","width","height"],[d,m,g,b]),f.setMultipleAttributes(o,["x","y","width","height"],[v,y,A,T]),f.setMultipleAttributes(s,["cx","cy"],[C,S]);break;case"value":var E=t.valueToPos(e,parseFloat(i[l]));t.setHandlePosition(e,E);break;default:xm.filterAndSetAttribute(e,r[l],i[l])}},t.prototype.onEvent=function(e){var r=this,i=e.currentTarget;if("false"!=i.getAttribute("enabled")){var n=p.findChildOfType(i,"progress"),a="true"==i.getAttribute("vertical");if(e instanceof MouseEvent){var o=e;switch(o.type){case"mouseover":this.onOver(i);break;case"mouseout":i.contains(o.relatedTarget)||this.sliderDragging||t.onOut(i);break;case"mousedown":if(1!=o.which)return;o.stopPropagation(),o.preventDefault(),this.sliderDragging=!0,this.onHandleGrabbed(i,o.pageX,o.pageY);break;case"wheel":var s=o;if(!o.altKey&&!o.ctrlKey){e.stopPropagation(),e.preventDefault();var l=void 0,u=f.getFloatAttribute(i,"step");if(u>0){var c=f.getFloatAttribute(i,"current-value");l=t.valueToPos(i,c+(s.deltaY<0?u:-u))}else l=f.getFloatAttribute(n,a?"height":"width"),l+=s.deltaY<0?1:-1;t.setHandlePosition(i,l),clearTimeout(this.wheelConfirmTimeout),this.wheelConfirmTimeout=setTimeout(function(){return r.confirmValue(i)},t.wheelConfirmDelay)}}}else if(f.touchEventExists()&&e instanceof TouchEvent){var h=e;if(h.touches.length>1)return this.onHandleReleased(i),void t.onOut(i);switch(e.type){case"touchstart":h.stopPropagation(),h.preventDefault(),this.sliderDragging=!0,this.onOver(i),this.onHandleGrabbed(i,h.touches[0].pageX,h.touches[0].pageY)}}}},t.prototype.onOver=function(t){var e=p.findChildOfType(t,"line"),r=p.findChildOfType(t,"progress"),i=p.findChildOfType(t,"handle"),n=p.findChildOfType(t,"value");e.setAttribute("class","control-slider-line-hover"),r.setAttribute("class","control-fill-color-transition"),i.setAttribute("class",this.sliderDragging?"control-slider-handle-pressed":"control-slider-handle-hover"),n.setAttribute("class","control-opaque1")},t.onOut=function(t){var e=p.findChildOfType(t,"line"),r=p.findChildOfType(t,"progress"),i=p.findChildOfType(t,"handle"),n=p.findChildOfType(t,"value");e.setAttribute("class","control-background"),r.setAttribute("class","control-slider-progress"),i.setAttribute("r","8"),i.setAttribute("class","control-slider-handle"),n.setAttribute("class","control-opaque0")},t.prototype.onHandleGrabbed=function(e,r,i){var n=this,a=p.findChildOfType(e,"background"),o=p.findChildOfType(e,"progress"),s=p.findChildOfType(e,"handle"),l="true"==e.getAttribute("vertical"),u=f.getFloatAttribute(a,"width"),c=f.getFloatAttribute(a,"height"),h=a.getBoundingClientRect(),d=h.width/u,m=h.height/c,g=f.offsetPage(a),b=(r-g.left)/d,v=(i-g.top)/m,y=l?c-v:b;s.setAttribute("r","7"),s.setAttribute("class","control-slider-handle-pressed"),t.setHandlePosition(e,y),new xf(r,i,function(r,i,n){var a=f.getFloatAttribute(o,l?"height":"width"),s=a+(l?-n/m:i/d),h=l?c:u;return s=Math.min(h,Math.max(s,0)),t.setHandlePosition(e,s),l?[0,(a-s)*m]:[(s-a)*d,0]},function(){n.sliderDragging=!1,n.onHandleReleased(e),t.onOut(e)},l?"ns-resize":"ew-resize")},t.prototype.onHandleReleased=function(t){var e=p.findChildOfType(t,"handle");e.setAttribute("r","8"),e.setAttribute("class","control-slider-handle-hover"),this.confirmValue(t)},t.setHandlePosition=function(e,r){var i=p.findChildOfType(e,"background"),n=p.findChildOfType(e,"progress"),a=p.findChildOfType(e,"handle"),o=p.findChildOfType(e,"value"),s=f.getFloatAttribute(i,"width"),l=f.getFloatAttribute(i,"height"),u="true"==e.getAttribute("vertical"),c=u?l:s;r=Math.min(Math.max(0,r),c),u?(n.setAttribute("y",(c-r).toString()),n.setAttribute("height",r.toString()),a.setAttribute("cy",(c-r).toString())):(n.setAttribute("width",r.toString()),a.setAttribute("cx",r.toString()));var h=t.posToValue(e,r),d=o.firstElementChild,m=o.lastElementChild,g=t.snapValueToStep(e,h);m.firstChild.textContent=f.formatNumber(g,2);var b=m.getComputedTextLength()+10;d.setAttribute("width",b.toString()),d.setAttribute("x",(5-b).toString());var v=u?s/2-9:r-14,y=u?l-r-15-10:l/2-15-4;o.setAttribute("transform","translate("+v+","+y+")"),e.setAttribute("current-value",h.toString())},t.prototype.confirmValue=function(e){var r=f.getFloatAttribute(e,"current-value"),i=t.snapValueToStep(e,r);if(i!=r){var n=t.valueToPos(e,i);t.setHandlePosition(e,n)}i!=f.getFloatAttribute(e,"last-value")&&(this.control.frameDrawing.client.postUserAction(e.id,i.toString()),e.setAttribute("last-value",i.toString()))},t.posToValue=function(t,e){var r=p.findChildOfType(t,"background"),i=f.getFloatAttribute(r,"width"),n=f.getFloatAttribute(r,"height"),a=e/("true"==t.getAttribute("vertical")?n:i),o=f.getFloatAttribute(t,"min"),s=f.getFloatAttribute(t,"max"),l=o+(s-o)*a;return Math.min(Math.max(o,l),s)},t.valueToPos=function(t,e){var r=f.getFloatAttribute(t,"min"),i=(e-r)/(f.getFloatAttribute(t,"max")-r),n=p.findChildOfType(t,"background"),a=f.getFloatAttribute(n,"width"),o=f.getFloatAttribute(n,"height"),s="true"==t.getAttribute("vertical")?o:a,l=s*i;return Math.min(Math.max(0,l),s)},t.snapValueToStep=function(t,e){var r=f.getFloatAttribute(t,"step");if(r<=0)return e;var i=f.getFloatAttribute(t,"min"),n=f.getFloatAttribute(t,"max");return e=i+Math.round((e-i)/r)*r,Math.min(e,n)},t.wheelConfirmDelay=150,t}(),Cm=function(){function t(t){this.control=t}return t.createControlList=function(e){var r=p.cloneElementWithId("control-list");r.setAttribute("always-focused",e.toString());var i=function(e){return t.onControlListMouseEvent(e)};return r.addEventListener("mouseover",i),r.addEventListener("mouseout",i),r.addEventListener("mousedown",i),r.addEventListener("wheel",i),r.addEventListener("touchstart",i),r},t.prototype.updateControlList=function(e,r,i){for(var n=p.findChildOfType(e,"svg"),a=p.findChildOfType(e,"border"),o=p.findChildOfType(n,"background"),s=p.findChildOfType(n,"itemgroup"),l=p.findChildOfType(n,"scrollbargroup"),u="true"==e.getAttribute("always-focused"),c=0;c<r.length;c++)switch(r[c]){case"enabled":e.setAttribute(r[c],i[c]);for(var h="true"==i[c],d=p.childElements(s),m=0;m<d.length;m++)t.updateControlListItemLook(d[m],u,!1);l.setAttribute("class",u?"control-opaque1":"control-opaque0");var g=void 0;g=h?u?"control-border-hover":"control-border":"control-border-disabled",a.setAttribute("class",g);break;case"text-array":p.removeAllChildren(s),s.setAttribute("transform","translate(0,0)"),e.setAttribute("last-clicked","0");var b=f.splitSkipEmpty(i[c],"\n"),v=0,y=0;for(m=0;m<b.length;m++){var A=p.cloneElementWithId("list-item");p.findChildOfType(A,"background").setAttribute("fill",o.getAttribute("fill")),(w=p.findChildOfType(A,"text")).firstChild.textContent=b[m],e.hasAttribute("text-color")&&w.setAttribute("fill",e.getAttribute("text-color")),s.appendChild(A);var T=w.getBBox();v<T.width&&(v=T.width),y<T.height&&(y=T.height)}d=p.childElements(s);var C=Math.max(v+4,f.getFloatAttribute(n,"width")),S=Math.max(20,1.35*y);e.setAttribute("item-height",S.toString());for(m=0;m<d.length;m++)this.setupControlListItem(d[m],S*m,C,S,y);t.updateControlListScrollbar(e);break;case"background-color":o.setAttribute("fill",i[c]);break;case"text-color":e.setAttribute(r[c],i[c]);break;case"font-style":e.style.font=i[c];break;case"width":case"height":n.setAttribute(r[c],i[c]),o.setAttribute(r[c],i[c]),a.setAttribute(r[c],i[c]),n.hasAttribute("width")&&n.hasAttribute("height")&&t.setupControlListScrollbar(e);break;case"multiple":e.setAttribute(r[c],i[c]);break;case"value":var E=f.splitSkipEmpty(i[c],"\n");d=p.childElements(s),e.setAttribute("last-clicked","0");for(m=0;m<d.length;m++){A=d[m];var w=p.findChildOfType(A,"text"),k=E.indexOf(w.firstChild.textContent)>=0;A.setAttribute("selected",k),t.updateControlListItemLook(A,u,!1),k&&e.setAttribute("last-clicked",m.toString())}break;default:xm.filterAndSetAttribute(e,r[c],i[c])}},t.prototype.adjustControlListHeightToItems=function(t,e){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"itemgroup").childElementCount;if(0!=i){i>e&&(i=e);var n=i*f.getFloatAttribute(t,"item-height");this.updateControlList(t,["height"],[n.toString()])}},t.onControlListMouseEvent=function(e){var r=e.currentTarget;if("false"!=r.getAttribute("enabled")){var i=p.findChildOfType(r,"svg"),n=p.findChildOfType(i,"scrollbargroup"),a=p.findChildOfType(n,"handle");if(e instanceof MouseEvent){var o=e;switch(o.type){case"mouseover":t.onGotFocus(r);break;case"mouseout":r.contains(o.relatedTarget)||t.dragging||t.onLostFocus(r);break;case"mousedown":if(1!=o.which||o.target!=a)return;o.stopPropagation(),o.preventDefault(),t.onDragStart(r,o.pageX,o.pageY);break;case"wheel":var s=o;if(!s.altKey&&!s.ctrlKey){e.stopPropagation(),e.preventDefault();var l=f.getFloatAttribute(r,"item-height");t.scrollControlList(r,s.deltaY<0?l:-l)}}}else if(f.touchEventExists()&&e instanceof TouchEvent){var u=e;if(u.touches.length>1)return;switch(u.type){case"touchstart":if(u.target!=a)return;u.stopPropagation(),u.preventDefault(),t.onGotFocus(r),t.onDragStart(r,u.touches[0].pageX,u.touches[0].pageY)}}}},t.onGotFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=p.findChildOfType(e,"border"),i=p.findChildOfType(e,"svg"),n=p.findChildOfType(i,"itemgroup"),a=p.findChildOfType(i,"scrollbargroup"),o=p.childElements(n);if("control-border-hover"!=r.getAttribute("class")){r.setAttribute("class","control-border-hover"),a.setAttribute("class","control-opaque1");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!0,!1)}}},t.onLostFocus=function(e){if("true"!=e.getAttribute("always-focused")){var r=p.findChildOfType(e,"border"),i=p.findChildOfType(e,"svg"),n=p.findChildOfType(i,"itemgroup"),a=p.findChildOfType(i,"scrollbargroup"),o=p.childElements(n);r.setAttribute("class","control-border"),a.setAttribute("class","control-opaque0");for(var s=0;s<o.length;s++)t.updateControlListItemLook(o[s],!1,!1)}},t.isFocused=function(t){return"control-border-hover"==p.findChildOfType(t,"border").getAttribute("class")},t.onDragStart=function(e,r,i){var n=p.findChildOfType(e,"svg"),a=p.findChildOfType(n,"scrollbargroup"),o=p.findChildOfType(a,"scrollbar"),s=f.getFloatAttribute(o,"height"),l=o.getBoundingClientRect().height/s;t.dragging=!0,new xf(r,i,function(r,i,n){var a=f.getFloatAttribute(e,"scroll-scale"),o=-n/l*a;return[0,-t.scrollControlList(e,o)/a*l]},function(r){t.dragging=!1,r instanceof MouseEvent&&t.onLostFocus(e)},"ns-resize")},t.scrollControlList=function(t,e){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"itemgroup"),n=p.findChildOfType(r,"scrollbargroup"),a=p.findChildOfType(n,"handle"),o=i.childElementCount;if(0!=o){var s=f.getFloatAttribute(r,"height"),l=o*f.getFloatAttribute(t,"item-height"),u=i.getAttribute("transform"),c=f.parseTransform(u)[1],h=c+e;h=Math.max(-l+s,h),h=Math.min(h,0),i.setAttribute("transform","translate(0,"+h+")");var d=2-h/f.getFloatAttribute(t,"scroll-scale");return a.setAttribute("y",d.toString()),h-c}},t.prototype.setupControlListItem=function(e,r,i,n,a){var o=this,s=p.findChildOfType(e,"background"),l=p.findChildOfType(e,"text");e.setAttribute("transform","translate(0,"+r+")"),f.setMultipleAttributes(s,["width","height"],[i,n]),f.setMultipleAttributes(l,["x","y"],[2,n/2+.3*a]),new m(e,function(r){r instanceof MouseEvent&&t.updateControlListItemLook(e,!0,!0)},function(r){r instanceof MouseEvent&&t.updateControlListItemLook(e,!0,!1)},null,function(t){return o.onControlListItemClickTap(e,t)},null)},t.prototype.onControlListItemClickTap=function(e,r){var i=e.parentNode,n=i.parentNode.parentNode;if("false"!=n.getAttribute("enabled"))if(f.touchEventExists()&&r instanceof TouchEvent&&!t.isFocused(n))t.onGotFocus(n);else{var a=r instanceof MouseEvent&&r.ctrlKey||f.touchEventExists()&&r instanceof TouchEvent,o=r instanceof MouseEvent&&r.shiftKey,s="true"==n.getAttribute("multiple"),l=p.childElements(i),u=f.indexInParent(e),c="true"==e.getAttribute("selected");if(s)if(a)e.setAttribute("selected",String(!c)),t.updateControlListItemLook(e,!0,!0);else if(o){var h=f.getIntAttribute(n,"last-clicked");for(d=0;d<l.length;d++)c=h<=u?h<=d&&d<=u:u<=d&&d<=h,l[d].setAttribute("selected",c),t.updateControlListItemLook(l[d],!0,d==u)}else for(d=0;d<l.length;d++)l[d].setAttribute("selected",d==u),t.updateControlListItemLook(l[d],!0,d==u);else{c=!a||!c;for(var d=0;d<l.length;d++)l[d].setAttribute("selected",d==u&&c),t.updateControlListItemLook(l[d],!0,d==u)}n.setAttribute("last-clicked",u.toString());var m="";for(d=0;d<l.length;d++){if("true"==l[d].getAttribute("selected"))m+=p.findChildOfType(l[d],"text").firstChild.textContent+"\n"}this.control.onControlListSelectionChanged(n,m),f.touchEventExists()&&r instanceof TouchEvent&&t.onLostFocus(n)}},t.updateControlListItemLook=function(t,e,r){var i=t.parentNode.parentNode.parentNode,n=p.findChildOfType(t,"background"),a=p.findChildOfType(t,"text"),o="true"==i.getAttribute("enabled"),s="true"==t.getAttribute("selected");if(!o)return n.setAttribute("class",s?"control-background-selected-disabled":""),void a.setAttribute("class","control-text-disabled");e?(r?n.setAttribute("class",s?"control-list-background-selected-hover-focus":"control-list-background-hover-focus"):n.setAttribute("class",s?"control-list-background-selected-hover":""),a.setAttribute("class",s?"control-text-selected-hover":"")):(n.setAttribute("class",s?"control-list-background-selected":""),a.setAttribute("class",""))},t.setupControlListScrollbar=function(e){var r=p.findChildOfType(e,"svg"),i=p.findChildOfType(r,"scrollbargroup"),n=p.findChildOfType(i,"scrollbar"),a=p.findChildOfType(i,"handle"),o=f.getFloatAttribute(r,"width"),s=f.getFloatAttribute(r,"height"),l=o-f.getFloatAttribute(n,"width");n.setAttribute("x",l.toString()),n.setAttribute("height",s.toString()),a.setAttribute("x",(l+2).toString()),a.setAttribute("y","2"),t.updateControlListScrollbar(e)},t.updateControlListScrollbar=function(t){var e,r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"scrollbargroup"),n=p.findChildOfType(i,"handle"),a=f.getFloatAttribute(r,"height"),o=p.findChildOfType(r,"itemgroup").childElementCount,s=0;if(e=o>0&&a<(s=o*f.getFloatAttribute(t,"item-height")),i.setAttribute("visibility",e?"inherit":"hidden"),e){n.setAttribute("y","2");var l=Math.max(a*(a/s)-4,7);n.setAttribute("height",l.toString());var u=(s-a)/(a-l-4);t.setAttribute("scroll-scale",u.toString())}},t.dragging=!1,t}(),Sm=function(){function t(t){this.frameDrawing=t,this.controlSlider=new Tm(this),this.controlList=new Cm(this)}return t.prototype.createControl=function(e){switch(e){case"ControlButton":return this.createButton();case"ControlCheckbox":return this.createCheckbox();case"ControlSlider":return this.controlSlider.createSlider();case"ControlRadioButtonGroup":return t.createRadioButtonGroup();case"ControlListBox":return t.createListBox();case"ControlComboBox":return this.createComboBox();case"ControlTextField":return this.createTextField();case"ControlFileChooser":return this.createFileChooser();case"ControlProgressBar":return t.createProgressBar()}},t.prototype.updateControl=function(e,r,i){var n=e;switch(n.getAttribute("type")){case"ControlButton":t.updateButton(n,r,i);break;case"ControlCheckbox":t.updateCheckbox(n,r,i);break;case"ControlSlider":Tm.updateSlider(n,r,i);break;case"ControlRadioButtonGroup":this.updateRadioButtonGroup(n,r,i);break;case"ControlListBox":this.updateListBox(n,r,i);break;case"ControlComboBox":this.updateComboBox(n,r,i);break;case"ControlTextField":t.updateTextField(n,r,i);break;case"ControlFileChooser":t.updateFileChooser(n,r,i);break;case"ControlProgressBar":t.updateProgressBar(n,r,i)}},t.isDisabled=function(t){return"false"==t.getAttribute("enabled")},t.prototype.createButton=function(){var e=this,r=p.cloneElementWithId("control-button");return new m(r,function(e){return t.onButtonOver(r)},function(e){return t.onButtonOut(r)},function(e){return t.onButtonDown(r)},function(t){return e.onButtonPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateButton=function(e,r,i){for(var n=p.findChildOfType(e,"background"),a=p.findChildOfType(e,"text"),o=0;o<r.length;o++)switch(r[o]){case"enabled":e.setAttribute(r[o],i[o]);var s="true"==i[o];n.setAttribute("class",s?"control-background":"control-background-disabled"),a.setAttribute("class",s?"control-button-text":"control-text-disabled");break;case"text":a.firstChild.textContent=i[o];break;case"background-color":break;case"text-color":a.setAttribute("fill",i[o]);break;case"font-style":a.style.font=i[o],t.centerControlText(a,n,!0,!0);break;case"width":case"height":var l=parseFloat(i[o])-2;n.setAttribute(r[o],l.toString()),t.centerControlText(a,n,!0,!0);break;default:xm.filterAndSetAttribute(e,r[o],i[o])}},t.onButtonOver=function(t){var e=p.findChildOfType(t,"background"),r=p.findChildOfType(t,"text");e.setAttribute("class","control-fill-color-transition"),r.setAttribute("class","control-text-selected-hover")},t.onButtonOut=function(t){var e=p.findChildOfType(t,"background"),r=p.findChildOfType(t,"text");e.setAttribute("class","control-background"),r.setAttribute("class","control-button-text")},t.onButtonDown=function(t){var e=p.findChildOfType(t,"background"),r=p.findChildOfType(t,"text");e.setAttribute("class","control-button-background-pressed"),r.setAttribute("class","control-fill-pressed")},t.prototype.onButtonPressed=function(t){this.frameDrawing.client.postUserAction(t.id,null)},t.prototype.createCheckbox=function(){var e=this,r=p.cloneElementWithId("control-checkbox");return new m(r,function(e){return t.onCheckboxOver(r)},function(e){return t.onCheckboxOut(r)},function(e){return t.onCheckboxDown(r)},function(t){return e.onCheckboxPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateCheckbox=function(e,r,i){for(var n=p.findChildOfType(e,"background"),a=p.findChildOfType(e,"box"),o=p.findChildOfType(e,"check"),s=p.findChildOfType(e,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];a.setAttribute("class",u?"control-checkbox-box":"control-checkbox-box-disabled"),o.setAttribute("class",u?"control-checkbox-check":"control-checkbox-check-disabled"),s.setAttribute("class",u?"":"control-text-disabled");break;case"text":s.firstChild.textContent=i[l];break;case"background-color":n.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":s.style.font=i[l],t.centerControlText(s,n,!1,!0);break;case"width":n.setAttribute(r[l],i[l]);break;case"height":n.setAttribute(r[l],i[l]);var c=parseFloat(i[l]);a.setAttribute("y",(c/2-8).toString()),o.setAttribute("transform","translate(0,"+(c/2-8)+")"),t.centerControlText(s,n,!1,!0);break;case"value":o.setAttribute("visibility","true"==i[l]?"inherit":"hidden");break;default:xm.filterAndSetAttribute(e,r[l],i[l])}},t.onCheckboxOver=function(t){var e=p.findChildOfType(t,"box"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box-hover"),r.setAttribute("class","control-checkbox-check-hover")},t.onCheckboxOut=function(t){var e=p.findChildOfType(t,"box"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-checkbox-box"),r.setAttribute("class","control-checkbox-check")},t.onCheckboxDown=function(t){var e=p.findChildOfType(t,"box"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-checkbox-check-pressed")},t.prototype.onCheckboxPressed=function(t){var e=p.findChildOfType(t,"check"),r="inherit"==e.getAttribute("visibility");r=!r,e.setAttribute("visibility",r?"inherit":"hidden"),this.frameDrawing.client.postUserAction(t.id,r.toString())},t.createRadioButtonGroup=function(){return p.cloneElementWithId("control-radio-button-group")},t.prototype.updateRadioButtonGroup=function(e,r,i){for(var n=this,a=0;a<r.length;a++)switch(r[a]){case"enabled":e.setAttribute(r[a],i[a]);for(var o="true"==i[a],s=p.childElements(e),l=0;l<s.length;l++){var u=s[l],c=p.findChildOfType(u,"circle"),h=p.findChildOfType(u,"check"),d=p.findChildOfType(u,"text");c.setAttribute("class",o?"control-radiobutton-circle":"control-radiobutton-circle-disabled"),h.setAttribute("class",o?"control-radiobutton-check":"control-text-disabled"),d.setAttribute("class",o?"":"control-text-disabled")}break;case"text-array":var g=i[a].split("\n"),b=function(r){var i=p.cloneElementWithId("radio-button"),a=p.findChildOfType(i,"background");e.hasAttribute("background-color")&&a.setAttribute("fill",e.getAttribute("background-color"));var o=p.findChildOfType(i,"text");o.firstChild.textContent=g[r],e.hasAttribute("text-color")&&o.setAttribute("fill",e.getAttribute("text-color")),new m(i,function(e){return t.onRadioButtonOver(i)},function(e){return t.onRadioButtonOut(i)},function(e){return t.onRadioButtonDown(i)},function(t){return n.onRadioButtonPressed(i)},function(e){return t.isDisabled(i.parentNode)}),e.appendChild(i)};for(l=0;l<g.length;l++)b(l);break;case"background-color":case"text-color":e.setAttribute(r[a],i[a]);break;case"font-style":e.style.font=i[a];break;case"width":case"height":e.setAttribute(r[a],i[a]);break;case"vertical":var v=f.getFloatAttribute(e,"width"),y=f.getFloatAttribute(e,"height"),A=0;s=p.childElements(e);for(l=0;l<s.length;l++){u=s[l];var T=p.findChildOfType(u,"background"),C=(d=p.findChildOfType(u,"text")).getBBox();if("true"==i[a]){var S=Math.max(25,1.5*C.height);u.setAttribute("transform","translate(0,"+S*l+")"),f.setMultipleAttributes(T,["width","height"],[v,S])}else{var E=20+C.width+10;u.setAttribute("transform","translate("+A+",0)"),f.setMultipleAttributes(T,["width","height"],[E,y]),A+=E}t.centerRadioButton(u)}break;case"value":var w=parseInt(i[a]);s=p.childElements(e);for(l=0;l<s.length;l++){u=s[l];(h=p.findChildOfType(u,"check")).setAttribute("visibility",w==l?"inherit":"hidden")}break;default:xm.filterAndSetAttribute(e,r[a],i[a])}},t.onRadioButtonOver=function(t){var e=p.findChildOfType(t,"circle"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle-hover"),r.setAttribute("class","control-fill-color-transition")},t.onRadioButtonOut=function(t){var e=p.findChildOfType(t,"circle"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-radiobutton-circle"),r.setAttribute("class","control-radiobutton-check")},t.onRadioButtonDown=function(t){var e=p.findChildOfType(t,"circle"),r=p.findChildOfType(t,"check");e.setAttribute("class","control-fill-color"),r.setAttribute("class","control-fill-pressed")},t.prototype.onRadioButtonPressed=function(t){if("inherit"!=p.findChildOfType(t,"check").getAttribute("visibility")){for(var e,r=t.parentNode,i=p.childElements(r),n=0;n<i.length;n++){var a=i[n];p.findChildOfType(a,"check").setAttribute("visibility",a==t?"inherit":"hidden"),a==t&&(e=n)}this.frameDrawing.client.postUserAction(r.id,e.toString())}},t.centerRadioButton=function(e){var r=p.findChildOfType(e,"background"),i=p.findChildOfType(e,"circle"),n=p.findChildOfType(e,"check"),a=p.findChildOfType(e,"text"),o=f.getFloatAttribute(r,"height");i.setAttribute("cy",(o/2).toString()),n.setAttribute("cy",(o/2).toString()),t.centerControlText(a,r,!1,!0)},t.createListBox=function(){return Cm.createControlList(!1)},t.prototype.updateListBox=function(t,e,r){this.controlList.updateControlList(t,e,r)},t.prototype.createComboBox=function(){var e=this,r=p.cloneElementWithId("control-combobox");new m(r,function(t){return e.onComboBoxEvent(r,"over",t)},function(t){return e.onComboBoxEvent(r,"out",t)},function(t){return e.onComboBoxEvent(r,"down",t)},function(t){return e.onComboBoxEvent(r,"click",t)},function(e){return t.isDisabled(r)});var i=Cm.createControlList(!0);return i.setAttribute("type","dropdown"),i.setAttribute("visibility","hidden"),this.controlList.updateControlList(i,["multiple"],["false"]),r.appendChild(i),r},t.prototype.updateComboBox=function(e,r,i){for(var n=p.findChildOfType(e,"svg"),a=p.findChildOfType(e,"border"),o=p.findChildOfType(e,"dropdown"),s=p.findChildOfType(n,"background"),l=p.findChildOfType(n,"text"),u=p.findChildOfType(n,"arrowback"),c=p.findChildOfType(n,"arrow"),h=0;h<r.length;h++)switch(r[h]){case"enabled":e.setAttribute(r[h],i[h]);var d="true"==i[h];l.setAttribute("class",d?"":"control-text-disabled"),a.setAttribute("class",d?"control-border":"control-border-disabled"),d||o.setAttribute("visibility","hidden"),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-array":var m=f.splitSkipEmpty(i[h],"\n"),g=m.length>0?m[0]:"";l.firstChild.textContent=g,this.controlList.updateControlList(o,[r[h]],[i[h]]),this.controlList.adjustControlListHeightToItems(o,5),this.controlList.updateControlList(o,["value"],[g]);break;case"background-color":s.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"text-color":l.setAttribute("fill",i[h]),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"font-style":e.style.font=i[h],t.centerControlText(l,s,!1,!0),this.controlList.updateControlList(o,[r[h]],[i[h]]);break;case"width":case"height":var b=parseFloat(i[h]);if(n.setAttribute(r[h],i[h]),s.setAttribute(r[h],i[h]),a.setAttribute(r[h],i[h]),"width"==r[h])u.setAttribute("x",(b-20).toString()),this.controlList.updateControlList(o,[r[h]],[i[h]]);else{t.centerControlText(l,s,!1,!0),u.setAttribute("height",b.toString()),o.setAttribute("transform","translate(0,"+i[h]+")");var v=5*parseFloat(i[h]);this.controlList.updateControlList(o,["height"],[v.toString()])}if(n.hasAttribute("width")&&n.hasAttribute("height")){var y=f.getFloatAttribute(n,"width")-10,A=f.getFloatAttribute(n,"height")/2;c.setAttribute("transform","translate("+y+","+A+")")}break;case"editable":e.setAttribute(r[h],i[h]);break;case"value":l.firstChild.textContent=i[h],this.controlList.updateControlList(o,[r[h]],[i[h]]);break;default:xm.filterAndSetAttribute(e,r[h],i[h])}},t.prototype.onComboBoxEvent=function(t,e,r){var i=p.findChildOfType(t,"svg"),n=p.findChildOfType(t,"border"),a=p.findChildOfType(t,"dropdown"),o=p.findChildOfType(i,"background"),s=p.findChildOfType(i,"text"),l=p.findChildOfType(i,"arrowback"),u=p.findChildOfType(i,"arrow"),c="true"==t.getAttribute("editable");switch(e){case"over":r instanceof MouseEvent&&(n.setAttribute("class","control-border-hover"),l.setAttribute("class","control-combobox-arrow-background-hover"),u.setAttribute("class","control-fill-color-transition"));break;case"out":r instanceof MouseEvent&&(n.setAttribute("class","control-border"),l.setAttribute("class","control-fill-transparent-transition"),u.setAttribute("class","control-fill-transparent-transition"),a.setAttribute("visibility","hidden"));break;case"down":r.stopPropagation(),!c||r.target!=o&&r.target!=s||this.displayTextInputForComboBox(t);break;case"click":if(c&&r.target!=l&&r.target!=u)this.displayTextInputForComboBox(t);else{r.stopPropagation(),r.preventDefault(),p.bringElementToFront(t);var h="inherit"==a.getAttribute("visibility");a.setAttribute("visibility",h?"hidden":"inherit");var d=p.findChildOfType(a,"border"),m=f.getFloatAttribute(n,"height"),g=f.getFloatAttribute(d,"height"),b=this.frameDrawing.client.svgContainer.getBoundingClientRect(),v=d.getBoundingClientRect();v.bottom>b.bottom?a.setAttribute("transform","translate(0,"+-g+")"):v.top<b.top&&a.setAttribute("transform","translate(0,"+m+")")}}},t.prototype.displayTextInputForComboBox=function(t){var e=this,r=p.findChildOfType(t,"svg"),i=p.findChildOfType(t,"dropdown"),n=p.findChildOfType(t,"border"),a=p.findChildOfType(r,"text");this.frameDrawing.textInputForSVG.display(a.firstChild.textContent,n,t,"left",function(r){a.firstChild.textContent=r,e.frameDrawing.client.postUserAction(t.id,r),e.controlList.updateControlList(i,["value"],[r])})},t.prototype.onComboBoxUserSelectionFromDropDown=function(t,e){var r=p.findChildOfType(t,"svg"),i=p.findChildOfType(t,"dropdown"),n=p.findChildOfType(r,"text");i.setAttribute("visibility","hidden");var a=e.split("\n")[0];n.firstChild.textContent=a,this.frameDrawing.client.postUserAction(t.id,a)},t.prototype.createTextField=function(){var e=this,r=p.cloneElementWithId("control-textfield");return new m(r,function(e){return t.onTextFieldOver(r)},function(e){return t.onTextFieldOut(r)},function(t){return e.onTextFieldDown(r,t)},function(t){return e.onTextFieldDown(r,t)},function(e){return t.isDisabled(r)}),r},t.updateTextField=function(e,r,i){for(var n=p.findChildOfType(e,"svg"),a=p.findChildOfType(e,"border"),o=p.findChildOfType(n,"background"),s=p.findChildOfType(n,"text"),l=0;l<r.length;l++)switch(r[l]){case"enabled":e.setAttribute(r[l],i[l]);var u="true"==i[l];s.setAttribute("class",u?"":"control-text-disabled"),a.setAttribute("class",u?"control-border":"control-border-disabled");break;case"background-color":o.setAttribute("fill",i[l]);break;case"text-color":s.setAttribute("fill",i[l]);break;case"font-style":e.style.font=i[l],t.centerControlText(s,o,!1,!0);break;case"width":case"height":n.setAttribute(r[l],i[l]),o.setAttribute(r[l],i[l]),a.setAttribute(r[l],i[l]),"width"==r[l]&&s.setAttribute("x",(parseFloat(i[l])-2).toString()),t.centerControlText(s,o,!1,!0);break;case"value":s.firstChild.textContent=i[l];break;default:xm.filterAndSetAttribute(e,r[l],i[l])}},t.onTextFieldOver=function(t){p.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onTextFieldOut=function(t){p.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onTextFieldDown=function(t,e){var r=this;e.stopPropagation();var i=p.findChildOfType(t,"svg"),n=p.findChildOfType(t,"border"),a=p.findChildOfType(i,"text");this.frameDrawing.textInputForSVG.display(a.firstChild.textContent,n,t,"right",function(e){a.firstChild.textContent=e,r.frameDrawing.client.postUserAction(t.id,e)})},t.prototype.createFileChooser=function(){var e=this,r=p.cloneElementWithId("control-file-chooser");return new m(r,function(e){return t.onFileChooserOver(r)},function(e){return t.onFileChooserOut(r)},null,function(t){return e.onFileChooserPressed(r)},function(e){return t.isDisabled(r)}),r},t.updateFileChooser=function(e,r,i){for(var n=p.findChildOfType(e,"background"),a=p.findChildOfType(e,"progress"),o=p.findChildOfType(e,"svg"),s=p.findChildOfType(o,"text"),l=p.findChildOfType(e,"border"),u=0;u<r.length;u++)switch(r[u]){case"enabled":e.setAttribute(r[u],i[u]);var c="true"==i[u];n.setAttribute("class",c?"control-background":"control-background-disabled"),s.setAttribute("class",c?"control-button-text":"control-text-disabled"),l.setAttribute("class",c?"control-border":"control-border-disabled"),c?e.setAttribute("style","cursor: pointer"):e.removeAttribute("style");break;case"background-color":n.setAttribute("style","fill: "+i[u]),a.setAttribute("style","fill: "+f.changeBrightness(i[u],.8));break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":s.style.font=i[u],t.centerControlText(s,n,!1,!0);break;case"width":case"height":if(n.setAttribute(r[u],i[u]),o.setAttribute(r[u],i[u]),l.setAttribute(r[u],i[u]),"height"==r[u]){a.setAttribute(r[u],i[u]);var h=parseFloat(i[u]);s.setAttribute("x",(h/4).toString())}break;case"upload":e.setAttribute(r[u],i[u]);break;case"title":e.setAttribute(r[u],i[u]),s.firstChild.textContent=i[u];break;default:xm.filterAndSetAttribute(e,r[u],i[u])}},t.onFileChooserOver=function(t){p.findChildOfType(t,"border").setAttribute("class","control-border-hover")},t.onFileChooserOut=function(t){p.findChildOfType(t,"border").setAttribute("class","control-border")},t.prototype.onFileChooserPressed=function(t){var e=this;if("true"==t.getAttribute("upload")){var r=document.getElementById("file-input-for-svg");r.setAttribute("control-id",t.id),r.accept=t.getAttribute("accept"),r.onchange=function(){return e.onFileChosen()},r.click()}else{var i=t.getAttribute("value");this.frameDrawing.client.networkManager.downloadFile(i),this.frameDrawing.client.postUserAction(t.id,null)}},t.prototype.onFileChosen=function(){var t=this,e=document.getElementById("file-input-for-svg"),r=e.getAttribute("control-id"),i=e.files;if(i.length>0){var n=i[0],a=document.getElementById(r);this.frameDrawing.client.networkManager.uploadFile(r,n,function(e){return t.onFileUploadProgress(e,a)},function(e){return t.onFileUploaded(a)},function(e){return t.onFileUploadError(a,e)},"file");var o=p.findChildOfType(a,"svg");p.findChildOfType(o,"text").firstChild.textContent=d.msg.UPLOADING()+" "+n.name+" ["+f.formatNumber(n.size,0)+" "+d.msg.BYTES()+"]"}e.value=""},t.prototype.onFileUploadProgress=function(t,e){if(!this.frameDrawing.client.isStoppedAndShouldIgnoreResponses()&&t.lengthComputable){var r=t.loaded/t.total,i=p.findChildOfType(e,"background"),n=p.findChildOfType(e,"progress"),a=f.getFloatAttribute(i,"width");n.setAttribute("width",(a*r).toString())}},t.prototype.onFileUploaded=function(t){if(!this.frameDrawing.client.isStoppedAndShouldIgnoreResponses()){var e=p.findChildOfType(t,"progress"),r=p.findChildOfType(t,"svg"),i=p.findChildOfType(r,"text");e.setAttribute("width","0"),i.firstChild.textContent=i.firstChild.textContent.replace(d.msg.UPLOADING()+" ","")}},t.prototype.onFileUploadError=function(t,e){if(!this.frameDrawing.client.isStoppedAndShouldIgnoreResponses()){var r=p.findChildOfType(t,"progress"),i=p.findChildOfType(t,"svg"),n=p.findChildOfType(i,"text");r.setAttribute("width","0"),n.firstChild.textContent=d.msg.UPLOAD_FAILED()+": "+e}},t.createProgressBar=function(){return p.cloneElementWithId("control-progress-bar")},t.updateProgressBar=function(e,r,i){for(var n=e.firstElementChild,a=p.findChildOfType(n,"background"),o=p.findChildOfType(n,"progress"),s=p.findChildOfType(n,"text"),l=p.findChildOfType(n,"border"),u=0;u<r.length;u++)switch(r[u]){case"background-color":e.setAttribute("fill",i[u]);break;case"text-color":s.setAttribute("fill",i[u]);break;case"font-style":s.style.font=i[u],t.centerControlText(s,a,!1,!0);break;case"width":case"height":e.setAttribute(r[u],i[u]);break;case"vertical":var c="true"==i[u],h=e.getAttribute(c?"height":"width"),d=e.getAttribute(c?"width":"height");a.setAttribute("width",h),a.setAttribute("height",d),o.setAttribute("height",d),t.centerControlText(s,a,!0,!0),l.setAttribute("width",h),l.setAttribute("height",d),c&&n.setAttribute("transform","translate(0,"+h+") rotate(-90)");break;case"text":s.firstChild.textContent="null"==i[u]?"":i[u];break;case"value":var m=f.getFloatAttribute(a,"width"),g=Math.min(parseFloat(i[u]),1);"null"==i[u]?(o.setAttribute("class","control-progressbar-indeterminate"),o.setAttribute("width",m.toString())):(o.setAttribute("class","control-slider-progress"),o.setAttribute("width",(g*m).toString()));break;default:xm.filterAndSetAttribute(e,r[u],i[u])}},t.centerControlText=function(t,e,r,i){var n=f.getFloatAttribute(e,"width"),a=f.getFloatAttribute(e,"height"),o=t.getBBox();r&&n&&t.setAttribute("x",(1+n/2).toString()),i&&a&&t.setAttribute("y",(1+a/2+.3*o.height).toString())},t.prototype.onControlListSelectionChanged=function(t,e){"ControlListBox"==t.getAttribute("type")?this.frameDrawing.client.postUserAction(t.id,e):"ControlComboBox"==(t=t.parentNode).getAttribute("type")&&this.onComboBoxUserSelectionFromDropDown(t,e)},t.controlTypes=["ControlButton","ControlCheckbox","ControlSlider","ControlRadioButtonGroup","ControlListBox","ControlComboBox","ControlTextField","ControlFileChooser","ControlProgressBar"],t}(),Em=function(){function t(){var t=this;this.onEventClosure=function(e){return t.onEvent(e)}}return t.prototype.start=function(){this.textdiv=document.getElementById("text-input-for-svg-container"),this.textdiv.onmousedown=this.onEventClosure,this.textdiv.onwheel=this.onEventClosure,this.textdiv.onkeydown=this.onEventClosure,this.textdiv.ontouchstart=this.onEventClosure,window.addEventListener("resize",this.onEventClosure,!1),w.addFullScreenListener(this.onEventClosure)},t.prototype.stop=function(){window.removeEventListener("resize",this.onEventClosure,!1),w.removeFullScreenListener(this.onEventClosure)},t.prototype.display=function(t,e,r,i,n,a){void 0===a&&(a=0),this.textdiv.style.display="block";var o=e.getBoundingClientRect(),s=f.getFloatAttribute(e,"width"),l=f.getFloatAttribute(e,"height"),u=o.width/s,c=this.textdiv.firstElementChild;c.style.left=o.left+"px",c.style.top=o.top+"px",c.style.width=s+"px",c.style.height=l+"px",c.style.paddingBottom=0==a?"0":l-a+"px",c.style.transform="scale("+u+")",c.style.font=window.getComputedStyle(r).font,c.style.textAlign=i,c.value=t,this.text=t,this.onchange=n,window.setTimeout(function(){c.focus(),c.select()},0)},t.prototype.onEvent=function(t){var e=this.textdiv.firstElementChild,r=!1,i=!1;switch(t.type){case"mousedown":case"touchstart":t.target!=e?(r=!0,i=!0):t.stopPropagation();break;case"keydown":var n=t;r="Enter"==n.code||"Escape"==n.code||"Tab"==n.code,i="Enter"==n.code||"Tab"==n.code;break;default:r=!0}r&&this.onchange&&(this.textdiv.style.display="none",i&&e.value!=this.text&&this.onchange(e.value),this.onchange=null,this.text=null)},t}(),wm=function(){function t(){}return t.create=function(t){var e=p.createSvgElement("rect"),r=p.createCanvas(t,"canvas-group-3d");e.setAttribute("stroke","none"),e.setAttribute("fill","gray");var i=Yp.getWorld().createCanvas3D(t,r),n=document.getElementById("canvas-group-3d"),a=document.createElement("div");a.style.display="none",a.className="context-menu-3d",a.tabIndex=0;var o=function(){a.style.display="none",document.removeEventListener("mousedown",s,!0),document.removeEventListener("touchstart",s,!0)},s=function(t){a.contains(t.target)||o.call(null)};a.addEventListener("blur",o),a.addEventListener("keydown",function(t){27==t.keyCode&&o.call(null)});var l=document.createElement("div");a.appendChild(l),l.className="context-menu-3d-item";var u=function(t){t.preventDefault(),o.call(null);var e=i.getCameraData();f.copyToClipboard(e)};l.addEventListener("mousedown",u),l.addEventListener("touchstart",u);var c=document.createElement("img");c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACB0lEQVQ4ja2S3UuacRSAf/+VdOXVNrwf8kJFsGGri4FjXzVaoMy+bLq0tG/ntFgvvPUmm3MULPdhQhB4sTbG6MNhJit11fRVL55dGG1SzV3swAOHwzkPB84R4n9GPB7HbDbT2NiI0WjEZrORSCT4p+FgcIaenp4zzaq6yOjo2N8lic19upVtel+kcYT38C5ncEYyuF7v4YxkGI7ssvBhp0by+dNHliIvq7Xnb76S2Ny/EHUty2hoAyGEeBtdQVVkVEVmKRL+LXi/kb2QiZUDTJ51VEXmmd/PTMCPZ9jFoH0AYXcvcR4m5zvkWAo5ljoVPLb30/2wiwedHdy7c5vOjvtVQaVcqqFr4guOkTBWNYV1Mc1deQ+TZx2T6TqtrSaam5uQJIn2tjaEYyRMWSuwGhoiMNBCuVTgydz2qeRWIEl7MM019xpXLl/CYDCg1+tpaGjAaDQiXB6VinZERTuiXDikXDyuoh3jHlmgaWyHpvEkN9wxhBAiFAohSRI6nQ69Xo/weucoF/KshoZYnrWieG4SGGih9DOH1zvH1UevkPqjxDbSNWeMRqNYLBaEbzJI6ej7ufgmg/W/0D8+hvZj98wGWn4X/9REfcHspAstl6SY/YaWT6LlTsgnmZ1y1RfI04No2U2KB1touW2K+1tVDraQfY76gnl/H/NP+1Cme1F8J/yR15v/BbvaAYzt4uTOAAAAAElFTkSuQmCC",l.appendChild(c);var h=document.createElement("p");h.style.margin="0 5px 0 10px",h.innerText=d.msg.COPY_CAMERA_LOCATION(),l.appendChild(h),n.appendChild(a);var m=!0;return r.addEventListener("touchstart",function(t){t.touches.length>1&&(m=!1)}),r.addEventListener("touchend",function(t){return m=!0}),r.addEventListener("contextmenu",function(t){m&&(t.preventDefault(),document.addEventListener("mousedown",s,!0),document.addEventListener("touchstart",s,!0),a.style.display="",a.style.left=t.clientX+"px",a.style.top=t.clientY+"px",a.focus())}),e},t.update=function(e,r,i){for(var n=e,a=document.getElementById(e.id+"canvas"),o=0;o<r.length;o++)switch(r[o]){case"width":case"height":n.setAttribute(r[o],i[o]),t.syncCanvas3DPosition(a);break;default:xm.filterAndSetAttribute(e,r[o],i[o]),"pos"==r[o]||"scale"==r[o]?t.syncCanvas3DPosition(a):"visibility"==r[o]&&(a.style.visibility=i[o],t.syncCanvas3DPosition(a))}},t.syncCanvas3DPosition=function(t){var e=parseInt(t.id),r=document.getElementById(e.toString());if(null!=r.getAttribute("height")&&null!=r.getAttribute("width")){var i=r.getBoundingClientRect(),n=t.parentNode.getBoundingClientRect(),a=i.left-n.left,o=i.top-n.top;t.style.left=a+"px",t.style.top=o+"px";var s=Math.round(i.width),l=Math.round(i.height);if((s!=t.width||l!=t.height)&&(t.width=s,t.height=l,t.style.width=s+"px",t.style.height=l+"px",!Yp.getWorld().active)){var u=t.getContext("2d");null!=u&&(u.fillStyle="rgba(255,0,0,0.2)",u.fillRect(0,0,t.width,t.height))}var c="inherit"!==t.style.visibility||a>n.width||o>n.height||a+s<0||o+l<0;Yp.getWorld().updateCanvasSize(t,!c)}},t.syncAllCanvas3DPositions=function(){for(var e=document.getElementById("canvas-group-3d").children,r=0,i=[].slice.call(e);r<i.length;r++){var n=i[r];n instanceof HTMLCanvasElement&&t.syncCanvas3DPosition(n)}},t}(),km=function(){function t(){var t=this;this.active=!1,this.times=new Array(10),this.lastTime=0,this.frameCount=0,this.rafID=0,this.callback=function(){return t.run()}}return t.prototype.run=function(){if(this.active){var t=window.performance.now();this.lastTime>0&&(this.times[this.frameCount%this.times.length]=t-this.lastTime,this.frameCount++),this.lastTime=t,this.rafID=window.requestAnimationFrame(this.callback)}},t.prototype.start=function(){this.active=!0,this.frameCount=0,this.times.fill(0),this.lastTime=0,this.run()},t.prototype.stop=function(){this.active&&(this.active=!1,window.cancelAnimationFrame(this.rafID))},t.prototype.getFramePaintTime=function(){for(var t=this.times,e=0,r=0;r<t.length;r++)e+=t[r];return e/t.length},t.prototype.getFps=function(t){void 0===t&&(t=60);var e=this.getFramePaintTime(),r=0==e?t:Math.round(1e3/e);return Math.min(t,r)},t.prototype.isValid=function(){return this.active&&window.performance.now()-this.lastTime<5e3},t}(),xm=function(){function t(e){this.infoCommandListeners=[],this.client=e,this.actualFIStats=new tm(t.MEASURED_FRAME_STATISTICS_SIZE,1e3/Bm.START_FPS),this.browserFPSStats=new tm(t.MEASURED_FRAME_STATISTICS_SIZE,Bm.START_FPS),this.suggestedFPSStats=new tm(t.SUGGESTED_FPS_STATISTICS_SIZE,Bm.START_FPS),this.shapeComposite=new em(e),this.shapeGISMap=new fm(e),this.shapeModelPrimitives=new nm(this),this.chart=new cm(e),this.control=new Sm(this),this.textInputForSVG=new Em,this.shapeInspect=new dm(this),this.world3d=Yp.getWorld(),this.animationFpsCounter=new km}return t.prototype.start=function(){this.packetBuffer=[],this.resetAdaptiveness(),this.nextFrameDueTime=void 0,this.lastFrameStartTime=void 0,this.textInputForSVG.start(),this.world3d.networkManager=this.client.networkManager,this.animationFpsCounter.start(),this.frameDrawingLoop()},t.prototype.stop=function(){window.cancelAnimationFrame(this.requestAnimationFrameId),this.packetBuffer=[],this.world3d.deactivate(),this.textInputForSVG.stop(),this.animationFpsCounter.stop()},t.prototype.addPacket=function(t){this.packetBuffer.push(t)},t.prototype.addAllPackets=function(t){this.packetBuffer=this.packetBuffer.concat(t)},t.prototype.frameContainsRemoveSVGImage=function(t){var e=t.commands,r=this.client.presentation.firstElementChild;if(null==r)return!0;for(var i=0;i<e.length;i++){var n=e[i];if("D"==n.cmd&&n.id==r.id)return!0}return!1},t.prototype.getPacketFPS=function(){return this.packetFPS},t.prototype.framesToPlay=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.timeToPlay=function(){for(var t=0,e=0,r=this.packetBuffer;e<r.length;e++){var i=r[e];t+=i.frames.length/i.fps}return t},t.prototype.actualFPS=function(){return 1e3/this.actualFIStats.linearWeightedAverage()},t.prototype.frameDrawingLoop=function(){var t=this;this.requestAnimationFrameId=window.requestAnimationFrame(function(){return t.frameDrawingLoop()});var e=performance.now(),r=1e3/this.desiredFPS;if(this.nextFrameDueTime||(this.nextFrameDueTime=e),e>=this.nextFrameDueTime){for(this.lastFrameStartTime&&this.actualFIStats.add(e-this.lastFrameStartTime),this.lastFrameStartTime=e,this.animationFpsCounter.isValid()&&this.browserFPSStats.add(this.animationFpsCounter.getFps());this.nextFrameDueTime<=e;)this.nextFrameDueTime+=r;var i=this.getNextFrame();i&&(this.drawFrame(i),this.updateDesiredFPS(),this.adjustServerFPS(),this.client.panels.updateMoreDebugInfo(" Br / Ac / Sg / Des: "+f.formatNumber(this.browserFPSStats.linearWeightedAverage(),1,!1)+"/"+f.formatNumber(this.actualFPS(),1,!1)+"/"+f.formatNumber(this.suggestedFPSStats.linearWeightedAverage(),1,!1)+"/"+f.formatNumber(this.desiredFPS,1,!1)))}},t.prototype.getNextFrame=function(){for(;this.packetBuffer&&this.packetBuffer.length>0;){if(this.packetFPS=this.packetBuffer[0].fps,this.packetBuffer[0].frames.length>0)return this.packetBuffer[0].frames.shift();this.packetBuffer.shift()}},t.prototype.findOrRequestFullFrame=function(){for(;this.packetBuffer&&this.packetBuffer.length>0;){for(;this.packetBuffer[0].frames.length>0&&!this.packetBuffer[0].frames[0].fullFrame;)this.packetBuffer[0].frames.shift();if(this.packetBuffer[0].frames.length>0)return;this.packetBuffer.shift()}this.client.packetManager.requestAndWaitFullFrame()},t.prototype.updateDesiredFPS=function(){var t=this.timeToPlay(),e=this.client.packetRequester.getRequestInterval()/1e3,r=1/this.packetFPS,i=Math.max(e,r);if(t>i){var n=t/i;this.desiredFPS=this.packetFPS*n}else this.desiredFPS=this.packetFPS},t.prototype.adjustServerFPS=function(){if(!this.client.isStoppedAndShouldIgnoreResponses()&&this.animationFpsCounter.isValid()){var e=(this.actualFPS()+this.browserFPSStats.linearWeightedAverage())/2;this.suggestedFPSStats.add(e),e=this.suggestedFPSStats.linearWeightedAverage(),(e=f.snapToArrayValue(t.fpsValues,e,!1))!=this.requestedFPS&&(this.requestedFPS=e,this.client.networkManager.postMaxFPS(this.requestedFPS))}},t.prototype.resetAdaptiveness=function(){this.packetFPS=Bm.START_FPS,this.desiredFPS=Bm.START_FPS,this.requestedFPS=Bm.START_FPS,this.actualFIStats.reset(),this.browserFPSStats.reset(),this.suggestedFPSStats.reset()},t.prototype.drawFrame=function(t){this.client.updateExperimentState(t),this.world3d.applyFrame(t,this.frameContainsRemoveSVGImage(t)),t.fullFrame&&p.removeAllChildren(this.client.presentation),t.fullFrame&&0==t.commands.length?this.emptyErrorFrames||(this.client.showFadingInfoLine(d.msg.ERROR_DRAWING_FRAME(),!1,"white","orangered"),this.emptyErrorFrames=!0):this.emptyErrorFrames&&(this.client.hideFadingInfoLine(),this.emptyErrorFrames=!1);for(var e=0,r=0,i=0,n=0;n<t.commands.length;n++){var a=t.commands[n],o=void 0,s=a.att,l=a.val,u=void 0;switch(a.cmd){case"C":var c=f.getAttributeValue(s,l,"shape-type"),h=f.getAttributeValue(s,l,"owner-id"),m=f.getAttributeValue(s,l,"add-after"),g=null!=f.getAttributeValue(s,l,"has-click-handler");if(f.getAttributeValue(s,l,"draw-mode").includes("2D")||(c="Shape3DOnly"),u=this.createShape(c,a.id),"null"==h)this.client.presentation.appendChild(u);else{if(null==(o=document.getElementById(h)))return console.log("Animation: Can't find container to add a shape to, container id = "+h,a),void this.findOrRequestFullFrame();if("ShapeGISMap"==o.getAttribute("type")){var b=p.findChildOfType(o,"map").firstElementChild;o=c.startsWith("MarkupGIS")?p.findChildOfType(b,"markup"):p.findChildOfType(b,"agents")}if("null"==m){var v=o.firstElementChild;null==v?o.appendChild(u):o.insertBefore(u,v)}else{if(o.lastElementChild.id==m)o.appendChild(u);else{var y=document.getElementById(m);if(null==y)return console.log("Animation: Can't find element to add after, el id = "+m,a),void this.findOrRequestFullFrame();if(!o.contains(y))return console.log("Animation: the element to add after not found in group, el id = "+m,a),void this.findOrRequestFullFrame();var A=y.nextElementSibling;o.insertBefore(u,A)}}}g&&this.assignClickableShapeClickHandler(u,c),this.updateShape(u,s,l),e++;break;case"U":if(null==(u=document.getElementById(a.id)))return console.log("Animation: Can't find shape to be updated, shape id = "+a.id,a),void this.findOrRequestFullFrame();this.updateShape(u,s,l),r++;break;case"D":if(null==(u=document.getElementById(a.id)))return console.log("Animation: Can't find shape to be deleted, shape id = "+a.id,a),void this.findOrRequestFullFrame();p.removeElement(u),i++;break;case"S":this.applySettings(s,l);break;case"N":this.applyNavigation(s,l,t.fullFrame);break;case"M":this.client.showMessageBox(l[0],l[1],l[2]);break;case"W":this.client.openURL(l[0]);break;case"P":this.client.copyToClipboard(l[0]);break;case"I":this.onInfoCommand(s,l);break;default:return console.log("The animation command is not supported: "+a.cmd),this.client.showMessageBox("error",d.msg.BOX_TITLE_UNKNOWN_COMMAND(),d.msg.ANIMATION_COMMAND_NOT_SUPPORTED()+": "+a.cmd+"\n"+d.msg.ENGINE_AND_FRONTEND_DONT_MATCH()),void this.stop()}}p.isDebugMode()&&(this.client.panels.updateCreateUpdateDeleteCount(e,r,i),this.client.panels.updateShapeCount(p.getElementCount()))},t.prototype.createShape=function(t,e){var r;if(p.isPrimitiveSVGElement(t))r=p.createSvgElement(t);else switch(t){case"Shape3DOnly":r=p.cloneElementWithId("3d-only-shape");break;case"ShapeArc":r=em.createShapeArc();break;case"ShapeArrowLine":r=em.createShapeArrowLine();break;case"ShapeText":r=em.createShapeText();break;case"ShapeImage":r=em.createShapeImage();break;case"ShapeCanvas":r=em.createShapeCanvas(e);break;case"ShapeCAD":r=em.createShapeCAD();break;case"ShapeScale":r=em.createShapeScale();break;case"ShapeSVG":r=em.createShapeSVG();break;case"ShapeModelPrimitives":r=nm.create();break;case"ShapeInspect":r=this.shapeInspect.create();break;case"ShapeGISMap":r=this.shapeGISMap.createShapeGISMap();break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":r=this.control.createControl(t);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":r=mm.createMarkupPath(t,e);break;case"MarkupPointNode":r=mm.createMarkupPointNode();break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":r=mm.createMarkupAreaNode(t);break;case"MarkupPalletRack":r=mm.createMarkupPalletRack();break;case"MarkupConveyorPath":r=gm.createMarkupConveyorPath(e);break;case"MarkupPositionOnConveyor":r=gm.createMarkupPositionOnConveyor();break;case"MarkupConveyorTurnStation":case"MarkupConveyorTurntable":case"MarkupConveyorTransferTable":r=gm.createMarkupConveyorNode(t);break;case"MarkupConveyorStation":r=gm.createMarkupConveyorStation();break;case"MarkupConveyorCustomStation":r=gm.createMarkupConveyorCustomStation();break;case"MarkupConveyorSplitMerge":r=gm.createMarkupConveyorSplitMerge();break;case"MarkupTowerCrane":r=gm.createMarkupTowerCrane();break;case"MarkupLift":r=gm.createMarkupLift();break;case"MarkupRailwaySwitch":r=ym.createMarkupRailwaySwitch();break;case"MarkupPositionOnTrack":r=ym.createMarkupPositionOnTrack();break;case"MarkupPipe":r=bm.createMarkupPipe(e);break;case"MarkupStorageTank":r=bm.createMarkupStorageTank();break;case"MarkupBulkConveyorBelt":r=bm.createMarkupBulkConveyorBelt(e);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":r=vm.createMarkupWall(t,e);break;case"MarkupTargetLine":r=vm.createMarkupTargetLine();break;case"MarkupPathway":r=vm.createMarkupPathway();break;case"MarkupPedFlowStatistics":r=vm.createMarkupPedFlowStatistics();break;case"MarkupServiceWithLines":r=vm.createMarkupServiceWithLines();break;case"MarkupServiceWithArea":r=vm.createMarkupServiceWithArea();break;case"MarkupEscalatorGroup":r=vm.createMarkupEscalatorGroup();break;case"MarkupDensityMap":r=vm.createMarkupDensityMap();break;case"MarkupIntersection":r=Am.createMarkupIntersection();break;case"MarkupRoad":r=Am.createMarkupRoad();break;case"MarkupStopLine":r=Am.createMarkupStopLine();break;case"MarkupBusStop":case"MarkupParkingLot":r=Am.createMarkupBusStopOrParkingLot();break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":r=pm.createGISMarkup(t);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":r=cm.create();break;case"Window3D":r=wm.create(e);break;default:return console.log("The shape type is not supported: "+t),this.client.showMessageBox("error",d.msg.BOX_TITLE_UNKNOWN_SHAPE_TYPE(),d.msg.SHAPE_TYPE_NOT_SUPPORTED()+": "+t+"\n"+d.msg.ENGINE_AND_FRONTEND_DONT_MATCH()),this.stop(),null}return r.id=e,r.setAttribute("type",t),r},t.prototype.updateShape=function(e,r,i){var n=e.getAttribute("type");if("Shape3DOnly"!=n)if(p.isPrimitiveSVGElement(n))for(var a=0;a<r.length;a++)switch(r[a]){case"href":e.setAttributeNS(p.xlinkns,"href",i[a]);break;case"href-path":e.setAttributeNS(p.xlinkns,"href",this.client.networkManager.getInternalResource(i[a]));break;case"geo":var o=i[a].split("|");e.setAttribute("lon",o[0]),e.setAttribute("lat",o[1]),e.setAttribute("heading",o[2]),fm.updateGISAgentPosition(e),fm.adjustGISPositionX(e);break;default:t.filterAndSetAttribute(e,r[a],i[a])}else switch(n){case"ShapeArc":em.updateShapeArc(e,r,i);break;case"ShapeArrowLine":em.updateShapeArrowLine(e,r,i);break;case"ShapeText":em.updateShapeText(e,r,i);break;case"ShapeImage":this.shapeComposite.updateShapeImage(e,r,i);break;case"ShapeCanvas":em.updateShapeCanvas(e,r,i);break;case"ShapeCAD":this.shapeComposite.updateShapeCAD(e,r,i);break;case"ShapeScale":em.updateShapeScale(e,r,i);break;case"ShapeSVG":em.updateShapeSVG(e,r,i);break;case"ShapeModelPrimitives":this.shapeModelPrimitives.update(e,r,i);break;case"ShapeInspect":this.shapeInspect.update(e,r,i);break;case"ShapeGISMap":this.shapeGISMap.updateShapeGISMap(e,r,i);break;case"ControlButton":case"ControlCheckbox":case"ControlSlider":case"ControlRadioButtonGroup":case"ControlListBox":case"ControlComboBox":case"ControlTextField":case"ControlFileChooser":case"ControlProgressBar":this.control.updateControl(e,r,i);break;case"MarkupPathLine":case"MarkupPathDashline":case"MarkupPathConveyor":case"MarkupPathRoad":case"MarkupPathRailroad":mm.updateMarkupPath(e,r,i);break;case"MarkupPointNode":mm.updateMarkupPointNode(e,r,i);break;case"MarkupRectangularNode":case"MarkupPolygonalNode":case"MarkupQueueArea":mm.updateMarkupAreaNode(e,r,i);break;case"MarkupPalletRack":mm.updateMarkupPalletRack(e,r,i);break;case"MarkupConveyorPath":gm.updateMarkupConveyorPath(e,r,i);break;case"MarkupPositionOnConveyor":gm.updateMarkupPositionOnConveyor(e,r,i);break;case"MarkupConveyorTurnStation":case"MarkupConveyorTurntable":case"MarkupConveyorTransferTable":gm.updateMarkupConveyorNode(e,r,i);break;case"MarkupConveyorStation":gm.updateMarkupConveyorStation(e,r,i);break;case"MarkupConveyorCustomStation":gm.updateMarkupConveyorCustomStation(e,r,i);break;case"MarkupConveyorSplitMerge":gm.updateMarkupConveyorSplitMerge(e,r,i);break;case"MarkupTowerCrane":gm.updateMarkupTowerCrane(e,r,i);break;case"MarkupLift":gm.updateMarkupLift(e,r,i);break;case"MarkupRailwaySwitch":ym.updateMarkupRailwaySwitch(e,r,i);break;case"MarkupPositionOnTrack":ym.updateMarkupPositionOnTrack(e,r,i);break;case"MarkupPipe":bm.updateMarkupPipe(e,r,i);break;case"MarkupStorageTank":bm.updateMarkupStorageTank(e,r,i);break;case"MarkupBulkConveyorBelt":bm.updateMarkupBulkConveyorBelt(e,r,i);break;case"MarkupPathWall":case"MarkupCircularWall":case"MarkupRectangularWall":vm.updateMarkupWall(e,r,i);break;case"MarkupTargetLine":vm.updateMarkupTargetLine(e,r,i);break;case"MarkupPathway":vm.updateMarkupPathway(e,r,i);break;case"MarkupPedFlowStatistics":vm.updateMarkupPedFlowStatistics(e,r,i);break;case"MarkupServiceWithLines":vm.updateMarkupServiceWithLines(e,r,i);break;case"MarkupServiceWithArea":vm.updateMarkupServiceWithArea(e,r,i);break;case"MarkupEscalatorGroup":vm.updateMarkupEscalatorGroup(e,r,i);break;case"MarkupDensityMap":vm.updateMarkupDensityMap(e,r,i);break;case"MarkupIntersection":Am.updateMarkupIntersection(e,r,i);break;case"MarkupRoad":Am.updateMarkupRoad(e,r,i);break;case"MarkupStopLine":Am.updateMarkupStopLine(e,r,i);break;case"MarkupBusStop":case"MarkupParkingLot":Am.updateMarkupBusStopOrParkingLot(e,r,i);break;case"MarkupGISPoint":case"MarkupGISRegion":case"MarkupGISRoute":pm.updateGISMarkup(e,r,i);break;case"ChartPie":case"ChartBar":case"ChartStack":case"ChartPlot":case"ChartTimePlot":case"ChartTimeStack":case"ChartTimeColor":case"ChartHistogram":case"ChartHistogram2D":this.chart.update(e,r,i);break;case"Window3D":wm.update(e,r,i)}},t.filterAndSetAttribute=function(e,r,i){if(!(["shape-type","owner-id","add-after","has-click-handler"].indexOf(r)>=0||r.startsWith("3d")&&"3d-rot"!=r))if("pos"==r||"scale"==r){var n=f.posOrScaleToTransform(e,r,i);if(f.applyTransformAttribute(e,n),"scale"==r&&null!=e.getAttribute("scalexy")){var a=f.splitToFloats(e.getAttribute("scalexy"),":");n=f.adjustTransformScale(n,a[0],a[1]),f.applyTransformAttribute(e,n)}}else if("3d-rot"==r){var o=f.splitToFloats(i,":"),s=e.getAttribute("scalexy");if(0==o[0]&&0==o[1]&&null==s)return;var l=Math.cos(o[1]),u=Math.cos(o[0]);if(l=Math.abs(l)<t.SCALE_XY_TOLERANCE?0:l,u=Math.abs(u)<t.SCALE_XY_TOLERANCE?0:u,l=Math.abs(l-1)<t.SCALE_XY_TOLERANCE?1:l,u=Math.abs(u-1)<t.SCALE_XY_TOLERANCE?1:u,1==l&&1==u&&null==s)return;var c=l,h=u;if(null!=s){var d=f.splitToFloats(s,":");c/=d[0],h/=d[1]}n=e.getAttribute("transform");n=f.adjustTransformScale(n,c,h),f.applyTransformAttribute(e,n),1==l&&1==u?e.removeAttribute("scalexy"):e.setAttribute("scalexy",l+":"+u)}else e.setAttribute(r,i)},t.prototype.assignClickableShapeClickHandler=function(e,r){var i=this;"ShapeInspect"!=r&&(new m(e,function(){return t.onClickableShapeOverOut(e,!0)},function(){return t.onClickableShapeOverOut(e,!1)},null,function(t){return i.onClickableShapeClick(e,t)},null,function(t){return i.onClickableShapeClick(e,t,!0)}),"ShapeGISMap"!=r&&(e.style.pointerEvents="visible"))},t.onClickableShapeOverOut=function(t,e){var r=t.getAttribute("type");"ShapeGISMap"!=r&&"ShapeCanvas"!=r&&(e?t.setAttribute("class","clickable-over"):t.removeAttribute("class"))},t.prototype.onClickableShapeClick=function(t,e,r){var i;if(void 0===r&&(r=!1),"ShapeGISMap"==t.getAttribute("type"))i=fm.eventToLonLat(t,e);else{var n=this.client.navigation.eventToXY(e);i=this.client.navigation.XYtoShapeXY(t,n)}var a=r?" dblclick":"";this.client.postUserAction(t.id,i[0]+" "+i[1]+a)},t.prototype.applySettings=function(t,e){for(var r,i,n,a,o,s,l,u,c=!0,h=!0,d=0;d<t.length;d++)switch(t[d]){case"experiment-type":r=e[d];break;case"experiment-name":i=e[d];break;case"max-memory":n=parseFloat(e[d]);break;case"time-unit":a=e[d];break;case"start-time":o=parseFloat(e[d]);break;case"start-date":s=parseInt(e[d]);break;case"stop-time":l=parseFloat(e[d]);break;case"stop-date":u=parseInt(e[d]);break;case"run-control-enabled":c="true"==e[d];break;case"speed-control-enabled":h="true"==e[d]}this.client.setExperimentSettings(r,i,n,a,o,s,l,u,c,h)},t.prototype.applyNavigation=function(t,e,r){for(var i,n,a,o,s,l,u,c,h,d,p=0;p<t.length;p++)switch(t[p]){case"x":i=parseFloat(e[p]);break;case"y":n=parseFloat(e[p]);break;case"width":a=parseFloat(e[p]);break;case"height":o=parseFloat(e[p]);break;case"zoom-and-panning-enabled":s="true"==e[p];break;case"navigation-back-enabled":l="true"==e[p];break;case"view-title":u=e[p];break;case"view-areas":c=f.splitSkipEmpty(e[p],"\n");break;case"presentable":h=f.splitSkipEmpty(e[p],".");break;case"next-level-agents":d=f.splitSkipEmpty(e[p],"|")}var m=this.client.getPresentable();m&&h.toString()==m.toString()||this.resetAdaptiveness(),this.client.setNavigationSettings(i,n,a,o,s,l,u,c,h,d,r)},t.prototype.addInfoCommandListener=function(t){this.infoCommandListeners.push(t)},t.prototype.removeInfoCommandListener=function(t){this.infoCommandListeners.splice(this.infoCommandListeners.indexOf(t),1)},t.prototype.onInfoCommand=function(t,e){for(var r=0,i=this.infoCommandListeners;r<i.length;r++){(0,i[r])(t,e)}},t.MEASURED_FRAME_STATISTICS_SIZE=20,t.SUGGESTED_FPS_STATISTICS_SIZE=100,t.fpsValues=[.2,.35,.5,.75,1,1.5,2,3,4,5,6,7,8,10,12,14,16,18,20,24,28,32,36,40],t.SCALE_XY_TOLERANCE=1e-5,t}(),Mm=function(){function t(t){var e=this;this.accumulatedZoomWheelDelta=0,this.navPoint={x:0,y:0,w:100,h:50},this.client=t,this.onWindowResizeEventClosure=function(t){return e.keepAtNavigationPoint()}}return t.prototype.start=function(){var e=this;this.presentationCoords=[0,0],this.zoom=1,window.addEventListener("resize",this.onWindowResizeEventClosure,!1),w.addFullScreenListener(this.onWindowResizeEventClosure);var r=this.client.svgContainer;r.oncontextmenu=function(){return!1},this.dragWheelZoomHandler=new Nf(r,this.client.svg,function(t,r,i,n){return e.onDrag(t,r,i,n)},function(t,r,i){return e.onWheel(t,r,i)},null,function(t,r,i,n){return e.onTouchZoom(t,r,i,n)},function(e){return t.eventIgnoreCondition(e)},function(e){return t.wheelIgnoreCondition(e)})},t.prototype.stop=function(){window.removeEventListener("resize",this.onWindowResizeEventClosure,!1),w.removeFullScreenListener(this.onWindowResizeEventClosure),null!=this.dragWheelZoomHandler&&(this.dragWheelZoomHandler.stop(),this.dragWheelZoomHandler=null),this.delayedZoomTimeout&&(clearTimeout(this.delayedZoomTimeout),this.delayedZoomTimeout=void 0)},t.prototype.getZoom=function(){return this.zoom},t.prototype.zoomInOut=function(e){var r=f.findNearestArrayIndex(t.zooms,this.zoom,e);if(!(r<0||r>=t.zooms.length)){var i=this.client.svgContainer.getBoundingClientRect();this.applyZoom(t.zooms[r],i.width/2,i.height/2)}},t.prototype.applyNavigationSettings=function(){null!=this.client.getWindowX()&&(this.navPoint.x=this.client.getWindowX(),this.navPoint.y=this.client.getWindowY(),this.navPoint.w=this.client.getWindowWidth(),this.navPoint.h=this.client.getWindowHeight(),this.keepAtNavigationPoint())},t.prototype.keepAtNavigationPoint=function(){var t=this.client.isZoomAndPanningEnabled();if(null!=t){var e=this.navPoint.w/this.navPoint.h,r=this.client.svgContainer.getBoundingClientRect(),i=r.width,n=r.height,a=e>i/n?i/this.navPoint.w:n/this.navPoint.h,o=this.navPoint.x+this.navPoint.w/2,s=this.navPoint.y+this.navPoint.h/2,l=i,u=n,c=l/a,h=u/a,d=o-c/2,p=s-h/2;if(!t){var m=Math.max(d,this.client.getWindowX()),g=Math.min(d+c,this.client.getWindowX()+this.client.getWindowWidth());d=o-(c=2*Math.min(o-m,g-o))/2;var b=Math.max(p,this.client.getWindowY()),v=Math.min(p+h,this.client.getWindowY()+this.client.getWindowHeight());p=s-(h=2*Math.min(s-b,v-s))/2,l=c*a,u=h*a}this.client.svgBackLogo&&(this.client.svgBackLogo.remove(),this.client.svgBackLogo=void 0),f.setMultipleAttributes(this.client.svg,["width","height"],[l,u]);var y=document.getElementById("canvas-group-3d");y.style.width=l+"px",y.style.height=u+"px",this.zoom=a,this.presentationCoords=[-d*a,-p*a],this.applyPresentationTransform(!1)}},t.eventIgnoreCondition=function(t){if(t.target instanceof HTMLCanvasElement&&"canvas-group-3d"==t.target.parentElement.id){if(t instanceof WheelEvent)if(t.ctrlKey)return!1;return!0}return!1},t.prototype.onDrag=function(t,e,r,i){this.applyPanning(e,r)},t.wheelIgnoreCondition=function(t){return t.altKey},t.prototype.onWheel=function(e,r,i){var n=this;e.ctrlKey?(clearTimeout(this.delayedZoomTimeout),this.accumulatedZoomWheelDelta+=e.deltaY<0?1:-1,this.delayedZoomTimeout=setTimeout(function(){n.delayedWheelZoom(r,i)},t.zoomDelay)):0<e.deltaY?this.applyPanning(0,-50):this.applyPanning(0,50)},t.prototype.onTouchZoom=function(e,r,i,n){var a=n*this.zoom;a=Math.max(a,t.zooms[0]),a=Math.min(a,t.zooms[t.zooms.length-1]),this.applyZoom(a,r,i)},t.prototype.delayedWheelZoom=function(e,r){if(0!=this.accumulatedZoomWheelDelta){var i,n=t.zooms.length,a=!1;if(this.accumulatedZoomWheelDelta<0){for(var o=n-1;o>=0;o--)if(t.zooms[o]<this.zoom){a=!0,i=o+this.accumulatedZoomWheelDelta+1;break}}else for(o=0;o<n;o++)if(this.zoom<t.zooms[o]){a=!0,i=o+this.accumulatedZoomWheelDelta-1;break}if(a){i=Math.min(i,n-1),i=Math.max(0,i);var s=t.zooms[i];this.applyZoom(s,e,r),this.client.showFadingInfoLine(Math.round(100*s)+"%")}this.accumulatedZoomWheelDelta=0}},t.prototype.applyPresentationTransform=function(t){var e=this.client.svg.getBoundingClientRect(),r=e.width,i=e.height;if(!this.client.isZoomAndPanningEnabled()){var n=this.zoom,a=this.presentationCoords[0],o=this.presentationCoords[1],s=this.client.getWindowX(),l=this.client.getWindowY(),u=this.client.getWindowWidth(),c=this.client.getWindowHeight();n=Math.max(n,r/u),n=Math.max(n,i/c),a=Math.min(a,-s*n),a=Math.max(a,r-(s+u)*n),o=Math.min(o,-l*n),o=Math.max(o,i-(l+c)*n),this.presentationCoords=[a,o],this.zoom=n}var h=f.fixedPrecision(this.presentationCoords[0],1),d=f.fixedPrecision(this.presentationCoords[1],1),p=f.reducePrecision(this.zoom),m="translate("+h+","+d+") scale("+p+")",g=this.client.presentation.getAttribute("transform");if(m!=g){this.client.presentation.setAttribute("transform",m),t&&(this.navPoint.x=-h/p,this.navPoint.y=-d/p,this.navPoint.w=r/p,this.navPoint.h=i/p),wm.syncAllCanvas3DPositions();var b=f.parseTransform(g);p!=b[3]&&this.invokeZoomLsteners(b[3],p)}},t.prototype.applyZoom=function(t,e,r){if(t!=this.zoom){if(!this.client.isZoomAndPanningEnabled()){var i=this.client.svg,n=i.getBoundingClientRect(),a=n.width,o=n.height,s=this.client.getWindowWidth(),l=this.client.getWindowHeight(),u=this.client.svgContainer.getBoundingClientRect(),c=u.width,h=u.height;if((t=s/l>c/h?Math.max(t,c/s):Math.max(t,h/l))==this.zoom)return;var d=Math.min(s*t,c),p=Math.min(l*t,h),f=!1;if(d!=a&&(i.setAttribute("width",d.toString()),f=!0),p!=o&&(i.setAttribute("height",p.toString()),f=!0),f){var m=document.getElementById("canvas-group-3d");m.style.width=d+"px",m.style.height=p+"px"}}var g=t/this.zoom,b=e-(e-this.presentationCoords[0])*g,v=r-(r-this.presentationCoords[1])*g;this.presentationCoords=[b,v],this.zoom=t,this.applyPresentationTransform(!0)}},t.prototype.applyPanning=function(t,e){var r=this.presentationCoords[0]+t,i=this.presentationCoords[1]+e;this.presentationCoords=[r,i],this.applyPresentationTransform(!0)},t.prototype.invokeZoomLsteners=function(t,e){for(var r=this.client.presentation.getElementsByClassName("svg-zoom-listener"),i=0;i<r.length;i++){var n=r.item(i);switch(n.getAttribute("type")){case"ShapeCAD":em.onCADZoomChange(n,t,e);break;case"ShapeScale":em.onScaleZoomChange(n,t,e)}}this.client.panels.modelNavigation.updateZoom()},t.prototype.eventToXY=function(t){var e=f.offsetPage(this.client.svg),r=m.eventPageXY(t),i=r[0]-e.left,n=r[1]-e.top,a=i-this.presentationCoords[0],o=n-this.presentationCoords[1];return[a/=this.zoom,o/=this.zoom]},t.prototype.XYtoShapeXY=function(t,e){if(t==this.client.presentation)return e;var r=this.XYtoShapeXY(t.parentNode,e),i=f.parseTransform(t.getAttribute("transform")),n=r[0]-i[0],a=r[1]-i[1];if(0!=i[2]){var o=Math.sqrt(n*n+a*a),s=Math.atan2(a,n)-i[2];n=o*Math.cos(s),a=o*Math.sin(s)}return[n/i[3],a/i[4]]},t.zooms=[.2,.35,.5,.75,1,1.25,1.5,2,3,5,10],t.zoomDelay=50,t}(),Om=function(){function t(t){var e=this;this.lastRealSpeed=1,this.panels=t,this.client=t.client,this.cpButtonRun=document.getElementById("control-panel-button-run"),this.cpButtonPause=document.getElementById("control-panel-button-pause"),this.cpButtonStop=document.getElementById("control-panel-button-stop"),this.cpButtonX1=document.getElementById("control-panel-button-x1"),this.cpButtonSlower=document.getElementById("control-panel-button-slower"),this.cpInfoScale=document.getElementById("control-panel-info-scale"),this.cpButtonFaster=document.getElementById("control-panel-button-faster"),this.cpButtonVirtual=document.getElementById("control-panel-button-virtual"),this.cpInfoMultiRun=document.getElementById("control-panel-multi-run-progress"),this.dpInfoPauseAt=document.getElementById("dev-panel-info-pause-at"),this.dpButtonRun=document.getElementById("dev-panel-button-run"),this.dpButtonStep=document.getElementById("dev-panel-button-step"),this.dpButtonStop=document.getElementById("dev-panel-button-stop"),this.dpButtonRunOpt=document.getElementById("dev-panel-button-run-options"),this.dpSectionRunUntil=document.getElementById("dev-panel-section-run-until"),this.dpButtonRunUntil=document.getElementById("dev-panel-button-run-until"),this.dpFieldRunUntil=document.getElementById("dev-panel-field-run-until"),this.dpButtonRunUntilDate=document.getElementById("dev-panel-button-run-until-date"),this.dpSectionRunFor=document.getElementById("dev-panel-section-run-for"),this.dpButtonRunFor=document.getElementById("dev-panel-button-run-for"),this.dpFieldRunFor=document.getElementById("dev-panel-field-run-for"),this.dpButtonPause=document.getElementById("dev-panel-button-pause"),this.dpSectionPauseAt=document.getElementById("dev-panel-section-pause-at"),this.dpButtonPauseAt=document.getElementById("dev-panel-button-pause-at"),this.dpFieldPauseAt=document.getElementById("dev-panel-field-pause-at"),this.dpFieldPauseAtDate=document.getElementById("dev-panel-field-pause-at-date"),this.dpButtonPauseAtDate=document.getElementById("dev-panel-button-pause-at-date"),this.panels.setupActionAndTooltip(this.cpButtonRun,function(){return e.client.postUserCommand("run","")}),this.panels.setupActionAndTooltip(this.cpButtonPause,function(){return e.client.postUserCommand("pause","")}),this.panels.setupActionAndTooltip(this.cpButtonStop,function(){return e.stopExperiment()}),this.panels.setupActionAndTooltip(this.cpButtonX1,function(){return e.setSpeed(1,!0)}),this.panels.setupActionAndTooltip(this.cpButtonSlower,function(){return e.speedUpOrDown(!1)}),this.panels.setupTooltip(this.cpInfoScale),this.panels.setupActionAndTooltip(this.cpButtonFaster,function(){return e.speedUpOrDown(!0)}),this.panels.setupActionAndTooltip(this.cpButtonVirtual,function(){return e.toggleVirtualTime()}),this.panels.setupTooltip(this.cpInfoMultiRun),this.panels.setupActionAndTooltip(this.dpButtonRunOpt,function(){Rm.toggleExpanded(e.dpButtonRunOpt),e.updateRunGroup()}),this.panels.setupTooltip(this.dpInfoPauseAt),this.panels.setupActionAndTooltip(this.dpButtonRun,function(){return e.client.postUserCommand("run","")}),this.panels.setupActionAndTooltip(this.dpButtonRunUntil,function(){return e.runUntilOrPauseAt(e.dpSectionRunUntil)}),this.panels.setupActionAndTooltip(this.dpButtonRunFor,function(){return e.runFor()}),this.panels.setupActionAndTooltip(this.dpButtonStep,function(){return e.client.postUserCommand("step","")}),this.panels.setupActionAndTooltip(this.dpButtonStop,function(){return e.stopExperiment()}),this.panels.setupActionAndTooltip(this.dpButtonPause,function(){return e.client.postUserCommand("pause","")}),this.panels.setupActionAndTooltip(this.dpButtonPauseAt,function(){return e.runUntilOrPauseAt(e.dpSectionPauseAt)}),Rm.assignActionOnEnterPressed(this.dpFieldRunUntil,function(){return e.runUntilOrPauseAt(e.dpSectionRunUntil)}),Rm.assignActionOnEnterPressed(this.dpFieldRunFor,function(){return e.runFor()}),Rm.assignActionOnEnterPressed(this.dpFieldPauseAt,function(){return e.runUntilOrPauseAt(e.dpSectionPauseAt)}),this.panels.setupActionAndTooltip(this.dpButtonRunUntilDate,function(){return e.toggleTimeDateInputs(e.dpButtonRunUntilDate)}),this.panels.setupActionAndTooltip(this.dpButtonPauseAtDate,function(){return e.toggleTimeDateInputs(e.dpButtonPauseAtDate)})}return t.prototype.start=function(){this.dpButtonRunUntil.lastElementChild.innerHTML=d.msg.RUN_UNTIL()+":",this.dpButtonRunFor.lastElementChild.innerHTML=d.msg.RUN_FOR()+":",this.dpButtonPauseAt.lastElementChild.innerHTML=d.msg.PAUSE_AT()+":";for(var t=this.dpSectionRunFor.getElementsByTagName("select").item(0).getElementsByTagName("option"),e=0;e<t.length;e++){var r=t.item(e);r.innerHTML=d.msg[r.value]()}},t.prototype.updateExperimentSettings=function(){if(this.client.isSimulationExperiment()){Rm.setVisible(this.cpButtonX1,!0,"logic"),Rm.setVisible(this.cpButtonSlower,!0,"logic"),Rm.setVisible(this.cpInfoScale,!0,"logic"),Rm.setVisible(this.cpButtonFaster,!0,"logic"),Rm.setVisible(this.cpButtonVirtual,!0,"logic"),Rm.setVisible(this.cpInfoMultiRun,!1,"logic"),Rm.setVisible(this.dpButtonRunOpt,!0);for(var t=this.client.getTimeUnit(),e=this.dpSectionRunFor.getElementsByTagName("select").item(0),r=0;r<e.options.length;r++)if(e.options[r].value==t){e.selectedIndex=r;break}}else Rm.setVisible(this.cpButtonX1,!1,"logic"),Rm.setVisible(this.cpButtonSlower,!1,"logic"),Rm.setVisible(this.cpInfoScale,!1,"logic"),Rm.setVisible(this.cpButtonFaster,!1,"logic"),Rm.setVisible(this.cpButtonVirtual,!1,"logic"),Rm.setVisible(this.cpInfoMultiRun,!0,"logic"),Rm.setVisible(this.dpButtonRunOpt,!1),Rm.setVisible(this.dpSectionRunUntil,!1),Rm.setVisible(this.dpSectionRunFor,!1),Rm.setVisible(this.dpSectionPauseAt,!1)},t.prototype.updateRunGroup=function(){var e=this.client.getExperimentState(),r="RUNNING"==e,i="IDLE"==e||"PAUSED"==e,n=r||"PAUSED"==e||"FINISHED"==e||"ERROR"==e,a=this.client.isRunControlEnabled();if(Rm.setVisible(this.cpButtonRun,!r,"logic"),Rm.setVisible(this.cpButtonPause,r,"logic"),this.panels.setEnabled(this.cpButtonRun,a&&i),this.panels.setEnabled(this.cpButtonPause,a&&r),this.panels.setEnabled(this.cpButtonStop,a&&n),Rm.setTooltip(this.cpButtonRun,a?"TOOLTIP_RUN":t.tooltipdisabledbydesigner),Rm.setTooltip(this.cpButtonPause,a?"TOOLTIP_PAUSE":t.tooltipdisabledbydesigner),Rm.setTooltip(this.cpButtonStop,a?"TOOLTIP_STOP":t.tooltipdisabledbydesigner),Rm.setVisible(this.dpButtonRun,!r),this.panels.setEnabled(this.dpButtonRun,i),Rm.setVisible(this.dpButtonStep,!r),this.panels.setEnabled(this.dpButtonStep,i),Rm.setVisible(this.dpButtonPause,r),this.panels.setEnabled(this.dpButtonPause,r),this.panels.setEnabled(this.dpButtonStop,n),this.client.isSimulationExperiment()){var o="true"==this.dpButtonRunOpt.getAttribute("expanded");r||Rm.setVisible(this.dpInfoPauseAt,!1),Rm.setVisible(this.dpSectionRunFor,o&&!r),this.panels.setEnabled(this.dpSectionRunFor,i),Rm.setVisible(this.dpSectionRunUntil,o&&!r),this.panels.setEnabled(this.dpSectionRunUntil,i),Rm.setVisible(this.dpSectionPauseAt,o&&r),this.panels.setEnabled(this.dpSectionPauseAt,r)}},t.prototype.canRun=function(){var t=this.client.getExperimentState();return"IDLE"==t||"PAUSED"==t},t.prototype.canPause=function(){return"RUNNING"==this.client.getExperimentState()},t.prototype.updateSpeedGroup=function(){var e=this.client.getExperimentState(),r="IDLE"==e||"RUNNING"==e||"PAUSED"==e||"FINISHED"==e,i=this.client.isSpeedControlEnabled(),n=t.stringToTimeScale(this.cpInfoScale.innerText);this.panels.setEnabled(this.cpButtonX1,i&&r&&1!=n),this.panels.setEnabled(this.cpButtonSlower,i&&r&&n>t.speeds[0]),this.panels.setEnabled(this.cpButtonFaster,i&&r&&n!=1/0),this.panels.setEnabled(this.cpButtonVirtual,i&&r),Rm.setTooltip(this.cpButtonX1,i?"TOOLTIP_SET_REAL_TIME_SCALE_X1":t.tooltipdisabledbydesigner),Rm.setTooltip(this.cpButtonSlower,i?"TOOLTIP_SLOW_DOWN":t.tooltipdisabledbydesigner),Rm.setTooltip(this.cpButtonFaster,i?"TOOLTIP_SPEED_UP":t.tooltipdisabledbydesigner),Rm.setTooltip(this.cpButtonVirtual,i?"TOOLTIP_RUN_AS_FAST_AS_POSSIBLE_VIRTUAL_TIME_MODE":t.tooltipdisabledbydesigner);var a="control-panel-control-pressed";n==1/0?this.cpButtonVirtual.classList.contains(a)||this.cpButtonVirtual.classList.add(a):this.cpButtonVirtual.classList.remove(a)},t.prototype.setSpeed=function(e,r){if(e!=1/0)this.lastRealSpeed=e;else{var i=t.stringToTimeScale(this.cpInfoScale.innerText);i!=1/0&&(this.lastRealSpeed=i)}this.cpInfoScale.innerText=t.timeScaleToString(e),this.updateSpeedGroup(),r&&this.client.postUserCommand("setspeed",e.toString())},t.prototype.updateInfoPauseAt=function(){var t=this.client.getModelTime();"none"!=this.dpInfoPauseAt.style.display&&(t<0||f.parseFloatIgnoreCommas(this.dpInfoPauseAt.innerText.substring(1))<=parseFloat(t.toFixed(2)))&&Rm.setVisible(this.dpInfoPauseAt,!1)},t.prototype.runUntilOrPauseAt=function(e){var r,i=this.client.getExperimentState(),n=Rm.statesToShowTime.indexOf(i)>=0,a=n?this.client.getModelTime():this.client.getStartTime(),o=n?this.client.getModelDate():this.client.getStartDate(),s=e.getElementsByTagName("input"),l=s.item(0),u=s.item(1),c=s.item(2);if("none"!=l.style.display){if(r=t.validateFloatGreaterThan(l,a),isNaN(r))return}else{var h=this.validateDateLaterThan(u,c,o);if(null==h)return;var d=h.valueOf()-o.valueOf();r=a+this.client.toModelTimeUnits(d,"MILLISECOND")}var p=e==this.dpSectionRunUntil?"rununtiltime":"pauseattime";this.client.postUserCommand(p,r.toString()),this.showPauseAtReminder(r)},t.prototype.runFor=function(){var e=this.dpSectionRunFor.getElementsByTagName("input").item(0),r=this.dpSectionRunFor.getElementsByTagName("select").item(0),i=t.validateFloatGreaterThan(e,0);if(!isNaN(i)){this.client.postUserCommand("runfor",i+"|"+r.value);var n=this.client.toModelTimeUnits(i,r.value);this.showPauseAtReminder(this.client.getModelTime()+n)}},t.prototype.toggleTimeDateInputs=function(t){var e=t.parentElement.getElementsByTagName("input"),r=e.item(0),i=e.item(1),n=e.item(2);"none"==r.style.display?(r.style.removeProperty("display"),i.style.display="none",n.style.display="none",t.classList.remove("dev-panel-control-pressed"),t.firstElementChild.classList.remove("dev-panel-control-selected")):(r.style.display="none",i.style.removeProperty("display"),n.style.removeProperty("display"),this.updateDateAndTimeInInputs(i,n),t.classList.add("dev-panel-control-pressed"),t.firstElementChild.classList.add("dev-panel-control-selected"))},t.prototype.showPauseAtReminder=function(t){this.dpInfoPauseAt.innerText="["+f.formatNumber(t,2,!0)+"]",Rm.setVisible(this.dpInfoPauseAt,!0)},t.prototype.stopExperiment=function(){this.client.postUserCommand("stop",""),this.panels.onStop&&this.panels.onStop()},t.prototype.updateDateAndTimeInInputs=function(t,e){var r=this.client.getModelDate();if(!isNaN(r.getTime())){var i=new Date(t.value+" "+e.value);(isNaN(i.getTime())||i<r)&&(t.value=f.formatDate(r,"YYYY-MM-DD"),e.value=f.formatDate(r,"hh:mm"))}},t.prototype.speedUpOrDown=function(e){var r=t.stringToTimeScale(this.cpInfoScale.innerText),i=f.findNearestArrayIndex(t.speeds,r,e);r=i==1/0?1/0:i==-1/0?t.speeds[0]:t.speeds[i],this.setSpeed(r,!0)},t.prototype.toggleVirtualTime=function(){t.stringToTimeScale(this.cpInfoScale.innerText)==1/0?this.setSpeed(this.lastRealSpeed,!0):this.setSpeed(1/0,!0)},t.timeScaleToString=function(e){if(e==1/0)return"Virtual";for(var r=0,i=t.speeds;r<i.length;r++){var n=i[r];if(Math.abs(e-n)<=1e-7)return n>=1?"x"+n:"x1/"+1/n}return"x"+(e>99999?e.toExponential(2):f.formatNumber(e,2))},t.stringToTimeScale=function(t){return"Virtual"==t?1/0:t.startsWith("x1/")?1/parseFloat(t.substring(3)):t.startsWith("x")?parseFloat(t.substring(1)):1},t.validateFloatGreaterThan=function(t,e){var r=parseFloat(t.value);return isNaN(r)||r<=e?(t.setCustomValidity(d.msg.ENTER_NUMBER_GREATER_THAN()+" "+f.formatNumber(e,2)),NaN):(t.setCustomValidity(""),r)},t.prototype.validateDateLaterThan=function(t,e,r){var i=new Date(t.value+" "+e.value);if(isNaN(i.getTime())){var n=d.msg.VALID_DATE_REQUIRED();return t.setCustomValidity(n),e.setCustomValidity(n),void this.panels.client.showFadingInfoLine(n,!0,"white","red")}if(i<=r){n=d.msg.ENTER_DATE_LATER_THAN()+r.toString();return t.setCustomValidity(n),e.setCustomValidity(n),void this.panels.client.showFadingInfoLine(n,!0,"white","red")}return t.setCustomValidity(""),e.setCustomValidity(""),i},t.speeds=[.001,.002,.004,.01,.02,.04,.1,.2,.5,1,2,5,10,25,50,100,250,500,1e3],t.tooltipdisabledbydesigner="TOOLTIP_DISABLED_BY_MODEL_DESIGNER",t}(),Im=function(){function t(t){var e=this;this.indexWasChanged=!1,this.panels=t,this.client=t.client,this.dpRowNavigationDeep=document.getElementById("dev-panel-row-navigation-deep"),this.dpButtonUp=document.getElementById("dev-panel-button-up"),this.dpButtonToExperiment=document.getElementById("dev-panel-button-to-experiment"),this.dpButtonToRootAgent=document.getElementById("dev-panel-button-to-root-agent"),this.dpBreadcrumbIndex=document.getElementById("dev-panel-breadcrumb-index"),this.dpBreadcrumbNextLevel=document.getElementById("dev-panel-breadcrumb-next-level"),this.dpRowNavigationLocal=document.getElementById("dev-panel-row-navigation-local"),this.dpButtonBack=document.getElementById("dev-panel-button-back"),this.dpButtonOrigin=document.getElementById("dev-panel-button-origin"),this.dpButtonZoomOut=document.getElementById("dev-panel-button-zoom-out"),this.dpInfoZoom=document.getElementById("dev-panel-info-zoom"),this.dpButtonZoomIn=document.getElementById("dev-panel-button-zoom-in"),this.dpSelectViewArea=document.getElementById("dev-panel-view-area-select"),this.panels.setupActionAndTooltip(this.dpButtonUp,function(){return e.navigate("up")}),this.panels.setupActionAndTooltip(this.dpButtonToExperiment,function(){return e.setPresentable("experiment")}),this.panels.setupActionAndTooltip(this.dpButtonToRootAgent,function(){return e.setPresentable("experiment.root")}),this.panels.setupTooltip(this.dpBreadcrumbNextLevel),this.panels.setupActionAndTooltip(this.dpButtonBack,function(){return e.navigate("back")}),this.panels.setupActionAndTooltip(this.dpButtonOrigin,function(){return e.navigate("home")}),this.panels.setupActionAndTooltip(this.dpButtonZoomOut,function(){return e.client.navigation.zoomInOut(!1)}),this.panels.setupTooltip(this.dpInfoZoom.parentNode),this.panels.setupActionAndTooltip(this.dpButtonZoomIn,function(){return e.client.navigation.zoomInOut(!0)}),this.dpSelectViewArea.onchange=function(){return e.client.postUserCommand("navigateto",e.dpSelectViewArea.value)},this.panels.setupTooltip(this.dpSelectViewArea.parentNode)}return t.prototype.update=function(){this.panels.setEnabled(this.dpRowNavigationLocal,!1),this.panels.setEnabled(this.dpRowNavigationDeep,!1);var t=this.client.getPresentable(),e=null!=t&&t.length>0;for(this.panels.setEnabled(this.dpButtonBack,this.client.isNavigationBackEnabled()),this.panels.setEnabled(this.dpButtonOrigin,e),this.panels.setEnabled(this.dpButtonZoomOut,e),this.panels.setEnabled(this.dpButtonZoomIn,e);this.dpSelectViewArea.length>0;)this.dpSelectViewArea.remove(0);var r=this.dpSelectViewArea.parentNode,i=this.client.getViewAreas();if(null!=i&&i.length>0){Rm.setVisible(r,!0),this.panels.setEnabled(r,!0);for(var n=0,a=i;n<a.length;n++){var o=a[n],s=document.createElement("option");s.innerText=o,s.value=o,this.dpSelectViewArea.appendChild(s)}var l=this.client.getViewTitle();null!=l&&(this.dpSelectViewArea.value=l)}else Rm.setVisible(r,!1);for(;this.dpButtonToRootAgent.nextElementSibling&&this.dpButtonToRootAgent.nextElementSibling!=this.dpBreadcrumbIndex;)this.dpButtonToRootAgent.nextElementSibling.remove();var u=!1,c=!1,h=null!=t&&t.length>(this.client.runningFromCloud()?2:1);this.panels.setEnabled(this.dpButtonUp,h);var d=null!=t&&t.length>1&&!this.client.runningFromCloud();this.panels.setEnabled(this.dpButtonToExperiment,d);var p=this.client.getExperimentState(),f="RUNNING"==p||"PAUSED"==p||"FINISHED"==p||"ERROR"==p;this.panels.setEnabled(this.dpButtonToRootAgent,null!=t&&2!=t.length&&f);var m=this.dpButtonToRootAgent.parentElement,g=null!=t&&t.length>1?"experiment.root":"experiment";if(null!=t)for(var b=2;b<t.length;b++){var v=t[b].indexOf("[");if(b<t.length-1||v<0){var y=this.createBreadcrumb(t[b],b<t.length-1,g);m.insertBefore(y,this.dpBreadcrumbIndex)}else{u=!0;var A=t[b].substring(0,v),T=parseInt(t[b].substring(v+1));this.showBreadcrumbWithIndex(g,A,T),this.indexWasChanged&&(this.dpBreadcrumbIndex.getElementsByTagName("input").item(0).focus(),this.indexWasChanged=!1)}g+="."+t[b]}if(null!=t&&t.length>1){var C=this.client.getNextLevelAgents();null!=C&&C.length>0&&(c=!0,this.showBreadcrumbNextlevel(g,C))}u||(this.dpBreadcrumbIndex.style.display="none"),c||(this.dpBreadcrumbNextLevel.style.display="none")},t.prototype.updateZoom=function(){var t=this.client.navigation.getZoom();this.dpInfoZoom.innerText=Math.round(100*t)+"%"},t.prototype.setDeepNavigationVisible=function(t){Rm.setVisible(this.dpRowNavigationDeep,t)},t.prototype.createBreadcrumb=function(t,e,r){var i=this,n=p.cloneHTMLElement("dev-panel-breadcrumb-template");return n.lastElementChild.innerText=t,e?this.panels.setupActionAndTooltip(n,function(){return i.setPresentable(r+"."+t)}):n.classList.remove("dev-panel-control-link"),n},t.prototype.showBreadcrumbWithIndex=function(e,r,i){var n=this;this.dpBreadcrumbIndex.style.removeProperty("display"),this.panels.setEnabled(this.dpBreadcrumbIndex,!0),this.dpBreadcrumbIndex.getElementsByClassName("dev-panel-text").item(0).innerText=r;var a=this.dpBreadcrumbIndex.getElementsByTagName("input").item(0);a.value=i.toString(),a.onchange=function(){var o=t.validateNonNegativeInteger(a);isNaN(o)||o==i||(n.setPresentable(e+"."+r+"["+o+"]"),n.indexWasChanged=!0)}},t.prototype.showBreadcrumbNextlevel=function(t,e){var r=this;this.dpBreadcrumbNextLevel.style.removeProperty("display"),this.panels.setEnabled(this.dpBreadcrumbNextLevel,!0);for(var i=this.dpBreadcrumbNextLevel.getElementsByTagName("select").item(0),n=i.firstElementChild;n.nextElementSibling;)n.nextElementSibling.remove();for(var a=0,o=e;a<o.length;a++){var s=o[a],l=document.createElement("option");l.innerText=s,l.value=s,i.appendChild(l)}i.onchange=function(){var e=i.value;if("..."!=e){var n=e.indexOf("["),a=n<0?e:e.substring(0,n)+"[0]";r.setPresentable(t+"."+a)}}},t.prototype.navigate=function(t){switch(t){case"home":case"back":this.client.postUserCommand(t,""),this.panels.setEnabled(this.dpRowNavigationLocal,!1),this.panels.setEnabled(this.dpRowNavigationDeep,!1);break;case"up":for(var e=this.client.getPresentable(),r=e[0],i=1;i<e.length-1;i++)r+="."+e[i];this.setPresentable(r)}},t.prototype.setPresentable=function(t){this.client.postUserCommand("setpresentable",t),this.panels.setEnabled(this.dpRowNavigationLocal,!1),this.panels.setEnabled(this.dpRowNavigationDeep,!1)},t.validateNonNegativeInteger=function(t){var e=parseInt(t.value);return isNaN(e)||e<0?(t.setCustomValidity(d.msg.NON_NEGATIVE_INTEGER_REQUIRED()),NaN):(t.setCustomValidity(""),e)},t}(),_m=function(){function t(t){var e=this;this.autoScroll=!1,this.userScrolled=!1,this.panels=t,this.cpIconConsole=document.getElementById("control-panel-dev-panel-console"),this.dpButtonConsole=document.getElementById("dev-panel-button-console"),this.dpSectionConsole=document.getElementById("dev-panel-section-console"),this.dpButtonConsoleClear=document.getElementById("dev-panel-button-console-clear"),this.dpButtonConsoleScroll=document.getElementById("dev-panel-button-console-scroll"),this.dpButtonConsoleWrap=document.getElementById("dev-panel-button-console-wrap"),this.dpInfoConsole=document.getElementById("dev-panel-console"),this.panels.setupActionAndTooltip(this.dpButtonConsole,function(){t.eventsView.hide(),e.show()}),this.panels.setupActionAndTooltip(this.dpButtonConsoleClear,function(){return e.clear()}),this.panels.setupActionAndTooltip(this.dpButtonConsoleScroll,function(){return e.scrollDown()}),this.panels.setupActionAndTooltip(this.dpButtonConsoleWrap,function(){return e.toggleTextWrap()}),this.panels.setEnabled(this.dpButtonConsoleScroll,this.userScrolled),this.dpInfoConsole.onscroll=function(){e.onScroll()}}return t.prototype.start=function(){this.dpButtonConsole.firstElementChild.innerHTML=d.msg.CONSOLE()},t.prototype.show=function(){this.panels.setEnabled(this.dpButtonConsole,!1),Rm.setVisible(this.dpSectionConsole,!0),Rm.setVisible(this.dpInfoConsole,!0),this.dpButtonConsole.classList.remove(t.rowTabInactiveClass)},t.prototype.hide=function(){this.panels.setEnabled(this.dpButtonConsole,!0),Rm.setVisible(this.dpSectionConsole,!1),Rm.setVisible(this.dpInfoConsole,!1),this.dpButtonConsole.classList.add(t.rowTabInactiveClass)},t.prototype.update=function(e){var r=e.length;if(0!=r){var i=Math.min(r,t.MAX_CONSOLE_ITEMS),n=i>2,a=this.dpInfoConsole.parentNode;n&&this.dpInfoConsole.remove();var o=this.dpInfoConsole.childElementCount,s=Math.max(0,o+i-t.MAX_CONSOLE_ITEMS);if(s==o)this.dpInfoConsole.innerHTML="";else for(var l=0;l<s;l++)this.dpInfoConsole.firstElementChild.remove();var u=e[r-i].id,c=this.dpInfoConsole.lastElementChild;if(c&&c.getAttribute("itemid")){var h=u-(parseInt(c.getAttribute("itemid"))+1);if(h>1){var p=t.createNotification("..."+h+" "+d.msg.ITEMS_SKIPPED()+"...");this.dpInfoConsole.appendChild(p)}}for(l=r-i;l<r;l++){var f=e[l],m=document.createElement("p");m.setAttribute("itemid",f.id.toString()),m.innerText=f.text,"null"!=f.color&&(m.style.color=f.color),this.dpInfoConsole.appendChild(m)}var g=this.dpInfoConsole.firstElementChild;if(g&&g.getAttribute("itemid")){var b=parseInt(g.getAttribute("itemid"));if(b>0){p=t.createNotification("..."+b+" "+d.msg.ITEMS_DELETED()+"...");this.dpInfoConsole.insertBefore(p,g)}}n&&a.appendChild(this.dpInfoConsole),this.userScrolled||this.scrollDown(),this.panels.isDevPanelOpen()||this.cpIconConsole.classList.contains(t.newItemsIndicatorClass)||this.cpIconConsole.classList.add(t.newItemsIndicatorClass)}},t.prototype.scrollDown=function(){this.dpInfoConsole.scrollTop=this.dpInfoConsole.scrollHeight,this.dpInfoConsole.scrollLeft=0,this.autoScroll=!0,this.userScrolled=!1,this.panels.setEnabled(this.dpButtonConsoleScroll,!1)},t.prototype.resetNewItemsIndicator=function(){this.cpIconConsole.classList.remove(t.newItemsIndicatorClass)},t.prototype.clear=function(){this.dpInfoConsole.innerHTML="",this.autoScroll=!0,this.userScrolled=!1,this.panels.setEnabled(this.dpButtonConsoleScroll,!1)},t.createNotification=function(t){var e=document.createElement("p");return e.className=this.notificationClass,e.innerText=t,e},t.prototype.onScroll=function(){this.autoScroll||(this.userScrolled=!0,this.panels.setEnabled(this.dpButtonConsoleScroll,!0)),this.autoScroll=!1},t.prototype.toggleTextWrap=function(){var t="pre"==this.dpInfoConsole.style.whiteSpace;this.dpInfoConsole.style.whiteSpace=t?"pre-wrap":"pre"},t.MAX_CONSOLE_ITEMS=1e3,t.newItemsIndicatorClass="control-panel-console-new",t.notificationClass="dev-panel-console-notification",t.rowTabInactiveClass="dev-panel-row-tab-inactive",t}(),Lm=function(){function t(t){var e=this;this.showEventQueue=!0,this.panels=t,this.dpButtonEvents=document.getElementById("dev-panel-button-events"),this.dpSectionEvents=document.getElementById("dev-panel-section-events"),this.dpButtonQueue=document.getElementById("dev-panel-button-events-queue"),this.dpButtonMonitor=document.getElementById("dev-panel-button-events-monitor"),this.dpInfoQueue=document.getElementById("dev-panel-events-queue"),this.dpInfoMonitor=document.getElementById("dev-panel-events-monitor"),this.panels.setupActionAndTooltip(this.dpButtonEvents,function(){t.modelConsole.hide(),e.show()}),this.panels.setupActionAndTooltip(this.dpButtonQueue,function(){e.showEventQueue=!0,e.showTable()}),this.panels.setupActionAndTooltip(this.dpButtonMonitor,function(){e.showEventQueue=!1,e.showTable()})}return t.prototype.start=function(){this.dpButtonEvents.firstElementChild.innerHTML=d.msg.EVENTS();var t=document.getElementById("dev-panel-events-queue-table-template");t.rows[0].cells[1].innerText=d.msg.EVENTS_EVENTS_SCHEDULED_BY()+":",t.rows[0].cells[2].innerText=d.msg.EVENTS_TIME_LEFT(),(t=document.getElementById("dev-panel-events-monitor-table-template")).rows[0].cells[1].innerText=d.msg.EVENTS_CONDITIONS_MONITORED_BY()+":"},t.prototype.show=function(){this.panels.setEnabled(this.dpButtonEvents,!1),this.dpButtonEvents.classList.remove(_m.rowTabInactiveClass),Rm.setVisible(this.dpSectionEvents,!0),this.showTable(),this.setSendEvents(!0)},t.prototype.hide=function(){this.panels.setEnabled(this.dpButtonEvents,!0),this.dpButtonEvents.classList.add(_m.rowTabInactiveClass),Rm.setVisible(this.dpSectionEvents,!1),Rm.setVisible(this.dpInfoQueue,!1),Rm.setVisible(this.dpInfoMonitor,!1),this.setSendEvents(!1)},t.prototype.isShown=function(){return"none"!=this.dpSectionEvents.style.display},t.prototype.onDevPanelOpenClose=function(){this.setSendEvents(this.panels.isDevPanelOpen()&&this.isShown())},t.prototype.showTable=function(){Rm.setVisible(this.dpInfoQueue,this.showEventQueue),Rm.setVisible(this.dpInfoMonitor,!this.showEventQueue),this.panels.setEnabled(this.dpButtonQueue,!this.showEventQueue),this.panels.setEnabled(this.dpButtonMonitor,this.showEventQueue);var t="dev-panel-control-pressed",e="dev-panel-control-selected";this.showEventQueue?(this.dpButtonQueue.classList.add(t),this.dpButtonQueue.firstElementChild.classList.add(e),this.dpButtonMonitor.classList.remove(t),this.dpButtonMonitor.firstElementChild.classList.remove(e)):(this.dpButtonQueue.classList.remove(t),this.dpButtonQueue.firstElementChild.classList.remove(e),this.dpButtonMonitor.classList.add(t),this.dpButtonMonitor.firstElementChild.classList.add(e))},t.prototype.update=function(e){var r=this.panels.client.getModelTime();if(e){(b=p.cloneHTMLElement("dev-panel-events-queue-table-template")).rows[0].cells[1].innerHTML=f.formatNumber(e.eventCount,0)+" "+b.rows[0].cells[1].innerHTML;for(var i=0,n=void 0,a=0,o=e.events;a<o.length;a++){for(var s=o[a],l=b.rows[0],u=b.insertRow(-1),c=0;c<3;c++)u.insertCell(c),u.cells[c].className=l.cells[c].className;i++,u.cells[0].innerText=s.index;var h=s.name.includes(" "),d=s.name.includes("User's");h&&u.cells[1].classList.add(d?"dev-panel-events-queue-system-pause-name":"dev-panel-events-queue-system-name"),d&&u.classList.add("dev-panel-events-queue-system-pause"),h?u.cells[1].innerText=s.name:(t.setupEventIcon(u,s.type),this.setupEventLink(u,s.name)),u.setAttribute("time",s.time),s.time!=n&&(null!=n&&u.classList.add("dev-panel-events-queue-new-time"),this.setupRunForLink(u),n=s.time)}i<e.eventCount&&t.addRowMore(b,e.eventCount-i),this.dpInfoQueue.innerHTML="",this.dpInfoQueue.appendChild(b),(b=p.cloneHTMLElement("dev-panel-events-monitor-table-template")).rows[0].cells[1].innerHTML=f.formatNumber(e.predicatesCount,0)+" "+b.rows[0].cells[1].innerHTML,i=0;for(var m=0,g=e.predicates;m<g.length;m++){for(s=g[m],l=b.rows[0],u=b.insertRow(-1),c=0;c<2;c++)u.insertCell(c),u.cells[c].className=l.cells[c].className;i++,u.cells[0].innerText=s.index,t.setupEventIcon(u,s.type),this.setupEventLink(u,s.name)}i<e.predicatesCount&&t.addRowMore(b,e.predicatesCount-i),this.dpInfoMonitor.innerHTML="",this.dpInfoMonitor.appendChild(b)}if(e||"RUNNING"!=this.panels.client.getExperimentState()&&r!=this.timeAtLastUpdate){var b;if(!(b=this.dpInfoQueue.firstElementChild))return;for(c=0;c<b.rows.length;c++){u=b.rows[c];var v=f.getFloatAttribute(u,"time");1==c&&v<=r&&(u.classList.add("dev-panel-events-queue-next"),u.cells[1].classList.remove("dev-panel-events-queue-system-name"));var y=u.cells[2].firstElementChild;if(y){var A=f.formatNumber(v-r,3);y.innerHTML!=A&&(y.innerHTML=A)}}this.timeAtLastUpdate=r}},t.createLink=function(t,e){var r=document.createElement("span");return r.innerText=t,r.onclick=function(){return e()},r.classList.add("dev-panel-events-link"),r},t.prototype.setupEventLink=function(e,r){var i=this,n="experiment."+r.substring(0,r.lastIndexOf(".")),a=t.createLink(r,function(){"RUNNING"==i.panels.client.getExperimentState()?i.panels.client.showFadingInfoLine(d.msg.EVENTS_PAUSE_THE_MODEL_TO_FOLLOW_EVENT_LINK(),!0,"white","royalblue"):i.panels.client.postUserCommand("setpresentable",n)});this.panels.setupDynamicTooltip(a,function(){return d.msg.TOOLTIP_EVENTS_SHOW_AGENT()+("RUNNING"==i.panels.client.getExperimentState()?" ("+d.msg.TOOLTIP_EVENTS_IN_PAUSED_STATE_ONLY()+")":"")}),e.cells[1].appendChild(a)},t.prototype.setupRunForLink=function(e){var r=this,i=t.createLink("?",function(){if("PAUSED"!=r.panels.client.getExperimentState())r.panels.client.showFadingInfoLine(d.msg.EVENTS_PAUSE_THE_MODEL_RUN_TO_EVENT(),!0,"white","royalblue");else{var t=f.getFloatAttribute(e,"time");r.panels.client.postUserCommand("rununtiltime",t.toString()),r.panels.execution.showPauseAtReminder(t)}});this.panels.setupDynamicTooltip(i,function(){return d.msg.TOOLTIP_EVENTS_RUN_TO()+("RUNNING"==r.panels.client.getExperimentState()?" ("+d.msg.TOOLTIP_EVENTS_IN_PAUSED_STATE_ONLY()+")":"")}),e.cells[2].appendChild(i)},t.setupEventIcon=function(t,e){var r,i=e.includes("TRANSITION")?"transition":"event";switch(e){case"EVENT_DYNAMIC":r="dynamic";break;case"EVENT_CONDITION":case"TRANSITION_CONDITION":r="condition";break;case"EVENT_TIMEOUT":case"TRANSITION_TIMEOUT":r="timeout";break;case"EVENT_RATE":case"TRANSITION_RATE":r="rate";break;case"TRANSITION_MESSAGE":r="message";break;default:return}var n=p.cloneHTMLElement("dev-panel-icon-event-template");n.firstElementChild.setAttributeNS(p.xlinkns,"href","#dev-panel-icon-"+i),n.lastElementChild.setAttributeNS(p.xlinkns,"href","#dev-panel-icon-"+r),t.cells[1].appendChild(n)},t.addRowMore=function(t,e){for(var r=t.rows[t.rows.length-1],i=t.insertRow(-1),n=0;n<r.cells.length;n++)i.insertCell(n);i.cells[1].innerText=f.formatNumber(e,0)+" "+d.msg.EVENTS_MORE()+"...",i.className="dev-panel-events-row-more"},t.prototype.setSendEvents=function(t){this.panels.client.postUserCommand("sendevents",t?"true":"false")},t}(),Pm=function(){function t(t){var e=this;this.onSnapshotLoadInfo=function(t,r){var i=f.getAttributeValue(t,r,"type");switch(i){case"snapshot-progress":var n=f.getAttributeValue(t,r,"fraction"),a=f.getAttributeValue(t,r,"text");"null"!=n&&Bm.setMessageBoxProgress(.25+.75*parseFloat(n)),"null"!=a&&(Bm.setMessageBoxProgress(-1),Bm.setMessageBoxHTML(a+"\n"+d.msg.OPERATION_CANNOT_BE_INTERRUPTED()+"\n"));break;case"snapshot-ready":case"snapshot-error":if(Bm.closeMessageBox(),e.client.frameDrawing.removeInfoCommandListener(e.onSnapshotLoadInfo),"snapshot-error"==i){var o=f.getAttributeValue(t,r,"text");e.client.showMessageBox("error",d.msg.BOX_TITLE_LOAD_SNAPSHOT(),d.msg.SNAPSHOT_FAILED_TO_RESTORE()+":\n"+o)}}},this.onSnapshotSaveInfo=function(t,r){var i=f.getAttributeValue(t,r,"type");switch(i){case"snapshot-progress":var n=f.getAttributeValue(t,r,"fraction"),a=f.getAttributeValue(t,r,"text");"null"!=n&&Bm.setMessageBoxProgress(parseFloat(n)),"null"!=a&&(Bm.setMessageBoxProgress(-1),Bm.setMessageBoxHTML(d.msg.WRITING_SNAPSHOT_FILE()+":\n"+a+"\n"+d.msg.OPERATION_CANNOT_BE_INTERRUPTED()+"\n"));break;case"snapshot-ready":case"snapshot-error":if(Bm.closeMessageBox(),e.client.frameDrawing.removeInfoCommandListener(e.onSnapshotSaveInfo),"snapshot-ready"==i){var o=f.getAttributeValue(t,r,"file-name");e.client.networkManager.downloadFile(o),e.client.showMessageBox("message",d.msg.BOX_TITLE_SAVE_SNAPSHOT(),d.msg.DOWNLOADING_SNAPSHOT())}else{var s=f.getAttributeValue(t,r,"text");e.client.showMessageBox("error",d.msg.BOX_TITLE_SAVE_SNAPSHOT(),d.msg.SNAPSHOT_FAILED_TO_SAVE()+":\n"+s)}}},this.panels=t,this.client=t.client,this.fileInput=document.getElementById("file-input-for-svg"),this.dpButtonFileOpt=document.getElementById("dev-panel-button-file-options"),this.dpButtonLoadSnapshot=document.getElementById("dev-panel-button-load-snapshot"),this.dpButtonSaveSnapshot=document.getElementById("dev-panel-button-save-snapshot"),this.panels.setupActionAndTooltip(this.dpButtonFileOpt,function(){Rm.toggleExpanded(e.dpButtonFileOpt),e.updateFileGroup()}),this.panels.setupActionAndTooltip(this.dpButtonLoadSnapshot,function(){return e.loadSnapshot()}),this.panels.setupActionAndTooltip(this.dpButtonSaveSnapshot,function(){return e.saveSnapshot()})}return t.prototype.updateFileGroup=function(){var e="true"==this.dpButtonFileOpt.getAttribute("expanded"),r=t.experimentsSupportingSnapshot.indexOf(this.client.getExperimentType())>=0,i="RUNNING"==this.client.getExperimentState();Rm.setVisible(this.dpButtonLoadSnapshot,e),this.panels.setEnabled(this.dpButtonLoadSnapshot,r&&!i),Rm.setVisible(this.dpButtonSaveSnapshot,e),this.panels.setEnabled(this.dpButtonSaveSnapshot,r&&!i),r&&!i?(Rm.setTooltip(this.dpButtonLoadSnapshot,"TOOLTIP_LOAD_SNAPSHOT"),Rm.setTooltip(this.dpButtonSaveSnapshot,"TOOLTIP_SAVE_SNAPSHOT")):r?(Rm.setTooltip(this.dpButtonLoadSnapshot,"TOOLTIP_SNAPSHOT_NOT_WHILE_RUNNING"),Rm.setTooltip(this.dpButtonSaveSnapshot,"TOOLTIP_SNAPSHOT_NOT_WHILE_RUNNING")):(Rm.setTooltip(this.dpButtonLoadSnapshot,"TOOLTIP_SNAPSHOT_NOT_SUPPORTED"),Rm.setTooltip(this.dpButtonSaveSnapshot,"TOOLTIP_SNAPSHOT_NOT_SUPPORTED"))},t.prototype.loadSnapshot=function(){var t=this;this.client.runningFromCloud()?this.client.showMessageBox("message",d.msg.BOX_TITLE_NOT_SUPPORTED(),d.msg.BOX_TEXT_SNAPSHOT_LOAD_NOT_SUPPORTED()):(this.fileInput.accept=".als",this.fileInput.onchange=function(){return t.onSnapshotFileChosen()},this.fileInput.click())},t.prototype.saveSnapshot=function(){this.client.postUserCommand("savesnapshot",""),this.client.showMessageBox("wait",d.msg.BOX_TITLE_SAVE_SNAPSHOT(),d.msg.WRITING_SNAPSHOT_FILE()+".\n\n"+d.msg.OPERATION_CANNOT_BE_INTERRUPTED()+"\n",!0,!1),this.client.frameDrawing.addInfoCommandListener(this.onSnapshotSaveInfo)},t.prototype.onSnapshotFileChosen=function(){var t=this,e=this.fileInput.files;if(e.length>0){var r=e[0];this.client.showMessageBox("wait",d.msg.BOX_TITLE_LOAD_SNAPSHOT(),d.msg.UPLOADING_SNAPSHOT_FILE()+":\n"+r.name+" ["+f.formatNumber(r.size,0)+" "+d.msg.BYTES()+"]\n"+d.msg.OPERATION_CANNOT_BE_INTERRUPTED()+"\n",!0,!1),this.client.networkManager.uploadFile("0",r,function(e){return t.onSnapshotUploadProgress(e)},function(e){return t.onSnapshotUploaded()},function(e){return t.onSnapshotUploadError(e)},"snapshot")}this.fileInput.value=""},t.prototype.onSnapshotUploadProgress=function(t){if(!this.client.isStoppedAndShouldIgnoreResponses()&&t.lengthComputable){var e=t.loaded/t.total;Bm.setMessageBoxProgress(.25*e)}},t.prototype.onSnapshotUploaded=function(){if(!this.client.isStoppedAndShouldIgnoreResponses()){var t=Bm.getMessageBoxHTML();Bm.setMessageBoxHTML(t.replace(d.msg.UPLOADING_SNAPSHOT_FILE(),d.msg.RESTORING_SNAPSHOT())),this.client.frameDrawing.addInfoCommandListener(this.onSnapshotLoadInfo)}},t.prototype.onSnapshotUploadError=function(t){this.client.isStoppedAndShouldIgnoreResponses()||(Bm.closeMessageBox(),this.client.showMessageBox("error",d.msg.BOX_TITLE_LOAD_SNAPSHOT(),d.msg.SNAPSHOT_FAILED_TO_UPLOAD()+":\n"+t))},t.experimentsSupportingSnapshot=["simulation","compare","variation"],t}(),Rm=function(){function t(e){var r=this;this.wsvgmin=100,this.wborder=4,this.wbodymin=300,this.hprogress=4,this.hcontrolpanel=46,this.client=e,this.svgContainer=this.client.svgContainer,this.svgAndDevContainer=this.client.svgContainer.parentElement,this.presentationContainer=this.svgAndDevContainer.parentElement,this.progress=document.getElementById("control-panel-progress"),this.progressBar=document.getElementById("control-panel-progress-bar"),this.progressTooltip=document.getElementById("control-panel-progress-tooltip"),this.controlPanel=document.getElementById("control-panel"),this.cpButtonWebsite=document.getElementById("control-panel-button-website"),this.cpButtonTermsOfUse=document.getElementById("control-panel-button-terms-of-use"),this.cpButtonAbout=document.getElementById("control-panel-button-about"),this.cpButtonFullScreen=document.getElementById("control-panel-button-full-screen"),this.cpButtonDevTools=document.getElementById("control-panel-button-dev-panel"),this.cpInfoState=document.getElementById("control-panel-info-state"),this.cpIndicatorMultiRun=document.getElementById("control-panel-multi-run-progress-indicator"),this.cpIndicatorResponse=document.getElementById("control-panel-response-indicator"),this.cpIndicatorNetwork=document.getElementById("control-panel-network-access-indicator"),this.cpIndicatorLag=document.getElementById("control-panel-lag-indicator"),this.devPanel=document.getElementById("svg-dev-panel"),this.dpBorder=document.getElementById("dev-panel-border"),this.dpBody=document.getElementById("dev-panel-body"),this.dpSectionTime=document.getElementById("dev-panel-section-time"),this.dpSectionDate=document.getElementById("dev-panel-section-date"),this.dpIndicatorState=document.getElementById("dev-panel-state-indicator"),this.dpInfoTimeInteger=document.getElementById("dev-panel-info-time-integer"),this.dpInfoTimeFraction=document.getElementById("dev-panel-info-time-fraction"),this.dpInfoTimeUnit=document.getElementById("dev-panel-info-time-unit"),this.dpInfoDate=document.getElementById("dev-panel-info-date"),this.dpInfoRealSpeed=document.getElementById("dev-panel-info-real-speed"),this.dpInfoFps=document.getElementById("dev-panel-info-fps"),this.dpInfoEps=document.getElementById("dev-panel-info-eps"),this.dpInfoStep=document.getElementById("dev-panel-info-step"),this.dpInfoRealTime=document.getElementById("dev-panel-info-real-time"),this.dpInfoMemory=document.getElementById("dev-panel-info-memory");var i=document.getElementById("dev-panel-memory-indicator-container");this.dpMemoryIndicator=t.addArcIndicator(i,.75,"dev-panel-memory-back"),this.dbInfoShapeCount=document.getElementById("dev-panel-info-shape-count"),this.dbInfoCudCount=document.getElementById("dev-panel-info-cud-count"),this.dbInfoFramesQ=document.getElementById("dev-panel-info-frames-queue"),this.dbInfoRequest=document.getElementById("dev-panel-info-request"),this.dbInfoPacket=document.getElementById("dev-panel-info-packet"),this.dbInfoMore=document.getElementById("dev-panel-info-more"),this.execution=new Om(this),this.modelNavigation=new Im(this),this.modelConsole=new _m(this),this.eventsView=new Lm(this),this.snapshot=new Pm(this),this.setupGlobalHotkeys(),new m(this.dpBorder,null,null,function(t){r.isDevPanelOpen()&&new xf(t.pageX,t.pageY,function(t,e,i){return r.onDevPanelBorderDrag(e)},null,"col-resize")},null,null),p.isDebugMode()&&this.openDevPanel(),window.onbeforeunload=function(){return r.client.postUserCommand("close","")},window.addEventListener("resize",function(){return r.adjustControlPanelItemsVisibility()},!1),this.setupTooltip(this.cpIndicatorResponse),this.setupActionAndTooltip(this.cpButtonWebsite,function(){return window.open("https://www.anylogic.com")}),this.setupActionAndTooltip(this.cpButtonTermsOfUse,function(){return r.showTermsOfUse()}),this.setupActionAndTooltip(this.cpButtonAbout,function(){return r.showAboutInfo()}),this.cpInfoState.onclick=function(){return r.onCpInfoStateClick()},this.setupTooltip(this.cpInfoState),this.setupActionAndTooltip(this.cpButtonFullScreen,function(){return r.toggleFullScreen()}),w.addFullScreenListener(function(){return r.onFullScreenChange()}),this.setupActionAndTooltip(this.cpButtonDevTools,function(){return r.toggleDevPanel()}),this.setupTooltip(this.dpInfoTimeInteger),this.setupTooltip(this.dpInfoTimeFraction),this.setupTooltip(this.dpInfoTimeUnit),this.setupTooltip(this.dpInfoDate),this.setupTooltip(this.dpInfoRealSpeed.parentNode),this.setupTooltip(this.dpInfoEps.parentNode),this.setupTooltip(this.dpInfoFps.parentNode),this.setupTooltip(this.dpInfoStep.parentNode),this.setupTooltip(this.dpInfoRealTime.parentNode),this.setupTooltip(this.dpInfoMemory.parentNode.parentNode);var n=document.getElementById("DEBUG-toggle-debug"),a=document.getElementById("DEBUG-panel-choose-model"),o=document.getElementById("DEBUG-panel-info-svg");n.onclick=function(){r.client.DEBUG_SPARK_LOCAL&&("none"==a.style.display?(a.style.removeProperty("display"),o.style.removeProperty("display")):(a.style.display="none",o.style.display="none"))}}return t.prototype.start=function(){var e=this;this.execution.start(),this.modelConsole.start(),this.eventsView.start(),this.cpButtonWebsite.lastElementChild.innerHTML=d.msg.ANYLOGIC_WEBSITE(),this.cpButtonTermsOfUse.lastElementChild.innerHTML=d.msg.TERMS_OF_USE(),this.cpButtonAbout.lastElementChild.innerHTML=d.msg.ABOUT_ANYLOGIC(),this.dpInfoTimeUnit.innerHTML=d.msg.SECOND(),this.dpInfoDate.innerHTML="["+d.msg.DATE()+"]",this.dpInfoEps.previousElementSibling.innerHTML=d.msg.EPS()+":",this.dpInfoFps.previousElementSibling.innerHTML=d.msg.FPS()+":",this.dpInfoStep.previousElementSibling.innerHTML=d.msg.STEP()+":",this.dpInfoRealTime.previousElementSibling.innerHTML=d.msg.REAL_TIME()+":",this.dpInfoRealTime.innerHTML="0 "+d.msg.SECOND(),this.dpInfoMemory.innerHTML="0 "+d.msg.PERCENT_OF()+" 0"+d.msg.MEGABYTES(),this.client.runningFromCloud()||this.svgContainer.classList.add("svg-container-standalone"),this.client.isDevPanelEnabled()?this.client.isDevPanelVisibleOnStart()&&this.openDevPanel():(this.closeDevPanel(),t.setVisible(this.cpButtonDevTools,!1,"logic")),this.eachSecondInterval=window.setInterval(function(){return e.eachSecondUpdate()},1e3),this.each200msInterval=window.setInterval(function(){return e.each200msUpdate()},200),this.realRunningTime=0,this.lastServerRTOf1sec=void 0,this.lastStepOf1sec=0,this.lastServerRTOf200ms=void 0},t.prototype.stop=function(){window.clearInterval(this.eachSecondInterval),window.clearInterval(this.each200msInterval)},t.prototype.setOnToggleFullScreen=function(t){this.onToggleFullScreen=t},t.prototype.setOnResize=function(t){this.onResize=t},t.prototype.setOnStop=function(t){this.onStop=t},t.prototype.onDevPanelBorderDrag=function(t){var e=Math.floor(this.svgAndDevContainer.getBoundingClientRect().width),r=this.dpBody.offsetWidth,i=r-t;return i=Math.min(i,e-this.wsvgmin-this.wborder),i=Math.max(this.wbodymin,i),this.dpBody.style.width=i+"px",this.client.navigation.keepAtNavigationPoint(),[r-i,0]},t.prototype.isDevPanelOpen=function(){return"none"!=this.devPanel.style.display},t.prototype.openDevPanel=function(){if(!(this.isDevPanelOpen()||.8*window.screen.availWidth<this.wsvgmin+this.wborder+this.wbodymin)){var t=this.atModelWindowSize();this.devPanel.style.removeProperty("display"),this.dpBody.style.width||(this.dpBody.style.width=this.wbodymin+"px"),t&&this.resizeWindowToFitModelNativeSize(),this.client.navigation.keepAtNavigationPoint(),this.cpButtonDevTools.classList.add("control-panel-control-pressed"),this.modelConsole.resetNewItemsIndicator(),this.modelConsole.scrollDown(),this.eventsView.onDevPanelOpenClose()}},t.prototype.openConsole=function(){this.eventsView.hide(),this.modelConsole.show()},t.prototype.closeDevPanel=function(){if(this.isDevPanelOpen()){var t=this.atModelWindowSize();this.devPanel.style.display="none",t&&this.resizeWindowToFitModelNativeSize(),this.client.navigation.keepAtNavigationPoint(),this.cpButtonDevTools.classList.remove("control-panel-control-pressed"),this.eventsView.onDevPanelOpenClose()}},t.prototype.toggleDevPanel=function(){this.isDevPanelOpen()?this.closeDevPanel():this.openDevPanel()},t.prototype.getWidthAndHeightTakenByPanels=function(){var t=this.hprogress+this.hcontrolpanel;return{width:this.isDevPanelOpen()?this.wborder+parseInt(this.dpBody.style.width):0,height:t}},t.prototype.resizeWindowToFitModelNativeSize=function(){var t=this,e=this.getWidthAndHeightTakenByPanels(),r=this.client.getWindowWidth()+e.width,i=this.client.getWindowHeight()+e.height;this.client.runningFromCloud()?this.onResize&&this.onResize(r,i,function(){t.client.navigation.keepAtNavigationPoint(),t.adjustControlPanelItemsVisibility()}):(w.setBrowserWindowInnerSize(r,i),this.adjustControlPanelItemsVisibility())},t.prototype.adjustControlPanelItemsVisibility=function(){var e=this.presentationContainer.getBoundingClientRect().width,r=262,i=w.isFullScreenEnabled();t.setVisible(this.cpButtonFullScreen,i,"logic");var n=(e-=r+=i?46:0)>=(r=178);t.setVisible(this.execution.cpButtonSlower,n,"space"),t.setVisible(this.execution.cpInfoScale,n,"space");var a=t.setVisible(this.execution.cpButtonFaster,n,"space");a&&(e-=r),n=e>=(r=46),(a=t.setVisible(this.execution.cpButtonX1,n,"space"))&&(e-=r),n=e>=(r=46),(a=t.setVisible(this.execution.cpButtonVirtual,n,"space"))&&(e-=r),this.client.isDevPanelEnabled()&&(n=e>=(r=70),(a=t.setVisible(this.cpButtonDevTools,n,"space"))&&(e-=r)),n=e>=(r=86),(a=t.setVisible(this.execution.cpInfoMultiRun,n,"space"))&&(e-=r),n=e>=(r=46),(a=t.setVisible(this.cpIndicatorResponse,n,"space"))&&(e-=r)},t.prototype.eachSecondUpdate=function(){var e=this.client.getServerRealTime(),r=this.client.getExperimentStep(),i=this.client.getModelTime();if(null!=this.lastServerRTOf1sec){var n=i-this.lastModelTimeOf1sec;this.dpInfoRealSpeed.innerText=f.formatTimeInterval(n,this.client.getTimeUnit())+"/"+d.msg.SECOND();var a=e-this.lastServerRTOf1sec,o=r-this.lastStepOf1sec,s=a>0?Math.round(1e3*o/a):0;this.dpInfoEps.innerText=f.formatNumber(s,0)}this.lastServerRTOf1sec=e,this.lastStepOf1sec=r,this.lastModelTimeOf1sec=i;var l=this.client.frameDrawing.actualFPS();this.dpInfoFps.innerText=l>=1?Math.round(l).toString():f.formatNumber(l,2,!1),this.dpInfoRealTime.innerText=f.formatNumber(this.realRunningTime/1e3,2)+" "+d.msg.SECOND();var u=this.client.getExperimentMaxMemory(),c=this.client.getExperimentFreeMemory(),h=u>0?(u-c)/u:0,p=Math.round(100*h);this.dpInfoMemory.innerText=p+"% "+d.msg.PERCENT_OF()+" "+t.memoryToString(u);var m=h>.85?"dev-panel-memory-bar-critical":"dev-panel-memory-bar-normal";t.setAcrIndicatorValue(this.dpMemoryIndicator,h),t.setArcIndicatorValueStyle(this.dpMemoryIndicator,m)},t.prototype.each200msUpdate=function(){this.updateExperimentStep(),this.client.isSimulationExperiment()&&this.updateModelTime();var t=this.client.getExperimentState();"INITIALIZE"!=t&&"IDLE"!=t||(this.realRunningTime=0);var e=this.client.getServerRealTime();null!=this.lastServerRTOf200ms&&"RUNNING"==t&&(this.realRunningTime+=e-this.lastServerRTOf200ms),this.lastServerRTOf200ms=e,this.updateLagIndicator(),p.isDebugMode()&&this.updateDebugInfo()},t.prototype.updateExperimentSettings=function(){this.client.runningFromCloud()||(document.title=this.client.getExperimentName()+" - "+this.anyLogicProductName(!1));var e=this.client.isSimulationExperiment();t.setVisible(this.dpSectionTime,e),t.setVisible(this.dpSectionDate,e),t.setVisible(this.dpInfoRealSpeed.parentElement,e),e&&(this.dpInfoTimeUnit.innerText=f.timeUnitToString(this.client.getTimeUnit())),this.snapshot.updateFileGroup(),this.execution.updateExperimentSettings(),this.execution.updateRunGroup(),this.execution.updateSpeedGroup(),this.modelNavigation.setDeepNavigationVisible(e)},t.prototype.updateExperimentState=function(){this.updateInfoState(),this.snapshot.updateFileGroup(),this.execution.updateRunGroup(),this.execution.updateSpeedGroup(),this.modelNavigation.update()},t.prototype.updateExperimentProgress=function(){var t=this.client.getExperimentProgress();if(t<0)this.progress.className="control-panel-progress-inactive";else{this.progress.className="control-panel-progress-active";var e=100*t;if(this.progressBar.style.width=e+"%",this.progressTooltip.innerText=Math.floor(e)+"%",this.client.getMultiRunProgress().length>0){for(var r=this.client.getMultiRunProgress();r.length>this.cpIndicatorMultiRun.childElementCount;){var i=document.createElementNS(p.svgns,"line");this.cpIndicatorMultiRun.appendChild(i)}for(;r.length<this.cpIndicatorMultiRun.childElementCount;)this.cpIndicatorMultiRun.lastElementChild.remove();var n=p.childElements(this.cpIndicatorMultiRun),a=20/r.length;this.cpIndicatorMultiRun.setAttribute("stroke-width",(a/2).toString());for(var o=0;o<r.length;o++){var s=a/2+o*a,l=Math.max(0,r[o]/100*60);f.setMultipleAttributes(n[o],["y1","x2","y2"],[s,l,s])}}}},t.prototype.updateModelTimeScale=function(){this.execution.setSpeed(this.client.getModelTimeScale(),!1)},t.prototype.updateNetworkConnections=function(){var t=this.client.getNetworkConnectionsCount();this.cpIndicatorNetwork.setAttribute("visibility",t>0?"inherit":"hidden")},t.prototype.anyLogicProductName=function(e){var r=t.anyLogicEditionToString(this.client.getAnyLogicEdition()),i=this.client.getAnyLogicVersionModification(),n=t.anyLogicEditionModificationToString(this.client.getAnyLogicEditionModification()),a=r;return e&&(a+=" "+this.client.getAnyLogicVersion()),i&&(a+=" "+i),n&&(a+=" ["+n+"]"),a},t.prototype.updateDebugInfo=function(){var t=this.client.packetManager.totalFrameCount();this.dbInfoFramesQ.innerText=this.client.frameDrawing.framesToPlay()+" ("+f.formatNumber(this.client.frameDrawing.timeToPlay(),2)+")"+(t>0?" + "+t:"")+" | "+this.client.packetRequester.getServerQueue(),this.dbInfoRequest.innerText=Math.round(this.client.packetRequester.getRequestInterval())+" | "+Math.round(this.client.packetRequester.averageResponseTime())},t.prototype.updatePacketInfo=function(t,e,r){this.dbInfoPacket.innerText=f.formatNumber(t,0)+" ["+e+"] @"+f.formatNumber(r,2)},t.prototype.updateShapeCount=function(t){this.dbInfoShapeCount.innerText=t.toString()},t.prototype.updateCreateUpdateDeleteCount=function(t,e,r){this.dbInfoCudCount.innerText=t+"/"+e+"/"+r},t.prototype.updateMoreDebugInfo=function(t){this.dbInfoMore.innerText=t},t.prototype.updateInfoState=function(){var e=this.client.getExperimentState(),r=t.experimentStateToString(e);this.cpInfoState.innerText=t.experimentStateToString(r),this.indicateCpErrorState("ERROR"==e),this.dpIndicatorState.style.fill=t.experimentStateToColor(e);"RUNNING"==e?this.dpIndicatorState.classList.add("dev-panel-state-indicator-running"):this.dpIndicatorState.classList.remove("dev-panel-state-indicator-running"),"ERROR"==e&&this.modelConsole.scrollDown()},t.prototype.indicateCpErrorState=function(t){t&&!this.isDevPanelOpen()?this.cpInfoState.classList.add("control-panel-info-state-error"):this.cpInfoState.classList.remove("control-panel-info-state-error")},t.prototype.onCpInfoStateClick=function(){"ERROR"==this.client.getExperimentState()&&(this.openDevPanel(),this.openConsole(),this.indicateCpErrorState(!1))},t.prototype.updateModelTime=function(){var e=this.client.getExperimentState(),r=this.client.getModelTime();if(r>=0&&t.statesToShowTime.indexOf(e)>=0){var i=f.formatNumber(r,2,!1),n=i.indexOf("e");n<0?(this.dpInfoTimeInteger.innerText=i.substring(0,i.length-3),this.dpInfoTimeFraction.innerText=i.substring(i.length-3)):(this.dpInfoTimeInteger.innerText=i.substring(0,n),this.dpInfoTimeFraction.innerText=i.substring(n)),this.dpInfoDate.innerText=f.formatDate(this.client.getModelDate())}else r<0&&t.statesToShowTime.indexOf(e)>=0&&this.client.isSimulationExperiment()?(this.dpInfoTimeInteger.innerText="∞",this.dpInfoTimeFraction.innerText="",this.dpInfoDate.innerText="["+d.msg.DATE()+"]"):(this.dpInfoTimeInteger.innerText="-",this.dpInfoTimeFraction.innerText=".--",this.dpInfoDate.innerText="["+d.msg.DATE()+"]");this.execution.updateInfoPauseAt()},t.prototype.updateExperimentStep=function(){this.dpInfoStep.innerText=f.formatNumber(this.client.getExperimentStep(),0)},t.prototype.showTermsOfUse=function(){this.client.runningFromCloud()?window.open("https://www.anylogic.com/downloads/legal-info/"):this.displaySystemInfoFromFile("assets/standalone/anylogic-model-end-user-agreement.html","AnyLogic Model End User Agreement")},t.prototype.showAboutInfo=function(){var t=this;this.displaySystemInfoFromFile("assets/standalone/about-anylogic-model.html",d.msg.ABOUT_ANYLOGIC(),function(){var e="-";switch(t.client.getStartOrigin()){case"FROM_IDE":e=d.msg.RUNNING_FROM_IDE();break;case"STANDALONE":e=d.msg.RUNNING_AS_STANDALONE();break;case"CLOUD":e=d.msg.RUNNING_IN_CLOUD()}var r=t.client.getPlatform()+" "+t.client.getArchitecture();document.getElementById("about-created-with").innerText=d.msg.ABOUT_CREATED_WITH(),document.getElementById("about-and-contains").innerText=d.msg.ABOUT_AND_CONTAINS(),document.getElementById("about-the-model-is-running").innerText=d.msg.ABOUT_THE_MODEL_IS_RUNNING(),document.getElementById("about-the-model-is-running-info").innerText=e,document.getElementById("about-anylogic-version").innerText=d.msg.ABOUT_ANYLOGIC_VERSION(),document.getElementById("about-anylogic-version-info").innerText=t.anyLogicProductName(!0),document.getElementById("about-java-version").innerText=d.msg.ABOUT_JAVA_VERSION(),document.getElementById("about-java-version-info").innerText=t.client.getJavaVersion(),document.getElementById("about-platform").innerText=d.msg.ABOUT_PLATFORM(),document.getElementById("about-platform-info").innerText=r,document.getElementById("about-licensing-information").innerText=d.msg.ABOUT_LICENSING_INFORMATION(),document.getElementById("about-the-product-includes").innerText=d.msg.ABOUT_THE_PRODUCT_INCLUDES(),document.getElementById("about-uses-software").innerText=d.msg.ABOUT_USES_SOFTWARE(),document.getElementById("about-see-also").innerText=d.msg.ABOUT_SEE_ALSO(),document.getElementById("about-file-in-exported-model").innerText=d.msg.ABOUT_FILE_IN_EXPORTED_MODEL(),document.getElementById("about-file-in-installation").innerText=d.msg.ABOUT_FILE_IN_INSTALLATION()})},t.prototype.onFullScreenChange=function(){var t=this.cpButtonFullScreen.getElementsByTagName("use").item(0),e=w.isFullScreen(),r=e?"off":"on";t.setAttribute("href","#control-panel-icon-full-screen-"+r),e?(this.svgContainer.style.borderTop="0",this.cpButtonFullScreen.classList.add("control-panel-control-pressed")):(this.svgContainer.style.removeProperty("border-top"),this.cpButtonFullScreen.classList.remove("control-panel-control-pressed")),this.adjustControlPanelItemsVisibility()},t.prototype.toggleFullScreen=function(){this.client.runningFromCloud()?this.onToggleFullScreen&&this.onToggleFullScreen():w.toggleFullScreen(this.presentationContainer)},t.prototype.updateLagIndicator=function(){var e=this.client.frameDrawing.timeToPlay();if(e<t.OK_RESPONSE_TIME)this.cpIndicatorLag.setAttribute("visibility","hidden");else{this.cpIndicatorLag.setAttribute("visibility","inherit"),e>t.CRITICAL_RESPONSE_TIME?this.cpIndicatorLag.setAttribute("stroke","indianred"):this.cpIndicatorLag.removeAttribute("stroke");Math.min(e/t.CRITICAL_RESPONSE_TIME,1);var r=3+7*(e-t.OK_RESPONSE_TIME)/(t.CRITICAL_RESPONSE_TIME-t.OK_RESPONSE_TIME);this.cpIndicatorLag.firstElementChild.setAttribute("dur",r+"s")}},t.addArcIndicator=function(t,e,r){var i=document.getElementById("dev-panel-arc-indicator-template").cloneNode(!0);return i.setAttribute("transform","scale("+e+")"),i.firstElementChild.setAttribute("class",r),t.appendChild(i),i},t.setAcrIndicatorValue=function(t,e){e=Math.min(e,.999);var r=2*Math.PI*e,i=8.5*Math.sin(r),n=-8.5*Math.cos(r),a=e>.5?"1":"0";t.lastElementChild.setAttribute("d","M0 -8.5 A 8.5 8.5 0 "+a+" 1 "+i+" "+n)},t.setArcIndicatorValueStyle=function(t,e){t.lastElementChild.setAttribute("class",e)},t.setArcIndicatorBackgroundStyle=function(t,e){t.firstElementChild.setAttribute("class",e)},t.prototype.setupGlobalHotkeys=function(){var e=this;document.onkeydown=function(r){("F5"==r.key||"R"==r.key.toUpperCase()&&r.ctrlKey||"BrowserRefresh"==r.key)&&!e.client.runningFromCloud()?(r.preventDefault(),e.client.showFadingInfoLine(d.msg.WINDOW_REFRESH_DISABLED(),!0,"white","royalblue")):"Backspace"==r.key&&!t.backspaceInUse(r.target)||"BrowserBack"==r.key?(r.preventDefault(),e.client.isNavigationBackEnabled()&&e.modelNavigation.navigate("back")):" "!=r.key||t.spaceInUse(r.target)||(e.execution.canRun()?e.client.postUserCommand("run",""):e.execution.canPause()&&e.client.postUserCommand("pause",""))}},t.backspaceInUse=function(t){return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement},t.spaceInUse=function(t){return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement||t instanceof HTMLButtonElement},t.anyLogicEditionToString=function(t){switch(t){case"PROFESSIONAL":return"AnyLogic Professional";case"PLE":return"AnyLogic Personal Learning Edition";case"UNIVERSITY_RESEARCHER":return"AnyLogic University Researcher";case"EDUCATIONAL":return"AnyLogic Educational";default:return"AnyLogic "}},t.anyLogicEditionModificationToString=function(t){switch(t){case"EVALUATION":return d.msg.EVALUATION_USE_ONLY();case"DISTRIBUTOR":return d.msg.DISTRIBUTOR_DEMO_USE_ONLY();default:return}},t.toggleExpanded=function(t){var e="true"==t.getAttribute("expanded");t.setAttribute("expanded",(!e).toString())},t.experimentStateToString=function(t){switch(t){case"IDLE":return d.msg.STATE_IDLE();case"RUNNING":return d.msg.STATE_RUNNING();case"PAUSED":return d.msg.STATE_PAUSED();case"FINISHED":return d.msg.STATE_FINISHED();case"ERROR":return d.msg.STATE_ERROR();case"PLEASE_WAIT":return d.msg.STATE_PLEASE_WAIT();case"INITIALIZE":return d.msg.STATE_INITIALIZE();case"STOPPED":return d.msg.STATE_STOPPED();case"TIME_LIMIT":return d.msg.STATE_TIME_LIMIT();case"TERMINATED":return d.msg.STATE_TERMINATED()}return t},t.experimentStateToColor=function(t){switch(t){case"IDLE":return"DodgerBlue";case"RUNNING":return"Green";case"PAUSED":return"Orange";case"FINISHED":return"Black";case"ERROR":return"Red";case"PLEASE_WAIT":case"INITIALIZE":return"MediumPurple";case"STOPPED":return"Red";case"TIME_LIMIT":return"Black";case"TERMINATED":return"Red"}return"Gray"},t.memoryToString=function(t){return t<1024?t+d.msg.BYTES():t<1048576?f.formatNumber(Math.round(t/1024),1)+d.msg.KILOBYTES():f.formatNumber(Math.round(t/1048576),1)+d.msg.MEGABYTES()},t.setVisible=function(t,e,r){if(r){var i=t.getAttribute("hide-reasons");i||(i=""),e?""==(i=i.replace(r,""))&&t.style.removeProperty("display"):(i.indexOf(r)<0&&(i+=r),t.style.display="none"),t.setAttribute("hide-reasons",i)}else e?t.style.removeProperty("display"):t.style.display="none";return"none"!=t.style.display},t.prototype.setEnabled=function(t,e){var r="dev-panel-input-control",i=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&i.push(t);for(var n=0,a=i;n<a.length;n++){var o=a[n];e?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}var s=this.controlPanel.contains(t),l=s?"control-panel-control":"dev-panel-control",u=s?"control-panel-control-disabled":"dev-panel-control-disabled";r=e?u:l;var c=Array.from(t.getElementsByClassName(r));t.classList.contains(r)&&c.push(t);for(var h=0,d=c;h<d.length;h++){o=d[h];e?(o.classList.remove(r),o.classList.add(l)):(o.classList.remove(r),o.classList.add(u))}},t.isEnabled=function(t){return t.classList.contains("dev-panel-control")||t.classList.contains("dev-panel-control-link")||t.classList.contains("control-panel-control")},t.prototype.setupActionAndTooltip=function(e,r){r&&(e.onclick=function(){t.isEnabled(e)&&r()}),this.setupTooltip(e)},t.setTooltip=function(t,e){t.setAttribute("tooltip",e)},t.prototype.setupTooltip=function(t){this.setupDynamicTooltip(t,function(t){var e=t.getAttribute("tooltip");return e?d.msg[e]():""})},t.prototype.setupDynamicTooltip=function(t,e){var r=this;f.isIOS()||(t.onmouseover=function(){var i=t.getBoundingClientRect(),n=e(t);r.client.showTooltip(n,i.left+10,i.top+10,"whitesmoke","dimgray")},t.onmouseout=function(){r.client.hideTooltip()})},t.assignActionOnEnterPressed=function(t,e){t.onkeydown=function(t){13==t.keyCode&&e()}},t.prototype.displaySystemInfoFromFile=function(t,e,r){var i=this;void 0===r&&(r=void 0),this.client.networkManager.getStaticFile(t,function(t){i.client.showMessageBox("system-info",e,t.responseText,!1),r&&!i.client.isStoppedAndShouldIgnoreResponses()&&r()})},t.prototype.atModelWindowSize=function(){var e=this.getWidthAndHeightTakenByPanels(),r=this.client.svgContainer.clientWidth,i=this.client.svgContainer.clientHeight,n=this.presentationContainer.getBoundingClientRect(),a=n.width,o=n.height;return Math.abs(a-(r+e.width))<t.WINDDOW_SIZE_TOLERANCE&&Math.abs(o-(i+e.height))<t.WINDDOW_SIZE_TOLERANCE},t.statesToShowTime=["RUNNING","PAUSED","FINISHED","ERROR","PLEASE_WAIT"],t.OK_RESPONSE_TIME=2,t.CRITICAL_RESPONSE_TIME=10,t.WINDDOW_SIZE_TOLERANCE=5,t}(),Fm=function(){function t(t){this.client=t}return t.prototype.getRestRoot=function(){return this.client.DEBUG_SPARK_LOCAL?"/http/":void 0!==this.client.getHost()?this.client.getHost()+"/nodes/"+this.client.getRestURL()+"sessions/"+this.client.getSessionUuid()+"/":"/uuid/"},t.prototype.getConfiguration=function(t){var e=this,r=new XMLHttpRequest;return r.onreadystatechange=function(){return e.onRequestReadyStateChange(r,t)},r.open("GET",this.getRestRoot()+"configuration",!0),r.send(),r},t.prototype.getAnimationPacket=function(t,e){var r=this,i=new XMLHttpRequest;return i.onreadystatechange=function(){return r.onRequestReadyStateChange(i,e)},i.open("GET",this.getRestRoot()+"frames?fullFrame="+t+"&time="+performance.now(),!0),i.send(),i},t.prototype.postMaxFPS=function(t){var e=this,r=new XMLHttpRequest;r.onreadystatechange=function(){return e.onRequestReadyStateChange(r)},r.open("POST",this.getRestRoot()+"max-fps"),r.send(t.toString())},t.prototype.postUserAction=function(t,e,r){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(){return i.onRequestReadyStateChange(n,r)},n.open("POST",this.getRestRoot()+"action?id="+t+"&value="+encodeURIComponent(e)),n.send()},t.prototype.postUserCommand=function(t,e,r){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(){return i.onRequestReadyStateChange(n,r)},n.open("POST",this.getRestRoot()+"command?cmd="+t+"&parameters="+encodeURIComponent(e)),n.send()},t.prototype.uploadFile=function(t,e,r,i,n,a){var o=new FormData;o.append("file",e);var s=new XMLHttpRequest;s.upload.addEventListener("progress",r),s.upload.addEventListener("load",i),s.upload.addEventListener("error",function(t){return n("Upload error")}),s.upload.addEventListener("abort",function(t){return n("Upload aborted")}),s.onreadystatechange=function(){s.readyState==XMLHttpRequest.DONE&&200!=s.status&&n(s.responseText)},s.open("POST",this.getRestRoot()+a+"?id="+t+"&name="+encodeURIComponent(e.name)),s.send(o)},t.prototype.getInternalResource=function(t){return this.getRestRoot()+"internal-resources?path="+encodeURIComponent(t)},t.prototype.getResource=function(t,e){var r=new XMLHttpRequest;return r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&e(r)},r.open("GET",this.getRestRoot()+"resources?path="+encodeURIComponent(t),!0),r.send(),r},t.prototype.getStaticFile=function(t,e){var r=new XMLHttpRequest;return r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&e(r)},r.open("GET",encodeURIComponent(t),!0),r.send(),r},t.prototype.downloadFile=function(t){var e=document.createElement("a");e.setAttribute("href",this.getRestRoot()+"resources?path="+encodeURIComponent(t));var r=t.substring(t.lastIndexOf("/")+1);e.setAttribute("download",r),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},t.prototype.onRequestReadyStateChange=function(t,e){if(!this.client.isStoppedAndShouldIgnoreResponses()&&t.readyState==XMLHttpRequest.DONE)if(200==t.status)e&&e(t);else if(0==t.status)this.client.stop("ERROR"),this.client.runningFromCloud()?this.client.showMessageBox("error",d.msg.BOX_TITLE_CONNECTION_LOST(),d.msg.BOX_TEXT_CONNECTION_LOST()):window.close();else if(403==t.status)this.client.showMessageBox("error",d.msg.FORBIDDEN(),t.responseText);else if(460==t.status)this.client.stop("TIME_LIMIT"),this.client.showMessageBox("message",d.msg.BOX_TITLE_ANIMATED_RUN_TIME_LIMIT(),d.msg.BOX_TEXT_ANIMATED_RUN_TIME_LIMIT()+"<a href='https://www.anylogic.com/features/cloud/#subscription' target='_blank'>"+d.msg.SUBSCRIPTION_OPTION()+"</a>.");else if(461==t.status){var r=t.responseText;this.client.stop("TERMINATED"),this.client.showMessageBox("error",d.msg.BOX_TITLE_FATAL_ERROR(),r)}else{r=t.responseText;this.client.showMessageBox("error",t.status+" "+d.msg.BOX_TITLE_ERROR(),r)}},t}(),Dm=function(){function t(t){this.client=t,this.responseTimeStatistics=new tm(Bm.PACKET_STATISTICS_SIZE,Bm.MIN_REQUEST_INTERVAL)}return t.prototype.start=function(){this.isStopped=!1,this.requestInterval=Bm.MIN_REQUEST_INTERVAL,this.activeRequests=[],this.fullFrame=!0,this.serverQueue=0,this.responseTimeStatistics.reset(),this.requestPacketAndScheduleNext()},t.prototype.stop=function(){this.isStopped=!0,this.activeRequests.forEach(function(t){return t.abort()}),this.activeRequests=[],this.requestTimeoutId&&(clearTimeout(this.requestTimeoutId),this.requestTimeoutId=void 0)},t.prototype.requestFullFrame=function(){this.fullFrame=!0},t.prototype.getRequestInterval=function(){return this.requestInterval},t.prototype.getServerQueue=function(){return this.serverQueue},t.prototype.averageResponseTime=function(){return this.responseTimeStatistics.linearWeightedAverage()},t.prototype.requestPacketAndScheduleNext=function(){var t=this;if(!this.isStopped){var e=this.client.networkManager.getAnimationPacket(this.fullFrame,function(e){return t.onResponseReceived(e)});this.fullFrame=!1,this.activeRequests.push(e),this.requestTimeoutId=setTimeout(function(){t.requestTimeoutId=void 0,t.activeRequests.length<Bm.MAX_CONCURRENT_REQUESTS&&t.requestPacketAndScheduleNext()},this.requestInterval)}},t.prototype.onResponseReceived=function(t){if(!this.client.isStoppedAndShouldIgnoreResponses()){var e=this.activeRequests.indexOf(t);this.activeRequests.splice(e,1);var r=t.responseURL.indexOf("&time="),i=parseInt(t.responseURL.substring(r+6));this.responseTimeStatistics.add(performance.now()-i);var n=this.responseTimeStatistics.linearWeightedAverage();if(this.requestInterval=n/2,this.requestInterval=Math.max(Bm.MIN_REQUEST_INTERVAL,this.requestInterval),this.requestInterval=Math.min(this.requestInterval,Bm.MAX_REQUEST_INTERVAL),void 0===this.requestTimeoutId&&this.requestPacketAndScheduleNext(),200==t.status){var a=JSON.parse(t.responseText);if(this.client.packetManager.addPacket(a),this.serverQueue=a.serverQueue,p.isDebugMode()){var o=t.responseText.length;this.client.panels.updatePacketInfo(o,a.frames.length,a.fps)}}}},t}(),Nm=function(){function t(t){this.client=t}return t.prototype.reset=function(){this.packetBuffer=[],this.expectedFrameNumber=0,this.cancelFrameLossRecoveryTimeout()},t.prototype.addPacket=function(t){if(t&&t.frames){var e=t.frames;if(0==e.length)return console.log("Animation: Got empty packet"),void this.client.frameDrawing.addPacket(t);var r=e[0].number;if(r<this.expectedFrameNumber)console.log("Animation: Got packet with outdated frame #"+r+", ignored it");else{if(r==this.expectedFrameNumber||e[0].fullFrame){var i=e[e.length-1];return this.expectedFrameNumber=i.number+1,this.client.frameDrawing.addPacket(t),this.updatePacketBuffer(),void this.cancelFrameLossRecoveryTimeout()}this.insertToPacketBuffer(t),console.log("Animation: Reordering  or packet loss, expecting frame #"+this.expectedFrameNumber,", got #"+r+", will wait more"),this.startFrameLossRecoveryTimeout()}}else console.log("Animation: Got ill-formed packet, ignored it")},t.prototype.requestAndWaitFullFrame=function(){console.log("Animation: Picture inconsistency. Requesting full frame"),this.client.packetRequester.requestFullFrame(),this.packetBuffer=[]},t.prototype.totalFrameCount=function(){var t=0;return this.packetBuffer.forEach(function(e){return t+=e.frames.length}),t},t.prototype.updatePacketBuffer=function(){this.removeAllOldPackets(),this.drawAllExpectedPackets()},t.prototype.insertToPacketBuffer=function(t){if(0!==this.packetBuffer.length){var e=t.frames[0],r=this.packetBuffer[this.packetBuffer.length-1];if(r.frames[r.frames.length-1].number<e.number)this.packetBuffer.push(t);else for(var i=0;i<this.packetBuffer.length;i++){if(this.packetBuffer[i].frames[0].number>e.number){this.packetBuffer=this.packetBuffer.slice(0,i).concat([t]).concat(this.packetBuffer.slice(i));break}}}else this.packetBuffer.push(t)},t.prototype.removeAllOldPackets=function(){if(0!=this.packetBuffer.length){var t=this.packetBuffer[0].frames[0];if(!(t.number>=this.expectedFrameNumber)){var e=this.packetBuffer[this.packetBuffer.length-1],r=e.frames[e.frames.length-1];if(r.number>=this.expectedFrameNumber)return console.log("Animation: discarded "+this.packetBuffer.length+" packets with frames #"+t.number+".."+r.number),void(this.packetBuffer=[]);for(var i=0;i<this.packetBuffer.length&&!(this.packetBuffer[i].frames[0].number>=this.expectedFrameNumber);i++);console.log("Animation: discarded "+i+" packets with frames #"+t.number+".."+this.packetBuffer[i-1].frames[this.packetBuffer[i-1].frames.length-1].number),this.packetBuffer.splice(0,i)}}},t.prototype.drawAllExpectedPackets=function(){if(0!=this.packetBuffer.length){var t=this.packetBuffer[0].frames[0];if(t.number==this.expectedFrameNumber){for(var e=this.expectedFrameNumber,r=0;r<this.packetBuffer.length;r++){var i=this.packetBuffer[r].frames;if(i[0].number!=e)break;e=i[i.length-1].number+1}console.log("Animation: got missing packet and drew "+r+" packets with frames #"+t.number+".."+this.packetBuffer[r-1].frames[this.packetBuffer[r-1].frames.length-1].number);var n=this.packetBuffer.splice(0,r);this.client.frameDrawing.addAllPackets(n),this.expectedFrameNumber=e}}},t.prototype.cancelFrameLossRecoveryTimeout=function(){this.waitExpectedFrameTimeoutId&&(clearTimeout(this.waitExpectedFrameTimeoutId),this.waitExpectedFrameTimeoutId=void 0)},t.prototype.startFrameLossRecoveryTimeout=function(){var t=this;this.waitExpectedFrameTimeoutId||(this.waitExpectedFrameTimeoutId=setTimeout(function(){t.waitExpectedFrameTimeoutId=void 0,console.log("Animation: Server response timeout. Requesting full frame"),t.client.packetRequester.requestFullFrame()},4*this.client.packetRequester.getRequestInterval()))},t}(),Bm=function(){function t(){this.DEBUG_SPARK_LOCAL=!1,this.windowAdjusted=!1,this.svgBackLogo=document.getElementById("svg-background-logo"),this.svg=document.getElementById("svg"),this.svgContainer=this.svg.parentNode,this.presentation=document.getElementById("presentation"),this.frameDrawing=new xm(this),this.navigation=new Mm(this),this.panels=new Rm(this),this.networkManager=new Fm(this),this.packetRequester=new Dm(this),this.packetManager=new Nm(this)}return t.prototype.start=function(t){var e=this;this.serverConnectionInfo=t,this.experimentState="INITIALIZE",this.networkManager.getConfiguration(function(t){var r=JSON.parse(t.responseText);e.onConfigurationReceived(r)}),this.startWaitKill()},t.prototype.onConfigurationReceived=function(t){this.isStoppedAndShouldIgnoreResponses()||(this.cancelWaitKill(),this.configuration=t,t&&t.debug&&p.setDebugMode(),this.runningFromCloud()||t.language&&d.setLanguage(t.language),this.navigation.start(),this.panels.start(),this.frameDrawing.start(),this.packetManager.reset(),this.packetRequester.start())},t.prototype.stop=function(t){this.experimentState=t,this.panels.updateExperimentState(),this.configuration&&(this.packetRequester.stop(),this.packetManager.reset(),this.frameDrawing.stop(),this.panels.stop(),this.navigation.stop(),p.removeAllChildren(this.presentation),p.isDebugMode()&&this.panels.updateShapeCount(p.getElementCount()),this.clearNavigationSettings(),this.windowAdjusted=!1,this.tooltipTimeoutId&&(clearTimeout(this.tooltipTimeoutId),clearTimeout(this.waitKillTimeoutId)))},t.prototype.setCallback=function(t,e){switch(t){case"ontogglefullscreen":this.panels.setOnToggleFullScreen(e);break;case"onstop":this.panels.setOnStop(e);break;case"onresize":this.panels.setOnResize(e)}},t.prototype.isStoppedAndShouldIgnoreResponses=function(){return"STOPPED"==this.experimentState||"TIME_LIMIT"==this.experimentState||"TERMINATED"==this.experimentState},t.prototype.startWaitKill=function(){var e=this;this.timeClientStarted=Date.now(),this.waitKillTimeoutId=setTimeout(function(){return e.displayWaitKillBox()},t.WAIT_KILL_TIMEOUT)},t.prototype.cancelWaitKill=function(){t.closeMessageBox(),clearTimeout(this.waitKillTimeoutId)},t.prototype.displayWaitKillBox=function(){var e=this,r=f.formatNumber(t.KILL_TIMEOUT/6e4,1);this.showMessageBox("wait","<span style='color: red'>"+d.msg.BOX_TITLE_WAIT_OR_KILL()+"</span>",d.msg.BOX_TEXT_WAIT_OR_KILL_OPTIONS()+"\n"+d.msg.BOX_TEXT_WAIT_OR_KILL_IF_DOES_NOT_START()+" "+r+" "+d.msg.BOX_TEXT_WAIT_OR_KILL_WILL_BE_KILLED()+"\n<span id='kill-the-model'  class='svg-message-box-link' style='color: red; font-weight: bold'>"+d.msg.BOX_TEXT_WAIT_OR_KILL_KILL()+"</span> ",!0,!1),document.getElementById("kill-the-model").addEventListener("click",function(){return e.killModel()}),this.updateWaitKillProgress()},t.prototype.updateWaitKillProgress=function(){var e=this,r=(Date.now()-this.timeClientStarted)/t.KILL_TIMEOUT;t.setMessageBoxProgress(Math.min(1,r)),r>=1?this.killModel():this.waitKillTimeoutId=setTimeout(function(){return e.updateWaitKillProgress()},2e3)},t.prototype.killModel=function(){t.closeMessageBox(),this.panels.execution.stopExperiment()},t.prototype.getHost=function(){return this.serverConnectionInfo?this.serverConnectionInfo.host:void 0},t.prototype.getRestURL=function(){return this.serverConnectionInfo?this.serverConnectionInfo.restUrl:void 0},t.prototype.getSessionUuid=function(){return this.serverConnectionInfo?this.serverConnectionInfo.sessionUuid:void 0},t.prototype.runningFromCloud=function(){return!!this.configuration&&"CLOUD"==this.configuration.startOrigin},t.prototype.getStartOrigin=function(){return this.configuration?this.configuration.startOrigin:"-"},t.prototype.getAnyLogicEdition=function(){return this.configuration?this.configuration.edition:"-"},t.prototype.getAnyLogicEditionModification=function(){return this.configuration?this.configuration.editionModification:"-"},t.prototype.getAnyLogicVersion=function(){return this.configuration?this.configuration.version:"-"},t.prototype.getAnyLogicVersionModification=function(){return this.configuration?this.configuration.versionModification:"-"},t.prototype.getJavaVersion=function(){return this.configuration?this.configuration.javaVersion:"-"},t.prototype.getPlatform=function(){return this.configuration?this.configuration.platform:"-"},t.prototype.getArchitecture=function(){return this.configuration?this.configuration.architecture:"-"},t.prototype.isDevPanelEnabled=function(){return!this.configuration||this.configuration.developerPanelEnabled},t.prototype.isDevPanelVisibleOnStart=function(){return!this.configuration||this.configuration.developerPanelVisibleOnStart},t.prototype.setExperimentSettings=function(t,e,r,i,n,a,o,s,l,u){this.experimentType=t,this.experimentName=e,this.maxMemory=r,this.timeUnit=i,this.startTime=n,this.startDate=a,this.stopTime=o,this.stopDate=s,this.runControlEnabled=l,this.speedControlEnabled=u,this.panels.updateExperimentSettings()},t.prototype.getExperimentType=function(){return this.experimentType},t.prototype.isSimulationExperiment=function(){return"simulation"==this.experimentType},t.prototype.getExperimentName=function(){return this.experimentName},t.prototype.getExperimentMaxMemory=function(){return this.maxMemory},t.prototype.getTimeUnit=function(){return this.timeUnit},t.prototype.getStartTime=function(){return this.startTime},t.prototype.getStartDate=function(){return new Date(this.startDate)},t.prototype.toModelDate=function(t){var e=t-this.startTime;return new Date(this.startDate+this.toMilliseconds(e))},t.prototype.getModelDate=function(){return this.toModelDate(this.modelTime)},t.prototype.toMilliseconds=function(t){return f.toMilliseconds(t,this.timeUnit)},t.prototype.toModelTimeUnits=function(t,e){return f.toMilliseconds(t,e)/this.toMilliseconds(1)},t.prototype.isRunControlEnabled=function(){return this.runControlEnabled},t.prototype.isSpeedControlEnabled=function(){return this.speedControlEnabled},t.prototype.updateExperimentState=function(t){t.state!=this.experimentState&&(this.experimentState=t.state,this.panels.updateExperimentState()),this.experimentStep=t.step,this.serverRealTime=t.realTime,this.freeMemory=t.freeMemory,null==t.numConnections&&(t.numConnections=0),t.numConnections!=this.numConnections&&(this.numConnections=t.numConnections,this.panels.updateNetworkConnections()),null==t.multiRunProgress&&(t.multiRunProgress=[]),t.progress==this.experimentProgress&&t.multiRunProgress==this.multiRunProgress||(this.experimentProgress=t.progress,this.multiRunProgress=t.multiRunProgress,this.panels.updateExperimentProgress()),this.modelTime=t.time,t.timeScale<0&&(t.timeScale=1/0),t.timeScale!=this.modelTimeScale&&(this.modelTimeScale=t.timeScale,this.panels.updateModelTimeScale()),this.panels.modelConsole.update(t.consoleUpdate),this.panels.eventsView.update(t.eventInfo)},t.prototype.getExperimentState=function(){return this.experimentState},t.prototype.getModelTime=function(){return this.modelTime},t.prototype.getExperimentStep=function(){return this.experimentStep},t.prototype.getModelTimeScale=function(){return this.modelTimeScale},t.prototype.getExperimentProgress=function(){return this.experimentProgress},t.prototype.getMultiRunProgress=function(){return this.multiRunProgress},t.prototype.getServerRealTime=function(){return this.serverRealTime},t.prototype.getExperimentFreeMemory=function(){return this.freeMemory},t.prototype.getNetworkConnectionsCount=function(){return this.numConnections},t.prototype.setNavigationSettings=function(t,e,r,i,n,a,o,s,l,u,c){var h=this.windowX!=t||this.windowY!=e||this.windowWidth!=r||this.windowHeight!=i||this.zoomAndPanningEnabled!=n||this.navigationBackEnabled!=a||this.viewTitle!=o||this.viewAreas.toString()!=s.toString()||this.presentable.toString()!=l.toString();!this.panels.isDevPanelOpen()||null==l||null!=this.presentable&&this.presentable.toString()==l.toString()||this.showFadingInfoLine(l.toString().replace(/,/g,".")),!h&&c||(this.windowX=t,this.windowY=e,this.windowWidth=r,this.windowHeight=i,this.zoomAndPanningEnabled=n,this.navigationBackEnabled=a,this.viewTitle=o,this.viewAreas=s,this.presentable=l,this.nextLevelAgents=u,this.windowAdjusted||(this.panels.resizeWindowToFitModelNativeSize(),this.windowAdjusted=!0),this.navigation.applyNavigationSettings()),this.panels.modelNavigation.update()},t.prototype.clearNavigationSettings=function(){this.windowX=void 0,this.windowY=void 0,this.windowWidth=void 0,this.windowHeight=void 0,this.zoomAndPanningEnabled=void 0,this.navigationBackEnabled=void 0,this.viewTitle=void 0,this.viewAreas=void 0,this.presentable=void 0,this.nextLevelAgents=void 0,this.panels.modelNavigation.update()},t.prototype.getWindowX=function(){return this.windowX},t.prototype.getWindowY=function(){return this.windowY},t.prototype.getWindowWidth=function(){return this.windowWidth},t.prototype.getWindowHeight=function(){return this.windowHeight},t.prototype.isZoomAndPanningEnabled=function(){return this.zoomAndPanningEnabled},t.prototype.isNavigationBackEnabled=function(){return this.navigationBackEnabled},t.prototype.getViewTitle=function(){return this.viewTitle},t.prototype.getViewAreas=function(){return this.viewAreas},t.prototype.getPresentable=function(){return this.presentable},t.prototype.getNextLevelAgents=function(){return this.nextLevelAgents},t.prototype.postUserAction=function(t,e){this.networkManager.postUserAction(t,e)},t.prototype.postUserCommand=function(t,e){this.networkManager.postUserCommand(t,e)},t.prototype.showTooltip=function(t,e,r,i,n){var a=this;if(t&&""!=t){var o=document.getElementById("presentation-tooltip");o.innerText=t;var s=o.offsetWidth,l=o.offsetHeight;o.style.left=Math.max(0,e-s-1)+"px",o.style.top=Math.max(0,r-l-1)+"px",o.style.backgroundColor=i,o.style.color=n,o.className="presentation-tooltip-shown",clearTimeout(this.tooltipTimeoutId),this.tooltipTimeoutId=setTimeout(function(){return a.hideTooltip()},2e3)}},t.prototype.hideTooltip=function(){document.getElementById("presentation-tooltip").className="presentation-tooltip-hidden",clearTimeout(this.tooltipTimeoutId)},t.prototype.openURL=function(t){t.startsWith("http://")||t.startsWith("https://")||(t="http://"+t),this.showMessageBox("message",d.msg.BOX_TITLE_OPEN_URL(),d.msg.ASK_OPEN_URL()+":<br><a href="+t+" target = '_blank' onclick = 'document.getElementById( \"svg-message-background\" ).style.display = \"none\"'>"+t+"</a><br><br>"+d.msg.URL_OPENS_IN_NEW_WINDOW())},t.prototype.copyToClipboard=function(e){var r="allow-copy-to-clipboard";this.showMessageBox("message",d.msg.BOX_TITLE_CLIPBOARD_ACCESS(),d.msg.BOX_TEXT_COPY_TO_CLIPBOARD()+"\n<span id='"+r+"'  class='svg-message-box-link'>"+d.msg.BOX_TEXT_COPY_TO_CLIPBOARD_ALLOW()+"</span> "+d.msg.BOX_TEXT_COPY_TO_CLIPBOARD_REJECT()),document.getElementById(r).addEventListener("click",function(){f.copyToClipboard(e),t.closeMessageBox()})},t.prototype.showMessageBox=function(e,r,i,n,a){var o=this;void 0===n&&(n=!0),void 0===a&&(a=!0);var s=document.getElementById("svg-message-background"),l=document.getElementById("svg-message-box"),u=document.getElementById("svg-message-box-header"),c=document.getElementById("svg-message-box-title"),h=document.getElementById("svg-message-box-text"),p=document.getElementById("svg-message-box-icon-use"),f=document.getElementById("svg-message-box-close"),m=document.getElementById("svg-message-box-progress"),g=e.startsWith("error"),b=e.startsWith("system-info"),v=e.startsWith("wait"),y=a?"dev-panel-control":"dev-panel-control-disabled",A=a?"dev-panel-control-disabled":"dev-panel-control";f.classList.contains(y)||f.classList.add(y),f.classList.remove(A),f.onclick=a?function(){t.closeMessageBox()}:void 0,a&&!g?(s.onclick=function(e){e.target==s&&t.closeMessageBox()},s.onkeydown=function(e){"Escape"==e.code&&t.closeMessageBox()}):(s.onclick=void 0,s.onkeydown=void 0);var T="svg-message-box-colors-info",C="#dev-panel-icon-info";(g?(T="svg-message-box-colors-error",C="#dev-panel-icon-error"):b?C="#control-panel-icon-anylogic-logo":v&&(T="svg-message-box-colors-wait",C="#dev-panel-icon-wait"),u.className=T,p.setAttribute("href",C),p.setAttribute("xlink:href",C),c.innerHTML=r&&""!=r?r:g?d.msg.BOX_TITLE_ERROR():b?d.msg.SYSTEM_INFORMATION()+" ":d.msg.BOX_TITLE_MESSAGE(),n&&(i=i.replace(/\n/g,"<br>")),g&&(i+="<br><br>"+d.msg.FOR_MORE_DETAILS_SEE()+" <span id='svg-message-box-open-console' class='svg-message-box-link'>"+d.msg.SEE_CONSOLE()+"</span>"),h.innerHTML=i,g)&&(document.getElementById("svg-message-box-open-console").onclick=function(){s.style.display="none",o.panels.openDevPanel(),o.panels.openConsole(),o.panels.modelConsole.scrollDown()});if(v?(m.style.removeProperty("display"),m.removeAttribute("value")):m.style.display="none",this.runningFromCloud()){var S=document.getElementById("svg-and-dev-panel-container").parentElement.getBoundingClientRect();l.style.maxWidth=Math.round(.8*S.width)+"px",l.style.maxHeight=Math.round(.8*S.height)+"px"}s.style.removeProperty("display"),a&&!g&&s.focus()},t.setMessageBoxHTML=function(t,e){void 0===e&&(e=!0);var r=document.getElementById("svg-message-box-text");e&&(t=t.replace(/\n/g,"<br>")),r.innerHTML=t},t.getMessageBoxHTML=function(){return document.getElementById("svg-message-box-text").innerHTML},t.setMessageBoxProgress=function(t){var e=document.getElementById("svg-message-box-progress");t>=0?e.value=Math.round(100*t):e.removeAttribute("value")},t.closeMessageBox=function(){document.getElementById("svg-message-background").style.display="none"},t.prototype.showFadingInfoLine=function(t,e,r,i){var n=this;void 0===e&&(e=!0),void 0===r&&(r=null),void 0===i&&(i=null);var a=document.getElementById("svg-fading-info-line");a.innerText=t,null!=r?a.style.color=r:a.style.removeProperty("color"),null!=i?a.style.backgroundColor=i:a.style.removeProperty("background-color"),a.className="svg-fading-info-line-shown",clearTimeout(this.fadingInfoLineTimeoutId),e&&(this.fadingInfoLineTimeoutId=setTimeout(function(){return n.hideFadingInfoLine()},1e3))},t.prototype.hideFadingInfoLine=function(){document.getElementById("svg-fading-info-line").className="svg-fading-info-line-hidden",clearTimeout(this.fadingInfoLineTimeoutId)},t.PACKET_STATISTICS_SIZE=10,t.MAX_FPS=40,t.START_FPS=15,t.MIN_FPS=.2,t.MIN_REQUEST_INTERVAL=250,t.MAX_REQUEST_INTERVAL=2e3,t.MAX_CONCURRENT_REQUESTS=2,t.WAIT_KILL_TIMEOUT=2e4,t.KILL_TIMEOUT=3e5,t}(),Gm=function(){function t(t){this.client=t}return t.prototype.getClient=function(){return this.client},t.prototype.start=function(t){var e=this;p.setDebugMode(),this.client.DEBUG_SPARK_LOCAL=t,t&&(this.modelSelector=document.getElementById("select-model"),this.modelSelector.onchange=function(){return e.onNewModelSelected()})},t.prototype.stop=function(){this.modelSelector&&(this.modelSelector.onchange=void 0)},t.prototype.onNewModelSelected=function(){var t=this;if(this.client.getExperimentState()&&this.client.stop("TERMINATED"),"NO MODEL SELECTED"==this.modelSelector.value)this.client.networkManager.postUserCommand("close","");else{var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&t.client.start({})},e.open("GET","/http/start?path="+this.modelSelector.value,!0),e.send()}},t}(),Um=function(){function t(){}return t.createClient=function(){return new Bm},t.createDebugger=function(){return new Gm(new Bm)},t}(),Hm=function(){function t(t,e,r){if(void 0===t||void 0===e||void 0===r)throw new Error("Illegal argument");this.major=t,this.minor=e,this.extra=r}return t.prototype.compare=function(t){var e;return 0!=(e=this.major-t.major)?e:0!=(e=this.minor-t.minor)?e:e=this.extra-t.extra},t.prototype.between=function(t,e){return this.compare(t)>=0&&this.compare(e)<=0},t.prototype.greaterOrEquals=function(t){return this.compare(t)>=0},t.fromString=function(e){var r=e.split(".");return new t(Number(r[0]),Number(r[1]),Number(r[2]))},t.VERSION_8_0_0=new t(8,0,0),t.VERSION_8_0_1=new t(8,0,1),t.VERSION_8_0_4=new t(8,0,4),t.VERSION_8_0_5=new t(8,0,5),t.VERSION_8_1_0=new t(8,1,0),t.VERSION_8_2_0=new t(8,2,0),t.VERSION_8_3_0=new t(8,3,0),t}(),zm=function(){function t(){}return t.createClient=function(t){var e=Hm.fromString(t);if(e.greaterOrEquals(Hm.VERSION_8_3_0))return Um.createClient();if(e.greaterOrEquals(Hm.VERSION_8_2_0))return $f.createClient();if(e.greaterOrEquals(Hm.VERSION_8_1_0))return vf.createClient();if(e.greaterOrEquals(Hm.VERSION_8_0_5))return Xt.createClient();if(e.greaterOrEquals(Hm.VERSION_8_0_4))return bt.createClient();if(e.greaterOrEquals(Hm.VERSION_8_0_0))return H.createClient();throw new Error("SVG: Incorrect version: "+t)},t.createDebugger=function(t){var e=Hm.fromString(t);if(e.greaterOrEquals(Hm.VERSION_8_3_0))return Um.createDebugger();if(e.greaterOrEquals(Hm.VERSION_8_2_0))return $f.createDebugger();if(e.greaterOrEquals(Hm.VERSION_8_1_0))return vf.createDebugger();if(e.greaterOrEquals(Hm.VERSION_8_0_5))return Xt.createDebugger();if(e.greaterOrEquals(Hm.VERSION_8_0_4))return bt.createDebugger();if(e.greaterOrEquals(Hm.VERSION_8_0_0))return H.createDebugger();throw new Error("SVG: Incorrect version: "+t)},t}();window.SVGFactory=zm}]);